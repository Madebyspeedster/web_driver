{"version":3,"sources":["webpack:///./src/inject/drivers/base.js","webpack:///./src/inject/drivers/magento/511tactical.com.js","webpack:///./src/inject/drivers/magento/7forallmankind.com.js","webpack:///./src/inject/drivers/magento/_base.js","webpack:///./src/inject/drivers/magento/alloyapparel.com.js","webpack:///./src/inject/drivers/magento/alternativeapparel.com.js","webpack:///./src/inject/drivers/magento/americanstationery.com.js","webpack:///./src/inject/drivers/magento/betabrand.com.js","webpack:///./src/inject/drivers/magento/cjponyparts.com.js","webpack:///./src/inject/drivers/magento/clearbags.com.js","webpack:///./src/inject/drivers/magento/coffeebean.com.js","webpack:///./src/inject/drivers/magento/dailysale.com.js","webpack:///./src/inject/drivers/magento/dellrefurbished.com.js","webpack:///./src/inject/drivers/magento/draperjames.com.js","webpack:///./src/inject/drivers/magento/dtlr.com.js","webpack:///./src/inject/drivers/magento/eastwood.com.js","webpack:///./src/inject/drivers/magento/easyspirit.com.js","webpack:///./src/inject/drivers/magento/eileenfisher.com.js","webpack:///./src/inject/drivers/magento/elaineturner.com.js","webpack:///./src/inject/drivers/magento/fractureme.com.js","webpack:///./src/inject/drivers/magento/g2play.net.js","webpack:///./src/inject/drivers/magento/goggles4u.com.js","webpack:///./src/inject/drivers/magento/h2oplus.com.js","webpack:///./src/inject/drivers/magento/harborfreight.com.js","webpack:///./src/inject/drivers/magento/highlights.com.js","webpack:///./src/inject/drivers/magento/hydroflask.com.js","webpack:///./src/inject/drivers/magento/index.js","webpack:///./src/inject/drivers/magento/inkcartridges.com.js","webpack:///./src/inject/drivers/magento/invictastores.com.js","webpack:///./src/inject/drivers/magento/jackrabbit.com.js","webpack:///./src/inject/drivers/magento/jamesperse.com.js","webpack:///./src/inject/drivers/magento/jasonwustudio.com.js","webpack:///./src/inject/drivers/magento/jerrysartarama.com.js","webpack:///./src/inject/drivers/magento/jomashop.com.js","webpack:///./src/inject/drivers/magento/karenkane.com.js","webpack:///./src/inject/drivers/magento/karmaloop.com.js","webpack:///./src/inject/drivers/magento/lapolicegear.com.js","webpack:///./src/inject/drivers/magento/lax.com.js","webpack:///./src/inject/drivers/magento/ldproducts.com.js","webpack:///./src/inject/drivers/magento/lecreuset.com.js","webpack:///./src/inject/drivers/magento/luggagepros.com.js","webpack:///./src/inject/drivers/magento/magazines.com.js","webpack:///./src/inject/drivers/magento/mophie.com.js","webpack:///./src/inject/drivers/magento/myfreedomsmokes.com.js","webpack:///./src/inject/drivers/magento/mypillow.com.js","webpack:///./src/inject/drivers/magento/ninewest.com.js","webpack:///./src/inject/drivers/magento/oneida.com.js","webpack:///./src/inject/drivers/magento/papyrusonline.com.js","webpack:///./src/inject/drivers/magento/partsgeek.com.js","webpack:///./src/inject/drivers/magento/peekkids.com.js","webpack:///./src/inject/drivers/magento/peets.com.js","webpack:///./src/inject/drivers/magento/prettylittlething.us.js","webpack:///./src/inject/drivers/magento/quickcandles.com.js","webpack:///./src/inject/drivers/magento/reeds.com.js","webpack:///./src/inject/drivers/magento/riteaid.com.js","webpack:///./src/inject/drivers/magento/scrubsandbeyond.com.js","webpack:///./src/inject/drivers/magento/shiekh.com.js","webpack:///./src/inject/drivers/magento/shoestation.com.js","webpack:///./src/inject/drivers/magento/shop.drcolbert.com.js","webpack:///./src/inject/drivers/magento/shopnational.com.js","webpack:///./src/inject/drivers/magento/showmeyourmumu.com.js","webpack:///./src/inject/drivers/magento/shrm.org.js","webpack:///./src/inject/drivers/magento/smarthome.com.js","webpack:///./src/inject/drivers/magento/solesociety.com.js","webpack:///./src/inject/drivers/magento/spanx.com.js","webpack:///./src/inject/drivers/magento/straighterline.com.js","webpack:///./src/inject/drivers/magento/targetphoto.com.js","webpack:///./src/inject/drivers/magento/techrabbit.com.js","webpack:///./src/inject/drivers/magento/the-cover-store.com.js","webpack:///./src/inject/drivers/magento/tidyliving.com.js","webpack:///./src/inject/drivers/magento/totokaelo.com.js","webpack:///./src/inject/drivers/magento/triabeauty.co.uk.js","webpack:///./src/inject/drivers/magento/villeroy-boch.ca.js","webpack:///./src/inject/drivers/magento/vincecamuto.com.js","webpack:///./src/inject/drivers/magento/vionicshoes.com.js","webpack:///./src/inject/drivers/magento/vitalitymedical.com.js","webpack:///./src/inject/drivers/magento/vivaterra.com.js","webpack:///./src/inject/drivers/magento/worldofwatches.com.js","webpack:///./src/inject/drivers/magento/worx.com.js","webpack:///./src/inject/drivers/magento/zagg.com.js"],"names":["toFloat","format","BaseDriver","watchForRestoreUserData","time","pauseInterval","interval","setInterval","currentState","checkRestoreDataCondition","clearInterval","bus","$emit","e","handleDriverError","source","storeUserData","domain","userData","getUserData","Promise","resolve","userDataKey","getUserDataStorageKey","storageRecord","storedTime","Date","now","backgroundMessaging","setDriverStorage","log","restoreUserData","maxStorageLifetime","driverStorage","getDriverStorage","deleteDriverStorage","setUserData","getStartPrice","startPrice","Number","MAX_SAFE_INTEGER","totalElementConfig","TOTAL_ELEMENT_CONFIG","selector","attribute","regex","totalElement","Array","isArray","forEach","elemSelector","document","querySelector","Error","value","getAttribute","textContent","pattern","group","match","beforeTestCodes","beforeCheckCodes","beforeApplyCodes","checkCodes","applyCodes","stackCodes","removeCodes","getMerchantCodes","getExistingCodes","codes","codeCount","getPreTaxShippingTotal","watchForCartUrl","previousState","checkCondition","completeExperience","completeExperiencePromisified","args","_promisify","beforeTestCodesPromisified","getStartPricePromisified","getMerchantCodesPromisified","getExistingCodesPromisified","removeCodesPromisified","beforeApplyCodesPromisified","applyCodesPromisified","beforeCheckCodesPromisified","checkCodesPromisified","stackCodesPromisified","method","then","apply","elemToFloat","toInt","setValue","DOM","BASE_URL","CART_URL","IS_ON_CART","window","location","href","includes","MERCHANT_CODES_SELECTOR","_getMerchantCodes","Set","querySelectorAll","map","el","DriverCart","Driver","MagentoTemplate","constructor","TOTAL_SELECTOR","ITEM_CONTAINER_SELECTOR","INPUT_FIELD_SELECTOR","FORM_KEY_SELECTOR","GRAND_AMOUNT_REGEX","SHIPPING_AMOUNT_REGEX","TAX_AMOUNT_REGEX","afterCodeCheck","cookie","totalRegExp","regexObj","groupNumber","correctUrl","codeInput","isTotal","FORM_KEY","REMOVE_REQUEST_EXTRA_VALUES","remove","form_key","APPLY_REQUEST_EXTRA_VALUES","_getCart","responseHTML","total","shipping","taxes","fetch","credentials","response","text","DriverCheckout","API_URL","XPID_REGEX","ENTITY_ID_REGEX","ITEM_SELECTOR","CREATE_ACCOUNT_BUTTON_SELECTOR","APPLY_CODE_SELECTOR","SPINNER_SELECTOR","APPLY_BUTTON_SELECTOR","CODE_INPUT_SELECTOR","OPEN_CODE_INPUT_SELECTOR","CANCEL_BUTTON_SELECTOR","isSpinner","offsetParent","isCodeInput","isTotalPrice","token","_getRegExValue","ENTITY_ID","headers","_checkUserAuthorization","isLoggedUser","_getPaymentInformation","json","totals","coupon_code","filter","Boolean","length","_removeCodeManually","responseJSON","originalPrice","_parseTotal","originalItemsCount","_parseItemsCount","each","code","_applyCode","result","finalPrice","finalDiscount","freeGifts","isValid","_removeCode","_manuallyApplyCode","delay","base_grand_total","base_shipping_amount","base_tax_amount","tax","_manageCode","_openSideWithCodesInput","codesInput","applyButton","click","isApplyButton","wait","url","status","openSideWithCodesInput","items_qty","reduce","a","b","regEx","data","extractElement","name","showDifferentDiscountMessage","enableFreeGiftsWarning","completionAction","completionActions","default","none","maxCoupons","isSinglePageApp","SITE_URL","URL","URL_REGEXP","RegExp","protocol","EMPTY_CART_SELECTOR","IS_ON_CART_PAGE","SHIPPING_REGEX","TAX_REGEX","MANAGE_CODE_HEADERS","accept","referer","sessionTimer","initialize","actionInterval","timeout","ON_CHECKOUT_PAGE","startsWith","cartEmpty","isTotalEl","_getUpdatedCart","requestURL","bodyObj","body","redirect","_getCartPage","extractElementFromHTML","extractFormValues","APPLIED_CODES_SELECTOR","APPLY_COUPON_FORM_SELECTOR","REMOVE_COUPON_FORM_SELECTOR","APPLY_CODE_PARAM_NAME","REMOVE_CODE_PARAM_NAME","VALID_CHECKOUT_PAGE","STACKABLE","NEED_REMOVE_CODE","itemsCountRegExp","cartPageHTML","_isOnCart","codesElement","_getRemoveRequestData","responseString","workingDiscounts","_getApplyRequestData","push","discount","discounts","validationInfo","sort","currentPrice","currentDiscount","currentFreeGiftsCount","successfulCodes","requestData","params","set","action","htmlString","applyRequestData","Object","entries","key","removeRequestData","isCartEmpty","isOnCartUrl","TOTAL_EXCL_TAX_SELECTOR","TOTAL_INCL_TAX_SELECTOR","SUBTOTAL_SELECTOR","couponElementsArray","innerText","subtotal","TAX_TOTAL_VALUE","revisit","stackable","CHECKOUT_URL","isRightUrl","emptyCartElement","inputField","SIDEBAR_SELECTOR","CART_COUNT_SELECTOR","DISCOUNT_LABEL_SELECTOR","MERCHANT_CODE_SELECTOR","CART_BUTTON_SELECTOR","MERCHANT_CODE_REGEX","USER_HAS_DISCOUNT","CODE_TESTING_INPROGRESS","totalAmountElement","sideBarElement","applyCodeInputElement","cartCount","_checkUserTestingPlaceOnExisting","sidebarElement","discountElement","localStorage","setItem","JSON","stringify","sidebar","promoCodeText","resJSON","messages","error","type","totalAmount","object","codeTestingPlace","getItem","removeItem","DOMAIN","BASE_REQUEST_URL","IS_ON_PAYMENT","TAX_SELECTOR","SPINER_SELECTOR","AUTH_BUTTON_SELECTOR","ENTITY_ID_REG","URL_STRING","IS_PAYMENT","DISABLE_TIME_MS","isNotMaxCodeTesting","dataExpired","lastTestTimestamp","codeTestingCount","noSpiner","style","display","isCartHref","isInput","item","innerHTML","IS_NOT_LOGGED_IN","trim","toLowerCase","_getCodeFromCart","html","element","defaultValue","_getPrice","res","INPUT_CODE_SELECTOR","totalValue","isInputElement","emptyCart","correctPage","iframeElem","createElement","src","assign","documentElement","appendChild","ENTITY_ID_SELECTOR","updatedUrl","entityId","find","parse","customer","firstname","prototype","hasOwnProperty","call","cartStr","parseFloat","base_shipping_incl_tax","extractData","formKey","ERROR_SELECTOR","recursiveCount","IS_INVALID","ORDER_SUMMARY_SELECTOR","getSummaryValue","valueElement","test","responseJson","html_totals","totalPriceElement","codeElement","_createIframe","iframe","setAttribute","SHIPPING_OPTIONS_SELECTOR","isOnCart","QUOTE_ID_SELECTOR","QUOTE_ID_REGEXP","BANNER_SELECTOR","bodyData","isOnHref","userIsLogged","_getWindowObjectData","quoteId","bodyDataAddress","countryId","postcode","regionId","addressInformation","address","shipping_method_code","method_code","shipping_carrier_code","carrier_code","_getTotalInfo","message","shipping_amount","tax_amount","_isShippingOptionsElement","checkedShippingElement","checked","shippingSelector","grand_total","ITEM_COUNT_SELECTOR","variableString","requestDataElement","id","requestDataScript","parentNode","removeChild","EXISTING_CODE_REGEX","SHIPPING_VALUE_REGEX","TAX_VALUE_REGEX","resHtml","shippingElem","taxElem","lastState","APPLIED_CODE_REGEXP","REMOVE_CODE_REGEXP","URLSearchParams","CART_REGEX","CURRENT_STATE","className","removeId","_getRemoveCode","_getSummary","responseText","header","Accept","cart_total","quoteScript","scripts","APPLIED_CODES_REGEX","request","setType","requestTypes","xhr","ORIGINAL_PRICE","get","post","CHARGES_REGEX","CHARGES_SELECTOR","parentElement","charges","charge","BASE_API_URL","COUPONS_BANNER_SELECTOR","MERCHANT_CODES_REGEX","bannerElement","matchedCode","block","_511tactical","_7forallmankind","alloyapparel","alternativeapparel","americanstationery","betabrend","clearbags","coffeebean","cjponyparts","dailysale","dellrefurbished","draperjames","dtlr","eastwood","easyspirit","eileenfisher","elaineturner","fractureme","g2play","goggles4u","h2oplus","harborfreight","highlights","hydroflask","inkcartridges","invictastores","jackrabbit","jamesperse","jasonwustudio","jerrysartarama","jomashop","karenkane","karmaloop","lapolicegear","lax","ldproducts","lecreuset","luggagepros","magazines","mophie","myfreedomsmokes","mypillow","ninewest","oneida","papyrusonline","partsgeek","peekkids","peets","prettylittlething","quickcandles","reeds","riteaid","scrubsandbeyond","shiekh","shoestation","shopDrcolbert","shopnational","showmeyourmumu","shrm","smarthome","solesociety","spanx","straighterline","targetphoto","techrabbit","theCoverStore","tidyliving","totokaelo","triabeauty","villeroyBoch","vincecamuto","vionicshoes","vitalitymedical","vivaterra","worldofwatches","worx","zagg","REMOVE_BTN_SELECTOR","CART_EMPTY_SELECTOR","applyCodeResponse","updatedCart","async","amcoupon_code_cancel","grandtotal","isTaxPresent","TABLE_ROW_SELECTOR","CHECKOUT_REQUEST","IS_CART_PAGE","CHECKOUT_SECTION_SELECTOR","success","bestCode","summary","FREE_SHIP_ELEM_SELECTOR","inputCouponElement","responseTxt","CODE_REGEX","codeElem","TOTAL_SPINNER_SELECTOR","TITLE_SELECTOR","titleElem","isTotalSpinner","CHECKOUT_REQUEST_URL","IS_CHECKOUT","CONTENT_SELECTOR","MESSAGE_SELECTOR","DISABLE_CODE_TESTING","CHECKOUT_COUPON_SELECTOR","recaptchaPageEl","isAppliedCode","_isFakeCode","tryNumber","update_section","review","cartContinueUrl","split","onCart","onRightUrl","CHECKOUT_PAGE","INPUT_SELECTOR","SHIPPING_SECTION","ITEMS_IN_CART","cartURL","checkoutURL","classList","contains","_getOrderSummary","bodyParams","COUNT_ITEM_SELECTOR","TOTAL_REG","FREE_GIFT_SELECTOR","ADD_GIFT_BUTTON_SELECTOR","_getPage","elem","addToCartButtonSelector","getAddToCartButtonSelector","replace","productsCount","BILLING_URL","requestParams","retfmt","coupons","applied","redemptionErrorMsg","requestUrl","toString","grandTotal","CART_URL_HTTP","REQUEST_URL","APPLIED_CODE_SELECTOR","stringIsObj","delete","sendXhr","cart_obj","cart_grandtotal","spiner","IS_CHECKOUT_PAGE","SHIPPING_ELEM_SELECTOR","authorization","shippElem","shippValue","taxValue","shippingValue","theLastValue","CODE_CONTAINER_SELECTOR","onCheckout","applyCodeElement","IS_CART","INVALID_CODE_SELECTOR","_getUpdatedCheckout","promise","APPLIED_CODE_REGEX","PRICES_SELECTOR","appliedCodesMsg","codeMatch","shippingAndHandlingEl","_findElement","shippingAndHandling","shippingInsuranceEl","shippingInsurance","targetString","targetEl","nextElementSibling","cartContent","SHIPPING_SELECTOR","REVIEW_SELECTOR","shippingStepIsActive","reviewStepIsActive","update_sections","getCookie","browserUtils","isOnShiping","isOnPayment","loggedInUserOnShipping","sessionStorage","state","information","guest","checkoutUrl","BAG_ITEM_SELECTOR","DISCOUNT_REGEX","CONTINUE_BUTTON_SELECTOR","REMOVE_CODE_SELECTOR","WARNING_CODE_SELECTOR","WARNING_CODE_REGEX","LOADER_SELECTOR","SUBMIT_BTN_SELECTOR","SHIPPING_METHOD_LIST","SHIPPING_METHOD_SELECTOR","LOADING_BUTTON_SELECTOR","SHIPPING_ON_PAYMENT_SELECTOR","REQUEST_DELAY","titleEl","isOnRightURL","loader","isCodeInputAvailable","loadingButton","ajaxCallsInProgress","submitBtn","shippingMethodList","disabled","shippingMethodElement","shippingMethodValue","POSTAL_CODE","STATE","shippingAddress","selectedAddress","form","shippingInformation","values","addresses","uid","address1","addressLine1","address2","addressLine2","billingInformation","billingCountryPhoneId","telephone","selectedBillingCountryPhoneId","shippingPrice","bag","price","toFixed","updateBodyData","option","shippingMethodDetails","syncQuote","storeId","store_id","sessionId","init","codesFromPromo","codesFromWarning","codesFromBagSummary","_updateCartData","updatedResponse","_applyCodeManually","inputEl","removeButton","continueButton","isRemove","_setCartData","_setPaymentData","_setCheckoutData","_sendRequest","runEmbeddedScript","shippingData","quote","APPLIED_COUPON_SALE_SELECTOR","CART_EMPTY","LOADER","isCorrectUrl","isInputPresent","isLoading","isTotalPresent","region","quoteIdActions","cart","extra_actions","toUpperCase","FAKE_CODE_APPLY","base_subtotal_with_discount","LOAD_SELECTOR","emptyCartElem","totalElem","loadElem","HEADERS","isTotalwithoutTaxes","totalsData","LOGIN_SELECTOR","REMOVE_BUTTON_SELECTOR","param","isTax","AUTHORIZATION_SELECTOR","totalSumm","cancelButton","cartJson","fullname","responseCartJSON","freeShipping","_checkFreeShipping","total_segments","TOTAL_SELECTOR_REGEX","CODE_APPLIED_REGEX","product_discount_id","APPLY_BTN_SELECTOR","couponInputElement","cartPage","_codeAppliedCheck","INPUT_CODE_ELEMENT","APPLY_BTN_ELEMENT","cart_grand_total","isFirefox","PRICE_BLOCK_SELECTOR","SHIPPING_VALUE_SELECTOR","calculatedShipping","navigator","userAgent","isOnCartPage","ORDER_SUMMARY_URL","CART_URL_PAYMENT","SPECIAL_MERCHANT_CODES_SELECTOR","PROMO_CODES_REGEX","TOTAL_REGEX","totalIsRendered","onRightURL","isAjax","queryStringParams","sections","update_section_id","codesFromPage","errors","isRemoving","parsedCodes","decodeURI","SHIPPING_FORM_SELECTOR","NEWRELIC_ID_REGEX","isShippingPage","_isShippingOption","newrelicId","BILLING_STEP_SELECTOR","isCouponInput","billingStep","isActiveBillingStep","isCart","TOTAL_SECTION","TOTAL_SECTION_STORE","totalRegExpStore","CHECKOUT_SPINER","NOT_LOGGED_SELECTOR","position","checkoutSpiner","isTotalSection","isOnCheckout","IS_LOGGED_IN","coupon_code_fake","matchAll","responseCart","totalStore","windowLocation","styledisplay","inrerval","onCartPage","TOTAL_DISCOUNT","ERROR_MESSAGE","PARAM_BODY","_getDiscountValue","discountEl","REG_TOTAL","APPLIED_CODE_REG","CHECKOUT","SPINER","EMPTY_CART","discount_amount","INACTIVE_SIDE_BAR_SELECTOR","CHECKOUT_APPLY_URL","CHECKOUT_REMOVE_URL","SUCCESS_MESSAGE_SELECTOR","cartActive","inactiveSideBar","cartActiveState","completionActionState","coupon_applied","matched","BILLING_SELECTOR","NOT_LOGIN_SELECTOR","isOnCartURL","isOnShipping","isNotLogged","setCookie","SIDEBAR_BTN_SELECTOR","SIDEBAR_CART_SELECTOR","PRETAX_REGEX","isGenieUsed","isLoader","isSidebarCart","btnSidebarOpen","readyState","subtotalWithDiscountEl","subtotalWithDiscount","reload","custom"],"mappings":"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","file":"drivers__magento.bundle.js","sourcesContent":["import bus from '../bus';\nimport { log, format } from '../../utils';\nimport { backgroundMessaging, handleDriverError } from '../lib';\n\nconst { toFloat } = format;\n\nexport default class BaseDriver {\n\t/**\n\t * @function watchForRestoreUserData - set up a listener to check user data restorement\n\t * @emits bus#RestoreUserData - the event that indicates to the app\tthat user data could be restored\n\t */\n\twatchForRestoreUserData(time = 500) {\n\t\tlet pauseInterval = false;\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tconst currentState = await this.checkRestoreDataCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t\tif (currentState) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tbus.$emit('restore-user-data');\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkRestoreDataCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t}\n\t\t}, time);\n\n\t\treturn interval;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * @function storeUserData\n\t * @param {String} domain - domain to set the driver storage\n\t * @returns {Promise}\n\t */\n\tasync storeUserData(domain) {\n\t\tconst userData = await this.getUserData();\n\n\t\tif (userData === null) {\n\t\t\t// Nothing to store\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst storageRecord = {\n\t\t\tuserData,\n\t\t\tstoredTime: Date.now(),\n\t\t};\n\t\tbackgroundMessaging.setDriverStorage(userDataKey, storageRecord);\n\t\tlog('Stored user data: %O', storageRecord);\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function restoreUserData\n\t * @param {String} domain - domain to access the driver storage\n\t * @param {Number} [maxStorageLifetime] - optional, the lifetime of the stored data (default 10 mins)\n\t * @returns {Promise}\n\t */\n\tasync restoreUserData(domain, maxStorageLifetime = 600000) {\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(userDataKey);\n\n\t\tif (driverStorage) {\n\t\t\tconst { storedTime, userData } = driverStorage;\n\t\t\t// Clear stored user data\n\t\t\tbackgroundMessaging.deleteDriverStorage(userDataKey);\n\n\t\t\tif (Date.now() - storedTime <= maxStorageLifetime) {\n\t\t\t\tlog('Restore user data: %O', userData);\n\t\t\t\treturn this.setUserData(userData);\n\t\t\t}\n\t\t\tlog('User data is outdated, skip restoring');\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserData - get user data which should be stored\n\t * @returns {Object} - object with required user data which should be restored\n\t */\n\tgetUserData() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function setUserData - restore user data on page\n\t * @param {Object} userData - data which was saved and should be restored\n\t * @returns {Promise}\n\t */\n\tsetUserData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserDataStorageKey - unique key for storing user data per merchant\n\t * @returns {String}\n\t */\n\tgetUserDataStorageKey(domain) {\n\t\t// Append `_userData` to avoid possible conflicts with created storage from driver\n\t\treturn `${domain}_userData`;\n\t}\n\n\t/**\n\t * Parses start price from page\n\t *\n\t * @function getStartPrice\n\t * @returns {Promise<Number>|Number} - the total from the page\n\t */\n\tgetStartPrice() {\n\t\tlet startPrice = Number.MAX_SAFE_INTEGER;\n\t\tconst totalElementConfig = this.TOTAL_ELEMENT_CONFIG;\n\t\tif (totalElementConfig) {\n\t\t\tconst { selector, attribute, regex } = totalElementConfig;\n\t\t\tlet totalElement;\n\t\t\t// handle case, when there is array of selectors and we try to take totalElement using these selectors in turn\n\t\t\t// for example dell.com, hertz.com\n\t\t\tif (Array.isArray(selector)) {\n\t\t\t\tselector.forEach(elemSelector => {\n\t\t\t\t\tif (!totalElement) {\n\t\t\t\t\t\ttotalElement = document.querySelector(elemSelector);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\ttotalElement = document.querySelector(selector);\n\t\t\t} else {\n\t\t\t\thandleDriverError(\n\t\t\t\t\tnew Error(`Total selector type mismatch. Expected string | array, got ${typeof selector}`),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (totalElement) {\n\t\t\t\tlet value = attribute ? totalElement.getAttribute(attribute) : totalElement.textContent;\n\n\t\t\t\tif (value && regex) {\n\t\t\t\t\t// Set pattern to null to receive error in case pattern was not defined\n\t\t\t\t\t// otherwise we may silently return undefined or empty string\n\t\t\t\t\tconst { pattern = null, group = 0 } = regex;\n\t\t\t\t\tvalue = value.match(pattern)[group];\n\t\t\t\t}\n\t\t\t\tstartPrice = toFloat(value);\n\t\t\t}\n\t\t}\n\t\treturn startPrice;\n\t}\n\n\t/**\n\t * Perform any needed actions and setup to start codes testing\n\t *\n\t * @function beforeTestCodes\n\t *\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @typedef {Object} OriginalData\n\t * @property {Number} originalPrice the starting price for the cart\n\t * @property {Number} originalItemsCount the starting items count of the cart\n\t */\n\t/**\n\t * Perform any needed actions and setup before `checkCodes()` will be executed\n\t *\n\t * @function beforeCheckCodes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tbeforeCheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Perform any needed actions and setup before `applyCodes()` will be executed\n\t *\n\t * @function beforeApplyCodes\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function checkCodes\n\t *\n\t * @param {String[]} codes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise}\n\t */\n\tcheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes each code in @param codes and actually applies it to the cart,\n\t * typically through a fetch(...) call.\n\t *\n\t * @function applyCodes\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tapplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function stackCodes\n\t *\n\t * @param {Object} validationInfo - contains all required info passed by `checkCodes()` for codes stacking\n\t * @param {String[]} validationInfo.codes\n\t * @param {Float} [validationInfo.originalPrice]\n\t * @param {Object[]} [validationInfo.discounts] - contains all codes mapped with their discounts\n\t * @returns {Promise}\n\t */\n\tstackCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function removeCodes\n\t *\n\t * @param {String[]} codes - passed in case the driver needs to know specific codes to do removal\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request response) which are available and were not applied by user\n\t *\n\t * @function getMerchantCodes\n\t * @returns {String[]} - codes from merhcant page (or request response if possible)\n\t */\n\tgetMerchantCodes() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request) which are available and were applied by user\n\t *\n\t * @typedef {Object} ExistingCodeInfo\n\t * @prop {String[]} codes - list of codes which had been applied, if discoverable\n\t * @prop {Number} codeCount - the number of codes that were applied to the cart\n\t */\n\t/**\n\t * @function getExistingCodes\n\t * @returns {ExistingCodeInfo}\n\t */\n\tgetExistingCodes() {\n\t\treturn {\n\t\t\tcodes: [],\n\t\t\tcodeCount: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Parses pre tax and shipping total from page or request's response\n\t *\n\t * @function getPreTaxShippingTotal\n\t * @returns {Promise<Number>|Number} - the total without tax and shipping\n\t */\n\tgetPreTaxShippingTotal() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function watchForCartUrl - optional function to set up a listener for url changes on SPAs\n\t * @emits bus#CartActive - the event (using the string 'cart-active') that indicates to the app that test codes button should be shown\n\t * @emits bus#CartInactive - the event (using the string 'cart-inactive') that indicates to the app that test codes button should be hidden\n\t */\n\twatchForCartUrl(time = 500) {\n\t\tlet previousState = null;\n\t\tlet pauseInterval = false;\n\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\tlet currentState = null;\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tcurrentState = await this.checkCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t\tif (currentState !== previousState) {\n\t\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t\t}\n\t\t\t\tpreviousState = currentState;\n\t\t\t}\n\t\t}, time);\n\t\t// return the interval to stop it in `watchForCartUrl` if needed from outside\n\t\treturn interval;\n\t}\n\n\t/**\n\t * @function checkCondition - optional function to check for conditions on SPAs\n\t * @returns {Boolean}\n\t */\n\tcheckCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Perform custom completion action on Continue to Checkout button\n\t * Takes best codes in @param codes\n\t *\n\t * @function completeExperience\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tcompleteExperience() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function completeExperiencePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcompleteExperiencePromisified(...args) {\n\t\treturn this._promisify(this.completeExperience, args);\n\t}\n\n\t/**\n\t * @function beforeCodesTestingPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeTestCodes, args);\n\t}\n\n\t/**\n\t * @function getStartPricePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetStartPricePromisified() {\n\t\treturn this._promisify(this.getStartPrice);\n\t}\n\n\t/**\n\t * @function getMerchantCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetMerchantCodesPromisified(...args) {\n\t\treturn this._promisify(this.getMerchantCodes, args);\n\t}\n\n\t/**\n\t * @function getExistingCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetExistingCodesPromisified(...args) {\n\t\treturn this._promisify(this.getExistingCodes, args);\n\t}\n\n\t/**\n\t * @function removeCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tremoveCodesPromisified(...args) {\n\t\treturn this._promisify(this.removeCodes, args);\n\t}\n\n\t/**\n\t * @function beforeApplyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeApplyCodes, args);\n\t}\n\n\t/**\n\t * @function applyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tapplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.applyCodes, args);\n\t}\n\n\t/**\n\t * @function beforeCheckCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeCheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeCheckCodes, args);\n\t}\n\n\t/**\n\t * @function checkCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.checkCodes, args);\n\t}\n\n\t/**\n\t * @function stackCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tstackCodesPromisified(...args) {\n\t\treturn this._promisify(this.stackCodes, args);\n\t}\n\n\t/**\n\t * @function _promisify - promisifies given method and return it's result as a Promise\n\t * @returns {Promise}\n\t */\n\t_promisify(method, args) {\n\t\treturn Promise.resolve().then(() => method.apply(this, args));\n\t}\n}\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\n\nimport { format, log, DOM, completionActions } from '../../../utils';\nimport { wait } from '../../../utils/browser';\nimport { extractElement } from '../../../utils/DOM';\n\nconst { toFloat, elemToFloat, toInt } = format;\nconst { setValue } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: yes\n+ Free shipping: no\n+ ‘isValid’ implemented: yes on checkout\n+ Codes can be replaced by another code: no\n+ Max codes: 4 (for cart), 10 for checkout, else codes test too slow\n+ Manually apply code: no\n+ Pages, where extension works: cart and checkout\n+ Is driver SPA: no\n+ Gather codes on site pages: yes\n======== Special case ========\nOn billing step we don't apply gift because Gift adds tax and original price is rising\n*/\n\nconst BASE_URL = 'https://www.511tactical.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\nconst IS_ON_CART = () => window.location.href.includes(CART_URL);\n\nconst MERCHANT_CODES_SELECTOR = '.bx-click-to-copy';\n\nconst _getMerchantCodes = () => [\n\t...new Set([...document.querySelectorAll(MERCHANT_CODES_SELECTOR)].map(el => el.textContent)),\n];\n\nconst DriverCart = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = '.grand .price';\n\t\tthis.ITEM_CONTAINER_SELECTOR = 'tbody.cart.item';\n\t\tthis.INPUT_FIELD_SELECTOR = '.cart-summary .discount';\n\t\tthis.FORM_KEY_SELECTOR = 'input[name=\"form_key\"]';\n\t\tthis.GRAND_AMOUNT_REGEX = /\"base_grand_total\":\"?([0-9.]+)\"?/;\n\t\tthis.SHIPPING_AMOUNT_REGEX = /\"base_shipping_amount\":\"?([0-9.]+)\"?/;\n\t\tthis.TAX_AMOUNT_REGEX = /\"Tax\",\"value\":\"?([0-9.]+)\"?/;\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /\"grand_total\":\"?([0-9.]+)\"?/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t}\n\n\tcheckCondition() {\n\t\tconst correctUrl = window.location.href.includes(this.CART_URL);\n\t\tconst codeInput = document.querySelector(this.INPUT_FIELD_SELECTOR);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\n\t\treturn correctUrl && codeInput && isTotal;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.FORM_KEY = document.querySelector(this.FORM_KEY_SELECTOR).getAttribute('value');\n\t\tthis.REMOVE_REQUEST_EXTRA_VALUES = {\n\t\t\tremove: 1,\n\t\t\tform_key: this.FORM_KEY,\n\t\t};\n\t\tthis.APPLY_REQUEST_EXTRA_VALUES = {\n\t\t\tremove: 0,\n\t\t\tform_key: this.FORM_KEY,\n\t\t};\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn _getMerchantCodes();\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getCart().then(responseHTML => {\n\t\t\tconst total = toFloat(responseHTML.match(this.GRAND_AMOUNT_REGEX)[1]);\n\t\t\tconst shipping = toFloat(responseHTML.match(this.SHIPPING_AMOUNT_REGEX)[1]) || 0;\n\t\t\tconst taxes = toFloat(responseHTML.match(this.TAX_AMOUNT_REGEX)[1]) || 0;\n\t\t\treturn total - shipping - taxes;\n\t\t});\n\t}\n\n\t_getCart() {\n\t\treturn fetch(`${this.CART_URL}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nconst DriverCheckout = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.API_URL = `${BASE_URL}/rest/default/V1`;\n\t\tthis.TOTAL_SELECTOR = '.grand .price';\n\t\tthis.XPID_REGEX = /xpid:\"([A-Za-z0-9_=]*)\"/;\n\t\tthis.ENTITY_ID_REGEX = /\"entity_id\":\"([A-Za-z0-9]*)\"/;\n\t\tthis.ITEM_SELECTOR = '.item-options dd[data-bind=\"text: $parent.qty\"]';\n\t\tthis.CREATE_ACCOUNT_BUTTON_SELECTOR = `a[href=\"${BASE_URL}/customer/account/create/\"]`;\n\t\tthis.APPLY_CODE_SELECTOR = '.discount-code';\n\t\tthis.SPINNER_SELECTOR = '.loader';\n\t\tthis.APPLY_BUTTON_SELECTOR = '.action-apply[value=\"Apply Discount\"]';\n\t\tthis.CODE_INPUT_SELECTOR = '.input-text[name=\"discount_code\"]';\n\t\tthis.OPEN_CODE_INPUT_SELECTOR = '.payment-option-title[aria-expanded=\"false\"]';\n\t\tthis.CANCEL_BUTTON_SELECTOR = '.action-cancel[value=\"Cancel\"]';\n\t}\n\n\tcheckCondition() {\n\t\tconst isSpinner = (document.querySelector(this.SPINNER_SELECTOR) || {}).offsetParent;\n\t\tconst isCodeInput = (document.querySelector(this.APPLY_CODE_SELECTOR) || {}).offsetParent;\n\t\tconst isTotalPrice = (document.querySelector(this.TOTAL_SELECTOR) || {}).offsetParent;\n\t\treturn !isSpinner && isCodeInput && isTotalPrice;\n\t}\n\n\tasync beforeTestCodes() {\n\t\t[this.token] = this._getRegExValue(this.XPID_REGEX);\n\t\tthis.ENTITY_ID = this._getRegExValue(this.ENTITY_ID_REGEX);\n\n\t\tthis.headers = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'x-newrelic-id': `${this.token}`,\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tawait this._checkUserAuthorization().then(response => {\n\t\t\tthis.isLoggedUser = response;\n\t\t});\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn _getMerchantCodes();\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getPaymentInformation().then(json => {\n\t\t\tconst codes = [json.totals.coupon_code].filter(Boolean);\n\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCodeManually()\n\t\t\t.then(() => this._getPaymentInformation())\n\t\t\t.then(responseJSON => ({\n\t\t\t\toriginalPrice: this._parseTotal(responseJSON),\n\t\t\t\toriginalItemsCount: this._parseItemsCount(responseJSON),\n\t\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(), originalItemsCount = this._parseItemsCount()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\tlog(`Original items count: ${originalItemsCount}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code).then(responseJSON => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\t\t\t\tif (!responseJSON) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\tresult.finalPrice = this._parseTotal(responseJSON);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.freeGifts = this._parseItemsCount(responseJSON) - originalItemsCount;\n\n\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._manuallyApplyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn Promise.delay(2000)\n\t\t\t.then(() => this._getPaymentInformation())\n\t\t\t.then(responseJSON => {\n\t\t\t\tconst {\n\t\t\t\t\tbase_grand_total: total,\n\t\t\t\t\tbase_shipping_amount: shipping,\n\t\t\t\t\tbase_tax_amount: tax,\n\t\t\t\t} = responseJSON.totals;\n\t\t\t\treturn toFloat(total) - toFloat(shipping) - toFloat(tax);\n\t\t\t});\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode('DELETE');\n\t}\n\n\t_manuallyApplyCode(code) {\n\t\tthis._openSideWithCodesInput();\n\t\tconst codesInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst applyButton = document.querySelector(this.APPLY_BUTTON_SELECTOR);\n\t\tsetValue(codesInput, code, 'change');\n\t\tapplyButton.click();\n\t\treturn Promise.resolve();\n\t}\n\n\t_removeCodeManually() {\n\t\tthis._openSideWithCodesInput();\n\t\tconst isApplyButton = () => document.querySelector(this.APPLY_BUTTON_SELECTOR);\n\t\tdocument.querySelector(this.CANCEL_BUTTON_SELECTOR).click();\n\t\treturn wait(isApplyButton, 6000, 300);\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode('PUT', code).then(response => (!response ? null : this._getPaymentInformation()));\n\t}\n\n\t_manageCode(method, code = '') {\n\t\tconst url = this.isLoggedUser\n\t\t\t? `${this.API_URL}/carts/mine/coupons/${code}`\n\t\t\t: `${this.API_URL}/guest-carts/${this.ENTITY_ID}/coupons/${code}`;\n\n\t\treturn fetch(url, {\n\t\t\tmethod,\n\t\t\theaders: this.headers,\n\t\t}).then(response => (response.status === 404 ? null : response.json()));\n\t}\n\n\t_openSideWithCodesInput() {\n\t\tconst openSideWithCodesInput = document.querySelector(this.OPEN_CODE_INPUT_SELECTOR);\n\t\tif (openSideWithCodesInput) {\n\t\t\treturn openSideWithCodesInput.click();\n\t\t}\n\t\treturn null;\n\t}\n\n\t_parseItemsCount(json) {\n\t\tif (json) {\n\t\t\treturn toFloat(json.totals.items_qty);\n\t\t}\n\t\treturn [...document.querySelectorAll(this.ITEM_SELECTOR)]\n\t\t\t.map(el => toInt(el.textContent))\n\t\t\t.reduce((a, b) => a + b, 0);\n\t}\n\n\t_parseTotal(json) {\n\t\tif (json) {\n\t\t\treturn toFloat(json.totals.base_grand_total);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n\n\t_getPaymentInformation() {\n\t\tconst url = this.isLoggedUser\n\t\t\t? `${this.API_URL}/carts/mine/payment-information?_=${Date.now()}`\n\t\t\t: `${this.API_URL}/guest-carts/${this.ENTITY_ID}/payment-information?_=${Date.now()}`;\n\n\t\treturn fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: this.headers,\n\t\t}).then(response => response.json());\n\t}\n\n\t_getRegExValue(regEx) {\n\t\treturn [...document.querySelectorAll('script')]\n\t\t\t.map(el => el.textContent.match(regEx))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t}\n\n\t_checkUserAuthorization() {\n\t\treturn fetch(`${BASE_URL}/customer/account/index`, {\n\t\t\tmethod: 'GET',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(data => !extractElement(this.CREATE_ACCOUNT_BUTTON_SELECTOR, data));\n\t}\n};\n\nexport default {\n\tname: '5.11 Tactical',\n\tdomain: '511tactical.com',\n\tshowDifferentDiscountMessage: true,\n\tenableFreeGiftsWarning: true,\n\tcompletionAction: IS_ON_CART() ? completionActions.default : completionActions.none,\n\tDriver: IS_ON_CART() ? DriverCart : DriverCheckout,\n\tmaxCoupons: IS_ON_CART() ? 4 : 14,\n\tisSinglePageApp: true,\n};\n","import MagentoTemplate from './_base';\n\nimport { sessionTimer } from '../../lib';\n\n/** Behavior description:\nExisting code: yes\nRemove code: yes\nStackable: no\nFree gift support: no\nFree shipping: no\n'isValid' implemented: no\nCodes can be replaced by another code: no\nManually apply code: no (so on Checkout we lose information, without redirect to other page, can avoid Cart)\nIs driver SPA and add the condition to show popup: yes\nPages, where extension works: `Cart` and `Checkout`(Payment step)\nsessionTimer: 10min\nGather codes on site pages: no\nCredentials (josephhhh@gmail.com, 12345qwertyQ)\n*/\n\nconst SITE_URL = 'https://www.7forallmankind.com';\nconst URL = 'www.7forallmankind.com';\nconst CART_URL = `${SITE_URL}/checkout/cart`;\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.TOTAL_SELECTOR = '.grand .price';\n\t\tthis.URL_REGEXP = new RegExp(`${window.location.protocol}//${URL}/checkout/cart`, 'gi');\n\t\tthis.CODE_INPUT_SELECTOR = '#block-discount-heading';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\n\t\tthis.IS_ON_CART_PAGE = Boolean(window.location.href.match(this.URL_REGEXP));\n\n\t\tthis.SHIPPING_REGEX = /\"shipping_amount\":\"?([0-9.]+)\"?/;\n\t\tthis.TAX_REGEX = /\"Tax\",\"value\":\"?([0-9.]+)\"?/;\n\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /\"grand_total\":\"?([0-9.]+)\"?/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\taccept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',\n\t\t\treferer: 'https://www.7forallmankind.com/checkout/', // need for FF\n\t\t};\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 10,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tthis.IS_ON_CART_PAGE = Boolean(window.location.href.match(this.URL_REGEXP));\n\t\tthis.ON_CHECKOUT_PAGE = window.location.href.startsWith(`${SITE_URL}/checkout`);\n\t\tconst cartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isTotalEl = (document.querySelector(this.TOTAL_SELECTOR) || {}).offsetParent;\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\treturn (this.IS_ON_CART_PAGE || this.ON_CHECKOUT_PAGE) && isTotalEl && codeInput && !cartEmpty;\n\t}\n\n\tbeforeCheckCodes(originalPrice) {\n\t\tif (!originalPrice && this.IS_ON_CART_PAGE) {\n\t\t\treturn this._manageCode().then(responseHTML => this._parseTotal(responseHTML));\n\t\t}\n\t\treturn originalPrice;\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst tax = response.match(this.TAX_REGEX)[1];\n\t\t\tconst shipping = response.match(this.SHIPPING_REGEX)[1];\n\t\t\treturn this._parseTotal(response) - tax - shipping;\n\t\t});\n\t}\n\n\t_manageCode(requestURL, bodyObj) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\tbody: bodyObj,\n\t\t\tredirect: 'manual',\n\t\t}).then(() => this._getCartPage());\n\t}\n\n\t_getCartPage() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: '7 For all mankind',\n\tdomain: '7forallmankind.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tmaxCoupons: 5, // site works slow\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport BaseDriver from '../base';\nimport { DOM, format, log } from '../../../utils';\n\nconst { toFloat } = format;\nconst { extractElementFromHTML, extractFormValues, extractElement } = DOM;\n\n// This template driver is for merchants built on the Magento CMS\n\n/* Similar behavior:\n * Code can be applied on cart (POST). Sometimes - on checkout ( PUT request).\n * Requests and selectors differ on cart and checkout!\n * Invalid code removes a valid one. This action doesn't always refresh the checkout/cart page, so we need to specify the appropriate switch.\n */\n\nexport default class Driver extends BaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = ''; // Cart url without slash at the end.\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code'; // On some websites this may differ.\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price'; // On some websites this may differ.\n\n\t\tthis.ITEM_CONTAINER_SELECTOR = null;\n\n\t\tthis.APPLY_COUPON_FORM_SELECTOR = '#discount-coupon-form'; // Ususally this doesn't change.\n\t\t// Not obligatory. Change only if remove code request is different.\n\t\tthis.REMOVE_COUPON_FORM_SELECTOR = this.APPLY_COUPON_FORM_SELECTOR;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'coupon_code';\n\t\tthis.APPLY_REQUEST_EXTRA_VALUES = {\n\t\t\tremove: 0,\n\t\t};\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.REMOVE_REQUEST_EXTRA_VALUES = {\n\t\t\tremove: 1,\n\t\t};\n\n\t\t// Switches:\n\n\t\tthis.VALID_CHECKOUT_PAGE = false;\n\n\t\t// If website is stackable, set this value to true.\n\t\tthis.STACKABLE = false;\n\n\t\t// If valid codes don't replace each other, need to remove them after each applying\n\t\tthis.NEED_REMOVE_CODE = true;\n\n\t\t// In case there's a need to add custom headers they can be added here.\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t};\n\n\t\t// Function to be executed after codes check is completed.\n\t\tthis.afterCodeCheck = null;\n\n\t\t// Regex for parsing total {regexObj: REGEX_OBJ, groupNumber: 0};\n\t\tthis.totalRegExp = null;\n\n\t\t// REGEX for parsing items count\n\t\tthis.itemsCountRegExp = null;\n\t}\n\n\tbeforeTestCodes() {\n\t\t// We will save here cart page to use it if needed on checkout page\n\t\tthis.cartPageHTML = null; // move to 'beforeTestCodes()' to avoid error in FF\n\n\t\t// Save cartPage in case checkout doesn't have all required data\n\t\tif (!this._isOnCart() && !this.VALID_CHECKOUT_PAGE) {\n\t\t\treturn this._getUpdatedCart().then(response => {\n\t\t\t\tthis.cartPageHTML = response;\n\t\t\t});\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\t// debugger;\n\t\tconst codesElement = this.cartPageHTML\n\t\t\t? extractElementFromHTML(this.cartPageHTML, this.APPLIED_CODES_SELECTOR)\n\t\t\t: document.querySelector(this.APPLIED_CODES_SELECTOR);\n\n\t\tconst codes = [codesElement.getAttribute('value')].filter(el => Boolean(el));\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this._removeCode(code, this._getRemoveRequestData(this.cartPageHTML)))\n\t\t\t.then(() => this._getUpdatedCart()) // Promise.each() return array of applied codes.\n\t\t\t.then(responseString => ({\n\t\t\t\toriginalPrice: this._parseTotal(responseString),\n\t\t\t\toriginalItemsCount: this._parseItemsCount(responseString),\n\t\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(), originalItemsCount = this._parseItemsCount()) {\n\t\tconst workingDiscounts = [];\n\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst freeGifts = this._parseItemsCount(responseString) - originalItemsCount;\n\t\t\t\tconst result = { code, finalPrice, finalDiscount, freeGifts };\n\n\t\t\t\tif (finalDiscount > 0 || (finalPrice === originalPrice && freeGifts > 0)) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\t\t\t\tif (this.NEED_REMOVE_CODE) {\n\t\t\t\t\treturn this._removeCode(code, this._getRemoveRequestData(responseString)).then(() =>\n\t\t\t\t\t\tbus.$emit('code-checked', result),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.STACKABLE) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t\toriginalItemsCount,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst { discounts, originalPrice, originalItemsCount } = validationInfo;\n\n\t\tdiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGiftsCount = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(discounts, discount =>\n\t\t\tthis._applyCode(discount.code, this._getApplyRequestData()).then(responseString => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst freeGifts = this._parseItemsCount(responseString) - originalItemsCount;\n\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t\tfreeGifts,\n\t\t\t\t});\n\n\t\t\t\tif (finalPrice < currentPrice || (finalPrice === currentPrice && freeGifts > currentFreeGiftsCount)) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\tcurrentFreeGiftsCount = freeGifts;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this._removeCode(discount.code, this._getRemoveRequestData(responseString));\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGiftsCount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\tif (this.afterCodeCheck) {\n\t\t\tthis.afterCodeCheck();\n\t\t}\n\t\treturn this.STACKABLE\n\t\t\t? Promise.resolve()\n\t\t\t: this._applyCode(codes[0], this._getApplyRequestData(this.cartPageHTML));\n\t}\n\n\t_applyCode(code, requestData) {\n\t\trequestData.params.set(this.APPLY_CODE_PARAM_NAME, code);\n\t\treturn this._manageCode(requestData.action, requestData.params);\n\t}\n\n\t_removeCode(code, requestData) {\n\t\tif (!requestData) {\n\t\t\t// No `requestData` was passed (=found), so code was not applied, nothing to remove\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\trequestData.params.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\treturn this._manageCode(requestData.action, requestData.params);\n\t}\n\n\t_manageCode(requestURL, bodyObj) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\tbody: bodyObj,\n\t\t}).then(response => response.text());\n\t}\n\n\t_parseTotal(htmlString) {\n\t\tlet totalElement;\n\t\tif (htmlString && this.totalRegExp) {\n\t\t\ttotalElement = htmlString.match(this.totalRegExp.regexObj)[this.totalRegExp.groupNumber];\n\t\t} else if (htmlString) {\n\t\t\ttotalElement = extractElementFromHTML(htmlString, this.TOTAL_SELECTOR).textContent;\n\t\t} else {\n\t\t\ttotalElement = document.querySelector(this.TOTAL_SELECTOR).textContent;\n\t\t}\n\t\treturn toFloat(totalElement);\n\t}\n\n\t_parseItemsCount(htmlString) {\n\t\tif (htmlString && this.itemsCountRegExp) {\n\t\t\treturn htmlString.match(this.itemsCountRegExp.regexObj)[this.itemsCountRegExp.groupNumber];\n\t\t}\n\t\treturn this.ITEM_CONTAINER_SELECTOR ? extractElement(this.ITEM_CONTAINER_SELECTOR, htmlString, true).length : 0;\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(this.CART_URL, {\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_isOnCart() {\n\t\treturn window.location.href.startsWith(this.CART_URL);\n\t}\n\n\t_getApplyRequestData(htmlString) {\n\t\tif (!this.applyRequestData) {\n\t\t\t// Assumed that this form always exists\n\t\t\tthis.applyRequestData = extractFormValues(this.APPLY_COUPON_FORM_SELECTOR, htmlString);\n\t\t\tObject.entries(this.APPLY_REQUEST_EXTRA_VALUES).forEach(([key, value]) => {\n\t\t\t\tthis.applyRequestData.params.set(key, value);\n\t\t\t});\n\t\t}\n\t\treturn this.applyRequestData;\n\t}\n\n\t_getRemoveRequestData(htmlString) {\n\t\tif (!this.removeRequestData) {\n\t\t\t// Form may not exists if there is no code applied\n\t\t\tthis.removeRequestData = extractFormValues(this.REMOVE_COUPON_FORM_SELECTOR, htmlString);\n\t\t\t//  If we succeeded, add extra values\n\t\t\tif (this.removeRequestData) {\n\t\t\t\tObject.entries(this.REMOVE_REQUEST_EXTRA_VALUES).forEach(([key, value]) => {\n\t\t\t\t\tthis.removeRequestData.params.set(key, value);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn this.removeRequestData;\n\t}\n}\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\n\nconst CART_URL = 'https://www.alloyapparel.com/store/checkout/cart';\n\n/** Behavior description:\n * - not stackable\n * - can remove codes\n * - valid code can be replaced with another valid code\n *\n * ======== Special case ========\n * Site is slow, so maximum 10 codes are tested.\n * Shortened checkCodes and eliminated removeCodes to speed up the check.\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code';\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price';\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst result = { code, finalPrice, finalDiscount };\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Alloy Apparel',\n\tdomain: 'alloyapparel.com',\n\tmaxCoupons: 10,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn !!document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { completionActions, format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst CART_URL = 'https://www.alternativeapparel.com/checkout/cart';\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: yes\n•    Free gift support: no\n•    ‘isValid’ implemented: no\n•    Manually apply code: no\n•    Active page: Cart\nOptional:\n•    Show message about free shipping on the cart page (without discount info): no\n•    Is driver SPA and add the condition to show popup: no\n•    Gather codes on site pages: no */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = '.-borderless:last-child .price';\n\t\tthis.TOTAL_EXCL_TAX_SELECTOR = '.-borderless:nth-last-of-type(2) .price';\n\t\tthis.TOTAL_INCL_TAX_SELECTOR = '.-borderless:nth-last-of-type(1) .price';\n\n\t\tthis.SUBTOTAL_SELECTOR = '.wsc__cart-price-subtotal .price';\n\n\t\tthis.REMOVE_COUPON_FORM_SELECTOR = '[id^=\"discount-coupon-cancel-form\"]';\n\t\tthis.APPLIED_CODES_SELECTOR = '.discount-coupon__applied .discount-coupon__code';\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'amcoupon_code_cancel';\n\t\tthis.REMOVE_REQUEST_EXTRA_VALUES = {};\n\n\t\tthis.STACKABLE = true;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst couponElementsArray = document.querySelectorAll(this.APPLIED_CODES_SELECTOR);\n\t\tconst codes = [...couponElementsArray].map(el => el.innerText);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst subtotal = elemToFloat(extractElement(this.SUBTOTAL_SELECTOR, response));\n\t\t\tconst total = elemToFloat(extractElement(this.TOTAL_INCL_TAX_SELECTOR, response));\n\t\t\t// can't get it in another way\n\t\t\tthis.TAX_TOTAL_VALUE = total - subtotal;\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(\n\t\t\tresponse => elemToFloat(extractElement(this.TOTAL_INCL_TAX_SELECTOR, response)) - this.TAX_TOTAL_VALUE,\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Alternative Apparel',\n\tdomain: 'alternativeapparel.com',\n\tcompletionAction: completionActions.revisit,\n\tmaxCoupons: 5, // block\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n};\n","import MagentoTemplate from './_base';\n\nconst BASE_URL = 'https://www.americanstationery.com/checkout';\nconst CART_URL = `${BASE_URL}/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/onepage`;\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    ‘isValid’ implemented: no\n•    Manually apply code: no\nOptional:\n•    Show message about free shipping on the cart page (without discount info): no\n•    Is driver SPA and add the condition to show popup: yes\n•    Gather codes on site pages: no */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.ITEM_CONTAINER_SELECTOR = null;\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isRightUrl = href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL);\n\t\tconst emptyCartElement = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst inputField = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\tconst currentState = isRightUrl && (inputField && inputField.offsetParent) && !emptyCartElement;\n\t\treturn currentState;\n\t}\n\n\tbeforeCheckCodes(originalPrice) {\n\t\tif (!originalPrice) {\n\t\t\t// on the checkout page we can't get original price so we need to get it from the cart page\n\t\t\treturn this._parseTotal(this.cartPageHTML);\n\t\t}\n\t\treturn originalPrice;\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0], this._getApplyRequestData(this.cartPageHTML));\n\t}\n};\n\nexport default {\n\tname: 'American Stationery Company',\n\tdomain: 'americanstationery.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport MagentoTemplate from './_base';\nimport { format, log } from '../../../utils';\n\nconst { toFloat } = format;\n\n/*\nDriver behavior description:\n+ IMPORTANT: Cannot get existing code, thats why, if user already has applied code, we show that he already has the best discount;\n+ Gather codes on site pages: depends on site updates (yes); In general on the top of the page.\n+ Existing code: no\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ Codes can be replaced by another code: no, need to remove code before applying a new one.\n+ Manually apply code: no\n+ Pages, where extension works:\nhttps://www.betabrand.com/cart/checkout;\nAlso in the menu that is sliding after the clicking on cart item.\n+ Is driver SPA yes\n*/\n\nconst BASE_URL = 'https://www.betabrand.com';\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = `${BASE_URL}/cart/checkout`;\n\t\tthis.APPLIED_CODES_SELECTOR = '#cart-discount';\n\t\tthis.SIDEBAR_SELECTOR = 'body.has-cart';\n\t\tthis.CART_COUNT_SELECTOR = '#cart-toggle :last-child';\n\t\tthis.TOTAL_SELECTOR = '.justified-list.ng-scope .fancy.h4';\n\t\tthis.DISCOUNT_LABEL_SELECTOR = '.discount-label';\n\t\tthis.MERCHANT_CODE_SELECTOR = '.skinny-nav .skinny-nav--right :first-child, .skinny-nav--message a';\n\t\tthis.CART_BUTTON_SELECTOR = '#cart-toggle';\n\t\tthis.MERCHANT_CODE_REGEX = /[A-Z]{2,}/;\n\t\tthis.USER_HAS_DISCOUNT = false;\n\t\tthis.CODE_TESTING_INPROGRESS = false;\n\t\tthis.interval = null;\n\t}\n\n\tcheckCondition() {\n\t\tconst totalAmountElement = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst sideBarElement = document.querySelector(this.SIDEBAR_SELECTOR);\n\t\tconst applyCodeInputElement = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\tconst cartCount = document.querySelector(this.CART_COUNT_SELECTOR);\n\t\treturn (\n\t\t\t(sideBarElement &&\n\t\t\t\tcartCount &&\n\t\t\t\tcartCount.textContent !== '0' &&\n\t\t\t\tapplyCodeInputElement &&\n\t\t\t\ttotalAmountElement &&\n\t\t\t\ttotalAmountElement.textContent) ||\n\t\t\t(window.location.href.startsWith(this.CART_URL) &&\n\t\t\t\tapplyCodeInputElement &&\n\t\t\t\ttotalAmountElement &&\n\t\t\t\ttotalAmountElement.textContent)\n\t\t);\n\t}\n\n\twatchForCartUrl() {\n\t\tsuper.watchForCartUrl();\n\t\tthis.interval = setInterval(() => this._checkUserTestingPlaceOnExisting(), 1000);\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst sidebarElement = document.querySelector(this.SIDEBAR_SELECTOR);\n\t\tconst discountElement = document.querySelector(this.DISCOUNT_LABEL_SELECTOR);\n\t\tthis.CODE_TESTING_INPROGRESS = true;\n\t\tif (discountElement) {\n\t\t\tthis.USER_HAS_DISCOUNT = true;\n\t\t}\n\t\tif (sidebarElement) {\n\t\t\tlocalStorage.setItem('CodeTestingPlace', JSON.stringify({ sidebar: true }));\n\t\t}\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst promoCodeText = document.querySelector(this.MERCHANT_CODE_SELECTOR).textContent;\n\t\tconst codes = [];\n\t\tif (promoCodeText && promoCodeText.length && promoCodeText.match(this.MERCHANT_CODE_REGEX)) {\n\t\t\tcodes.push(promoCodeText.match(this.MERCHANT_CODE_REGEX)[0]);\n\t\t}\n\t\treturn codes;\n\t}\n\n\tgetExistingCodes() {\n\t\treturn {\n\t\t\tcodes: [],\n\t\t\tcodeCount: 0,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode().then(responseJSON => ({ originalPrice: this._parseTotal(responseJSON) }));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog('originalPrice: %o', originalPrice);\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\tif (this.USER_HAS_DISCOUNT) {\n\t\t\t\tresult.isValid = false;\n\t\t\t\treturn Promise.delay(1500).then(() => bus.$emit('code-checked', result));\n\t\t\t}\n\t\t\treturn this._applyCode(code).then(resJSON => {\n\t\t\t\tif (resJSON && resJSON.messages && resJSON.messages.error) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tresult.finalPrice = this._parseTotal(resJSON);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\treturn this.removeCodes().then(() => bus.$emit('code-checked', result));\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(`${BASE_URL}/api/rest/coupon`, 'POST', JSON.stringify({ code }));\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode(`${BASE_URL}/api/rest/coupon/delete`, 'DELETE', null);\n\t}\n\n\t_manageCode(url, type, body) {\n\t\treturn fetch(url, {\n\t\t\tmethod: type,\n\t\t\tbody,\n\t\t\theaders: {\n\t\t\t\taccept: ' application/json, text/plain, */*',\n\t\t\t\t'content-type': 'application/json;charset=UTF-8',\n\t\t\t},\n\t\t}).then(result => result.json());\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\tlet totalAmount = 0;\n\t\t\tif (data && data.totals) {\n\t\t\t\tdata.totals.forEach(object => {\n\t\t\t\t\tif (object.code === 'grand_total') {\n\t\t\t\t\t\ttotalAmount = object.value;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn totalAmount;\n\t\t}\n\t\treturn toFloat(document.querySelector(this.TOTAL_SELECTOR).textContent);\n\t}\n\n\t_checkUserTestingPlaceOnExisting() {\n\t\tconst codeTestingPlace = localStorage.getItem('CodeTestingPlace');\n\t\tif (codeTestingPlace && !this.CODE_TESTING_INPROGRESS) {\n\t\t\tlocalStorage.removeItem('CodeTestingPlace');\n\t\t\tdocument.querySelector(this.CART_BUTTON_SELECTOR).click();\n\t\t\tclearInterval(this.interval);\n\t\t}\n\t}\n};\nexport default {\n\tname: 'Betabrand',\n\tdomain: 'betabrand.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { backgroundMessaging } from '../../lib';\nimport { format, DOM, log } from '../../../utils';\n\nconst { toFloat } = format;\nconst { extractElement } = DOM;\n\n/* Behavior description:\n\t+ Existing code: yes\n\t+ Remove code: yes\n\t+ Stackable: no\n\t+ Free gift support: yes\n\t+ ‘isValid’ implemented: yes\n\t+ Free shipping: no\n\t+ Is SPA: yes\n\t+ Gather code: yes (cart page)\n====Special cases:====\n\t+ allow 2 times per 10 min (due to 429 error(to many requests))\n\t+ on checkout maxCoupons: 10 (site works slow), on Cart page:15\n\t+ 404 error if code is not valid\n\t+ Sometimes site shows shipping value in total on cart, sometimes no, so we can see incorrect original price\n\ton sites page\n */\n\nconst DOMAIN = 'cjponyparts.com';\nconst BASE_URL = `https://www.${DOMAIN}/checkout`;\nconst BASE_REQUEST_URL = `https://www.${DOMAIN}/rest/default/V1`;\nconst CART_URL = `${BASE_URL}/cart`;\nconst IS_ON_PAYMENT = window.location.href.startsWith(`${BASE_URL}/#payment`);\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #discount-code';\n\t\tthis.TOTAL_SELECTOR = '.grand.totals .price';\n\t\tthis.TAX_SELECTOR = '.totals-tax';\n\t\tthis.SPINER_SELECTOR = '.loading-mask';\n\t\tthis.EMPTY_CART_SELECTOR = '#shopping-cart-empty-message';\n\t\tthis.MERCHANT_CODE_SELECTOR = '#header-banner-content';\n\t\tthis.AUTH_BUTTON_SELECTOR = '.authorization-link > a, .authentication-wrapper';\n\t\tthis.MERCHANT_CODE_REGEX = /code[\\s:-]*(\\w+)/i;\n\t\tthis.ENTITY_ID_REG = /entity_id\":\"(\\w+)/;\n\t\tthis.ENTITY_ID = null;\n\t\tthis.URL_STRING = null;\n\t\tthis.IS_PAYMENT = null;\n\t\tthis.DISABLE_TIME_MS = 10 * 60 * 1000; // 10 minutes\n\t}\n\n\tasync checkCondition() {\n\t\tconst { href } = window.location;\n\t\tlet isNotMaxCodeTesting = true;\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(DOMAIN);\n\t\tif (driverStorage) {\n\t\t\tconst dataExpired = Date.now() - driverStorage.lastTestTimestamp >= this.DISABLE_TIME_MS;\n\t\t\tif (dataExpired) {\n\t\t\t\tbackgroundMessaging.deleteDriverStorage(DOMAIN);\n\t\t\t} else {\n\t\t\t\tisNotMaxCodeTesting = driverStorage.codeTestingCount < 2;\n\t\t\t}\n\t\t}\n\t\tconst noSpiner = IS_ON_PAYMENT\n\t\t\t? document.querySelector(this.SPINER_SELECTOR) &&\n\t\t\t  document.querySelector(this.SPINER_SELECTOR).style.display === 'none'\n\t\t\t: true;\n\t\tconst isCartHref = href.startsWith(`${BASE_URL}/#payment`) || href.startsWith(CART_URL);\n\t\tconst isTotal = Boolean(document.querySelector(this.TOTAL_SELECTOR));\n\t\tconst isInput = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\treturn isNotMaxCodeTesting && isCartHref && isTotal && noSpiner && isInput && !isCartEmpty;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.MERCHANT_CODE_SELECTOR)]\n\t\t\t.map(item => item.textContent.match(this.MERCHANT_CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(item => item[1]);\n\t}\n\n\tbeforeTestCodes() {\n\t\t[, this.ENTITY_ID] = document.body.innerHTML.match(this.ENTITY_ID_REG);\n\t\tthis.IS_NOT_LOGGED_IN =\n\t\t\tdocument.querySelector(this.AUTH_BUTTON_SELECTOR) &&\n\t\t\tdocument.querySelector(this.AUTH_BUTTON_SELECTOR).style.display !== 'none' &&\n\t\t\tdocument\n\t\t\t\t.querySelector(this.AUTH_BUTTON_SELECTOR)\n\t\t\t\t.textContent.trim()\n\t\t\t\t.toLowerCase()\n\t\t\t\t.includes('sign in');\n\t\tthis.URL_STRING = this.IS_NOT_LOGGED_IN ? `guest-carts/${this.ENTITY_ID}` : 'carts/mine';\n\t\tthis.IS_PAYMENT = window.location.href.startsWith(`${BASE_URL}/#payment`);\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\treturn Promise.resolve()\n\t\t\t.then(() => (this.IS_PAYMENT ? this._getCodeFromCart() : false))\n\t\t\t.then(html => {\n\t\t\t\tconst codes = [extractElement(this.APPLIED_CODES_SELECTOR, html)]\n\t\t\t\t\t.map(element => element.defaultValue)\n\t\t\t\t\t.filter(Boolean);\n\n\t\t\t\treturn {\n\t\t\t\t\tcodes,\n\t\t\t\t\tcodeCount: codes.length,\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode()\n\t\t\t.then(() => this._getPrice())\n\t\t\t.then(responseJSON => this._parseTotal(responseJSON));\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this._parseTotal();\n\t}\n\n\tcheckCodes(codes, originalPrice) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(response => {\n\t\t\t\tif (response) {\n\t\t\t\t\treturn this._getPrice().then(responseJSON => {\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseJSON);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tresult.isValid = false;\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t});\n\t\t});\n\t}\n\n\tasync beforeApplyCodes() {\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(DOMAIN);\n\t\tconst codeTestingCount = driverStorage ? driverStorage.codeTestingCount : 0;\n\t\tbackgroundMessaging.setDriverStorage(DOMAIN, {\n\t\t\tcodeTestingCount: codeTestingCount + 1,\n\t\t\tlastTestTimestamp: Date.now(),\n\t\t});\n\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\treturn Promise.resolve();\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode('DELETE');\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode('PUT', code);\n\t}\n\n\t_manageCode(method, code = '') {\n\t\treturn fetch(`${BASE_REQUEST_URL}/${this.URL_STRING}/coupons/${code}`, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'content-type': 'application/json',\n\t\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t},\n\t\t}).then(response => (response.status !== 404 ? response.json() : false));\n\t}\n\n\t_getPrice() {\n\t\treturn fetch(`${BASE_REQUEST_URL}/${this.URL_STRING}/payment-information`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'content-type': 'application/json',\n\t\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t},\n\t\t}).then(response => response.json());\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn toFloat(data.totals.base_grand_total);\n\t\t}\n\t\treturn this._getPrice().then(res => toFloat(res.totals.base_grand_total));\n\t}\n\n\t_getCodeFromCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'CJ Pony Parts',\n\tdomain: 'cjponyparts.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tshowDifferentDiscountMessage: true,\n\tmaxCoupons: IS_ON_PAYMENT ? 10 : 15, // works slow on checkout\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport { sessionTimer } from '../../lib';\n\nconst BASE_URL = 'https://www.clearbags.com/checkout';\n\n/* Behaviour description:\n-    Existing code: yes / no\n-    Remove code: yes\n-    Stackable: no\n-    Free gift support: yes\n-    ‘isValid’ implemented: no\nOptional:\n-\t sessionTimer 15 min\n-    Is driver SPA and add the condition to show popup: yes (run on cart and checkout(user data will be erased),\n\t\tno empty cart, total and code input field are present)\n */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = `${BASE_URL}/cart/`;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #discount-code';\n\t\tthis.TOTAL_SELECTOR = '.grand .price, .grand.totals .price';\n\t\tthis.ITEM_CONTAINER_SELECTOR = '#shopping-cart-table .cart, #opc-sidebar .minicart-items .product-item';\n\n\t\tthis.INPUT_CODE_SELECTOR = '.cart-discount, #discount-code';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /grand_total\":\"(\\d+\\.\\d+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = '';\n\t\t};\n\n\t\tthis.NEED_REMOVE_CODE = false;\n\t}\n\n\tcheckCondition() {\n\t\tconst totalValue = document.querySelector(this.TOTAL_SELECTOR);\n\n\t\tconst isInputElement = document.querySelector(this.INPUT_CODE_SELECTOR);\n\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst correctPage = window.location.href.startsWith(BASE_URL);\n\n\t\tconst currentState = totalValue && isInputElement && correctPage && !emptyCart;\n\t\treturn currentState;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\tthis.afterCodeCheck();\n\t\treturn this._applyCode(codes[0], this._getApplyRequestData(this.cartPageHTML)).then(() => {\n\t\t\t// for cleaning error messages after applying code\n\t\t\tconst iframeElem = document.createElement('iframe');\n\t\t\tiframeElem.src = 'https://www.clearbags.com/';\n\t\t\tObject.assign(iframeElem.style, { display: 'none' });\n\t\t\tdocument.documentElement.appendChild(iframeElem);\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'ClearBags',\n\tdomain: 'clearbags.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { toFloat, elemToFloat } = format;\n\nconst BASE_URL = 'https://store.coffeebean.com';\nconst CHECKOUT_URL = `${BASE_URL}/checkout`;\nconst CART_URL = `${CHECKOUT_URL}/cart`;\nconst BASE_REQUEST_URL = `${BASE_URL}/rest/default/V1`;\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - can't apply without removing\n * - can apply one code (not stackable)\n * - sessionTimer 15min\n * - isValid: yes,\n * - gift: no\n * - support cart and checkout page(user will lost payment data)\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#discount_code';\n\t\tthis.TOTAL_SELECTOR = '[data-th$=Total] .price';\n\t\tthis.CODE_INPUT_SELECTOR = '[name=\"coupon_code\"], [name=\"discount_code\"]';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#discount-form .action-apply';\n\t\tthis.CANCEL_BUTTON_SELECTOR = '#discount-form .action-cancel';\n\n\t\tthis.ENTITY_ID_SELECTOR = new RegExp(/\"entity_id\":\"(.*?)\"/);\n\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.requestData = null;\n\t\tthis.updatedUrl = null;\n\t}\n\n\tcheckCondition() {\n\t\tconst totalElement = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst currentState = totalElement && codeInput;\n\t\treturn currentState;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst entityId = [...document.querySelectorAll('script')]\n\t\t\t.find(element => element.text.match(this.ENTITY_ID_SELECTOR))\n\t\t\t.text.match(this.ENTITY_ID_SELECTOR)[1];\n\t\tif (!JSON.parse(localStorage.getItem('mage-cache-storage')).customer.firstname) {\n\t\t\tthis.requestData = {\n\t\t\t\taction: `${BASE_REQUEST_URL}/guest-carts/${entityId}/coupons/`,\n\t\t\t};\n\t\t\tthis.updatedUrl = `${BASE_REQUEST_URL}/guest-carts/${entityId}/payment-information`;\n\t\t} else {\n\t\t\tthis.requestData = {\n\t\t\t\taction: `${BASE_REQUEST_URL}/carts/mine/coupons/`,\n\t\t\t};\n\t\t\tthis.updatedUrl = `${BASE_REQUEST_URL}/carts/mine/payment-information`;\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getUpdatedCart().then(responseJSON => {\n\t\t\tconst codes = [responseJSON.totals.coupon_code].filter(Boolean);\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode()\n\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t.then(responseString => this._parseTotal(responseString));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code)\n\t\t\t\t.then(responseJSON =>\n\t\t\t\t\tObject.prototype.hasOwnProperty.call(responseJSON, 'message') ? null : this._getUpdatedCart(),\n\t\t\t\t)\n\t\t\t\t.then(responseJSON => {\n\t\t\t\t\tif (responseJSON) {\n\t\t\t\t\t\tconst finalPrice = this._parseTotal(responseJSON);\n\t\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\t\treturn this._removeCode().then(() =>\n\t\t\t\t\t\t\tbus.$emit('code-checked', {\n\t\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\t\t\tisValid: true,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn bus.$emit('code-checked', {\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t\tisValid: false,\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t);\n\t}\n\n\tbeforeApplyCodes() {\n\t\t// Clear this cookie to remove 'applied code' messages\n\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\treturn Promise.resolve();\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await this._getUpdatedCart();\n\t\tconst total = this._parseTotal(cartStr);\n\t\treturn total - parseFloat(cartStr.totals.base_shipping_incl_tax);\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(`${this.requestData.action}${code}`, 'PUT').then(responseJSON => responseJSON.json());\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode(this.requestData.action, 'DELETE');\n\t}\n\n\t_manageCode(requestURL, method) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t});\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn toFloat(data.totals.base_grand_total);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(this.updatedUrl, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t}).then(responseJSON => responseJSON.json());\n\t}\n};\n\nexport default {\n\tname: 'Coffee Bean & Tea Leaf',\n\tdomain: 'coffeebean.com',\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import MagentoTemplate from './_base';\nimport { DOM } from '../../../utils';\n\nconst { extractData } = DOM;\n\nconst CART_URL = 'https://www.dailysale.com/checkout/cart';\nconst STACKABLE = false;\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #discount-code';\n\t\tthis.TOTAL_SELECTOR = '.grand.totals strong .price';\n\t\tthis.FORM_KEY_SELECTOR = '[name=\"form_key\"]';\n\n\t\tthis.STACKABLE = STACKABLE;\n\t\tthis.NEED_REMOVE_CODE = false;\n\n\t\tthis.APPLY_REQUEST_EXTRA_VALUES = {\n\t\t\tremove: 0,\n\t\t};\n\n\t\tthis.REMOVE_REQUEST_EXTRA_VALUES = {\n\t\t\tremove: 1,\n\t\t};\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /\"grand_total\":\"(\\d+,*\\d+.\\d+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\n\t\tthis.VALID_CHECKOUT_PAGE = false;\n\t}\n\n\tcheckCondition() {\n\t\tconst totalValue = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst isInput = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\treturn totalValue && isInput;\n\t}\n\n\tbeforeTestCodes() {\n\t\treturn super.beforeTestCodes().then(() => {\n\t\t\tconst formKey = extractData(this.FORM_KEY_SELECTOR, this.cartPageHTML, false, 'value');\n\t\t\tthis.APPLY_REQUEST_EXTRA_VALUES.form_key = formKey;\n\t\t\tthis.REMOVE_REQUEST_EXTRA_VALUES.form_key = formKey;\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'dailysale',\n\tdomain: 'dailysale.com',\n\tDriver,\n\tmaxCoupons: 10, // due to code testing duration\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { log, format, DOM } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/* Behavior description:\n- we can apply code;\n- we can remove code;\n- we can apply only one code (not stackable);\n- we can apply code only on cart page;\n- sometimes we cannot get the correct response from the server, and we need additional recursive requests\nbut if the number of requests is 4, we mark the codes as invalid\n*/\n\nconst CART_URL = 'https://www.dellrefurbished.com/checkout/cart';\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.ERROR_SELECTOR = '.error-msg';\n\t\tthis.recursiveCount = 0;\n\t\tthis.IS_INVALID = false;\n\t\tthis.ORDER_SUMMARY_SELECTOR = '#shopping-cart-totals-table tr';\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0], this._getApplyRequestData(this.cartPageHTML)).then(() => {\n\t\t\t// for cleaning error messages after applying code (can’t avoid applying invalid code on checkout)\n\t\t\tconst iframeElem = document.createElement('iframe');\n\t\t\tiframeElem.src = CART_URL;\n\t\t\tObject.assign(iframeElem.style, { display: 'none' });\n\t\t\tdocument.documentElement.appendChild(iframeElem);\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\t\t\t\tif (!extractElement(this.ERROR_SELECTOR, responseString) && !this.IS_INVALID) {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseString);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst getSummaryValue = regex => {\n\t\t\t\tconst valueElement = [...extractElement(this.ORDER_SUMMARY_SELECTOR, responseHTML, true)].find(\n\t\t\t\t\telement => regex.test(element.textContent),\n\t\t\t\t);\n\n\t\t\t\treturn valueElement ? elemToFloat(valueElement.querySelector('td span.price')) : 0;\n\t\t\t};\n\t\t\tconst shipping = getSummaryValue(/shipping/i);\n\t\t\tconst tax = getSummaryValue(/tax/i);\n\n\t\t\treturn this._parseTotal(responseHTML) - shipping - tax;\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_applyCode(code, requestData) {\n\t\trequestData.params.set(this.APPLY_CODE_PARAM_NAME, code);\n\t\treturn this._manageCode(requestData.action, requestData.params).then(responseHTML => {\n\t\t\tif (!extractElement(this.TOTAL_SELECTOR, responseHTML) && this.recursiveCount < 5) {\n\t\t\t\tthis.recursiveCount = this.recursiveCount === 4 ? 'expired' : this.recursiveCount + 1;\n\t\t\t\treturn this._applyCode(code, requestData);\n\t\t\t}\n\t\t\tif (!extractElement(this.TOTAL_SELECTOR, responseHTML) && this.recursiveCount === 'expired') {\n\t\t\t\tthis.IS_INVALID = true;\n\t\t\t\treturn responseHTML;\n\t\t\t}\n\t\t\tthis.IS_INVALID = false;\n\t\t\tthis.recursiveCount = 0;\n\t\t\treturn responseHTML;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Dell Refurbished',\n\tdomain: 'dellrefurbished.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('#coupon_code');\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format, DOM, log } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst CART_URL = 'https://www.draperjames.com/checkout/cart';\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - valid code can be replaced with another valid code\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code';\n\t\tthis.TOTAL_SELECTOR = '.table-total tr:last-child td:last-child';\n\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0], this._getRemoveRequestData(this.cartPageHTML)).then(responseJson =>\n\t\t\tthis._parseTotal(responseJson),\n\t\t);\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseJson => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\t\t\t\tif (responseJson.html_totals) {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseJson);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t);\n\t}\n\n\t_manageCode(requestURL, bodyObj) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\tbody: bodyObj,\n\t\t}).then(response => response.json());\n\t}\n\n\t_parseTotal(data) {\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, data && data.html_totals));\n\t}\n};\n\nexport default {\n\tname: 'DraperJames',\n\tdomain: 'draperjames.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { sessionTimer } from '../../lib';\n\nconst BASE_URL = 'https://www.dtlr.com/checkout';\nconst CART_URL = `${BASE_URL}/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/#payment`;\n\n/** Behavior description:\n * - existing code: yes\n * - remove code: yes\n * - stackable: no\n * - free gift support: no\n * - free shipping: no\n * - 'isValid' implemented: no\n * - manually apply code: no\n * - replace code: no\n * - extension works on Cart and Checkout(Payment step)\n * - is driver SPA: yes\n *   - is on Cart or Checkout(payment) url\n *   - Cart isn't empty\n *   - total price element present\n * - gather codes on site pages: no\n * - credentials (joseph@gmail.com, 12345qwertyQ)\n * - sessionTimer: 15 min\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.IS_ON_CART = window.location.href.toLowerCase().startsWith(CART_URL);\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.input-box strong, .coupon strong, .totals.discount span.discount.coupon';\n\t\tthis.TOTAL_SELECTOR = 'strong .price';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /grand_total\":\"(\\d+\\.\\d+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\t}\n\n\tcheckCondition() {\n\t\tconst emptyCartElement = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isRightUrl = this.IS_ON_CART || window.location.href.toLowerCase().startsWith(CHECKOUT_URL);\n\t\tconst totalPriceElement = document.querySelector(this.TOTAL_SELECTOR);\n\t\treturn isRightUrl && totalPriceElement && !emptyCartElement;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(codeElement => codeElement.innerText)\n\t\t\t.filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: 'DTLR-VILLA',\n\tdomain: 'dtlr.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import MagentoTemplate from './_base';\n\n/*\nBehavior description:\n- can get existing codes;\n- can apply code;\n- can remove codes;\n- can't apply multiple codes (not stackable);\n- code testing may be run on 'Cart' page;\n======== Special case ========\nWe create iframe with current page after codes testing\nto avoid showing error messages after page reload;\n*/\n\nconst CART_URL = 'https://www.eastwood.com/checkout/cart';\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code';\n\t\tthis.TOTAL_SELECTOR = '#totals_grand_total .price';\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0], this._getApplyRequestData(this.cartPageHTML)).then(() => this._createIframe());\n\t}\n\n\t_createIframe() {\n\t\tconst iframe = document.createElement('iframe');\n\t\tiframe.setAttribute('src', `${window.location.href}?demo=1`);\n\t\tiframe.setAttribute('style', 'display: none;');\n\t\tdocument.body.appendChild(iframe);\n\t}\n};\n\nexport default {\n\tname: 'Eastwood',\n\tdomain: 'eastwood.com',\n\tDriver,\n\tmaxCoupons: 8, // site is little slow\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format, log, DOM } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout(user can avoid Cart)\n+ Is driver SPA: yes\n+ Gather codes on site pages: yes (on current page)\n+ Session timer: 15min\n+ Restore user data: yes\n*/\n\nconst BASE_URL = 'https://www.easyspirit.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = '.grand.totals.incl .price';\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #discount-code';\n\t\tthis.CODE_INPUT_SELECTOR = this.APPLIED_CODES_SELECTOR;\n\n\t\tthis.SHIPPING_OPTIONS_SELECTOR = '.methods-shipping .radioparent .radio';\n\n\t\tthis.isOnCart = window.location.href.startsWith(CART_URL);\n\n\t\tthis.QUOTE_ID_SELECTOR = '#gift-options-cart script, #checkout script';\n\t\tthis.QUOTE_ID_REGEXP = /(entity_id|quoteId)\":\"([A-Za-z0-9]+)(?=\")/;\n\n\t\tthis.BANNER_SELECTOR = '.ambanners a';\n\t\tthis.MERCHANT_CODE_REGEX = /use code (\\w+)/i;\n\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.bodyData = null;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst isOnHref = window.location.href.startsWith(`${BASE_URL}/checkout`);\n\t\tconst totalElement = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\treturn totalElement && codeInput && isOnHref;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.userIsLogged = this._getWindowObjectData('window.checkoutConfig.isCustomerLoggedIn');\n\t\tif (this.userIsLogged) {\n\t\t\tthis.quoteId = 'mine';\n\t\t} else {\n\t\t\t[, , this.quoteId] = extractElement(this.QUOTE_ID_SELECTOR).textContent.match(this.QUOTE_ID_REGEXP);\n\t\t}\n\t\tif (this.isOnCart) {\n\t\t\tconst bodyData = this._getWindowObjectData('window.checkoutConfig.selectedShippingMethod');\n\t\t\tconst bodyDataAddress = { countryId: 'US', postcode: '*', regionId: '0' };\n\n\t\t\tthis.bodyData = {\n\t\t\t\taddressInformation: {\n\t\t\t\t\taddress: bodyDataAddress,\n\t\t\t\t\tshipping_method_code: bodyData ? bodyData.method_code : '',\n\t\t\t\t\tshipping_carrier_code: bodyData ? bodyData.carrier_code : '',\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.BANNER_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR).value].filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode();\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this._getTotalInfo().then(responseJson => ({\n\t\t\toriginalPrice: this._parseTotal(responseJson),\n\t\t\toriginalItemsCount: this._parseItemsCount(responseJson),\n\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(), originalItemsCount = this._parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tfreeGifts: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tif (!responseJSON.message) {\n\t\t\t\t\treturn this._getTotalInfo().then(response => {\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tresult.freeGifts = this._parseItemsCount(response) - originalItemsCount;\n\t\t\t\t\t\tresult.isValid = true;\n\n\t\t\t\t\t\treturn this._removeCode().then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getTotalInfo().then(response => {\n\t\t\tconst totals = response.totals || response;\n\t\t\tconst shipping = toFloat(totals.shipping_amount);\n\t\t\tconst tax = toFloat(totals.tax_amount);\n\t\t\treturn this._parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn this._isShippingOptionsElement();\n\t}\n\n\tgetUserData() {\n\t\tif (!this._isShippingOptionsElement()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst checkedShippingElement = [...document.querySelectorAll(this.SHIPPING_OPTIONS_SELECTOR)].find(\n\t\t\telement => element.checked,\n\t\t);\n\t\treturn {\n\t\t\tshippingSelector: `#${checkedShippingElement.getAttribute('id')}`,\n\t\t};\n\t}\n\n\tsetUserData(userData) {\n\t\tdocument.querySelector(userData.shippingSelector).click();\n\t}\n\n\t_isShippingOptionsElement() {\n\t\treturn document.querySelector(`${this.SHIPPING_OPTIONS_SELECTOR}:checked`);\n\t}\n\n\t_getTotalInfo() {\n\t\tif (this.isOnCart) {\n\t\t\treturn fetch(\n\t\t\t\t`${BASE_URL}/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\t\tthis.quoteId\n\t\t\t\t}/totals-information`,\n\t\t\t\t{\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcredentials: 'include',\n\t\t\t\t\tbody: JSON.stringify(this.bodyData),\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t).then(response => response.json());\n\t\t}\n\t\treturn fetch(\n\t\t\t`${BASE_URL}/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\tthis.quoteId\n\t\t\t}/payment-information`,\n\t\t\t{\n\t\t\t\tmethod: 'GET',\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t},\n\t\t\t},\n\t\t).then(response => response.json());\n\t}\n\n\t_manageCode(method, code = '') {\n\t\treturn fetch(\n\t\t\t`${BASE_URL}/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\tthis.quoteId\n\t\t\t}/coupons/${code}`,\n\t\t\t{\n\t\t\t\tmethod,\n\t\t\t\tcredentials: 'include',\n\t\t\t\tbody: JSON.stringify(this.bodyData),\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t},\n\t\t\t},\n\t\t).then(response => response.json());\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode('PUT', code);\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode('DELETE');\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn this.isOnCart ? toFloat(data.grand_total) : toFloat(data.totals.grand_total);\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR));\n\t}\n\n\t_parseItemsCount(data) {\n\t\tif (data) {\n\t\t\treturn this.isOnCart ? toFloat(data.items_qty) : toFloat(data.totals.items_qty);\n\t\t}\n\t\treturn document.querySelectorAll(this.ITEM_COUNT_SELECTOR).length;\n\t}\n\n\t_getApplyRequestData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t_getWindowObjectData(variableString) {\n\t\t// We will put generated request payload to this element\n\t\tconst requestDataElement = document.createElement('div');\n\t\trequestDataElement.id = 'get-data-genie';\n\t\tObject.assign(requestDataElement.style, { display: 'none' });\n\n\t\tdocument.documentElement.appendChild(requestDataElement);\n\n\t\t// Script which will generate request payload\n\t\tconst requestDataScript = document.createElement('script');\n\t\trequestDataScript.textContent = `document.getElementById(\"${\n\t\t\trequestDataElement.id\n\t\t}\").innerText = JSON.stringify(${variableString});`;\n\t\tdocument.documentElement.appendChild(requestDataScript);\n\t\tconst data = JSON.parse(requestDataElement.innerText);\n\t\t// Remove created blocks\n\t\trequestDataElement.parentNode.removeChild(requestDataElement);\n\t\trequestDataScript.parentNode.removeChild(requestDataScript);\n\t\treturn data;\n\t}\n};\n\nexport default {\n\tname: 'Easy Spirit',\n\tdomain: 'easyspirit.com',\n\tDriver,\n\tisSinglePageApp: true,\n\trestoreUserData: true,\n};\n","import MagentoTemplate from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { toFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nDriver behavior description:\n\t+ Existing code: yes\n\t+ Remove code: yes\n\t+ Stackable: no\n\t+ Free gift support: yes\n\t+ Free shipping: no\n\t+ ‘isValid’ implemented: yes\n\t+ Replace code: yes\n\t+ Pages, where extension works:\n\t\t- Cart page\n\t\t- Checkout (payment step)\n\t+ Is driver SPA: yes\n\t+ Gather codes on site pages: no\n\t+ Special case about the driver works (if it needed).\n\t\t- maxCoupons: 5\n\t\t- No remove button on checkout page, but extension works as expected.\n*/\nconst BASE_URL = 'https://www.eileenfisher.com/checkout';\nconst CART_URL = `${BASE_URL}/cart`;\nconst IS_ON_CART = window.location.href.startsWith(CART_URL);\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.APPLIED_CODES_SELECTOR = '.remove-coupon span, #coupon_code, #discount-code';\n\t\tthis.TOTAL_SELECTOR = '.grand .price, .grand.totals .price';\n\t\tthis.ITEM_CONTAINER_SELECTOR = IS_ON_CART ? '#shopping-cart-table tbody' : '.product-image-container';\n\t\tthis.EXISTING_CODE_REGEX = /applied: (\\w+)/i;\n\t\tthis.SHIPPING_VALUE_REGEX = /Shipping & Handling \\(.+\\)\",\"value\":\"(\\d+\\.\\d+)/i;\n\t\tthis.TAX_VALUE_REGEX = /\"Tax\",\"value\":\"([0-9.-]+)/i;\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /\"Grand Total\",\"value\":\"([0-9.-]+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t\tthis.itemsCountRegExp = {\n\t\t\tregexObj: /items_count\":\"(\\d+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'remove_coupon';\n\t\tthis.afterCodeCheck = () => {\n\t\t\tdocument.cookie = `mage-messages= ;domain=www.eileenfisher.com;path=/`;\n\t\t};\n\t}\n\n\tcheckCondition() {\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isOnCartUrl =\n\t\t\twindow.location.href.startsWith(CART_URL) || window.location.href.startsWith(`${BASE_URL}/#payment`);\n\t\tconst isCodeInput = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\treturn isOnCartUrl && !isCartEmpty && isTotal && isCodeInput;\n\t}\n\n\tasync getExistingCodes() {\n\t\tconst resHtml = IS_ON_CART ? false : await this._getUpdatedCart();\n\t\treturn {\n\t\t\tcodes: [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...extractElement(this.APPLIED_CODES_SELECTOR, resHtml, true)]\n\t\t\t\t\t\t.map(item => item.textContent.match(this.EXISTING_CODE_REGEX))\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.map(code => code[1]),\n\t\t\t\t),\n\t\t\t],\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst shippingElem = responseHTML.match(this.SHIPPING_VALUE_REGEX);\n\t\t\tconst shipping = shippingElem ? toFloat(shippingElem[1]) : 0;\n\t\t\tconst taxElem = responseHTML.match(this.TAX_VALUE_REGEX);\n\t\t\tconst tax = taxElem ? toFloat(taxElem[1]) : 0;\n\t\t\treturn this._parseTotal(responseHTML) - tax - shipping;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'EILEEN FISHER',\n\tdomain: 'eileenfisher.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tmaxCoupons: 5, // site works slow\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\n\n/** Behavior description:\n * can get existing code\n * can remove code\n * valid code can be replaced with another valid or invalid code\n * isn' stackable\n * code can be applied on cart page and on payment page\n * */\n\nconst BASE_URL = 'https://www.elaineturner.com/checkout';\nconst CART_URL = `${BASE_URL}/cart`;\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = '.grand.totals .price';\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /grand_total\":\"(\\d+\\.\\d+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\t}\n\n\twatchForCartUrl() {\n\t\tlet lastState = false;\n\t\tsetInterval(() => {\n\t\t\tconst { href } = window.location;\n\t\t\tconst isCartHref = href.startsWith(`${BASE_URL}/#payment`) || href.startsWith(CART_URL);\n\t\t\tconst isTotal = Boolean(document.querySelector(this.TOTAL_SELECTOR));\n\t\t\tconst currentState = isCartHref && isTotal;\n\t\t\tif (lastState !== currentState) {\n\t\t\t\tbus.$emit(!lastState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tlastState = currentState;\n\t\t}, 1000);\n\t}\n\n\t// remove _removeCodes() in order to reduce number of queries\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\treturn bus.$emit('code-checked', { code, finalPrice, finalDiscount });\n\t\t\t}),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Elaine Turner',\n\tdomain: 'elaineturner.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(`${BASE_URL}/#payment`) || href.startsWith(CART_URL);\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format, DOM, log } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst CART_URL = 'https://fractureme.com/cart';\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - valid code can`t be replaced with another valid code\n * - can`t apply multiple codes (stackable)\n *\n * - but we can have two types of codes first we can remove, another - can't. So I take all codes from page\n * */\n/*    eslint class-methods-use-this: [\"error\", { \"exceptMethods\": [\"_getSummary\", \"_manageCode\"] }] */\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#js-cart-items [class*=js-item-coupon-]';\n\t\tthis.APPLIED_CODE_REGEXP = /-coupon-([A-Za-z0-9_]*)\\s/;\n\t\tthis.TOTAL_SELECTOR = '.cart-subtotal-price';\n\n\t\tthis.REMOVE_CODE_REGEXP = /-([A-Za-z0-9]*)/g;\n\n\t\tthis.bodyData = new URLSearchParams();\n\t\tthis.APPLY_COUPON_FORM_SELECTOR = '#discount-coupon-form';\n\t\tthis.APPLY_CODE_PARAM_NAME = 'coupon_code';\n\n\t\tthis.CART_REGEX = /https:\\/\\/fractureme.com\\/(|\\/)cart/;\n\t\tthis.IS_ON_CART = this.CART_REGEX.test(window.location.href);\n\t\tthis.CURRENT_STATE = '#js-apply-coupon-input';\n\t}\n\n\twatchForCartUrl() {\n\t\tlet lastState = false;\n\t\tsetInterval(() => {\n\t\t\tif (this.IS_ON_CART) {\n\t\t\t\tconst currentState = Boolean(document.querySelector(this.CURRENT_STATE).offsetParent);\n\t\t\t\tif (lastState !== currentState) {\n\t\t\t\t\tbus.$emit(!lastState ? 'cart-active' : 'cart-inactive');\n\t\t\t\t}\n\t\t\t\tlastState = currentState;\n\t\t\t}\n\t\t}, 1000);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(element => element.className.match(this.APPLIED_CODE_REGEXP))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\tconst removeId = this._getRemoveCode();\n\t\treturn Promise.each(removeId, id => this._removeCode(id));\n\t}\n\n\tcheckCodes(codes) {\n\t\tlet originalPrice = null;\n\t\treturn this._getSummary()\n\t\t\t.then(responseText => {\n\t\t\t\toriginalPrice = this._parseTotal(responseText, true);\n\t\t\t\tlog(`Original price: ${originalPrice}`);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t\tPromise.each(codes, code =>\n\t\t\t\t\tthis._applyCode(code).then(responseJSON => {\n\t\t\t\t\t\tconst result = {\n\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (!responseJSON.error) {\n\t\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseJSON);\n\t\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\t\t\treturn this._getSummary()\n\t\t\t\t\t\t\t\t.then(responseHTML => this._removeCode(this._getRemoveCode(responseHTML)))\n\t\t\t\t\t\t\t\t.then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_getSummary() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_getRemoveCode(data = document.documentElement.innerHTML) {\n\t\tconst codes = [...extractElement(this.APPLIED_CODES_SELECTOR, data, true)].map(el =>\n\t\t\tel.getAttribute('data-id'),\n\t\t);\n\t\treturn codes;\n\t}\n\n\t_manageCode(url, bodyData, header) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: header,\n\t\t\tcredentials: 'include',\n\t\t\tbody: bodyData,\n\t\t}).then(response => response.json());\n\t}\n\n\t_removeCode(data) {\n\t\tconst headers = {\n\t\t\tAccept: 'application/json, text/javascript, */*; q=0.01',\n\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t};\n\t\treturn this._manageCode(`${CART_URL}/update_item/remove/${data}`, null, headers);\n\t}\n\n\t_applyCode(code) {\n\t\tthis.bodyData.set('coupon_name', code);\n\t\treturn this._manageCode(`${CART_URL}/add_coupon`, this.bodyData);\n\t}\n\n\t_parseTotal(data, text = false) {\n\t\treturn text ? elemToFloat(extractElement(this.TOTAL_SELECTOR, data)) : toFloat(data.cart_total);\n\t}\n};\n\nexport default {\n\tname: 'Fracture',\n\tdomain: 'fractureme.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n\t// no need to write isCartEmpty() because we have isSinglePageApp\n};\n","import MagentoTemplate from './_base';\n\nconst CART_URL = 'https://www.g2play.net/checkout/cart';\n\n/** Behavior description:\n * We can apply only one code\n * We can remove existing code\n * We can get existing code\n * We can apply codes only on cart page\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table .grand_total .price';\n\t\tthis.NEED_REMOVE_CODE = true;\n\t}\n};\n\nexport default {\n\tname: 'G2 Play',\n\tdomain: 'g2play.net',\n\tDriver,\n\tmaxCoupons: 8,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('#coupon_code');\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format, log, DOM } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst BASE_URL = 'https://www.goggles4u.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #discount-code';\n\t\tthis.TOTAL_SELECTOR = '.grand.totals .price';\n\n\t\tthis.NEED_REMOVE_CODE = false;\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\n\t\tthis.QUOTE_ID_REGEXP = /entity_id\":\"([A-Za-z0-9]+)(?=\")/;\n\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.bodyData = null;\n\t}\n\n\tcheckCondition() {\n\t\tconst totalValue = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst correctPage = window.location.href.startsWith(BASE_URL);\n\n\t\treturn totalValue && correctPage;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.userIsLogged = this._getWindowObjectData('window.checkoutConfig.isCustomerLoggedIn');\n\t\tif (this.userIsLogged) {\n\t\t\tthis.quoteId = 'mine';\n\t\t} else {\n\t\t\tconst quoteScript = [...document.scripts].find(el => el.text.match(this.QUOTE_ID_REGEXP));\n\t\t\t[, this.quoteId] = quoteScript.text.match(this.QUOTE_ID_REGEXP);\n\t\t}\n\t\tif (window.location.href.startsWith(CART_URL)) {\n\t\t\tconst bodyData = this._getWindowObjectData('window.checkoutConfig.selectedShippingMethod');\n\t\t\tconst bodyDataAddress = { countryId: 'US', postcode: '*', regionId: '0' };\n\n\t\t\tthis.bodyData = {\n\t\t\t\taddressInformation: {\n\t\t\t\t\taddress: bodyDataAddress,\n\t\t\t\t\tshipping_method_code: bodyData ? bodyData.method_code : '',\n\t\t\t\t\tshipping_carrier_code: bodyData ? bodyData.carrier_code : '',\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR).value].filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode();\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this._getTotalInfo().then(responseJson => ({\n\t\t\toriginalPrice: this._parseTotal(responseJson),\n\t\t\toriginalItemsCount: this._parseItemsCount(responseJson),\n\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(), originalItemsCount = this._parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tfreeGifts: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tif (!responseJSON.message) {\n\t\t\t\t\treturn this._getTotalInfo().then(response => {\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tresult.freeGifts = this._parseItemsCount(response) - originalItemsCount;\n\t\t\t\t\t\tresult.isValid = true;\n\n\t\t\t\t\t\treturn this._removeCode().then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t});\n\t\t});\n\t}\n\n\t_getTotalInfo() {\n\t\tif (window.location.href.startsWith(CART_URL)) {\n\t\t\treturn fetch(\n\t\t\t\t`${BASE_URL}/rest/g4u/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\t\tthis.quoteId\n\t\t\t\t}/totals-information`,\n\t\t\t\t{\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcredentials: 'include',\n\t\t\t\t\tbody: JSON.stringify(this.bodyData),\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t).then(response => response.json());\n\t\t}\n\t\treturn fetch(\n\t\t\t`${BASE_URL}/rest/g4u/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\tthis.quoteId\n\t\t\t}/payment-information`,\n\t\t\t{\n\t\t\t\tmethod: 'GET',\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t},\n\t\t\t},\n\t\t).then(response => response.json());\n\t}\n\n\t_manageCode(method, code = '') {\n\t\treturn fetch(\n\t\t\t`${BASE_URL}/rest/g4u/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${this.quoteId}/coupons/${code}`,\n\t\t\t{\n\t\t\t\tmethod,\n\t\t\t\tcredentials: 'include',\n\t\t\t\tbody: JSON.stringify(this.bodyData),\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t},\n\t\t\t},\n\t\t).then(response => response.json());\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode('PUT', code);\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode('DELETE');\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn window.location.href.startsWith(CART_URL)\n\t\t\t\t? toFloat(data.grand_total)\n\t\t\t\t: toFloat(data.totals.grand_total);\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR));\n\t}\n\n\t_parseItemsCount(data) {\n\t\tif (data) {\n\t\t\treturn window.location.href.startsWith(CART_URL) ? toFloat(data.items_qty) : toFloat(data.totals.items_qty);\n\t\t}\n\t\treturn document.querySelectorAll(this.ITEM_COUNT_SELECTOR).length;\n\t}\n\n\t_getApplyRequestData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t_getWindowObjectData(variableString) {\n\t\t// We will put generated request payload to this element\n\t\tconst requestDataElement = document.createElement('div');\n\t\trequestDataElement.id = 'get-data-genie';\n\t\tObject.assign(requestDataElement.style, { display: 'none' });\n\n\t\tdocument.documentElement.appendChild(requestDataElement);\n\n\t\t// Script which will generate request payload\n\t\tconst requestDataScript = document.createElement('script');\n\t\trequestDataScript.textContent = `document.getElementById(\"${\n\t\t\trequestDataElement.id\n\t\t}\").innerText = JSON.stringify(${variableString});`;\n\t\tdocument.documentElement.appendChild(requestDataScript);\n\t\tconst data = JSON.parse(requestDataElement.innerText);\n\t\t// Remove created blocks\n\t\trequestDataElement.parentNode.removeChild(requestDataElement);\n\t\trequestDataScript.parentNode.removeChild(requestDataScript);\n\t\treturn data;\n\t}\n};\n\nexport default {\n\tname: 'Goggles 4 U',\n\tdomain: 'goggles4u.com',\n\tisSinglePageApp: true,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { completionActions } from '../../../utils';\n\nconst BASE_URL = 'https://www.h2oplus.com/checkout';\nconst CART_URL = `${BASE_URL}/cart`;\nconst IS_ON_CART = window.location.href.startsWith(CART_URL);\n\n/** Behavior description:\n+ Existing code: yes \n+ Remove code: yes \n+ Stackable:  no\n+ Free gift support: yes\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Pages, where extension works: cart, checkout\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #discount-code';\n\t\tthis.TOTAL_SELECTOR = '.grand .price, .grand.totals .price';\n\n\t\tthis.ITEM_CONTAINER_SELECTOR = IS_ON_CART ? '#shopping-cart-table tbody' : '.product-image-container';\n\n\t\tthis.NEED_REMOVE_CODE = false;\n\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /grand_total\":\"(\\d+\\.\\d+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t\tthis.itemsCountRegExp = {\n\t\t\tregexObj: /items_count\":\"(\\d+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\t}\n\n\tcheckCondition() {\n\t\tconst totalValue = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst correctPage = window.location.href.startsWith(BASE_URL);\n\t\tconst currentState = totalValue && correctPage;\n\t\treturn currentState;\n\t}\n\n\tbeforeApplyCodes() {\n\t\t// to remove error messages on cart page\n\t\tconst iframeElem = document.createElement('iframe');\n\t\tiframeElem.src = CART_URL;\n\t\tObject.assign(iframeElem.style, { display: 'none' });\n\n\t\tdocument.documentElement.appendChild(iframeElem);\n\t}\n};\n\nexport default {\n\tname: 'H2O+',\n\tdomain: 'h2oplus.com',\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport MagentoTemplate from './_base';\nimport { request, requestTypes, DOM, format } from '../../../utils';\nimport { sessionTimer, handleDriverError } from '../../lib';\n\nconst { extractData } = DOM;\nconst { toFloat } = format;\n\nconst BASE_URL = 'https://shop.harborfreight.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\n\n/** Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: no\n+ Pages, where extension works: cart\n+ Is driver SPA no\n+ Gather codes on site pages: yes, from https://www.harborfreight.com/savings_coupons.html by the item name\n+ sessionTimer: 15min\n+ maxCoupons: 10\nSpecial caase:\n+ If there are more than 1 item in the Cart codes can be stacked.\n  if there is only one item in the Cart codes replace each other (worse code cannot apply better code).\n  It is so much strange behavior, so during stacking if two codes give the same discount driver shows as the best code first code,\n  which gives discount (extension behavior).\n  But on the page will be applied the last code, because it replaces previous code (merchant behavior).\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.cart_item_unit_discount_text span';\n\t\tthis.TOTAL_SELECTOR = '.GrandTotalDollars .price';\n\n\t\tthis.APPLIED_CODES_REGEX = /Coupon Applied (\\d*)/;\n\n\t\tthis.STACKABLE = true;\n\n\t\trequest.setType(requestTypes.xhr);\n\n\t\tsessionTimer.initialize();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(element => element.innerText)\n\t\t\t.map(element => element.match(this.APPLIED_CODES_REGEX)[1]);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tthis.ORIGINAL_PRICE = originalPrice;\n\t\treturn super.checkCodes(codes, originalPrice);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst { discounts, originalPrice, originalItemsCount } = validationInfo;\n\n\t\tdiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGiftsCount = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(discounts, discount =>\n\t\t\tthis._applyCode(discount.code, this._getApplyRequestData()).then(responseString => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst freeGifts = this._parseItemsCount(responseString) - originalItemsCount;\n\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t\tfreeGifts,\n\t\t\t\t});\n\n\t\t\t\tif (finalPrice < currentPrice || (finalPrice === currentPrice && freeGifts > currentFreeGiftsCount)) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\tcurrentFreeGiftsCount = freeGifts;\n\t\t\t\t}\n\t\t\t\treturn Promise.resolve();\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGiftsCount,\n\t\t\t}),\n\t\t);\n\t}\n\n\t_removeCode(code) {\n\t\treturn request.get(`${BASE_URL}/hftcoupons/index/remove?coupon_code=${code}`).then(response => response.text());\n\t}\n\n\t_manageCode(requestURL, bodyObj) {\n\t\treturn request\n\t\t\t.post(requestURL, bodyObj, {\n\t\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\t})\n\t\t\t.then(response => response.text());\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn request.get(this.CART_URL).then(response => response.text());\n\t}\n\n\t_parseTotal(htmlString) {\n\t\ttry {\n\t\t\treturn toFloat(extractData(this.TOTAL_SELECTOR, htmlString));\n\t\t} catch (e) {\n\t\t\thandleDriverError(e, { htmlString });\n\t\t\treturn this.ORIGINAL_PRICE;\n\t\t}\n\t}\n};\n\nexport default {\n\tname: 'Harbor Freight Tools',\n\tdomain: 'harborfreight.com',\n\tDriver,\n\tmaxCoupons: 10,\n\tstackable: true,\n\tshowDifferentDiscountMessage: true,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('#cart_wrapper');\n\t},\n};\n","import MagentoTemplate from './_base';\n\nimport { sessionTimer } from '../../lib';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nDriver behavior:\n•   Existing code: yes\n•   Remove code: yes\n•   Code retesting: yes\n•   Stackable: no\n•   Free gift support: no\n•   isValid implemented: no\n•   Show message about free shipping: no\n•   Driver is SPA: no, works on cart\n•   Gather merchant codes: no\n•   Special case: max code = 6 (slow work), sessiontimer = 18min.\n•   Credentials: no\n•   Test Item(s): -\n•   Valid Code(s): -, last checked 03-25-2019\n*/\n\nconst CART_URL = 'https://shop.highlights.com/checkout/cart';\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table tfoot .price';\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.NEED_REMOVE_CODE = false;\n\n\t\tthis.CHARGES_REGEX = /(shipping|handling|tax)/i;\n\t\tthis.CHARGES_SELECTOR = '.cart-order-totals tr td:last-child';\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 18,\n\t\t});\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await fetch(window.location.href, { credentials: 'include' }).then(response => response.text());\n\t\tconst total = elemToFloat(extractElement(this.TOTAL_SELECTOR, cartStr));\n\t\tconst taxes = [...extractElement(this.CHARGES_SELECTOR, cartStr, true)]\n\t\t\t.filter(el => el.parentElement.textContent.match(this.CHARGES_REGEX))\n\t\t\t.map(el => elemToFloat(el))\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((charges, charge) => charges + charge, 0); // shipping & tax might not be counted on cart\n\t\treturn total - taxes;\n\t}\n};\n\nexport default {\n\tname: 'Highlights',\n\tdomain: 'highlights.com',\n\tmaxCoupons: 6, // site is very slow\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\n\nimport { elemToFloat } from '../../../utils/format';\nimport { extractElement } from '../../../utils/DOM';\n\nconst BASE_URL = 'https://www.hydroflask.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: yes\n+ Pages, where extension works: cart\n+ Is driver SPA: no\n+ Gather codes on site pages: yes (on cart page: https://www.hydroflask.com/checkout/cart)\n*/\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.BASE_API_URL = `${BASE_URL}/discountpopup/index`;\n\t\tthis.TOTAL_SELECTOR = '.grandtotal span';\n\t\tthis.COUPONS_BANNER_SELECTOR = '.sf-announcement-banner';\n\t\tthis.MERCHANT_CODES_REGEX = /use code: ([a-z0-9-]{2,})/i;\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst bannerElement = document.querySelector(this.COUPONS_BANNER_SELECTOR);\n\t\tconst matchedCode = bannerElement && bannerElement.textContent.match(this.MERCHANT_CODES_REGEX);\n\t\treturn matchedCode ? [matchedCode[1]] : [];\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode()\n\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t.then(responseJSON => this._parseTotal(responseJSON));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(response => {\n\t\t\t\tif (response.error) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\treturn this._getUpdatedCart().then(responseJSON => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseJSON);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tif (originalPrice > result.finalPrice) {\n\t\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\t}\n\t\t\t\t\treturn this._removeCode().then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(`${this.BASE_API_URL}/apply/?coupon_code=${code}`);\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode(`${this.BASE_API_URL}/apply/?remove=1`);\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn this._manageCode(`${this.BASE_API_URL}/reloadtotal/`);\n\t}\n\n\t_manageCode(url) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.json());\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, data && data.block));\n\t}\n};\n\nexport default {\n\tname: 'Hudro Flask',\n\tdomain: 'hydroflask.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('#coupon_code');\n\t},\n};\n","import _511tactical from './511tactical.com';\nimport _7forallmankind from './7forallmankind.com';\nimport alloyapparel from './alloyapparel.com';\nimport alternativeapparel from './alternativeapparel.com';\nimport americanstationery from './americanstationery.com';\nimport betabrend from './betabrand.com';\nimport clearbags from './clearbags.com';\nimport coffeebean from './coffeebean.com';\nimport cjponyparts from './cjponyparts.com';\nimport dailysale from './dailysale.com';\nimport dellrefurbished from './dellrefurbished.com';\nimport draperjames from './draperjames.com';\nimport dtlr from './dtlr.com';\nimport eastwood from './eastwood.com';\nimport easyspirit from './easyspirit.com';\nimport eileenfisher from './eileenfisher.com';\nimport elaineturner from './elaineturner.com';\nimport fractureme from './fractureme.com';\nimport g2play from './g2play.net';\nimport goggles4u from './goggles4u.com';\nimport h2oplus from './h2oplus.com';\nimport harborfreight from './harborfreight.com';\nimport highlights from './highlights.com';\nimport hydroflask from './hydroflask.com';\nimport inkcartridges from './inkcartridges.com';\nimport invictastores from './invictastores.com';\nimport jackrabbit from './jackrabbit.com';\nimport jamesperse from './jamesperse.com';\nimport jasonwustudio from './jasonwustudio.com';\nimport jerrysartarama from './jerrysartarama.com';\nimport jomashop from './jomashop.com';\nimport karenkane from './karenkane.com';\nimport karmaloop from './karmaloop.com';\nimport lapolicegear from './lapolicegear.com';\nimport lax from './lax.com';\nimport ldproducts from './ldproducts.com';\nimport lecreuset from './lecreuset.com';\nimport luggagepros from './luggagepros.com';\nimport magazines from './magazines.com';\nimport mophie from './mophie.com';\nimport myfreedomsmokes from './myfreedomsmokes.com';\nimport mypillow from './mypillow.com';\nimport ninewest from './ninewest.com';\nimport oneida from './oneida.com';\nimport papyrusonline from './papyrusonline.com';\nimport partsgeek from './partsgeek.com';\nimport peekkids from './peekkids.com';\nimport peets from './peets.com';\nimport prettylittlething from './prettylittlething.us';\nimport quickcandles from './quickcandles.com';\nimport reeds from './reeds.com';\nimport riteaid from './riteaid.com';\nimport scrubsandbeyond from './scrubsandbeyond.com';\nimport shiekh from './shiekh.com';\nimport shoestation from './shoestation.com';\nimport shopDrcolbert from './shop.drcolbert.com';\nimport shopnational from './shopnational.com';\nimport showmeyourmumu from './showmeyourmumu.com';\nimport shrm from './shrm.org';\nimport smarthome from './smarthome.com';\nimport solesociety from './solesociety.com';\nimport spanx from './spanx.com';\nimport straighterline from './straighterline.com';\nimport targetphoto from './targetphoto.com';\nimport techrabbit from './techrabbit.com';\nimport theCoverStore from './the-cover-store.com';\nimport tidyliving from './tidyliving.com';\nimport totokaelo from './totokaelo.com';\nimport triabeauty from './triabeauty.co.uk';\nimport villeroyBoch from './villeroy-boch.ca';\nimport vincecamuto from './vincecamuto.com';\nimport vionicshoes from './vionicshoes.com';\nimport vitalitymedical from './vitalitymedical.com';\nimport vivaterra from './vivaterra.com';\nimport worldofwatches from './worldofwatches.com';\nimport worx from './worx.com';\nimport zagg from './zagg.com';\n\nexport default [\n\t_511tactical,\n\t_7forallmankind,\n\talloyapparel,\n\talternativeapparel,\n\tamericanstationery,\n\tbetabrend,\n\tclearbags,\n\tcoffeebean,\n\tcjponyparts,\n\tdailysale,\n\tdellrefurbished,\n\tdraperjames,\n\tdtlr,\n\teastwood,\n\teasyspirit,\n\teileenfisher,\n\telaineturner,\n\tfractureme,\n\tg2play,\n\tgoggles4u,\n\th2oplus,\n\tharborfreight,\n\thighlights,\n\thydroflask,\n\tinkcartridges,\n\tinvictastores,\n\tjackrabbit,\n\tjamesperse,\n\tjasonwustudio,\n\tjerrysartarama,\n\tjomashop,\n\tkarenkane,\n\tkarmaloop,\n\tlapolicegear,\n\tlax,\n\tldproducts,\n\tlecreuset,\n\tluggagepros,\n\tmagazines,\n\tmophie,\n\tmyfreedomsmokes,\n\tmypillow,\n\tninewest,\n\toneida,\n\tpapyrusonline,\n\tpartsgeek,\n\tpeekkids,\n\tpeets,\n\tprettylittlething,\n\tquickcandles,\n\treeds,\n\triteaid,\n\tscrubsandbeyond,\n\tshiekh,\n\tshoestation,\n\tshopDrcolbert,\n\tshopnational,\n\tshowmeyourmumu,\n\tshrm,\n\tsmarthome,\n\tsolesociety,\n\tspanx,\n\tstraighterline,\n\ttargetphoto,\n\ttechrabbit,\n\ttheCoverStore,\n\ttidyliving,\n\ttotokaelo,\n\ttriabeauty,\n\tvilleroyBoch,\n\tvincecamuto,\n\tvionicshoes,\n\tvitalitymedical,\n\tvivaterra,\n\tworldofwatches,\n\tworx,\n\tzagg,\n];\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format } from '../../../utils';\n\nconst { elemToFloat, toFloat } = format;\nconst BASE_URL = 'https://www.inkcartridges.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\n\n/* Behavior:\n * We can apply only one code\n * Can remove, can't replace with invalid code\n * This merchant has not template behaviour\n * in getUpdatedCart I am getting JSON type,\n * not HTML as template\n * I can't send request for removing code,\n * If code didn't give discount\n */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLIED_CODES_SELECTOR = '[ng-bind=\"coupon.code\"], .discount-coupon-code';\n\t\tthis.TOTAL_SELECTOR = '.grand-total .price';\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.REMOVE_BTN_SELECTOR = '.remove-coupon';\n\t\tthis.CART_EMPTY_SELECTOR = '.empty-cart-row';\n\t}\n\n\twatchForCartUrl() {\n\t\tlet lastState = false;\n\t\tsetInterval(() => {\n\t\t\tconst cartEmpty = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\t\tconst currentState = cartEmpty && !cartEmpty.offsetParent && window.location.href.startsWith(CART_URL);\n\t\t\tif (lastState !== currentState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tlastState = currentState;\n\t\t}, 1000);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(code => code.textContent.trim());\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code).then(applyCodeResponse => {\n\t\t\t\tlet finalPrice = originalPrice;\n\t\t\t\tlet finalDiscount = 0;\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(applyCodeResponse, 'success')) {\n\t\t\t\t\treturn this._getUpdatedCart()\n\t\t\t\t\t\t.then(updatedCart => {\n\t\t\t\t\t\t\tfinalPrice = this._parseTotal(updatedCart);\n\t\t\t\t\t\t\tfinalDiscount = originalPrice - finalPrice;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() =>\n\t\t\t\t\t\t\tbus.$emit('code-checked', {\n\t\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\t\t\tisValid: true,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t\tisValid: false,\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn super.applyCodes(codes);\n\t}\n\n\t_applyCode(code) {\n\t\tconst body = { coupon_code: code, async: true };\n\t\treturn this._manageCode(`${CART_URL}/couponPost`, body);\n\t}\n\n\t_removeCode(code) {\n\t\tconst body = { amcoupon_code_cancel: code, async: true };\n\t\treturn this._manageCode(`${BASE_URL}/amcoupons/checkout/cancelCoupon`, body);\n\t}\n\n\t_manageCode(url, body) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: JSON.stringify(body),\n\t\t}).then(responseJSON => responseJSON.json());\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(`${CART_URL}/retrieveCartTotals`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(responseJSON => responseJSON.json());\n\t}\n\n\t_parseTotal(data) {\n\t\treturn data ? toFloat(data.grandtotal) : elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'InkCartridges.com',\n\tdomain: 'inkcartridges.com',\n\t// because when we removed removed all products, page doesn't reload\n\tisSinglePageApp: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.includes(CART_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { DOM, format } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\nconst CART_URL = 'https://invictastores.com/checkout/cart';\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - can't apply code without removing previous\n * - can apply one code (not stackable)\n * - session timer 20 min\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.isTaxPresent = null;\n\t\tthis.TABLE_ROW_SELECTOR = '#shopping-cart-totals-table tbody td';\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 20,\n\t\t});\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.isTaxPresent = Boolean(\n\t\t\t[...document.querySelectorAll(this.TABLE_ROW_SELECTOR)].find(el => el.textContent.includes('Tax')),\n\t\t);\n\t\treturn Promise.resolve();\n\t}\n\n\t_parseTotal(htmlString) {\n\t\tconst totalElement = [...extractElement(this.TOTAL_SELECTOR, htmlString, true)];\n\t\treturn elemToFloat(this.isTaxPresent ? totalElement[1] : totalElement[0]);\n\t}\n};\n\nexport default {\n\tname: 'Invicta Stores',\n\tdomain: 'invictastores.com',\n\tmaxCoupons: 8,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { log, format, DOM } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElementFromHTML, extractElement, extractFormValues } = DOM;\n\nconst BASE_URL = 'https://www.jackrabbit.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/onestepcheckout`;\nconst CHECKOUT_REQUEST = `${CHECKOUT_URL}/ajax/add_coupon/`;\nconst IS_CART_PAGE = window.location.href.startsWith(CART_URL);\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: yes\n•    ‘isValid’ implemented: yes\n•    Manually apply code: no\nOptional:\n•    Show message about free shipping on the cart page (without discount info): no\n•    Is driver SPA and add the condition to show popup: yes\n•    Gather codes on site pages: no\n•    test codes on the cart page and payment step\n\nRewrote some base methods, because on the checkout page merchant has not\nsame to cart page behaviour (another requests, return json response) */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #id_couponcode';\n\t\tthis.TOTAL_SELECTOR =\n\t\t\t'#shopping-cart-totals-table strong .price, .onestepcheckout-totals strong:last-child .price';\n\t\tthis.CHECKOUT_SECTION_SELECTOR = '#paymentfobtntext.active';\n\n\t\tthis.ITEM_CONTAINER_SELECTOR = '.cart-top-sec.clearfix';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\n\t\tthis.APPLY_CODE_PARAM_NAME = IS_CART_PAGE ? 'coupon_code' : 'code';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.VALID_CHECKOUT_PAGE = true;\n\t\tthis.CHARGES_REGEX = /(shipping|tax)/i;\n\t\tthis.CHARGES_SELECTOR = '.onestepcheckout-totals td:last-child, #shopping-cart-totals-table tr td:last-child';\n\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\taccept: 'text/javascript, text/html, application/xml, text/xml, */*',\n\t\t\t'content-type': 'application/x-www-form-urlencoded; charset=UTF-8',\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t'x-prototype-version': 1.7,\n\t\t};\n\t}\n\n\tcheckCondition() {\n\t\tconst cartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst currentState =\n\t\t\tdocument.querySelector(this.APPLIED_CODES_SELECTOR) &&\n\t\t\t((window.location.href.startsWith(CART_URL) || document.querySelector(this.CHECKOUT_SECTION_SELECTOR)) &&\n\t\t\t\t!cartEmpty);\n\t\treturn currentState;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codesElement = this.cartPageHTML\n\t\t\t? extractElementFromHTML(this.cartPageHTML, this.APPLIED_CODES_SELECTOR)\n\t\t\t: document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\tconst codes = [codesElement.value].filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(), originalItemsCount = this._parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst freeGifts = this._parseItemsCount(responseString) - originalItemsCount;\n\t\t\t\tconst isValid = typeof responseString === 'object' ? responseString.success : true;\n\t\t\t\tconst result = { code, finalPrice, finalDiscount, freeGifts, isValid };\n\t\t\t\treturn this._removeCode(code, this._getRemoveRequestData(responseString)).then(() =>\n\t\t\t\t\tbus.$emit('code-checked', result),\n\t\t\t\t);\n\t\t\t}),\n\t\t);\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0], this._getRemoveRequestData(this.cartPageHTML)).then(responseString =>\n\t\t\tthis._parseTotal(responseString),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\t[this.bestCode] = codes;\n\t\treturn this._applyCode(codes[0], this._getApplyRequestData(this.cartPageHTML));\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await this._applyCode(this.bestCode || 'fake', this._getApplyRequestData(this.cartPageHTML));\n\t\tconst total = this._parseTotal(cartStr);\n\t\tconst taxes = [...extractElement(this.CHARGES_SELECTOR, cartStr.summary, true)]\n\t\t\t.filter(el => el.parentElement.textContent.match(this.CHARGES_REGEX))\n\t\t\t.map(elemToFloat)\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((charges, charge) => charges + charge, 0); // shipping & tax might not be counted on cart\n\t\treturn total - taxes;\n\t}\n\n\t_getApplyRequestData(htmlString) {\n\t\tif (!this.applyRequestData && IS_CART_PAGE) {\n\t\t\t// Assumed that this form always exists\n\t\t\tthis.applyRequestData = extractFormValues(this.APPLY_COUPON_FORM_SELECTOR, htmlString);\n\t\t\tObject.entries(this.APPLY_REQUEST_EXTRA_VALUES).forEach(([key, value]) => {\n\t\t\t\tthis.applyRequestData.params.set(key, value);\n\t\t\t});\n\t\t} else if (!this.applyRequestData && !IS_CART_PAGE) {\n\t\t\tthis.applyRequestData = {\n\t\t\t\taction: CHECKOUT_REQUEST,\n\t\t\t\tparams: new URLSearchParams(),\n\t\t\t};\n\t\t}\n\t\treturn this.applyRequestData;\n\t}\n\n\t_getRemoveRequestData(htmlString) {\n\t\tif (!this.removeRequestData && IS_CART_PAGE) {\n\t\t\t// Form may not exists if there is no code applied\n\t\t\tthis.removeRequestData = extractFormValues(this.REMOVE_COUPON_FORM_SELECTOR, htmlString);\n\t\t\t//  If we succeeded, add extra values\n\t\t\tObject.entries(this.REMOVE_REQUEST_EXTRA_VALUES).forEach(([key, value]) => {\n\t\t\t\tthis.removeRequestData.params.set(key, value);\n\t\t\t});\n\t\t} else if (!this.removeRequestData && !IS_CART_PAGE) {\n\t\t\tthis.removeRequestData = {\n\t\t\t\taction: CHECKOUT_REQUEST,\n\t\t\t\tparams: new URLSearchParams({\n\t\t\t\t\tremove: 1,\n\t\t\t\t}),\n\t\t\t};\n\t\t}\n\t\treturn this.removeRequestData;\n\t}\n\n\t_manageCode(requestURL, bodyObj) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\tbody: bodyObj,\n\t\t}).then(response => (IS_CART_PAGE ? response.text() : response.json()));\n\t}\n\n\t_parseTotal(htmlString) {\n\t\tlet totalElement;\n\t\tif (htmlString) {\n\t\t\tif (!IS_CART_PAGE) {\n\t\t\t\ttotalElement = extractElementFromHTML(htmlString.summary, this.TOTAL_SELECTOR).textContent;\n\t\t\t} else if (this.totalRegExp) {\n\t\t\t\ttotalElement = htmlString.match(this.totalRegExp.regexObj)[this.totalRegExp.groupNumber];\n\t\t\t} else {\n\t\t\t\ttotalElement = extractElementFromHTML(htmlString, this.TOTAL_SELECTOR).textContent;\n\t\t\t}\n\t\t} else {\n\t\t\ttotalElement = document.querySelector(this.TOTAL_SELECTOR).textContent;\n\t\t}\n\t\treturn toFloat(totalElement);\n\t}\n\n\t_parseItemsCount(data) {\n\t\treturn this._isOnCart()\n\t\t\t? super._parseItemsCount()\n\t\t\t: extractElement(this.ITEM_CONTAINER_SELECTOR, data ? data.summary : null, true).length;\n\t}\n};\n\nexport default {\n\tname: 'JackRabbit',\n\tdomain: 'jackrabbit.com',\n\tisSinglePageApp: true,\n\tmaxCoupons: 3, // due to time\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.includes(CHECKOUT_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { completionActions } from '../../../utils';\n\nconst BASE_URL = 'https://www.jamesperse.com/checkout';\nconst CART_URL = `${BASE_URL}/cart`;\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    ‘isValid’ implemented: no\n•    active pages: cart, checkout\nOptional:\n•    Show message about free shipping on the cart page (without discount info): yes\n•    Is driver SPA and add the condition to show popup: no\n•    Gather codes on site pages: no */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.APPLIED_CODES_SELECTOR = '.summary-collapse.discount-rule';\n\t\tthis.TOTAL_SELECTOR = this._isOnCart()\n\t\t\t? '.totals tr:last-child .price'\n\t\t\t: '.checkout-costs-table tr:last-child .price';\n\t\tthis.APPLY_COUPON_FORM_SELECTOR = '#discount-coupon-form, #fake-discount-coupon-form';\n\t\tthis.REMOVE_COUPON_FORM_SELECTOR = this.APPLY_COUPON_FORM_SELECTOR; // must to be redefined\n\n\t\tthis.FREE_SHIP_ELEM_SELECTOR = '.summary-collapse';\n\n\t\tthis.VALID_CHECKOUT_PAGE = true;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst inputCouponElement = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\tconst codes = inputCouponElement ? [inputCouponElement.innerText.trim().match(/(.*?)\\s+/)[1]] : [];\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0], this._getRemoveRequestData()).then(responseTxt =>\n\t\t\tthis._parseTotal(responseTxt),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\t// on the cart page we have total without tax and shipping\n\t\tthis.TOTAL_SELECTOR = '.totals tr:last-child .price';\n\t\treturn this._getUpdatedCart().then(responseTxt => this._parseTotal(responseTxt));\n\t}\n};\n\nexport default {\n\tname: 'James Perse',\n\tdomain: 'jamesperse.com',\n\tmaxCoupons: window.location.href.includes('/review') ? 3 : 4, // works slowly\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.shopping-bag-empty'));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.startsWith(`${BASE_URL}/review`);\n\t},\n};\n","import MagentoTemplate from './_base';\n\n/** Behavior description:\n * - can get existing codes only if user applies code manually and runs the extension\n * - can remove codes\n * - valid code can be replaced with another valid or invalid code\n * - can't apply multiple codes (not stackable)\n * - may run extension on 'Cart' and 'Checkout' pages\n * ======== Special case ========\n we don't show popup on the 'Checkout' page because applying codes will redirect us to the 'Cart' page\n and will clean all user's data\n * */\n\nconst BASE_URL = 'https://www.jasonwustudio.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.APPLIED_CODES_SELECTOR = '.cart-wrapper .success-msg';\n\t\tthis.TOTAL_SELECTOR = '.grand-total .price';\n\t\tthis.ITEM_CONTAINER_SELECTOR = '#shopping-cart-table .item, #cart-sidebar .item';\n\t\tthis.CODE_REGEX = /CODE\\s\"(\\w+)/;\n\t\tthis.NEED_REMOVE_CODE = false;\n\t\tthis.afterCodeCheck = () => {\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(codeElem => codeElem.innerText.match(this.CODE_REGEX))\n\t\t\t.map(code => code.innerText.match(this.CODE_REGEX)[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: 'Jason WU',\n\tdomain: 'jasonwustudio.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('#shopping-cart-table');\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n};\n","import MagentoTemplate from './_base';\nimport bus from '../../bus';\n\nconst CART_URL = 'https://www.jerrysartarama.com/checkout/cart';\n\n/**\n Driver behavior description:\n• Existing code: yes\n• Remove code: yes\n• Stackable: no\n• Free gift support: no\n• ‘isValid’ implemented: no\n• Manually apply code: no\n• code testing may be run on 'Cart' page;\n */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code';\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price';\n\t\tthis.SPINNER_SELECTOR = '.checkout-cart-index.disabled';\n\t\tthis.TOTAL_SPINNER_SELECTOR = '#shopping-cart-totals-table.loading';\n\t\tthis.TITLE_SELECTOR = '.page-title';\n\t}\n\n\twatchForCartUrl() {\n\t\tlet lastState = false;\n\t\tsetInterval(() => {\n\t\t\tconst titleElem = document.querySelector(this.TITLE_SELECTOR);\n\t\t\tconst isCartEmpty = titleElem ? titleElem.innerText.toLowerCase().includes('is empty') : false;\n\t\t\tconst isSpinner = document.querySelector(this.SPINNER_SELECTOR);\n\t\t\tconst isTotalSpinner = document.querySelector(this.TOTAL_SPINNER_SELECTOR);\n\t\t\tconst currentState =\n\t\t\t\t!isCartEmpty && !isSpinner && !isTotalSpinner && window.location.href.startsWith(CART_URL);\n\t\t\tif (lastState !== currentState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tlastState = currentState;\n\t\t}, 1000);\n\t}\n};\n\nexport default {\n\tname: \"Jerry's Artarama\",\n\tdomain: 'jerrysartarama.com',\n\tisSinglePageApp: true,\n\tmaxCoupons: 8,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { log, DOM, format } from '../../../utils';\n\nconst { extractElement, extractFormValues } = DOM;\nconst { elemToFloat } = format;\n\nconst CART_URL = 'https://www.jomashop.com/checkout/cart';\nconst CHECKOUT_REQUEST_URL = 'https://www.jomashop.com/firecheckout/index/saveCoupon/';\nconst IS_CHECKOUT = !window.location.href.includes('/cart');\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - valid code can be replaced with another valid code\n * - can apply only one code\n *\n * ======== Special case ========\n * Sometimes, site can ask user for `robot checking`,\n * We can have `Validating JavaScript` in the response,\n * add recursive applying, after 2 try, code will be emitted as not valid\n * Special case, as we can have `Validating Javascript` in response, maxCoupons for the checkout is 2 codes.\n * Sometimes we will have `Validating Javascript` and will be nothing.\n * Code testing can be run on the cart and checkout\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price, #checkout-review-table  strong .price';\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #coupon-code';\n\n\t\tthis.ITEM_CONTAINER_SELECTOR = '.jqCartItem';\n\t\tthis.APPLY_COUPON_FORM_SELECTOR = '#discount-coupon-form, #firecheckout-form';\n\t\tthis.REMOVE_COUPON_FORM_SELECTOR = this.APPLY_COUPON_FORM_SELECTOR;\n\n\t\tthis.CONTENT_SELECTOR = '.content';\n\t\tthis.CART_EMPTY_SELECTOR = '.cart-empty';\n\t\tthis.VALID_CHECKOUT_PAGE = true;\n\n\t\tthis.APPLY_REQUEST_EXTRA_VALUES = {\n\t\t\t[IS_CHECKOUT ? 'coupon[remove]' : 'remove']: 0,\n\t\t};\n\n\t\tthis.APPLY_CODE_PARAM_NAME = IS_CHECKOUT ? 'coupon[code]' : this.APPLY_CODE_PARAM_NAME;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.REMOVE_REQUEST_EXTRA_VALUES = {\n\t\t\t[IS_CHECKOUT ? 'coupon[remove]' : 'remove']: 1,\n\t\t};\n\n\t\tthis.MESSAGE_SELECTOR = '.error-msg';\n\t\tthis.DISABLE_CODE_TESTING = false;\n\t\tthis.CHECKOUT_COUPON_SELECTOR = '.checkout-coupon-container';\n\t}\n\n\tcheckCondition() {\n\t\tconst recaptchaPageEl = document.querySelector(this.CONTENT_SELECTOR);\n\t\tconst isCartEmpty =\n\t\t\tdocument.querySelector(this.CART_EMPTY_SELECTOR) ||\n\t\t\t(recaptchaPageEl && !!recaptchaPageEl.textContent.match(/pardon our interruption/));\n\t\tconst isAppliedCode = document.querySelector(this.CHECKOUT_COUPON_SELECTOR);\n\t\tconst isCodeInput = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\tconst currentState =\n\t\t\tisCodeInput && isCodeInput.offsetParent && !isAppliedCode && !isCartEmpty && !this.DISABLE_CODE_TESTING;\n\t\treturn currentState;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codesElement = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\n\t\tconst codes = [codesElement.getAttribute('value')].filter(el => Boolean(el));\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0], this._getRemoveRequestData(this.cartPageHTML)).then(responseString => ({\n\t\t\toriginalPrice: this._parseTotal(responseString),\n\t\t\toriginalItemsCount: this._parseItemsCount(responseString),\n\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(), originalItemsCount = this._parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t};\n\t\t\t\tif (this._isFakeCode(responseString)) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\tresult.finalPrice = this._parseTotal(responseString);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.freeGifts = this._parseItemsCount(responseString) - originalItemsCount;\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (IS_CHECKOUT) {\n\t\t\t\tthis.DISABLE_CODE_TESTING = true;\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\t_applyCode(code, requestData, tryNumber = 1) {\n\t\trequestData.params.set(this.APPLY_CODE_PARAM_NAME, code);\n\t\treturn this._manageCode(requestData.action, requestData.params).then(response => {\n\t\t\tif (!IS_CHECKOUT && !extractElement(this.TOTAL_SELECTOR, response) && tryNumber < 2) {\n\t\t\t\treturn this._applyCode(code, requestData, tryNumber + 1);\n\t\t\t}\n\t\t\treturn response;\n\t\t});\n\t}\n\n\t_manageCode(requestURL, bodyObj) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\tbody: bodyObj,\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t_getApplyRequestData(htmlString) {\n\t\tif (!this.applyRequestData) {\n\t\t\t// Assumed that this form always exists\n\t\t\tthis.applyRequestData = extractFormValues(this.APPLY_COUPON_FORM_SELECTOR, htmlString);\n\t\t\tObject.entries(this.APPLY_REQUEST_EXTRA_VALUES).forEach(([key, value]) => {\n\t\t\t\tthis.applyRequestData.params.set(key, value);\n\t\t\t});\n\n\t\t\tif (IS_CHECKOUT) {\n\t\t\t\tthis.applyRequestData.action = CHECKOUT_REQUEST_URL;\n\t\t\t}\n\t\t}\n\t\treturn this.applyRequestData;\n\t}\n\n\t_getRemoveRequestData(htmlString) {\n\t\tif (!this.removeRequestData) {\n\t\t\t// Form may not exists if there is no code applied\n\t\t\tthis.removeRequestData = extractFormValues(this.REMOVE_COUPON_FORM_SELECTOR, htmlString);\n\t\t\t//  If we succeeded, add extra values\n\t\t\tif (this.removeRequestData) {\n\t\t\t\tObject.entries(this.REMOVE_REQUEST_EXTRA_VALUES).forEach(([key, value]) => {\n\t\t\t\t\tthis.removeRequestData.params.set(key, value);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (IS_CHECKOUT) {\n\t\t\t\tthis.removeRequestData.action = CHECKOUT_REQUEST_URL;\n\t\t\t}\n\t\t}\n\t\treturn this.removeRequestData;\n\t}\n\n\t_isFakeCode(response) {\n\t\tif (typeof response === 'string' && response.match(/Validating JavaScript/)) {\n\t\t\treturn true;\n\t\t}\n\t\tif (IS_CHECKOUT) {\n\t\t\treturn extractElement(this.MESSAGE_SELECTOR, response.update_section['coupon-discount']);\n\t\t}\n\t\tif (!response || response.match(/is not valid/i) || !extractElement(this.TOTAL_SELECTOR, response)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t_parseItemsCount(htmlString) {\n\t\treturn !IS_CHECKOUT ? extractElement(this.ITEM_CONTAINER_SELECTOR, htmlString, true).length : 0;\n\t}\n\n\t_parseTotal(htmlString) {\n\t\treturn elemToFloat(\n\t\t\textractElement(\n\t\t\t\tthis.TOTAL_SELECTOR,\n\t\t\t\ttypeof htmlString === 'object' ? htmlString.update_section.review : htmlString,\n\t\t\t),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Jomashop',\n\tdomain: 'jomashop.com',\n\tisSinglePageApp: true,\n\t// due to recaptcha\n\tmaxCoupons: 1,\n\tcartContinueUrl: window.location.href.split('#')[0],\n\tDriver,\n\tisOnCartUrl: () => false,\n};\n","import MagentoTemplate from './_base';\n\nconst CART_URL = 'https://www.karenkane.com/store/checkout/cart';\n\n/** Driver behavior description:\n-    Existing code: yes\n-    Remove code: yes\n-    Stackable: no\n-    Free gift support:no\n-    ‘isValid’ implemented: no\nOptional:\n-    Show message about free shipping on the cart page (without discount info): no\n-    Is driver SPA and add the condition to show popup: no\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t}\n};\n\nexport default {\n\tname: 'Karen Kane',\n\tdomain: 'karenkane.com',\n\tDriver,\n\tmaxCoupons: 10, // due to ` Total test time`\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n\tisCartEmpty() {\n\t\treturn !(document.querySelector('#coupon_code') && document.querySelector('#coupon_code').offsetParent);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport bus from '../../bus';\n\nconst CART_URL = 'https://www.karmaloop.com/checkout/cart';\nconst CHECKOUT_URL = 'https://www.karmaloop.com/checkout/#payment';\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = '.grand .price, .grand.totals .price';\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /subtotal_with_discount\":\"(\\d+\\.\\d+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t}\n\n\twatchForCartUrl() {\n\t\tlet previousState = false;\n\t\tsetInterval(() => {\n\t\t\t// Activate extension popup only on when the total has been rendered.\n\t\t\tconst totalValue = document.querySelector(this.TOTAL_SELECTOR);\n\t\t\tconst onCart = window.location.href.startsWith(CART_URL);\n\t\t\tconst onRightUrl = window.location.href.startsWith(CHECKOUT_URL) || onCart;\n\n\t\t\tconst currentState = totalValue && (onCart || onRightUrl);\n\n\t\t\tif (currentState !== previousState) {\n\t\t\t\tif (currentState) {\n\t\t\t\t\tbus.$emit('cart-active');\n\t\t\t\t} else {\n\t\t\t\t\tbus.$emit('cart-inactive');\n\t\t\t\t}\n\t\t\t}\n\t\t\tpreviousState = currentState;\n\t\t}, 1000);\n\t}\n};\n\nexport default {\n\tmaxCoupons: 10,\n\tname: 'Karmaloop',\n\tdomain: 'karmaloop.com',\n\tisSinglePageApp: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { completionActions } from '../../../utils';\n\nconst CHECKOUT_PAGE = 'https://lapolicegear.com/checkout';\nconst CART_URL = `${CHECKOUT_PAGE}/cart`;\n\nconst onCart = () => window.location.href.startsWith(CART_URL);\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    ‘isValid’ implemented: no\n•    Manually apply code: no\nOptional:\n•    Show message about free shipping on the cart page (without discount info): no\n•    Is driver SPA and add the condition to show popup: yes\n•    Gather codes on site pages: no */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.NEED_REMOVE_CODE = false; // avoid codes removal to speed up the driver work\n\n\t\tthis.TOTAL_SELECTOR = '.grand.totals strong .price';\n\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /grand_total\":(\\d+.\\d+|\\d+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\t}\n\n\tcheckCondition() {\n\t\tconst totalValue = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst correctPage = window.location.href.startsWith(CHECKOUT_PAGE) || onCart();\n\t\tconst currentState = totalValue && correctPage;\n\t\treturn currentState;\n\t}\n\n\tapplyCodes(codes) {\n\t\tthis.afterCodeCheck();\n\t\treturn this._applyCode(codes[0], this._getApplyRequestData(this.cartPageHTML));\n\t}\n};\n\nexport default {\n\tname: 'LAPoliceGear.com',\n\tdomain: 'lapolicegear.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tmaxCoupons: 7, // website is slow\n\tisSinglePageApp: true,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\n\nconst CART_URL = 'https://www.lax.com/checkout/cart/';\n\n// Behavior description:\n// we can apply only 1 coupon\n// we can remove applied code\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.STACKABLE = false;\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\treturn Promise.each(codes, code =>\n\t\t\t// Codes replace each other that is why we don't need _removeCode() method\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\treturn bus.$emit('code-checked', { code, finalPrice, finalDiscount });\n\t\t\t}),\n\t\t);\n\t}\n\n\t// for cleaning unnecessary messages\n\tbeforeApplyCodes() {\n\t\tconst iframeElem = document.createElement('iframe');\n\t\tiframeElem.src = 'https://www.lax.com/';\n\t\tObject.assign(iframeElem.style, { display: 'none' });\n\n\t\tdocument.documentElement.appendChild(iframeElem);\n\t}\n};\n\nexport default {\n\tname: 'Lax',\n\tdomain: 'lax.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.no-items h1'));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format, log, completionActions } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { toFloat, elemToFloat } = format;\n\nconst BASE_URL = 'https://www.ldproducts.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout/onepage`;\n\n/**\n * Driver behavior description:\n -    Existing code: yes\n -    Remove code: yes\n -    Stackable: no\n -    Free gift support: no\n -    ‘isValid’ implemented: yes\n Optional:\n -\t  maxCoupons: 7, // site can be is very slow\n -\t  sessionTimer 15 min\n -    Is driver SPA and add the condition to show popup: no\n -\tCan run testing on Cart and Checkout(all steps except shipping address) pages\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.grand-total .price';\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.code.ng-binding, .discount-coupon-code';\n\n\t\tthis.INPUT_SELECTOR = '#coupon_code';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#btn-apply-coupon';\n\t\tthis.SHIPPING_SECTION = '#opc-shipping';\n\t\tthis.ITEMS_IN_CART = '#item_in_cart';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst cartURL = href.startsWith(CART_URL);\n\t\tconst checkoutURL =\n\t\t\thref.startsWith(CHECKOUT_URL) &&\n\t\t\t!(\n\t\t\t\tdocument.querySelector(this.SHIPPING_SECTION) &&\n\t\t\t\tdocument.querySelector(this.SHIPPING_SECTION).classList.contains('active')\n\t\t\t);\n\t\tconst emptyCart = Boolean(\n\t\t\tdocument.querySelector(this.ITEMS_IN_CART) &&\n\t\t\t\tdocument.querySelector(this.ITEMS_IN_CART).innerText === '0 items',\n\t\t);\n\n\t\treturn (checkoutURL || cartURL) && !emptyCart;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(element => element.innerText.trim());\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0])\n\t\t\t.then(() => this._getOrderSummary())\n\t\t\t.then(responseJSON => this._parseTotal(responseJSON));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code).then(response => {\n\t\t\t\tconst result = { code, finalPrice: originalPrice, finalDiscount: 0, isValid: true };\n\t\t\t\tif (response.error) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\treturn this._getOrderSummary().then(responseJSON => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseJSON);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_applyCode(code) {\n\t\tconst bodyParams = {\n\t\t\tcoupon_code: code,\n\t\t\tasync: true,\n\t\t};\n\t\treturn this._manageCode(`${CART_URL}/couponPost`, bodyParams);\n\t}\n\n\t_removeCode(code) {\n\t\tconst bodyParams = {\n\t\t\tamcoupon_code_cancel: code,\n\t\t\tasync: true,\n\t\t};\n\t\treturn this._manageCode(`${BASE_URL}/amcoupons/checkout/cancelCoupon`, bodyParams);\n\t}\n\n\t_getOrderSummary() {\n\t\treturn fetch(`${CART_URL}/retrieveCartTotals`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.json());\n\t}\n\n\t_manageCode(requestURL, bodyParams) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify(bodyParams),\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\taccept: 'application/json, text/plain, */*',\n\t\t\t\t'content-type': 'application/json;charset=UTF-8',\n\t\t\t},\n\t\t}).then(response => response.json());\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn toFloat(data.grandtotal);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'LDProducts',\n\tdomain: 'ldproducts.com',\n\tmaxCoupons: 7, // site can be is very slow\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tisSinglePageApp: true,\n};\n","import MagentoTemplate from './_base';\nimport { format, DOM } from '../../../utils';\nimport { wait } from '../../../utils/browser';\n\nconst { toFloat, toInt, elemToFloat } = format;\nconst { extractData, extractElement } = DOM;\n\nconst BASE_URL = 'https://www.lecreuset.com/';\nconst CART_URL = `${BASE_URL}checkout/cart`;\n\n/* Behavior description:\n+ Merchant codes: yes (from the cart page hidden block)\n+ Existing codes: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: yes\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table tfoot span.price';\n\t\tthis.COUNT_ITEM_SELECTOR = '.header-minicart .count';\n\t\tthis.MERCHANT_CODES_SELECTOR = '.skinny-banner .banner-line-break';\n\t\tthis.MERCHANT_CODES_REGEX = /code: (\\w+)/i;\n\t\tthis.CHARGES_SELECTOR = '#shopping-cart-totals-table tbody td:last-child';\n\t\tthis.CHARGES_REGEX = /(shipping|handling|tax)/i;\n\t\tthis.TOTAL_REG = /(&#36;)|[^0-9.-]+/g;\n\t\tthis.FREE_GIFT_SELECTOR = '#ampromo-items';\n\t\tthis.ADD_GIFT_BUTTON_SELECTOR = '#ampromo-carousel-content .ampromo-slide:first-child button';\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getPage().then(responseText => {\n\t\t\treturn [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...extractElement(this.MERCHANT_CODES_SELECTOR, responseText, true)]\n\t\t\t\t\t\t.map(elem => elem.innerText.match(this.MERCHANT_CODES_REGEX))\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.map(elem => elem[1]),\n\t\t\t\t),\n\t\t\t];\n\t\t});\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await fetch(window.location.href, { credentials: 'include' }).then(response => response.text());\n\t\tconst total = this._parseTotal(cartStr);\n\t\tconst taxes = [...extractElement(this.CHARGES_SELECTOR, cartStr, true)]\n\t\t\t.filter(el => el.parentElement.textContent.match(this.CHARGES_REGEX))\n\t\t\t.map(elemToFloat)\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((charges, charge) => charges + charge, 0);\n\t\treturn total - taxes;\n\t}\n\n\tgetUserData() {\n\t\treturn true;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn document.querySelector(this.FREE_GIFT_SELECTOR);\n\t}\n\n\tsetUserData() {\n\t\tconst addToCartButtonSelector = document.querySelector(this.ADD_GIFT_BUTTON_SELECTOR);\n\t\tconst getAddToCartButtonSelector = () => addToCartButtonSelector.offsetParent;\n\t\treturn wait(getAddToCartButtonSelector, 10000, 400).then(() => addToCartButtonSelector.click());\n\t}\n\n\t_parseItemsCount(data) {\n\t\tif (extractElement(this.FREE_GIFT_SELECTOR, data)) {\n\t\t\treturn toInt(extractData(this.COUNT_ITEM_SELECTOR, data) || 0) + 1;\n\t\t}\n\t\treturn toInt(extractData(this.COUNT_ITEM_SELECTOR, data) || 0);\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn toFloat(extractData(this.TOTAL_SELECTOR, data).replace(this.TOTAL_REG, ''));\n\t}\n\n\t_getPage(url = BASE_URL) {\n\t\treturn fetch(url, {\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Le Creuset',\n\tdomain: 'lecreuset.com',\n\tDriver,\n\trestoreUserData: true,\n\tisCartEmpty() {\n\t\tconst productsCount = document.querySelector('.header-minicart .count');\n\t\treturn !!(productsCount && productsCount.innerText === '0');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('.discount-form');\n\t},\n};\n","import MagentoTemplate from './_base';\n\nconst CART_URL = 'https://www.luggagepros.com/checkout/cart';\nconst CHECKOUT_URL = 'https://www.luggagepros.com/onepagecheckout';\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - valid code can be replaced with another valid code\n * - can't apply multiple codes (not stackable)\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code';\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price';\n\t}\n};\n\nexport default {\n\tname: 'Luggage Pros',\n\tdomain: 'luggagepros.com',\n\tmaxCoupons: 10, // site is slow\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL);\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { log, format, completionActions } from '../../../utils';\n\nconst { toFloat } = format;\n\nconst BASE_URL = 'https://www.magazines.com/checkout';\nconst BILLING_URL = `${BASE_URL}/checkout/billing`;\n\n/** Behavior description:\n+ Existing code: yes, but not always, get codes from response\n+ Remove code: no\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: valid code can be replaced with another valid code,\n  but message about appling on the page\n+ Manually apply code: no\n+ Pages, where extension works: Payment step of Checkout, sometimes redirect us to Cart,\n  but after Cart user can go to Payment step directly\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = `${BASE_URL}/cart`;\n\n\t\tthis.TOTAL_SELECTOR = '.order-total .value';\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.requestParams = new URLSearchParams({\n\t\t\tretfmt: 'json',\n\t\t\tapply: 'true',\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getSummary().then(responseJSON => {\n\t\t\tconst codes = responseJSON.coupons ? [responseJSON.coupons.applied.code] : [];\n\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code).then(response => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t};\n\t\t\t\tif (response && !response.redemptionErrorMsg) {\n\t\t\t\t\treturn this._getSummary().then(responseJSON => {\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseJSON);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_applyCode(code) {\n\t\tconst requestUrl = `${this.CART_URL}/couponPost/?`;\n\t\tthis.requestParams.set('giftCertificateID', code);\n\t\tthis.requestParams.set('couponCode', code);\n\n\t\treturn this._manageCode(`${requestUrl}${this.requestParams.toString()}`);\n\t}\n\n\t_manageCode(requestURL) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t}).then(response => response.json());\n\t}\n\n\t_getSummary() {\n\t\treturn this._manageCode(`${BASE_URL}/cart/getPrices/`);\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn data.grandTotal;\n\t\t}\n\t\treturn toFloat(document.querySelector(this.TOTAL_SELECTOR).textContent);\n\t}\n};\n\nexport default {\n\tname: 'magazines',\n\tdomain: 'magazines.com',\n\tDriver,\n\tcartContinueUrl: BILLING_URL,\n\tcompletionAction: completionActions.revisit,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.no-cart-items'));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(BILLING_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { sendXhr, format } from '../../../utils';\n\nconst { toFloat } = format;\n\n// Behavior description:\n// we can apply only 1 coupon\n// we can remove applied code\n// requests of this site are very slow\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = 'https://www.mophie.com/shop/checkout/cart';\n\t\tthis.CART_URL_HTTP = 'http://www.mophie.com/shop/checkout/cart';\n\t\tthis.REQUEST_URL = this._isOnCart() ? this.CART_URL : this.CART_URL_HTTP;\n\t\tthis.APPLIED_CODE_SELECTOR = '.promo-code strong';\n\t\tthis.TOTAL_SELECTOR = this._isOnCart()\n\t\t\t? '#shopping-cart-totals-table strong:first-child .price'\n\t\t\t: '.order-total .price';\n\t\tthis.ITEM_SELECTOR = '.item, .product-info';\n\t\tthis.STACKABLE = false;\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\n\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t};\n\t\tthis.bodyData = new URLSearchParams();\n\t\tthis.stringIsObj = true;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = setInterval(() => {\n\t\t\tconst currentState = document\n\t\t\t\t.querySelector('body')\n\t\t\t\t.getAttribute('class')\n\t\t\t\t.includes('open-now');\n\t\t\tconst item = Boolean(document.querySelector(this.ITEM_SELECTOR));\n\t\t\tif (item && (this._isOnCart() || currentState)) {\n\t\t\t\tbus.$emit('cart-active');\n\t\t\t\tclearInterval(interval);\n\t\t\t}\n\t\t}, 1000);\n\t}\n\n\tbeforeTestCodes() {\n\t\treturn false;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODE_SELECTOR)]\n\t\t\t.filter(el => Boolean(el))\n\t\t\t.map(element => element.innerText);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\t// 'beforeCheckCodes()' does the same\n\t\treturn false;\n\t}\n\n\tbeforeCheckCodes() {\n\t\t// there isn't always opportunity to get existing code\n\t\treturn this._removeCode().then(responseJSON => this._parseTotal(responseJSON));\n\t}\n\n\t_applyCode(code) {\n\t\tthis.bodyData.set('coupon_code', code);\n\t\tthis.bodyData.delete('remove');\n\t\treturn this._manageCode();\n\t}\n\n\t_removeCode() {\n\t\tthis.bodyData.set('remove', '1');\n\t\tthis.bodyData.delete('coupon_code');\n\t\treturn this._manageCode();\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn false;\n\t}\n\n\t_getApplyRequestData() {\n\t\treturn false;\n\t}\n\n\t_getRemoveRequestData() {\n\t\treturn false;\n\t}\n\n\t_manageCode() {\n\t\treturn sendXhr(`${this.REQUEST_URL}/couponPost`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\tbody: this.bodyData,\n\t\t}).then(response => response.json());\n\t}\n\n\t_parseTotal(json) {\n\t\tlet totalValue;\n\t\tif (json) {\n\t\t\ttotalValue = json.cart_obj.cart_grandtotal;\n\t\t} else {\n\t\t\ttotalValue = document.querySelector(this.TOTAL_SELECTOR).textContent;\n\t\t}\n\t\treturn toFloat(totalValue);\n\t}\n};\n\nexport default {\n\tname: 'Mophie',\n\tdomain: 'mophie.com',\n\tmaxCoupons: 5, // requests are very slow\n\tisSinglePageApp: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.includes('mophie.com');\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { log } from '../../../utils';\n\n/** Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n+ maxCoupons: 12, due to test time\n * */\n\nconst CART_URL = 'https://www.myfreedomsmokes.com/checkout/cart';\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.TOTAL_SELECTOR = '.totals.incl .price';\n\t\tthis.FORM_KEY_SELECTOR = '[name=\"form_key\"]';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /\"grand_total\":\"?([0-9.]+)\"?/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\t}\n\n\tcheckCondition() {\n\t\tconst isCartEmpty = (document.querySelector(this.EMPTY_CART_SELECTOR) || {}).offsetParent;\n\t\tconst isOnCartUrl = window.location.href.startsWith(CART_URL);\n\t\tconst isTotalEl = (document.querySelector(this.TOTAL_SELECTOR) || {}).offsetParent;\n\t\treturn !isCartEmpty && isOnCartUrl && isTotalEl;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.FORM_KEY = document.querySelector(this.FORM_KEY_SELECTOR).value;\n\t\tthis.REMOVE_REQUEST_EXTRA_VALUES = {\n\t\t\tremove: 1,\n\t\t\tform_key: this.FORM_KEY,\n\t\t};\n\t\tthis.APPLY_REQUEST_EXTRA_VALUES = {\n\t\t\tremove: 0,\n\t\t\tform_key: this.FORM_KEY,\n\t\t};\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tconst result = { code, finalPrice: originalPrice, finalDiscount: 0 };\n\t\t\t\tif (!responseString) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tresult.finalPrice = this._parseTotal(responseString);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\treturn this._removeCode(code, this._getRemoveRequestData(responseString)).then(() =>\n\t\t\t\t\tbus.$emit('code-checked', result),\n\t\t\t\t);\n\t\t\t}),\n\t\t);\n\t}\n\n\t_manageCode(requestURL, bodyObj) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\tbody: bodyObj,\n\t\t}).then(response => (response.status === 521 ? false : response.text()));\n\t}\n};\n\nexport default {\n\tname: 'My Freedom Smokes',\n\tdomain: 'myfreedomsmokes.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tmaxCoupons: 12,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { log } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\n/* Behavior description:\n * - can get existing codes\n * - can remove codes\n * - valid code can be replaced with another valid code\n * - can apply only one coupon code\n *\n * ======== Special case ========\n * remove support of 'Checkout' page due to merchants problems\n * Session timer 15 min\n */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = 'https://www.mypillow.com/checkout/cart';\n\t\tthis.TOTAL_SELECTOR = '.grand .price';\n\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /\"grand_total\":\"(\\d+\\.\\d+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\n\t\tthis.INPUT_CODE_SELECTOR = '#coupon_code, #discount-code';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t\tthis.SPINER_SELECTOR = '.table-wrapper._block-content-loading';\n\n\t\t// Clear this cookie to remove 'applied code' messages\n\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst totalValue = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst isInputElement = document.querySelector(this.INPUT_CODE_SELECTOR);\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst spiner = document.querySelector(this.SPINER_SELECTOR);\n\t\tconst correctPage = window.location.href.startsWith(this.CART_URL);\n\t\treturn totalValue && isInputElement && correctPage && !emptyCart && !spiner;\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst result = { code, finalPrice, finalDiscount, isValid: false };\n\n\t\t\t\tif (finalDiscount > 0) {\n\t\t\t\t\t// there are no invalid code error messages\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t}\n\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn super.applyCodes(codes).then(() => {\n\t\t\t// for cleaning error messages after applying code\n\t\t\tconst iframeElem = document.createElement('iframe');\n\t\t\tiframeElem.src = this.CART_URL;\n\t\t\tObject.assign(iframeElem.style, { display: 'none' });\n\t\t\tdocument.documentElement.appendChild(iframeElem);\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\treturn this._parseTotal(responseHTML);\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'MyPillow',\n\tdomain: 'mypillow.com',\n\tDriver,\n\tmaxCoupons: 8, // site can be slow\n\tisSinglePageApp: true,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format, log } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\n\nconst BASE_URL = 'https://www.ninewest.com';\nconst CHECKOUT_URL = `${BASE_URL}/checkout`;\nconst CART_URL = `${CHECKOUT_URL}/cart`;\nconst IS_CHECKOUT_PAGE = window.location.href.startsWith(CHECKOUT_URL) && !window.location.href.includes('cart');\nconst IS_ON_CART = window.location.href.startsWith(CART_URL);\nconst BASE_REQUEST_URL = `${BASE_URL}/rest/ninewest/V1`;\n\n/** Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#discount_code';\n\t\tthis.TOTAL_SELECTOR = IS_CHECKOUT_PAGE ? '.grand.incl .price' : '.grand.excl .price';\n\t\tthis.CODE_INPUT_SELECTOR = '#coupon_code, #discount-code';\n\t\tthis.SHIPPING_ELEM_SELECTOR = '.shipping .price';\n\n\t\tthis.ENTITY_ID_SELECTOR = new RegExp(/\"entity_id\":\"(.*?)\"/);\n\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\t\tthis.requestData = null;\n\t\tthis.updatedUrl = null;\n\t}\n\n\tcheckCondition() {\n\t\tconst totalElement = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst currentState = totalElement && codeInput;\n\t\treturn currentState;\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst authorization = document.querySelector('.authorization-link [data-post]');\n\n\t\t// there is no shipping value in the response when you change it on the cart page\n\t\tconst shippElem = IS_ON_CART ? document.querySelector(this.SHIPPING_ELEM_SELECTOR) : null;\n\t\tthis.shippValue = shippElem ? toFloat(shippElem.innerText) : 0;\n\n\t\tconst entityId = [...document.querySelectorAll('script')]\n\t\t\t.find(element => element.text.match(this.ENTITY_ID_SELECTOR))\n\t\t\t.text.match(this.ENTITY_ID_SELECTOR)[1];\n\t\tif (!authorization) {\n\t\t\tthis.requestData = {\n\t\t\t\taction: `${BASE_REQUEST_URL}/guest-carts/${entityId}/coupons/`,\n\t\t\t};\n\t\t\tthis.updatedUrl = `${BASE_REQUEST_URL}/guest-carts/${entityId}/payment-information`;\n\t\t} else {\n\t\t\tthis.requestData = {\n\t\t\t\taction: `${BASE_REQUEST_URL}/carts/mine/coupons/`,\n\t\t\t};\n\t\t\tthis.updatedUrl = `${BASE_REQUEST_URL}/carts/mine/payment-information`;\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getUpdatedCart().then(responseJSON => {\n\t\t\tconst codes = [responseJSON.totals.coupon_code].filter(Boolean);\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode()\n\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t.then(responseString => this._parseTotal(responseString));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code)\n\t\t\t\t.then(responseJSON => (responseJSON && responseJSON.message ? null : this._getUpdatedCart()))\n\t\t\t\t.then(responseJSON => {\n\t\t\t\t\tif (!responseJSON || responseJSON.status === 503) {\n\t\t\t\t\t\treturn bus.$emit('code-checked', {\n\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t\t\tisValid: false,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst finalPrice = this._parseTotal(responseJSON);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\treturn this._removeCode().then(() =>\n\t\t\t\t\t\tbus.$emit('code-checked', {\n\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\t\tisValid: true,\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseJSON => {\n\t\t\tconst taxValue = toFloat(responseJSON.totals.base_tax_amount);\n\t\t\tconst shippingValue = toFloat(responseJSON.totals.base_shipping_amount);\n\t\t\tconst totalValue = this._parseTotal(responseJSON);\n\t\t\tconst theLastValue = totalValue - shippingValue - taxValue;\n\t\t\treturn shippingValue === 0 ? theLastValue - this.shippValue : theLastValue;\n\t\t});\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(`${this.requestData.action}${code}`, 'PUT').then(responseJSON => responseJSON.json());\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode(this.requestData.action, 'DELETE');\n\t}\n\n\t_manageCode(requestURL, method) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t});\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\t// cart doesn't reload with changing shipping, but we receive this value after checkout\n\t\t\tconst total = toFloat(data.totals.base_grand_total);\n\t\t\treturn toFloat(data.totals.base_shipping_amount) === 0 ? total + this.shippValue : total;\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(this.updatedUrl, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t}).then(responseJSON => responseJSON.json());\n\t}\n};\n\nexport default {\n\tname: 'Nine West',\n\tdomain: 'ninewest.com',\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { log } from '../../../utils';\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Payment\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n*/\n\nconst BASE_URL = 'https://www.oneida.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout/onepage`;\nconst IS_ON_CART = window.location.href.startsWith(CART_URL);\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price';\n\t\tthis.CODE_CONTAINER_SELECTOR = '#checkout-step-payment';\n\t}\n\n\tcheckCondition() {\n\t\tconst totalValue = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst onCheckout = window.location.href.startsWith(CHECKOUT_URL);\n\t\tconst applyCodeElement = (document.querySelector(this.CODE_CONTAINER_SELECTOR) || {}).offsetParent;\n\t\treturn (IS_ON_CART && totalValue) || (onCheckout && applyCodeElement);\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(this.cartPageHTML)) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\t// send get request on checkout page to parse finalPrice\n\t\t// remove _removeCode method in order code can replace another code\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML))\n\t\t\t\t.then(responseString => (!IS_ON_CART ? this._getUpdatedCart() : responseString))\n\t\t\t\t.then(responseString => {\n\t\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\treturn bus.$emit('code-checked', { code, finalPrice, finalDiscount });\n\t\t\t\t}),\n\t\t);\n\t}\n\n\t_manageCode(requestURL, bodyObj) {\n\t\t// don't allow automatic redirection on checkout page as we have to send another request\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\tredirect: IS_ON_CART ? 'follow' : 'manual',\n\t\t\tbody: bodyObj,\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Oneida',\n\tdomain: 'oneida.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { DOM } from '../../../utils';\n\nconst { extractElement } = DOM;\n\nconst BASE_URL = 'https://www.papyrusonline.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/onestepcheckout`;\nconst IS_CART = window.location.href.startsWith(CART_URL);\nconst TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price, .onestepcheckout-totals strong .price';\n\n/** Behavior description\n+ Existing code: yes \n+ Remove code: yes, but not always\n+ Stackable:  no\n+ Free gift support:  no\n+ Free shipping:  no\n+ ‘isValid’ implemented: yes \n+ Codes can be replaced by another code:  yes\n+ Pages, where extension works:\n   - cart\n   - checkout\n+ Is driver SPA no\n+ Gather codes on site pages: no\n\ncan't remove code on cart page if shipping method is selected\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = TOTAL_SELECTOR; // On some websites this may differ.\n\t\tthis.INVALID_CODE_SELECTOR = '.error-msg';\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this._removeCode(code, this._getRemoveRequestData(this.cartPageHTML)))\n\t\t\t.then(() => (IS_CART ? this._getUpdatedCart() : this._getUpdatedCheckout())) // Promise.each() return array of applied codes.\n\t\t\t.then(responseString => this._parseTotal(responseString));\n\t}\n\n\t// check if the valid code was found\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tif (\n\t\t\t\t\textractElement(this.INVALID_CODE_SELECTOR, responseString) ||\n\t\t\t\t\t(extractElement(this.REMOVE_BTN_SELECTOR, responseString) &&\n\t\t\t\t\t\textractElement(this.REMOVE_BTN_SELECTOR, responseString).style.display === 'none')\n\t\t\t\t) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tconst promise = IS_CART ? Promise.resolve(responseString) : this._getUpdatedCheckout();\n\t\t\t\treturn promise.then(response => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(this.CART_URL, {\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_getUpdatedCheckout() {\n\t\treturn fetch(CHECKOUT_URL, {\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Papyrus',\n\tdomain: 'papyrusonline.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn (href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL)) && document.querySelector(TOTAL_SELECTOR);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { toFloat } = format;\n\nconst CART_URL = 'https://www.partsgeek.com/cart';\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes (via applying an invalid one)\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n*/\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.cart-coupon-text';\n\t\tthis.APPLIED_CODE_REGEX = /Coupon\\s*(\\w+)\\s*applied/;\n\t\tthis.TOTAL_SELECTOR = '.cart-total-value';\n\t\tthis.PRICES_SELECTOR = '.cart-totals-heading';\n\n\t\tthis.APPLY_COUPON_FORM_SELECTOR = '.cart-coupon-form';\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.removeRequestData = this._getApplyRequestData();\n\t\tthis.removeRequestData.params.set(this.REMOVE_CODE_PARAM_NAME, 'SAVE0');\n\t\tthis.removeRequestData.params.delete('remove'); // with this key requests aren't accepted\n\t}\n\n\tgetExistingCodes() {\n\t\tconst appliedCodesMsg = document.querySelector(this.APPLIED_CODES_SELECTOR).textContent;\n\t\tconst codeMatch = appliedCodesMsg.match(this.APPLIED_CODE_REGEX);\n\t\tconst codes = codeMatch ? [codeMatch[1]] : [];\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getCartPage().then(responseHTML => {\n\t\t\tconst shippingAndHandlingEl = this._findElement('Shipping and Handling', responseHTML);\n\t\t\tconst shippingAndHandling = shippingAndHandlingEl ? toFloat(shippingAndHandlingEl) || 0 : 0;\n\t\t\tconst shippingInsuranceEl = this._findElement('Shipping Insurance', responseHTML);\n\t\t\tconst shippingInsurance = shippingInsuranceEl ? toFloat(shippingInsuranceEl) || 0 : 0;\n\n\t\t\treturn this._parseTotal(responseHTML) - shippingAndHandling - shippingInsurance;\n\t\t});\n\t}\n\n\t_applyCode(code, requestData) {\n\t\t// Safari does not correctly extract form values\n\t\trequestData.params.set(this.APPLY_CODE_PARAM_NAME, code);\n\t\trequestData.params.delete('remove'); // with this key requests aren't accepted\n\t\treturn this._manageCode(requestData.action || CART_URL, requestData.params);\n\t}\n\n\t_removeCode() {\n\t\t// Safari does not correctly extract form values\n\t\treturn this._manageCode(this.removeRequestData.action || CART_URL, this.removeRequestData.params);\n\t}\n\n\t_findElement(targetString, response) {\n\t\tconst targetEl = [...extractElement(this.PRICES_SELECTOR, response, true)].find(el =>\n\t\t\tel.textContent.includes(targetString),\n\t\t);\n\t\treturn targetEl ? targetEl.nextElementSibling.textContent : null;\n\t}\n\n\t_getCartPage(url = window.location.href) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Parts Geek',\n\tdomain: 'partsgeek.com',\n\tDriver,\n\tisCartEmpty() {\n\t\tconst cartContent = document.querySelector('#content > table:first-child');\n\t\treturn cartContent && cartContent.offsetParent;\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\n\nconst CART_URL = 'https://peekkids.com/checkout/cart/';\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - valid code can be replaced with another valid code\n * - can't apply multiple codes (not stackable)\n * - show pop-up only on cart page, because other checkout steps have the problem to apply code manually\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.ITEM_CONTAINER_SELECTOR = true;\n\t}\n};\n\nexport default {\n\tname: 'Peek Kids',\n\tdomain: 'peekkids.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { sessionTimer } from '../../lib';\n\nconst CART_URL = 'https://www.peets.com/checkout/cart';\n\n/** Driver behavior description:\n -    Existing code: yes\n -    Remove code: yes\n -    Stackable: no\n -    Free gift support: no\n -    ‘isValid’ implemented: no\n Optional:\n -    Show message about free shipping on the cart page (without discount info): no\n -    Is driver SPA and add the condition to show popup: yes (run code testing on the cart page, \"Checkout / Shipping Method\", \"Checkout / Review & Place Order\")\n - \t  sessionTimer 15 min\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '[name=coupon_code]';\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price';\n\n\t\tthis.REQUEST_URL = 'https://www.peets.com/ajaxcontroller/cart/updateCoupon/';\n\t\tthis.SHIPPING_SELECTOR = '#opc-shipping';\n\t\tthis.REVIEW_SELECTOR = '#opc-review';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst shippingStepIsActive =\n\t\t\tdocument.querySelector(this.SHIPPING_SELECTOR) &&\n\t\t\tdocument.querySelector(this.SHIPPING_SELECTOR).classList.contains('active');\n\t\tconst reviewStepIsActive =\n\t\t\tdocument.querySelector(this.REVIEW_SELECTOR) &&\n\t\t\tdocument.querySelector(this.REVIEW_SELECTOR).classList.contains('active');\n\t\tconst emptyCart =\n\t\t\tdocument.querySelector(this.EMPTY_CART_SELECTOR) &&\n\t\t\tdocument.querySelector(this.EMPTY_CART_SELECTOR).offsetParent;\n\n\t\tconst checkoutURL =\n\t\t\thref.startsWith('https://www.peets.com/checkout/onepage/') && (shippingStepIsActive || reviewStepIsActive);\n\t\treturn (checkoutURL || href.startsWith(CART_URL)) && !emptyCart;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\t_manageCode(requestURL, bodyObj) {\n\t\treturn fetch(this.REQUEST_URL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: bodyObj,\n\t\t})\n\t\t\t.then(response => response.json())\n\t\t\t.then(response => response.update_sections['shopping-cart-totals']);\n\t}\n};\n\nexport default {\n\tname: 'Peets Coffee',\n\tdomain: 'peets.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tmaxCoupons: 10,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format, log, browserUtils, completionActions } from '../../../utils';\nimport { wait } from '../../../utils/browser';\nimport { setValue, runEmbeddedScript } from '../../../utils/DOM';\n\nconst { elemToFloat, toFloat } = format;\nconst { getCookie } = browserUtils;\n\nconst isOnShiping = () => window.location.href.includes('shipping-method');\nconst isOnPayment = () => window.location.href.includes('payment-information');\nconst loggedInUserOnShipping = () => {\n\treturn (\n\t\tsessionStorage.state &&\n\t\t!JSON.parse(sessionStorage.getItem('state')).information.guest &&\n\t\t(isOnShiping() || isOnPayment())\n\t);\n};\n\n/*\nDriver behavior description:\n- Existing code: yes\n- Remove code: yes\n- Stackable:  no\n- Free gift support:  no\n- Free shipping:  no\n- IsSinglePageApp: yes\n- ‘isValid’ implemented: yes\n- Codes can be replaced by another code:  no\n- Manually apply code: yes (on shipping for logged in user)\n- Manually remove code: yes (n shipping for logged in user)\n- GetMerchantCodes: yes, from header on Cart and Checkout\nSpecial cases:\n\t- removing and applying code may change shipping method but we restore it after code testing\n\t- Pages, where extension works: cart (only if there is available promo code input), checkout shipping step\n\t- Don't support Payment, because after our extension works shipping method is default\n\t- Special case about the driver works: sometimes clear shipping method on shipping step\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.DOMAIN = 'prettylittlething.us';\n\t\tthis.checkoutUrl = `https://checkout.${this.DOMAIN}/checkout-api`;\n\t\tthis.APPLIED_CODES_SELECTOR = '.code, .c-coupon__selected';\n\t\tthis.TOTAL_SELECTOR = '.grandTotalContainer .amount, .bag__totals-item:last-child :last-child';\n\t\tthis.BAG_ITEM_SELECTOR = 'li.bag__totals-item span';\n\t\tthis.DISCOUNT_REGEX = /\\((\\w+)\\)/;\n\t\tthis.CODE_INPUT_SELECTOR = '#coupon';\n\t\tthis.CONTINUE_BUTTON_SELECTOR = '.box__content-container [type=\"submit\"]';\n\t\tthis.REMOVE_CODE_SELECTOR = '.block-current-coupon__coupon button';\n\t\tthis.APPLY_BUTTON_SELECTOR = '.c-coupon__combined-input button';\n\t\tthis.IS_ON_CART = window.location.href.includes('checkout/cart');\n\t\tthis.MERCHANT_CODES_SELECTOR = '.banner_schedule_json';\n\t\tthis.MERCHANT_CODES_REGEX = /enter: (\\w+)/i;\n\t\tthis.WARNING_CODE_SELECTOR = '.coupon-content_message';\n\t\tthis.WARNING_CODE_REGEX = /except (\\w+)/;\n\t\tthis.FORM_KEY_SELECTOR = '#form_key';\n\t\tthis.TITLE_SELECTOR = '.page-title';\n\t\tthis.bodyData = new URLSearchParams();\n\t\tthis.LOADER_SELECTOR = '.app-loading-spinner';\n\t\tthis.SUBMIT_BTN_SELECTOR = '.c-button';\n\t\tthis.SHIPPING_METHOD_LIST = '.c-shipping-method__list input[name=\"shipping-method\"]';\n\t\tthis.SHIPPING_METHOD_SELECTOR = '[name=\"shipping-method\"]';\n\t\tthis.LOADING_BUTTON_SELECTOR = '.btn--loading';\n\t\tthis.SHIPPING_ON_PAYMENT_SELECTOR = '#shippingMethodHeaderText';\n\n\t\tthis.REQUEST_DELAY = 3000;\n\t}\n\n\tcheckCondition() {\n\t\tconst titleEl = document.querySelector(this.TITLE_SELECTOR);\n\t\tconst isCartEmpty = titleEl && titleEl.textContent.toLowerCase().includes('cart is empty');\n\t\tconst isOnRightURL = this.IS_ON_CART || isOnShiping() || loggedInUserOnShipping();\n\t\tconst loader = document.querySelector(this.LOADER_SELECTOR);\n\t\tconst isCodeInputAvailable = this.IS_ON_CART ? document.querySelector(this.TOTAL_SELECTOR) : true;\n\t\tconst loadingButton = document.querySelector(this.LOADING_BUTTON_SELECTOR);\n\t\tconst state = JSON.parse(sessionStorage.getItem('state'));\n\t\tconst ajaxCallsInProgress = state && state.ajaxCallsInProgress > 0;\n\t\treturn (\n\t\t\t!isCartEmpty && isOnRightURL && !loader && isCodeInputAvailable && !loadingButton && !ajaxCallsInProgress\n\t\t);\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\tconst submitBtn = document.querySelector(this.SUBMIT_BTN_SELECTOR);\n\t\tconst shippingMethodList = document.querySelector(this.SHIPPING_METHOD_LIST);\n\t\treturn shippingMethodList && !submitBtn.disabled && !loggedInUserOnShipping();\n\t}\n\n\tgetUserData() {\n\t\tif (document.querySelector(this.SHIPPING_METHOD_LIST)) {\n\t\t\tconst shippingMethodElement = [...document.querySelectorAll(this.SHIPPING_METHOD_LIST)].find(\n\t\t\t\tel => el.checked,\n\t\t\t);\n\n\t\t\treturn { shippingMethodValue: shippingMethodElement.value };\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tsetUserData(userData) {\n\t\tdocument.querySelector(`${this.SHIPPING_METHOD_LIST}[value=\"${userData.shippingMethodValue}\"]`).click();\n\t}\n\n\tbeforeTestCodes() {\n\t\tif (this.IS_ON_CART) {\n\t\t\tthis.FORM_KEY = document.querySelector(this.FORM_KEY_SELECTOR).value;\n\t\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\n\t\t\t};\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\taccept: 'application/json',\n\t\t\t'X-CSRF-TOKEN': getCookie('_csrf'),\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t'x-dtpc': getCookie('dtPC'),\n\t\t};\n\n\t\tif (isOnPayment()) {\n\t\t\tthis.POSTAL_CODE = document.querySelector('.postcode').textContent;\n\t\t\tif (document.querySelector(this.SHIPPING_ON_PAYMENT_SELECTOR).textContent.match(/usa standard/i)) {\n\t\t\t\tthis.shippingMethodValue = 'flatrate12_flatrate12';\n\t\t\t}\n\t\t\tthis.shippingMethodValue = 'flatrate11_flatrate11';\n\t\t} else {\n\t\t\tthis.shippingMethodValue = [...document.querySelectorAll(this.SHIPPING_METHOD_SELECTOR)]\n\t\t\t\t.find(el => el.checked)\n\t\t\t\t.getAttribute('value');\n\t\t}\n\t\tthis.STATE = JSON.parse(sessionStorage.getItem('state'));\n\n\t\tlet shippingAddress;\n\t\tconst selectedAddress =\n\t\t\tthis.STATE.form.shippingInformation && this.STATE.form.shippingInformation.values['select-address'];\n\t\tif (selectedAddress === 'new-address') {\n\t\t\tshippingAddress = this.STATE.form.shippingInformation.values;\n\t\t} else if (loggedInUserOnShipping()) {\n\t\t\tshippingAddress = selectedAddress\n\t\t\t\t? this.STATE.information.customer.addresses.find(address => address.uid === selectedAddress)\n\t\t\t\t: this.STATE.information.customer.addresses[0];\n\t\t\tshippingAddress.address1 =\n\t\t\t\tshippingAddress.addressLine1 && shippingAddress.addressLine1.length\n\t\t\t\t\t? shippingAddress.addressLine1\n\t\t\t\t\t: null;\n\t\t\tshippingAddress.address2 =\n\t\t\t\tshippingAddress.addressLine2 && shippingAddress.addressLine2.length\n\t\t\t\t\t? shippingAddress.addressLine2\n\t\t\t\t\t: null;\n\t\t} else {\n\t\t\tshippingAddress = this.STATE.form.billingInformation.values;\n\t\t}\n\t\tshippingAddress.billingCountryPhoneId = this.STATE.telephone.selectedBillingCountryPhoneId;\n\n\t\tconst shippingPrice = toFloat(this.STATE.bag.shipping.price)\n\t\t\t.toFixed(2)\n\t\t\t.toString();\n\t\tthis.updateBodyData = new URLSearchParams({\n\t\t\toption: this.shippingMethodValue,\n\t\t\tshippingMethodDetails: JSON.stringify({\n\t\t\t\tprice: shippingPrice,\n\t\t\t\tname: this.STATE.bag.shipping.name,\n\t\t\t\toriginalPrice: shippingPrice,\n\t\t\t}),\n\t\t\tsyncQuote: false,\n\t\t\tstoreId: this.STATE.information.store_id,\n\t\t\tsessionId: this.STATE.init.sessionId,\n\n\t\t\tshippingAddress: JSON.stringify(shippingAddress),\n\t\t});\n\t\treturn Promise.resolve();\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst codesFromPromo = [document.querySelector(this.MERCHANT_CODES_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODES_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t\tconst codesFromWarning = [...document.querySelectorAll(this.WARNING_CODE_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.WARNING_CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\n\t\treturn [...new Set([...codesFromPromo, ...codesFromWarning])];\n\t}\n\n\tgetExistingCodes() {\n\t\t// at first try to take code from bag summary, because in coupon section may display invalid code\n\t\tconst codesFromBagSummary = [...document.querySelectorAll(this.BAG_ITEM_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.DISCOUNT_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t\tconst codes = codesFromBagSummary.length\n\t\t\t? codesFromBagSummary\n\t\t\t: [document.querySelector(this.APPLIED_CODES_SELECTOR)]\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(el => el.textContent.trim())\n\t\t\t\t\t.filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0], true)\n\t\t\t.then(responseJson => (this.IS_ON_CART ? responseJson : this._updateCartData()))\n\t\t\t.then(responseJson => {\n\t\t\t\tif (loggedInUserOnShipping()) {\n\t\t\t\t\treturn this._removeCodeManually().then(() => this._parseTotal());\n\t\t\t\t}\n\n\t\t\t\t// take total from response, as removing code may change shiping\n\t\t\t\treturn this._parseTotal(responseJson);\n\t\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code => {\n\t\t\tif (code === 'SHIPNOW') {\n\t\t\t\treturn bus.$emit('code-checked', {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\t\t\t\tif (responseJSON.error || responseJSON.success === false) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn (this.IS_ON_CART ? responseJSON : this._updateCartData()).then(updatedResponse => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(updatedResponse);\n\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\treturn this._removeCode(code, true).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\tif (loggedInUserOnShipping()) {\n\t\t\tbus.$emit('change-completion-action', completionActions.none);\n\t\t\treturn this._applyCodeManually(codes[0]);\n\t\t}\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_applyCodeManually(code) {\n\t\tconst inputEl = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tsetValue(inputEl, code, 'input');\n\t\tdocument.querySelector(this.APPLY_BUTTON_SELECTOR).click();\n\t}\n\n\t_removeCodeManually() {\n\t\tconst removeButton = document.querySelector(this.REMOVE_CODE_SELECTOR);\n\t\tif (removeButton) {\n\t\t\tremoveButton.click();\n\t\t}\n\t\tconst continueButton = document.querySelector(this.CONTINUE_BUTTON_SELECTOR);\n\t\treturn wait(\n\t\t\t() => continueButton && !continueButton.disabled && document.querySelector(this.CODE_INPUT_SELECTOR),\n\t\t);\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(code);\n\t}\n\n\t_removeCode(code) {\n\t\treturn this._manageCode(code, true);\n\t}\n\n\t_manageCode(code, isRemove) {\n\t\tlet url = '';\n\t\tif (this.IS_ON_CART) {\n\t\t\tthis._setCartData(code, isRemove);\n\t\t\turl = `https://www.${this.DOMAIN}/pltmobile/coupon/couponPost/`;\n\t\t} else if (isOnPayment()) {\n\t\t\tthis._setPaymentData(code, isRemove);\n\t\t\turl = `${this.checkoutUrl}/coupon${!isRemove ? '/set' : ''}`;\n\t\t} else {\n\t\t\tthis._setCheckoutData(code, isRemove);\n\t\t\turl = `${this.checkoutUrl}/coupon${!isRemove ? '/set' : ''}`;\n\t\t}\n\n\t\treturn this._sendRequest(url, this.bodyData);\n\t}\n\n\tasync _updateCartData() {\n\t\treturn this._sendRequest(`${this.checkoutUrl}/shipping_method`, this.updateBodyData);\n\t}\n\n\tasync _sendRequest(url, body) {\n\t\tlocalStorage.removeItem('genieResponse'); // for stability\n\t\tawait Promise.delay(this.REQUEST_DELAY);\n\t\tawait runEmbeddedScript(\n\t\t\t`fetch('${url}', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: ${JSON.stringify(this.MANAGE_CODE_HEADERS)},\n\t\t\t\tbody: '${body}'\n\t\t\t})\n\t\t\t.then(response => response.json())\n\t\t\t.then(json => localStorage.setItem('genieResponse', JSON.stringify(json)));`,\n\t\t);\n\t\tawait wait(() => localStorage.getItem('genieResponse'), 100000, 50);\n\t\treturn JSON.parse(localStorage.getItem('genieResponse'));\n\t}\n\n\t_setCartData(code, isRemove) {\n\t\tthis.bodyData.set('code', code);\n\t\tthis.bodyData.set('form_key', this.FORM_KEY);\n\t\tthis.bodyData.delete('remove');\n\t\tif (isRemove) {\n\t\t\tthis.bodyData.set('remove', 1);\n\t\t}\n\t}\n\n\t_setCheckoutData(code, isRemove) {\n\t\tif (!isRemove) {\n\t\t\tthis.bodyData.set('coupon_code', code);\n\t\t}\n\t\tthis.bodyData.set('form_key', '');\n\t\tconst shippingData = loggedInUserOnShipping()\n\t\t\t? this.STATE.information.customer.addresses[0]\n\t\t\t: this.STATE.form.billingInformation.values;\n\t\tthis.bodyData.set('countryId', shippingData.countryId);\n\t\tthis.bodyData.set('postcode', shippingData.postcode);\n\t\tthis.bodyData.set(\n\t\t\t'loadShippingMethods',\n\t\t\t`function(e) {return { type: r.GET_COUPON_SHIPPING_METHODS_SUCCESS, payload: e };}`,\n\t\t);\n\t}\n\n\t_setPaymentData(code, isRemove) {\n\t\tif (!isRemove) {\n\t\t\tthis.bodyData.set('coupon_code', code);\n\t\t\tthis.bodyData.set(\n\t\t\t\t'loadShippingMethods',\n\t\t\t\t'function(e){return{type:r.GET_COUPON_SHIPPING_METHODS_SUCCESS,payload:e}}',\n\t\t\t);\n\t\t}\n\t\tthis.bodyData.set('postcode', this.POSTAL_CODE);\n\t\tthis.bodyData.set('countryId', 'US');\n\t\tthis.bodyData.set('form_key', '');\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn toFloat(data && data.quote ? data.quote.quote.grand_total : data.grand_total);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'PrettyLittleThing US',\n\tdomain: 'prettylittlething.us',\n\tshowDifferentDiscountMessage: true,\n\tisSinglePageApp: true,\n\trestoreUserData: true,\n\tDriver,\n};\n","import MagentoTemplate from './_base';\n\nconst CART_URL = 'https://quickcandles.com/checkout/cart/';\n\n/* Behaviour description:\n- we can apply only one code;\n- we can remove code;\n- invalid code removes valid */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.NEED_REMOVE_CODE = false;\n\t}\n};\n\nexport default {\n\tname: 'Quick Candles',\n\tdomain: 'quickcandles.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { log } from '../../../utils';\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes, replace one code by another one\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n+ maxCoupons: on Cart - 17, on Checkout - 11, due to test time\n+ always get price from Cart response, because on Cart page response doesn't always include tax (so if tax present original price in console can be not the same that is on page)\n  for Checkout page get all data from Cart(so total will be not the same that is shown on Checkout page), because in Checkout response we get total without tax and shipping\n  after visiting Payment step(total includes tax and shiping)\n*/\n\nconst CART_URL = 'https://www.reeds.com/checkout/cart';\nconst CHECKOUT_URL = 'https://www.reeds.com/checkout';\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code';\n\t\tthis.TOTAL_SELECTOR = '.grand .price';\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /\"grand_total\".\"([0-9,.]+)(?=\")/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t}\n\n\tbeforeCheckCodes(originalPrice) {\n\t\tif (originalPrice) {\n\t\t\treturn originalPrice;\n\t\t}\n\t\tif (this._isOnCart()) {\n\t\t\t// on Cart page total includes tax, but response total without tax\n\t\t\treturn this._getUpdatedCart().then(response => this._parseTotal(response));\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(this.cartPageHTML)) {\n\t\tlog(`Original price: ${originalPrice}`);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML))\n\t\t\t\t// on Checkout page total doesn't include shipping, need to get total from Cart\n\t\t\t\t.then(response => (this._isOnCart() ? response : this._getUpdatedCart()))\n\t\t\t\t.then(responseString => {\n\t\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\n\t\t\t\t\treturn bus.$emit('code-checked', { code, finalPrice, finalDiscount });\n\t\t\t\t}),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Reeds Jewelers',\n\tdomain: 'reeds.com',\n\tDriver,\n\tmaxCoupons: window.location.href.startsWith(CART_URL) ? 17 : 11, // due to test time\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL);\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\n\nimport { format, DOM, log } from '../../../utils';\nimport MagentoTemplate from './_base';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nDriver behaviour description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    'isValid' implemented: yes(we marked all codes as false if we have fake apply, in other case we marked all codes as true)\n•    Codes can be replaced by another code: no\n•    Pages, where extension works: Cart, Checkout(Payment & Review)\n•    sessionTimer : no\n*/\n\nconst BASE_URL = 'https://www.riteaid.com';\nconst IS_ON_CART = window.location.href.includes(`${BASE_URL}/shop/checkout/cart`);\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.INPUT_CODE_SELECTOR = '#coupon_code, #discount-code';\n\t\tthis.TOTAL_SELECTOR = '.grand.totals .price';\n\t\tthis.FORM_KEY_SELECTOR = 'input[name=form_key]';\n\n\t\tthis.QUOTE_ID_REGEXP = /quoteId[\"]?[:]?[\"]?(.\\w+)/;\n\n\t\tthis.MERCHANT_CODE_SELECTOR = '.promotional-header-message-container';\n\t\tthis.MERCHANT_CODE_REGEX = /use promo code[:]?\\s+(.\\w+)/i;\n\t\tthis.APPLIED_COUPON_SALE_SELECTOR = '.discount.coupon';\n\t\tthis.CART_EMPTY = '.cart-empty';\n\t\tthis.LOADER = '.loader';\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\t}\n\n\tcheckCondition() {\n\t\tconst isCorrectUrl = IS_ON_CART || window.location.href.includes('checkout/#payment');\n\t\tconst isCartEmpty = document.querySelector(this.CART_EMPTY);\n\t\tconst isInputPresent = document.querySelector(this.INPUT_CODE_SELECTOR);\n\t\tconst isLoading = document.querySelector(this.LOADER) && document.querySelector(this.LOADER).offsetParent;\n\t\tconst isTotalPresent = document.querySelector(this.TOTAL_SELECTOR);\n\n\t\treturn isCorrectUrl && !isCartEmpty && isInputPresent && !isLoading && isTotalPresent;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.userIsLogged = this._getWindowObjectData('window.checkoutConfig.isCustomerLoggedIn');\n\n\t\tconst postcode = this._getWindowObjectData(\n\t\t\t'window.checkoutConfig.payment.sd_applepay.paymentRequest.shippingContact.postalCode',\n\t\t);\n\n\t\tconst region = this._getWindowObjectData(\n\t\t\t'window.checkoutConfig.payment.sd_applepay.paymentRequest.shippingContact.administrativeArea',\n\t\t);\n\n\t\tconst countryId = this._getWindowObjectData(\n\t\t\t'window.checkoutConfig.payment.sd_applepay.paymentRequest.shippingContact.countryCode',\n\t\t);\n\n\t\tif (this.userIsLogged) {\n\t\t\tthis.quoteId = 'mine';\n\t\t} else {\n\t\t\tconst quoteIdActions = JSON.parse(localStorage.getItem('mage-cache-storage')).cart.extra_actions;\n\t\t\t[, this.quoteId] = quoteIdActions.match(this.QUOTE_ID_REGEXP);\n\t\t}\n\n\t\tconst bodyData = this._getWindowObjectData('window.checkoutConfig.selectedShippingMethod');\n\t\tconst bodyDataAddress = { countryId: countryId.toUpperCase() };\n\t\tbodyDataAddress.postcode = postcode || null;\n\t\tbodyDataAddress.region = region || '';\n\n\t\tthis.bodyData = {\n\t\t\taddressInformation: {\n\t\t\t\taddress: bodyDataAddress,\n\t\t\t\tshipping_method_code: bodyData ? bodyData.method_code : 'freeshipping',\n\t\t\t\tshipping_carrier_code: bodyData ? bodyData.carrier_code : 'freeshipping',\n\t\t\t},\n\t\t};\n\t\t// eslint-disable-next-line camelcase\n\t\tconst form_key = document.querySelector(this.FORM_KEY_SELECTOR).value;\n\t\tthis.body = new URLSearchParams({\n\t\t\tform_key,\n\t\t});\n\t\treturn Promise.resolve();\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.MERCHANT_CODE_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(res => res[1]);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.INPUT_CODE_SELECTOR)]\n\t\t\t.map(codeElement => codeElement.value)\n\t\t\t.filter(Boolean);\n\n\t\tif (codes.length === 0 && document.querySelector(this.APPLIED_COUPON_SALE_SELECTOR)) {\n\t\t\tthis.FAKE_CODE_APPLY = true;\n\t\t}\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode().then(() =>\n\t\t\tthis._getUpdatedCart().then(responseHTML => this._parseTotal(responseHTML)),\n\t\t);\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\n\t\t\tif (this.FAKE_CODE_APPLY) {\n\t\t\t\tresult.isValid = false;\n\t\t\t\treturn Promise.delay(1000).then(() => bus.$emit('code-checked', result));\n\t\t\t}\n\n\t\t\treturn this._applyCode(code).then(() =>\n\t\t\t\tthis._getUpdatedCart().then(responseHTML => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseHTML);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\tif (this.afterCodeCheck) {\n\t\t\tthis.afterCodeCheck();\n\t\t}\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(res => {\n\t\t\tif (IS_ON_CART) {\n\t\t\t\treturn res.base_subtotal_with_discount;\n\t\t\t}\n\t\t\treturn res.totals.base_subtotal_with_discount;\n\t\t});\n\t}\n\n\t_removeCode() {\n\t\tif (IS_ON_CART) {\n\t\t\tthis.body.set('remove', 1);\n\t\t\tthis.body.set('coupon_code', '');\n\t\t\treturn this._manageCode();\n\t\t}\n\t\treturn this._manageCode('DELETE');\n\t}\n\n\t_applyCode(code) {\n\t\tif (IS_ON_CART) {\n\t\t\tthis.body.set('remove', 0);\n\t\t\tthis.body.set('coupon_code', code);\n\t\t\treturn this._manageCode();\n\t\t}\n\t\treturn this._manageCode('PUT', code);\n\t}\n\n\t_manageCode(method, code = '') {\n\t\tif (IS_ON_CART) {\n\t\t\treturn fetch(`${BASE_URL}/shop/checkout/cart/couponPost`, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\t},\n\t\t\t\tbody: this.body,\n\t\t\t});\n\t\t}\n\t\treturn fetch(\n\t\t\t`${BASE_URL}/shop/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\tthis.quoteId\n\t\t\t}/coupons/${code}`,\n\t\t\t{\n\t\t\t\tmethod,\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\t_getUpdatedCart() {\n\t\tif (IS_ON_CART) {\n\t\t\treturn fetch(\n\t\t\t\t`${BASE_URL}/shop/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\t\tthis.quoteId\n\t\t\t\t}/totals-information`,\n\t\t\t\t{\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcredentials: 'include',\n\t\t\t\t\tbody: JSON.stringify(this.bodyData),\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t).then(response => response.json());\n\t\t}\n\t\treturn fetch(\n\t\t\t`${BASE_URL}/shop/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\tthis.quoteId\n\t\t\t}/payment-information?_=${Date.now()}`,\n\t\t\t{\n\t\t\t\tmethod: 'GET',\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t},\n\t\t\t},\n\t\t).then(response => response.json());\n\t}\n\n\t_getWindowObjectData(variableString) {\n\t\t// We will put generated request payload to this element\n\t\tconst requestDataElement = document.createElement('div');\n\t\trequestDataElement.id = 'get-data-genie';\n\t\tObject.assign(requestDataElement.style, { display: 'none' });\n\n\t\tdocument.documentElement.appendChild(requestDataElement);\n\n\t\t// Script which will generate request payload\n\t\tconst requestDataScript = document.createElement('script');\n\t\trequestDataScript.textContent = `document.getElementById(\"${\n\t\t\trequestDataElement.id\n\t\t}\").innerText = JSON.stringify(${variableString});`;\n\t\tdocument.documentElement.appendChild(requestDataScript);\n\t\tconst data = JSON.parse(requestDataElement.innerText);\n\t\t// Remove created blocks\n\t\trequestDataElement.parentNode.removeChild(requestDataElement);\n\t\trequestDataScript.parentNode.removeChild(requestDataScript);\n\t\treturn data;\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\tif (IS_ON_CART) {\n\t\t\t\treturn toFloat(data.base_grand_total);\n\t\t\t}\n\t\t\treturn toFloat(data.totals.base_grand_total);\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'Rite Aid',\n\tdomain: 'riteaid.com',\n\tisSinglePageApp: true,\n\tmaxCoupons: 8,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport MagentoTemplate from './_base';\nimport { DOM, log, format, sendXhr } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement } = DOM;\nconst BASE_URL = 'https://www.scrubsandbeyond.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout/#payment`;\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: no\n•    Stackable: no\n•    Free gift support: no\n•    ‘isValid’ implemented: no\n•    Manually apply code: no\n•    maxCoupons: 2 - for logged, for not - 5\n•    Active pages: cart, checkout(payment step) - user will be redirected to the 1 step of the checkout but his data will be saved\nOptional:\n•    Show message about free shipping on the cart page: no\n•    Is driver SPA and add the condition to show popup: yes\n•    Gather codes on site pages: no */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #discount-code';\n\t\tthis.APPLY_COUPON_FORM_SELECTOR = '#discount-coupon-form, #discount-form';\n\n\t\tthis.TOTAL_SELECTOR = '.grand .price';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t\tthis.TAX_SELECTOR = '.totals-tax span.price';\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\n\t\tthis.QUOTE_ID_REGEXP = /entity_id\":\"([A-Za-z0-9]+)(?=\")/;\n\n\t\tthis.LOAD_SELECTOR = '#checkout-loader';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst emptyCartElem = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst emptyCart = emptyCartElem && emptyCartElem.offsetParent;\n\t\tconst totalElem = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst loadElem = document.querySelector(this.LOAD_SELECTOR);\n\t\tconst isOnCartUrl = href.startsWith(CART_URL) && !emptyCart;\n\t\treturn ((href.startsWith(CHECKOUT_URL) && !loadElem) || isOnCartUrl) && totalElem && totalElem.offsetParent;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.HEADERS = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t};\n\t\tthis.isTotalwithoutTaxes =\n\t\t\twindow.location.href.startsWith(CART_URL) && !document.querySelector(this.TAX_SELECTOR);\n\n\t\tthis.userIsLogged = this._getWindowObjectData('window.checkoutConfig.isCustomerLoggedIn');\n\n\t\tif (this.userIsLogged) {\n\t\t\tthis.quoteId = 'mine';\n\t\t} else {\n\t\t\tconst quoteScript = [...document.scripts].find(el => el.text.match(this.QUOTE_ID_REGEXP));\n\t\t\t[, this.quoteId] = quoteScript.text.match(this.QUOTE_ID_REGEXP);\n\t\t}\n\t\tif (window.location.href.startsWith(CART_URL)) {\n\t\t\tconst bodyData = this._getWindowObjectData('window.checkoutConfig.selectedShippingMethod');\n\t\t\tconst bodyDataAddress = { countryId: 'US', postcode: '*', region: 'R', regionId: '0' };\n\n\t\t\tthis.bodyData = {\n\t\t\t\taddressInformation: {\n\t\t\t\t\taddress: bodyDataAddress,\n\t\t\t\t\tshipping_carrier_code: bodyData ? bodyData.carrier_code : 'tablerate',\n\t\t\t\t\tshipping_method_code: bodyData ? bodyData.method_code : 'bestway',\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\t// need to add time to render existing code\n\t\treturn Promise.delay(1500);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR).value].filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode();\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this._getTotalInfo().then(responseJson => ({\n\t\t\toriginalPrice: this._parseTotal(responseJson),\n\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tif (responseJSON.message) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\treturn this._getTotalInfo().then(response => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\treturn this._removeCode().then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getTotalInfo().then(responseJSON => {\n\t\t\tconst totalsData = this.isTotalwithoutTaxes ? responseJSON : responseJSON.totals;\n\t\t\tconst total = this._parseTotal(responseJSON);\n\t\t\tconst shipping = toFloat(totalsData.base_shipping_amount);\n\t\t\tconst taxes = toFloat(totalsData.base_tax_amount);\n\t\t\treturn total - shipping - taxes;\n\t\t});\n\t}\n\n\t_getTotalInfo() {\n\t\tif (this.isTotalwithoutTaxes) {\n\t\t\treturn sendXhr(\n\t\t\t\t`${BASE_URL}/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\t\tthis.quoteId\n\t\t\t\t}/totals-information`,\n\t\t\t\t{\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcredentials: 'include',\n\t\t\t\t\tbody: JSON.stringify(this.bodyData),\n\t\t\t\t\theaders: this.HEADERS,\n\t\t\t\t},\n\t\t\t).then(response => response.json());\n\t\t}\n\t\treturn sendXhr(\n\t\t\t`${BASE_URL}/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\tthis.quoteId\n\t\t\t}/payment-information?_=${Date.now()}`,\n\t\t\t{\n\t\t\t\tmethod: 'GET',\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: this.HEADERS,\n\t\t\t},\n\t\t).then(response => response.json());\n\t}\n\n\t_manageCode(method, code = '') {\n\t\treturn sendXhr(\n\t\t\t`${BASE_URL}/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\tthis.quoteId\n\t\t\t}/coupons/${code}`,\n\t\t\t{\n\t\t\t\tmethod,\n\t\t\t\tcredentials: 'include',\n\t\t\t\tbody: JSON.stringify(this.bodyData),\n\t\t\t\theaders: this.HEADERS,\n\t\t\t},\n\t\t).then(response => response.json());\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode('PUT', code);\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode('DELETE');\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn data.totals ? toFloat(data.totals.base_grand_total) : toFloat(data.base_grand_total);\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR));\n\t}\n\n\t_getWindowObjectData(variableString) {\n\t\t// We will put generated request payload to this element\n\t\tconst requestDataElement = document.createElement('div');\n\t\trequestDataElement.id = 'get-data-genie';\n\t\tObject.assign(requestDataElement.style, { display: 'none' });\n\n\t\tdocument.documentElement.appendChild(requestDataElement);\n\n\t\t// Script which will generate request payload\n\t\tconst requestDataScript = document.createElement('script');\n\t\trequestDataScript.textContent = `document.getElementById(\"${\n\t\t\trequestDataElement.id\n\t\t}\").innerText = JSON.stringify(${variableString});`;\n\t\tdocument.documentElement.appendChild(requestDataScript);\n\t\tconst data = JSON.parse(requestDataElement.innerText);\n\t\t// Remove created blocks\n\t\trequestDataElement.parentNode.removeChild(requestDataElement);\n\t\trequestDataScript.parentNode.removeChild(requestDataScript);\n\t\treturn data;\n\t}\n};\n\nexport default {\n\tname: 'Scrubs and Beyond',\n\tdomain: 'scrubsandbeyond.com',\n\tDriver,\n\tmaxCoupons: document.querySelector('.logged') ? 2 : 5, // code testing for logged in user is very slowly\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { DOM, format, log } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+ Pages, where extension works: cart page and on payment page\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n+ Need additional request for getting price\n*/\n\nconst BASE_URL = 'https://www.shiekh.com/checkout';\nconst BASE_REQUEST_URL = 'https://www.shiekh.com/rest/shiekhcom/V1';\nconst CART_URL = `${BASE_URL}/cart`;\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #discount-code';\n\t\tthis.TOTAL_SELECTOR = '.grand.totals .price';\n\t\tthis.TAX_SELECTOR = '.totals-tax';\n\t\tthis.LOGIN_SELECTOR = '.welcome span';\n\t\tthis.REMOVE_BUTTON_SELECTOR = '#discount-form .action-cancel';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#discount-form .action-apply';\n\t\tthis.ENTITY_ID_REG = /entity_id\":\"(\\w+)/;\n\t\tthis.ENTITY_ID = null;\n\t\tthis.URL_STRING = null;\n\t\tthis.IS_PAYMENT = null;\n\t\tthis.params = new URLSearchParams();\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isCartHref = href.startsWith(`${BASE_URL}/#payment`) || href.startsWith(CART_URL);\n\t\tconst isTotal = Boolean(document.querySelector(this.TOTAL_SELECTOR));\n\t\treturn isCartHref && isTotal;\n\t}\n\n\tbeforeTestCodes() {\n\t\t[, this.ENTITY_ID] = [...document.querySelectorAll('script')]\n\t\t\t.find(element => element.text.match(this.ENTITY_ID_REG))\n\t\t\t.text.match(this.ENTITY_ID_REG);\n\t\tthis.URL_STRING = document.querySelector(this.LOGIN_SELECTOR) ? 'carts/mine' : `guest-carts/${this.ENTITY_ID}`;\n\t\tthis.IS_PAYMENT = window.location.href.startsWith(`${BASE_URL}/#payment`);\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\treturn Promise.resolve()\n\t\t\t.then(() => (this.IS_PAYMENT ? this._getCodeFromCart() : false))\n\t\t\t.then(html => {\n\t\t\t\tconst codes = [extractElement(this.APPLIED_CODES_SELECTOR, html)]\n\t\t\t\t\t.map(element => element.defaultValue)\n\t\t\t\t\t.filter(Boolean);\n\n\t\t\t\treturn {\n\t\t\t\t\tcodes,\n\t\t\t\t\tcodeCount: codes.length,\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode()\n\t\t\t.then(() => this._getPrice())\n\t\t\t.then(responseJSON => this._parseTotal(responseJSON));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(response => {\n\t\t\t\tif (response) {\n\t\t\t\t\treturn this._getPrice().then(responseJSON => {\n\t\t\t\t\t\tif (!responseJSON) {\n\t\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseJSON);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t});\n\t\t});\n\t}\n\n\tbeforeApplyCodes() {\n\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\treturn Promise.resolve();\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_removeCode(code) {\n\t\treturn this._manageCode('1', code);\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode('0', code);\n\t}\n\n\t_manageCode(param, code) {\n\t\tthis.params.set('coupon_code', code);\n\t\tthis.params.set('remove', param);\n\t\treturn fetch(`${BASE_URL}/cart/couponPost/`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: this.params,\n\t\t\theaders: {\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t},\n\t\t});\n\t}\n\n\t_getPrice() {\n\t\treturn fetch(`${BASE_REQUEST_URL}/${this.URL_STRING}/payment-information`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'content-type': 'application/json',\n\t\t\t},\n\t\t}).then(response => (response.status === 404 ? null : response.json()));\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\tconst isTax = Boolean(document.querySelector(this.TAX_SELECTOR));\n\t\t\treturn toFloat(data.totals[isTax ? 'base_grand_total' : 'grand_total']);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n\n\t_getCodeFromCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Shiekh',\n\tdomain: 'shiekh.com',\n\tDriver,\n\tmaxCoupons: 10,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\n\nconst BASE_URL = 'https://www.shoestation.com';\nconst CHECKOUT_URL = `${BASE_URL}/checkout`;\nconst CART_URL = `${CHECKOUT_URL}/cart`;\nconst BASE_REQUEST_URL = `${BASE_URL}/rest/default/V1`;\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    ‘isValid’ implemented: yes\n•    Manually apply code: no\nOptional:\n•    Show message about free shipping on the cart page (without discount info): no\n•    Is driver SPA and add the condition to show popup: yes\n•    Gather codes on site pages: no */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.discount.coupon';\n\t\tthis.TOTAL_SELECTOR = '[data-th$=Total] .price';\n\t\tthis.CODE_INPUT_SELECTOR = '[name=\"coupon_code\"], [name=\"discount_code\"]';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#discount-form .action-apply';\n\t\tthis.CANCEL_BUTTON_SELECTOR = '#discount-form .action-cancel';\n\n\t\tthis.AUTHORIZATION_SELECTOR = '#authorization-trigger, .authentication-notice';\n\n\t\tthis.ENTITY_ID_SELECTOR = new RegExp(/\"entity_id\":\"(.*?)\"/);\n\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\n\t\tthis.requestData = null;\n\t\tthis.updatedUrl = null;\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst entityId = [...document.querySelectorAll('script')]\n\t\t\t.find(element => element.text.match(this.ENTITY_ID_SELECTOR))\n\t\t\t.text.match(this.ENTITY_ID_SELECTOR)[1];\n\t\tif (document.querySelector(this.AUTHORIZATION_SELECTOR)) {\n\t\t\tthis.requestData = {\n\t\t\t\taction: `${BASE_REQUEST_URL}/guest-carts/${entityId}/coupons/`,\n\t\t\t};\n\t\t\tthis.updatedUrl = `${BASE_REQUEST_URL}/guest-carts/${entityId}/payment-information`;\n\t\t} else {\n\t\t\tthis.requestData = {\n\t\t\t\taction: `${BASE_REQUEST_URL}/carts/mine/coupons/`,\n\t\t\t};\n\t\t\tthis.updatedUrl = `${BASE_REQUEST_URL}/carts/mine/payment-information`;\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getUpdatedCart().then(responseJSON => {\n\t\t\tconst codes = [responseJSON.totals.coupon_code].filter(Boolean);\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst totalElement = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst totalSumm = totalElement ? toFloat(totalElement.innerHTML) : 0;\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst currentState = codeInput && totalSumm > 0;\n\t\treturn currentState;\n\t}\n\n\tbeforeCheckCodes() {\n\t\tconst cancelButton = document.querySelector(this.CANCEL_BUTTON_SELECTOR);\n\t\tif (cancelButton) {\n\t\t\tcancelButton.click();\n\t\t\treturn this._removeCode()\n\t\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t\t.then(responseString => this._parseTotal(responseString));\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code).then(async responseJSON => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\t\t\t\tif (!responseJSON) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tconst cartJson = await this._getUpdatedCart();\n\t\t\t\tif (cartJson) {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(cartJson);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.isValid = result.finalDiscount > 0;\n\t\t\t\t\treturn this._removeCode().then(() => bus.$emit('code-checked', result));\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(`${this.requestData.action}${code}`, 'PUT').then(responseJSON => responseJSON.json());\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode(this.requestData.action, 'DELETE');\n\t}\n\n\t_manageCode(requestURL, method) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t});\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn toFloat(data.totals.base_grand_total);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(this.updatedUrl, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t}).then(response => (response.status !== 404 ? response.json() : null));\n\t}\n};\n\nexport default {\n\tname: 'ShoeStation',\n\tdomain: 'shoestation.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { DOM } from '../../../utils';\n\nconst { extractElement } = DOM;\n\n/* BEHAVIOUR\n * One to one as template\n * One more page where code can be applied\n * On checkout page another selector.\n * Added for case when code was not applied, and\n * total is getting from page\n */\n\nconst BASE_URL = 'https://shop.drcolbert.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/onepage`;\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price, .grand_total .price';\n\t\tthis.INVALID_CODE_SELECTOR = '.error-msg';\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0], this._getRemoveRequestData(this.cartPageHTML)).then(responseString => ({\n\t\t\toriginalPrice: this._parseTotal(responseString),\n\t\t\toriginalItemsCount: this._parseItemsCount(responseString),\n\t\t}));\n\t}\n\n\t// check if the valid code was found\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst result = { code, finalPrice, finalDiscount };\n\t\t\t\tif (extractElement(this.INVALID_CODE_SELECTOR, responseString)) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Dr. Colbert',\n\tdomain: 'shop.drcolbert.com',\n\tmaxCoupons: 3,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL);\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format, log } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\n\nconst BASE_URL = 'https://www.shopnational.com';\nconst CHECKOUT_URL = `${BASE_URL}/checkout`;\nconst CART_URL = `${CHECKOUT_URL}/cart`;\nconst IS_CHECKOUT_PAGE = window.location.href.startsWith(CHECKOUT_URL) && !window.location.href.includes('cart');\nconst BASE_REQUEST_URL = `${BASE_URL}/rest/default/V1`;\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - can't apply without removing\n * - can apply only one code (not stackable)\n * - maxCoupons = 7, 1 valid code ~ 8s\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLY_BUTTON_SELECTOR = '#discount-form .action-apply';\n\t\tthis.CANCEL_BUTTON_SELECTOR = '#discount-form .action-cancel';\n\t\tthis.TOTAL_SELECTOR = '.grand .price';\n\t\tthis.CART_URL = `${CART_URL}/`;\n\t\tthis.CODE_INPUT_SELECTOR = '[name=\"coupon_code\"], [name=\"discount_code\"]';\n\t\tthis.ENTITY_ID_SELECTOR = new RegExp(/\"entity_id\":\"(.*?)\"/);\n\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.requestData = null;\n\t\tthis.updatedUrl = null;\n\t}\n\n\tcheckCondition() {\n\t\tconst totalElement = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\treturn totalElement && codeInput;\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst entityId = [...document.querySelectorAll('script')]\n\t\t\t.find(element => element.text.match(this.ENTITY_ID_SELECTOR))\n\t\t\t.text.match(this.ENTITY_ID_SELECTOR)[1];\n\t\tif (!JSON.parse(localStorage.getItem('mage-cache-storage')).customer.fullname) {\n\t\t\tthis.requestData = {\n\t\t\t\taction: `${BASE_REQUEST_URL}/guest-carts/${entityId}/coupons/`,\n\t\t\t};\n\t\t\tthis.updatedUrl = `${BASE_REQUEST_URL}/guest-carts/${entityId}/payment-information`;\n\t\t} else {\n\t\t\tthis.requestData = {\n\t\t\t\taction: `${BASE_REQUEST_URL}/carts/mine/coupons/`,\n\t\t\t};\n\t\t\tthis.updatedUrl = `${BASE_REQUEST_URL}/carts/mine/payment-information`;\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getUpdatedCart().then(responseJSON => {\n\t\t\tconst codes = [responseJSON.totals.coupon_code].filter(Boolean);\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tresult.isValid = !responseJSON.message;\n\t\t\t\tif (!result.isValid) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\treturn this._getUpdatedCart().then(responseCartJSON => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseCartJSON);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tif (IS_CHECKOUT_PAGE) {\n\t\t\t\t\t\tresult.freeShipping = this._checkFreeShipping(responseCartJSON);\n\t\t\t\t\t}\n\t\t\t\t\treturn this._removeCode().then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tbeforeApplyCodes() {\n\t\t// Clear this cookie to remove 'applied code' messages\n\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\treturn Promise.resolve();\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(`${this.requestData.action}${code}`, 'PUT').then(responseJSON => responseJSON.json());\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode(this.requestData.action, 'DELETE');\n\t}\n\n\t_manageCode(requestURL, method) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t});\n\t}\n\n\t_checkFreeShipping(data) {\n\t\treturn toFloat(data.totals.total_segments.find(item => item.code === 'shipping').value) === 0;\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn toFloat(data.totals.base_grand_total);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(this.updatedUrl, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t}).then(responseJSON => responseJSON.json());\n\t}\n};\n\nexport default {\n\tname: 'National',\n\tdomain: 'shopnational.com',\n\tisSinglePageApp: true,\n\tmaxCoupons: 7,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { DOM } from '../../../utils';\n\nconst { extractElement } = DOM;\n\nconst CART_URL = 'https://www.showmeyourmumu.com/checkout/cart';\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    ‘isValid’ implemented: no\n•    Manually apply code: no\n•    Active page: cart\nOptional:\n•    Show message about free shipping on the cart page (without discount info): no\n•    Is driver SPA and add the condition to show popup: no\n•    Gather codes on site pages: no */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t}\n\n\tasync _manageCode(requestURL, bodyObj) {\n\t\tconst responseHTML = await super._manageCode(requestURL, bodyObj);\n\t\t// retry for total element\n\t\tif (!extractElement(this.TOTAL_SELECTOR, responseHTML)) {\n\t\t\treturn super._manageCode(requestURL, bodyObj);\n\t\t}\n\t\treturn responseHTML;\n\t}\n};\n\nexport default {\n\tname: 'ShowMeYourMuMu',\n\tdomain: 'showmeyourmumu.com',\n\tisCartEmpty() {\n\t\treturn document.querySelector('.empty-tote');\n\t},\n\tDriver,\n\tmaxCoupons: 12, // may be slow\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { completionActions, DOM, format, log } from '../../../utils';\n\nconst { toFloat } = format;\nconst { setValue } = DOM;\n\nconst CART_URL = 'https://membership.shrm.org/join/register/';\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - valid code can be replaced with another valid code\n * - can`t apply multiple codes (stackable)\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.TOTAL_SELECTOR = '.data-table .even:last-child .price .price .price';\n\t\tthis.TOTAL_SELECTOR_REGEX = /\\$[A-Za-z0-9]*/;\n\t\tthis.CODE_APPLIED_REGEX = /error-msg/;\n\t\tthis.REQUEST_URL = 'https://membership.shrm.org/index/couponPost';\n\n\t\tthis.APPLY_REQUEST_EXTRA_VALUES = {\n\t\t\tremove: 0,\n\t\t\tproduct_discount_id: '',\n\t\t};\n\n\t\tthis.REMOVE_REQUEST_EXTRA_VALUES = this.APPLY_REQUEST_EXTRA_VALUES;\n\n\t\tthis.INPUT_CODE_SELECTOR = this.APPLIED_CODES_SELECTOR;\n\t\tthis.APPLY_BTN_SELECTOR = '.btn-apply';\n\t\tthis.INPUT_FIELD_SELECTOR = '#coupon_code';\n\t}\n\n\twatchForCartUrl() {\n\t\tlet previousState = false;\n\t\tsetInterval(() => {\n\t\t\tconst couponInputElement = document.querySelector(this.INPUT_FIELD_SELECTOR);\n\t\t\tconst cartPage = window.location.href.startsWith(CART_URL);\n\t\t\tconst currentState = couponInputElement && cartPage;\n\t\t\tif (currentState !== previousState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tpreviousState = currentState;\n\t\t}, 500);\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0], this._getRemoveRequestData()).then(responseString =>\n\t\t\tthis._parseTotal(responseString),\n\t\t);\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this._applyCode(code, this._getApplyRequestData()).then(responseJson => {\n\t\t\t\tif (this._codeAppliedCheck(responseJson.html)) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\tresult.finalPrice = this._parseTotal(responseJson);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.isValid = true;\n\n\t\t\t\treturn this._removeCode(code, this._getRemoveRequestData()).then(() =>\n\t\t\t\t\tbus.$emit('code-checked', result),\n\t\t\t\t);\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\tconst INPUT_CODE_ELEMENT = document.querySelector(this.INPUT_CODE_SELECTOR);\n\t\tconst APPLY_BTN_ELEMENT = document.querySelector(this.APPLY_BTN_SELECTOR);\n\n\t\tsetValue(INPUT_CODE_ELEMENT, codes[0]);\n\t\tAPPLY_BTN_ELEMENT.click();\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\treturn Boolean(this.CODE_APPLIED_REGEX.test(data));\n\t}\n\n\t_getApplyRequestData() {\n\t\tif (!this.applyRequestData) {\n\t\t\t// Assumed that this form always exists\n\t\t\tthis.applyRequestData = new URLSearchParams();\n\t\t\tthis.applyRequestData.set('params', '');\n\t\t\tthis.applyRequestData.action = this.REQUEST_URL;\n\t\t\tthis.applyRequestData.params = new URLSearchParams();\n\n\t\t\tObject.entries(this.APPLY_REQUEST_EXTRA_VALUES).forEach(([key, value]) => {\n\t\t\t\tthis.applyRequestData.params.set(key, value);\n\t\t\t});\n\t\t}\n\t\treturn this.applyRequestData;\n\t}\n\n\t_getRemoveRequestData() {\n\t\tif (!this.removeRequestData) {\n\t\t\t// Form may not exists if there is no code applied\n\t\t\tthis.removeRequestData = new URLSearchParams();\n\t\t\tthis.removeRequestData.set('params', '');\n\t\t\tthis.removeRequestData.action = `${this.REQUEST_URL}/?remove=1`;\n\t\t\tthis.removeRequestData.params = new URLSearchParams();\n\t\t\t//  If we succeeded, add extra values\n\t\t\tif (this.removeRequestData) {\n\t\t\t\tObject.entries(this.REMOVE_REQUEST_EXTRA_VALUES).forEach(([key, value]) => {\n\t\t\t\t\tthis.removeRequestData.params.set(key, value);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn this.removeRequestData;\n\t}\n\n\t_manageCode(requestURL, bodyObj) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\tbody: bodyObj,\n\t\t}).then(response => response.json());\n\t}\n\n\t_parseTotal(htmlString) {\n\t\tif (htmlString) {\n\t\t\tconst data = htmlString.cart_grand_total;\n\t\t\treturn toFloat(data.match(this.TOTAL_SELECTOR_REGEX)[0]);\n\t\t}\n\t\treturn toFloat(document.querySelector(this.TOTAL_SELECTOR).textContent);\n\t}\n};\n\nexport default {\n\tname: 'SHRM',\n\tdomain: 'shrm.org',\n\tDriver,\n\tisSinglePageApp: true,\n\tcompletionAction: completionActions.none,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n\t// no need to write isCartEmpty() because user can`t go to the checkout page without goods\n};\n","import MagentoTemplate from './_base';\nimport { browserUtils, DOM, format } from '../../../utils';\n\nconst { isFirefox } = browserUtils;\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst BASE_URL = 'https://www.smarthome.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/onestepcheckout`;\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable:  no\n•    Free gift support: no\n•    ‘isValid’ implemented: no\n•    Manually apply code: no\n */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price, .onestepcheckout-totals strong .price';\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.PRICE_BLOCK_SELECTOR = '#shopping-cart-totals-table tbody tr';\n\t\tthis.SHIPPING_VALUE_SELECTOR = '.price';\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst shipping = [...extractElement(this.PRICE_BLOCK_SELECTOR, response, true)].find(el =>\n\t\t\t\tel.textContent.match(/shipping/i),\n\t\t\t);\n\t\t\tconst calculatedShipping = shipping ? elemToFloat(shipping.querySelector(this.SHIPPING_VALUE_SELECTOR)) : 0;\n\t\t\t// no tax on the site\n\t\t\treturn this._parseTotal(response) - calculatedShipping;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Smarthome',\n\tdomain: 'smarthome.com',\n\tDriver,\n\tmaxCoupons: 10,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL);\n\t},\n\tisCartEmpty() {\n\t\treturn (\n\t\t\tdocument.querySelector('.cart-empty') ||\n\t\t\t(isFirefox() &&\n\t\t\t\twindow.navigator.userAgent.includes('Macintosh') &&\n\t\t\t\twindow.location.href.startsWith(CHECKOUT_URL))\n\t\t);\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format, DOM, log, completionActions } from '../../../utils';\n\nconst { elemToFloat, toFloat } = format;\nconst { extractElement, setValue } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no, will be implemented in EXT-1160\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: yes, on Payment\n+ Pages, where extension works: Cart, Payment\n+ Is driver SPA: yes\n+ Gather codes on site pages: yes, from Cart page\n*/\n\nconst isOnCartPage = window.location.href.includes('cart');\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tconst BASE_URL = 'https://www.solesociety.com';\n\t\tthis.ORDER_SUMMARY_URL = `${BASE_URL}/customer/section/load`;\n\t\tthis.CART_URL = `${BASE_URL}/checkout/cart`;\n\t\tthis.CART_URL_PAYMENT = `${BASE_URL}/checkout/#payment`;\n\t\tthis.APPLIED_CODE_SELECTOR = '.totals.discount .code, .totals.discount.cart-summary .code';\n\t\tthis.TOTAL_SELECTOR = '.grand .price';\n\t\tthis.MERCHANT_CODES_SELECTOR = '.header-page-promo-banner';\n\t\tthis.SPECIAL_MERCHANT_CODES_SELECTOR = '.bx-click-to-copy';\n\t\tthis.MERCHANT_CODES_REGEX = /use code:?\\s?(\\w+)/i;\n\t\tthis.PROMO_CODES_REGEX = /promoCode\":\"([\\w,]+)/i;\n\t\tthis.TOTAL_REGEX = /\"grand_total\":\"?([0-9.]+)\"?/i;\n\t\tthis.CODE_INPUT_SELECTOR = '#discount-code-fake';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#discount-form .action-add';\n\t}\n\n\tcheckCondition() {\n\t\tconst totalIsRendered = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst onRightURL =\n\t\t\twindow.location.href.startsWith(this.CART_URL) || window.location.href.startsWith(this.CART_URL_PAYMENT);\n\t\treturn totalIsRendered && onRightURL;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.params = new URLSearchParams({ isAjax: 1 });\n\t\tthis.queryStringParams = new URLSearchParams({\n\t\t\tsections: 'cart',\n\t\t\tupdate_section_id: false,\n\t\t});\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst codesFromPage = [...document.querySelectorAll(this.SPECIAL_MERCHANT_CODES_SELECTOR)]\n\t\t\t.map(el => el.textContent)\n\t\t\t.filter(Boolean);\n\t\treturn (window.location.href.startsWith(this.CART_URL) ? Promise.resolve(null) : this._getUpdatedCart()).then(\n\t\t\tresponse => [\n\t\t\t\t...new Set([\n\t\t\t\t\t...codesFromPage,\n\t\t\t\t\t...[...extractElement(this.MERCHANT_CODES_SELECTOR, response, true)]\n\t\t\t\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODES_REGEX))\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.map(el => el[1]),\n\t\t\t\t]),\n\t\t\t],\n\t\t);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODE_SELECTOR)]\n\t\t\t.map(el => el.textContent)\n\t\t\t.filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0]).then(responseJSON => this._parseTotal(responseJSON));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(data => {\n\t\t\t\tif (data.errors) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\tresult.finalPrice = this._parseTotal(data);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn isOnCartPage ? this._applyCode(codes[0]) : this._manuallyApplyCode(codes[0]);\n\t}\n\n\t_manuallyApplyCode(code) {\n\t\tsetValue(document.querySelector(this.CODE_INPUT_SELECTOR), code);\n\t\tdocument.querySelector(this.APPLY_BUTTON_SELECTOR).click();\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(code, false);\n\t}\n\n\t_removeCode(code) {\n\t\treturn this._manageCode(code, true);\n\t}\n\n\t_manageCode(code, isRemoving) {\n\t\tconst parsedCodes = decodeURI(code);\n\t\tthis.params.set('remove_coupon', isRemoving ? parsedCodes : false);\n\t\tthis.params.set('last_code', parsedCodes);\n\t\tthis.params.set('coupon_code', isRemoving ? '' : parsedCodes);\n\t\treturn fetch(`${this.CART_URL}/couponPost`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: this.params,\n\t\t}).then(response => response.json());\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(this.CART_URL).then(res => res.text());\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\tconst total = data.totals ? data.totals.grand_total : data.match(this.TOTAL_REGEX)[1];\n\t\t\treturn toFloat(total);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'Sole Society',\n\tdomain: 'solesociety.com',\n\tisSinglePageApp: true,\n\tcompletionAction: isOnCartPage ? completionActions.default : completionActions.none,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format, log, DOM, sendXhr } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst BASE_URL = 'https://www.spanx.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout(only first step for not loged in user, all steps for logged in)\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\nOptional:\nNot logged in user can't test codes on shipping/payment pages, because his shipping options sets to default after reloading page\n*/\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.IS_ON_CART = window.location.href.startsWith(CART_URL);\n\t\tthis.APPLIED_CODES_SELECTOR = this.IS_ON_CART ? '.amCouponsCode' : '#coupon_code, #discount-code';\n\t\tthis.TOTAL_SELECTOR = '.grand.totals .price';\n\t\tthis.SHIPPING_FORM_SELECTOR = '#co-shipping-method-form';\n\t\tthis.SHIPPING_METHOD_SELECTOR = '[name=\"shipping_method\"]';\n\t\tthis.NEWRELIC_ID_REGEX = /xpid:\"([\\w=]*)\"/;\n\n\t\tthis.NEED_REMOVE_CODE = false;\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\n\t\tthis.QUOTE_ID_REGEXP = /entity_id\":\"([A-Za-z0-9]+)(?=\")/;\n\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.bodyData = null;\n\t}\n\n\tcheckCondition() {\n\t\tconst correctPage = window.location.href.startsWith(BASE_URL);\n\t\tconst isShippingPage = this._isShippingOption();\n\t\tconst totalValue = document.querySelector(this.TOTAL_SELECTOR);\n\n\t\treturn (\n\t\t\ttotalValue &&\n\t\t\tcorrectPage &&\n\t\t\t(this._getWindowObjectData('window.checkoutConfig.isCustomerLoggedIn') ? true : !isShippingPage)\n\t\t);\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn this._isShippingOption() && (document.querySelector('.loader') || {}).offsetParent;\n\t}\n\n\tgetUserData() {\n\t\tif (!this._isShippingOption()) {\n\t\t\treturn null;\n\t\t}\n\t\tconst checkedShippingElement = [...document.querySelectorAll(this.SHIPPING_METHOD_SELECTOR)].find(\n\t\t\telement => element.checked,\n\t\t);\n\t\treturn {\n\t\t\tshippingSelector: `#${checkedShippingElement.getAttribute('id')}`,\n\t\t};\n\t}\n\n\tsetUserData(userData) {\n\t\tdocument.querySelector(userData.shippingSelector).click();\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.isTotalwithoutTaxes =\n\t\t\twindow.location.href.startsWith(CART_URL) && !document.querySelector('.totals-tax span.price');\n\t\tthis.userIsLogged = this._getWindowObjectData('window.checkoutConfig.isCustomerLoggedIn');\n\t\t[, this.newrelicId] = [...document.scripts]\n\t\t\t.find(el => el.text.match(this.NEWRELIC_ID_REGEX))\n\t\t\t.text.match(this.NEWRELIC_ID_REGEX);\n\t\tif (this.userIsLogged) {\n\t\t\tthis.quoteId = 'mine';\n\t\t} else {\n\t\t\tconst quoteScript = [...document.scripts].find(el => el.text.match(this.QUOTE_ID_REGEXP));\n\t\t\t[, this.quoteId] = quoteScript.text.match(this.QUOTE_ID_REGEXP);\n\t\t}\n\t\tif (window.location.href.startsWith(CART_URL)) {\n\t\t\tconst bodyData = this._getWindowObjectData('window.checkoutConfig.selectedShippingMethod');\n\t\t\tconst bodyDataAddress = { countryId: 'US', postcode: '*', regionId: '0' };\n\n\t\t\tthis.bodyData = {\n\t\t\t\taddressInformation: {\n\t\t\t\t\taddress: bodyDataAddress,\n\t\t\t\t\tshipping_method_code: bodyData ? bodyData.method_code : '',\n\t\t\t\t\tshipping_carrier_code: bodyData ? bodyData.carrier_code : '',\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(element => element.value)\n\t\t\t.filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode();\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this._getTotalInfo().then(responseJson => ({\n\t\t\toriginalPrice: this._parseTotal(responseJson),\n\t\t\toriginalItemsCount: this._parseItemsCount(responseJson),\n\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(), originalItemsCount = this._parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tfreeGifts: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tif (!responseJSON.message) {\n\t\t\t\t\treturn this._getTotalInfo().then(response => {\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tresult.freeGifts = this._parseItemsCount(response) - originalItemsCount;\n\t\t\t\t\t\tresult.isValid = true;\n\n\t\t\t\t\t\treturn this._removeCode().then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getTotalInfo().then(responseJSON => {\n\t\t\tconst totalsData = this.isTotalwithoutTaxes ? responseJSON : responseJSON.totals;\n\t\t\tconst total = this._parseTotal(responseJSON);\n\t\t\tconst shipping = toFloat(totalsData.base_shipping_amount);\n\t\t\tconst taxes = toFloat(totalsData.base_tax_amount);\n\t\t\treturn total - shipping - taxes;\n\t\t});\n\t}\n\n\t_getTotalInfo() {\n\t\tif (this.isTotalwithoutTaxes) {\n\t\t\treturn sendXhr(\n\t\t\t\t`${BASE_URL}/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\t\tthis.quoteId\n\t\t\t\t}/totals-information`,\n\t\t\t\t{\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcredentials: 'include',\n\t\t\t\t\tbody: JSON.stringify(this.bodyData),\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t'listrak-listening': 1,\n\t\t\t\t\t\t'x-newrelic-id': this.newrelicId,\n\t\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t).then(response => response.json());\n\t\t}\n\t\treturn sendXhr(\n\t\t\t`${BASE_URL}/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\tthis.quoteId\n\t\t\t}/payment-information`,\n\t\t\t{\n\t\t\t\tmethod: 'GET',\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t},\n\t\t\t},\n\t\t).then(response => response.json());\n\t}\n\n\t_manageCode(method, code = '') {\n\t\treturn sendXhr(\n\t\t\t`${BASE_URL}/rest/default/V1/${this.userIsLogged ? 'carts' : 'guest-carts'}/${\n\t\t\t\tthis.quoteId\n\t\t\t}/coupons/${code}`,\n\t\t\t{\n\t\t\t\tmethod,\n\t\t\t\tcredentials: 'include',\n\t\t\t\tbody: JSON.stringify(this.bodyData),\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t},\n\t\t\t},\n\t\t).then(response => response.json());\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode('PUT', code);\n\t}\n\n\t_removeCode() {\n\t\treturn this._manageCode('DELETE');\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn this.isTotalwithoutTaxes ? toFloat(data.base_grand_total) : toFloat(data.totals.base_grand_total);\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR));\n\t}\n\n\t_parseItemsCount(data) {\n\t\tif (data) {\n\t\t\treturn this.isTotalwithoutTaxes ? toFloat(data.items_qty) : toFloat(data.totals.items_qty);\n\t\t}\n\t\treturn document.querySelectorAll(this.ITEM_COUNT_SELECTOR).length;\n\t}\n\n\t_getApplyRequestData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t_isShippingOption() {\n\t\treturn (document.querySelector(this.SHIPPING_FORM_SELECTOR) || {}).offsetParent;\n\t}\n\n\t_getWindowObjectData(variableString) {\n\t\t// We will put generated request payload to this element\n\t\tconst requestDataElement = document.createElement('div');\n\t\trequestDataElement.id = 'get-data-genie';\n\t\tObject.assign(requestDataElement.style, { display: 'none' });\n\n\t\tdocument.documentElement.appendChild(requestDataElement);\n\n\t\t// Script which will generate request payload\n\t\tconst requestDataScript = document.createElement('script');\n\t\trequestDataScript.textContent = `document.getElementById(\"${\n\t\t\trequestDataElement.id\n\t\t}\").innerText = JSON.stringify(${variableString});`;\n\t\tdocument.documentElement.appendChild(requestDataScript);\n\t\tconst data = JSON.parse(requestDataElement.innerText);\n\t\t// Remove created blocks\n\t\trequestDataElement.parentNode.removeChild(requestDataElement);\n\t\trequestDataScript.parentNode.removeChild(requestDataScript);\n\t\treturn data;\n\t}\n};\n\nexport default {\n\tname: 'Spanx',\n\tdomain: 'spanx.com',\n\tisSinglePageApp: true,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n\trestoreUserData: true,\n};\n","import MagentoTemplate from './_base';\n\nconst BASE_URL = 'https://www.straighterline.com/checkout';\nconst CART_URL = `${BASE_URL}/cart/`;\nconst CHECKOUT_URL = `${BASE_URL}/onepage/`;\n\n/* Behaviour description:\n- we can apply only one code;\n- we can remove code;\n- invalid code removes valid */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.NEED_REMOVE_CODE = false;\n\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price, .mini-products-list-total-wrapper strong';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t\tthis.BILLING_STEP_SELECTOR = '#opc-billing';\n\t}\n\n\tcheckCondition() {\n\t\tconst isCouponInput = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\tconst billingStep = document.querySelector(this.BILLING_STEP_SELECTOR);\n\t\tconst isActiveBillingStep = billingStep && billingStep.getAttribute('class').includes('active');\n\t\tconst currentState =\n\t\t\t(window.location.href.startsWith(CART_URL) ||\n\t\t\t\t(window.location.href.startsWith(CHECKOUT_URL) && isActiveBillingStep)) &&\n\t\t\tisCouponInput;\n\t\treturn currentState;\n\t}\n};\n\nexport default {\n\tname: 'Straighterline',\n\tdomain: 'straighterline.com',\n\tmaxCoupons: 7,\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format, log } from '../../../utils';\n\nconst { toFloat } = format;\n\nconst BASE_URL = 'https://www.targetphoto.com';\nconst CHECKOUT_URL = `${BASE_URL}/checkout`;\nconst CART_URL = `${CHECKOUT_URL}/cart`;\nconst BASE_REQUEST_URL = `${BASE_URL}/rest/target/V1`;\n\n/**\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Pages, where extension works: cart, checkout\n+ Is driver SPA: yes\n+ Gather codes on site pages: yes\n+ Special case about the driver works (if it needed).\n  - maxCoupons (2, speed)\n  - calculate the price online + store\n */\n\nconst isCart = window.location.href.startsWith(CART_URL);\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.APPLIED_CODE_SELECTOR = '.amCouponsCode, .discount.coupon';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t\tthis.TOTAL_SECTION = isCart ? '.price[data-th*=\"Online\"]' : '[data-th*=\"Online\"] .price';\n\t\tthis.TOTAL_SECTION_STORE = '[data-bind*=\"getPrintToStoreValue\"]';\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: isCart ? /subtotal_with_discount\":\"?([0-9.]+)\"?/ : /base_grand_total\":\"?([0-9.]+)\"?/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t\tthis.totalRegExpStore = {\n\t\t\tregexObj: /window.p2sSubtotal ='?([0-9.]+)'?/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t\tthis.MERCHANT_CODE_SELECTOR = '.header-coupon';\n\t\tthis.MERCHANT_CODE_REGEX = /code\\s(\\w+)/gi;\n\n\t\tthis.ENTITY_ID_SELECTOR = /\"entity_id\":\"(.*?)\"/;\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.SPINNER_SELECTOR = '[data-role=\"loader\"]';\n\t\tthis.CHECKOUT_SPINER = '#checkout-loader';\n\t\tthis.NOT_LOGGED_SELECTOR = '.not-logged-in';\n\t\tthis.FORM_KEY_SELECTOR = '[name=\"form_key\"]';\n\t}\n\n\tcheckCondition() {\n\t\tconst spiner = [...document.querySelectorAll(this.SPINNER_SELECTOR)]\n\t\t\t.map(el => el.style.position)\n\t\t\t.filter(Boolean).length;\n\t\tconst checkoutSpiner = document.querySelector(this.CHECKOUT_SPINER);\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isTotalSection = document.querySelector(this.TOTAL_SECTION);\n\t\tconst isOnCheckout = window.location.href.startsWith(CHECKOUT_URL);\n\t\treturn (isCart || isOnCheckout) && !isCartEmpty && isTotalSection && !spiner && !checkoutSpiner;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.IS_LOGGED_IN = document.querySelector(this.NOT_LOGGED_SELECTOR);\n\t\tif (this.IS_LOGGED_IN) {\n\t\t\tconst entityId = [...document.querySelectorAll('script')]\n\t\t\t\t.find(element => element.textContent.match(this.ENTITY_ID_SELECTOR))\n\t\t\t\t.innerHTML.match(this.ENTITY_ID_SELECTOR)[1];\n\t\t\tthis.requestData = { action: `${BASE_REQUEST_URL}/guest-carts/${entityId}/coupons/` };\n\t\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t};\n\t\t} else {\n\t\t\tthis.requestData = { action: `${CHECKOUT_URL}/cart/couponPost/` };\n\t\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t};\n\t\t\tthis.FORM_KEY = document.querySelector(this.FORM_KEY_SELECTOR).value;\n\t\t\tthis.bodyData = new URLSearchParams({\n\t\t\t\tform_key: this.FORM_KEY,\n\t\t\t\tcoupon_code_fake: '',\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst codeElem = document.querySelector(this.MERCHANT_CODE_SELECTOR);\n\t\treturn codeElem\n\t\t\t? [...codeElem.textContent.matchAll(this.MERCHANT_CODE_REGEX)].filter(Boolean).map(code => code[1])\n\t\t\t: [];\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [\n\t\t\t...new Set(\n\t\t\t\t[...document.querySelectorAll(this.APPLIED_CODE_SELECTOR)]\n\t\t\t\t\t.map(el => (isCart ? el.value : el.textContent))\n\t\t\t\t\t.filter(Boolean),\n\t\t\t),\n\t\t];\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0])\n\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t.then(responseString => this._parseTotal(responseString));\n\t}\n\n\tbeforeCheckCodes(originalPrice) {\n\t\treturn originalPrice || this._getUpdatedCart().then(resHtml => this._parseTotal(resHtml));\n\t}\n\n\tcheckCodes(codes, originalPrice) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(response => {\n\t\t\t\tif (!response || response.message) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\treturn (this.IS_LOGGED_IN ? this._getUpdatedCart() : Promise.resolve(response)).then(responseCart => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseCart);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tbeforeApplyCodes() {\n\t\t// Clear this cookie to remove 'applied code' messages\n\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\treturn Promise.resolve();\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_applyCode(code) {\n\t\tif (this.IS_LOGGED_IN) {\n\t\t\treturn this._manageCode(`${this.requestData.action}${code}`, 'PUT').then(responseJSON =>\n\t\t\t\tresponseJSON.json(),\n\t\t\t);\n\t\t}\n\t\tthis.bodyData.set('remove_coupon', '');\n\t\tthis.bodyData.set('coupon_code', code);\n\t\tthis.bodyData.set('last_code', code);\n\t\tthis.bodyData.set('coupon_code_fake', code);\n\t\treturn this._manageCode(this.requestData.action, 'POST', this.bodyData).then(response => response.text());\n\t}\n\n\t_removeCode(code) {\n\t\tif (this.IS_LOGGED_IN) {\n\t\t\treturn this._manageCode(this.requestData.action, 'DELETE');\n\t\t}\n\t\tthis.bodyData.set('coupon_code_fake', '');\n\t\tthis.bodyData.set('coupon_code', '');\n\t\tthis.bodyData.set('last_code', code);\n\t\tthis.bodyData.set('remove_coupon', code);\n\t\treturn this._manageCode(this.requestData.action, 'POST', this.bodyData);\n\t}\n\n\t_manageCode(requestURL, method, body) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\tbody,\n\t\t});\n\t}\n\n\t_parseTotal(htmlString) {\n\t\tconst totalElement = htmlString.match(this.totalRegExp.regexObj)[this.totalRegExp.groupNumber];\n\t\tconst totalStore = htmlString.match(this.totalRegExpStore.regexObj)[this.totalRegExpStore.groupNumber];\n\t\treturn toFloat(totalElement) + toFloat(totalStore);\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(responseJSON => responseJSON.text());\n\t}\n};\n\nexport default {\n\tname: 'Target Photo',\n\tdomain: 'targetphoto.com',\n\tmaxCoupons: 2, // site is slow\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import MagentoTemplate from './_base';\n\nconst CART_URL = 'https://www.techrabbit.com/checkout/cart';\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - codes can be applied on cart page\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.NEED_REMOVE_CODE = false;\n\t}\n};\n\nexport default {\n\tname: 'TechRabbit',\n\tdomain: 'techrabbit.com',\n\tDriver,\n\tmaxCoupons: 10,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { log, browserUtils } from '../../../utils';\n\nconst { getCookie } = browserUtils;\n\nconst CHECKOUT_URL = 'https://www.the-cover-store.com/checkout';\nconst CART_URL = `${CHECKOUT_URL}/cart`;\nconst IS_ON_CART = window.location.href.startsWith(CART_URL);\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - valid code can be replaced with another valid code\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code';\n\t\tthis.TOTAL_SELECTOR = '.grand.totals strong .price';\n\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /grand_total\":\"([\\d.,]+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\n\t\tthis.NEED_REMOVE_CODE = false;\n\t}\n\n\twatchForCartUrl() {\n\t\t// activate extension when total appers\n\t\tlet previousState = false;\n\t\tsetInterval(() => {\n\t\t\tconst totalValue = document.querySelector(this.TOTAL_SELECTOR);\n\t\t\tconst windowLocation = window.location.href;\n\t\t\tconst correctPage = windowLocation.startsWith(CART_URL) || windowLocation.startsWith(CHECKOUT_URL);\n\n\t\t\tconst currentState = totalValue && correctPage;\n\n\t\t\tif (currentState !== previousState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tpreviousState = currentState;\n\t\t}, 1000);\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(responseString => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst isValid = finalDiscount > 0;\n\n\t\t\t\treturn bus.$emit('code-checked', { code, finalPrice, finalDiscount, isValid });\n\t\t\t}),\n\t\t);\n\t}\n\n\tbeforeApplyCodes() {\n\t\t// to remove error messages after code testing\n\t\tif (getCookie('mage-messages')) {\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst iframeElem = document.createElement('iframe');\n\t\tiframeElem.src = `${IS_ON_CART ? CART_URL : CHECKOUT_URL}/`;\n\t\tiframeElem.styledisplay = 'none';\n\t\tdocument.documentElement.appendChild(iframeElem);\n\t\treturn Promise.resolve();\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0], this._getApplyRequestData(this.cartPageHTML));\n\t}\n};\n\nexport default {\n\tname: 'The Cover Store',\n\tdomain: 'the-cover-store.com',\n\t// decreased number of coupons, because site can be very slow\n\tmaxCoupons: 10,\n\tDriver,\n\tisSinglePageApp: true,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CHECKOUT_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { format } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\n\nconst BASE_URL = 'https://www.tidyliving.com/checkout';\nconst CART_URL = `${BASE_URL}/cart`;\n\n// Behavior description:\n// we can apply only one code;\n// we can remove code;\n// we can't apply new coupon without removing previous;\n// code can be applied on cart page and on checkout page;\n// site is very slow, so we check only 10 codes;\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.discount.coupon';\n\t\tthis.TOTAL_SELECTOR = '.grand.totals .price';\n\t\tthis.CODE_INPUT_SELECTOR = '[name=\"coupon_code\"]';\n\n\t\tthis.TOTAL_REGEX = new RegExp(/\"grand_total\":(.*?),/);\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\t}\n\n\twatchForCartUrl() {\n\t\tconst inrerval = setInterval(() => {\n\t\t\tconst onCartPage = window.location.href.startsWith(BASE_URL);\n\t\t\tconst totalElement = document.querySelector(this.TOTAL_SELECTOR);\n\t\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\t\tif (onCartPage && totalElement && codeInput) {\n\t\t\t\tbus.$emit('cart-active');\n\t\t\t\tclearInterval(inrerval);\n\t\t\t}\n\t\t}, 500);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(el => Boolean(el))\n\t\t\t.map(el => el.innerText);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\t_parseTotal(html) {\n\t\tif (html) {\n\t\t\treturn toFloat(html.match(this.TOTAL_REGEX)[1].replace(/\"/g, ''));\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'Tidy Living',\n\tdomain: 'tidyliving.com',\n\tDriver,\n\tmaxCoupons: 10,\n\tisSinglePageApp: true,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(BASE_URL);\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { DOM, format, log } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst CART_URL = 'https://totokaelo.com/checkout/cart';\nconst REQUEST_URL = `${CART_URL}/couponPost`;\n\n/** Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    ‘isValid’ implemented: yes\n•    Manually apply code: no\n•    Can apply only on cart page\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code';\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table > tbody > tr:nth-child(1) > td:nth-child(2) > span';\n\t\tthis.TOTAL_DISCOUNT = '#shopping-cart-totals-table > tbody > tr:nth-child(2) > td:nth-child(2) > span';\n\t\tthis.ERROR_MESSAGE = '.error-msg';\n\t\tthis.ITEM_CONTAINER_SELECTOR = null;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.PARAM_BODY = new URLSearchParams();\n\t\treturn Promise.resolve();\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(responseHTML => {\n\t\t\t\tresult.isValid = Boolean(!extractElement(this.ERROR_MESSAGE, responseHTML));\n\t\t\t\tif (!result.isValid) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tresult.finalDiscount = this._getDiscountValue(responseHTML);\n\n\t\t\t\tresult.finalPrice = originalPrice - result.finalDiscount;\n\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t});\n\t\t});\n\t}\n\n\t_applyCode(code) {\n\t\tthis.PARAM_BODY.set('remove', 0);\n\t\tthis.PARAM_BODY.set('coupon_code', code);\n\t\treturn fetch(REQUEST_URL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: this.PARAM_BODY,\n\t\t}).then(response => response.text());\n\t}\n\n\t_getDiscountValue(data) {\n\t\tconst discountEl = extractElement(this.TOTAL_DISCOUNT, data);\n\t\treturn discountEl ? elemToFloat(discountEl) : 0;\n\t}\n};\n\nexport default {\n\tname: 'Totokaelo',\n\tdomain: 'totokaelo.com',\n\tmaxCoupons: 5,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { DOM } from '../../../utils';\n\nconst { extractData } = DOM;\n\nconst CART_URL = 'https://www.triabeauty.co.uk/checkout/cart';\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - valid code can't be replaced with another valid code\n * - can't apply multiple codes\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = `${CART_URL}/`;\n\n\t\tthis.TOTAL_SELECTOR = '.grand .price';\n\t\tthis.STACKABLE = false;\n\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\n\t\tthis.REG_TOTAL = /\"Grand Total\",\"value\":\"([0-9.-]+)/;\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn [...extractData('script', data, true)]\n\t\t\t.find(element => element.match(this.REG_TOTAL))\n\t\t\t.match(this.REG_TOTAL)[1];\n\t}\n};\n\nexport default {\n\tname: 'Tria Beauty UK',\n\tdomain: 'triabeauty.co.uk',\n\tDriver,\n\tmaxCoupons: 10, // site is very slow\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('#coupon_code');\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst { toFloat } = format;\nconst { extractData } = DOM;\n\nconst CART_URL = 'https://www.villeroy-boch.ca/shop/en/checkout/cart';\n\n/*\nBehavior description:\n- can get existing codes;\n- can remove codes;\n- valid code cann't be replaced with another valid code;\n- can't apply multiple codes (not stackable);\n- code testing may be run on 'Cart' page;\n*/\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.APPLIED_CODES_SELECTOR = '#discount-coupon-form button';\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table tr:last-child .price';\n\n\t\tthis.NEED_REMOVE_CODE = true;\n\t\tthis.STACKABLE = false;\n\t\tthis.VALID_CHECKOUT_PAGE = true;\n\n\t\tthis.APPLIED_CODE_REG = /coupon code\\s+\"(\\w+)/i;\n\t\tthis.REG_TOTAL = /(&#36;)|[^0-9.-]+/g;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(codeElement => codeElement.innerText.match(this.APPLIED_CODE_REG))\n\t\t\t.map(codeElement => codeElement.innerText.match(this.APPLIED_CODE_REG)[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn toFloat(\n\t\t\textractData(this.TOTAL_SELECTOR, data)\n\t\t\t\t.trim()\n\t\t\t\t.replace(this.REG_TOTAL, ''),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Villeroy & Boch Canada',\n\tdomain: 'villeroy-boch.ca',\n\tDriver,\n\tmaxCoupons: 6, // site is very slow\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('#cart-discount-toggle');\n\t},\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\n\nimport { log } from '../../../utils';\nimport { elemToFloat, toFloat } from '../../../utils/format';\n\nconst BASE_URL = 'https://www.vincecamuto.com/checkout';\nconst CART_URL = `${BASE_URL}/cart`;\nconst CHECKOUT = `${BASE_URL}/#payment`;\n\n/* Driver behavior description:\n• Existing code: yes\n• Remove code: yes\n• Stackable: no\n• Free gift support:  no\n• ‘isValid’ implemented: yes\non the cart we have calculated shipping but it doesn't show to the user. So I get it from the response\ncan't avoid redirect from the payment to shipping page\n*/\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.code';\n\t\tthis.TOTAL_SELECTOR = 'strong .price';\n\t\tthis.totalRegExp = /\"base_grand_total\":\"?([0-9.]+)\"?/;\n\t\tthis.TAX_REGEX = /\"Tax\",\"value\":\"?([0-9.]+)\"?/;\n\t\tthis.SHIPPING_REGEX = /price_excl_tax\":?([0-9.]+)/;\n\t\tthis.SPINER = '.loading-mask';\n\t\tthis.INPUT_SELECTOR = '#discount-code-fake';\n\t\tthis.EMPTY_CART = '.cart-empty';\n\t\tthis.ITEM_CONTAINER_SELECTOR = null;\n\t}\n\n\tcheckCondition() {\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART);\n\t\tconst spiner =\n\t\t\tdocument.querySelector(this.SPINER) && document.querySelector(this.SPINER).style.display === 'none';\n\t\tconst codeInput = document.querySelector(this.INPUT_SELECTOR);\n\t\treturn (\n\t\t\t!emptyCart &&\n\t\t\tisTotal &&\n\t\t\t(window.location.href.startsWith(CART_URL) ||\n\t\t\t\t(window.location.href.startsWith(CHECKOUT) && codeInput && spiner))\n\t\t);\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.apply = new URLSearchParams();\n\t\tthis.remove = new URLSearchParams();\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [\n\t\t\tdocument.querySelector(this.APPLIED_CODES_SELECTOR) &&\n\t\t\t\tdocument.querySelector(this.APPLIED_CODES_SELECTOR).textContent,\n\t\t].filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0]).then(responseJSON => this._parseTotal(responseJSON));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(response => {\n\t\t\t\tif (response.errors || parseFloat(response.totals.discount_amount !== 0)) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst total = this._parseTotal(responseHTML);\n\t\t\tconst shippingElem = responseHTML.match(this.SHIPPING_REGEX);\n\t\t\tconst shipping = shippingElem ? shippingElem[1] : 0;\n\t\t\tconst taxElem = responseHTML.match(this.TAX_REGEX);\n\t\t\tconst tax = taxElem ? taxElem[1] : 0;\n\t\t\treturn total - toFloat(shipping) - toFloat(tax);\n\t\t});\n\t}\n\n\t_applyCode(code) {\n\t\tthis.apply.set('last_code', code);\n\t\tthis.apply.set('coupon_code', code);\n\t\tthis.apply.set('isAjax', 1);\n\t\treturn this._manageCode(`${CART_URL}/couponPost`, 1);\n\t}\n\n\t_removeCode(code) {\n\t\tthis.remove.set('last_code', code);\n\t\tthis.remove.set('remove_coupon', code);\n\t\tthis.remove.set('coupon_code', '');\n\t\tthis.remove.set('isAjax', 1);\n\n\t\treturn this._manageCode(`${CART_URL}/couponPost`, 0);\n\t}\n\n\t_manageCode(requestURL, action) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: action ? this.apply : this.remove,\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.json());\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\tconst totalElem = data && data.totals ? data.totals.base_grand_total : data.match(this.totalRegExp)[1];\n\t\t\treturn toFloat(totalElem);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'Vince Camuto',\n\tdomain: 'vincecamuto.com',\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { DOM, log, completionActions } from '../../../utils';\n\nconst { setValue, extractElement } = DOM;\n\nconst BASE_URL = 'https://www.vionicshoes.com';\nconst CART_URL = `${BASE_URL}/checkout/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout/onepage`;\n\nconst isOnCheckout = () =>\n\twindow.location.href.includes('onepage') && !document.querySelector('#opc-login.section.allow.active');\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - valid code can be replaced with another valid code\n *\n * ======== Special case ========\n * we can't do requests on cart from checkout page (the error will be appear after that)\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #sidebarcoupon_code';\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price, #checkout-sidebar-table strong .price';\n\n\t\tthis.APPLY_BUTTON_SELECTOR = '#coupon-apply';\n\n\t\tthis.INACTIVE_SIDE_BAR_SELECTOR = '.sidebar_coupon_wrapper.inactive';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\n\t\tthis.CHECKOUT_APPLY_URL = `${BASE_URL}/customcheckout/coupon/applyCoupon/`;\n\t\tthis.CHECKOUT_REMOVE_URL = `${BASE_URL}/customcheckout/coupon/cancelCoupon/`;\n\n\t\tthis.SUCCESS_MESSAGE_SELECTOR = '.success-msg';\n\t}\n\n\twatchForCartUrl() {\n\t\tconst previousState = {\n\t\t\tcartActive: false,\n\t\t\tcompletionAction: false,\n\t\t};\n\t\tsetInterval(() => {\n\t\t\tconst inactiveSideBar = document.querySelector(this.INACTIVE_SIDE_BAR_SELECTOR);\n\t\t\tconst emptyCartElement = document.querySelector(this.EMPTY_CART_SELECTOR);\n\n\t\t\tconst cartActiveState =\n\t\t\t\t(window.location.href.startsWith(CART_URL) && !emptyCartElement) ||\n\t\t\t\t(window.location.href.startsWith(CHECKOUT_URL) && !inactiveSideBar);\n\n\t\t\tconst completionActionState = isOnCheckout();\n\n\t\t\tif (cartActiveState !== previousState.cartActive) {\n\t\t\t\tbus.$emit(cartActiveState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tif (completionActionState !== previousState.completionAction) {\n\t\t\t\tbus.$emit('change-completion-action', completionActions[completionActionState ? 'none' : 'reload']);\n\t\t\t}\n\t\t\tpreviousState.cartActive = cartActiveState;\n\t\t\tpreviousState.completionAction = completionActionState;\n\t\t}, 1000);\n\t}\n\n\tbeforeTestCodes() {\n\t\tif (isOnCheckout()) {\n\t\t\t// an error appears when we do request on cart page from checkout\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\treturn super.beforeTestCodes();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(element => (isOnCheckout() ? element.value : element.getAttribute('value')))\n\t\t\t.filter(Boolean);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML)).then(response => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\t\t\t\tif (isOnCheckout()) {\n\t\t\t\t\tif (typeof response === 'object' && response.coupon_applied) {\n\t\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\t\treturn this._getUpdatedCart().then(responseString => {\n\t\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseString);\n\t\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tif (this._codeAppliedCheck(response)) {\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn isOnCheckout() ? this._manuallyApplyCode(codes[0]) : super.applyCodes(codes);\n\t}\n\n\t_manageCode(requestURL, bodyObj) {\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.MANAGE_CODE_HEADERS,\n\t\t\tbody: bodyObj,\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t_manuallyApplyCode(code) {\n\t\tsetValue(document.querySelector(this.APPLIED_CODES_SELECTOR), code);\n\t\tdocument.querySelector(this.APPLY_BUTTON_SELECTOR).click();\n\t\treturn Promise.resolve();\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(isOnCheckout() ? `${BASE_URL}/checkout/onepage/progress/?prevStep=sidebar` : this.CART_URL, {\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_getApplyRequestData(htmlString) {\n\t\tif (isOnCheckout() && !this.applyRequestData) {\n\t\t\tthis.applyRequestData = {\n\t\t\t\taction: this.CHECKOUT_APPLY_URL,\n\t\t\t\tparams: new URLSearchParams(),\n\t\t\t};\n\t\t\treturn this.applyRequestData;\n\t\t}\n\t\treturn super._getApplyRequestData(htmlString);\n\t}\n\n\t_getRemoveRequestData(htmlString) {\n\t\tif (isOnCheckout() && !this.removeRequestData) {\n\t\t\tthis.removeRequestData = {\n\t\t\t\taction: this.CHECKOUT_REMOVE_URL,\n\t\t\t\tparams: new URLSearchParams({}),\n\t\t\t};\n\t\t\treturn this.removeRequestData;\n\t\t}\n\t\treturn super._getRemoveRequestData(htmlString);\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\treturn extractElement(this.SUCCESS_MESSAGE_SELECTOR, data);\n\t}\n};\n\nexport default {\n\tname: 'Vionic Shoes',\n\tdomain: 'vionicshoes.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { DOM } from '../../../utils';\n\nconst { extractElement } = DOM;\n\nconst BASE_URL = 'https://www.vitalitymedical.com';\n\n/** Driver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+\n+ Pages, where extension works:\n    - cart\n+ Is driver SPA: yes\n+ Gather codes on site pages: yes ('https://www.vitalitymedical.com')\n*/\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = `${BASE_URL}/checkout/cart/`;\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupon_code, #coupon_code_onestepcheckout';\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table strong .price, #checkout-review-table strong .price';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t\tthis.CODE_INPUT_SELECTOR = '#coupon_code';\n\t\tthis.BANNER_SELECTOR = '.ambanners';\n\t\tthis.MERCHANT_CODE_REGEX = /use code:? (\\w+)/i;\n\t\tthis.NEED_REMOVE_CODE = false;\n\t}\n\n\tcheckCondition() {\n\t\tconst isOnCartUrl = window.location.href.includes(this.CART_URL);\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\treturn isOnCartUrl && codeInput && !emptyCart;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn fetch(BASE_URL)\n\t\t\t.then(response => response.text())\n\t\t\t.then(responseHTML => {\n\t\t\t\treturn [...extractElement(this.BANNER_SELECTOR, responseHTML, true)]\n\t\t\t\t\t.map(element => element.textContent.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(matched => matched[1]);\n\t\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Vitality Medical',\n\tdomain: 'vitalitymedical.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import MagentoTemplate from './_base';\nimport { extractElement } from '../../../utils/DOM';\n\n/** Driver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: yes\n+ Pages, where extension works:\n - cart\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n\nWe don't support the checkout page, because all user data will be cleared and a user will be redirected on the first step of checkout.\nWe can't avoid the cart page. */\n\nconst CART_URL = 'https://www.vivaterra.com/checkout/cart';\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '[name=\"coupon_code\"]';\n\t\tthis.TOTAL_SELECTOR = '.price-total .price';\n\t\tthis.SHIPPING_SELECTOR = '#shopping-cart-totals-table tbody';\n\t\tthis.SHIPPING_REGEX = /(shipping=?).+\\$([0-9.,]+)/is;\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst total = this._parseTotal(responseHTML);\n\t\t\tconst shipping = extractElement(this.SHIPPING_SELECTOR, responseHTML);\n\t\t\tconst calculatedShipping =\n\t\t\t\tshipping && shipping.textContent.match(this.SHIPPING_REGEX)\n\t\t\t\t\t? shipping.textContent.match(this.SHIPPING_REGEX)[2]\n\t\t\t\t\t: 0;\n\t\t\treturn total - parseFloat(calculatedShipping);\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Viva Terra',\n\tdomain: 'vivaterra.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport bus from '../../bus';\n\n/** Behavior description:\n * can get existing code\n * can remove code\n * valid code can be replaced with another valid or invalid code\n * isn' stackable\n * code can be applied on cart page and on payment page\n * */\n\nconst BASE_URL = 'https://www.worldofwatches.com/checkout';\nconst CART_URL = `${BASE_URL}/cart`;\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.TOTAL_SELECTOR = '.grand.totals .price';\n\t\tthis.NEED_REMOVE_CODE = false;\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /grand_total\":\"(\\d+\\.\\d+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\t}\n\n\twatchForCartUrl() {\n\t\tlet lastState = false;\n\t\tsetInterval(() => {\n\t\t\tconst { href } = window.location;\n\t\t\tconst isCartHref = href.startsWith(`${BASE_URL}/#payment`) || href.startsWith(CART_URL);\n\t\t\tconst isTotal = Boolean(document.querySelector(this.TOTAL_SELECTOR));\n\t\t\tconst currentState = isCartHref && isTotal;\n\t\t\tif (lastState !== currentState) {\n\t\t\t\tbus.$emit(!lastState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tlastState = currentState;\n\t\t}, 1000);\n\t}\n};\n\nexport default {\n\tname: 'World of Watches',\n\tdomain: 'worldofwatches.com',\n\tDriver,\n\tmaxCoupons: 5,\n\tisSinglePageApp: true,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(`${BASE_URL}/#payment`) || href.startsWith(CART_URL);\n\t},\n};\n","import MagentoTemplate from './_base';\nimport { sessionTimer } from '../../lib';\n\n/** Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout(for logged in user - all steps, for not logged - only first step, due to redirection and clear data)\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n+ credentials: joseph@gmail.com, 12345qwerty\n+ 6ms - testing 1 valid code = maxCoupons = 10\n * */\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tconst BASE_URL = 'https://www.worx.com';\n\t\tthis.CART_URL = `${BASE_URL}/checkout/cart`;\n\n\t\tthis.TOTAL_SELECTOR = '#shopping-cart-totals-table tfoot .price, #checkout-totals tr:last-child .price';\n\t\tthis.NEED_REMOVE_CODE = false;\n\t\tthis.VALID_CHECKOUT_PAGE = false;\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t\tthis.BILLING_SELECTOR = '.billing_section.active';\n\t\tthis.NOT_LOGIN_SELECTOR = '#onestepcheckout_login_link';\n\t\tthis.CODE_INPUT_SELECTOR = '#discount-coupon-form, .cart-forms .discount-form';\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isOnCartURL = href.startsWith(this.CART_URL);\n\t\tconst isOnShipping = document.querySelector(this.BILLING_SELECTOR);\n\t\tconst isNotLogged = document.querySelector(this.NOT_LOGIN_SELECTOR);\n\t\tconst isCodeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isOnCheckout = isNotLogged ? isOnShipping : true;\n\t\treturn !emptyCart && (isOnCartURL || isOnCheckout) && isCodeInput;\n\t}\n};\n\nexport default {\n\tname: 'Worx',\n\tdomain: 'worx.com',\n\tmaxCoupons: 10,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport MagentoTemplate from './_base';\nimport bus from '../../bus';\nimport { browserUtils, completionActions, log, format } from '../../../utils';\n\nconst { setCookie, getCookie } = browserUtils;\nconst { toFloat } = format;\nconst CART_URL = 'https://www.zagg.com/en_us/checkout/cart';\nconst isOnCart = () => window.location.href.includes(CART_URL);\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart, cart on sidebar\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n ====Special cases====\n\t- Sometimes site gives default discount, \n\tand it can be bigger than tested codes.\n*/\n\nconst Driver = class Driver extends MagentoTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = `${CART_URL}/`;\n\t\tthis.APPLIED_CODES_SELECTOR = 'input[name=\"coupon_code\"]';\n\t\tthis.APPLY_COUPON_FORM_SELECTOR = '.discount-coupon-form';\n\t\tthis.REMOVE_COUPON_FORM_SELECTOR = this.APPLY_COUPON_FORM_SELECTOR;\n\t\tthis.TOTAL_ELEMENT_CONFIG = { selector: `${isOnCart() ? '.grand.totals .price' : '.grand-total .price'}` };\n\t\tthis.TOTAL_SELECTOR = this.TOTAL_ELEMENT_CONFIG.selector;\n\t\tthis.SIDEBAR_BTN_SELECTOR = '#mobileMiniCartToggle';\n\t\tthis.SIDEBAR_CART_SELECTOR = '.block-minicart';\n\t\tthis.LOADER_SELECTOR = '.loader';\n\t\tthis.EMPTY_CART_SELECTOR = '#ui-id-1 .empty';\n\t\tthis.MANAGE_CODE_HEADERS = {\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\treferer: this.CART_URL,\n\t\t};\n\t\tthis.totalRegExp = {\n\t\t\tregexObj: /\"grand_total\":\"?([0-9.]+)\"?|price\">\\$?([0-9.]+)/,\n\t\t\tgroupNumber: 1,\n\t\t};\n\t\tthis.PRETAX_REGEX = /subtotal_with_discount\":\"?([0-9.]+)\"?/;\n\t\tthis.afterCodeCheck = () => {\n\t\t\t// Clear this cookie to remove 'applied code' messages\n\t\t\tdocument.cookie = 'mage-messages=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n\t\t};\n\t}\n\n\tcheckCondition() {\n\t\tconst isGenieUsed = getCookie('is-genie-used');\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst correctPage = window.location.href.startsWith(CART_URL);\n\t\tconst totalValue =\n\t\t\tdocument.querySelector(this.TOTAL_SELECTOR) &&\n\t\t\tdocument.querySelector(this.TOTAL_SELECTOR).textContent.includes('$');\n\t\tconst isLoader = document.querySelector(this.LOADER_SELECTOR);\n\t\tconst isSidebarCart =\n\t\t\tdocument.querySelector(this.SIDEBAR_CART_SELECTOR) &&\n\t\t\tdocument.querySelector(this.SIDEBAR_CART_SELECTOR).parentNode.style.display !== 'none';\n\t\tconst btnSidebarOpen = document.querySelector(this.SIDEBAR_BTN_SELECTOR);\n\t\tif (\n\t\t\tisGenieUsed === '1' &&\n\t\t\t!isSidebarCart &&\n\t\t\tbtnSidebarOpen &&\n\t\t\tdocument.readyState === 'complete' &&\n\t\t\t!isLoader\n\t\t) {\n\t\t\tbtnSidebarOpen.click();\n\t\t\tsetCookie('is-genie-used', '0', 90);\n\t\t}\n\t\treturn totalValue && (correctPage || isSidebarCart) && !isCartEmpty;\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(), originalItemsCount = this._parseItemsCount()) {\n\t\tconst workingDiscounts = [];\n\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code, this._getApplyRequestData(this.cartPageHTML))\n\t\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t\t.then(responseString => {\n\t\t\t\t\tconst finalPrice = this._parseTotal(responseString);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst freeGifts = this._parseItemsCount(responseString) - originalItemsCount;\n\t\t\t\t\tconst result = { code, finalPrice, finalDiscount, freeGifts };\n\n\t\t\t\t\tif (finalDiscount > 0 || (finalPrice === originalPrice && freeGifts > 0)) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\t\t\t\t\tif (this.NEED_REMOVE_CODE) {\n\t\t\t\t\t\treturn this._removeCode(code, this._getRemoveRequestData(responseString)).then(() =>\n\t\t\t\t\t\t\tbus.$emit('code-checked', result),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst subtotalWithDiscountEl = responseHTML.match(this.PRETAX_REGEX);\n\t\t\tconst subtotalWithDiscount = subtotalWithDiscountEl ? toFloat(subtotalWithDiscountEl[1]) : 0;\n\t\t\treturn subtotalWithDiscount;\n\t\t});\n\t}\n\n\tcompleteExperience() {\n\t\tsetCookie('is-genie-used', '1', 90);\n\t\twindow.location.reload();\n\t\treturn Promise.resolve();\n\t}\n};\n\nexport default {\n\tname: 'ZAGG',\n\tdomain: 'zagg.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tmaxCoupons: 7, // site works slow\n\tcompletionAction: completionActions.custom,\n};\n"],"sourceRoot":""}