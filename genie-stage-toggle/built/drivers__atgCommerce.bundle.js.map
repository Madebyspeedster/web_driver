{"version":3,"sources":["webpack:///./src/inject/drivers/atgCommerce/_base.js","webpack:///./src/inject/drivers/atgCommerce/autozone.com.js","webpack:///./src/inject/drivers/atgCommerce/barneyswarehouse.com.js","webpack:///./src/inject/drivers/atgCommerce/calendars.com.js","webpack:///./src/inject/drivers/atgCommerce/carolina.com.js","webpack:///./src/inject/drivers/atgCommerce/competitivecyclist.com.js","webpack:///./src/inject/drivers/atgCommerce/eddiebauer.com.js","webpack:///./src/inject/drivers/atgCommerce/garageclothing.com.js","webpack:///./src/inject/drivers/atgCommerce/heb.com.js","webpack:///./src/inject/drivers/atgCommerce/horchow.com.js","webpack:///./src/inject/drivers/atgCommerce/index.js","webpack:///./src/inject/drivers/atgCommerce/lastcall.com.js","webpack:///./src/inject/drivers/atgCommerce/michaelkors.com.js","webpack:///./src/inject/drivers/atgCommerce/nutrisystem.com.js","webpack:///./src/inject/drivers/atgCommerce/rue21.com.js","webpack:///./src/inject/drivers/atgCommerce/shoemall.com.js","webpack:///./src/inject/drivers/atgCommerce/teleflora.com.js","webpack:///./src/inject/drivers/atgCommerce/uscellular.com.js","webpack:///./src/inject/drivers/atgCommerce/zennioptical.com.js","webpack:///./src/inject/drivers/base.js"],"names":["elemToFloat","format","extractElementFromHTML","extractFormValues","DOM","atgCommerce","BaseDriver","constructor","APPLIED_CODES_SELECTOR","APPLIED_CODES_ATTRIBUTES","TOTAL_SELECTOR","APPLY_CODE_FORM_SELECTOR","REMOVE_CODE_FORM_SELECTOR","APPLY_REQUEST_BODY_DATA","REMOVE_REQUEST_BODY_DATA","APPLY_CODE_PARAM_NAME","REMOVE_CODE_PARAM_NAME","REQUEST_HEADERS","isStackable","lastResponse","getExistingCodes","codes","document","querySelectorAll","map","code","getAttribute","codeCount","length","removeCodes","Promise","each","_removeCode","then","responseHTML","resolve","_parseTotal","checkCodes","originalPrice","workingDiscounts","_applyCode","response","result","finalPrice","finalDiscount","push","bus","$emit","discount","discounts","stackCodes","validationInfo","sort","a","b","currentPrice","currentDiscount","successfulCodes","responseText","applyCodes","codeArray","split","forEach","param","_getRemoveData","params","set","_manageCode","removeCodeData","Object","entries","key","value","_getApplyData","applyCodeData","bodyData","headersData","fetch","action","method","credentials","body","headers","text","JSON","parse","e","data","totalElement","querySelector","DOMAIN","CART_URL","Driver","CODE_REGEX","REMOVE_ID_CONTAINER_SELECTOR","REMOVE_ID_SELECTOR","ROBOTS_SELECTOR","COUPON_FIELD_SELECTOR","EMPTY_SELECTOR","MERCHANT_CODES_SELECTOR","MERCHANT_CODES_REGEX","DISABLE_TIME_MS","request","setType","requestTypes","embedded","isNotMaxCodeTesting","watchForCartUrl","interval","sessionTimer","initialize","actionInterval","timeout","checkCondition","driverStorage","backgroundMessaging","getDriverStorage","dataExpired","Date","now","lastTestTimestamp","deleteDriverStorage","emptyCart","couponInput","onCart","window","location","href","startsWith","offsetParent","getMerchantCodes","elem","alt","match","filter","Boolean","el","innerText","beforeApplyCodes","setDriverStorage","getPreTaxShippingTotal","get","promotionId","getCodeId","html","containers","includes","promotionElement","robotsPage","Number","MAX_SAFE_INTEGER","name","domain","maxCoupons","completionAction","completionActions","revisit","isSinglePageApp","extractElement","BASE_URL","BASE_REQUEST_URL","BILLING_URL","PRICE_BLOCK_SELECTOR","PRICE_SELECTOR","REMOVE_CODE_ELEMENT","cartPageHTML","_getCartPage","textContent","trim","_getOrderSummary","responseString","log","shipping","_findElement","tax","targetString","find","_getRemoveRequestData","url","element","isOnCartUrl","isCartEmpty","APPLIED_CODES_REGEXP","accept","CHARGES_REGEX","CHARGES_SELECTOR","requestSender","navigator","userAgent","sendXHR","history","replaceState","state","title","cartStr","_getUpdatedCart","total","taxes","summary","parentElement","reduce","charges","charge","cartContinueUrl","REMOVE_BTN_ELEMENT","REQUEST_BODY_DATA","URLSearchParams","REQUEST_URL","REQUEST_CART_URL","removeButton","isCodeRemoved","style","display","toString","toFloat","setValue","IS_ON_CHECKOUT","FORM_SELECTOR","SHIPPING_OPTIONS_SELECTOR","PROMO_CODE_SELECTOR","APPLY_BUTTON_SELECTOR","MERCHAN_CODES_SELECTOR","COUPON_LINK_SELECTOR","BILLING_ZIPCODE","BILLING_COUNTRY","BILLING_STATE","BILLING_CITY","BILLING_ADDRESS","SHIPPING_ZIPCODE","SHIPPING_COUNTRY","SHIPPING_STATE","SHIPPING_CITY","SHIPPING_ADDRESS","SAME_ADDRESS_SELECTOR","EMPTY_CART_SELECTOR","correctURL","isEmptyCart","beforeTestCodes","applyRequestData","shipMethod","_getShipMethod","billPostalCode","billCountry","billState","billCity","taxRequestParams","computeTax","checked","isValid","applyCode","applyCodeResponse","errorMessage","success","_updateOrderDetails","updatedOrder","applyCodeManually","json","requestURL","attributes","orderTotal","dataJSON","click","defaultShippingMethod","shippingInputs","Array","from","checkedInput","input","none","reload","wait","browserUtils","DOMAIN_URL","COUPON_FIELD_CLOSED_SELECTOR","FREE_SHIPPING_SELECTOR","SHIPPING_SELECOTR","TAX_SELECTOR","DONATION_SELECTOR","CART_VALUE_SELECTOR","APPLY_CODE_INPUT_SELECTOR","APPLY_CODE_BTN_SELECTOR","REMOVE_CODE_BTN_SELECTOR","EMPTY_ELEMENT1_SELECTOR","EMPTY_ELEMENT2_SELECTOR","MAX_INTERVAL","MAX_WAIT_TIME","DOM_CHECK_TIME","BEFORE_TEST_CODES_DELAY","CORRECT_STEPS","MERCHANT_CODE_REGEX","totalRendered","correctUrl","some","step","emptyEl1","emptyEl2","spinnerActive","checkDOMTime","toCheckDOM","setTimeout","res","resHtml","item","responseJSON","parseCartValue","selector","donation","Math","random","handleDriverError","Error","stringify","showDifferentDiscountMessage","MERCHANT_CODE_SELECTOR","SHIPPING_SELECTOR","error","_getUpdatedPage","taxEl","cartSummary","CHECKOUT_URL","REQUEST_PREFIX","CHARGES_SELECTORS","codesOnPage","_getSummary","chargeSelector","chargeElement","redirect","validationSupport","autozone","barneyswarehouse","calendars","carolina","competitivecyclist","eddiebauer","garageclothing","heb","horchow","lastcall","michaelkors","nutrisystem","rue21","shoemall","teleflora","uscellular","zennioptical","IS_ON_CART","BAD_PROMO_SELECTOR","SUBMIT_ELEMENT_SELECTOR","rightUrl","totalElem","isTotal","currentState","Set","codesElement","replace","existingCodes","requestData","submitInputElement","workingCodes","currentAppliedCodes","workingCode","stackedCodes","shippingElement","taxElement","stackable","REMOVE_PARAMETR_SELECTOR","APPLY_REQUEST_URL","DATA_SUMMARY_URL","INPUT_CODE_SELECTOR","PROMO_SECTION_SELECTOR","SHIPPING_AND_TAX_SELECTOR","cartURL","checkoutURL","classList","contains","aplliedCodeEl","delay","_dataSummary","beforeCheckCodes","APPLY_BODY","status","clone","catch","_codeAppliedCheck","extractData","taxData","c","errors","removeUrl","couponAppliedFromPayment","Accept","PROPOSED_CODES_SELECTOR","VALID_CODE_SELECTOR","SHIPPING_TYPE_PARAM_NAME","CODE_INPUT_SELECTOR","REMOVE_CODE_BUTTON_SELECTOR","CHECKOUT_STEPS_SELECTOR","isCodeInput","checkoutStepsEl","isOnRightCheckoutStep","_checkCheckoutStep","_getUpdatedCheckout","currentCode","arr","removeCodeBtnSelector","reject","message","taxValue","currentStep","isOnShipping","toInt","getCookie","setCookie","SESSION_SELECTOR","FORM_DATA_SELECTOR","APPLY_URL","INVALID_CODE_SELECTOR","REMOVE_BUTTON_SELECTOR","EMPTY_CART_EL_SELECTOR","ERROR_EL_SELECTOR","PAGE_CONTENT_SELECTOR","MERCHANT_PROMO_BLOCK_SELECTOR","SUMMERY_BLOCK_SELECTOR","SUMMERY_VALUE","errorEl","sessionExpired","isRightUrl","isCorrectPage","add","size","numberOfTesting","FORM_DATA","_isCodeInvalid","shippingElem","taxElem","string","removeURlPart","couponCodeBtn","couponCodeRemoveBtn","TOTAL_BY_MONTH_SELECTOR","INPUT_APPLY_CODE_SELECTOR","APPLIED_CODES_PATT","MANAGE_CODE_FORM","lastState","setInterval","totalPrice","isOnRightUrl","codeParameter","totalToday","totalDueTodaySummary","totalDueToday","totalDueMonthlySummary","monthlyChargeSummary","TOTAL_ELEMENT_CONFIG","APPLY_FORM_SELECTOR","REMOVE_FORM_SELECTOR","CODE_PROPERTY","ITEM_IN_CART","applyData","removeData","PROPOSED_CODES_REGEX","isItemInCart","_makeRequest","retry","responseData","redirected","statusText","errorPayload","slice","watchForRestoreUserData","time","pauseInterval","checkRestoreDataCondition","clearInterval","source","storeUserData","userData","getUserData","userDataKey","getUserDataStorageKey","storageRecord","storedTime","restoreUserData","maxStorageLifetime","setUserData","getStartPrice","startPrice","totalElementConfig","attribute","regex","isArray","elemSelector","pattern","group","previousState","completeExperience","completeExperiencePromisified","args","_promisify","beforeTestCodesPromisified","getStartPricePromisified","getMerchantCodesPromisified","getExistingCodesPromisified","removeCodesPromisified","beforeApplyCodesPromisified","applyCodesPromisified","beforeCheckCodesPromisified","checkCodesPromisified","stackCodesPromisified","apply"],"mappings":"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","file":"drivers__atgCommerce.bundle.js","sourcesContent":["import Promise from 'bluebird';\nimport BaseDriver from '../base';\nimport bus from '../../bus';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElementFromHTML, extractFormValues } = DOM;\n\nexport default class atgCommerce extends BaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\t// Should be defined in driver\n\t\tthis.APPLIED_CODES_SELECTOR = '';\n\t\tthis.APPLIED_CODES_ATTRIBUTES = '';\n\t\tthis.TOTAL_SELECTOR = '';\n\n\t\t// Should be defined in driver\n\t\tthis.APPLY_CODE_FORM_SELECTOR = '';\n\t\tthis.REMOVE_CODE_FORM_SELECTOR = '';\n\n\t\t// Redefine in driver in case it differs\n\t\tthis.APPLY_REQUEST_BODY_DATA = {};\n\t\tthis.REMOVE_REQUEST_BODY_DATA = {};\n\n\t\t// Redefine in driver in case it differs\n\t\t// if you have couple param names with code, just write them through a comma and without space, like 'param1,param2,param3'\n\t\tthis.APPLY_CODE_PARAM_NAME = '';\n\t\tthis.REMOVE_CODE_PARAM_NAME = '';\n\n\t\t// Redefine in driver in case they are needed\n\t\tthis.REQUEST_HEADERS = {};\n\n\t\t// Redefine in driver in case it differs\n\t\tthis.isStackable = false;\n\n\t\tthis.lastResponse = null;\n\t}\n\n\t// Base Driver methods\n\tgetExistingCodes() {\n\t\t// This method may vary from merchant to merchant\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(code =>\n\t\t\tcode.getAttribute(this.APPLIED_CODES_ATTRIBUTES),\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\tlet lastResponse = null;\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._removeCode(code).then(responseHTML => {\n\t\t\t\tlastResponse = responseHTML;\n\t\t\t\treturn Promise.resolve();\n\t\t\t}),\n\t\t).then(() => this._parseTotal(lastResponse));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tconst workingDiscounts = [];\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code).then(response => {\n\t\t\t\tconst result = { code, finalPrice: originalPrice, finalDiscount: 0 };\n\n\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\tif (result.finalPrice < originalPrice) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\n\t\t\t\t\treturn this._removeCode(code).then(() => {\n\t\t\t\t\t\tbus.$emit('code-checked', result);\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.isStackable) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice } = validationInfo;\n\t\tworkingDiscounts.sort((a, b) => b.finalDiscount - a.finalDiscount);\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis._applyCode(discount.code).then(responseText => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseText);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tbus.$emit('code-stacked', { code: discount.code, finalPrice, finalDiscount });\n\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this._removeCode(discount.code);\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this.isStackable ? Promise.resolve() : this._applyCode(codes[0]);\n\t}\n\n\t// ATG Commerce Driver methods\n\t_removeCode(code) {\n\t\t// Add to body parametr with code for removing\n\t\tif (this.REMOVE_CODE_PARAM_NAME) {\n\t\t\tconst codeArray = this.REMOVE_CODE_PARAM_NAME.split(',');\n\t\t\tcodeArray.forEach(param => this._getRemoveData().params.set(param, code));\n\t\t\t// this._getRemoveData().params.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\t}\n\n\t\treturn this._manageCode(this._getRemoveData(), this.REQUEST_HEADERS);\n\t}\n\n\t_getRemoveData() {\n\t\tif (!this.removeCodeData) {\n\t\t\tthis.removeCodeData = extractFormValues(this.REMOVE_CODE_FORM_SELECTOR, this.lastResponse);\n\t\t\t// Add to body params data, that user set\n\t\t\tObject.entries(this.REMOVE_REQUEST_BODY_DATA).forEach(([key, value]) => {\n\t\t\t\tthis.removeCodeData.params.set(key, value);\n\t\t\t});\n\t\t}\n\t\treturn this.removeCodeData;\n\t}\n\n\t_getApplyData() {\n\t\tif (!this.applyCodeData) {\n\t\t\tthis.applyCodeData = extractFormValues(this.APPLY_CODE_FORM_SELECTOR, this.lastResponse);\n\t\t\t// Add to body params data, that user set\n\t\t\tObject.entries(this.APPLY_REQUEST_BODY_DATA).forEach(([key, value]) => {\n\t\t\t\tthis.applyCodeData.params.set(key, value);\n\t\t\t});\n\t\t}\n\t\treturn this.applyCodeData;\n\t}\n\n\t_applyCode(code) {\n\t\tconst codeArray = this.APPLY_CODE_PARAM_NAME.split(',');\n\t\tcodeArray.forEach(param => this._getApplyData().params.set(param, code));\n\n\t\treturn this._manageCode(this._getApplyData(), this.REQUEST_HEADERS);\n\t}\n\n\t_manageCode(bodyData, headersData) {\n\t\treturn fetch(bodyData.action, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: bodyData.params,\n\t\t\theaders: headersData,\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\t// Return JSON if it is possible\n\t\t\t\ttry {\n\t\t\t\t\tthis.lastResponse = JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.lastResponse = response;\n\t\t\t\t}\n\t\t\t\treturn this.lastResponse;\n\t\t\t});\n\t}\n\n\t_parseTotal(data) {\n\t\tlet totalElement = null;\n\t\tif (data) {\n\t\t\ttotalElement = extractElementFromHTML(data, this.TOTAL_SELECTOR);\n\t\t} else {\n\t\t\ttotalElement = document.querySelector(this.TOTAL_SELECTOR);\n\t\t}\n\t\treturn elemToFloat(totalElement);\n\t}\n}\n","import atgCommerce from './_base';\nimport { DOM, completionActions, request, requestTypes } from '../../../utils';\nimport { sessionTimer, backgroundMessaging } from '../../lib';\n\nconst { extractElementFromHTML, extractFormValues } = DOM;\n\n/*\nDriver behavior:\n   Existing code: yes\n   Remove code: yes\n   Code retesting: yes\n   Stackable: no\n   Free gift support: no\n   isValid implemented: no\n   Manually apply code: no\n   Show message about free shipping: no\n   Driver is SPA: yes, on cart page if code input present and no forbid testing cookie present\n   Gather merchant codes: yes\n   Special case: testing is forbidden for 5 minutes after last testing toa void block\n   sessionTimer: 8min\n*/\n\nconst DOMAIN = 'autozone.com';\nconst CART_URL = `https://www.${DOMAIN}/cart/cart.jsp`;\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.promo-code';\n\t\tthis.TOTAL_SELECTOR = '.order-subtotal-section .subtotal-price';\n\t\tthis.CODE_REGEX = /\\w+/;\n\n\t\tthis.APPLY_CODE_FORM_SELECTOR = '#applyCouponForm';\n\t\tthis.REMOVE_CODE_FORM_SELECTOR = '#removeCouponForm';\n\n\t\tthis.APPLY_CODE_PARAM_NAME = '/atg/commerce/promotion/CouponFormHandler.couponClaimCode';\n\n\t\tthis.REMOVE_ID_CONTAINER_SELECTOR = '#removeCouponForm .promo-code-box';\n\t\tthis.REMOVE_ID_SELECTOR = '.submit-link.remove-coupon';\n\n\t\tthis.ROBOTS_SELECTOR = 'META[NAME*=\"ROBOTS\"]';\n\t\tthis.COUPON_FIELD_SELECTOR = '#promoCodeInput';\n\n\t\tthis.EMPTY_SELECTOR = '#noItems';\n\n\t\tthis.MERCHANT_CODES_SELECTOR = '#globalHeader a>img';\n\t\tthis.MERCHANT_CODES_REGEX = /code:\\s(\\w+)/i;\n\n\t\tthis.DISABLE_TIME_MS = 5 * 60 * 1000;\n\n\t\trequest.setType(requestTypes.embedded);\n\t\tthis.isNotMaxCodeTesting = true;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 8,\n\t\t});\n\t}\n\n\tasync checkCondition() {\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(DOMAIN);\n\t\tif (driverStorage) {\n\t\t\tconst dataExpired = Date.now() - driverStorage.lastTestTimestamp >= this.DISABLE_TIME_MS;\n\t\t\tif (dataExpired) {\n\t\t\t\tthis.isNotMaxCodeTesting = true;\n\t\t\t\tbackgroundMessaging.deleteDriverStorage(DOMAIN);\n\t\t\t} else {\n\t\t\t\tthis.isNotMaxCodeTesting = false;\n\t\t\t}\n\t\t}\n\t\tconst emptyCart = document.querySelector(this.EMPTY_SELECTOR);\n\t\tconst couponInput = document.querySelector(this.COUPON_FIELD_SELECTOR);\n\t\tconst onCart = window.location.href.startsWith(CART_URL);\n\t\treturn this.isNotMaxCodeTesting && onCart && !emptyCart && couponInput && couponInput.offsetParent;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.MERCHANT_CODES_SELECTOR)]\n\t\t\t.map(elem => elem.alt.match(this.MERCHANT_CODES_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(elem => elem[1]);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(el => el.innerText.match(this.CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(match => match[0]);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeApplyCodes() {\n\t\tthis.isNotMaxCodeTesting = false;\n\t\tbackgroundMessaging.setDriverStorage(DOMAIN, { lastTestTimestamp: Date.now() });\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn super._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn fetch(window.location.href)\n\t\t\t.then(response => response.text())\n\t\t\t.then(responseHTML => this._parseTotal(responseHTML));\n\t}\n\n\t_manageCode(bodyData) {\n\t\treturn request\n\t\t\t.get(`${CART_URL}?${bodyData.params}`)\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\ttry {\n\t\t\t\t\tthis.lastResponse = JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.lastResponse = response;\n\t\t\t\t}\n\t\t\t\treturn this.lastResponse;\n\t\t\t});\n\t}\n\n\t_removeCode(code) {\n\t\t// Add to body parameters with code for removing\n\t\tif (this.REMOVE_CODE_PARAM_NAME) {\n\t\t\tconst codeArray = this.REMOVE_CODE_PARAM_NAME.split(',');\n\t\t\tcodeArray.forEach(param => this._getRemoveData(code).params.set(param, code));\n\t\t}\n\n\t\treturn this._manageCode(this._getRemoveData(code), this.REQUEST_HEADERS);\n\t}\n\n\t_getRemoveData(code) {\n\t\tif (!this.removeCodeData) {\n\t\t\tthis.removeCodeData = extractFormValues(this.REMOVE_CODE_FORM_SELECTOR, this.lastResponse);\n\t\t\t// Add to body params data, that user set\n\t\t\tObject.entries(this.REMOVE_REQUEST_BODY_DATA).forEach(([key, value]) => {\n\t\t\t\tthis.removeCodeData.params.set(key, value);\n\t\t\t});\n\t\t}\n\t\tconst promotionId = this.getCodeId(code, this.lastResponse);\n\t\tthis.removeCodeData.params.set('/atg/commerce/promotion/CouponFormHandler.promotionId', promotionId);\n\t\treturn this.removeCodeData;\n\t}\n\n\tgetCodeId(code, html) {\n\t\tlet promotionId = null;\n\t\tconst containers = html\n\t\t\t? extractElementFromHTML(html, this.REMOVE_ID_CONTAINER_SELECTOR, true)\n\t\t\t: document.querySelectorAll(this.REMOVE_ID_CONTAINER_SELECTOR);\n\n\t\t// active promo code always is in the first line so if code we want to delete isn't in first line\n\t\t// there is no id on the page (It is possible to remove only active code)\n\t\tif (containers.length > 0 && containers[0].innerText.includes(code)) {\n\t\t\tconst promotionElement = html\n\t\t\t\t? extractElementFromHTML(html, this.REMOVE_ID_SELECTOR)\n\t\t\t\t: document.querySelector(this.REMOVE_ID_SELECTOR);\n\t\t\t[, promotionId] = promotionElement.getAttribute('onclick').split(\"'\");\n\t\t}\n\t\treturn promotionId;\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\tconst robotsPage = extractElementFromHTML(data, this.ROBOTS_SELECTOR);\n\t\t\tif (robotsPage) {\n\t\t\t\treturn Number.MAX_SAFE_INTEGER;\n\t\t\t}\n\t\t}\n\t\treturn super._parseTotal(data);\n\t}\n};\n\nexport default {\n\tname: 'AutoZone',\n\tdomain: 'autozone.com',\n\tmaxCoupons: 2, // due to block\n\tcompletionAction: completionActions.revisit,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport atgCommerce from './_base';\nimport bus from '../../bus';\nimport { DOM, format, log } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/* BEHAVIOUR\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support:  no\n+ Free shipping:  no\n+ isValid implemented:  no\n+ Codes can be replaced by another code:  no\n+ Pages, where extension works: billing page\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n * Can getExistingCodes only from cart page\n * Can remove only if we have remove url from cart page\n * Rewrote all methods, exept _parseTotal, because driver doesn't work as a base\n */\n\nconst BASE_URL = 'https://www.barneyswarehouse.com';\nconst CART_URL = `${BASE_URL}/cart`;\nconst BASE_REQUEST_URL = `${BASE_URL}/checkout/gadgets`;\nconst BILLING_URL = `${BASE_URL}/checkout/billing`;\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartPromoCodeTitledesc';\n\t\tthis.TOTAL_SELECTOR = '.atg_store_orderTotal .atg_store_orderSummaryItem';\n\t\tthis.PRICE_BLOCK_SELECTOR = '.atg_store_orderSubTotals li';\n\t\tthis.PRICE_SELECTOR = '.atg_store_orderSummaryItem';\n\t\tthis.REMOVE_CODE_ELEMENT = '.promoCodeRemoveLink a';\n\t\tthis.cartPageHTML = null;\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getCartPage().then(responseHTML => {\n\t\t\tconst codes = [...extractElement(this.APPLIED_CODES_SELECTOR, responseHTML, true)]\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(code => code.textContent.trim());\n\t\t\t// if we have exist code,we will have response, from which we can get url for remove\n\t\t\tthis.cartPageHTML = responseHTML;\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0], this.cartPageHTML)\n\t\t\t.then(() => this._getOrderSummary())\n\t\t\t.then(responseString => this._parseTotal(responseString));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code)\n\t\t\t\t.then(() => this._getOrderSummary())\n\t\t\t\t.then(response => {\n\t\t\t\t\tconst result = {\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t};\n\n\t\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\tif (result.finalPrice < originalPrice) {\n\t\t\t\t\t\treturn this._getCartPage().then(responseHTML =>\n\t\t\t\t\t\t\tthis._removeCode(code, responseHTML).then(() => bus.$emit('code-checked', result)),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(this._findElement('Shipping', response)) || 0;\n\t\t\tconst tax = elemToFloat(this._findElement('Tax', response)) || 0;\n\t\t\treturn this._parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\t_findElement(targetString, response) {\n\t\treturn [...extractElement(this.PRICE_BLOCK_SELECTOR, response, true)]\n\t\t\t.find(el => el.textContent.includes(targetString))\n\t\t\t.querySelector(this.PRICE_SELECTOR);\n\t}\n\n\t_removeCode(code, html) {\n\t\treturn this._manageCode(this._getRemoveRequestData(code, html));\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(`${BASE_REQUEST_URL}/ajaxPromotionApply.jsp?couponCode=${code}`);\n\t}\n\n\t_manageCode(url) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t});\n\t}\n\n\t_getCartPage() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_getOrderSummary() {\n\t\treturn fetch(`${BASE_REQUEST_URL}/ajaxCheckoutOrderSummary.jsp`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_getRemoveRequestData(code, html) {\n\t\treturn [...extractElement(this.REMOVE_CODE_ELEMENT, html, true)]\n\t\t\t.map(element => element.href)\n\t\t\t.find(url => url && url.includes(code));\n\t}\n};\n\nexport default {\n\tname: 'Barneys Warehouse',\n\tdomain: 'barneyswarehouse.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(BILLING_URL);\n\t},\n\tisCartEmpty() {\n\t\treturn (\n\t\t\t(document.querySelector('.atg_store_orderSummaryItem') &&\n\t\t\t\telemToFloat(document.querySelector('.atg_store_orderSummaryItem')) === 0) ||\n\t\t\t(document.querySelector('#atg_store_sessionExpired') || {}).offsetParent\n\t\t);\n\t},\n};\n","import atgCommerce from './_base';\nimport sendXHR from '../../../utils/send-xhr';\nimport { elemToFloat } from '../../../utils/format';\nimport { extractElement } from '../../../utils/DOM';\n\n/**\n * Driver behavior description:\n -    Existing code: yes\n -    Remove code: We can not remove code, but we can remove code by appling ' '\n -    Stackable: no\n -    Free gift support: no\n -    isValid implemented: yes\n Optional:\n -    Show message about free shipping on the cart page (without discount info): no\n -    Is driver SPA and add the condition to show popup: no\n -\t  code testing on the cart and checkout pages\n -\t  We can replace valid code by invalid and valid codes on checkout page\n */\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#removeCoupon, #applyCoupon, #cartCouponBox';\n\t\tthis.APPLIED_CODES_REGEXP = /Coupon\\s(\\w*)\\s/;\n\t\tthis.TOTAL_SELECTOR =\n\t\t\t'td:last-child #orderSummaryTotal, #orderSummaryTable tr:last-of-type td:last-of-type span';\n\n\t\tthis.APPLY_CODE_FORM_SELECTOR = '#applyCoupon, #singleColumn>form';\n\t\tthis.REMOVE_CODE_FORM_SELECTOR = this.APPLY_CODE_FORM_SELECTOR;\n\n\t\tthis.APPLY_REQUEST_BODY_DATA = {\n\t\t\t'/atg/commerce/promotion/CouponFormHandler.claimCoupon.x': '37',\n\t\t\t'/atg/commerce/promotion/CouponFormHandler.claimCoupon.y': '16',\n\t\t};\n\t\tthis.REMOVE_REQUEST_BODY_DATA = this.APPLY_REQUEST_BODY_DATA;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = '/atg/commerce/promotion/CouponFormHandler.couponClaimCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.REQUEST_HEADERS = {\n\t\t\taccept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',\n\t\t\t'content-type': 'application/x-www-form-urlencoded',\n\t\t};\n\n\t\tthis.CHARGES_REGEX = /(shipping|tax)/i;\n\t\tthis.CHARGES_SELECTOR = '#orderSummaryTable td:last-child, #cartSubTotalBox td:last-child';\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(code =>\n\t\t\t\tcode.innerText.trim().match(this.APPLIED_CODES_REGEXP)\n\t\t\t\t\t? code.innerText.trim().match(this.APPLIED_CODES_REGEXP)[1]\n\t\t\t\t\t: null,\n\t\t\t)\n\t\t\t.filter(Boolean);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode(' ').then(response => this._parseTotal(response));\n\t}\n\n\t// in FF request on cart page can be send only by sendXHR\n\t// but in Chrome only with fetch\n\t// that is why we need to detect in which driver user run Genie\n\t_manageCode(bodyData, headersData) {\n\t\tconst requestSender = navigator.userAgent.includes('Firefox') ? sendXHR : fetch;\n\t\treturn requestSender('https://www.calendars.com/checkout/billing.jsp?_DARGS=/checkout/billing.jsp', {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: bodyData.params,\n\t\t\theaders: headersData,\n\t\t}).then(response => response.text());\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]).then(() =>\n\t\t\twindow.history.replaceState(\n\t\t\t\twindow.history.state,\n\t\t\t\twindow.document.title,\n\t\t\t\twindow.location.href.split('?')[0],\n\t\t\t),\n\t\t);\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await this._getUpdatedCart();\n\t\tconst total = this._parseTotal(cartStr);\n\t\tconst taxes = [...extractElement(this.CHARGES_SELECTOR, cartStr.summary, true)]\n\t\t\t.filter(el => el.parentElement.textContent.match(this.CHARGES_REGEX))\n\t\t\t.map(elemToFloat)\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((charges, charge) => charges + charge, 0); // shipping & tax might not be counted on cart\n\t\treturn total - taxes;\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'alendars',\n\tdomain: 'calendars.com',\n\tDriver,\n\tcartContinueUrl: window.location.href.split('?')[0],\n\tisOnCartUrl(href) {\n\t\treturn href.match(/(http|https):\\/\\/www\\.calendars\\.com\\/checkout\\/(cart|order_review)\\.jsp/);\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector(\n\t\t\t'#cartItemsTable td:only-child, #zeroOrder, #orderSummaryTable tbody tr:nth-child(2) > td:first-child > span:first-child',\n\t\t);\n\t},\n};\n","import Promise from 'bluebird';\nimport atgCommerce from './_base';\nimport bus from '../../bus';\n\n/* Behaviour\n * can apply code;\n * can remove code;\n * can getExisting code;\n * can't apply multiple codes (not stackable);\n */\n\nconst CART_URL = 'https://www.carolina.com/checkout/cart.jsp';\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#promotional-code';\n\t\tthis.APPLIED_CODES_ATTRIBUTES = 'value';\n\t\tthis.TOTAL_SELECTOR = '.total .value';\n\t\tthis.REMOVE_BTN_ELEMENT = '.promotional-code-remove';\n\n\t\tthis.REQUEST_BODY_DATA = new URLSearchParams();\n\n\t\tthis.REQUEST_HEADERS = {\n\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.REQUEST_URL = 'https://www.carolina.com/spc/includes/cartIntermediateRequest.jsp';\n\t\tthis.REQUEST_CART_URL = 'https://www.carolina.com/spc/includes/displayCartTotals.jsp';\n\t}\n\n\tgetExistingCodes() {\n\t\t// the code remains in the value attribute after press remove button,\n\t\t// so if 'Remove' button has display style 'none' we don't get a code\n\t\tconst removeButton = document.querySelector(this.REMOVE_BTN_ELEMENT);\n\t\tconst isCodeRemoved = removeButton.style.display === 'none';\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(elem => (isCodeRemoved ? null : elem.getAttribute('value')))\n\t\t\t.filter(Boolean);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0])\n\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t.then(response => this._parseTotal(response));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code)\n\t\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t\t.then(response => {\n\t\t\t\t\tconst result = {\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t};\n\n\t\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\tif (result.finalPrice < originalPrice) {\n\t\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t}\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}),\n\t\t);\n\t}\n\n\t_removeCode(code) {\n\t\tthis.REQUEST_BODY_DATA.set('actionType', 'removeCouponCode');\n\t\treturn this._manageCode(code);\n\t}\n\n\t_applyCode(code) {\n\t\tthis.REQUEST_BODY_DATA.set('actionType', 'applyCouponCode');\n\t\treturn this._manageCode(code);\n\t}\n\n\t_manageCode(code) {\n\t\tthis.REQUEST_BODY_DATA.set('couponId', code);\n\t\treturn fetch(`${this.REQUEST_URL}?${this.REQUEST_BODY_DATA.toString()}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.REQUEST_HEADERS,\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(`${CART_URL}?_=${Date.now()}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Carolina',\n\tdomain: 'carolina.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.empty-cart'));\n\t},\n};\n","import Promise from 'bluebird';\nimport BaseDriver from '../base';\nimport bus from '../../bus';\nimport { completionActions, format, DOM } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { elemToFloat, toFloat } = format;\nconst { extractFormValues, setValue } = DOM;\n\nconst BASE_URL = 'https://www.competitivecyclist.com';\nconst IS_ON_CHECKOUT = window.location.href.includes('checkout');\nconst TOTAL_SELECTOR = '#order-total';\n\n/* Driver behavior description:\n    Existing code: no\n    Remove code: no\n    Stackable: no\n    Free gift support: no\n    isValid implemented: yes\n    Manually apply code: yes\n    sessionTimer: 15min\n    Active pages: Cart, Checkout\nOptional:\n    Show message about free shipping on the cart page: no\n    Is driver SPA and add the condition to show popup: no\n    Gather codes on site pages: no */\n\nconst Driver = class Driver extends BaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.FORM_SELECTOR = '#ajaxform-redeemCoupon';\n\t\tthis.SHIPPING_OPTIONS_SELECTOR = '[id^=\"ship-method-\"]';\n\t\tthis.PROMO_CODE_SELECTOR = '#promo-code';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#redeem-code';\n\t\tthis.MERCHAN_CODES_SELECTOR = '.js-header-global-text-promo';\n\t\tthis.MERCHANT_CODES_REGEX = /use code\\s+(.*)/i;\n\t\tthis.COUPON_LINK_SELECTOR = '#coupon-redemption-link';\n\t\tthis.BILLING_ZIPCODE = '#billing-anon-zipcode';\n\t\tthis.BILLING_COUNTRY = '#billing-anon-country';\n\t\tthis.BILLING_STATE = '#billing-anon-state-province';\n\t\tthis.BILLING_CITY = '#billing-anon-city';\n\t\tthis.BILLING_ADDRESS = '#billing-anon-address1';\n\t\tthis.SHIPPING_ZIPCODE = '#shipping-anon-zipcode';\n\t\tthis.SHIPPING_COUNTRY = '#shipping-anon-country';\n\t\tthis.SHIPPING_STATE = '#shipping-anon-state-province';\n\t\tthis.SHIPPING_CITY = '#shipping-anon-city';\n\t\tthis.SHIPPING_ADDRESS = '#shipping-anon-address1';\n\t\tthis.SAME_ADDRESS_SELECTOR = '#same-address';\n\t\tthis.EMPTY_CART_SELECTOR = '#empty-cart';\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst correctURL =\n\t\t\t(href.startsWith(`${BASE_URL}/Store/checkout/checkout.jsp`) ||\n\t\t\t\thref.startsWith(`${BASE_URL}/Store/cart/cart.jsp`)) &&\n\t\t\t!href.includes('wishlist');\n\t\tconst isEmptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\treturn correctURL && !isEmptyCart;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.applyRequestData = extractFormValues(this.FORM_SELECTOR);\n\t\tif (this.applyRequestData) {\n\t\t\tthis.applyRequestData.params.set('/atg/commerce/promotion/CouponFormHandler.claimCoupon', '');\n\t\t}\n\n\t\tif (IS_ON_CHECKOUT) {\n\t\t\tconst shipMethod = this._getShipMethod();\n\t\t\tconst billPostalCode = document.querySelector(this.BILLING_ZIPCODE).value;\n\t\t\tconst billCountry = document.querySelector(this.BILLING_COUNTRY).value;\n\t\t\tconst billState = document.querySelector(this.BILLING_STATE).value;\n\t\t\tconst billCity = document.querySelector(this.BILLING_CITY).value;\n\t\t\tthis.taxRequestParams = new URLSearchParams({\n\t\t\t\tcomputeTax: 'true',\n\t\t\t\tshipMethod,\n\t\t\t\tbillPostalCode,\n\t\t\t\tbillCountry,\n\t\t\t\tbillState,\n\t\t\t\tbillCity,\n\t\t\t});\n\t\t\tif (document.querySelector(this.SAME_ADDRESS_SELECTOR).checked) {\n\t\t\t\tthis.taxRequestParams.set('shipPostalCode', billPostalCode);\n\t\t\t\tthis.taxRequestParams.set('shipCountry', billCountry);\n\t\t\t\tthis.taxRequestParams.set('shipState', billState);\n\t\t\t\tthis.taxRequestParams.set('shipCity', billCity);\n\t\t\t\tthis.taxRequestParams.set('shipAddress1', document.querySelector(this.BILLING_ADDRESS).value);\n\t\t\t} else {\n\t\t\t\tthis.taxRequestParams.set('shipPostalCode', document.querySelector(this.SHIPPING_ZIPCODE).value);\n\t\t\t\tthis.taxRequestParams.set('shipCountry', document.querySelector(this.SHIPPING_COUNTRY).value);\n\t\t\t\tthis.taxRequestParams.set('shipState', document.querySelector(this.SHIPPING_STATE).value);\n\t\t\t\tthis.taxRequestParams.set('shipCity', document.querySelector(this.SHIPPING_CITY).value);\n\t\t\t\tthis.taxRequestParams.set('shipAddress1', document.querySelector(this.SHIPPING_ADDRESS).value);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [document.querySelector(this.MERCHANT_CODES_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODES_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\treturn this.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tif (applyCodeResponse.errorMessage || !applyCodeResponse.success) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\treturn this._updateOrderDetails().then(updatedOrder => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(updatedOrder);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\tif (result.finalDiscount <= 0) {\n\t\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t}\n\t\t\t\t\t// valid codes replace each other\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn IS_ON_CHECKOUT ? this.applyCodeManually(codes[0]) : this.applyCode(codes[0]);\n\t}\n\n\tapplyCode(code) {\n\t\tif (!IS_ON_CHECKOUT) {\n\t\t\treturn fetch(`${BASE_URL}/Store/services/coupon/${code}`, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: {\n\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t},\n\t\t\t}).then(response => response.json());\n\t\t}\n\t\tthis.applyRequestData.params.set('/atg/commerce/promotion/CouponFormHandler.couponClaimCode', code);\n\t\treturn fetch(this.applyRequestData.action, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: this.applyRequestData.params,\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t},\n\t\t}).then(response => response.json());\n\t}\n\n\t_updateOrderDetails() {\n\t\tlet requestURL = `${BASE_URL}/Store/cart/currentOrderDetails.json.jsp?_=${Date.now()}`;\n\t\tif (IS_ON_CHECKOUT) {\n\t\t\trequestURL = `${BASE_URL}/Store/cart/currentOrderDetails.json.jsp?${this.taxRequestParams.toString()}`;\n\t\t}\n\t\treturn fetch(requestURL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t},\n\t\t}).then(response => response.json());\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._updateOrderDetails().then(response => {\n\t\t\tconst total = toFloat(response.attributes.orderTotal);\n\t\t\tconst tax = toFloat(response.attributes.tax || 0);\n\t\t\tconst shipping = toFloat(response.attributes.shipping) || 0;\n\t\t\treturn total - shipping - tax;\n\t\t});\n\t}\n\n\t_parseTotal(dataJSON) {\n\t\tif (dataJSON) {\n\t\t\treturn toFloat(dataJSON.attributes.orderTotal);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(TOTAL_SELECTOR));\n\t}\n\n\tapplyCodeManually(code) {\n\t\tdocument.querySelector(this.COUPON_LINK_SELECTOR).click();\n\t\tsetValue(document.querySelector(this.PROMO_CODE_SELECTOR), code);\n\t\tdocument.querySelector(this.APPLY_BUTTON_SELECTOR).click();\n\t}\n\n\t_getShipMethod() {\n\t\t// Default standart shipping\n\t\tconst defaultShippingMethod = 'USTANDARD';\n\t\tconst shippingInputs = Array.from(document.querySelectorAll(this.SHIPPING_OPTIONS_SELECTOR));\n\t\tconst checkedInput = shippingInputs.find(input => input.checked);\n\t\treturn checkedInput ? checkedInput.value : defaultShippingMethod;\n\t}\n};\n\nexport default {\n\tname: 'Competitive Cyclist',\n\tdomain: 'competitivecyclist.com',\n\tcompletionAction: IS_ON_CHECKOUT ? completionActions.none : completionActions.reload,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport atgCommerce from './_base';\nimport bus from '../../bus';\nimport { completionActions, log, browserUtils } from '../../../utils';\nimport { sessionTimer, handleDriverError } from '../../lib';\nimport { toFloat } from '../../../utils/format';\nimport { extractElement } from '../../../utils/DOM';\n\nconst { wait } = browserUtils;\n\nconst DOMAIN_URL = 'https://www.eddiebauer.com';\nconst BASE_URL = `${DOMAIN_URL}/checkout`;\n\n/** Driver behavior:\n\t+ Existing code: yes\n\t+ Remove code: yes\n\t+ Stackable: no\n\t+ Free gift support: no\n\t+ isValid implemented: yes\n\t+ Show message about free shipping: no\n\t+ Driver is SPA: yes, rendered total, correct url and not empty cart and spinner not active\n\t+ Gather merchant codes: yes(main page)\n\t+ Special case: session timer 13 min.\n\t+ Pages: bag, payment, review\n * */\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.success-pro-code';\n\t\tthis.TOTAL_SELECTOR = '.os-subtotal > .os-detail';\n\t\tthis.COUPON_FIELD_CLOSED_SELECTOR = '#addPromoCodeClosed';\n\n\t\tthis.APPLY_CODE_FORM_SELECTOR = '#apply-promo-code';\n\t\tthis.REMOVE_CODE_FORM_SELECTOR = '#remove-promo-code';\n\n\t\tthis.FREE_SHIPPING_SELECTOR = '.free-ship-sum';\n\t\tthis.SHIPPING_SELECOTR = '.shipping-rate-link-cart';\n\t\tthis.TAX_SELECTOR = '.estimated-tax-link';\n\t\tthis.DONATION_SELECTOR = '.donation-info';\n\t\tthis.CART_VALUE_SELECTOR = '.right';\n\t\tthis.APPLY_REQUEST_BODY_DATA = {};\n\t\tthis.REMOVE_REQUEST_BODY_DATA = {};\n\n\t\tthis.APPLY_CODE_PARAM_NAME = '/atg/commerce/promotion/CouponFormHandler.couponClaimCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.APPLY_CODE_INPUT_SELECTOR = '#chkPromoCode';\n\t\tthis.APPLY_CODE_BTN_SELECTOR = '[data-formid=\"apply-promo-code\"]';\n\t\tthis.REMOVE_CODE_BTN_SELECTOR = '.remove-promo-code';\n\n\t\tthis.EMPTY_ELEMENT1_SELECTOR = '.cart-items-container';\n\t\tthis.EMPTY_ELEMENT2_SELECTOR = '#emptyCartLinks';\n\n\t\tthis.MAX_INTERVAL = 10 * 1000;\n\n\t\tthis.MAX_WAIT_TIME = 13;\n\t\tthis.DOM_CHECK_TIME = 60;\n\t\tthis.BEFORE_TEST_CODES_DELAY = 3 * 1000;\n\n\t\tthis.CORRECT_STEPS = ['bag.jsp', 'payment.jsp', 'review.jsp'];\n\n\t\tthis.MERCHANT_CODE_REGEX = /with code: (\\w+)/i;\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst totalRendered =\n\t\t\t(document.querySelector(this.TOTAL_SELECTOR) || {}).offsetParent && this._parseTotal() !== 0;\n\t\tconst correctUrl = this.CORRECT_STEPS.some(step => href.includes(step));\n\t\tconst emptyEl1 = document.querySelector(this.EMPTY_ELEMENT1_SELECTOR);\n\t\tconst emptyEl2 = document.querySelector(this.EMPTY_ELEMENT2_SELECTOR);\n\t\tconst isEmptyCart = emptyEl2 || (emptyEl1 && emptyEl1.innerText.match(/bag is currently empty/));\n\t\tconst spinnerActive = (document.querySelector('.loading-spinner') || {}).offsetParent;\n\n\t\treturn correctUrl && totalRendered && !isEmptyCart && !spinnerActive;\n\t}\n\n\twatchForCartUrl() {\n\t\t/* The driver turns off running after this.MAX_WAIT_TIME\n\t\tof inactivity. Every this.DOM_CHECK_TIME previous state of DOM is compared with the\n\t\tcurrent one. In case if it has been changed timer is resetted.\n\t\t*/\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: super.watchForCartUrl(),\n\t\t\ttimeout: this.MAX_WAIT_TIME,\n\t\t\tcheckDOMTime: this.DOM_CHECK_TIME,\n\t\t\ttoCheckDOM: true,\n\t\t});\n\t}\n\n\tbeforeTestCodes() {\n\t\treturn new Promise(resolve => {\n\t\t\tsetTimeout(() => {\n\t\t\t\t/*\n\t\t\t\tFor control if result of the extension's work is not more than the price before\n\t\t\t\trunning extension. Remove when it is unnecessary. A pause was added to prevent\n\t\t\t\tgetting total price during changing quantity (total is changed after pause). It\n\t\t\t\tis more relevant for slow internet.\n\t\t\t\t*/\n\t\t\t\tresolve();\n\t\t\t}, this.BEFORE_TEST_CODES_DELAY);\n\t\t});\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn fetch(DOMAIN_URL, { method: 'GET' })\n\t\t\t.then(res => res.text())\n\t\t\t.then(resHtml => {\n\t\t\t\treturn [resHtml.match(this.MERCHANT_CODE_REGEX)].filter(Boolean).map(item => item[1]);\n\t\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(el => el.innerText);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\tdocument.querySelector(this.REMOVE_CODE_BTN_SELECTOR).click();\n\t\treturn wait(\n\t\t\t() => (document.querySelector(this.COUPON_FIELD_CLOSED_SELECTOR) || {}).offsetParent,\n\t\t\tthis.MAX_INTERVAL,\n\t\t\t500,\n\t\t).then(() => this._parseTotal());\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Orginal price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code).then(responseJSON => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\t\t\t\tif (responseJSON && responseJSON.success) {\n\t\t\t\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseHTML);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tif (result.finalDiscount > 0) {\n\t\t\t\t\t\t\t// we need this switch in order to not apply invalid code\n\t\t\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst parseCartValue = selector => {\n\t\t\t\tconst elem = extractElement(selector, response)\n\t\t\t\t\t? extractElement(selector, response).parentElement.parentElement.querySelector(\n\t\t\t\t\t\t\tthis.CART_VALUE_SELECTOR,\n\t\t\t\t\t  )\n\t\t\t\t\t: null;\n\t\t\t\treturn elem ? elem.textContent : 0;\n\t\t\t};\n\t\t\tconst total = this._parseTotal(response);\n\t\t\tconst shipping = document.querySelector(this.FREE_SHIPPING_SELECTOR)\n\t\t\t\t? 0\n\t\t\t\t: toFloat(parseCartValue(this.SHIPPING_SELECOTR)) || 0;\n\t\t\tconst tax = toFloat(parseCartValue(this.TAX_SELECTOR)) || 0;\n\t\t\tconst donation = toFloat(parseCartValue(this.DONATION_SELECTOR)) || 0;\n\t\t\treturn total - shipping - tax - donation;\n\t\t});\n\t}\n\n\tasync _removeCode(code) {\n\t\t// Add to body parametr with code for removing\n\t\tif (this.REMOVE_CODE_PARAM_NAME) {\n\t\t\tconst codeArray = this.REMOVE_CODE_PARAM_NAME.split(',');\n\t\t\tawait this._getRemoveData();\n\t\t\tcodeArray.forEach(param => this.removeCodeData.params.set(param, code));\n\t\t}\n\n\t\treturn this._manageCode(this.removeCodeData, this.REQUEST_HEADERS);\n\t}\n\n\tasync _applyCode(code) {\n\t\tconst codeArray = this.APPLY_CODE_PARAM_NAME.split(',');\n\t\tawait this._getApplyData();\n\t\tcodeArray.forEach(param => this.applyCodeData.params.set(param, code));\n\n\t\treturn this._manageCode(this.applyCodeData, this.REQUEST_HEADERS);\n\t}\n\n\t_manageCode(bodyData) {\n\t\treturn fetch(`${bodyData.action}?_=${Math.random()}`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: bodyData.params,\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(\n\t\t\t\t\t\tnew Error('Invalid response', { response, body: JSON.stringify(bodyData.params) }),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(`${BASE_URL}/gadgets/bag/bag-order-summary.jsp?_=${Math.random()}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\tthis.lastResponse = response;\n\t\t\t\treturn this.lastResponse;\n\t\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Eddie Bauer',\n\tdomain: 'eddiebauer.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tshowDifferentDiscountMessage: true,\n\tcompletionAction: completionActions.revisit, // avoid alert\n};\n","import Promise from 'bluebird';\nimport atgCommerce from './_base';\nimport bus from '../../bus';\nimport { format, DOM, log } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement, extractFormValues } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: yes, on Cart page from the Available coupons block\n*/\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.removeCouponBtn';\n\t\tthis.APPLIED_CODES_ATTRIBUTES = 'data-id';\n\t\tthis.TOTAL_SELECTOR = '.estTotals .cartSummaryAmounts';\n\t\tthis.MERCHANT_CODE_SELECTOR = '.applyCouponBtn';\n\n\t\tthis.SHIPPING_SELECTOR = '#shippingAmount';\n\t\tthis.TAX_SELECTOR = '#taxDetail .cartSummaryAmounts';\n\n\t\tthis.APPLY_CODE_FORM_SELECTOR = '#promoCodeForm';\n\t\tthis.REMOVE_CODE_FORM_SELECTOR = '#removeCouponForm';\n\t\tthis.APPLY_CODE_PARAM_NAME = 'promoCodeEntry';\n\t\tthis.REMOVE_CODE_PARAM_NAME = '/gdi/ui/handler/RemoveCouponFormHandler.couponCode';\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.MERCHANT_CODE_SELECTOR)].map(code =>\n\t\t\tcode.getAttribute(this.APPLIED_CODES_ATTRIBUTES),\n\t\t);\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Orginal price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code).then(response => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\t\t\t\t// if no error may be 'error: \"false\"'\n\t\t\t\tif (response.error === 'true') {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedPage().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst taxEl = extractElement(this.TAX_SELECTOR, response);\n\t\t\tconst tax = taxEl ? elemToFloat(taxEl) || 0 : 0;\n\t\t\tconst total = elemToFloat(extractElement(this.TOTAL_SELECTOR, response));\n\t\t\treturn total - shipping - tax;\n\t\t});\n\t}\n\n\t_getRemoveData() {\n\t\tif (!this.removeCodeData) {\n\t\t\tthis.removeCodeData = extractFormValues(this.REMOVE_CODE_FORM_SELECTOR);\n\t\t}\n\t\treturn this.removeCodeData;\n\t}\n\n\t_getApplyData() {\n\t\tif (!this.applyCodeData) {\n\t\t\tthis.applyCodeData = extractFormValues(this.APPLY_CODE_FORM_SELECTOR);\n\t\t}\n\t\treturn this.applyCodeData;\n\t}\n\n\t_getUpdatedPage() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(res => res.text());\n\t}\n\n\t_parseTotal(data) {\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, data ? data.cartSummary : null));\n\t}\n};\n\nexport default {\n\tname: 'Garage Clothing',\n\tdomain: 'garageclothing.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith('https://www.garageclothing.com/us/checkout/cart.jsp') &&\n\t\t\tdocument.querySelector('#promoCodeEntry')\n\t\t);\n\t},\n};\n","import atgCommerce from './_base';\n\n/* Driver description:\n- we can apply code on cart and checkout pages\n- we can remove code\n- we can get existing code\n- codes can't replace each other\n- Special case:\n- after several retesting codes merchant can block us so we need to decrease amount of testing codes\n*/\n\nconst BASE_URL = 'https://www.heb.com';\nconst CART_URL = `${BASE_URL}/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/check-out/payment-details`;\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#triggerRemoveCode';\n\t\tthis.APPLIED_CODES_ATTRIBUTES = 'name';\n\t\tthis.TOTAL_SELECTOR = '#cart_total, #defaultOrderTotal .qty';\n\n\t\tthis.APPLY_CODE_FORM_SELECTOR = '#couponForm';\n\t\tthis.REMOVE_CODE_FORM_SELECTOR = this.APPLY_CODE_FORM_SELECTOR;\n\t\tthis.REQUEST_PREFIX = '/atg/store/order/purchase/CouponFormHandler';\n\n\t\tthis.APPLY_REQUEST_BODY_DATA = {\n\t\t\t'/atg/store/order/purchase/CouponFormHandler.actionType': 'add',\n\t\t};\n\t\tthis.REMOVE_REQUEST_BODY_DATA = {\n\t\t\t'/atg/store/order/purchase/CouponFormHandler.actionType': 'remove',\n\t\t};\n\n\t\tthis.APPLY_CODE_PARAM_NAME = `${this.REQUEST_PREFIX}.couponCode`;\n\t\tthis.REMOVE_CODE_PARAM_NAME = `${this.REQUEST_PREFIX}.removeCouponCode`;\n\t}\n};\n\nexport default {\n\tname: 'H-E-B Grocery',\n\tmaxCoupons: 10,\n\tdomain: 'heb.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL);\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.red').innerText.match(/There are no items in cart/);\n\t},\n};\n","import Promise from 'bluebird';\nimport atgCommerce from './_base';\nimport bus from '../../bus';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElementFromHTML, extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/**\nDriver behavior:\n   Existing code: yes\n   Remove code: no\n   Code retesting: no, can't remove codes\n   Stackable: no\n   Free gift support: no\n   isValid implemented: no\n   Show message about free shipping: no\n   Driver is SPA: no, works on cart & checkout-review\n   Gather merchant codes: no\n   Special case: When we have only one working code and try to test a couple of codes the site will behave like stackable but it isn't. Only one of them will give a discount. If we write stackCodes() method, the driver could choose `fake  code` like the best code\n   Credentials: no\n   Test Item(s): https://www.horchow.com/Lauren-Ralph-Lauren-Sanders-Matching-Items/cprod146020012/p.prod\n   Valid Code(s): -, last checked 03-25-2019\n*/\n\nconst BASE_URL = 'https://www.horchow.com';\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.promo.desc';\n\t\tthis.APPLIED_CODES_REGEXP = /applied:\\s([a-aA-Z0-9,]*)/i;\n\t\tthis.TOTAL_SELECTOR = '#txt_orderTotal';\n\n\t\tthis.APPLY_CODE_FORM_SELECTOR = '#promo-form';\n\n\t\tthis.APPLY_REQUEST_BODY_DATA = {\n\t\t\t'/nm/formhandler/checkout/CartFormHandler.applyPromoCode': 'Apply',\n\t\t};\n\n\t\tthis.APPLY_CODE_PARAM_NAME = '/nm/formhandler/checkout/CartFormHandler.promoCode';\n\n\t\tthis.CHARGES_SELECTORS = ['#txt_giftPackingAmount', '#txt_deliveryAndProcessingCharges', '#txt_taxAmount'];\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codesOnPage = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(code => code.innerText.match(this.APPLIED_CODES_REGEXP))\n\t\t\t.filter(Boolean);\n\n\t\tconst codes = codesOnPage.length === 0 ? [] : codesOnPage.map(match => match[1].split(','))[0];\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\tcheckCodes(codes) {\n\t\tconst originalPrice = this._parseTotal();\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\n\t\t\treturn this._applyCode(code)\n\t\t\t\t.then(() => this._getSummary())\n\t\t\t\t.then(responseHTML => {\n\t\t\t\t\tif (!extractElementFromHTML(responseHTML, '.BadPromoCode')) {\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseHTML);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tresult.isValid = result.finalPrice < originalPrice;\n\n\t\t\t\t\t\tbus.$emit('code-checked', result);\n\t\t\t\t\t\tresult.originalPrice = originalPrice;\n\t\t\t\t\t\treturn bus.$emit('send-validation-codes', result);\n\t\t\t\t\t}\n\t\t\t\t\tbus.$emit('code-checked', result);\n\t\t\t\t\tresult.originalPrice = originalPrice;\n\t\t\t\t\treturn bus.$emit('send-validation-codes', result);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await this._getSummary();\n\t\tconst total = this._parseTotal(cartStr);\n\t\tconst taxes = this.CHARGES_SELECTORS.map(chargeSelector => extractElement(chargeSelector, cartStr))\n\t\t\t.filter(Boolean)\n\t\t\t.map(chargeElement => elemToFloat(chargeElement))\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((charges, charge) => charges + charge, 0); // shipping & tax might not be counted on cart\n\t\treturn total - taxes;\n\t}\n\n\t_getSummary() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_manageCode(bodyData, headersData) {\n\t\treturn fetch(bodyData.action, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: bodyData.params,\n\t\t\theaders: headersData,\n\t\t\tredirect: 'manual',\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Horchow',\n\tdomain: 'horchow.com',\n\tDriver,\n\tvalidationSupport: true,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith(`${BASE_URL}/checkout/cart.jsp`) || href.startsWith(`${BASE_URL}/checkout/orderreview.jsp`)\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('#shopping_bag_header ~ div:first-of-type[class=\"clr\"]'));\n\t},\n};\n","import autozone from './autozone.com';\nimport barneyswarehouse from './barneyswarehouse.com';\nimport calendars from './calendars.com';\nimport carolina from './carolina.com';\nimport competitivecyclist from './competitivecyclist.com';\nimport eddiebauer from './eddiebauer.com';\nimport garageclothing from './garageclothing.com';\nimport heb from './heb.com';\nimport horchow from './horchow.com';\nimport lastcall from './lastcall.com';\nimport michaelkors from './michaelkors.com';\nimport nutrisystem from './nutrisystem.com';\nimport rue21 from './rue21.com';\nimport shoemall from './shoemall.com';\nimport teleflora from './teleflora.com';\nimport uscellular from './uscellular.com';\nimport zennioptical from './zennioptical.com';\n\nexport default [\n\tautozone,\n\tbarneyswarehouse,\n\tcalendars,\n\tcarolina,\n\tcompetitivecyclist,\n\teddiebauer,\n\tgarageclothing,\n\theb,\n\thorchow,\n\tlastcall,\n\tmichaelkors,\n\tnutrisystem,\n\true21,\n\tshoemall,\n\tteleflora,\n\tuscellular,\n\tzennioptical,\n];\n","import Promise from 'bluebird';\nimport BaseDriver from '../base';\nimport bus from '../../bus';\nimport { DOM, format, log } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractFormValues, extractElement } = DOM;\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: no\n    Stackable: yes\n    Free gift support: no\n    isValid implemented: no\n    maxCoupons: 10\n    code testing may be run on 'Cart' and 'Payment' pages;\nOptional:\n    There are codes, that can replace another codes\n    Show message about free shipping on the cart page (without discount info): no\n    Is driver SPA and add the condition to show popup: yes\n    Gather codes on site pages: no\n======== Special case ========\nwe can't remove codes, so there is no need to stack codes */\n\nconst BASE_URL = 'https://www.lastcall.com/checkout';\nconst CART_URL = `${BASE_URL}/cart.jsp`;\nconst IS_ON_CART = window.location.href.startsWith(CART_URL);\n\nconst Driver = class Driver extends BaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLIED_CODES_SELECTOR = IS_ON_CART ? '.ordercharges .promo.desc.code' : '.ordercharges .promo.desc';\n\t\tthis.TOTAL_SELECTOR = '#txt_orderTotal';\n\t\tthis.BAD_PROMO_SELECTOR = '.BadPromoCode';\n\t\tthis.CODE_REGEX = IS_ON_CART ? /(.*)/ : /Promotion[s]? Applied(.*)/;\n\n\t\tthis.MERCHANT_CODES_SELECTOR = '.promo-container .promo-text span:last-child, span.coupon';\n\n\t\tthis.SHIPPING_SELECTOR = '#txt_deliveryAndProcessingCharges';\n\t\tthis.TAX_SELECTOR = '#txt_taxAmount';\n\n\t\tthis.SUBMIT_ELEMENT_SELECTOR = '#promo-form [name=\"/nm/formhandler/checkout/CartFormHandler.applyPromoCode\"]';\n\t\tthis.FORM_SELECTOR = '#promo-form';\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst rightUrl = href.startsWith(CART_URL) || href.startsWith(`${BASE_URL}/orderreview.jsp`);\n\t\tconst totalElem = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst isTotal = totalElem ? toFloat(totalElem.textContent) !== 0 : false;\n\t\tconst currentState = rightUrl && isTotal;\n\t\treturn currentState;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...new Set([...document.querySelectorAll(this.MERCHANT_CODES_SELECTOR)].map(el => el.textContent))];\n\t}\n\n\tgetExistingCodes(data) {\n\t\tconst codesElement = extractElement(this.APPLIED_CODES_SELECTOR, data);\n\t\tlet codes = [];\n\t\tif (codesElement) {\n\t\t\tcodes = codesElement.innerText\n\t\t\t\t.match(this.CODE_REGEX)[1]\n\t\t\t\t.split(',')\n\t\t\t\t.map(code => code.replace(':', '').trim())\n\t\t\t\t.filter(Boolean);\n\t\t}\n\t\tthis.existingCodes = codes;\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.requestData = extractFormValues(this.FORM_SELECTOR);\n\t\tconst submitInputElement = document.querySelector(this.SUBMIT_ELEMENT_SELECTOR);\n\t\tif (this.requestData && submitInputElement) {\n\t\t\t// `FormData()` in `extractFormValues()` does not grab input with submit type\n\t\t\tthis.requestData.params.set(\n\t\t\t\t'/nm/formhandler/checkout/CartFormHandler.applyPromoCode',\n\t\t\t\tsubmitInputElement.value,\n\t\t\t);\n\t\t}\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlet currentPrice = originalPrice;\n\t\tlet workingCodes = this.existingCodes;\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t};\n\t\t\treturn this._applyCode(code, this.requestData)\n\t\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t\t.then(html => {\n\t\t\t\t\tconst currentAppliedCodes = this.getExistingCodes(html).codes;\n\t\t\t\t\tif (\n\t\t\t\t\t\textractElement(this.BAD_PROMO_SELECTOR, html) ||\n\t\t\t\t\t\t(currentAppliedCodes.length && !currentAppliedCodes.includes(code)) // check if current code is on the page\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t}\n\t\t\t\t\tresult.finalPrice = this._parseTotal(html);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\t// if currentCode increases price, we apply codes that were applied before\n\t\t\t\t\tif (result.finalPrice > currentPrice) {\n\t\t\t\t\t\treturn Promise.each(workingCodes, workingCode => {\n\t\t\t\t\t\t\tif (currentAppliedCodes.includes(workingCode)) {\n\t\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn this._applyCode(workingCode, this.requestData);\n\t\t\t\t\t\t}).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t}\n\t\t\t\t\tcurrentPrice = result.finalPrice;\n\t\t\t\t\tworkingCodes = currentAppliedCodes;\n\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t}).then(() => {\n\t\t\t// we can't remove codes, so they are already applied\n\n\t\t\treturn bus.$emit('stack-codes', {\n\t\t\t\tcodes: workingCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: originalPrice - currentPrice,\n\t\t\t});\n\t\t});\n\t}\n\n\tstackCodes(stackedCodes) {\n\t\t// we can't remove codes, so they are already applied\n\t\treturn bus.$emit('stackable-complete', stackedCodes);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0], this.requestData);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(html => {\n\t\t\tconst total = this._parseTotal(html);\n\n\t\t\tconst shippingElement = extractElement(this.SHIPPING_SELECTOR, html);\n\t\t\tconst shipping = shippingElement ? elemToFloat(shippingElement) || 0 : 0;\n\n\t\t\tconst taxElement = extractElement(this.TAX_SELECTOR, html);\n\t\t\tconst tax = taxElement ? elemToFloat(taxElement) || 0 : 0;\n\n\t\t\treturn total - shipping - tax;\n\t\t});\n\t}\n\n\t_applyCode(code, requestData) {\n\t\trequestData.params.set('/nm/formhandler/checkout/CartFormHandler.promoCode', code);\n\t\treturn fetch(requestData.action, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: requestData.params,\n\t\t\tcredentials: 'include',\n\t\t\tredirect: 'manual',\n\t\t\theaders: {\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t},\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_parseTotal(data = false) {\n\t\tconst totalElement = extractElement(this.TOTAL_SELECTOR, data).textContent.trim();\n\t\t// Price format can be different: '$126,00', '$126.00' and '$2,123.00'\n\t\treturn toFloat(totalElement.length < 9 ? totalElement.replace(',', '.') : totalElement.replace(',', ''));\n\t}\n};\n\nexport default {\n\tname: 'Last Call',\n\tdomain: 'lastcall.com',\n\tDriver,\n\tstackable: true,\n\tisSinglePageApp: true,\n\tmaxCoupons: 10, // may block\n};\n","/*    eslint class-methods-use-this: [\"error\", { \"exceptMethods\": [\"_codeAppliedCheck\", \"_getUpdatedCart\", \"_manageCode\"] }] */\nimport Promise from 'bluebird';\nimport atgCommerce from './_base';\nimport bus from '../../bus';\n\nimport { format, DOM, log } from '../../../utils';\nimport { sessionTimer } from '../../lib';\nimport { extractData } from '../../../utils/DOM';\nimport { toFloat } from '../../../utils/format';\n\nconst { elemToFloat } = format;\nconst { extractFormValues, extractElement } = DOM;\n\nconst BASE_URL = 'https://www.michaelkors.com';\n\n/*\nDriver behaviour description:\n    Remove code: yes\n    Existing code: yes\n    Stackable: ? (only one code exists)\n    Free gift support: no\n    'isValid' implemented: yes\n    Is driver SPA and add the condition to show popup: yes\n\tsessionTimer: 15 min\n\trun testing on the cart and checkout(2 & 3 steps) pages.\n\tOn the checkout after reloading page user wil be redirected to the 1 step, but his data will be saved\n*/\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.removeFromCoupons';\n\t\tthis.APPLIED_CODES_REGEXP = /couponId=([0-9A-Za-z]*)/;\n\t\tthis.TOTAL_SELECTOR = '.product-values .total:first-child, #summary .text-right .font-ordersummary-total';\n\t\tthis.REMOVE_PARAMETR_SELECTOR = '#couponAppliedFromPayment';\n\t\tthis.APPLY_CODE_FORM_SELECTOR = '#orderPromotionForm';\n\n\t\tthis.APPLY_REQUEST_URL = `${BASE_URL}/checkout/common/ajaxFormSubmit.jsp`;\n\t\tthis.DATA_SUMMARY_URL = `${BASE_URL}/checkout/includes/shoppingCartInclude.jsp`;\n\n\t\tthis.INPUT_CODE_SELECTOR = '#orderPromotionForm #shopping-bag-promo';\n\t\tthis.PROMO_SECTION_SELECTOR = '[href=\"#cartPromotion\"], [href=\"#checkoutPromotion\"]';\n\t\tthis.SHIPPING_SELECTOR = '#shippingContainer';\n\n\t\tthis.SHIPPING_AND_TAX_SELECTOR = window.location.href.includes('shoppingCart')\n\t\t\t? '.shopping-bag-order-summary-details li .pull-right'\n\t\t\t: '#order-summary li:nth-of-type(2) .pull-right, #order-summary li:nth-of-type(3) .pull-right, #order-summary li:nth-of-type(4) .pull-right';\n\n\t\tsessionTimer.initialize();\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\n\t\tconst cartURL =\n\t\t\thref.startsWith(`${BASE_URL}/checkout/shoppingCart.jsp`) &&\n\t\t\tdocument.querySelector(this.INPUT_CODE_SELECTOR);\n\t\tconst checkoutURL =\n\t\t\thref.startsWith(`${BASE_URL}/checkout/checkout.jsp`) &&\n\t\t\t(document.querySelector(this.SHIPPING_SELECTOR) &&\n\t\t\t\tdocument.querySelector(this.SHIPPING_SELECTOR).classList.contains('complete'));\n\n\t\treturn checkoutURL || cartURL;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst aplliedCodeEl = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\tconst codes = aplliedCodeEl ? [aplliedCodeEl.getAttribute('href').match(this.APPLIED_CODES_REGEXP)[1]] : [];\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\tdocument.querySelector(this.APPLIED_CODES_SELECTOR).click();\n\t\tdocument.querySelector(this.PROMO_SECTION_SELECTOR).click();\n\n\t\treturn Promise.delay(3000)\n\t\t\t.then(() => this._dataSummary())\n\t\t\t.then(responseText => this._parseTotal(responseText));\n\t}\n\n\tbeforeCheckCodes() {\n\t\tthis.APPLY_BODY = extractFormValues(this.APPLY_CODE_FORM_SELECTOR);\n\t\treturn Promise.resolve();\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(response => {\n\t\t\t\tif (response.status === 403) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\treturn response\n\t\t\t\t\t.clone()\n\t\t\t\t\t.json()\n\t\t\t\t\t.catch(() => response.text())\n\t\t\t\t\t.then(responseJSON => {\n\t\t\t\t\t\tif (this._codeAppliedCheck(responseJSON)) {\n\t\t\t\t\t\t\treturn this._dataSummary().then(responseHTML => {\n\t\t\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseHTML);\n\t\t\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\t\t\t\treturn this._removeCode(responseHTML).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst total = this._parseTotal(responseHTML);\n\t\t\tconst data = [...extractData(this.SHIPPING_AND_TAX_SELECTOR, responseHTML, true)].map(el => {\n\t\t\t\treturn el.includes('--') ? 0 : toFloat(el);\n\t\t\t});\n\t\t\tconst taxData = data.reduce((a, c) => a + c);\n\t\t\treturn total - taxData;\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\treturn data.result !== 'error' || !data.errors;\n\t}\n\n\t_dataSummary() {\n\t\treturn this._manageCode(this.DATA_SUMMARY_URL, 'GET').then(response => response.text());\n\t}\n\n\t_applyCode(code) {\n\t\tthis.APPLY_BODY.params.set('couponCode', code);\n\t\tthis.APPLY_BODY.params.set('formName', 'orderPromotionForm');\n\n\t\treturn this._manageCode(this.APPLY_REQUEST_URL, 'POST', this.APPLY_BODY.params);\n\t}\n\n\t_removeCode(data = false) {\n\t\tconst removeUrl = extractElement(this.APPLIED_CODES_SELECTOR, data).getAttribute('href');\n\t\tconst couponAppliedFromPayment = extractData(this.REMOVE_PARAMETR_SELECTOR, false, 'value');\n\t\treturn this._manageCode(`${BASE_URL}${removeUrl}&couponAppliedFromPayment=${couponAppliedFromPayment}`, 'POST');\n\t}\n\n\t_manageCode(url, method, body) {\n\t\treturn fetch(url, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t},\n\t\t\tbody,\n\t\t}).then(response => response);\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, data));\n\t}\n};\n\nexport default {\n\tname: 'Michael Kors',\n\tdomain: 'michaelkors.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tmaxCoupons: 3, // site block us after 5 requests\n};\n","import atgCommerce from './_base';\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Payment step(https://www.nutrisystem.com/checkout/billing.jsp)\n+ Is driver SPA: no\n+ Gather codes on site pages: yes\n+ credentials: Email: dskfjhdsajkdfh@yahoo.com, Password: tH6yP4FWWF3Zdjq\n+ maxCoupons: 8, due to slow code testing\n*/\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.promo-table td:last-child a';\n\t\tthis.APPLIED_CODES_ATTRIBUTES = 'id';\n\t\tthis.TOTAL_SELECTOR = '.totals .price';\n\n\t\tthis.APPLY_CODE_FORM_SELECTOR = '[name=checkoutPromo]';\n\t\tthis.REMOVE_CODE_FORM_SELECTOR = '[name=orderPromoSummary]';\n\n\t\tthis.APPLY_REQUEST_BODY_DATA = {\n\t\t\t'/nutrisystem/order/CouponGiftCertificateHandler.applyCoupon': '',\n\t\t};\n\t\tthis.REMOVE_REQUEST_BODY_DATA = {\n\t\t\t'/nutrisystem/order/CouponGiftCertificateHandler.removePromoCoupon': 'Submit',\n\t\t};\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'promo-code';\n\t\tthis.REMOVE_CODE_PARAM_NAME = '/nutrisystem/order/CouponGiftCertificateHandler.removeCouponId';\n\n\t\tthis.REQUEST_HEADERS = {\n\t\t\tAccept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t};\n\n\t\tthis.isStackable = true;\n\t\tthis.PROPOSED_CODES_SELECTOR = '.bx-row-coupon div';\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [\n\t\t\t...new Set(\n\t\t\t\t[...document.querySelectorAll(this.PROPOSED_CODES_SELECTOR)].map(el => el.textContent).filter(Boolean),\n\t\t\t),\n\t\t];\n\t}\n};\n\nexport default {\n\tname: 'nutriSystem',\n\tdomain: 'nutrisystem.com',\n\tstackable: true,\n\tDriver,\n\tmaxCoupons: 8,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.nutrisystem.com/checkout/billing.jsp');\n\t},\n};\n","import Promise from 'bluebird';\nimport atgCommerce from './_base';\nimport bus from '../../bus';\nimport { DOM, completionActions, log, format } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { extractElement, extractData } = DOM;\nconst { elemToFloat } = format;\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: yes (some codes)\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout(SIGN IN / GUEST CHECKOUT, PAYMENT, REVIEW AND PLACE ORDER)\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n+ Special case about the driver works:\n\t- sessionTimer yes (30min)\n\t- if user apply one code(002822), after that, without deleting,  apply another code(050686), the first one doesn`t delete, it will save for later\n      if we delete one code, another code, that was saved for later, will be applied again\n\t  but this code will be shown after go to Checkout and go back to Cart (if you are on Cart page) or refresh page (if you are on Checkout page),\n\t  so after all type of manipulation get response from Checkout and work with it\n\t- get existing codes from Checkout page\n\t- don't support Shipping, because after reloading we lose information\n+ Credentials (josephhhhh@gmail.com, 12345qwertyQ)\n*/\n\nconst BASE_URL = 'https://www.rue21.com/store/checkout';\nconst CHECKOUT_URL = `${BASE_URL}/singlePageCheckout.jsp`;\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#coupounRemItemId0';\n\t\tthis.APPLIED_CODES_ATTRIBUTES = 'value';\n\t\tthis.TOTAL_SELECTOR = '#order-total';\n\t\tthis.VALID_CODE_SELECTOR = '.promo-codes-applied .promo-name';\n\t\tthis.APPLY_CODE_FORM_SELECTOR = '#couponForm';\n\t\tthis.REMOVE_CODE_FORM_SELECTOR = '#couponRemoveForm';\n\n\t\tthis.APPLY_REQUEST_BODY_DATA = {\n\t\t\t'/atg/commerce/promotion/CouponFormHandler.claimCoupon': 'apply',\n\t\t};\n\n\t\tthis.APPLY_CODE_PARAM_NAME = '/atg/commerce/promotion/CouponFormHandler.couponClaimCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = '/atg/commerce/promotion/CouponFormHandler.unClaimCoupon';\n\t\tthis.SHIPPING_TYPE_PARAM_NAME = '/atg/commerce/order/purchase/ShippingGroupFormHandler.shippingMethod';\n\n\t\tthis.REQUEST_HEADERS = {\n\t\t\taccept: 'text/html, */*',\n\t\t};\n\n\t\tthis.CODE_INPUT_SELECTOR = '.promo-code-text-input';\n\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty-message';\n\t\tthis.REMOVE_CODE_BUTTON_SELECTOR = '.removeCouponFromCart';\n\t\tthis.CHECKOUT_STEPS_SELECTOR = '.mainContainer';\n\n\t\tthis.SHIPPING_SELECTOR = '.ship-handling .summary-value';\n\t\tthis.TAX_SELECTOR = '.checkoutTax .summary-value';\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 30,\n\t\t\ttoCheckDOM: true,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnCartUrl = href.startsWith(`${BASE_URL}/cart.jsp`);\n\t\tconst isCodeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst checkoutStepsEl = document.querySelector(this.CHECKOUT_STEPS_SELECTOR);\n\t\tconst isOnRightCheckoutStep = checkoutStepsEl ? this._checkCheckoutStep(checkoutStepsEl) : false;\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst currentState = (isOnCartUrl || isOnRightCheckoutStep) && !isCartEmpty && isCodeInput;\n\t\treturn currentState;\n\t}\n\n\tgetExistingCodes() {\n\t\t// if user apply one code, after that, without deleting,  apply another code, the first one doesn`t delete, it will save for later\n\t\t// if we delete one code, another code, that was saved for later, will be applied again\n\t\t// but this code will be shown after go to Checkout and go back to Cart (if you are on Cart page) or refresh page (if you are on Checkout page),\n\t\treturn this._getUpdatedCheckout().then(responseText => {\n\t\t\tconst codes = [...extractElement(this.APPLIED_CODES_SELECTOR, responseText, true)].map(code =>\n\t\t\t\tcode.getAttribute(this.APPLIED_CODES_ATTRIBUTES),\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\t// if user apply one code, after that, without deleting,  apply another code, the first one doesn`t delete, it will save for later\n\t// if we delete one code, another code, that was saved for later, will be applied again\n\t// we need to remove all of code while btn `remove` present on the page\n\tremoveCodes(codes) {\n\t\tlet lastResponse = null;\n\t\tlet currentCode = codes[0];\n\t\tconst arr = [...new Array(15)];\n\n\t\treturn Promise.each(arr, () => {\n\t\t\tif (currentCode) {\n\t\t\t\treturn this._removeCode(currentCode)\n\t\t\t\t\t.then(() => this._getUpdatedCheckout())\n\t\t\t\t\t.then(responseText => {\n\t\t\t\t\t\tconst removeCodeBtnSelector = extractElement(this.REMOVE_CODE_BUTTON_SELECTOR, responseText);\n\t\t\t\t\t\tcurrentCode = removeCodeBtnSelector\n\t\t\t\t\t\t\t? extractData(this.APPLIED_CODES_SELECTOR, responseText, null, 'value')\n\t\t\t\t\t\t\t: null;\n\t\t\t\t\t\tlastResponse = responseText;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.reject(new Error('All codes removed'));\n\t\t}).catch(error => {\n\t\t\tif (error.message !== 'All codes removed') {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t\treturn this._parseTotal(lastResponse);\n\t\t});\n\t}\n\n\tbeforeCheckCodes(originalPrice) {\n\t\tif (originalPrice) {\n\t\t\treturn originalPrice;\n\t\t}\n\t\t// need to get Checkout page to get the right total price\n\t\treturn this._getUpdatedCheckout().then(responseText => this._parseTotal(responseText));\n\t}\n\n\tcheckCodes(codes, originalPrice) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code)\n\t\t\t\t.then(() => this._getUpdatedCheckout())\n\t\t\t\t.then(response => {\n\t\t\t\t\tconst result = {\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t};\n\t\t\t\t\tresult.isValid = Boolean(extractElement(this.VALID_CODE_SELECTOR, response));\n\t\t\t\t\tif (!result.isValid) {\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t}\n\t\t\t\t\tresult.finalPrice = this._parseTotal(response);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCheckout().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst tax = extractElement(this.TAX_SELECTOR, response);\n\t\t\tconst taxValue = tax ? elemToFloat(tax) : 0;\n\t\t\treturn this._parseTotal(response) - shipping - taxValue;\n\t\t});\n\t}\n\n\t_getUpdatedCheckout() {\n\t\treturn fetch(CHECKOUT_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_checkCheckoutStep(checkoutStepsEl) {\n\t\tconst currentStep = checkoutStepsEl.getAttribute('current-step');\n\t\tconst isOnShipping = currentStep === 'shipping';\n\t\treturn !isOnShipping;\n\t}\n};\n\nexport default {\n\tname: 'rue21',\n\tdomain: 'rue21.com',\n\tisSinglePageApp: true,\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n};\n","import Promise from 'bluebird';\nimport BaseDriver from '../base';\nimport bus from '../../bus';\nimport { format, DOM, log, browserUtils } from '../../../utils';\n\nconst { elemToFloat, toFloat, toInt } = format;\nconst { extractElement, extractFormValues } = DOM;\nconst { getCookie, setCookie } = browserUtils;\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: no\n    Free gift support: no\n    isValid implemented: yes\n    Manually apply code: no\n    active page: Cart\n    maxCoupons: 6\nOptional:\n    Show message about free shipping on the cart page (without discount info): no\n    Is driver SPA and add the condition to show popup: yes\n    Gather codes on site pages: yes\n============Special case==========\nCheckout page is not supported due to redirection to the Cart page\nafter final code applying (cannot avoid cart),\nalso there are issue with removing code\n also we can run contesting only 4 times in 40 minutes, due to site behavior that return 429 error status */\n\nconst BASE_URL = 'https://www.shoemall.com';\nconst CART_URL = `${BASE_URL}/cart/cart.jsp`;\n\nconst Driver = class Driver extends BaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLIED_CODES_SELECTOR = '[name$=couponCode]';\n\t\tthis.TOTAL_SELECTOR = '.total.bold span:last-child';\n\t\tthis.SESSION_SELECTOR = '.SessionExpired';\n\t\tthis.FORM_DATA_SELECTOR = '#couponform, #applyCouponForm';\n\t\tthis.APPLY_URL = `${BASE_URL}/cart/gadgets/?_DARGS=/cart/gadgets/promotion.jsp`;\n\t\tthis.INVALID_CODE_SELECTOR = '#atg_store_promotionCodeInput_error, #promotionCodeInput_error';\n\t\tthis.REMOVE_BUTTON_SELECTOR = 'a[title=\"remove\"], .successPromoCoupon a';\n\t\tthis.EMPTY_CART_EL_SELECTOR = '.emptycart-item-message';\n\t\tthis.ERROR_EL_SELECTOR = '.cf-error-overview';\n\t\tthis.lastResponse = null;\n\t\tthis.PAGE_CONTENT_SELECTOR = '.page-content';\n\n\t\tthis.MERCHANT_PROMO_BLOCK_SELECTOR = '.SM-sale-banner-promo-code b';\n\t\tthis.SUMMERY_BLOCK_SELECTOR = '#orderSummary .clearfix';\n\t\tthis.SUMMERY_VALUE = '.regular-text';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_EL_SELECTOR);\n\t\tconst errorEl = document.querySelector(this.ERROR_EL_SELECTOR);\n\t\tconst sessionExpired = document.querySelector(this.SESSION_SELECTOR);\n\t\tconst isRightUrl = href.startsWith(CART_URL);\n\t\tconst isCorrectPage = document.title && !document.title.includes('Site Under Maintenance');\n\n\t\tif (!getCookie('numberOfTesting')) {\n\t\t\tsetCookie('numberOfTesting', 1, 40);\n\t\t}\n\n\t\treturn (\n\t\t\tisRightUrl &&\n\t\t\t!errorEl &&\n\t\t\t!isCartEmpty &&\n\t\t\t!sessionExpired &&\n\t\t\tisCorrectPage &&\n\t\t\ttoInt(getCookie('numberOfTesting')) < 4\n\t\t);\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\treturn [...extractElement(this.MERCHANT_PROMO_BLOCK_SELECTOR, response, true)]\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(code => code.innerText);\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set();\n\t\tif (document.querySelector(this.PAGE_CONTENT_SELECTOR)) {\n\t\t\tif (document.querySelector(this.REMOVE_BUTTON_SELECTOR)) {\n\t\t\t\tcodes.add(\n\t\t\t\t\t...[...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t\t\t\t.map(element => element.getAttribute('value'))\n\t\t\t\t\t\t.filter(Boolean),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCode()\n\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t.then(responseHTML => {\n\t\t\t\tif (extractElement(this.PAGE_CONTENT_SELECTOR, responseHTML)) {\n\t\t\t\t\tthis.lastResponse = responseHTML;\n\t\t\t\t\treturn this._parseTotal(responseHTML);\n\t\t\t\t}\n\t\t\t\treturn this._parseTotal();\n\t\t\t});\n\t}\n\n\tbeforeCheckCodes() {\n\t\tconst numberOfTesting = toInt(getCookie('numberOfTesting'));\n\t\tsetCookie('numberOfTesting', numberOfTesting + 1, 45);\n\n\t\tthis.FORM_DATA = extractFormValues(this.FORM_DATA_SELECTOR, this.lastResponse);\n\t\tPromise.resolve();\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\treturn Promise.delay(3000).then(() =>\n\t\t\t\tthis._applyCode(code)\n\t\t\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t\t\t.then(responseHTML => {\n\t\t\t\t\t\tif (this._isCodeInvalid(responseHTML)) {\n\t\t\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseHTML);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t}),\n\t\t\t);\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tif (extractElement(this.PAGE_CONTENT_SELECTOR, response)) {\n\t\t\t\tconst shippingElem = this._findElement('Shipping', response);\n\t\t\t\tconst taxElem = this._findElement('Tax', response);\n\t\t\t\tconst tax = taxElem ? toFloat(taxElem) : 0;\n\t\t\t\tconst shipping = shippingElem ? toFloat(shippingElem) || 0 : 0;\n\t\t\t\treturn this._parseTotal(response) - tax - shipping;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t}\n\n\t_findElement(string, response) {\n\t\treturn [...extractElement(this.SUMMERY_BLOCK_SELECTOR, response, true)]\n\t\t\t.filter(el => el.innerText.includes(string))\n\t\t\t.map(el => el.querySelector(this.SUMMERY_VALUE).innerText)[0];\n\t}\n\n\t_removeCode() {\n\t\tconst removeURlPart = document.querySelector(this.REMOVE_BUTTON_SELECTOR).getAttribute('href');\n\t\treturn fetch(`${BASE_URL}${removeURlPart}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\tredirect: 'manual',\n\t\t});\n\t}\n\n\t_applyCode(code) {\n\t\tif (this.FORM_DATA) {\n\t\t\tthis.FORM_DATA.params.set('/atg/store/order/purchase/CouponFormHandler.couponCode', code);\n\t\t\tthis.FORM_DATA.params.set('/atg/store/order/purchase/CouponFormHandler.claimCoupon', 'submit');\n\t\t\treturn fetch(this.APPLY_URL, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tcredentials: 'include',\n\t\t\t\tbody: this.FORM_DATA.params,\n\t\t\t\tredirect: 'manual',\n\t\t\t});\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_isCodeInvalid(data) {\n\t\treturn (\n\t\t\tBoolean(extractElement(this.INVALID_CODE_SELECTOR, data)) ||\n\t\t\t!extractElement(this.PAGE_CONTENT_SELECTOR, data)\n\t\t);\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, data));\n\t}\n};\n\nexport default {\n\tDriver,\n\tname: 'Shoemall',\n\tdomain: 'shoemall.com',\n\tmaxCoupons: 6,\n\tisSinglePageApp: true,\n};\n","import atgCommerce from './_base';\nimport { extractElement } from '../../../utils/DOM';\nimport { elemToFloat } from '../../../utils/format';\n\n// Cart page has promo input, but on cart  page we can apply only one first code, and can`t delete code\n// also we can`t get total price from page\n// We can send request on checkout page, but there price includes taxes and shipping. On cart page user can`t see such details.\n// As a result the discount and final price will not be accurate\n/**\n * Driver behavior description:\n -    Existing code: yes\n -    Remove code: no\n -    Stackable: no\n -    Free gift support: no\n -    isValid implemented: no\n Optional:\n -    Show message about free shipping on the cart page (without discount info): no\n -    Is driver SPA and add the condition to show popup:  no\n -\t  test cides in the 'https://www.teleflora.com/checkout/billing_review.jsp'\n */\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.rmveCoupnCde';\n\t\tthis.APPLIED_CODES_ATTRIBUTES = 'data-ccode';\n\t\tthis.TOTAL_SELECTOR = '.m-billing-review-grand-total';\n\n\t\tthis.APPLY_CODE_FORM_SELECTOR = '#couponCodeForm, #couponCartForm';\n\t\tthis.REMOVE_CODE_FORM_SELECTOR = '#couponCodeRemoveForm';\n\n\t\t// Redefine in driver in case it differs if we need to add some additional body params\n\t\tthis.APPLY_REQUEST_BODY_DATA = {\n\t\t\tcouponCodeBtn: 'Submit',\n\t\t};\n\t\tthis.REMOVE_REQUEST_BODY_DATA = {\n\t\t\tcouponCodeRemoveBtn: 'Submit',\n\t\t};\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'orgCouponCode,couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\t// Redefine in driver in case they are needed\n\t\tthis.REQUEST_HEADERS = {\n\t\t\tAccept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t};\n\n\t\tthis.CHARGES_REGEX = /(shipping|tax|service fee)/i;\n\t\tthis.CHARGES_SELECTOR = '.m-billing-item span.m-billing-price';\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await this._getUpdatedCart();\n\t\tconst total = this._parseTotal(cartStr);\n\t\tconst taxes = [...extractElement(this.CHARGES_SELECTOR, cartStr, true)]\n\t\t\t.filter(el => el.parentElement.textContent.match(this.CHARGES_REGEX))\n\t\t\t.map(elemToFloat)\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((charges, charge) => charges + charge, 0); // fee & tax might not be counted on page\n\t\treturn total - taxes;\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'teleFlora',\n\tdomain: 'teleflora.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.teleflora.com/checkout/billing_review.jsp');\n\t},\n};\n","import atgCommerce from './_base';\nimport { format, DOM } from '../../../utils';\nimport bus from '../../bus';\n\nconst { elemToFloat } = format;\nconst { extractFormValues } = DOM;\n\n/**\n * We can apply one code\n * We can remove code\n * We can apply code only on https://www.uscellular.com/uscellular/order/ncsOrderRecap.jsp page\n *\n * Special behevior:\n * We can add product like prepaid item or like installment price.\n * On checkout page total price changed from 0 only with prepaid price.\n * With Installment pricing on checkout page we can see total by monthly paymant.\n * _parseTotal checks if totalPrice equals 0 then we check monthly totalPrice.\n */\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = 'https://www.uscellular.com';\n\n\t\tthis.APPLIED_CODES_SELECTOR = '#applied-coupon';\n\t\tthis.TOTAL_SELECTOR = '.due-today-value .price';\n\t\tthis.TOTAL_BY_MONTH_SELECTOR = '.total-due-monthly-line .price';\n\t\tthis.INPUT_APPLY_CODE_SELECTOR = '[id=coupon-form]';\n\t\tthis.APPLIED_CODES_PATT = /Remove \"(\\w+)\"/;\n\n\t\tthis.MANAGE_CODE_FORM = extractFormValues(this.INPUT_APPLY_CODE_SELECTOR);\n\t}\n\n\twatchForCartUrl() {\n\t\tlet lastState = false;\n\t\tsetInterval(() => {\n\t\t\tconst totalPrice = document.querySelector(this.TOTAL_SELECTOR) ? this._parseTotal() : 0;\n\t\t\tconst isOnRightUrl = window.location.href.startsWith(`${this.BASE_URL}/uscellular/order/ncsOrderRecap.jsp`);\n\n\t\t\tconst currentState = isOnRightUrl && totalPrice;\n\n\t\t\tif (lastState !== currentState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tlastState = currentState;\n\t\t}, 500);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(el => Boolean(el.innerText))\n\t\t\t.map(el => el.innerText.match(this.APPLIED_CODES_PATT)[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\t_removeCode(code) {\n\t\treturn this._manageCode(code, 'remove');\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(code);\n\t}\n\n\t_manageCode(code, action = 'add') {\n\t\tconst codeParameter = `{\"couponCode\":\"${code}\",\"couponAction\":\"${action}\"}`;\n\n\t\tthis.MANAGE_CODE_FORM.params.set('formContent', codeParameter);\n\n\t\treturn fetch(this.MANAGE_CODE_FORM.action, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: this.MANAGE_CODE_FORM.params,\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => JSON.parse(response));\n\t}\n\n\t/**\n\t *  _parseTotal checks if totalPrice equals 0 then we check monthly totalPrice.\n\t * @param {Object}\n\t */\n\t_parseTotal(data) {\n\t\tlet totalPrice = null;\n\t\tif (data) {\n\t\t\tconst totalToday = data.totalDueTodaySummary.totalDueToday;\n\t\t\ttotalPrice = totalToday > 0 ? totalToday : data.totalDueMonthlySummary.monthlyChargeSummary;\n\t\t} else {\n\t\t\tconst totalElement = document.querySelector(this.TOTAL_SELECTOR);\n\t\t\tif (elemToFloat(totalElement) > 0) {\n\t\t\t\ttotalPrice = elemToFloat(totalElement);\n\t\t\t} else {\n\t\t\t\ttotalPrice = elemToFloat(document.querySelector(this.TOTAL_BY_MONTH_SELECTOR));\n\t\t\t}\n\t\t}\n\n\t\treturn totalPrice;\n\t}\n};\n\nexport default {\n\tname: 'United States Cellular Corp.',\n\tdomain: 'uscellular.com',\n\tisSinglePageApp: true,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn true;\n\t},\n};\n","import Promise from 'bluebird';\nimport atgCommerce from './_base';\nimport bus from '../../bus';\nimport { sessionTimer, handleDriverError } from '../../lib';\nimport { format, DOM, log } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement, extractFormValues } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: yes\n*/\n\nconst BASE_URL = 'https://www.zennioptical.com';\nconst CART_URL = `${BASE_URL}/shoppingCart`;\n\nconst Driver = class Driver extends atgCommerce {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.btn-remove-promocode';\n\t\tthis.APPLIED_CODES_ATTRIBUTES = 'data-promo-code';\n\t\tthis.TOTAL_ELEMENT_CONFIG = { selector: '.order-total' };\n\t\tthis.TOTAL_SELECTOR = this.TOTAL_ELEMENT_CONFIG.selector;\n\t\tthis.APPLY_FORM_SELECTOR = '#applyPromotionForm';\n\t\tthis.REMOVE_FORM_SELECTOR = '#removePromotionForm';\n\t\tthis.CODE_PROPERTY = '/atg/commerce/order/purchase/CartModifierFormHandler.promotionCode';\n\t\tthis.ITEM_IN_CART = '.product-list';\n\n\t\tthis.REQUEST_URL = `${BASE_URL}/cartridges/ZRAC_ShoppingCart/main_cart.jsp`;\n\n\t\tthis.applyData = null;\n\t\tthis.removeData = null;\n\n\t\tthis.PROPOSED_CODES_SELECTOR = '#top-section';\n\t\tthis.PROPOSED_CODES_REGEX = /code (\\w+)/i;\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 30,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst isItemInCart = document.querySelector(this.ITEM_IN_CART);\n\t\tconst isOnRightUrl = window.location.href.startsWith(CART_URL);\n\t\tconst isTotal = document.querySelector(this.TOTAL_ELEMENT_CONFIG.selector);\n\t\treturn isItemInCart && isOnRightUrl && isTotal;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.applyData = extractFormValues(this.APPLY_FORM_SELECTOR);\n\t\tthis.removeData = extractFormValues(this.REMOVE_FORM_SELECTOR);\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.PROPOSED_CODES_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.PROPOSED_CODES_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this._removeCode(code))\n\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t.then(responseHTML => this._parseTotal(responseHTML));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\n\t\tconst workingDiscounts = [];\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tif (!responseJSON || !responseJSON.success) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseHTML);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tif (result.finalPrice < originalPrice) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(() =>\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t}),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst { discounts, originalPrice } = validationInfo;\n\n\t\tdiscounts.sort((a, b) => b.finalDiscount - a.finalDiscount);\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(discounts, discount =>\n\t\t\tthis._applyCode(discount.code)\n\t\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t\t.then(responseHTML => {\n\t\t\t\t\tconst finalPrice = this._parseTotal(responseHTML);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this._removeCode(discount.code);\n\t\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getCartPage().then(response => this._parseTotal(response));\n\t}\n\n\t_removeCode(code) {\n\t\treturn this._manageCode(code, this.removeData.params);\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(code, this.applyData.params);\n\t}\n\n\t_manageCode(code, data) {\n\t\tdata.set(this.CODE_PROPERTY, code);\n\n\t\treturn this._makeRequest('POST', data, true);\n\t}\n\n\t_getUpdatedCart(retry = false) {\n\t\treturn this._makeRequest().then(responseHTML => {\n\t\t\t// retry for total element\n\t\t\tif (!extractElement(this.TOTAL_SELECTOR, responseHTML) && !retry) {\n\t\t\t\treturn this._getUpdatedCart(true);\n\t\t\t}\n\t\t\treturn responseHTML;\n\t\t});\n\t}\n\n\t_getCartPage() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_makeRequest(method = 'GET', body = null, json = false) {\n\t\tlet responseData;\n\t\treturn fetch(this.REQUEST_URL, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\tbody,\n\t\t})\n\t\t\t.then(response => {\n\t\t\t\tresponseData = response;\n\t\t\t\treturn response.text();\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\tif (json) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconst { status, redirected, statusText, headers } = responseData;\n\t\t\t\t\t\tconst errorPayload = {\n\t\t\t\t\t\t\tstatus,\n\t\t\t\t\t\t\tredirected,\n\t\t\t\t\t\t\theaders,\n\t\t\t\t\t\t\tstatusText,\n\t\t\t\t\t\t\ttextContent: response.trim().slice(0, 5000),\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// we send errorPayload in sentry for further investigation\n\t\t\t\t\t\thandleDriverError(new Error('Invalid json string'), errorPayload);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn response;\n\t\t\t});\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, data));\n\t}\n};\n\nexport default {\n\tname: 'Zenni Optical',\n\tdomain: 'zennioptical.com',\n\tDriver,\n\tstackable: true,\n\tisSinglePageApp: true,\n};\n","import bus from '../bus';\nimport { log, format } from '../../utils';\nimport { backgroundMessaging, handleDriverError } from '../lib';\n\nconst { toFloat } = format;\n\nexport default class BaseDriver {\n\t/**\n\t * @function watchForRestoreUserData - set up a listener to check user data restorement\n\t * @emits bus#RestoreUserData - the event that indicates to the app\tthat user data could be restored\n\t */\n\twatchForRestoreUserData(time = 500) {\n\t\tlet pauseInterval = false;\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tconst currentState = await this.checkRestoreDataCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t\tif (currentState) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tbus.$emit('restore-user-data');\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkRestoreDataCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t}\n\t\t}, time);\n\n\t\treturn interval;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * @function storeUserData\n\t * @param {String} domain - domain to set the driver storage\n\t * @returns {Promise}\n\t */\n\tasync storeUserData(domain) {\n\t\tconst userData = await this.getUserData();\n\n\t\tif (userData === null) {\n\t\t\t// Nothing to store\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst storageRecord = {\n\t\t\tuserData,\n\t\t\tstoredTime: Date.now(),\n\t\t};\n\t\tbackgroundMessaging.setDriverStorage(userDataKey, storageRecord);\n\t\tlog('Stored user data: %O', storageRecord);\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function restoreUserData\n\t * @param {String} domain - domain to access the driver storage\n\t * @param {Number} [maxStorageLifetime] - optional, the lifetime of the stored data (default 10 mins)\n\t * @returns {Promise}\n\t */\n\tasync restoreUserData(domain, maxStorageLifetime = 600000) {\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(userDataKey);\n\n\t\tif (driverStorage) {\n\t\t\tconst { storedTime, userData } = driverStorage;\n\t\t\t// Clear stored user data\n\t\t\tbackgroundMessaging.deleteDriverStorage(userDataKey);\n\n\t\t\tif (Date.now() - storedTime <= maxStorageLifetime) {\n\t\t\t\tlog('Restore user data: %O', userData);\n\t\t\t\treturn this.setUserData(userData);\n\t\t\t}\n\t\t\tlog('User data is outdated, skip restoring');\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserData - get user data which should be stored\n\t * @returns {Object} - object with required user data which should be restored\n\t */\n\tgetUserData() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function setUserData - restore user data on page\n\t * @param {Object} userData - data which was saved and should be restored\n\t * @returns {Promise}\n\t */\n\tsetUserData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserDataStorageKey - unique key for storing user data per merchant\n\t * @returns {String}\n\t */\n\tgetUserDataStorageKey(domain) {\n\t\t// Append `_userData` to avoid possible conflicts with created storage from driver\n\t\treturn `${domain}_userData`;\n\t}\n\n\t/**\n\t * Parses start price from page\n\t *\n\t * @function getStartPrice\n\t * @returns {Promise<Number>|Number} - the total from the page\n\t */\n\tgetStartPrice() {\n\t\tlet startPrice = Number.MAX_SAFE_INTEGER;\n\t\tconst totalElementConfig = this.TOTAL_ELEMENT_CONFIG;\n\t\tif (totalElementConfig) {\n\t\t\tconst { selector, attribute, regex } = totalElementConfig;\n\t\t\tlet totalElement;\n\t\t\t// handle case, when there is array of selectors and we try to take totalElement using these selectors in turn\n\t\t\t// for example dell.com, hertz.com\n\t\t\tif (Array.isArray(selector)) {\n\t\t\t\tselector.forEach(elemSelector => {\n\t\t\t\t\tif (!totalElement) {\n\t\t\t\t\t\ttotalElement = document.querySelector(elemSelector);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\ttotalElement = document.querySelector(selector);\n\t\t\t} else {\n\t\t\t\thandleDriverError(\n\t\t\t\t\tnew Error(`Total selector type mismatch. Expected string | array, got ${typeof selector}`),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (totalElement) {\n\t\t\t\tlet value = attribute ? totalElement.getAttribute(attribute) : totalElement.textContent;\n\n\t\t\t\tif (value && regex) {\n\t\t\t\t\t// Set pattern to null to receive error in case pattern was not defined\n\t\t\t\t\t// otherwise we may silently return undefined or empty string\n\t\t\t\t\tconst { pattern = null, group = 0 } = regex;\n\t\t\t\t\tvalue = value.match(pattern)[group];\n\t\t\t\t}\n\t\t\t\tstartPrice = toFloat(value);\n\t\t\t}\n\t\t}\n\t\treturn startPrice;\n\t}\n\n\t/**\n\t * Perform any needed actions and setup to start codes testing\n\t *\n\t * @function beforeTestCodes\n\t *\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @typedef {Object} OriginalData\n\t * @property {Number} originalPrice the starting price for the cart\n\t * @property {Number} originalItemsCount the starting items count of the cart\n\t */\n\t/**\n\t * Perform any needed actions and setup before `checkCodes()` will be executed\n\t *\n\t * @function beforeCheckCodes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tbeforeCheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Perform any needed actions and setup before `applyCodes()` will be executed\n\t *\n\t * @function beforeApplyCodes\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function checkCodes\n\t *\n\t * @param {String[]} codes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise}\n\t */\n\tcheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes each code in @param codes and actually applies it to the cart,\n\t * typically through a fetch(...) call.\n\t *\n\t * @function applyCodes\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tapplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function stackCodes\n\t *\n\t * @param {Object} validationInfo - contains all required info passed by `checkCodes()` for codes stacking\n\t * @param {String[]} validationInfo.codes\n\t * @param {Float} [validationInfo.originalPrice]\n\t * @param {Object[]} [validationInfo.discounts] - contains all codes mapped with their discounts\n\t * @returns {Promise}\n\t */\n\tstackCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function removeCodes\n\t *\n\t * @param {String[]} codes - passed in case the driver needs to know specific codes to do removal\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request response) which are available and were not applied by user\n\t *\n\t * @function getMerchantCodes\n\t * @returns {String[]} - codes from merhcant page (or request response if possible)\n\t */\n\tgetMerchantCodes() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request) which are available and were applied by user\n\t *\n\t * @typedef {Object} ExistingCodeInfo\n\t * @prop {String[]} codes - list of codes which had been applied, if discoverable\n\t * @prop {Number} codeCount - the number of codes that were applied to the cart\n\t */\n\t/**\n\t * @function getExistingCodes\n\t * @returns {ExistingCodeInfo}\n\t */\n\tgetExistingCodes() {\n\t\treturn {\n\t\t\tcodes: [],\n\t\t\tcodeCount: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Parses pre tax and shipping total from page or request's response\n\t *\n\t * @function getPreTaxShippingTotal\n\t * @returns {Promise<Number>|Number} - the total without tax and shipping\n\t */\n\tgetPreTaxShippingTotal() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function watchForCartUrl - optional function to set up a listener for url changes on SPAs\n\t * @emits bus#CartActive - the event (using the string 'cart-active') that indicates to the app that test codes button should be shown\n\t * @emits bus#CartInactive - the event (using the string 'cart-inactive') that indicates to the app that test codes button should be hidden\n\t */\n\twatchForCartUrl(time = 500) {\n\t\tlet previousState = null;\n\t\tlet pauseInterval = false;\n\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\tlet currentState = null;\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tcurrentState = await this.checkCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t\tif (currentState !== previousState) {\n\t\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t\t}\n\t\t\t\tpreviousState = currentState;\n\t\t\t}\n\t\t}, time);\n\t\t// return the interval to stop it in `watchForCartUrl` if needed from outside\n\t\treturn interval;\n\t}\n\n\t/**\n\t * @function checkCondition - optional function to check for conditions on SPAs\n\t * @returns {Boolean}\n\t */\n\tcheckCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Perform custom completion action on Continue to Checkout button\n\t * Takes best codes in @param codes\n\t *\n\t * @function completeExperience\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tcompleteExperience() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function completeExperiencePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcompleteExperiencePromisified(...args) {\n\t\treturn this._promisify(this.completeExperience, args);\n\t}\n\n\t/**\n\t * @function beforeCodesTestingPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeTestCodes, args);\n\t}\n\n\t/**\n\t * @function getStartPricePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetStartPricePromisified() {\n\t\treturn this._promisify(this.getStartPrice);\n\t}\n\n\t/**\n\t * @function getMerchantCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetMerchantCodesPromisified(...args) {\n\t\treturn this._promisify(this.getMerchantCodes, args);\n\t}\n\n\t/**\n\t * @function getExistingCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetExistingCodesPromisified(...args) {\n\t\treturn this._promisify(this.getExistingCodes, args);\n\t}\n\n\t/**\n\t * @function removeCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tremoveCodesPromisified(...args) {\n\t\treturn this._promisify(this.removeCodes, args);\n\t}\n\n\t/**\n\t * @function beforeApplyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeApplyCodes, args);\n\t}\n\n\t/**\n\t * @function applyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tapplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.applyCodes, args);\n\t}\n\n\t/**\n\t * @function beforeCheckCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeCheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeCheckCodes, args);\n\t}\n\n\t/**\n\t * @function checkCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.checkCodes, args);\n\t}\n\n\t/**\n\t * @function stackCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tstackCodesPromisified(...args) {\n\t\treturn this._promisify(this.stackCodes, args);\n\t}\n\n\t/**\n\t * @function _promisify - promisifies given method and return it's result as a Promise\n\t * @returns {Promise}\n\t */\n\t_promisify(method, args) {\n\t\treturn Promise.resolve().then(() => method.apply(this, args));\n\t}\n}\n"],"sourceRoot":""}