{"version":3,"sources":["webpack:///./src/inject/drivers/base.js","webpack:///./src/inject/drivers/basketdo/_base.js","webpack:///./src/inject/drivers/basketdo/beautybrands.com.js","webpack:///./src/inject/drivers/basketdo/boscovs.com.js","webpack:///./src/inject/drivers/basketdo/bronners.com.js","webpack:///./src/inject/drivers/basketdo/chadwicks.com.js","webpack:///./src/inject/drivers/basketdo/chasing-fireflies.com.js","webpack:///./src/inject/drivers/basketdo/designtoscano.com.js","webpack:///./src/inject/drivers/basketdo/donnakaran.com.js","webpack:///./src/inject/drivers/basketdo/ghbass.com.js","webpack:///./src/inject/drivers/basketdo/herrschners.com.js","webpack:///./src/inject/drivers/basketdo/index.js","webpack:///./src/inject/drivers/basketdo/travelsmith.com.js","webpack:///./src/inject/drivers/basketdo/wilsonsleather.com.js"],"names":["toFloat","format","BaseDriver","watchForRestoreUserData","time","pauseInterval","interval","setInterval","currentState","checkRestoreDataCondition","clearInterval","bus","$emit","e","handleDriverError","source","storeUserData","domain","userData","getUserData","Promise","resolve","userDataKey","getUserDataStorageKey","storageRecord","storedTime","Date","now","backgroundMessaging","setDriverStorage","log","restoreUserData","maxStorageLifetime","driverStorage","getDriverStorage","deleteDriverStorage","setUserData","getStartPrice","startPrice","Number","MAX_SAFE_INTEGER","totalElementConfig","TOTAL_ELEMENT_CONFIG","selector","attribute","regex","totalElement","Array","isArray","forEach","elemSelector","document","querySelector","Error","value","getAttribute","textContent","pattern","group","match","beforeTestCodes","beforeCheckCodes","beforeApplyCodes","checkCodes","applyCodes","stackCodes","removeCodes","getMerchantCodes","getExistingCodes","codes","codeCount","getPreTaxShippingTotal","watchForCartUrl","previousState","checkCondition","completeExperience","completeExperiencePromisified","args","_promisify","beforeTestCodesPromisified","getStartPricePromisified","getMerchantCodesPromisified","getExistingCodesPromisified","removeCodesPromisified","beforeApplyCodesPromisified","applyCodesPromisified","beforeCheckCodesPromisified","checkCodesPromisified","stackCodesPromisified","method","then","apply","elemToFloat","extractElementFromHTML","DOM","BasketDo","constructor","CODE_VALUE_SELECTOR","BASE_URL","TOTAL_SELECTOR","IS_STACKABLE","CAN_REMOVE","REQUEST_URL","applyCode","originalPrice","parseTotal","workingDiscounts","each","code","getUpdatedCart","html","finalPrice","finalDiscount","result","isValid","push","removeCode","map","discount","discounts","validationInfo","sort","a","b","currentPrice","currentDiscount","successfulCodes","text","Set","querySelectorAll","element","innerText","trim","size","_urlSearchParams","isApplying","params","URLSearchParams","queryParams","set","Math","random","formData","queryStringParameters","_manageRequest","requestParams","fetch","toString","credentials","body","response","total","extractElement","CART_URL","CHECKOUT_URL","Driver","BasketDoDriver","APPLIED_CODE_SELECTOR","PAYMENT_ELEM_SELECTOR","PAYMENT_STEP_SELECTOR","PLACE_ORDER_ELEM_SELECTOR","PLACE_ORDER_STEP_SELECTOR","SHIPPING_SELECTOR","TAX_SELECTOR","EMPTY_CART_SELECTOR","queryParamsForValidate","emptyCart","onCartPage","window","location","href","startsWith","onCheckoutPage","paymentElem","isPaymentStep","classList","contains","placeOrderElem","isPlaceOrderStep","codeValue","length","status","_getValidateCode","responseHTML","shippingEl","shipping","taxEl","tax","sendXhr","name","isSinglePageApp","isOnCartUrl","getCookie","setCookie","browserUtils","DOMAIN","SHIPPING_ID","SHIPPING_TAX_ID","TAX_ID","DISABLE_TIME_MIN","sessionTimer","initialize","isCookieEnabled","navigator","cookieEnabled","isNotMaxCodeTesting","defaultValue","shippingTax","url","redirect","stackable","maxCoupons","extractData","IS_ON_CART","CODE_INPUT_SELECTOR","IS_CHECKOUT_URL","GET_UPDATED_CART_URL","PAYMENT_STEP_ELEMENT","paymentStepElem","isOnCart","isOnCheckout","paymentStep","innerHTML","_getCartPage","filter","Boolean","JSON","parse","data","targetDataForUpdate","find","item","path","orderTotals","label","IS_CHECKOUT_PAGE","IS_CART_PAGE","APPLIED_CODE_CONTAINER_SELECTOR","EMPTY_CART_TEXT","PROMO_CODE_REG","el","emptyCartElement","isPromoInput","isTotal","isPromoStep","offsetParent","isCartEmpty","calculatedShipping","toLowerCase","includes","calculatedTax","stringify","CART_TOTAL_SELECTOR","SUBTOTAL_SELECTOR","isSubtotal","lastState","promotionsBlock","style","height","elements","SCRIPT_SELECTOR","CODE_REGEX","elem","taxElem","shippingElem","completionAction","completionActions","revisit","setValue","pathname","APPLY_BTN_SELECTOR","PAYMENT_SECTION_SELECTOR","SUMMARY_CLASSES_SELECTOR","CHECKOUT_UPDATE_URL","isOnRightUrl","codeInput","paymentSection","isOnRightPage","lastResponse","_getUpdatedCheckout","codeElem","_codeAppliedCheck","_manuallyApplyCode","click","_findTotalElem","nextElementSibling","reload","none","beautybrands","boscovs","bronners","chadwicks","chasingFireflies","designtoscano","donnakaran","ghbass","herrschners","travelsmith","wilsonsleather","EMPTY_ELEMENT_SELECTOR","APPLIED_CODE_REGEX","MERCHANT_PROMO_BLOCK_SELECTOR"],"mappings":"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","file":"drivers__basketdo.bundle.js","sourcesContent":["import bus from '../bus';\nimport { log, format } from '../../utils';\nimport { backgroundMessaging, handleDriverError } from '../lib';\n\nconst { toFloat } = format;\n\nexport default class BaseDriver {\n\t/**\n\t * @function watchForRestoreUserData - set up a listener to check user data restorement\n\t * @emits bus#RestoreUserData - the event that indicates to the app\tthat user data could be restored\n\t */\n\twatchForRestoreUserData(time = 500) {\n\t\tlet pauseInterval = false;\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tconst currentState = await this.checkRestoreDataCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t\tif (currentState) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tbus.$emit('restore-user-data');\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkRestoreDataCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t}\n\t\t}, time);\n\n\t\treturn interval;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * @function storeUserData\n\t * @param {String} domain - domain to set the driver storage\n\t * @returns {Promise}\n\t */\n\tasync storeUserData(domain) {\n\t\tconst userData = await this.getUserData();\n\n\t\tif (userData === null) {\n\t\t\t// Nothing to store\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst storageRecord = {\n\t\t\tuserData,\n\t\t\tstoredTime: Date.now(),\n\t\t};\n\t\tbackgroundMessaging.setDriverStorage(userDataKey, storageRecord);\n\t\tlog('Stored user data: %O', storageRecord);\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function restoreUserData\n\t * @param {String} domain - domain to access the driver storage\n\t * @param {Number} [maxStorageLifetime] - optional, the lifetime of the stored data (default 10 mins)\n\t * @returns {Promise}\n\t */\n\tasync restoreUserData(domain, maxStorageLifetime = 600000) {\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(userDataKey);\n\n\t\tif (driverStorage) {\n\t\t\tconst { storedTime, userData } = driverStorage;\n\t\t\t// Clear stored user data\n\t\t\tbackgroundMessaging.deleteDriverStorage(userDataKey);\n\n\t\t\tif (Date.now() - storedTime <= maxStorageLifetime) {\n\t\t\t\tlog('Restore user data: %O', userData);\n\t\t\t\treturn this.setUserData(userData);\n\t\t\t}\n\t\t\tlog('User data is outdated, skip restoring');\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserData - get user data which should be stored\n\t * @returns {Object} - object with required user data which should be restored\n\t */\n\tgetUserData() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function setUserData - restore user data on page\n\t * @param {Object} userData - data which was saved and should be restored\n\t * @returns {Promise}\n\t */\n\tsetUserData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserDataStorageKey - unique key for storing user data per merchant\n\t * @returns {String}\n\t */\n\tgetUserDataStorageKey(domain) {\n\t\t// Append `_userData` to avoid possible conflicts with created storage from driver\n\t\treturn `${domain}_userData`;\n\t}\n\n\t/**\n\t * Parses start price from page\n\t *\n\t * @function getStartPrice\n\t * @returns {Promise<Number>|Number} - the total from the page\n\t */\n\tgetStartPrice() {\n\t\tlet startPrice = Number.MAX_SAFE_INTEGER;\n\t\tconst totalElementConfig = this.TOTAL_ELEMENT_CONFIG;\n\t\tif (totalElementConfig) {\n\t\t\tconst { selector, attribute, regex } = totalElementConfig;\n\t\t\tlet totalElement;\n\t\t\t// handle case, when there is array of selectors and we try to take totalElement using these selectors in turn\n\t\t\t// for example dell.com, hertz.com\n\t\t\tif (Array.isArray(selector)) {\n\t\t\t\tselector.forEach(elemSelector => {\n\t\t\t\t\tif (!totalElement) {\n\t\t\t\t\t\ttotalElement = document.querySelector(elemSelector);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\ttotalElement = document.querySelector(selector);\n\t\t\t} else {\n\t\t\t\thandleDriverError(\n\t\t\t\t\tnew Error(`Total selector type mismatch. Expected string | array, got ${typeof selector}`),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (totalElement) {\n\t\t\t\tlet value = attribute ? totalElement.getAttribute(attribute) : totalElement.textContent;\n\n\t\t\t\tif (value && regex) {\n\t\t\t\t\t// Set pattern to null to receive error in case pattern was not defined\n\t\t\t\t\t// otherwise we may silently return undefined or empty string\n\t\t\t\t\tconst { pattern = null, group = 0 } = regex;\n\t\t\t\t\tvalue = value.match(pattern)[group];\n\t\t\t\t}\n\t\t\t\tstartPrice = toFloat(value);\n\t\t\t}\n\t\t}\n\t\treturn startPrice;\n\t}\n\n\t/**\n\t * Perform any needed actions and setup to start codes testing\n\t *\n\t * @function beforeTestCodes\n\t *\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @typedef {Object} OriginalData\n\t * @property {Number} originalPrice the starting price for the cart\n\t * @property {Number} originalItemsCount the starting items count of the cart\n\t */\n\t/**\n\t * Perform any needed actions and setup before `checkCodes()` will be executed\n\t *\n\t * @function beforeCheckCodes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tbeforeCheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Perform any needed actions and setup before `applyCodes()` will be executed\n\t *\n\t * @function beforeApplyCodes\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function checkCodes\n\t *\n\t * @param {String[]} codes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise}\n\t */\n\tcheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes each code in @param codes and actually applies it to the cart,\n\t * typically through a fetch(...) call.\n\t *\n\t * @function applyCodes\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tapplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function stackCodes\n\t *\n\t * @param {Object} validationInfo - contains all required info passed by `checkCodes()` for codes stacking\n\t * @param {String[]} validationInfo.codes\n\t * @param {Float} [validationInfo.originalPrice]\n\t * @param {Object[]} [validationInfo.discounts] - contains all codes mapped with their discounts\n\t * @returns {Promise}\n\t */\n\tstackCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function removeCodes\n\t *\n\t * @param {String[]} codes - passed in case the driver needs to know specific codes to do removal\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request response) which are available and were not applied by user\n\t *\n\t * @function getMerchantCodes\n\t * @returns {String[]} - codes from merhcant page (or request response if possible)\n\t */\n\tgetMerchantCodes() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request) which are available and were applied by user\n\t *\n\t * @typedef {Object} ExistingCodeInfo\n\t * @prop {String[]} codes - list of codes which had been applied, if discoverable\n\t * @prop {Number} codeCount - the number of codes that were applied to the cart\n\t */\n\t/**\n\t * @function getExistingCodes\n\t * @returns {ExistingCodeInfo}\n\t */\n\tgetExistingCodes() {\n\t\treturn {\n\t\t\tcodes: [],\n\t\t\tcodeCount: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Parses pre tax and shipping total from page or request's response\n\t *\n\t * @function getPreTaxShippingTotal\n\t * @returns {Promise<Number>|Number} - the total without tax and shipping\n\t */\n\tgetPreTaxShippingTotal() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function watchForCartUrl - optional function to set up a listener for url changes on SPAs\n\t * @emits bus#CartActive - the event (using the string 'cart-active') that indicates to the app that test codes button should be shown\n\t * @emits bus#CartInactive - the event (using the string 'cart-inactive') that indicates to the app that test codes button should be hidden\n\t */\n\twatchForCartUrl(time = 500) {\n\t\tlet previousState = null;\n\t\tlet pauseInterval = false;\n\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\tlet currentState = null;\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tcurrentState = await this.checkCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t\tif (currentState !== previousState) {\n\t\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t\t}\n\t\t\t\tpreviousState = currentState;\n\t\t\t}\n\t\t}, time);\n\t\t// return the interval to stop it in `watchForCartUrl` if needed from outside\n\t\treturn interval;\n\t}\n\n\t/**\n\t * @function checkCondition - optional function to check for conditions on SPAs\n\t * @returns {Boolean}\n\t */\n\tcheckCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Perform custom completion action on Continue to Checkout button\n\t * Takes best codes in @param codes\n\t *\n\t * @function completeExperience\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tcompleteExperience() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function completeExperiencePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcompleteExperiencePromisified(...args) {\n\t\treturn this._promisify(this.completeExperience, args);\n\t}\n\n\t/**\n\t * @function beforeCodesTestingPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeTestCodes, args);\n\t}\n\n\t/**\n\t * @function getStartPricePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetStartPricePromisified() {\n\t\treturn this._promisify(this.getStartPrice);\n\t}\n\n\t/**\n\t * @function getMerchantCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetMerchantCodesPromisified(...args) {\n\t\treturn this._promisify(this.getMerchantCodes, args);\n\t}\n\n\t/**\n\t * @function getExistingCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetExistingCodesPromisified(...args) {\n\t\treturn this._promisify(this.getExistingCodes, args);\n\t}\n\n\t/**\n\t * @function removeCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tremoveCodesPromisified(...args) {\n\t\treturn this._promisify(this.removeCodes, args);\n\t}\n\n\t/**\n\t * @function beforeApplyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeApplyCodes, args);\n\t}\n\n\t/**\n\t * @function applyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tapplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.applyCodes, args);\n\t}\n\n\t/**\n\t * @function beforeCheckCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeCheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeCheckCodes, args);\n\t}\n\n\t/**\n\t * @function checkCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.checkCodes, args);\n\t}\n\n\t/**\n\t * @function stackCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tstackCodesPromisified(...args) {\n\t\treturn this._promisify(this.stackCodes, args);\n\t}\n\n\t/**\n\t * @function _promisify - promisifies given method and return it's result as a Promise\n\t * @returns {Promise}\n\t */\n\t_promisify(method, args) {\n\t\treturn Promise.resolve().then(() => method.apply(this, args));\n\t}\n}\n","import Promise from 'bluebird';\nimport BaseDriver from '../base';\nimport bus from '../../bus';\nimport { format, DOM, log } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElementFromHTML } = DOM;\n\nexport default class BasketDo extends BaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CODE_VALUE_SELECTOR = null;\n\t\tthis.BASE_URL = null;\n\t\tthis.TOTAL_SELECTOR = '#EstTaxShipItemTable_estBasketTotal';\n\t\tthis.IS_STACKABLE = true;\n\t\tthis.CAN_REMOVE = true;\n\t\tthis.REQUEST_URL = null;\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this.IS_STACKABLE ? Promise.resolve() : this.applyCode(codes[0]);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code)\n\t\t\t\t.then(() => this.getUpdatedCart())\n\t\t\t\t.then(html => {\n\t\t\t\t\tconst finalPrice = this.parseTotal(html);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst result = { code, finalPrice, finalDiscount, isValid: false };\n\t\t\t\t\tif (finalPrice < originalPrice) {\n\t\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.IS_STACKABLE) {\n\t\t\t\treturn bus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice } = validationInfo;\n\n\t\tworkingDiscounts.sort((a, b) => b.finalDiscount - a.finalDiscount);\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code)\n\t\t\t\t.then(() => this.getUpdatedCart())\n\t\t\t\t.then(text => {\n\t\t\t\t\tconst finalPrice = this.parseTotal(text);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t});\n\t\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this.removeCode(discount.code);\n\t\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(element => element.innerText.trim()),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this.removeCode(code))\n\t\t\t.then(() => this.getUpdatedCart())\n\t\t\t.then(html => this.parseTotal(html));\n\t}\n\n\t_urlSearchParams(code, isApplying) {\n\t\tconst params = new URLSearchParams();\n\t\tconst queryParams = new URLSearchParams();\n\t\tqueryParams.set('r', Math.random());\n\t\tparams.set('sourceCode', code);\n\t\tqueryParams.set('method', isApplying ? 'applySourceCode' : 'removeSourceCode');\n\t\treturn {\n\t\t\tformData: params,\n\t\t\tqueryStringParameters: queryParams,\n\t\t};\n\t}\n\n\t_manageRequest(requestParams) {\n\t\tif (this.REQUEST_URL === null) {\n\t\t\tthis.REQUEST_URL = `${this.BASE_URL}/basket.do`;\n\t\t}\n\t\treturn fetch(`${this.REQUEST_URL}?${requestParams.queryStringParameters.toString()}`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: requestParams.formData,\n\t\t});\n\t}\n\n\tapplyCode(code) {\n\t\tconst requestParams = this._urlSearchParams(code, true);\n\t\treturn this._manageRequest(requestParams);\n\t}\n\n\tremoveCode(code) {\n\t\tif (!this.CAN_REMOVE) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst requestParams = this._urlSearchParams(code, false);\n\t\treturn this._manageRequest(requestParams);\n\t}\n\n\tgetUpdatedCart() {\n\t\treturn fetch(this.REQUEST_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\tparseTotal(html) {\n\t\tlet total = null;\n\t\tif (html) {\n\t\t\ttotal = elemToFloat(extractElementFromHTML(html, this.TOTAL_SELECTOR));\n\t\t} else {\n\t\t\ttotal = elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t\t}\n\t\treturn total;\n\t}\n}\n","import Promise from 'bluebird';\nimport BasketDoDriver from './_base';\nimport bus from '../../bus';\nimport { DOM, sendXhr, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\nconst BASE_URL = 'https://www.beautybrands.com';\nconst CART_URL = `${BASE_URL}/basket.do`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout/accordioncheckout.do`;\n\n/*\nDriver behavior description:\n•    Existing code: yes\n•    Remove code: no\n•    Stackable: no\n•    Free gift support: no\n•    ‘isValid’ implemented: yes\n•    Manually apply code: no\nOptional:\n•    Show message about free shipping on the cart page (without discount info): no\n•    Is driver SPA and add the condition to show popup: yes\n•    Gather codes on site pages: no\n*/\n\nconst Driver = class Driver extends BasketDoDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.TOTAL_SELECTOR = '#EstTaxShipItemTable_estBasketTotal, .ml-summary-total .ml-accordion-summary-item-value';\n\t\tthis.APPLIED_CODE_SELECTOR = '.couponCodeField';\n\n\t\tthis.PAYMENT_ELEM_SELECTOR = '.ml-accordion-steps li:nth-child(5)';\n\t\tthis.PAYMENT_STEP_SELECTOR = 'ml-accordion-step-accessible';\n\n\t\tthis.PLACE_ORDER_ELEM_SELECTOR = '.ml-accordion-steps li:nth-child(6)';\n\t\tthis.PLACE_ORDER_STEP_SELECTOR = 'ml-accordion-step-accessible';\n\n\t\tthis.SHIPPING_SELECTOR = '#EstTaxShipItemTable_discountedShippingTotal';\n\t\tthis.TAX_SELECTOR = '#EstTaxShipItemTable_taxTotal';\n\n\t\tthis.EMPTY_CART_SELECTOR = '.globalCartEmpty';\n\n\t\tthis.IS_STACKABLE = false;\n\t\tthis.CAN_REMOVE = false;\n\n\t\tthis.REQUEST_URL = CART_URL;\n\t\tthis.queryParamsForValidate = new URLSearchParams();\n\t\tthis.queryParamsForValidate.set('method', 'validateSourceCode');\n\t}\n\n\tcheckCondition() {\n\t\tconst emptyCart = !!document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst onCartPage = window.location.href.startsWith(CART_URL);\n\t\tconst onCheckoutPage = window.location.href.startsWith(CHECKOUT_URL);\n\t\tconst paymentElem = document.querySelector(this.PAYMENT_ELEM_SELECTOR);\n\t\tconst isPaymentStep = paymentElem ? paymentElem.classList.contains(this.PAYMENT_STEP_SELECTOR) : false;\n\t\tconst placeOrderElem = document.querySelector(this.PLACE_ORDER_ELEM_SELECTOR);\n\t\tconst isPlaceOrderStep = placeOrderElem\n\t\t\t? placeOrderElem.classList.contains(this.PLACE_ORDER_STEP_SELECTOR)\n\t\t\t: false;\n\t\tconst currentState = (!emptyCart && onCartPage) || (onCheckoutPage && isPaymentStep && !isPlaceOrderStep);\n\t\treturn currentState;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [];\n\t\treturn Promise.resolve()\n\t\t\t.then(() => {\n\t\t\t\tif (!window.location.href.startsWith(CART_URL)) {\n\t\t\t\t\treturn this.getUpdatedCart();\n\t\t\t\t}\n\t\t\t\treturn Promise.resolve();\n\t\t\t})\n\t\t\t.then(html => {\n\t\t\t\tconst codeValue = extractElement(this.APPLIED_CODE_SELECTOR, html).getAttribute('value');\n\t\t\t\tif (codeValue && codeValue !== ' ') {\n\t\t\t\t\tcodes.push(codeValue);\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tcodes,\n\t\t\t\t\tcodeCount: codes.length,\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this.applyCode(code)\n\t\t\t\t.then(response => (response.status === 200 ? this.getUpdatedCart() : false))\n\t\t\t\t.then(html => {\n\t\t\t\t\tif (!html) {\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t}\n\t\t\t\t\tresult.finalPrice = this.parseTotal(html);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\tif (result.finalPrice < originalPrice) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn super.applyCodes(codes);\n\t}\n\n\tapplyCode(code) {\n\t\treturn this._getValidateCode(code).then(() => super.applyCode(code));\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getUpdatedCart().then(responseHTML => {\n\t\t\tconst shippingEl = extractElement(this.SHIPPING_SELECTOR, responseHTML);\n\t\t\tconst shipping = shippingEl ? elemToFloat(shippingEl) || 0 : 0;\n\t\t\tconst taxEl = extractElement(this.TAX_SELECTOR, responseHTML);\n\t\t\tconst tax = taxEl ? elemToFloat(taxEl) || 0 : 0;\n\t\t\treturn this.parseTotal(responseHTML) - shipping - tax;\n\t\t});\n\t}\n\n\t// need for replacements applying\n\t_getValidateCode(code) {\n\t\tthis.queryParamsForValidate.set('sourceCode', code);\n\t\treturn sendXhr(`${CART_URL}?${this.queryParamsForValidate.toString()}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Beauty Brands',\n\tdomain: 'beautybrands.com',\n\tisSinglePageApp: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL);\n\t},\n};\n","import Promise from 'bluebird';\nimport BasketDoDriver from './_base';\nimport bus from '../../bus';\nimport { sessionTimer } from '../../lib';\nimport { format, DOM, browserUtils, log } from '../../../utils';\n\nconst { getCookie, setCookie } = browserUtils;\nconst { elemToFloat, toFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works:\n    - Cart page\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n+ Special case about the driver works (if it needed).\n    - maxCoupons: 4 (website works really slow)\n\t- sessionTimer yes (15 minutes)\n\t- allowed to test codes 3 times in 30 minutes\n */\n\nconst DOMAIN = 'boscovs.com';\nconst BASE_URL = `https://www.${DOMAIN}/shop`;\nconst CART_URL = `${BASE_URL}/cart.do`;\n\nconst Driver = class Driver extends BasketDoDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.TOTAL_SELECTOR = '#order_total';\n\t\tthis.CODE_VALUE_SELECTOR = '[id^=promocode]';\n\t\tthis.IS_STACKABLE = true;\n\t\tthis.SHIPPING_ID = '#order_shippingTotal';\n\t\tthis.SHIPPING_TAX_ID = '#order_shippingTax';\n\t\tthis.TAX_ID = '#order_tax';\n\t\tthis.DISABLE_TIME_MIN = 30; // 30 minutes\n\t\tsessionTimer.initialize({});\n\t}\n\n\tcheckCondition() {\n\t\tconst isCookieEnabled = window.navigator.cookieEnabled;\n\t\tif (isCookieEnabled && !getCookie('codeTestingCount')) {\n\t\t\tsetCookie('codeTestingCount', 0, this.DISABLE_TIME_MIN);\n\t\t}\n\t\tconst isNotMaxCodeTesting =\n\t\t\tisCookieEnabled && getCookie('codeTestingCount') ? toFloat(getCookie('codeTestingCount')) < 3 : false;\n\n\t\treturn (\n\t\t\tisNotMaxCodeTesting &&\n\t\t\twindow.location.href.startsWith(CART_URL) &&\n\t\t\tdocument.querySelector(this.TOTAL_SELECTOR)\n\t\t);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(element => element.defaultValue);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(html => {\n\t\t\t\tconst finalPrice = this.parseTotal(html);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst result = { code, finalPrice, finalDiscount, isValid: false };\n\t\t\t\tif (finalPrice < originalPrice) {\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.IS_STACKABLE) {\n\t\t\t\treturn bus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice } = validationInfo;\n\n\t\tworkingDiscounts.sort((a, b) => b.finalDiscount - a.finalDiscount);\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code).then(text => {\n\t\t\t\tconst finalPrice = this.parseTotal(text);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t});\n\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(discount.code);\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tbeforeApplyCodes() {\n\t\tsetCookie('codeTestingCount', toFloat(getCookie('codeTestingCount')) + 1, this.DISABLE_TIME_MIN);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getUpdatedCart().then(responseHTML => {\n\t\t\tconst total = this.parseTotal(responseHTML);\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_ID, responseHTML));\n\t\t\t// shipping tax is also included into the total\n\t\t\tconst shippingTax = elemToFloat(extractElement(this.SHIPPING_TAX_ID, responseHTML));\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_ID, responseHTML));\n\n\t\t\treturn total - shipping - shippingTax - tax;\n\t\t});\n\t}\n\n\t_urlSearchParams(code, isApplying) {\n\t\tconst params = new URLSearchParams();\n\t\tparams.set('couponCode', code);\n\t\tconst url = `${BASE_URL}/${isApplying ? 'add-coupon.do' : 'remove-coupon.do'}`;\n\t\treturn {\n\t\t\tformData: params,\n\t\t\turl,\n\t\t};\n\t}\n\n\tapplyCode(code) {\n\t\tconst requestParams = this._urlSearchParams(code, true);\n\t\treturn this._manageRequest(requestParams, true);\n\t}\n\n\tremoveCode(code) {\n\t\tif (!this.CAN_REMOVE) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst requestParams = this._urlSearchParams(code, false);\n\t\treturn this._manageRequest(requestParams, false);\n\t}\n\n\t_manageRequest(requestParams, redirect) {\n\t\treturn fetch(`${requestParams.url}?${requestParams.formData}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\tredirect: redirect ? 'follow' : 'manual',\n\t\t}).then(response => response.text());\n\t}\n\n\tgetUpdatedCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: \"Boscov's\",\n\tdomain: 'boscovs.com',\n\tstackable: true,\n\tmaxCoupons: 4,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport BasketDoDriver from './_base';\nimport bus from '../../bus';\nimport { format, DOM, log } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractData, extractElement } = DOM;\n\nconst BASE_URL = 'https://www.bronners.com';\nconst CART_URL = `${BASE_URL}/basket.do`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout/accordioncheckout.do`;\nconst IS_ON_CART = window.location.href.startsWith(CART_URL);\n\n/* Behaviour description:\n * can get existing code only after apply;\n * and can't get existing code if user come back with checkout page to cart page;\n * can apply only one code;\n * can't remove code;\n * can't apply invalid code;\n * may run testing on 'Cart' and 'Checkout' pages\n */\n\nconst Driver = class Driver extends BasketDoDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.CODE_INPUT_SELECTOR = '#sourceCode';\n\t\tthis.IS_CHECKOUT_URL = window.location.href.startsWith(CHECKOUT_URL);\n\t\tthis.TOTAL_SELECTOR =\n\t\t\t'.ml-summary-total .ml-accordion-summary-item-value:last-child, #EstTaxShipItemTable_estBasketTotal';\n\t\tthis.IS_STACKABLE = false;\n\t\tthis.CAN_REMOVE = false;\n\t\tthis.GET_UPDATED_CART_URL = this.IS_CHECKOUT_URL ? `${CHECKOUT_URL}?method=initData` : CART_URL;\n\t\tthis.REQUEST_URL = CART_URL;\n\t\tthis.EMPTY_CART_SELECTOR = '.ml-basket-empty-msg';\n\t\tthis.PAYMENT_STEP_ELEMENT = 'ml-accordion-step-collapsed';\n\n\t\tthis.paymentStepElem = document.querySelector('.ml-accordion-steps li:nth-child(5)');\n\t}\n\n\tcheckCondition() {\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isOnCart = window.location.href.startsWith(CART_URL);\n\t\tconst isOnCheckout = window.location.href.startsWith(CHECKOUT_URL);\n\t\tconst paymentStep = this.IS_CHECKOUT_URL\n\t\t\t? !this.paymentStepElem.classList.contains(this.PAYMENT_STEP_ELEMENT)\n\t\t\t: false;\n\t\treturn !emptyCart && (isOnCart || (isOnCheckout && paymentStep));\n\t}\n\n\tgetExistingCodes() {\n\t\treturn Promise.resolve()\n\t\t\t.then(() => (IS_ON_CART ? document.body.innerHTML : this._getCartPage()))\n\t\t\t.then(html => {\n\t\t\t\tconst codes = [extractData(this.CODE_INPUT_SELECTOR, html, false, 'value')].filter(Boolean);\n\n\t\t\t\treturn {\n\t\t\t\t\tcodes,\n\t\t\t\t\tcodeCount: codes.length,\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this.applyCode(code)\n\t\t\t\t.then(response => (response.status === 200 ? response : false))\n\t\t\t\t.then(response => {\n\t\t\t\t\tif (response) {\n\t\t\t\t\t\treturn this.getUpdatedCart().then(html => {\n\t\t\t\t\t\t\tresult.finalPrice = this.parseTotal(html);\n\t\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t});\n\t}\n\n\t_getCartPage() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\tgetUpdatedCart() {\n\t\treturn fetch(this.GET_UPDATED_CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\t// Return JSON if it is possible\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tparseTotal(data) {\n\t\tif (data && typeof data === 'object') {\n\t\t\tconst { value } = data.targetDataForUpdate\n\t\t\t\t.find(item => item.path === 'summary')\n\t\t\t\t.data.orderTotals.find(item => item.label === 'Order Total');\n\t\t\treturn toFloat(value);\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, data));\n\t}\n};\n\nexport default {\n\tname: \"Bronner's Christmas Wonderland\",\n\tdomain: 'bronners.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import BasketDoDriver from './_base';\nimport { extractElement } from '../../../utils/DOM';\nimport { toFloat } from '../../../utils/format';\n\nconst BASE_URL = 'https://www.chadwicks.com';\nconst CART_URL = `${BASE_URL}/basket.do`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout`;\n\nconst IS_CHECKOUT_PAGE = window.location.href.startsWith(CHECKOUT_URL);\nconst IS_CART_PAGE = window.location.href.startsWith(CART_URL);\n\n/** Behavior description:\n+ Existing code: yes\n+ Remove code: no\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout(payment step)\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n * */\n\nconst Driver = class Driver extends BasketDoDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.TOTAL_SELECTOR = '#EstTaxShipItemTable_estBasketTotal, .ml-summary-total .ml-accordion-summary-item-value';\n\t\tthis.APPLIED_CODE_SELECTOR = '#sourceCode';\n\t\tthis.APPLIED_CODE_CONTAINER_SELECTOR = '.ml-summary-group-value:last-child';\n\t\tthis.EMPTY_CART_SELECTOR = '.ml-basket-empty-msg';\n\t\tthis.PAYMENT_STEP_SELECTOR = '.ml-payment-wrapper';\n\t\tthis.REQUEST_URL = `${this.BASE_URL}/basket.do`;\n\t\tthis.CAN_REMOVE = false;\n\t\tthis.IS_STACKABLE = false;\n\t\tthis.EMPTY_CART_TEXT = /bag is empty/;\n\t\tthis.PROMO_CODE_REG = /promo code: (\\w+)/i;\n\n\t\tthis.SHIPPING_SELECTOR = '#EstTaxShipItemTable_discountedShippingTotal';\n\t\tthis.TAX_SELECTOR = '#EstTaxShipItemTable_taxTotal';\n\t}\n\n\t// can get existing code but not often\n\tgetExistingCodes() {\n\t\tlet codes = [];\n\t\tif (IS_CHECKOUT_PAGE) {\n\t\t\tcodes = [...document.querySelectorAll(this.APPLIED_CODE_CONTAINER_SELECTOR)]\n\t\t\t\t.filter(el => el.innerText.match(this.PROMO_CODE_REG))\n\t\t\t\t.map(el => el.innerText.match(this.PROMO_CODE_REG)[1]);\n\t\t} else {\n\t\t\tcodes = [document.querySelector(this.APPLIED_CODE_SELECTOR)]\n\t\t\t\t.filter(el => el.defaultValue)\n\t\t\t\t.map(el => el.defaultValue);\n\t\t}\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tcheckCondition() {\n\t\tconst emptyCartElement = document.querySelector(this.EMPTY_CART_SELECTOR);\n\n\t\tconst isPromoInput = Boolean(document.querySelector(this.APPLIED_CODE_SELECTOR));\n\t\tconst isTotal = Boolean(document.querySelector(this.TOTAL_SELECTOR));\n\t\tconst isPromoStep = (document.querySelector(this.PAYMENT_STEP_SELECTOR) || {}).offsetParent;\n\t\tconst isCartEmpty = Boolean(emptyCartElement && emptyCartElement.innerText.match(this.EMPTY_CART_TEXT));\n\n\t\tconst currentState =\n\t\t\t(isTotal && isPromoStep && isPromoInput && IS_CHECKOUT_PAGE) || (IS_CART_PAGE && !isCartEmpty);\n\t\treturn currentState;\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getUpdatedCart().then(responseHTML => {\n\t\t\tconst total = this.parseTotal(responseHTML);\n\t\t\tconst shipping = extractElement(this.SHIPPING_SELECTOR, responseHTML);\n\t\t\tconst tax = extractElement(this.TAX_SELECTOR, responseHTML);\n\n\t\t\tconst calculatedShipping =\n\t\t\t\t!shipping || shipping.innerText.toLowerCase().includes('free') ? 0 : toFloat(shipping.innerText);\n\t\t\tconst calculatedTax =\n\t\t\t\t!tax || tax.innerText.includes('TBD') || tax.innerText.includes('Calculate')\n\t\t\t\t\t? 0\n\t\t\t\t\t: toFloat(tax.innerText);\n\n\t\t\treturn total - calculatedShipping - calculatedTax;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Chadwicks',\n\tdomain: 'chadwicks.com',\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport BasketDoDriver from './_base';\nimport bus from '../../bus';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat, toFloat } = format;\nconst { extractElement } = DOM;\n\n/* Behaviour\n * Can apply only one code\n * Can't remove codes\n */\n\nconst BASE_URL = 'https://www.chasing-fireflies.com';\nconst CART_URL = `${BASE_URL}/basket.do`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout/accordioncheckout.do`;\n\nconst Driver = class Driver extends BasketDoDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.CODE_INPUT_SELECTOR = '#sourceCode';\n\t\tthis.IS_CHECKOUT_URL = window.location.href.startsWith(CHECKOUT_URL);\n\t\tthis.TOTAL_SELECTOR =\n\t\t\t'.ml-summary-total .ml-accordion-summary-item-value:last-child, #EstTaxShipItemTable_estBasketTotal';\n\t\tthis.IS_STACKABLE = false;\n\t\tthis.CAN_REMOVE = false;\n\t\tthis.GET_UPDATED_CART_URL = this.IS_CHECKOUT_URL ? `${CHECKOUT_URL}?method=initData` : CART_URL;\n\t\tthis.REQUEST_URL = CART_URL;\n\t\tthis.EMPTY_CART_SELECTOR = '.ml-basket-empty-msg';\n\t\tthis.PAYMENT_STEP_ELEMENT = 'ml-accordion-step-collapsed';\n\n\t\tthis.paymentStepElem = document.querySelector('.ml-accordion-steps li:nth-child(4)');\n\t}\n\n\tcheckCondition() {\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isOnCart = window.location.href.startsWith(CART_URL);\n\t\tconst isOnCheckout = window.location.href.startsWith(CHECKOUT_URL);\n\t\tconst paymentStep = this.IS_CHECKOUT_URL\n\t\t\t? !this.paymentStepElem.classList.contains(this.PAYMENT_STEP_ELEMENT)\n\t\t\t: false;\n\t\tconst currentState = !emptyCart && (isOnCart || (isOnCheckout && paymentStep));\n\t\treturn currentState;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.CODE_INPUT_SELECTOR).getAttribute('value')].filter(Boolean);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code)\n\t\t\t\t.then(() => this.getUpdatedCart())\n\t\t\t\t.then(html => {\n\t\t\t\t\tconst result = {\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t};\n\t\t\t\t\tif (JSON.stringify(html).match(code)) {\n\t\t\t\t\t\tresult.finalPrice = this.parseTotal(html);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tif (result.finalPrice < originalPrice) {\n\t\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t}\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this.applyCode(codes[0]);\n\t}\n\n\tgetUpdatedCart() {\n\t\treturn fetch(this.GET_UPDATED_CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\t// Return JSON if it is possible\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tparseTotal(data) {\n\t\tif (data && typeof data === 'object') {\n\t\t\tconst { value } = data.targetDataForUpdate\n\t\t\t\t.find(item => item.path === 'summary')\n\t\t\t\t.data.orderTotals.find(item => item.label === 'Order Total');\n\t\t\treturn toFloat(value);\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, data));\n\t}\n};\n\nexport default {\n\tname: 'Chasing Fireflies',\n\tdomain: 'chasing-fireflies.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import BasketDoDriver from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst BASE_URL = 'https://www.designtoscano.com';\nconst CART_URL = `${BASE_URL}/basket.do`;\n\n/**\nDriver behavior description:\n+ Existing code: yes \n+ Remove code: no\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented:  no\n+ Valid codes can be replaced by another valid code: yes\n+ Pages, where extension works: cart\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n+ Special case about the driver works\n  - maxCoupons: 7 (testing time)\n */\n\nconst Driver = class Driver extends BasketDoDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.REQUEST_URL = CART_URL;\n\t\tthis.IS_STACKABLE = false;\n\t\tthis.CAN_REMOVE = false;\n\t\tthis.CODE_VALUE_SELECTOR = '#sourceCode';\n\t\tthis.CART_TOTAL_SELECTOR = '.ml-basket-merchandise-subtotal .ml-basket-total-value';\n\t\tthis.SUBTOTAL_SELECTOR = '.ml-basket-subtotal .ml-basket-total-value';\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst isSubtotal = document.querySelector(this.SUBTOTAL_SELECTOR);\n\t\tthis.TOTAL_SELECTOR = isSubtotal ? this.SUBTOTAL_SELECTOR : this.CART_TOTAL_SELECTOR;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.CODE_VALUE_SELECTOR)]\n\t\t\t\t.map(element => element.defaultValue)\n\t\t\t\t.filter(Boolean),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tparseTotal(html) {\n\t\tif (html) {\n\t\t\tconst isSubtotal = extractElement(this.SUBTOTAL_SELECTOR, html);\n\t\t\tthis.TOTAL_SELECTOR = isSubtotal ? this.SUBTOTAL_SELECTOR : this.CART_TOTAL_SELECTOR;\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, html));\n\t}\n};\n\nexport default {\n\tname: 'Design Toscano',\n\tdomain: 'designtoscano.com',\n\tstackable: false,\n\tDriver,\n\tmaxCoupons: 7,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.ml-basket-empty-msg');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import BasketDoDriver from './_base';\nimport bus from '../../bus';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElementFromHTML } = DOM;\n\nconst BASE_URL = 'https://www.donnakaran.com';\nconst CART_URL = `${BASE_URL}/basket.do`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout`;\n\n/**\n * We can apply ony one code\n * We can't remove code\n * We can get existing codes only from input.\n * But input value can be empty while code exists.\n */\n\nconst Driver = class Driver extends BasketDoDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.REQUEST_URL = `${BASE_URL}/basket.do`;\n\t\tthis.IS_STACKABLE = false;\n\t\tthis.CAN_REMOVE = false;\n\t\tthis.CODE_VALUE_SELECTOR = '#sourceCode';\n\t\tthis.TOTAL_SELECTOR = '.ml-accordion-summary-item-value, #EstTaxShipItemTable_estBasketTotal';\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODE_VALUE_SELECTOR)]\n\t\t\t.map(element => element.getAttribute('value'))\n\t\t\t.filter(Boolean);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\twatchForCartUrl() {\n\t\tlet lastState = false;\n\t\tsetInterval(() => {\n\t\t\tconst isOnCart = window.location.href.startsWith(CART_URL);\n\t\t\tlet currentState = false;\n\t\t\tif (isOnCart) {\n\t\t\t\tcurrentState = !document.querySelector('.ml-basket-empty-msg');\n\t\t\t} else {\n\t\t\t\tconst promotionsBlock = [...document.querySelectorAll('.ml-accordion-step-content')].find(value =>\n\t\t\t\t\tvalue.querySelector('#sourceCode'),\n\t\t\t\t);\n\t\t\t\tcurrentState = promotionsBlock ? promotionsBlock.style.height === 'auto' : false;\n\t\t\t}\n\n\t\t\tif (lastState !== currentState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tlastState = currentState;\n\t\t}, 500);\n\t}\n\n\tparseTotal(html) {\n\t\tlet total = null;\n\t\tif (html) {\n\t\t\ttotal = elemToFloat(extractElementFromHTML(html, this.TOTAL_SELECTOR));\n\t\t} else {\n\t\t\tconst elements = document.querySelectorAll(this.TOTAL_SELECTOR);\n\t\t\ttotal = elemToFloat(elements[elements.length - 1]);\n\t\t}\n\t\treturn total;\n\t}\n};\n\nexport default {\n\tname: 'Donna Karan Cashmere Mist',\n\tdomain: 'donnakaran.com',\n\tisSinglePageApp: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL);\n\t},\n};\n","import BasketDoDriver from './_base';\nimport { completionActions, format, DOM } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst BASE_URL = 'https://www.ghbass.com';\nconst CART_URL = `${BASE_URL}/basket.do`;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: no\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: yes (but not with invalid)\n+ Pages, where extension works: cart\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n+ Special case about the driver works (if it needed).\n  - sessionTimer yes (15)\ndon't support the checkout page because our requests change the shipping method \nand also can't find the right parameters for a correct and complete request\n  */\n\nconst Driver = class Driver extends BasketDoDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.SCRIPT_SELECTOR = '[type=\"text/javascript\"]';\n\t\tthis.EMPTY_CART_SELECTOR = '.ml-basket-empty-msg';\n\n\t\tthis.REQUEST_URL = CART_URL;\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.IS_STACKABLE = false;\n\t\tthis.CAN_REMOVE = false;\n\n\t\tthis.SHIPPING_SELECTOR = '#EstTaxShipItemTable_discountedShippingTotal';\n\t\tthis.TAX_SELECTOR = '#EstTaxShipItemTable_taxTotal';\n\n\t\tthis.CODE_REGEX = /cart\\['coupon'\\] = \"(\\w+)/;\n\t\tsessionTimer.initialize();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.SCRIPT_SELECTOR)]\n\t\t\t.map(elem => elem.innerHTML.match(this.CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(code => code[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getUpdatedCart().then(response => {\n\t\t\tconst taxElem = extractElement(this.TAX_SELECTOR, response);\n\t\t\tconst shippingElem = extractElement(this.SHIPPING_SELECTOR, response);\n\t\t\tconst tax = taxElem ? elemToFloat(taxElem) || 0 : 0;\n\t\t\tconst shipping = shippingElem ? elemToFloat(shippingElem) || 0 : 0;\n\t\t\treturn this.parseTotal(response) - tax - shipping;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'GH Bass',\n\tdomain: 'ghbass.com',\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisOnCartUrl: href => href.startsWith(CART_URL) && !document.querySelector('.ml-basket-empty-msg'),\n};\n","import Promise from 'bluebird';\nimport BasketDoDriver from './_base';\nimport bus from '../../bus';\nimport { format, DOM, completionActions } from '../../../utils';\n\nconst { extractElement, setValue } = DOM;\nconst { elemToFloat } = format;\n\n/*\nBehavior description:\n- can get existing codes;\n- can remove codes;\n- valid code can be replaced with another valid code;\n- valid code can't be replaced with invalid code\n- can't apply multiple codes (not stackable);\n- code testing may be run on 'Cart' and 'Checkout' pages;\n*/\n\nconst BASE_URL = 'https://www.herrschners.com';\nconst CART_URL = `${BASE_URL}/basket.do`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout`;\nconst IS_ON_CART = window.location.pathname.includes('/basket.do');\n\nconst Driver = class Driver extends BasketDoDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.IS_STACKABLE = false;\n\t\tthis.APPLIED_CODE_SELECTOR = '.basketPromoCodes .remove';\n\t\tthis.CODE_INPUT_SELECTOR = '#sourceCode';\n\t\tthis.APPLY_BTN_SELECTOR = '.ml-payment-source-code-apply div';\n\t\tthis.PAYMENT_SECTION_SELECTOR = '.ml-accordion-steps li:nth-child(5)';\n\t\tthis.CODE_REGEX = /sourceCode=(\\w+)/;\n\t\tthis.SUMMARY_CLASSES_SELECTOR = '.ml-accordion-summary-item-label';\n\t\tthis.CHECKOUT_UPDATE_URL = 'https://www.herrschners.com/checkout/accordioncheckout.do?method=view';\n\t}\n\n\twatchForCartUrl() {\n\t\tlet previousState = false;\n\t\tsetInterval(() => {\n\t\t\tconst isOnRightUrl = CART_URL || CHECKOUT_URL;\n\t\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\t\tconst paymentSection = document.querySelector(this.PAYMENT_SECTION_SELECTOR);\n\t\t\tlet isOnRightPage = null;\n\t\t\tif (IS_ON_CART) {\n\t\t\t\tisOnRightPage = Boolean(codeInput);\n\t\t\t} else {\n\t\t\t\tisOnRightPage = paymentSection\n\t\t\t\t\t? paymentSection.classList.contains('ml-accordion-step-accessible')\n\t\t\t\t\t: false;\n\t\t\t}\n\t\t\tconst currentState = isOnRightUrl && isOnRightPage;\n\t\t\tif (currentState !== previousState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tpreviousState = currentState;\n\t\t}, 500);\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.lastResponse = null;\n\t\tif (!IS_ON_CART) {\n\t\t\treturn this._getUpdatedCheckout().then(response => {\n\t\t\t\tthis.lastResponse = response;\n\t\t\t});\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codeElem = IS_ON_CART\n\t\t\t? document.querySelector(this.APPLIED_CODE_SELECTOR)\n\t\t\t: extractElement(this.APPLIED_CODE_SELECTOR, this.lastResponse);\n\t\tconst codes = [codeElem].filter(Boolean).map(el => el.getAttribute('onclick').match(this.CODE_REGEX)[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\treturn this.applyCode(code).then(response => {\n\t\t\t\tif (this._codeAppliedCheck(response)) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\treturn this.getUpdatedCart().then(html => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(html);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn IS_ON_CART ? this.applyCode(codes[0]) : this._manuallyApplyCode(codes[0]);\n\t}\n\n\t_manuallyApplyCode(code) {\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\n\t\tsetValue(codeInput, code);\n\t\tdocument.querySelector(this.APPLY_BTN_SELECTOR).click();\n\t\treturn Promise.resolve();\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\treturn data.status !== 200;\n\t}\n\n\t// method of finding price element because this site use angular, so many the same classes existing on the page\n\t_findTotalElem() {\n\t\treturn [...document.querySelectorAll(this.SUMMARY_CLASSES_SELECTOR)].filter(\n\t\t\tel => el.textContent === 'Order Total',\n\t\t)[0].nextElementSibling;\n\t}\n\n\t_getUpdatedCheckout() {\n\t\treturn fetch(this.CHECKOUT_UPDATE_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\tparseTotal(html) {\n\t\tlet total = null;\n\t\tif (html) {\n\t\t\ttotal = extractElement(this.TOTAL_SELECTOR, html);\n\t\t} else {\n\t\t\ttotal = IS_ON_CART ? document.querySelector(this.TOTAL_SELECTOR) : this._findTotalElem();\n\t\t}\n\t\treturn elemToFloat(total);\n\t}\n};\n\nexport default {\n\tname: 'Herrschners',\n\tdomain: 'herrschners.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tcompletionAction() {\n\t\treturn IS_ON_CART ? completionActions.reload : completionActions.none;\n\t},\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import beautybrands from './beautybrands.com';\nimport boscovs from './boscovs.com';\nimport bronners from './bronners.com';\nimport chadwicks from './chadwicks.com';\nimport chasingFireflies from './chasing-fireflies.com';\nimport designtoscano from './designtoscano.com';\nimport donnakaran from './donnakaran.com';\nimport ghbass from './ghbass.com';\nimport herrschners from './herrschners.com';\nimport travelsmith from './travelsmith.com';\nimport wilsonsleather from './wilsonsleather.com';\n\nexport default [\n\tbeautybrands,\n\tboscovs,\n\tbronners,\n\tchadwicks,\n\tchasingFireflies,\n\tdesigntoscano,\n\tdonnakaran,\n\tghbass,\n\therrschners,\n\ttravelsmith,\n\twilsonsleather,\n];\n","import BasketDoDriver from './_base';\nimport bus from '../../bus';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat, toFloat } = format;\nconst { extractData, extractElement } = DOM;\n\nconst BASE_URL = 'https://www.travelsmith.com';\nconst CART_URL = `${BASE_URL}/basket.do`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout/accordioncheckout.do`;\nconst IS_ON_CART = window.location.href.startsWith(CART_URL);\n\n/* Behaviour description:\n * can get existing code\n * but can't get existing code if user come back with checkout page to cart page\n * can apply only one code;\n * can't remove code;\n * can't apply invalid code\n * code testing may be run on 'Cart' and 'Checkout' page;\n */\n\nconst Driver = class Driver extends BasketDoDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.CODE_INPUT_SELECTOR = '#sourceCode';\n\t\tthis.IS_CHECKOUT_URL = window.location.href.startsWith(CHECKOUT_URL);\n\t\tthis.TOTAL_SELECTOR =\n\t\t\t'.ml-summary-total .ml-accordion-summary-item-value:last-child, #EstTaxShipItemTable_estBasketTotal';\n\t\tthis.IS_STACKABLE = false;\n\t\tthis.CAN_REMOVE = false;\n\t\tthis.GET_UPDATED_CART_URL = this.IS_CHECKOUT_URL ? `${CHECKOUT_URL}?method=initData` : CART_URL;\n\t\tthis.REQUEST_URL = CART_URL;\n\t\tthis.EMPTY_CART_SELECTOR = '.ml-basket-empty-msg';\n\t\tthis.PAYMENT_STEP_ELEMENT = 'ml-accordion-step-collapsed';\n\n\t\tthis.paymentStepElem = document.querySelector('.ml-accordion-steps li:nth-child(4)');\n\t}\n\n\twatchForCartUrl() {\n\t\tlet previousState = false;\n\t\tsetInterval(() => {\n\t\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\t\tconst isOnCart = window.location.href.startsWith(CART_URL);\n\t\t\tconst isOnCheckout = window.location.href.startsWith(CHECKOUT_URL);\n\t\t\tconst paymentStep = this.IS_CHECKOUT_URL\n\t\t\t\t? !this.paymentStepElem.classList.contains(this.PAYMENT_STEP_ELEMENT)\n\t\t\t\t: false;\n\t\t\tconst currentState = !emptyCart && (isOnCart || (isOnCheckout && paymentStep));\n\t\t\tif (currentState !== previousState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tpreviousState = currentState;\n\t\t}, 1000);\n\t}\n\n\tgetExistingCodes() {\n\t\tlet codes = [];\n\t\treturn Promise.resolve()\n\t\t\t.then(() => (IS_ON_CART ? document.body.innerHTML : this._getCartPage()))\n\t\t\t.then(html => {\n\t\t\t\tcodes = [extractData(this.CODE_INPUT_SELECTOR, html, false, 'value')].filter(Boolean);\n\n\t\t\t\treturn {\n\t\t\t\t\tcodes,\n\t\t\t\t\tcodeCount: codes.length,\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this.applyCode(codes[0]);\n\t}\n\n\t_getCartPage() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\tgetUpdatedCart() {\n\t\treturn fetch(this.GET_UPDATED_CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\t// Return JSON if it is possible\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tparseTotal(data) {\n\t\tif (data && typeof data === 'object') {\n\t\t\tconst { value } = data.targetDataForUpdate\n\t\t\t\t.find(item => item.path === 'summary')\n\t\t\t\t.data.orderTotals.find(item => item.label === 'Order Total');\n\t\t\treturn toFloat(value);\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, data));\n\t}\n};\n\nexport default {\n\tname: 'TRAVELSMITH',\n\tdomain: 'travelsmith.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import BasketDoDriver from './_base';\nimport { extractElement } from '../../../utils/DOM';\nimport { toFloat } from '../../../utils/format';\n\nconst BASE_URL = 'https://www.wilsonsleather.com';\nconst CART_URL = `${BASE_URL}/basket.do`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout`;\n\nconst EMPTY_ELEMENT_SELECTOR = '.ml-basket-empty-msg';\n\n/* Behaviour description:\n- We can always get the existing code on the checkout page, but not always on the cart page\n- Remove code: yes\n- Stackable: no\n- Free gift support: no\n- ‘isValid’ implemented: yes\nOptional:\n- Show message about free shipping on the cart page (without discount info): no\n- Is driver SPA and add the condition to show popup:no\n- we can apply code on cart page and on checkout page\n- Gather codes on site pages: yes */\n\nconst Driver = class Driver extends BasketDoDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\n\t\tthis.IS_STACKABLE = false;\n\t\tthis.TOTAL_SELECTOR =\n\t\t\t'#EstTaxShipItemTable_estBasketTotal, .ml-summary-total .ml-accordion-summary-item-value, .ml-basket-subtotal .ml-basket-total-value';\n\n\t\tthis.APPLIED_CODE_REGEX = /cart\\['coupon'\\] = \"([A-Za-z\\d]+)/;\n\t\tthis.REQUEST_URL = CART_URL;\n\n\t\tthis.MERCHANT_PROMO_BLOCK_SELECTOR = '.ml-header-global-include span';\n\n\t\tthis.SHIPPING_SELECTOR = '#EstTaxShipItemTable_discountedShippingTotal';\n\t\tthis.TAX_SELECTOR = '#EstTaxShipItemTable_taxTotal';\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [document.querySelector(this.MERCHANT_PROMO_BLOCK_SELECTOR)].filter(Boolean).map(code => code.innerText);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll('script')]\n\t\t\t.map(el => el.textContent.match(this.APPLIED_CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1] || null);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCode(code) {\n\t\treturn fetch(`${BASE_URL}/sourcecode.do?method=reomoveSourceCode&sourceCode=${code}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getUpdatedCart().then(responseHTML => {\n\t\t\tconst total = this.parseTotal(responseHTML);\n\t\t\tconst shipping = extractElement(this.SHIPPING_SELECTOR, responseHTML);\n\t\t\tconst tax = extractElement(this.TAX_SELECTOR, responseHTML);\n\n\t\t\tconst calculatedShipping =\n\t\t\t\t!shipping || shipping.innerText.toLowerCase().includes('free') ? 0 : toFloat(shipping.innerText);\n\t\t\tconst calculatedTax =\n\t\t\t\t!tax || tax.innerText.includes('TBD') || tax.innerText.includes('Calculate')\n\t\t\t\t\t? 0\n\t\t\t\t\t: toFloat(tax.innerText);\n\n\t\t\treturn total - calculatedShipping - calculatedTax;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: \"Wilson's Leather\",\n\tdomain: 'wilsonsleather.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector(EMPTY_ELEMENT_SELECTOR));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.startsWith(CHECKOUT_URL);\n\t},\n};\n"],"sourceRoot":""}