{"version":3,"sources":["webpack:///./src/inject/drivers/base.js","webpack:///./src/inject/drivers/footlocker/_base.js","webpack:///./src/inject/drivers/footlocker/champssports.com.js","webpack:///./src/inject/drivers/footlocker/eastbay.com.js","webpack:///./src/inject/drivers/footlocker/footaction.com.js","webpack:///./src/inject/drivers/footlocker/footlocker.ca.js","webpack:///./src/inject/drivers/footlocker/footlocker.com.js","webpack:///./src/inject/drivers/footlocker/index.js","webpack:///./src/inject/drivers/footlocker/kidsfootlocker.com.js","webpack:///./src/inject/drivers/footlocker/ladyfootlocker.com.js"],"names":["toFloat","format","BaseDriver","watchForRestoreUserData","time","pauseInterval","interval","setInterval","currentState","checkRestoreDataCondition","clearInterval","bus","$emit","e","handleDriverError","source","storeUserData","domain","userData","getUserData","Promise","resolve","userDataKey","getUserDataStorageKey","storageRecord","storedTime","Date","now","backgroundMessaging","setDriverStorage","log","restoreUserData","maxStorageLifetime","driverStorage","getDriverStorage","deleteDriverStorage","setUserData","getStartPrice","startPrice","Number","MAX_SAFE_INTEGER","totalElementConfig","TOTAL_ELEMENT_CONFIG","selector","attribute","regex","totalElement","Array","isArray","forEach","elemSelector","document","querySelector","Error","value","getAttribute","textContent","pattern","group","match","beforeTestCodes","beforeCheckCodes","beforeApplyCodes","checkCodes","applyCodes","stackCodes","removeCodes","getMerchantCodes","getExistingCodes","codes","codeCount","getPreTaxShippingTotal","watchForCartUrl","previousState","checkCondition","completeExperience","completeExperiencePromisified","args","_promisify","beforeTestCodesPromisified","getStartPricePromisified","getMerchantCodesPromisified","getExistingCodesPromisified","removeCodesPromisified","beforeApplyCodesPromisified","applyCodesPromisified","beforeCheckCodesPromisified","checkCodesPromisified","stackCodesPromisified","method","then","apply","wait","browserUtils","elemToFloat","FootlockerDriver","constructor","baseURL","toSupportCheckout","DOMAIN","BASE_URL","REQUEST_URL","isMerchantCodes","isPureTotal","MERCHANT_CODE_URL","MERCHANT_HEADER_CODE_SELECTOR","MERCHANT_HEADER_CODE_REGEX","CART_URL","CHECKOUT_URL","isOnCart","window","location","href","startsWith","isOnCheckout","MANAGE_CODE_URL","TOKEN_URL","RESTORE_SHIPPING_URL","DELIVERY_METHODS_URL","FREE_SHIPPING_REGEX","TOTAL_SELECTOR","REMOVE_CODE_BTN_SELECTOR","SESSION_ERROR_MSG_SELECTOR","SPINNER_SELECTOR","APPLIED_CODE_SELECTOR","ADD_PROMO_SELECTOR","INPUT_SELECTOR","APPLY_BUTTON_SELECTOR","FORM_SELECTORS","SIGN_IN_MODAL_SELECTOR","toRestoreShippng","EMPTY_CART_SELECTOR","MAX_TRY_NUMBER","FIRST_DISABLE_TIME_MS","SECOND_DISABLE_TIME_MS","ADDITIONAL_TAB_TIMEOUT","requestId","REQUEST_OPTIONS","headers","accept","GET_REQUEST_OPTIONS","request","setType","requestTypes","embedded","sessionTimer","initialize","actionInterval","allowTesting","codeTestingCount","lastTestTimestamp","isSpinner","offsetParent","isCartEmpty","isOnPage","isErrorSessionMsg","isTotal","isFormClosed","every","isSignInModal","queryStringGetPrice","URLSearchParams","checkInventory","checkPriceVariation","_updateToken","_getOrderSummary","orderSummary","firstResponse","startShipping","_formShippingData","merchantHeaderCodes","querySelectorAll","map","element","innerText","filter","Boolean","codeMatch","_getCouponsSummary","responseJSON","page","components","list","reduce","acc","current","couponCode","Set","appliedCoupons","voucherCode","length","_removeCode","_parseTotal","originalPrice","requestWasBlocked","each","code","result","finalPrice","finalDiscount","isValid","freeShipping","_applyCode","response","status","currentShipping","body","deliveryModeId","_checkFreeShipping","newTabId","openNewTab","url","closeTabTimeout","setTimeout","chrome","runtime","onMessage","addListener","msg","tabClosed","tabId","clearTimeout","_changeShipping","_removeCodeManually","delay","_applyCodeManually","completionActions","none","responseStatus","total","totalPriceWithTax","shippingCost","deliveryMode","deliveryCost","tax","totalTax","isCodeRemoved","click","promoLink","isInput","setValue","delete","tryNumber","bodyData","JSON","stringify","voucherId","post","_getCart","put","set","get","toString","json","responseJson","data","csrfToken","appliedOrderPromotions","find","promotion","includes","test","description","totalPrice","formattedValue","startShippingValue","currentShippingCost","deliveryAddress","countryCode","region","countryIso","country","isocode","stateCode","isocodeShort","Driver","name","completionAction","revisit","maxCoupons","isSinglePageApp","DriverTemplate","champssports","eastbay","footaction","footlockerCa","footlocker","kidsfootlocker","ladyfootlocker","extractData","DOM","MERCHANT_CODE_SELECTOR","MERCHANT_CODE_REGEX","responseHTML","fetch","credentials","text"],"mappings":"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","file":"drivers__footlocker.bundle.js","sourcesContent":["import bus from '../bus';\nimport { log, format } from '../../utils';\nimport { backgroundMessaging, handleDriverError } from '../lib';\n\nconst { toFloat } = format;\n\nexport default class BaseDriver {\n\t/**\n\t * @function watchForRestoreUserData - set up a listener to check user data restorement\n\t * @emits bus#RestoreUserData - the event that indicates to the app\tthat user data could be restored\n\t */\n\twatchForRestoreUserData(time = 500) {\n\t\tlet pauseInterval = false;\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tconst currentState = await this.checkRestoreDataCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t\tif (currentState) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tbus.$emit('restore-user-data');\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkRestoreDataCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t}\n\t\t}, time);\n\n\t\treturn interval;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * @function storeUserData\n\t * @param {String} domain - domain to set the driver storage\n\t * @returns {Promise}\n\t */\n\tasync storeUserData(domain) {\n\t\tconst userData = await this.getUserData();\n\n\t\tif (userData === null) {\n\t\t\t// Nothing to store\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst storageRecord = {\n\t\t\tuserData,\n\t\t\tstoredTime: Date.now(),\n\t\t};\n\t\tbackgroundMessaging.setDriverStorage(userDataKey, storageRecord);\n\t\tlog('Stored user data: %O', storageRecord);\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function restoreUserData\n\t * @param {String} domain - domain to access the driver storage\n\t * @param {Number} [maxStorageLifetime] - optional, the lifetime of the stored data (default 10 mins)\n\t * @returns {Promise}\n\t */\n\tasync restoreUserData(domain, maxStorageLifetime = 600000) {\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(userDataKey);\n\n\t\tif (driverStorage) {\n\t\t\tconst { storedTime, userData } = driverStorage;\n\t\t\t// Clear stored user data\n\t\t\tbackgroundMessaging.deleteDriverStorage(userDataKey);\n\n\t\t\tif (Date.now() - storedTime <= maxStorageLifetime) {\n\t\t\t\tlog('Restore user data: %O', userData);\n\t\t\t\treturn this.setUserData(userData);\n\t\t\t}\n\t\t\tlog('User data is outdated, skip restoring');\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserData - get user data which should be stored\n\t * @returns {Object} - object with required user data which should be restored\n\t */\n\tgetUserData() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function setUserData - restore user data on page\n\t * @param {Object} userData - data which was saved and should be restored\n\t * @returns {Promise}\n\t */\n\tsetUserData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserDataStorageKey - unique key for storing user data per merchant\n\t * @returns {String}\n\t */\n\tgetUserDataStorageKey(domain) {\n\t\t// Append `_userData` to avoid possible conflicts with created storage from driver\n\t\treturn `${domain}_userData`;\n\t}\n\n\t/**\n\t * Parses start price from page\n\t *\n\t * @function getStartPrice\n\t * @returns {Promise<Number>|Number} - the total from the page\n\t */\n\tgetStartPrice() {\n\t\tlet startPrice = Number.MAX_SAFE_INTEGER;\n\t\tconst totalElementConfig = this.TOTAL_ELEMENT_CONFIG;\n\t\tif (totalElementConfig) {\n\t\t\tconst { selector, attribute, regex } = totalElementConfig;\n\t\t\tlet totalElement;\n\t\t\t// handle case, when there is array of selectors and we try to take totalElement using these selectors in turn\n\t\t\t// for example dell.com, hertz.com\n\t\t\tif (Array.isArray(selector)) {\n\t\t\t\tselector.forEach(elemSelector => {\n\t\t\t\t\tif (!totalElement) {\n\t\t\t\t\t\ttotalElement = document.querySelector(elemSelector);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\ttotalElement = document.querySelector(selector);\n\t\t\t} else {\n\t\t\t\thandleDriverError(\n\t\t\t\t\tnew Error(`Total selector type mismatch. Expected string | array, got ${typeof selector}`),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (totalElement) {\n\t\t\t\tlet value = attribute ? totalElement.getAttribute(attribute) : totalElement.textContent;\n\n\t\t\t\tif (value && regex) {\n\t\t\t\t\t// Set pattern to null to receive error in case pattern was not defined\n\t\t\t\t\t// otherwise we may silently return undefined or empty string\n\t\t\t\t\tconst { pattern = null, group = 0 } = regex;\n\t\t\t\t\tvalue = value.match(pattern)[group];\n\t\t\t\t}\n\t\t\t\tstartPrice = toFloat(value);\n\t\t\t}\n\t\t}\n\t\treturn startPrice;\n\t}\n\n\t/**\n\t * Perform any needed actions and setup to start codes testing\n\t *\n\t * @function beforeTestCodes\n\t *\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @typedef {Object} OriginalData\n\t * @property {Number} originalPrice the starting price for the cart\n\t * @property {Number} originalItemsCount the starting items count of the cart\n\t */\n\t/**\n\t * Perform any needed actions and setup before `checkCodes()` will be executed\n\t *\n\t * @function beforeCheckCodes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tbeforeCheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Perform any needed actions and setup before `applyCodes()` will be executed\n\t *\n\t * @function beforeApplyCodes\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function checkCodes\n\t *\n\t * @param {String[]} codes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise}\n\t */\n\tcheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes each code in @param codes and actually applies it to the cart,\n\t * typically through a fetch(...) call.\n\t *\n\t * @function applyCodes\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tapplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function stackCodes\n\t *\n\t * @param {Object} validationInfo - contains all required info passed by `checkCodes()` for codes stacking\n\t * @param {String[]} validationInfo.codes\n\t * @param {Float} [validationInfo.originalPrice]\n\t * @param {Object[]} [validationInfo.discounts] - contains all codes mapped with their discounts\n\t * @returns {Promise}\n\t */\n\tstackCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function removeCodes\n\t *\n\t * @param {String[]} codes - passed in case the driver needs to know specific codes to do removal\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request response) which are available and were not applied by user\n\t *\n\t * @function getMerchantCodes\n\t * @returns {String[]} - codes from merhcant page (or request response if possible)\n\t */\n\tgetMerchantCodes() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request) which are available and were applied by user\n\t *\n\t * @typedef {Object} ExistingCodeInfo\n\t * @prop {String[]} codes - list of codes which had been applied, if discoverable\n\t * @prop {Number} codeCount - the number of codes that were applied to the cart\n\t */\n\t/**\n\t * @function getExistingCodes\n\t * @returns {ExistingCodeInfo}\n\t */\n\tgetExistingCodes() {\n\t\treturn {\n\t\t\tcodes: [],\n\t\t\tcodeCount: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Parses pre tax and shipping total from page or request's response\n\t *\n\t * @function getPreTaxShippingTotal\n\t * @returns {Promise<Number>|Number} - the total without tax and shipping\n\t */\n\tgetPreTaxShippingTotal() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function watchForCartUrl - optional function to set up a listener for url changes on SPAs\n\t * @emits bus#CartActive - the event (using the string 'cart-active') that indicates to the app that test codes button should be shown\n\t * @emits bus#CartInactive - the event (using the string 'cart-inactive') that indicates to the app that test codes button should be hidden\n\t */\n\twatchForCartUrl(time = 500) {\n\t\tlet previousState = null;\n\t\tlet pauseInterval = false;\n\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\tlet currentState = null;\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tcurrentState = await this.checkCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t\tif (currentState !== previousState) {\n\t\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t\t}\n\t\t\t\tpreviousState = currentState;\n\t\t\t}\n\t\t}, time);\n\t\t// return the interval to stop it in `watchForCartUrl` if needed from outside\n\t\treturn interval;\n\t}\n\n\t/**\n\t * @function checkCondition - optional function to check for conditions on SPAs\n\t * @returns {Boolean}\n\t */\n\tcheckCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Perform custom completion action on Continue to Checkout button\n\t * Takes best codes in @param codes\n\t *\n\t * @function completeExperience\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tcompleteExperience() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function completeExperiencePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcompleteExperiencePromisified(...args) {\n\t\treturn this._promisify(this.completeExperience, args);\n\t}\n\n\t/**\n\t * @function beforeCodesTestingPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeTestCodes, args);\n\t}\n\n\t/**\n\t * @function getStartPricePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetStartPricePromisified() {\n\t\treturn this._promisify(this.getStartPrice);\n\t}\n\n\t/**\n\t * @function getMerchantCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetMerchantCodesPromisified(...args) {\n\t\treturn this._promisify(this.getMerchantCodes, args);\n\t}\n\n\t/**\n\t * @function getExistingCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetExistingCodesPromisified(...args) {\n\t\treturn this._promisify(this.getExistingCodes, args);\n\t}\n\n\t/**\n\t * @function removeCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tremoveCodesPromisified(...args) {\n\t\treturn this._promisify(this.removeCodes, args);\n\t}\n\n\t/**\n\t * @function beforeApplyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeApplyCodes, args);\n\t}\n\n\t/**\n\t * @function applyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tapplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.applyCodes, args);\n\t}\n\n\t/**\n\t * @function beforeCheckCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeCheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeCheckCodes, args);\n\t}\n\n\t/**\n\t * @function checkCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.checkCodes, args);\n\t}\n\n\t/**\n\t * @function stackCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tstackCodesPromisified(...args) {\n\t\treturn this._promisify(this.stackCodes, args);\n\t}\n\n\t/**\n\t * @function _promisify - promisifies given method and return it's result as a Promise\n\t * @returns {Promise}\n\t */\n\t_promisify(method, args) {\n\t\treturn Promise.resolve().then(() => method.apply(this, args));\n\t}\n}\n","import Promise from 'bluebird';\nimport BaseDriver from '../base';\nimport bus from '../../bus';\n\nimport { format, log, browserUtils, request, requestTypes, completionActions } from '../../../utils';\nimport { backgroundMessaging, sessionTimer, handleDriverError } from '../../lib';\nimport { setValue } from '../../../utils/DOM';\n\nconst { wait } = browserUtils;\nconst { toFloat, elemToFloat } = format;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: yes (for the 'Cart' page)\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: yes\n+ Manually apply code: yes (if failed to apply best code by request)\n+ Pages, where extension works:\n- Cart page\n\n+ Is driver SPA yes\n- no spinner\n- no emptyCart\n- on the cart or on the checkout (if chackout flag true)\n- no errorSessionMessage,\n- no following forms open: shipping address form, shipping methods form, card data form,\n- 'Add Military Discount' form, 'Add Gift Card' form\n- no 'Sign In' modal window\n- allow 1 code testing, then retesting in 10 minutes, then disable testing on 24 hours\n\n+ Gather codes on site pages: yes (from the header - all sites, from 'Coupon'section - for some sites)\n\n+ Special case about the driver works (if it needed).\n\nSome codes could reset the non-default shipping methods to the default one. If such code is applied then\nnon-default shipping methods can't be chosen. So if such an issue occurs during testing then before\napplying the best code the user's shipping method will be restored\n\nFor avoiding the block by merchant site added:\nAdded delay(1500 ms) before every request to avoid blocking\nIf merchant blocks us during code testing, we mark codes as invalid and try to apply best code\nIf merchant blocks  us during applying best code, we try to apply it manually\nsessionTimer - 15 minutes\nthe support for 'Checkout' is implemented, but drivers will work there only if an appropriate variable is\nset to true. 'Checkout' support is removed because free shipping codes reset shipping method to\ndefault and a user can't change it without removing code. (Site behavior)\nImplemented pure total method in the template. To enable it appropriate variable has to be set in the driver\nCredentials (for signing in for all sites). ypa@mail.com / Temporary_1\n*/\n\nexport default class FootlockerDriver extends BaseDriver {\n\tconstructor(baseURL) {\n\t\tsuper();\n\t\tthis.toSupportCheckout = true;\n\t\t// has to be defined in the driver\n\t\tthis.DOMAIN = '';\n\t\tthis.BASE_URL = baseURL;\n\t\tthis.REQUEST_URL = `${this.BASE_URL}/api/users/carts/current`;\n\n\t\t// For cases when a site has 'Coupons' section - true\n\t\tthis.isMerchantCodes = false;\n\t\t// Change for executing pure total method\n\t\tthis.isPureTotal = false;\n\t\t// Redefine in the driver if it is different\n\t\tthis.MERCHANT_CODE_URL = `${this.BASE_URL}/api/pages/en/coupons.page.json`;\n\t\t// Selector and regex for header merchant code. Redefine in driver if it differs.\n\t\tthis.MERCHANT_HEADER_CODE_SELECTOR = '.c-promotional-banner-item';\n\t\tthis.MERCHANT_HEADER_CODE_REGEX = /(use code |use |code )([A-Z0-9]*)/i;\n\n\t\tthis.CART_URL = `${this.BASE_URL}/cart`;\n\t\tthis.CHECKOUT_URL = `${this.BASE_URL}/checkout`;\n\t\tthis.isOnCart = () => window.location.href.startsWith(this.CART_URL);\n\t\tthis.isOnCheckout = () => window.location.href.startsWith(this.CHECKOUT_URL);\n\t\tthis.MANAGE_CODE_URL = `${this.REQUEST_URL}/vouchers`;\n\t\tthis.TOKEN_URL = `${this.BASE_URL}/api/session`;\n\t\tthis.RESTORE_SHIPPING_URL = `${this.REQUEST_URL}/orderestimate`;\n\t\tthis.DELIVERY_METHODS_URL = `${this.REQUEST_URL}/deliverymodes`;\n\n\t\tthis.FREE_SHIPPING_REGEX = /free.*shipping/i;\n\t\tthis.TOTAL_SELECTOR = '.total+.value';\n\n\t\tthis.REMOVE_CODE_BTN_SELECTOR = '.OrderSummary-voucher .Link.remove';\n\t\tthis.SESSION_ERROR_MSG_SELECTOR = '#sessionErrorModalHeader';\n\t\tthis.SPINNER_SELECTOR = '.global-loading';\n\t\tthis.APPLIED_CODE_SELECTOR = '.OrderSummary-voucher';\n\t\tthis.ADD_PROMO_SELECTOR = '.c-checkout-promo-code .Link';\n\t\tthis.INPUT_SELECTOR = '#input_text_voucherId';\n\t\tthis.APPLY_BUTTON_SELECTOR = '[aria-label=\"Apply Promo Code\"]';\n\t\tthis.FORM_SELECTORS = [\n\t\t\t'#step1 .c-address-selection-form', // shipping address\n\t\t\t'#step2 .c-shipping-options-form', // shipping methods\n\t\t\t'#step3 .c-payment-form', // card data form\n\t\t\t'#sheerid', // 'Add Military Discount' form\n\t\t\t'#step3 .c-gift-card-form', // 'Add Gift Card' form\n\t\t];\n\t\tthis.SIGN_IN_MODAL_SELECTOR = '.c-user-login-modal';\n\n\t\tthis.toRestoreShippng = false;\n\n\t\tthis.EMPTY_CART_SELECTOR = '.empty_bag, .empty-cart';\n\n\t\tthis.MAX_TRY_NUMBER = 2;\n\t\tthis.FIRST_DISABLE_TIME_MS = 10 * 60 * 1000; // 10 minutes\n\t\tthis.SECOND_DISABLE_TIME_MS = 24 * 60 * 60 * 1000; // 24 hours\n\t\tthis.ADDITIONAL_TAB_TIMEOUT = 10 * 1000; // 10 seconds\n\n\t\tthis.requestId = '2c608750-1680-11ea-8723-1d4a7c1f0a9a'; // worked with hardcoded value\n\n\t\tthis.REQUEST_OPTIONS = {\n\t\t\theaders: {\n\t\t\t\taccept: 'application/json',\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t};\n\n\t\tthis.GET_REQUEST_OPTIONS = {\n\t\t\theaders: {\n\t\t\t\taccept: 'application/json',\n\t\t\t\t'x-fl-request-id': this.requestId,\n\t\t\t},\n\t\t};\n\n\t\trequest.setType(requestTypes.embedded);\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t});\n\t}\n\n\tasync checkCondition() {\n\t\tlet allowTesting = true;\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(this.DOMAIN);\n\t\t// allow 1 code testing, then retesting in 10 minutes, then disable testing on 24 hours\n\t\tif (driverStorage) {\n\t\t\tconst { codeTestingCount } = driverStorage;\n\t\t\tif (codeTestingCount === 1) {\n\t\t\t\tallowTesting = Date.now() - driverStorage.lastTestTimestamp >= this.FIRST_DISABLE_TIME_MS;\n\t\t\t}\n\t\t\tif (codeTestingCount === 2) {\n\t\t\t\tallowTesting = Date.now() - driverStorage.lastTestTimestamp >= this.SECOND_DISABLE_TIME_MS;\n\t\t\t\tif (allowTesting) {\n\t\t\t\t\tbackgroundMessaging.deleteDriverStorage(this.DOMAIN);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst isSpinner = (document.querySelector(this.SPINNER_SELECTOR) || {}).offsetParent;\n\t\tconst isCartEmpty = (document.querySelector(this.EMPTY_CART_SELECTOR) || {}).offsetParent;\n\t\tconst isOnPage = this.isOnCart() || (this.toSupportCheckout && this.isOnCheckout());\n\t\t// sometimes can be message about wrong session\n\t\tconst isErrorSessionMsg = (document.querySelector(this.SESSION_ERROR_MSG_SELECTOR) || {}).offsetParent;\n\t\tconst isTotal = (document.querySelector(this.TOTAL_SELECTOR) || {}).offsetParent;\n\t\tconst isFormClosed = this.FORM_SELECTORS.every(\n\t\t\tselector => !(document.querySelector(selector) || {}).offsetParent,\n\t\t);\n\t\tconst isSignInModal = (document.querySelector(this.SIGN_IN_MODAL_SELECTOR) || {}).offsetParent;\n\t\treturn (\n\t\t\tisOnPage &&\n\t\t\tisTotal &&\n\t\t\t!isSpinner &&\n\t\t\t!isCartEmpty &&\n\t\t\tisFormClosed &&\n\t\t\t!isSignInModal &&\n\t\t\t!isErrorSessionMsg &&\n\t\t\tallowTesting\n\t\t);\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.queryStringGetPrice = new URLSearchParams({\n\t\t\tcheckInventory: true,\n\t\t\tcheckPriceVariation: true,\n\t\t});\n\t\treturn this._updateToken()\n\t\t\t.then(() => this._getOrderSummary())\n\t\t\t.then(orderSummary => {\n\t\t\t\tthis.firstResponse = orderSummary;\n\t\t\t\tthis.startShipping = this._formShippingData(orderSummary);\n\t\t\t\tlog('Starting shipping object', this.startShipping);\n\t\t\t\treturn Promise.resolve();\n\t\t\t});\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst merchantHeaderCodes = [...document.querySelectorAll(this.MERCHANT_HEADER_CODE_SELECTOR)]\n\t\t\t.map(element => element.innerText.match(this.MERCHANT_HEADER_CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(codeMatch => codeMatch[2]);\n\t\tif (this.isMerchantCodes) {\n\t\t\treturn this._getCouponsSummary().then(responseJSON => {\n\t\t\t\tconst codes = responseJSON.page.components\n\t\t\t\t\t.map(element => element.list)\n\t\t\t\t\t.reduce((acc, current) => [...acc, ...current], [])\n\t\t\t\t\t.map(element => element.couponCode)\n\t\t\t\t\t.filter(Boolean);\n\t\t\t\treturn [...new Set([...codes, ...merchantHeaderCodes])];\n\t\t\t});\n\t\t}\n\t\treturn [...new Set(merchantHeaderCodes)];\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = this.firstResponse.appliedCoupons.map(element => element.voucherCode);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0])\n\t\t\t.then(() => this._getOrderSummary())\n\t\t\t.then(responseJSON => this._parseTotal(responseJSON));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\tlet requestWasBlocked = false;\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: false,\n\t\t\t\tfreeShipping: false,\n\t\t\t};\n\t\t\tif (!requestWasBlocked) {\n\t\t\t\treturn this._applyCode(code).then(response => {\n\t\t\t\t\t// if code invalid status will be 400, if code valid - 200\n\t\t\t\t\tif (response.status >= 400) {\n\t\t\t\t\t\trequestWasBlocked = response.status === 403;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this._getOrderSummary().then(orderSummary => {\n\t\t\t\t\t\tconst currentShipping = this._formShippingData(orderSummary);\n\t\t\t\t\t\t// there are no start shipping object if no shipping options was choosen by user\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tthis.startShipping &&\n\t\t\t\t\t\t\tcurrentShipping.body.deliveryModeId !== this.startShipping.body.deliveryModeId\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// if a code changed shipping mode\n\t\t\t\t\t\t\tthis.toRestoreShippng = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(orderSummary);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tresult.freeShipping = this._checkFreeShipping(orderSummary, code);\n\t\t\t\t\t\t// Some codes with 0 discount sometimes can't be applied\n\t\t\t\t\t\tresult.isValid = result.finalDiscount > 0 || (result.freeShipping && !this.toRestoreShippng);\n\n\t\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\t// mark codes as invalid if request was blocked\n\t\t\treturn bus.$emit('code-checked', result);\n\t\t});\n\t}\n\n\tasync beforeApplyCodes() {\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(this.DOMAIN);\n\t\tconst codeTestingCount = driverStorage ? driverStorage.codeTestingCount : 0;\n\t\tbackgroundMessaging.setDriverStorage(this.DOMAIN, {\n\t\t\tcodeTestingCount: codeTestingCount + 1,\n\t\t\tlastTestTimestamp: Date.now(),\n\t\t});\n\t\tconst newTabId = await backgroundMessaging.openNewTab({\n\t\t\turl: this.CART_URL,\n\t\t});\n\t\tif (!newTabId) {\n\t\t\t// New tab was not opened\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\treturn new Promise(resolve => {\n\t\t\t// if the cart is not closed after maximal time period the tab will be closed\n\t\t\tlet closeTabTimeout = setTimeout(() => {\n\t\t\t\tcloseTabTimeout = null;\n\t\t\t\tresolve();\n\t\t\t}, this.ADDITIONAL_TAB_TIMEOUT);\n\t\t\tchrome.runtime.onMessage.addListener(msg => {\n\t\t\t\tif (msg.tabClosed && msg.tabId === newTabId && closeTabTimeout) {\n\t\t\t\t\tclearTimeout(closeTabTimeout);\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t\t\t.then(() => this._getOrderSummary())\n\t\t\t.then(orderSummary => {\n\t\t\t\tif (this.toRestoreShippng && orderSummary.appliedCoupons.length) {\n\t\t\t\t\treturn this._removeCode(orderSummary.appliedCoupons[0].voucherCode).then(() =>\n\t\t\t\t\t\tthis._changeShipping(this.startShipping.body),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn Promise.resolve();\n\t\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]).then(response => {\n\t\t\t// try to apply code manually if request failed\n\t\t\tif (response.status >= 400) {\n\t\t\t\ttry {\n\t\t\t\t\treturn this._removeCodeManually()\n\t\t\t\t\t\t.then(() => Promise.delay(1000))\n\t\t\t\t\t\t.then(() => this._applyCodeManually(codes[0]))\n\t\t\t\t\t\t.then(async () => {\n\t\t\t\t\t\t\tawait wait(() => document.querySelector(this.APPLIED_CODE_SELECTOR));\n\t\t\t\t\t\t\t// don't reload page if code was applied manually\n\t\t\t\t\t\t\tbus.$emit('change-completion-action', completionActions.none);\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, {\n\t\t\t\t\t\tresponseStatus: response.status,\n\t\t\t\t\t\tcodes,\n\t\t\t\t\t});\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\tif (this.isPureTotal) {\n\t\t\treturn this._getOrderSummary().then(orderSummary => {\n\t\t\t\tconst total = toFloat(orderSummary.totalPriceWithTax.value);\n\t\t\t\t// if there is no 'Edit Shipping' button on the page then the related JSON path doesn't exist\n\t\t\t\tconst shippingCost = orderSummary.deliveryMode\n\t\t\t\t\t? toFloat(orderSummary.deliveryMode.deliveryCost.value)\n\t\t\t\t\t: 0;\n\t\t\t\tconst tax = toFloat(orderSummary.totalTax.value);\n\t\t\t\treturn total - tax - shippingCost;\n\t\t\t});\n\t\t}\n\t\treturn null;\n\t}\n\n\tasync _removeCodeManually() {\n\t\tif (document.querySelector(this.REMOVE_CODE_BTN_SELECTOR)) {\n\t\t\tconst isCodeRemoved = () => !(document.querySelector(this.REMOVE_CODE_BTN_SELECTOR) || {}).offsetParent;\n\t\t\tdocument.querySelector(this.REMOVE_CODE_BTN_SELECTOR).click();\n\t\t\tawait wait(isCodeRemoved, 10 * 1000, 300, true);\n\t\t\treturn this._removeCodeManually();\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t_applyCodeManually(code) {\n\t\treturn new Promise(async resolve => {\n\t\t\tconst promoLink = document.querySelector(this.ADD_PROMO_SELECTOR);\n\t\t\tif (promoLink) {\n\t\t\t\tpromoLink.click();\n\t\t\t}\n\t\t\tconst isInput = () => document.querySelector(this.INPUT_SELECTOR);\n\t\t\tawait wait(isInput);\n\t\t\tresolve();\n\t\t}).then(() => {\n\t\t\tsetValue(document.querySelector(this.INPUT_SELECTOR), code);\n\t\t\tdocument.querySelector(this.APPLY_BUTTON_SELECTOR).click();\n\t\t});\n\t}\n\n\t_removeCode(code) {\n\t\treturn request.delete(`${this.MANAGE_CODE_URL}/${code}?timestamp=${Date.now()}`, this.REQUEST_OPTIONS);\n\t}\n\n\t_applyCode(code, tryNumber = 0) {\n\t\tconst bodyData = JSON.stringify({\n\t\t\tvoucherId: code,\n\t\t});\n\t\treturn request\n\t\t\t.post(`${this.MANAGE_CODE_URL}?timestamp=${Date.now()}`, bodyData, this.REQUEST_OPTIONS)\n\t\t\t.then(response => {\n\t\t\t\t// Throw explicit error to stop codes testing in case we were blocked\n\t\t\t\tif (response.status > 400 && response.status !== 403 && tryNumber < this.MAX_TRY_NUMBER) {\n\t\t\t\t\treturn Promise.delay(1500)\n\t\t\t\t\t\t.then(() => this._getCart())\n\t\t\t\t\t\t.then(() => this._applyCode(code, tryNumber + 1));\n\t\t\t\t}\n\t\t\t\treturn response;\n\t\t\t});\n\t}\n\n\t_changeShipping(bodyData) {\n\t\tlog('Restoring a shipping method to the user defined one');\n\t\treturn request.put(\n\t\t\t`${this.RESTORE_SHIPPING_URL}?timestamp=${Date.now()}`,\n\t\t\tJSON.stringify(bodyData),\n\t\t\tthis.REQUEST_OPTIONS,\n\t\t);\n\t}\n\n\t_getOrderSummary(tryNumber = 0) {\n\t\tthis.queryStringGetPrice.set('timestamp', Date.now());\n\n\t\treturn request\n\t\t\t.get(`${this.REQUEST_URL}?${this.queryStringGetPrice.toString()}`, this.GET_REQUEST_OPTIONS)\n\t\t\t.then(response => {\n\t\t\t\t// get request not always returns with valid response (returns with status 400), so we have to send it again\n\t\t\t\t// the same behavior is during reloading page manualy, error appears on the page\n\t\t\t\tif (response.status >= 400 && tryNumber < this.MAX_TRY_NUMBER) {\n\t\t\t\t\treturn Promise.delay(1000).then(() => this._getOrderSummary(tryNumber + 1));\n\t\t\t\t}\n\t\t\t\treturn response.json();\n\t\t\t});\n\t}\n\n\t_updateToken() {\n\t\treturn request\n\t\t\t.get(`${this.TOKEN_URL}?products=&timestamp=${Date.now()}`, this.GET_REQUEST_OPTIONS)\n\t\t\t.then(response => response.json())\n\t\t\t.then(responseJson => {\n\t\t\t\tthis.REQUEST_OPTIONS.headers['x-csrf-token'] = responseJson.data.csrfToken;\n\t\t\t\tthis.REQUEST_OPTIONS.headers['x-fl-request-id'] = this.requestId;\n\t\t\t});\n\t}\n\n\t_getCart() {\n\t\treturn request.get(this.CART_URL);\n\t}\n\n\t_getCouponsSummary() {\n\t\t// request to the 'Coupon' section\n\t\treturn request\n\t\t\t.get(`${this.MERCHANT_CODE_URL}?products=&timestamp=${Date.now()}`, this.REQUEST_OPTIONS)\n\t\t\t.then(response => response.json());\n\t}\n\n\t_checkFreeShipping(responseJSON, code) {\n\t\treturn (\n\t\t\tthis.isOnCart() &&\n\t\t\t!!responseJSON.appliedOrderPromotions.find(\n\t\t\t\telement => element.promotion.code.includes(code) && this.FREE_SHIPPING_REGEX.test(element.description),\n\t\t\t)\n\t\t);\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\t// there are different paths for the cart and the checkout in the response\n\t\t\tconst total = toFloat(\n\t\t\t\tthis.isOnCart() ? data.totalPrice.formattedValue : data.totalPriceWithTax.formattedValue,\n\t\t\t);\n\t\t\t// in case of changes of shipping cost\n\t\t\tconst startShippingValue = this.startShipping ? this.startShipping.shippingCost : 0;\n\t\t\tconst currentShippingCost = this.startShipping ? this._formShippingData(data).shippingCost : 0;\n\t\t\tif (this.startShipping && this.startShipping.body.deliveryModeId === data.deliveryMode.code) {\n\t\t\t\treturn total;\n\t\t\t}\n\t\t\treturn total - currentShippingCost + startShippingValue;\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n\n\t_formShippingData(responseJson) {\n\t\t// Free shipping has `responseJson.deliveryMode` but doesn't have 'responseJson.deliveryAddress'\n\t\t// If it is chosen any country except USA then `responseJson.deliveryAddress.region` does not exist\n\t\treturn responseJson.deliveryMode && responseJson.deliveryAddress\n\t\t\t? {\n\t\t\t\t\tshippingCost: toFloat(responseJson.deliveryMode.deliveryCost.value),\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tdeliveryModeId: responseJson.deliveryMode.code,\n\t\t\t\t\t\tcountryCode: responseJson.deliveryAddress.region\n\t\t\t\t\t\t\t? responseJson.deliveryAddress.region.countryIso\n\t\t\t\t\t\t\t: responseJson.deliveryAddress.country.isocode,\n\t\t\t\t\t\tstateCode: responseJson.deliveryAddress.region\n\t\t\t\t\t\t\t? responseJson.deliveryAddress.region.isocodeShort\n\t\t\t\t\t\t\t: '',\n\t\t\t\t\t},\n\t\t\t  }\n\t\t\t: // return null if no shipping options was chosen by user\n\t\t\t  null;\n\t}\n}\n","import FootlockerDriver from './_base';\nimport { completionActions } from '../../../utils';\n\n/*\nBehavior description:\nthe same as in the _base.js\n+ Gather codes on site pages: yes\n*/\nconst BASE_URL = 'https://www.champssports.com';\n\nconst Driver = class Driver extends FootlockerDriver {\n\tconstructor() {\n\t\tsuper(BASE_URL);\n\t\tthis.DOMAIN = 'champssports.com';\n\t\tthis.isMerchantCodes = true;\n\t\tthis.toSupportCheckout = false;\n\t\tthis.isPureTotal = true;\n\t}\n};\n\nexport default {\n\tname: 'Champssports',\n\tdomain: 'champssports.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tmaxCoupons: 2, // to avoid blocking\n\tisSinglePageApp: true,\n};\n","import DriverTemplate from './_base';\nimport { completionActions } from '../../../utils';\n\n/*\nBehavior description:\nthe same as in the _base.js\n*/\nconst BASE_URL = 'https://www.eastbay.com';\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper(BASE_URL);\n\t\tthis.DOMAIN = 'eastbay.com';\n\t\tthis.isMerchantCodes = true;\n\t\tthis.isPureTotal = true;\n\t}\n};\n\nexport default {\n\tname: 'Eastbay',\n\tdomain: 'eastbay.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tmaxCoupons: 2, // to avoid blocking\n\tisSinglePageApp: true,\n};\n","import FootlockerDriver from './_base';\nimport { completionActions } from '../../../utils';\n\n/*\nBehavior description:\nthe same as in the _base.js\n+ Gather codes on site pages: yes\n*/\n\nconst BASE_URL = 'https://www.footaction.com';\nconst Driver = class Driver extends FootlockerDriver {\n\tconstructor() {\n\t\tsuper(BASE_URL);\n\t\tthis.DOMAIN = 'footaction.com';\n\t\tthis.isMerchantCodes = true;\n\t\tthis.toSupportCheckout = false;\n\t\tthis.isPureTotal = true;\n\t}\n};\n\nexport default {\n\tname: 'Footaction',\n\tdomain: 'footaction.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tmaxCoupons: 2, // to avoid blocking\n\tisSinglePageApp: true,\n};\n","import FootlockerDriver from './_base';\nimport { completionActions } from '../../../utils';\n\n/*\nBehavior description:\nthe same as in the _base.js\n*/\nconst BASE_URL = 'https://www.footlocker.ca';\nconst Driver = class Driver extends FootlockerDriver {\n\tconstructor() {\n\t\tsuper(BASE_URL);\n\t\tthis.toSupportCheckout = false;\n\t\tthis.CART_URL = `${this.BASE_URL}/cart`;\n\t\tthis.CHECKOUT_URL = `${this.BASE_URL}/checkout`;\n\t\tthis.isOnCart = () => window.location.href.includes(BASE_URL) || window.location.href.includes('cart');\n\t\tthis.isOnCheckout = () => window.location.href.includes(BASE_URL) || window.location.href.includes('checkout');\n\t\tthis.DOMAIN = 'footlocker.ca';\n\t}\n};\n\nexport default {\n\tname: 'Footlocker Canada',\n\tdomain: 'footlocker.ca',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tmaxCoupons: 2, // to avoid blocking\n\tisSinglePageApp: true,\n};\n","import FootlockerDriver from './_base';\nimport { completionActions } from '../../../utils';\n\n/*\nBehavior description:\nthe same as in the _base.js\n+ Gather codes on site pages: yes\n*/\nconst BASE_URL = 'https://www.footlocker.com';\nconst Driver = class Driver extends FootlockerDriver {\n\tconstructor() {\n\t\tsuper(BASE_URL);\n\t\tthis.DOMAIN = 'footlocker.com';\n\t\tthis.isMerchantCodes = true;\n\t\tthis.toSupportCheckout = false;\n\t\tthis.isPureTotal = true;\n\t}\n};\n\nexport default {\n\tname: 'Footlocker',\n\tdomain: 'footlocker.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tmaxCoupons: 2, // to avoid blocking\n\tisSinglePageApp: true,\n};\n","import champssports from './champssports.com';\nimport eastbay from './eastbay.com';\nimport footaction from './footaction.com';\nimport footlockerCa from './footlocker.ca';\nimport footlocker from './footlocker.com';\nimport kidsfootlocker from './kidsfootlocker.com';\nimport ladyfootlocker from './ladyfootlocker.com';\n\nexport default [champssports, eastbay, footaction, footlockerCa, footlocker, kidsfootlocker, ladyfootlocker];\n","import FootlockerDriver from './_base';\nimport { completionActions, DOM } from '../../../utils';\n\nconst { extractData } = DOM;\n\n/*\nBehavior description:\nthe same as in the _base.js\n*/\nconst BASE_URL = 'https://www.kidsfootlocker.com';\nconst Driver = class Driver extends FootlockerDriver {\n\tconstructor() {\n\t\tsuper(BASE_URL);\n\t\tthis.DOMAIN = 'kidsfootlocker.com';\n\t\tthis.toSupportCheckout = false;\n\t\tthis.isMerchantCodes = true;\n\t\tthis.MERCHANT_CODE_SELECTOR = '.CouponCard-code';\n\t\tthis.MERCHANT_CODE_REGEX = /[^ ]*$/;\n\t\tthis.isPureTotal = true;\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst merchantHeaderCodes = [...document.querySelectorAll(this.MERCHANT_HEADER_CODE_SELECTOR)]\n\t\t\t.map(element => element.innerText.match(this.MERCHANT_HEADER_CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(codeMatch => codeMatch[2]);\n\t\treturn this._getCouponsSummary().then(responseHTML => {\n\t\t\tconst codes = extractData(this.MERCHANT_CODE_SELECTOR, responseHTML, true)\n\t\t\t\t.map(element => element.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(element => element[0]);\n\t\t\treturn [...new Set([...codes, ...merchantHeaderCodes])];\n\t\t});\n\t}\n\n\t_getCouponsSummary() {\n\t\t// request to the 'Coupon' section\n\t\treturn fetch(`${this.BASE_URL}/coupons.html`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Kidsfootlocker',\n\tdomain: 'kidsfootlocker.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tmaxCoupons: 2, // to avoid blocking\n\tisSinglePageApp: true,\n};\n","import FootlockerDriver from './_base';\nimport { completionActions } from '../../../utils';\n\n/*\nBehavior description:\nthe same as in the _base.js\n*/\nconst BASE_URL = 'https://www.ladyfootlocker.com';\nconst Driver = class Driver extends FootlockerDriver {\n\tconstructor() {\n\t\tsuper(BASE_URL);\n\t\tthis.DOMAIN = 'ladyfootlocker.com';\n\t\tthis.toSupportCheckout = false;\n\t}\n};\n\nexport default {\n\tname: 'Ladyfootlocker',\n\tdomain: 'ladyfootlocker.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tmaxCoupons: 2, // to avoid blocking\n\tisSinglePageApp: true,\n};\n"],"sourceRoot":""}