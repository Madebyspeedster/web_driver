{"version":3,"sources":["webpack:///./src/inject/drivers/base.js","webpack:///./src/inject/drivers/demandware/_base.js","webpack:///./src/inject/drivers/demandwareAJAX/_base.js","webpack:///./src/inject/drivers/demandwareAJAX/aeropostale.com.js","webpack:///./src/inject/drivers/demandwareAJAX/agacistore.com.js","webpack:///./src/inject/drivers/demandwareAJAX/americantourister.com.js","webpack:///./src/inject/drivers/demandwareAJAX/ardene.com.js","webpack:///./src/inject/drivers/demandwareAJAX/artvan.com.js","webpack:///./src/inject/drivers/demandwareAJAX/ashleystewart.com.js","webpack:///./src/inject/drivers/demandwareAJAX/avenue.com.js","webpack:///./src/inject/drivers/demandwareAJAX/bathandbodyworks.com.js","webpack:///./src/inject/drivers/demandwareAJAX/bcbg.com.js","webpack:///./src/inject/drivers/demandwareAJAX/bobstores.com.js","webpack:///./src/inject/drivers/demandwareAJAX/boohoo.com.js","webpack:///./src/inject/drivers/demandwareAJAX/boohooman.com.js","webpack:///./src/inject/drivers/demandwareAJAX/boxlunch.com.js","webpack:///./src/inject/drivers/demandwareAJAX/carolsdaughter.com.js","webpack:///./src/inject/drivers/demandwareAJAX/christopherandbanks.com.js","webpack:///./src/inject/drivers/demandwareAJAX/claires.com.js","webpack:///./src/inject/drivers/demandwareAJAX/clubmonaco.com.js","webpack:///./src/inject/drivers/demandwareAJAX/coldwatercreek.com.js","webpack:///./src/inject/drivers/demandwareAJAX/columbia.com.js","webpack:///./src/inject/drivers/demandwareAJAX/crabtree-evelyn.com.js","webpack:///./src/inject/drivers/demandwareAJAX/destinationmaternity.com.js","webpack:///./src/inject/drivers/demandwareAJAX/donaldpliner.com.js","webpack:///./src/inject/drivers/demandwareAJAX/dwr.com.js","webpack:///./src/inject/drivers/demandwareAJAX/elfcosmetics.com.js","webpack:///./src/inject/drivers/demandwareAJAX/elizabetharden.com.js","webpack:///./src/inject/drivers/demandwareAJAX/exofficio.com.js","webpack:///./src/inject/drivers/demandwareAJAX/foodsaver.com.js","webpack:///./src/inject/drivers/demandwareAJAX/fullbeauty.com.js","webpack:///./src/inject/drivers/demandwareAJAX/glassesusa.com.js","webpack:///./src/inject/drivers/demandwareAJAX/gnc.com.js","webpack:///./src/inject/drivers/demandwareAJAX/hannaandersson.com.js","webpack:///./src/inject/drivers/demandwareAJAX/harley-davidsonfootwear.com.js","webpack:///./src/inject/drivers/demandwareAJAX/hickoryfarms.com.js","webpack:///./src/inject/drivers/demandwareAJAX/hottopic.com.js","webpack:///./src/inject/drivers/demandwareAJAX/hugoboss.com.js","webpack:///./src/inject/drivers/demandwareAJAX/hushpuppies.com.js","webpack:///./src/inject/drivers/demandwareAJAX/index.js","webpack:///./src/inject/drivers/demandwareAJAX/intermixonline.com.js","webpack:///./src/inject/drivers/demandwareAJAX/itcosmetics.com.js","webpack:///./src/inject/drivers/demandwareAJAX/jessicalondon.com.js","webpack:///./src/inject/drivers/demandwareAJAX/johnhardy.com.js","webpack:///./src/inject/drivers/demandwareAJAX/johnvarvatos.com.js","webpack:///./src/inject/drivers/demandwareAJAX/katespade.com.js","webpack:///./src/inject/drivers/demandwareAJAX/keds.com.js","webpack:///./src/inject/drivers/demandwareAJAX/kiehls.com.js","webpack:///./src/inject/drivers/demandwareAJAX/kingsize.com.js","webpack:///./src/inject/drivers/demandwareAJAX/kingsizedirect.com.js","webpack:///./src/inject/drivers/demandwareAJAX/kipling-usa.com.js","webpack:///./src/inject/drivers/demandwareAJAX/lacoste.com.js","webpack:///./src/inject/drivers/demandwareAJAX/lancome-usa.com.js","webpack:///./src/inject/drivers/demandwareAJAX/lifeisgood.com.js","webpack:///./src/inject/drivers/demandwareAJAX/loralette.com.js","webpack:///./src/inject/drivers/demandwareAJAX/lumens.com.js","webpack:///./src/inject/drivers/demandwareAJAX/madewell.com.js","webpack:///./src/inject/drivers/demandwareAJAX/marmot.com.js","webpack:///./src/inject/drivers/demandwareAJAX/melissaanddoug.com.js","webpack:///./src/inject/drivers/demandwareAJAX/merrell.com.js","webpack:///./src/inject/drivers/demandwareAJAX/michaels.com.js","webpack:///./src/inject/drivers/demandwareAJAX/modcloth.com.js","webpack:///./src/inject/drivers/demandwareAJAX/modells.com.js","webpack:///./src/inject/drivers/demandwareAJAX/motherhood.com.js","webpack:///./src/inject/drivers/demandwareAJAX/mountainhardwear.com.js","webpack:///./src/inject/drivers/demandwareAJAX/mrcoffee.com.js","webpack:///./src/inject/drivers/demandwareAJAX/nastygal.com.js","webpack:///./src/inject/drivers/demandwareAJAX/nautica.com.js","webpack:///./src/inject/drivers/demandwareAJAX/neutrogena.com.js","webpack:///./src/inject/drivers/demandwareAJAX/newbalance.com.js","webpack:///./src/inject/drivers/demandwareAJAX/nixon.com.js","webpack:///./src/inject/drivers/demandwareAJAX/oster.com.js","webpack:///./src/inject/drivers/demandwareAJAX/otterbox.com.js","webpack:///./src/inject/drivers/demandwareAJAX/pacificcoast.com.js","webpack:///./src/inject/drivers/demandwareAJAX/pacsun.com.js","webpack:///./src/inject/drivers/demandwareAJAX/parkerny.com.js","webpack:///./src/inject/drivers/demandwareAJAX/partycity.com.js","webpack:///./src/inject/drivers/demandwareAJAX/paulaschoice.com.js","webpack:///./src/inject/drivers/demandwareAJAX/pendleton-usa.com.js","webpack:///./src/inject/drivers/demandwareAJAX/perriconemd.com.js","webpack:///./src/inject/drivers/demandwareAJAX/peterthomasroth.com.js","webpack:///./src/inject/drivers/demandwareAJAX/petsmart.com.js","webpack:///./src/inject/drivers/demandwareAJAX/pier1.com.js","webpack:///./src/inject/drivers/demandwareAJAX/ragbone.com.js","webpack:///./src/inject/drivers/demandwareAJAX/ralphlauren.com.js","webpack:///./src/inject/drivers/demandwareAJAX/rebeccataylor.com.js","webpack:///./src/inject/drivers/demandwareAJAX/redcross.org.js","webpack:///./src/inject/drivers/demandwareAJAX/roamans.com.js","webpack:///./src/inject/drivers/demandwareAJAX/rockport.com.js","webpack:///./src/inject/drivers/demandwareAJAX/sallybeauty.com.js","webpack:///./src/inject/drivers/demandwareAJAX/shop.samsonite.com.js","webpack:///./src/inject/drivers/demandwareAJAX/shop.scholastic.com.js","webpack:///./src/inject/drivers/demandwareAJAX/slumberland.com.js","webpack:///./src/inject/drivers/demandwareAJAX/sonos.com.js","webpack:///./src/inject/drivers/demandwareAJAX/southmoonunder.com.js","webpack:///./src/inject/drivers/demandwareAJAX/speckproducts.com.js","webpack:///./src/inject/drivers/demandwareAJAX/store.crossfit.com.js","webpack:///./src/inject/drivers/demandwareAJAX/surfstitch.com.js","webpack:///./src/inject/drivers/demandwareAJAX/surlatable.com.js","webpack:///./src/inject/drivers/demandwareAJAX/talbots.com.js","webpack:///./src/inject/drivers/demandwareAJAX/tartecosmetics.com.js","webpack:///./src/inject/drivers/demandwareAJAX/taylormadegolf.com.js","webpack:///./src/inject/drivers/demandwareAJAX/teva.com.js","webpack:///./src/inject/drivers/demandwareAJAX/tillys.com.js","webpack:///./src/inject/drivers/demandwareAJAX/timex.com.js","webpack:///./src/inject/drivers/demandwareAJAX/torrid.com.js","webpack:///./src/inject/drivers/demandwareAJAX/trinaturk.com.js","webpack:///./src/inject/drivers/demandwareAJAX/truereligion.com.js","webpack:///./src/inject/drivers/demandwareAJAX/ugg.com.js","webpack:///./src/inject/drivers/demandwareAJAX/uniqlo.com.js","webpack:///./src/inject/drivers/demandwareAJAX/us.puma.com.js","webpack:///./src/inject/drivers/demandwareAJAX/verabradley.com.js","webpack:///./src/inject/drivers/demandwareAJAX/vince.com.js","webpack:///./src/inject/drivers/demandwareAJAX/vineyardvines.com.js","webpack:///./src/inject/drivers/demandwareAJAX/vitaminworld.com.js","webpack:///./src/inject/drivers/demandwareAJAX/wolverine.com.js","webpack:///./src/inject/drivers/demandwareAJAX/womanwithin.com.js","webpack:///./src/inject/drivers/demandwareAJAX/ylighting.com.js","webpack:///./src/inject/drivers/demandwareAJAX/yliving.com.js"],"names":["toFloat","format","BaseDriver","watchForRestoreUserData","time","pauseInterval","interval","setInterval","currentState","checkRestoreDataCondition","clearInterval","bus","$emit","e","handleDriverError","source","storeUserData","domain","userData","getUserData","Promise","resolve","userDataKey","getUserDataStorageKey","storageRecord","storedTime","Date","now","backgroundMessaging","setDriverStorage","log","restoreUserData","maxStorageLifetime","driverStorage","getDriverStorage","deleteDriverStorage","setUserData","getStartPrice","startPrice","Number","MAX_SAFE_INTEGER","totalElementConfig","TOTAL_ELEMENT_CONFIG","selector","attribute","regex","totalElement","Array","isArray","forEach","elemSelector","document","querySelector","Error","value","getAttribute","textContent","pattern","group","match","beforeTestCodes","beforeCheckCodes","beforeApplyCodes","checkCodes","applyCodes","stackCodes","removeCodes","getMerchantCodes","getExistingCodes","codes","codeCount","getPreTaxShippingTotal","watchForCartUrl","previousState","checkCondition","completeExperience","completeExperiencePromisified","args","_promisify","beforeTestCodesPromisified","getStartPricePromisified","getMerchantCodesPromisified","getExistingCodesPromisified","removeCodesPromisified","beforeApplyCodesPromisified","applyCodesPromisified","beforeCheckCodesPromisified","checkCodesPromisified","stackCodesPromisified","method","then","apply","elemToFloat","extractFormValues","extractElement","DOM","DemandwareDriver","constructor","TOTAL_SELECTOR","PRODUCT_ITEM_SELECTOR","CODES_ELEMENTS_SELECTOR","CODE_VALUE_SELECTOR","CART_FORM_SELECTOR","DEFAULT_REMOVE_CODE_VALUE","REMOVE_CODE_SELECTOR","REMOVE_VALUE_ATTRIBUTE","REQUEST_HEADERS","Accept","REQUEST_PARAMS","COUPON_PARAM_NAME","ADD_COUPON_PARAM_NAME","ADD_COUPON_PARAM_VALUE","REMOVE_COUPON_PARAM_VALUE","ERROR_MESSAGE_SELECTOR","isStackable","applyCode","_requestData","originalPrice","parseTotal","lastResponse","originalItemsCount","parseItemsCount","workingDiscounts","each","code","html","result","finalPrice","finalDiscount","freeGifts","isValid","_codeAppliedCheck","push","removeCode","_removeValueName","removeCodeHtml","map","discount","discounts","Set","querySelectorAll","element","innerText","trim","size","validationInfo","sort","a","b","currentPrice","currentDiscount","currentFreeGifts","successfulCodes","codesElements","matchingCodesElement","find","codesElement","manageCode","requestData","fetch","action","body","params","credentials","headers","response","text","set","removeValueName","length","data","extractElementFromHTML","DemandwareAJAXDriver","APPLY_CODE_URL","REMOVE_CODE_URL","UPDATE_REQUEST_URL","APPLIED_CODES_SELECTOR","APPLY_CODE_PARAM_NAME","REMOVE_CODE_PARAM_NAME","CART_PAGE_URL","APPLY_REQUEST_HEADERS","REMOVE_REQUEST_HEADERS","UPDATE_REQUEST_HEADERS","applyQueryParams","URLSearchParams","removeQueryParams","updateQueryParams","APPLY_RESPONSE_KEY","APPLY_RESPONSE_COMPARE_SUCCESS_VALUE","REAPPLY_CODES_WHILE_STACKING","applyCodeResponse","successState","_getValueFromJSON","getOrderSummary","orderSummary","_isOnCartPage","documentElement","innerHTML","getCartPage","appliedCodesSelector","responseHTML","_sendRequestGET","removeCodeOnCart","removeParamName","_getRemoveValueName","removeRequestData","_sendRequestPOST","requestURL","queryParams","_sendRequest","bodyData","finalRequestURL","toString","JSON","parse","json","Object","prototype","hasOwnProperty","call","toLowerCase","name","window","location","href","startsWith","DOMAIN","BASE_REQUEST_URL","BASE_CART_REQUEST_URL","BASE_CHECKOUT_REQUEST_URL","isCart","includes","Driver","CODE_INPUT_SELECTOR","SHIPPING_SELECTOR","SHIPPING_DISCOUNT_SELECTOR","TAX_SELECTOR","CODE_CONTAINER_SELECTOR","CODE_REGEX","LOADER_SELECTOR","CART_EMPTY_SELECTOR","SHIPPING_PICKUP","SHIPPING_OPTIONS_SELECTOR","SELECTED_SHIPPING","SHIPPING_WRAPPER_SELECTOR","cartEmptyMsg","isRightUrl","isCartEmpty","isLoader","offsetParent","codeInputEl","_getPromoPage","filter","el","Boolean","shipping","shippingDiscountEl","shippingDiscount","tax","_isShippingOptionsElement","readyState","shippingOrPickUpElement","checked","checkedShippingElement","shippingOrPickUpSelector","shippingSelector","click","delay","promise","_setShipping","_getTotals","stackable","isSinglePageApp","cartContinueUrl","CHECKOUT_INPUT","APPLIED_CODES_SELECTOR_ON_CHECKOUT","APPLIED_CODES_SELECTOR_ON_CART","APPLIED_CODE_REGEX","BASE_URL","CHECKOUT_SHIP_ELEM","checkoutShipElem","style","opacity","disabled","checkoutCodeEl","checkoutCodes","nextElementSibling","isOnCartUrl","CHECKOUT_PAGE_URL","BILLING_PAGE_URL","APPLY_COUPON_FLD_SELECTOR","IS_ON_CART","TOTAL_CART_SELECTOR","PROPOSED_CODE_SELECTOR","CHECKOUT_BUTTON_SELECTOR","SUCCESS_MESSAGE_SELECTOR","_getUpdatedCart","completionAction","completionActions","revisit","codeElement","FIRST_CART_URL","SECOND_CART_URL","WISHLIST_URL","PAGES","EMPTY_SELECTOR","accept","APPLY_BUTTON_SELECTOR","sessionTimer","initialize","actionInterval","timeout","isTotal","isEmpty","isInput","some","page","getSummaryValue","total","APPLIED_COUPON_SELECTOR","HAVE_PROMO_CODE_BUTTON_SELECTOR","COUNT_EL_SELECTOR","EXTRA_CART_ELEMENT_SELECTOR","MERCHANT_PROMO_SELECTOR","MERCHANT_PROMO_REGEX","CODE_FORM_SELECTOR","ACTIVE_PAYMENT_SELECTOR","isOnHref","cartForm","countEl","isPayment","arr","split","history","replaceState","state","title","taxes","calculatedShipping","isOnCart","_getExistingCodes","MERCHANT_CODE_SELECTOR","MERCHANT_CODE_REGEX","sendXhr","RegularDwDriver","DwDriver","DWBaseDriver","IS_ON_CHECKOUT","BILLING_SECTION","SAME_TO_SHIIPING_SELECTOR","LOGIN_SECTION","ORDER_SUMMARY_ACTIVE","SHIPPING_ACTIVE","codeInput","onCart","isBilling","isSameToShipping","isLogin","isOrderSummary","isShipping","CART_INPUT","CHECKOUT_FORM_SELECTOR","CODE_INPUTS_SELECTOR","isCodeInput","APPLIED_CODE_SELECTOR","dataset","coupon","taxEl","CART_SUMMARY_SELECTOR","shippingDiscountElem","shippingElem","isOnCartPage","REMOVE_SELECTOR","MAX_WAIT_TIME","TIME_STEP","CODE_REMOVE_BTN_SELECTOR","CODE_ELEM_SELECTOR","EMPTY_CART_SELECTOR","isOnCheckout","checkoutCouponForm","totalElem","emptyCart","extractData","MERCHANT_URL","REMOVE_PARAMS","SHIPPING_STEP_SELECTOR","CHARGES_REGEX","CHARGES_SELECTOR","CSRF_TOKEN_SELECTOR","isShippingStep","csrfToken","reduce","item","cartStr","parentElement","charges","charge","CHECKOUT_INPUT_SELECTOR","MERCHANT_CODES_SELECTOR","MERCHANT_CODES_REGEX","DELIVERY_REGEX","success","chargesElem","allTaxes","delivery","header","path","pathname","errorPage","hrefLowerCase","REVIEW_PAGE_URL","isOnReview","SPINNER_SELECTOR","isOnRightUrl","isSpinner","isItemInCart","DOMAIN_URL","DOMAIN_CART_URL","CHECKOUT_INPUT_CODE_FLD","CART_INPUT_CODE_FLD","INPUT_CODE_FLD","APPLIED_CODES_REGEX","CHECKOUT_APPLY_BTN_SELECTOR","CHECKOUT_CODE_MESSAGE_SELECTOR","codesRegex","remove","APPLY_CODE_BUTTON_SELECTOR","CART_CODE_INPUT_SELECTOR","CHECKOUT_CODE_INPUT_SELECTOR","PAYMENT_STEP_SELECTOR","CONTAINER_SELECTOR","promoInputVisible","transaction","errorMessage","taxElem","elem","calculatedTax","toUpperCase","DOMAIN_CHECKOUT_URL","INPUT_CODE_FLD_SELECTOR","INPUT_CODE_BLOCK_SELECTOR","URLS","DISCOUNT_SELECTOR","CHECKOUT_BTN_SELECTOR","_removeCodes","isDiscountElement","resonseHTML","url","_continueUrl","CART_MERCHANT_CODES_ELEM_SELECTOR","MAIN_PAGE_MERCHANT_CODES_ELEM_SELECTOR","res","cartPageCodesElem","cartCode","mainPageCodes","enableFreeGiftsWarning","BASE_SITE_URL","shippingEl","emptyElem","getRandomInt","getCookie","browserUtils","checkingVersion","CART_URL","_getMerchantCodes","alt","DriverDemandwareAjax","INPUT_CODE_SELECTOR","APPLY_BTN_SELECTOR","ERROR_MSG_SELECTOR","REMOVE_ATTRIBUTE_SELECTOR","inputField","codeValue","_getUpdatedCheckout","UUID","_getRemoveParam","errorMsg","SHOPING_BAG_URL","CHECKOUT_URL","DriverBase","PREFIX_NAME","CART_PREFIX","formData","FORM_SELECTOR","LOGIN_STEP_SELECTOR","ERROR_SELECTOR","isCodeInputEl","isOnLoginStep","currenState","replace","_removeCode","_parseTotal","_applyCode","_isValidCode","queryUrl","stringify","PromotionCode","_manageCode","delete","_getHeaders","ApplyPromotions","SuccessText","Code","responseJSON","OrderTotal","FinalSubTotal","CODE_SELECTOR","CODE_REGEXP","isCodeInputElement","isCartEmptyElement","totals","shippingPrice","objJSON","MERCHANT_DOMAIN","SIDE_CART_SELECTOR","OPEN_SIDE_CART_BTN_SELECTOR","isSideCartOpen","codeInputSelector","sideCartCodeTesting","BASE_API_URL","TAX_VALUE_SELECTOR","SHIPPING_VALUE_SELECTOR","correctHrefs","correctPage","hrefPart","totalRendered","_getCart","IsOnCheckout","APPLY_CODE_URL_CHECKOUT","REMOVE_CODE_URL_CHECKOUT","SELECTED_SHIPPING_SELECTOR","EXISTING_CODE_SELECTOR","EXISTING_CODE_SELECTOR_CHECKOUT","EXISTING_CODE_REGEX","PROMO_INPUT_SELECTOR","isCorrectURL","isInputPresent","EXISTING_CODE_EXIST","CSRF_TOKEN","_getWindowObjectData","shippingMethodElem","shippingMethodValue","id","originPrice","undefined","cart","orderTotal","variableString","requestDataElement","createElement","assign","display","appendChild","requestDataScript","parentNode","removeChild","showDifferentDiscountMessage","isOnBilling","endsWith","isBillingForm","isCodeUnappplied","_getOrderSummary","count","CART_PRODUCT_ITEM_SELECTOR","ITEM_PRICE_SELECTOR","DONATION_SELECTOR","ON_CART_SELECTOR","ON_CHECKOUT_SELECTOR","from","donation","itemEl","donationEl","cur","prev","setCookie","setValue","_getPage","isOnPaymentStep","CartDriver","APPLIED_CODE_BUTTON_SELECTOR","APPLIED_CODE_INPUT_SELECTOR","SIDEBAR_CART_SELECTOR","SIDEBAR_CART_BUTTON","isGenieUsed","sidebarWithCart","isItemOnPage","btnSidebarOpen","tokenElem","applyCodeManually","codeInputElm","codeApplyBtn","none","default","baseUrl","aeropostale","agacistore","americantourister","ardene","artvan","ashleystewart","avenue","bathandbodyworks","bcbg","bobstores","boohoo","boohooman","boxlunch","carolsdaughter","christopherandbanks","claires","clubmonaco","coldwatercreek","columbia","crabtree","destinationmaternity","donaldpliner","dwr","elfcosmetics","elizabetharden","exofficio","foodsaver","fullbeauty","glassesusa","gnc","hannaandersson","harleyDavidsonfootwear","hickoryfarms","hottopic","hugoboss","hushpuppies","intermixonline","itcosmetics","jessicalondon","johnhardy","johnvarvatos","katespade","keds","kiehls","kingsize","kingsizedirect","kipling","lacoste","lancomeUsa","lifeisgood","loralette","lumens","madewell","marmot","melissaanddoug","merrell","michaels","modcloth","modells","motherhood","mountainhardwear","mrcoffee","nastygal","nautica","neutrogena","newbalance","nixon","oster","otterbox","pacificcoast","pacsun","parkerny","partycity","paulaschoice","pendletonUsa","perriconemd","peterthomasroth","petsmart","pier1","ragbone","puma","ralphlauren","rebeccataylor","redcross","roamans","rockport","sallybeauty","samsonite","scholastic","slumberland","sonos","southmoonunder","speckproducts","crossfit","surfstitch","surlatable","talbots","tartecosmetics","taylormadegolf","teva","tillys","timex","torrid","trinaturk","truereligion","ugg","uniqlo","verabradley","vince","vineyardvines","vitaminworld","wolverine","wonamwithin","ylighting","yliving","test","INPUT_SELECTOR","REVIEW_SELECTOR","ICON_SELECTOR","FIRST_STEP_SELECTOR","HIDDEN_TAX_SELECTOR","cartPage","isOnFirstStep","taxValue","hiddenTax","classList","contains","isTaxValue","shippingValue","isShippingValue","isNaN","totalValue","COUPONS_PAGE_URL","_getCouponsPage","responseSammary","cartResponse","idElement","couponId","toInt","COUNT_ITEM_SELECTOR","INPUT_DISABLED_SELECTOR","TOTAL_REG","EXISTING_CODE_REG","isInputDisabled","lastCode","_manuallyCodeApply","codeBtn","custom","REG_EXP","REG_TOKEN","NOT_SHIPPING_STEP_SELECTOR","SHIPPING_FORM_FILLED_SELECTOR","OUT_OF_STOCK_SELECTOR","isEmptyCartEl","itemOutOfStockEl","isNotShipping","token","SURPRISE","NO_TAX_SELECTOR","MERCHANT_CODE_IMAGE","MERCHANT_CODE_REGEXP","BASE_SURPRIZE_URL","mainPageURL","pushState","noTax","OFFER_PROMO_SELECTOR","OFFER_PROMO_REGEX","SHIPPING_TYPE_SELECTOR","PRODUCT_ITEM_GIFT_SELECTOR","GET_PRODUCT_REQUEST_URL","ADD_PRODUCT_REQUEST_URL","UPDATE_CART_REQUEST_URL","SHIPPING_REQUEST_URL","GET_OFFER_PAGE_REQUEST_URL","type","SHIPPING_DISCOUNT_VALUE_SELECTOR","ORDER_SUB_TOTAL_SELECTOR","GIFT_SCRIPT_SELECTOR","PRODUCT_PID_SELECTOR","PRODUCT_PID_REG","PROMO_MAX_ITEM_COUNT_SELECTOR","PROMO_MAX_ITEM_COUNT_REG","subTotalEl","isSubTotalNotZero","_getOfferPage","offerCodes","cartPageCodes","_getCartPage","extraItemsCount","_checkAndApplyGiftsFromPopup","estimatedTotal","shippingAmount","_shippingRequest","shippingMethodID","_extraGiftsIdAfterApply","scriptTextContent","scriptObject","bonusItemId","_getExtraGiftsFromPopupRequest","extraGiftsId","bonusDiscountLineItemUUID","_getProductPID","promoMaxItemCountEl","maxSelectedItemCount","slice","itemId","_addExtraGiftsFromPopupRequest","personalizationFlow","extraGiftsHTML","extraGiftsPID","bonusproducts","product","options","pid","productName","qty","HOME_URL","lastCartPage","shippingElement","shippingDiscountElement","taxElement","INPUT_BILLING_CODE","CART_INPUT_SELECTOR","isCheckout","LOGIN_USER_SELECTOR","CODES_INPUTS_SELECTORS","isOnCheckoutPage","inputExistsBefore","intervalId","checkoutCodeInput","inputStateChanged","isOnCartOrCheckout","PRICE_SELECTOR","ITEM_SELECTOR","ITEM_NAME_SELECTOR","DONATION_REGEX","_findDonationEl","targetEl","skuEl","REMOVE_CODE_BUTTON_SELECTOR","APPLY_CODE_INPUT_SELECTOR","CART_COUPON_FORM","cartCouponForm","require","BASE_URL_REQUEST_URL","PROMO_CODES_URL","merchantCodes","_getPromoCodesPage","merchantCode","BASE_CART_URL","PAGE_TOTAL_SELECTOR","onCheckout","secureCheckoutLink","secureCheckoutForm","_getHomePageHTML","CHECKOUT_PAGE_URLS","CODE_FIELD_SELECTOR","emptyCartMsg","COUPON_BOX_SELECTOR","COUPON_BOX_VALUE","_getMerchantCoupons","promoCodes","_findValueByLabel","label","MAIN_URL","isCodeAppliedOnCheckout","VALUE_SELECTOR","ROW_SELECTOR","BILLING_STEP_SELECTOR","PRE_TAX_SHIPPING_REGEX","isUsa","CouponCode","couponID","string","shippingCost","adjustedMerchandizeCost","maxCoupons","APPLY_CODES_SELECTOR","CODE_REGEX_CART","CODE_REGEX_CHECKOUT","isCodeInputElem","codeRegex","OUTCLICK_TAB_CLOSE_TIMEOUT","cartEmpty","cartCodeInput","paymentStep","_watchForOutclickTab","chrome","runtime","onMessage","addListener","msg","tabClosed","setTimeout","PROMO_INPUT_SELECTOR_CART","PROMO_INPUT_SELECTOR_CHECKOUT","PROMO_BTN_SELECTOR","SHIPPING_URL","BILLING_URL","parseTotalValue","PRODUCT_NAME_SELECTOR","PROMOTION_SELECTOR","donationAmount","subtotalSelector","subtotal","REQUEST_URL","CODE_APPLY_MSG_SELECTOR","TITLE_SELECTOR","isInvalid","DISABLE_TIME_MS","isNotMaxCodeTesting","dataExpired","lastTestTimestamp","codeTestingCount","cookieEnabled","navigator","headerElement","isHeader","keys","_removeCodeManually","redemptionErrorMsg","shippingData","taxData","protocol","CUSTOMER_URL","urls","DELIVERY_PAGE_URL","CHECK_ELEM_SELECTOR","isOnDelivery","isOnPayment","checkElem","isCheckElem","WISH_LIST_URL","FLAG_SELECTOR","baseURL","CODE_ERROR_MESSAGE","CODE_NOT_APPLIED_MSG","MERCHANT_COUPON_REGEX","PROMO_BAR_SELECTOR","correctTotal","isUSA","index","indexOf","codeCheck","_isCodeInvalid","emptyCartElement","addCouponButton","correctPagesParts","urlPart","SHIPPING_PAGE_URL","REMOVE_BUTTON_SELECTOR","BILLING_SECTION_SELECTOR","HEADING_ELEM_SELECTOR","billingSection","isBillingSectionFilled","activeStep","matched","shippingDiscountValue","sendRequest","_sendGETRequest","_parseItemsCount","currentGifts","priceIncreased","bag","shippingTotal","couponCode","request","get","post","withCredentials","items","amountDue","BIILING_PAGE_URL","ON_CART_PAGE","correctPages","CART_URL_1","CART_URL_2","APPLIED_CODE_REGEXP","firstResponse","existingCodes","currentCodes","CART_DATA_URL","instart_disable_injection","isEmptyCart","_getCartData","promoCodeID","promocode","errorMessages","CART_UPDATED_URL","PROPOSED_CODE_REGEX","PAYMENT_CHECKBOX_SELECTOR","INPUT_CODES_SELECTOR","promoField","paymentCheckbox","isCheckboxChecked","promoURL","order_total","shipping_total","tax_total","API_URL","EXISTING_CODES_SELECTOR","codesToApply","formValues","cartHeaders","_applyCodeOnCheckout","_applyCodeOnCart","_removeCodeOnCheckout","_removeCodeOnCart","_sendFetch","baskettotal","isShippingDiscount","CART_ELEMENT_SELECTOR","UUID_SELECTOR","UU_ID","uuid","responseText","uuId","wait","ANOTHER_CART_URL","CART_COUPON_SELECTOR","MERCHANT_CODE_IMG","windowLocation","isWishList","iframeElem","src","getCodeElem","contentDocument","removeCodeResponse","isCartPage","isOnBillingPage","SUB_TOTAL","BILLING_COUPON_SELECTOR","CHECKOUT_PAGE_SELECTOR","CART_PAGE_SELECTOR","CODES_REGEXP","ACTIVE_BILLING","matchAll","IS_CART_EMPTY_REGEX","IS_CART_EMPTY_SELECTOR","PROMO_SELECTOR","REMOVE_VALUE_SELECTOR","isOnRightURL","loyaltyreward","_getUpdatedPage","_removeValue","error","removeCoderesponse","isCodesEqual","every","removeResponse","removeValueUuid","discountsHtml","grandTotal","TABLE_TOTALS_SELECTOR","PRICE_VALUE_SELECTOR","PROPOSED_CODES_SELECTOR","_findElement","targetString","SUBTOTAL_SELECTOR","couponid","orderTax","shippingCharges","shippingDisc","totalOrderPrice","US_CA","message","CHECKOUT_URL_CONDITIONS","APPLIED_COUPONS_SELECTOR","responseTxt","CART_WISHLIST_URL","TITLE_ELEMENT","CHECKOUT_BILLING_URL","CHECKOUT_BILLING_BACK_URL","IS_CART","resHtml","CART_TOTAL_SELECTOR","DYN_SESS_CONF_SELECTOR","DYNCHARSET_SELECTOR","MANAGE_CODE_URL","CODE_DESCRIPTION_SELECTOR","FREE_SHIPPING_REGEX","EMPTY_CART_REGEX","FEE_SELECTOR","isDisabledCodeTesting","isRemoveCodeElement","dynSessConfElement","dynSessConf","dyncharsetElement","dyncharset","freeShipping","_checkFreeShipping","cartHTML","fee","inputElement","isInputElement","errorElement","isErorrElement","MERCHANT_CODES_REGEXP","BANNER_SELECTOR","SUBSCRIBED_USER_CODE_SELECTOR","isOnRightPage","subscribedUserCodeElement","subscribedUserCode","cartCodes","mainPage","mainPageHtml","DEFAULT_URL","CART_INPUT_FIELD_SELECTOR","CHECKOUT_INPUT_FIELD_SELECTOR","MODAL_SELECTOR","checkoutURL","modalPopup","CODE_APPLY_BTN_SELECTOR","ACTIVE_SELECTOR","CODE_INFO_URL","spc","itemNumber","isSelector","_getCodesInfo","_removeCodesManually","responseARRAY","couponStatus","_applyCodesManually","buttonElem","CODE_INPUT_ELM_SELECTOR","lastStackedCode","EMPTY_CART","ERROR_PAGE","invalidCart","codeInputField","unstableCartPage","couponInput","donationSum","CODES_ELEMENT_SELECTOR","responseJson","removeCodeJson","_getRemoveUuidValue","codesObjects","i","codesObject","cartElem","APPLIED_ELEM_SELECTOR","MERCHANT_CODES_REG","emptyCartSelector","rightCurrency","codeFromPage","PAYMENT_SELECTOR","COUPON_DESCRIPTION_SELECTOR","fromPos","orderNo","isSection","_isFreeShipping","shipments","shipping_cost","couponDescriptionEl","isPretax","INPUT_CART_SELECTOR","welcomeOfferCode","status","enforceOriginalCaseCodes","SHIPPING_METHOD_SELECTOR","SHIPPING_LIST_SELECTOR","EXISTING_REGEX","removeUuid","retry","subTotalElem","codeUuid","subTotal","additionalCallout","showWhenCodeWasFound","applyFormValues","removeFormValues","APPLY_CODE_BTN_SELECTOR","checkoutInput","API_REQUEST_URL","INPUT_FIELD_SELECTOR","PROMO_REGEX","isInputField","BILLING_EDIT_URL","CART_SUBMIT_URL","calculatedShippingDiscount","runEmbeddedScript","PRODUCT_REMOVE_SELECTOR","REMOVE_CODE_BTN_SELECTOR","isListenerAdded","localStorage","setItem","cookiesOn","getItem","removeCodeManually","codeWasApplied","codeWasRemoved","PROPOSED_CODES_URL","CART_CODE_REGEX","FREE_GIFT_MSG_SELECTOR","FREE_GIFT_MSG_REGEX","_getProposedCoupons","_parseFreeGiftMsg","APPLIED_CODE_REG"],"mappings":"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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEe,gEACdC,wDADc,EAEdC,uDAFc,EAGdC,8DAHc,EAIdC,mDAJc,EAKdC,mDALc,EAMdC,0DANc,EAOdC,mDAPc,EAQdC,6DARc,EASdC,iDATc,EAUdC,sDAVc,EAWdC,oDAXc,EAYdC,uDAZc,EAadC,sDAbc,EAcdC,4DAdc,EAedC,iEAfc,EAgBdC,qDAhBc,EAiBdC,wDAjBc,EAkBdC,4DAlBc,EAmBdC,sDAnBc,EAoBdC,6DApBc,EAqBdC,kEArBc,EAsBdC,0DAtBc,EAuBdC,iDAvBc,EAwBdC,0DAxBc,EAyBdC,4DAzBc,EA0BdC,uDA1Bc,EA2BdC,uDA3Bc,EA4BdC,wDA5Bc,EA6BdC,wDA7Bc,EA8BdC,iDA9Bc,EA+BdC,4DA/Bc,EAgCdC,qEAhCc,EAiCdC,0DAjCc,EAkCdC,sDAlCc,EAmCdC,sDAnCc,EAoCdC,yDApCc,EAqCdC,4DArCc,EAsCdC,yDAtCc,EAuCdC,2DAvCc,EAwCdC,uDAxCc,EAyCdC,0DAzCc,EA0CdC,uDA1Cc,EA2CdC,kDA3Cc,EA4CdC,oDA5Cc,EA6CdC,sDA7Cc,EA8CdC,4DA9Cc,EA+CdC,yDA/Cc,EAgDdC,qDAhDc,EAiDdC,yDAjDc,EAkDdC,wDAlDc,EAmDdC,uDAnDc,EAoDdC,oDApDc,EAqDdC,sDArDc,EAsDdC,oDAtDc,EAuDdC,4DAvDc,EAwDdC,qDAxDc,EAyDdC,sDAzDc,EA0DdC,sDA1Dc,EA2DdC,qDA3Dc,EA4DdC,wDA5Dc,EA6DdC,8DA7Dc,EA8DdC,sDA9Dc,EA+DdC,sDA/Dc,EAgEdC,qDAhEc,EAiEdC,wDAjEc,EAkEdC,wDAlEc,EAmEdC,mDAnEc,EAoEdC,mDApEc,EAqEdC,sDArEc,EAsEdC,0DAtEc,EAuEdC,oDAvEc,EAwEdC,sDAxEc,EAyEdC,uDAzEc,EA0EdC,0DA1Ec,EA2EdC,2DA3Ec,EA4EdC,yDA5Ec,EA6EdC,6DA7Ec,EA8EdC,sDA9Ec,EA+EdC,mDA/Ec,EAgFdC,qDAhFc,EAiFdC,qDAjFc,EAkFdC,yDAlFc,EAmFdC,2DAnFc,EAoFdC,sDApFc,EAqFdC,qDArFc,EAsFdC,sDAtFc,EAuFdC,yDAvFc,EAwFdC,4DAxFc,EAyFdC,6DAzFc,EA0FdC,yDA1Fc,EA2FdC,mDA3Fc,EA4FdC,4DA5Fc,EA6FdC,2DA7Fc,EA8FdC,4DA9Fc,EA+FdC,wDA/Fc,EAgGdC,wDAhGc,EAiGdC,qDAjGc,EAkGdC,4DAlGc,EAmGdC,4DAnGc,EAoGdC,kDApGc,EAqGdC,qDArGc,EAsGdC,oDAtGc,EAuGdC,qDAvGc,EAwGdC,wDAxGc,EAyGdC,2DAzGc,EA0GdC,kDA1Gc,EA2GdC,qDA3Gc,EA4GdC,0DA5Gc,EA6GdC,oDA7Gc,EA8GdC,4DA9Gc,EA+GdC,2DA/Gc,EAgHdC,wDAhHc,EAiHdC,0DAjHc,EAkHdC,wDAlHc,EAmHdC,sDAnHc,CAAf,E;;;;;;;;;;;;ACpHA;AAAA;AAAA;AAEA;;;;;;;;;;;;;AAYA,MAAM9a,QAAQ,GAAG,gCAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMnD,gBAAgB,GAAI,GAAEmD,QAAS,gDAArC;;AACA,MAAML,eAAe,GAAG,MAAM;AAC7B,QAAM;AAAEjD;AAAF,MAAWF,MAAM,CAACC,QAAxB;;AACA,MAAIC,IAAI,CAACO,QAAL,CAAc,iBAAd,CAAJ,EAAsC;AACrC,WAAOpD,aAAP;AACA;;AACD,MAAI6C,IAAI,CAACO,QAAL,CAAc,mBAAd,CAAJ,EAAwC;AACvC,WAAQ,GAAE+C,QAAS,cAAnB;AACA;;AACD,SAAOtD,IAAP;AACA,CATD;;AAWA,MAAMQ,MAAM,GAAG,MAAMA,MAAN,SAAqBxI,6CAArB,CAAsC;AACpDC,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,yEAAtB;AACA,SAAKG,mBAAL,GAA2B,2BAA3B;AAEA,SAAKoI,mBAAL,GAA2B,wBAA3B;AAEA,SAAKvH,WAAL,GAAmB,IAAnB;AAEA,SAAK2D,cAAL,GAAuB,GAAEsD,gBAAiB,qBAA1C;AACA,SAAKrD,eAAL,GAAwB,GAAEqD,gBAAiB,6BAA3C;AACA,SAAKpD,kBAAL,GAA2B,GAAEoD,gBAAiB,0BAA9C;AAEA,SAAKhD,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA,SAAKkM,mBAAL,GAA2B,kBAA3B;AACA;;AAED/S,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAM4I,WAAW,GAAGxT,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAApB;AACA,UAAMa,UAAU,GACftB,IAAI,CAACO,QAAL,CAAc,MAAd,KACAP,IAAI,CAACO,QAAL,CAAc,aAAd,CADA,IAEAP,IAAI,CAACO,QAAL,CAAc,mBAAd,CAFA,IAGAP,IAAI,CAACO,QAAL,CAAc,mBAAd,CAHA,IAIAP,IAAI,CAACO,QAAL,CAAc,iBAAd,CALD;AAMA,UAAMgB,WAAW,GAAGpM,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAApB;AACA,UAAMjX,YAAY,GAAGmW,WAAW,IAAIA,WAAW,CAAClH,YAA3B,IAA2CH,UAA3C,IAAyD,CAACC,WAA/E;AACA,WAAO/O,YAAP;AACA;;AAED4D,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,IAAIsE,GAAJ,CACb,CAAC,GAAGxF,QAAQ,CAACyF,gBAAT,CAA0B,KAAKvC,mBAA/B,CAAJ,EACEuJ,MADF,CACS/G,OAAO,IAAI,CAAC,IAAIwjB,IAAJ,CAASxjB,OAAO,CAACC,SAAjB,CADrB,EAEEN,GAFF,CAEMK,OAAO,IAAIA,OAAO,CAACC,SAAR,CAAkB2V,OAAlB,CAA0B,cAA1B,EAA0C,EAA1C,EAA8CA,OAA9C,CAAsD,UAAtD,EAAkE,EAAlE,CAFjB,CADa,CAAd;AAKA,WAAO;AACNpa,WAAK,EAAE,CAAC,GAAGA,KAAJ,CADD;AAENC,eAAS,EAAED,KAAK,CAAC2E;AAFX,KAAP;AAIA;;AAEDX,YAAU,GAAG;AACZ,WAAOjH,OAAO,CAACC,OAAR,EAAP;AACA;;AApDmD,CAArD;AAuDe;AACdwM,MAAI,EAAE,UADQ;AAEd5M,QAAM,EAAE,oBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdC,iBAAe,EAAEA,eAAe,EALlB;AAMdzC;AANc,CAAf,E;;;;;;;;;;;;ACnFA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAE1I;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AAEA,MAAMqR,QAAQ,GAAG,6BAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMU,iBAAiB,GAAI,GAAEV,QAAS,WAAtC;AACA,MAAMqE,cAAc,GAAG7H,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC+D,iBAAhC,CAAvB;AACA;;;;;;;;;;AAUA,MAAMxD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GACC,kGADD;AAEA,SAAK8E,sBAAL,GAA8B,gBAA9B;AACA,SAAKshB,cAAL,GAAsB,wBAAtB;AACA,SAAKnmB,qBAAL,GAA6B,kDAA7B;AACA,SAAKomB,eAAL,GAAuB,4BAAvB;AACA,SAAKC,aAAL,GAAqB,2BAArB;AACA,SAAKrhB,aAAL,GAAqBA,aAArB;AACA,SAAKN,cAAL,GACC,wGADD;AAEA,SAAKC,eAAL,GAAuB,KAAKD,cAA5B;AACA,SAAKE,kBAAL,GAA0B,KAAKoB,aAAL,KAAuB,KAAKhB,aAA5B,GAA4C6G,iBAAtE;AACA,SAAK/G,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKgB,gBAAL,CAAsBhB,GAAtB,CAA0B,MAA1B,EAAkC,KAAlC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,MAA3B,EAAmC,QAAnC;AAEA,SAAKpE,qBAAL,GAA6B,qDAA7B;AACA,SAAKsmB,mBAAL,GAA2B,iBAA3B;AAEA,SAAKjM,kBAAL,GAA0B,uBAA1B;AACA,SAAKkM,mBAAL,GAA2B,2BAA3B;AACA,SAAKjM,uBAAL,GAA+B,+BAA/B;AACA,SAAKtV,aAAL,GAAqB,kCAArB;AACA;;AAEDzG,gBAAc,GAAG;AAChB,UAAMioB,QAAQ,GAAG7e,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,KAAK9C,aAArC,CAAjB;AACA,UAAMuI,OAAO,GAAGvQ,QAAQ,CAACC,aAAT,CAAwB,GAAE,KAAKkpB,cAAe,KAAI,KAAKthB,sBAAuB,EAA9E,CAAhB;AACA,UAAMyI,OAAO,GAAGtQ,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,KAA+C,KAAKoB,UAAL,OAAsB,CAArF;AACA,UAAMslB,aAAa,GAAGzpB,QAAQ,CAACC,aAAT,CAAuB,KAAKqpB,mBAA5B,CAAtB;AACA,WAAQE,QAAQ,IAAI,CAAClZ,OAAb,IAAwBC,OAAzB,IAAsCiC,cAAc,IAAIiX,aAAlB,IAAmC,CAACnZ,OAApC,IAA+CC,OAA5F;AACA;;AAEDtP,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EAA4DxC,GAA5D,CACboK,WAAW,IAAIA,WAAW,CAACiE,OAAZ,CAAoBC,MADtB,CAAd;AAIA,WAAO;AACNzS,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDzG,YAAU,CAACK,KAAD,EAAQ;AACjB,WAAO,KAAK8C,SAAL,CAAe9C,KAAK,CAAC,CAAD,CAApB,CAAP;AACA;;AAEDE,wBAAsB,GAAG;AACxB;AACA,WAAO,KAAK+H,WAAL,GAAmB5G,IAAnB,CAAwB8G,YAAY,IAAI;AAC9C,YAAMqgB,QAAQ,GAAGjnB,WAAW,CAACE,cAAc,CAAC,KAAK0a,kBAAN,EAA0BhU,YAA1B,CAAf,CAA5B;AACA,YAAMsgB,SAAS,GAAGhnB,cAAc,CAAC,KAAK4mB,mBAAN,EAA2BlgB,YAA3B,CAAd,CAAuDugB,SAAvD,CAAiEC,QAAjE,CAA0E,QAA1E,CAAlB;AACA,YAAMC,UAAU,GAAGH,SAAS,GAAG,CAAH,GAAOD,QAAnC;AACA,YAAMK,aAAa,GAAGtnB,WAAW,CAACE,cAAc,CAAC,KAAK2a,uBAAN,EAA+BjU,YAA/B,CAAf,CAAjC;AACA,YAAM2gB,eAAe,GAAG5qB,MAAM,CAAC6qB,KAAP,CAAaF,aAAb,IAA8B,CAA9B,GAAkCA,aAA1D;AACA,YAAMG,UAAU,GAAG,KAAK/lB,UAAL,CAAgBkF,YAAhB,CAAnB;AACA,aAAO6gB,UAAU,GAAGJ,UAAb,GAA0BE,eAAjC;AACA,KARM,CAAP;AASA;;AAjEuD,CAAzD;AAoEe;AACdtf,MAAI,EAAE,cADQ;AAEd5M,QAAM,EAAE,iBAFM;AAGduN,QAHc;AAIdwC,iBAAe,EAAE,IAJH;AAKduL,wBAAsB,EAAE,IALV;AAMd9J,kBAAgB,EAAEC,wDAAiB,CAACC;AANtB,CAAf,E;;;;;;;;;;;;ACxFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA,MAAM;AAAE7M,gBAAF;AAAkB6E;AAAlB,IAA6C5E,0CAAnD;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AACA;;;;;;;;;;;;;;;AAeA,MAAMqR,QAAQ,GAAG,+BAAjB;AACA,MAAMyL,QAAQ,GAAI,GAAEzL,QAAS,OAA7B;AAEA,MAAM9C,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKiB,WAAL,GAAmB,KAAnB;AACA,SAAKhB,cAAL,GAAsB,2BAAtB;AACA,SAAKuI,mBAAL,GAA2B,mDAA3B;AAEA,SAAKyJ,aAAL,GAAqB,kBAArB;AACA,SAAKC,gBAAL,GAAwB,yDAAxB;AAEA,SAAKhK,gBAAL,GAAyB,GAAEmD,QAAS,6CAApC;AACA,SAAKzG,cAAL,GAAuB,GAAE,KAAKsD,gBAAiB,qBAA/C;AACA,SAAKrD,eAAL,GAAwB,GAAE,KAAKqD,gBAAiB,wBAAhD;AACA,SAAKpD,kBAAL,GAA2B,GAAE,KAAKoD,gBAAiB,0BAAnD;AAEA,SAAKhD,aAAL,GAAqB4R,QAArB;AACA,SAAK7R,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKoS,kBAAL,GAA0B,0BAA1B;AACA,SAAKC,yBAAL,GAAiC,gBAAjC;AACA,SAAKjI,sBAAL,GAA8B,gCAA9B;AACA,SAAKiY,gBAAL,GAAyB,GAAEhc,QAAS,iBAApC;AAEA,SAAKlG,qBAAL,GAA6B;AAC5B,0BAAoB;AADQ,KAA7B;AAGA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAKE,sBAAL,GAA8B,KAAKF,qBAAnC;AAEA,SAAKG,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AACA,SAAKmB,iBAAL,CAAuBnB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AAEA,SAAK8M,aAAL,GAAqB,EAArB;AACA;;AAED7S,iBAAe,GAAG;AACjB4O,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAE,MAAM9O,eAAN,EADO;AAEvB+O,aAAO,EAAE,KAAK8D;AAFS,KAAxB;AAIA;;AAED3S,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAMuB,UAAU,GACftB,IAAI,CAACO,QAAL,CAAc,OAAd,KACAP,IAAI,CAACO,QAAL,CAAc,kBAAd,CADA,IAEAP,IAAI,CAACO,QAAL,CAAc,WAAd,CAFA,IAGAP,IAAI,CAACO,QAAL,CAAc,WAAd,CAHA,IAIAP,IAAI,CAACO,QAAL,CAAc,UAAd,CAJA,IAKAP,IAAI,CAACC,UAAL,CAAiB,GAAE,KAAKE,gBAAiB,qBAAzC,CAND;AAOA,UAAMwI,WAAW,GAAGxT,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAApB;AACA,WAAOa,UAAU,IAAIqH,WAArB;AACA;;AAEDxS,kBAAgB,GAAG;AAClB,WAAO,KAAKopB,eAAL,GAAuB7nB,IAAvB,CAA4B8G,YAAY,IAAI,CAClD,GAAG,IAAI7D,GAAJ,CACF,CAAC,GAAG7C,cAAc,CAAC,KAAKuP,sBAAN,EAA8B7I,YAA9B,EAA4C,IAA5C,CAAlB,EACEhE,GADF,CACMqH,EAAE,IAAIA,EAAE,CAACrM,WADf,EAEEoM,MAFF,CAESC,EAAE,IAAIC,OAAO,CAACD,EAAD,CAAP,IAAeA,EAAE,CAACjC,WAAH,OAAqB,gBAFnD,EAGEpF,GAHF,CAGMZ,IAAI,IAAIA,IAAI,CAACyT,WAAL,EAHd,CADE,CAD+C,CAA5C,CAAP;AAQA;;AAEDjX,kBAAgB,GAAG;AAClB,WAAOhD,+CAAO,CAACC,OAAR,GACLqE,IADK,CACA,MAAM;AACX,UAAI,KAAKyG,aAAL,EAAJ,EAA0B;AACzB,eAAOhJ,QAAQ,CAACiJ,eAAT,CAAyBC,SAAhC;AACA;;AACD,aAAO,KAAKC,WAAL,EAAP;AACA,KANK,EAOL5G,IAPK,CAOAmC,IAAI,IAAI;AACb,YAAM0E,oBAAoB,GAAG,KAAKvB,sBAAL,GAC1B,KAAKA,sBADqB,GAE1B,KAAK3E,mBAFR;AAGA,YAAMhC,KAAK,GAAG,CAAC,GAAGsG,sBAAsB,CAAC9C,IAAD,EAAO0E,oBAAP,EAA6B,IAA7B,CAA1B,EAA8D/D,GAA9D,CAAkEK,OAAO,IACtFA,OAAO,CAACC,SAAR,CAAkBC,IAAlB,EADa,CAAd;AAIA,aAAO;AACN1E,aAAK,EAAEA,KAAK,CAACmE,GAAN,CAAUZ,IAAI,IAAIA,IAAI,CAACyT,WAAL,EAAlB,CADD;AAEN/W,iBAAS,EAAED,KAAK,CAACoG;AAFX,OAAP;AAIA,KAnBK,CAAP;AAoBA;;AAEDvG,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAOjD,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoB,MAAMuD,IAAN,IAAc;AACxC,YAAM4lB,eAAe,GAAG,MAAM,KAAKhb,eAAL,EAA9B;AACA,aAAO,KAAKnK,UAAL,CAAgBT,IAAhB,EAAsB4lB,eAAtB,CAAP;AACA,KAHM,EAIL9nB,IAJK,CAIA,MAAM,KAAKuG,eAAL,EAJN,EAKLvG,IALK,CAKA2E,QAAQ,KAAK;AAClBhD,mBAAa,EAAE,KAAKC,UAAL,CAAgB+C,QAAhB;AADG,KAAL,CALR,CAAP;AAQA;;AAEDtG,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2C;AACpDxF,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AAEA,WAAOjG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0BoG,iBAAiB,IAAI;AAC9C,YAAMhE,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE;AAJG,OAAf;;AAOA,UAAI,KAAKE,iBAAL,CAAuB2D,iBAAvB,CAAJ,EAA+C;AAC9C;AACAhE,cAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,eAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AAED,aAAO,KAAKmE,eAAL,GAAuBvG,IAAvB,CAA4B,MAAMwG,YAAN,IAAsB;AACxDpE,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB4E,YAAhB,CAApB;AACApE,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACA,cAAM0lB,YAAY,GAAG,MAAM,KAAKjb,eAAL,EAA3B;AACA,cAAMkb,SAAS,GAAG,CAAC,GAAG5nB,cAAc,CAAC,kBAAD,EAAqB2nB,YAArB,EAAmC,IAAnC,CAAlB,EAA4D9jB,IAA5D,CACjBkG,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeuF,IAAf,GAAsB6E,WAAtB,OAAwChG,IAAI,CAACgG,WAAL,EAD7B,CAAlB,CAJwD,CAOxD;;AACA,YAAI,CAAC8f,SAAL,EAAgB;AACf5lB,gBAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,iBAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AAED,eAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsB6lB,YAAtB,EAAoC/nB,IAApC,CAAyC,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAA/C,CAAP;AACA,OAdM,CAAP;AAeA,KA7BD,CADM,CAAP;AAgCA;;AAED,QAAMvD,sBAAN,GAA+B;AAC9B,UAAMkU,OAAO,GAAG,MAAM,KAAKxM,eAAL,EAAtB;AACA,UAAM6H,KAAK,GAAG,KAAKxM,UAAL,CAAgBmR,OAAhB,CAAd;AACA,UAAMxD,KAAK,GAAG,CAAC,GAAGnP,cAAc,CAAC,KAAKqS,gBAAN,EAAwBM,OAAxB,EAAiC,IAAjC,CAAlB,EACZ7I,MADY,CACLC,EAAE,IAAIA,EAAE,CAAC6I,aAAH,CAAiBlV,WAAjB,CAA6BG,KAA7B,CAAmC,KAAKuU,aAAxC,CADD,EAEZ1P,GAFY,CAER5C,WAFQ,EAGZgK,MAHY,CAGLE,OAHK,EAIZyI,MAJY,CAIL,CAACI,OAAD,EAAUC,MAAV,KAAqBD,OAAO,GAAGC,MAJ1B,EAIkC,CAJlC,CAAd;AAKA,WAAO9E,KAAK,GAAGmB,KAAf;AACA;;AAED5M,YAAU,CAACT,IAAD,EAAO6lB,YAAP,EAAqB;AAC9B,UAAME,QAAQ,GAAG,CAAC,GAAG7nB,cAAc,CAAC,kBAAD,EAAqB2nB,YAArB,EAAmC,IAAnC,CAAlB,EAA4D9jB,IAA5D,CAChBkG,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeuF,IAAf,GAAsB6E,WAAtB,OAAwChG,IAAI,CAACgG,WAAL,EAD9B,EAEfkE,kBAFe,CAEIjE,IAFrB;AAGA,WAAO9D,KAAK,CAAE,GAAE,KAAKoE,gBAAiB,kBAA1B,EAA6C;AACxD1I,YAAM,EAAE,MADgD;AAExD0E,iBAAW,EAAE,SAF2C;AAGxDC,aAAO,EAAE;AACR,wBAAgB;AADR,OAH+C;AAMxDH,UAAI,EAAG,0BAAyB0jB,QAAS;AANe,KAA7C,CAAL,CAOJjoB,IAPI,CAOC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAPb,CAAP;AAQA;;AAEDkI,iBAAe,GAAG;AACjB,WAAOzI,KAAK,CAACgT,QAAD,EAAW;AACtBtX,YAAM,EAAE;AADc,KAAX,CAAL,CAEJC,IAFI,CAEC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAFb,CAAP;AAGA;;AAEDijB,iBAAe,GAAG;AACjB,WAAOxjB,KAAK,CAAC,KAAKujB,gBAAN,EAAwB;AACnC7nB,YAAM,EAAE;AAD2B,KAAxB,CAAL,CAEJC,IAFI,CAEC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAFb,CAAP;AAGA;;AAEDnC,mBAAiB,CAACuC,IAAD,EAAO;AACvB,UAAMkT,QAAQ,GAAG9X,cAAc,CAAC,KAAKuX,kBAAN,EAA0B3S,IAA1B,CAA/B;AACA,WAAOkT,QAAQ,IAAIA,QAAQ,CAACpa,WAArB,GAAmCoa,QAAQ,CAACpa,WAAT,CAAqBG,KAArB,CAA2B,qBAA3B,CAAnC,GAAuF,KAA9F;AACA;;AAlLuD,CAAzD;AAqLe;AACdkK,MAAI,EAAE,gBADQ;AAEd5M,QAAM,EAAE,mBAFM;AAGd+P,iBAAe,EAAE,IAHH;AAIdxC;AAJc,CAAf,E;;;;;;;;;;;;AC/MA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM;AAAExO,SAAF;AAAW4tB;AAAX,IAAqB3tB,6CAA3B;AACA,MAAM;AAAE6X,aAAF;AAAeiM;AAAf,IAA4Bhe,0CAAlC;AAEA;;;;;;;;;AASA,MAAMO,kBAAkB,GAAG,kBAA3B;;AAEA,MAAM6O,QAAQ,GAAG,MAAMrF,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuBkD,kBAAvB,CAAD,CAA9B;;AAEA,MAAM6E,aAAa,GAAG,gCAAtB;AAEA,MAAMqD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,4BAAtB;AACA,SAAK8E,sBAAL,GAA8B,kBAA9B;AACA,SAAK6iB,mBAAL,GAA2B,2BAA3B;AACA,SAAK1Q,mBAAL,GAA2B,mDAA3B;AACA,SAAK2Q,uBAAL,GAA+B,oDAA/B;AACA,SAAK1Q,kBAAL,GAA0B,aAA1B;AAEA,SAAK9W,kBAAL,GAA0BA,kBAA1B;AAEA,SAAKY,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,4EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,wBAAnC;AACA,SAAKvG,kBAAL,GAA0B+C,MAAM,CAACC,QAAP,CAAgBC,IAA1C;AAEA,SAAK7C,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA,SAAKwiB,SAAL,GAAiB,oBAAjB;AACA,SAAKC,iBAAL,GAAyB,eAAzB;AACA;;AAEDxpB,iBAAe,GAAG;AACjB,QAAIC,aAAa,GAAG,KAApB;AACAlE,eAAW,CAAC,MAAM;AACjB,YAAMmT,OAAO,GAAG5D,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,KAAK+Z,mBAA5B,CAAD,CAAvB;AACA,YAAM3J,OAAO,GAAG1D,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAAD,CAAvB;AACA,YAAM+nB,eAAe,GAAGne,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,KAAK0qB,uBAA5B,CAAD,CAA/B;AACA,YAAMttB,YAAY,GAAGkT,OAAO,IAAIF,OAAX,IAAsB,CAACya,eAA5C;;AACA,UAAIztB,YAAY,KAAKiE,aAArB,EAAoC;AACnC9D,oDAAG,CAACC,KAAJ,CAAUJ,YAAY,GAAG,aAAH,GAAmB,eAAzC;AACA;;AACDiE,mBAAa,GAAGjE,YAAhB;AACA,KATU,EASR,GATQ,CAAX;AAUA;;AAED6H,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDxD,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EACZ4E,MADY,CACLE,OADK,EAEZtH,GAFY,CAERqH,EAAE,IAAIA,EAAE,CAAC/G,SAAH,CAAanF,KAAb,CAAmB,KAAKqqB,iBAAxB,EAA2C,CAA3C,CAFE,CAAd;AAIA,WAAO;AACN3pB,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDhD,iBAAe,CAACiD,IAAD,EAAO;AACrB,WAAOkjB,KAAK,CAAC9V,WAAW,CAAC,KAAK+V,mBAAN,EAA2BnjB,IAA3B,CAAX,IAA+C,CAAhD,CAAZ;AACA;;AAEDpD,YAAU,CAACoD,IAAI,GAAG,KAAR,EAAe;AACxB,WAAO1K,OAAO,CAAC8X,WAAW,CAAC,KAAK5R,cAAN,EAAsBwE,IAAtB,CAAX,CAAuC+T,OAAvC,CAA+C,KAAKsP,SAApD,EAA+D,EAA/D,CAAD,CAAd;AACA;;AAED/pB,YAAU,CAACK,KAAD,EAAQ;AACjB,QAAI8Q,QAAQ,EAAZ,EAAgB;AACf,aAAO/T,OAAO,CAACC,OAAR,EAAP;AACA,KAHgB,CAIjB;;;AACA,UAAM6sB,QAAQ,GAAG7pB,KAAK,CAACA,KAAK,CAACoG,MAAN,GAAe,CAAhB,CAAtB;AACA,WAAO,KAAKpC,UAAL,CAAgB6lB,QAAhB,CAAP;AACA;;AAEDvpB,oBAAkB,CAACN,KAAD,EAAQ;AACzB,WAAO,KAAK8pB,kBAAL,CAAwB9pB,KAAK,CAAC,CAAD,CAA7B,CAAP;AACA;;AAED8pB,oBAAkB,CAACvmB,IAAD,EAAO;AACxB,UAAMqO,SAAS,GAAG9S,QAAQ,CAACC,aAAT,CAAuB,KAAK+Z,mBAA5B,CAAlB;AACA,UAAMiR,OAAO,GAAGjrB,QAAQ,CAACC,aAAT,CAAuB,KAAKga,kBAA5B,CAAhB;AACA2G,YAAQ,CAAC9N,SAAD,EAAYrO,IAAZ,CAAR;AACAwmB,WAAO,CAAC1d,KAAR;AACA,WAAOtP,OAAO,CAACC,OAAR,EAAP;AACA;;AAtFuD,CAAzD;AAyFe;AACdwM,MAAI,EAAE,YADQ;AAEd5M,QAAM,EAAE,eAFM;AAGdwR,kBAAgB,EAAE,MAAO0C,QAAQ,KAAKzC,wDAAiB,CAACC,OAAvB,GAAiCD,wDAAiB,CAAC2b,MAHtE;AAIdtd,WAAS,EAAE,IAJG;AAKdC,iBAAe,EAAE,IALH;AAMdxC,QANc;;AAOd;AACAuD,aAAW,GAAG;AACb,WAAO,KAAP;AACA;;AAVa,CAAf,E;;;;;;;;;;;;AC/GA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;AAsBA,MAAMvD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKiB,WAAL,GAAmB,KAAnB;AAEA,SAAKhB,cAAL,GAAsB,oBAAtB;AACA,SAAK8E,sBAAL,GAA8B,8BAA9B;AACA,SAAKsjB,OAAL,GAAe,uBAAf;AACA,SAAKC,SAAL,GAAiB,oCAAjB;AAEA,UAAMjd,QAAQ,GAAG,kFAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,mCAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,oCAAnC;AACA,SAAKvG,kBAAL,GAA0B+C,MAAM,CAACC,QAAP,CAAgBC,IAA1C;AAEA,SAAK7C,aAAL,GAAqB,0CAArB;AACA,SAAKF,qBAAL,GAA6B,WAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAKwM,mBAAL,GAA2B,aAA3B;AACA,SAAKhJ,mBAAL,GAA2B,oBAA3B;AACA,SAAK+f,0BAAL,GAAkC,uBAAlC;AACA,SAAKC,6BAAL,GAAqC,wCAArC;AACA,SAAKC,qBAAL,GAA6B,aAA7B;AACA,SAAKnjB,gBAAL,CAAsBhB,GAAtB,CAA0B,cAA1B,EAA0C,qCAA1C;AACA;;AAED7F,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAM4gB,aAAa,GAAGxrB,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAAtB;AACA,UAAM6G,aAAa,GAAGnb,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAAtB;AACA,UAAMmgB,gBAAgB,GAAGzrB,QAAQ,CAACC,aAAT,CAAuB,KAAKsrB,qBAA5B,CAAzB;AACA,UAAMG,aAAa,GAAG7gB,IAAI,CAACO,QAAL,CAAc,cAAd,IACnBpL,QAAQ,CAACC,aAAT,CAAuB,KAAKorB,0BAA5B,KACA,CAACrrB,QAAQ,CAACC,aAAT,CAAuB,KAAKqrB,6BAA5B,KAA8D,EAA/D,EAAmEhf,YAFhD,GAGnB,IAHH;AAIA,WAAO6O,aAAa,IAAI,CAACqQ,aAAlB,IAAmCE,aAAnC,IAAoD,CAACD,gBAA5D;AACA;;AAEDhrB,iBAAe,GAAG;AACjB,UAAMkrB,KAAK,GAAG,CAAC,GAAG3rB,QAAQ,CAACyF,gBAAT,CAA0B,QAA1B,CAAJ,EACZJ,GADY,CACRqH,EAAE,IAAIA,EAAE,CAACrM,WADD,EAEZmG,IAFY,CAEPd,OAAO,IAAIA,OAAO,CAAClF,KAAR,CAAc,KAAK4qB,SAAnB,CAFJ,EAGZ5qB,KAHY,CAGN,KAAK4qB,SAHC,EAGU,CAHV,CAAd;AAKA,SAAKhjB,gBAAL,CAAsBhB,GAAtB,CAA0B,OAA1B,EAAmCukB,KAAnC;AACA,SAAKrjB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA,WAAOnK,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED+C,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EACZ4E,MADY,CACLE,OADK,EAEZtH,GAFY,CAERqH,EAAE,IAAIA,EAAE,CAAC/G,SAAH,CAAanF,KAAb,CAAmB,KAAK2qB,OAAxB,EAAiC,CAAjC,CAFE,CAAd;AAIA,WAAO;AACNjqB,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AA1DuD,CAAzD;AA6De;AACdoD,MAAI,EAAE,eADQ;AAEd5M,QAAM,EAAE,kBAFM;AAGduN,QAHc;AAIdwC,iBAAe,EAAE;AAJH,CAAf,E;;;;;;;;;;;;ACtFA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA,MAAM;AAAEpL;AAAF,IAAkB3F,6CAAxB;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;;;;AAiBA,MAAMyW,aAAa,GAAG,2BAAtB;;AAEA,MAAMtG,MAAM,GAAG,MAAMpI,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBrK,KAArB,CAA2B,aAA3B,CAArB;;AACA,MAAMorB,QAAQ,GAAGjhB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,UAA9B,CAAjB;AACA,MAAMjI,kBAAkB,GAAG,kBAA3B;AACA,MAAMmQ,sBAAsB,GAAG,gBAA/B;AAEA,MAAMjI,MAAM,GAAG,cAAc5D,6CAAd,CAAmC;AACjD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,gDAAtB;AAEA,SAAK8oB,eAAL,GAAuB,sBAAvB;AACA,SAAKpgB,YAAL,GAAoB,gCAApB;AACA,SAAKF,iBAAL,GAAyB,iCAAzB;AACA,SAAK2G,sBAAL,GAA8B,gCAA9B;AACA,SAAK4Z,mBAAL,GAA2B,8BAA3B;AACA,SAAKC,oBAAL,GAA4B,cAA5B;AAEA,SAAKjkB,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKD,sBAAL,GAA+B,eAAckL,MAAM,KAAK,aAAL,GAAqB,UAAW,SAAnF;AAEA,SAAK3K,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA,SAAK4jB,iBAAL,GAAyB,gCAAzB;AAEA,UAAM7d,QAAQ,GAAGyd,QAAQ,GACrB,GAAE,KAAKI,iBAAkB,iDADJ,GAErB,GAAE3S,aAAc,6CAFpB;AAGA,SAAK3R,cAAL,GAAuB,GAAEyG,QAAS,oBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,uBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,yBAAtC;AACA;;AAEDnN,kBAAgB,GAAG;AAClB,UAAMirB,WAAW,GAAGL,QAAQ,GAAG,KAAKI,iBAAR,GAA4B3S,aAAxD;AACA,WAAO,KAAK/P,eAAL,CAAqB2iB,WAArB,EAAkC1pB,IAAlC,CAAuC8G,YAAY,IAAI;AAC7D,YAAMnI,KAAK,GAAG,CAAC,GAAGyB,cAAc,CAAC,KAAKuP,sBAAN,EAA8B7I,YAA9B,EAA4C,IAA5C,CAAlB,EACZhE,GADY,CACR2S,IAAI,IAAIA,IAAI,CAACrS,SAAL,CAAeC,IAAf,EADA,EAEZ6G,MAFY,CAELE,OAFK,CAAd;AAGA,OAAC,GAAGhK,cAAc,CAAC,KAAKmpB,mBAAN,EAA2BziB,YAA3B,EAAyC,IAAzC,CAAlB,EACEhE,GADF,CACM2S,IAAI,IAAIA,IAAI,CAAC8B,GAAL,CAAStZ,KAAT,CAAe,KAAKurB,oBAApB,CADd,EAEEtf,MAFF,CAESE,OAFT,EAGEtH,GAHF,CAGM2S,IAAI,IAAI9W,KAAK,CAAC+D,IAAN,CAAW+S,IAAI,CAAC,CAAD,CAAf,CAHd;AAIA,aAAO,CAAC,GAAG,IAAIxS,GAAJ,CAAQtE,KAAR,CAAJ,CAAP;AACA,KATM,CAAP;AAUA;;AAEDP,kBAAgB,GAAG;AAClB,QAAIX,QAAQ,CAACC,aAAT,CAAuBkD,kBAAvB,CAAJ,EAAgD;AAC/C;AACAwH,YAAM,CAAC+G,OAAP,CAAewa,SAAf,CAAyBvhB,MAAM,CAAC+G,OAAP,CAAeE,KAAxC,EAA+CjH,MAAM,CAAC3K,QAAP,CAAgB6R,KAA/D,EAAsElH,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqB4G,KAArB,CAA2B,GAA3B,EAAgC,CAAhC,CAAtE;AACA;;AACD,WAAOxT,OAAO,CAACC,OAAR,EAAP;AACA;;AAEDkD,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAMilB,KAAK,GAAGxpB,cAAc,CAAC,KAAKkpB,eAAN,EAAuB3kB,QAAvB,CAA5B;AACA,YAAM6Q,OAAO,GAAGpV,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAA9B;AACA,YAAM6F,GAAG,GAAGof,KAAK,IAAI,CAACpU,OAAV,GAAoB,CAApB,GAAwBtV,WAAW,CAACsV,OAAD,CAA/C;AACA,YAAMuB,UAAU,GAAG3W,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAAjC;AACA,YAAM0F,QAAQ,GACb0M,UAAU,IAAIA,UAAU,CAAC3T,SAAX,CAAqB8E,WAArB,GAAmC7E,IAAnC,OAA8C,MAA5D,GAAqE,CAArE,GAAyEnD,WAAW,CAAC6W,UAAD,CADrF;AAEA,aAAO,KAAKnV,UAAL,CAAgB+C,QAAhB,IAA4B6F,GAA5B,GAAkCH,QAAzC;AACA,KARM,CAAP;AASA;;AA9DgD,CAAlD;AAiEe;AACdlC,MAAI,EAAE,YADQ;AAEd5M,QAAM,EAAE,eAFM;AAGduN,QAHc;;AAIde,aAAW,GAAG;AACb,WAAO,CAACpM,QAAQ,CAACC,aAAT,CAAuB,iBAAvB,KAA6C,EAA9C,EAAkDqM,YAAzD;AACA,GANa;;AAOdsC,aAAW,CAAC/D,IAAD,EAAO;AACjB;AACA,WACC,CAACA,IAAI,CAACO,QAAL,CAAc,kBAAd,CAAD,KACCpL,QAAQ,CAACC,aAAT,CAAuBkD,kBAAvB,KAA8CnD,QAAQ,CAACC,aAAT,CAAuBqT,sBAAvB,CAD/C,CADD;AAIA;;AAba,CAAf,E;;;;;;;;;;;;ACjGA;AAAA;AAAA;AAEA,MAAMjI,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AAEA,SAAKiB,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,qEAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,iBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,oBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKpG,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AACA;;AAEDnG,kBAAgB,GAAG;AAClB,QAAIC,KAAK,GAAG,EAAZ;;AACA,QAAIyJ,MAAM,CAACC,QAAP,CAAgBwL,QAAhB,CAAyBhL,QAAzB,CAAkC,OAAlC,CAAJ,EAAgD;AAC/ClK,WAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,oBAA1B,CAAJ,EAAqDJ,GAArD,CAAyD2S,IAAI,IAAIA,IAAI,CAACrS,SAAL,CAAeC,IAAf,EAAjE,CAAR;AACA,KAFD,MAEO;AACN,YAAMU,aAAa,GAAG,CAAC,GAAGtG,QAAQ,CAACyF,gBAAT,CAA0B,mBAA1B,CAAJ,EAAoDJ,GAApD,CAAwDqH,EAAE,IAC/EA,EAAE,CAACtM,YAAH,CAAgB,iBAAhB,CADqB,CAAtB;AAGAc,WAAK,GAAG,CAAC,GAAG,IAAIsE,GAAJ,CAAQc,aAAR,CAAJ,CAAR;AACA;;AAED,WAAO;AACNpF,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAhCuD,CAAzD;AAmCe;AACdoD,MAAI,EAAE,MADQ;AAEd5M,QAAM,EAAE,UAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;;AAKduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WAAOA,IAAI,CAACC,UAAL,CAAgB,8BAAhB,KAAmDD,IAAI,CAACC,UAAL,CAAgB,iCAAhB,CAA1D;AACA;;AAPa,CAAf,E;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAM;AAAEjO,SAAF;AAAW4F;AAAX,IAA2B3F,6CAAjC;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA,MAAMuL,QAAQ,GAAG,wBAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AAEA;;;;;;;;;;;;;;;AAeA,MAAM9C,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,4BAAtB;AACA,SAAK8E,sBAAL,GAA8B,gBAA9B;AACA,SAAKqK,sBAAL,GAA8B,iBAA9B;AACA,SAAKka,oBAAL,GAA4B,oCAA5B;AACA,SAAKC,iBAAL,GAAyB,gBAAzB;AACA,SAAKC,sBAAL,GAA8B,0BAA9B;AACA,SAAKnD,cAAL,GAAsB,wBAAtB;AACA,SAAKoD,0BAAL,GAAkC,2BAAlC;AACA,SAAKvpB,qBAAL,GAA8B;;;KAG3B,KAAKupB,0BAA2B,EAHnC;AAIA,SAAKvkB,aAAL,GAAqBA,aAArB;AACA,SAAKgD,gBAAL,GAAwB,uEAAxB;AACA,SAAKwhB,uBAAL,GAAgC,GAAE,KAAKxhB,gBAAiB,2BAAxD;AACA,SAAKyhB,uBAAL,GAAgC,GAAE,KAAKzhB,gBAAiB,uBAAxD;AACA,SAAKtD,cAAL,GAAuB,GAAE,KAAKsD,gBAAiB,uBAA/C;AACA,SAAKrD,eAAL,GAAuB,KAAKD,cAA5B;AACA,SAAKglB,uBAAL,GAAgC,GAAE,KAAK1hB,gBAAiB,kCAAxD;AACA,SAAKjD,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAK6kB,oBAAL,GAA6B,GAAE,KAAK3hB,gBAAiB,kCAArD;AACA,SAAK4hB,0BAAL,GAAmC,GAAEze,QAAS,SAA9C;AACA,SAAK/F,gBAAL,GAAwB,IAAIC,eAAJ,CAAoB;AAC3CvL,YAAM,EAAE,MADmC;AAE3C+vB,UAAI,EAAE;AAFqC,KAApB,CAAxB;AAIA,SAAKvkB,iBAAL,GAAyB,IAAID,eAAJ,CAAoB;AAC5CvL,YAAM,EAAE,MADoC;AAE5C+vB,UAAI,EAAE;AAFsC,KAApB,CAAzB;AAKA,SAAKxP,kBAAL,GAA0B,gCAA1B;AACA,SAAKkM,mBAAL,GAA2B,iDAA3B;AACA,SAAKjM,uBAAL,GAA+B,+BAA/B;AACA,SAAKwP,gCAAL,GAAwC,wCAAxC;AACA,SAAKC,wBAAL,GAAgC,+BAAhC;AACA,SAAKC,oBAAL,GAA4B,WAA5B;AACA,SAAKC,oBAAL,GAA4B,sBAA5B;AACA,SAAKC,eAAL,GAAuB,QAAvB;AACA,SAAKC,6BAAL,GAAqC,cAArC;AACA,SAAKC,wBAAL,GAAgC,0BAAhC;AACA,SAAKrpB,WAAL,GAAmB,KAAnB;AACA;;AAEDxC,gBAAc,GAAG;AAChB,UAAMioB,QAAQ,GAAG7e,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,KAAK9C,aAArC,CAAjB;AACA,UAAMuI,OAAO,GAAGvQ,QAAQ,CAACC,aAAT,CAAwB,GAAE,KAAKkpB,cAAe,KAAI,KAAKthB,sBAAuB,EAA9E,CAAhB;AACA,UAAMyI,OAAO,GAAGtQ,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,KAA+C,KAAKoB,UAAL,OAAsB,CAArF;AACA,UAAMkpB,UAAU,GAAGrtB,QAAQ,CAACC,aAAT,CAAuB,KAAK8sB,wBAA5B,CAAnB;AACA,UAAMO,iBAAiB,GAAGD,UAAU,IAAI5qB,WAAW,CAAC4qB,UAAD,CAAnD;AACA,WAAO7D,QAAQ,IAAI,CAAClZ,OAAb,IAAwBC,OAAxB,IAAmC+c,iBAA1C;AACA;;AAED,QAAMtsB,gBAAN,GAAyB;AACxB,UAAMqI,YAAY,GAAG,MAAM,KAAKkkB,aAAL,EAA3B;AACA,UAAMC,UAAU,GAAG,CAAC,GAAG7qB,cAAc,CAAC,KAAKypB,oBAAN,EAA4B/iB,YAA5B,EAA0C,IAA1C,CAAlB,EACjBhE,GADiB,CACb2S,IAAI,IAAIA,IAAI,CAACrS,SAAL,CAAenF,KAAf,CAAqB,KAAK6rB,iBAA1B,CADK,EAEjB5f,MAFiB,CAEVE,OAFU,EAGjBtH,GAHiB,CAGb2S,IAAI,IAAIA,IAAI,CAAC,CAAD,CAHC,CAAnB;AAKA,UAAMyV,aAAa,GAAG,CAAC,GAAGztB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKyM,sBAA/B,CAAJ,EACpB7M,GADoB,CAChBqH,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeuF,IAAf,EADU,EAEpB6G,MAFoB,CAEbE,OAFa,CAAtB;AAGA,WAAO,CAAC,GAAG,IAAInH,GAAJ,CAAQ,CAAC,GAAGgoB,UAAJ,EAAgB,GAAGC,aAAnB,CAAR,CAAJ,CAAP;AACA;;AAEDxsB,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EAA4DxC,GAA5D,CACboK,WAAW,IAAIA,WAAW,CAACiE,OAAZ,CAAoBC,MADtB,CAAd;AAIA,WAAO;AACNzS,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDvG,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAO,KAAKgE,UAAL,CAAgBhE,KAAK,CAAC,CAAD,CAArB,EAA0BqB,IAA1B,CAA+B8G,YAAY,IAAI;AACrD,aAAO,KAAKqkB,YAAL,GAAoBnrB,IAApB,CAAyB2E,QAAQ,KAAK;AAC5ChD,qBAAa,EAAE,KAAKC,UAAL,CAAgB+C,QAAhB,CAD6B;AAE5C7C,0BAAkB,EAAE,KAAKC,eAAL,CAAqB+E,YAArB;AAFwB,OAAL,CAAjC,CAAP;AAIA,KALM,CAAP;AAMA;;AAEDzI,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CE,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjG3F,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACAvF,sDAAG,CAAC,wBAAD,EAA2B0F,kBAA3B,CAAH;AAEA,UAAME,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAAI;AAClC,YAAME,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE;AAJG,OAAf;AAMA,aAAO,KAAKd,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0B,MAAMoG,iBAAN,IAA2B;AAC3D,cAAMC,YAAY,GAAG,KAAKC,iBAAL,CAAuBF,iBAAvB,CAArB;;AAEA,YAAIC,YAAY,KAAK,IAAjB,IAAyBA,YAAY,KAAK,KAAKH,oCAAnD,EAAyF;AACxF;AACA9D,gBAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,iBAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AACD,cAAMgpB,eAAe,GAAG,MAAM,KAAKC,4BAAL,CAAkCnpB,IAAlC,EAAwCkE,iBAAxC,CAA9B;AAEA,cAAMI,YAAY,GAAG,MAAM,KAAK2kB,YAAL,EAA3B;AACA/oB,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB4E,YAAhB,CAApB;AACApE,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACAD,cAAM,CAACG,SAAP,GAAmB,KAAKR,eAAL,CAAqBqE,iBAArB,IAA0CglB,eAA1C,GAA4DtpB,kBAA/E;;AAEA,YACCM,MAAM,CAACC,UAAP,GAAoBV,aAApB,IACA;AACCS,cAAM,CAACC,UAAP,KAAsBV,aAAtB,IAAuCS,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDP,0BAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AACD,cAAM,KAAKO,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAN;AACA,eAAO1G,+CAAO,CAACC,OAAR,EAAP;AACA,OAxBM,CAAP;AAyBA,KAhCM,CAAP;AAiCA;;AAED,QAAM2C,UAAN,CAAiBK,KAAjB,EAAwB;AACvB,UAAMyH,iBAAiB,GAAG,MAAM,KAAK3E,SAAL,CAAe9C,KAAK,CAAC,CAAD,CAApB,CAAhC;AACA,UAAM,KAAK0sB,4BAAL,CAAkC1sB,KAAK,CAAC,CAAD,CAAvC,EAA4CyH,iBAA5C,CAAN;AACA,WAAO1K,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED,QAAMkD,sBAAN,GAA+B;AAC9B,UAAMgb,YAAY,GAAG,MAAM,KAAKsR,YAAL,EAA3B;AACA,UAAM;AAAEG,oBAAF;AAAkB/gB,sBAAgB,GAAG,CAArC;AAAwCghB,oBAAxC;AAAwD/gB;AAAxD,QAAgEqP,YAAtE;AACA,WAAOvf,OAAO,CAACgxB,cAAD,CAAP,GAA0BhxB,OAAO,CAACixB,cAAD,CAAjC,GAAoDjxB,OAAO,CAACkQ,GAAD,CAA3D,GAAmElQ,OAAO,CAACiQ,gBAAD,CAAjF;AACA;;AAED3I,YAAU,CAACoD,IAAD,EAAO;AAChB,QAAIA,IAAJ,EAAU;AACT,aAAO1K,OAAO,CAAC0K,IAAI,CAACsmB,cAAN,CAAd;AACA;;AACD,WAAOprB,WAAW,CAACE,cAAc,CAAC,KAAKI,cAAN,CAAf,CAAlB;AACA;;AAEDuB,iBAAe,CAACI,IAAD,EAAO;AACrB,WAAO,CAAC,GAAG/B,cAAc,CAAC,KAAKK,qBAAN,EAA6B0B,IAA7B,EAAmC,IAAnC,CAAlB,EACL+H,MADK,CACE4I,IAAI,IAAIA,IAAI,CAAClV,KAAL,IAAckV,IAAI,CAAChV,WAD7B,EAELgF,GAFK,CAEDgQ,IAAI,IAAIA,IAAI,CAAClV,KAAL,IAAckV,IAAI,CAAChV,WAF1B,EAGL+U,MAHK,CAGE,CAACpP,CAAD,EAAIC,CAAJ,KAAUpJ,OAAO,CAACmJ,CAAD,CAAP,GAAanJ,OAAO,CAACoJ,CAAD,CAHhC,EAGqC,CAHrC,CAAP;AAIA,GAzJuD,CA2JxD;AACA;AACA;;;AACAynB,cAAY,GAAG;AACd,WAAO,KAAKpkB,eAAL,CAAqB,KAAKojB,uBAA1B,EAAmD,KAAKvkB,sBAAxD,EAAgF,KAAKI,iBAArF,CAAP;AACA;;AAEDuB,cAAY,CAACxH,MAAD,EAASsH,UAAT,EAAqB3C,OAArB,EAA8B4C,WAA9B,EAA2CE,QAA3C,EAAqD;AAChE,UAAMC,eAAe,GACpBH,WAAW,IAAIA,WAAW,CAACI,QAAZ,EAAf,GAAyC,GAAEL,UAAW,IAAGC,WAAW,CAACI,QAAZ,EAAuB,EAAhF,GAAoFL,UADrF;AAGA,WAAO,KAAKmkB,gBAAL,GAAwBxrB,IAAxB,CAA6B,MACnCqE,KAAK,CAACoD,eAAD,EAAkB;AACtB1H,YADsB;AAEtB0E,iBAAW,EAAE,SAFS;AAGtBC,aAHsB;AAItBH,UAAI,EAAEiD;AAJgB,KAAlB,CAAL,CAMExH,IANF,CAMO2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EANnB,EAOE5E,IAPF,CAOO2E,QAAQ,IAAI;AACjB;AACA,UAAI;AACH,eAAOgD,IAAI,CAACC,KAAL,CAAWjD,QAAX,CAAP;AACA,OAFD,CAEE,OAAOxJ,CAAP,EAAU;AACX,eAAOwJ,QAAP;AACA;AACD,KAdF,CADM,CAAP;AAiBA,GAvLuD,CAyLxD;;;AACA6mB,kBAAgB,GAAG;AAClB,UAAMzU,UAAU,GAAGtZ,QAAQ,CAACC,aAAT,CAAuB,KAAKqsB,sBAA5B,CAAnB;;AACA,QAAIhT,UAAJ,EAAgB;AACf,YAAMzP,WAAW,GAAG,IAAIxB,eAAJ,CAAoB;AACvC2lB,wBAAgB,EAAE5uB,MAAM,CAACka,UAAU,CAACnZ,KAAZ;AADe,OAApB,CAApB;AAGA,YAAMyY,GAAG,GAAI,GAAE,KAAK+T,oBAAqB,IAAG9iB,WAAW,CAACI,QAAZ,EAAuB,EAAnE;AACA,aAAOrD,KAAK,CAACgS,GAAD,EAAM;AACjBtW,cAAM,EAAE,KADS;AAEjB0E,mBAAW,EAAE;AAFI,OAAN,CAAL,CAGJzE,IAHI,CAGC2E,QAAQ,IAAIA,QAAQ,CAACkD,IAAT,EAHb,CAAP;AAIA;;AACD,WAAOnM,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED+vB,yBAAuB,CAAC5kB,YAAD,EAAe;AACrC,UAAM6kB,iBAAiB,GAAGvrB,cAAc,CAAC,KAAKqqB,oBAAN,EAA4B3jB,YAA5B,CAAxC;AACA,UAAM8kB,YAAY,GAAGD,iBAAiB,GAAGhkB,IAAI,CAACC,KAAL,CAAW+jB,iBAAiB,CAAC7tB,WAAlB,CAA8BuF,IAA9B,EAAX,CAAH,GAAsD,IAA5F;AACA,WAAOuoB,YAAY,IAAIA,YAAY,CAACC,WAA7B,GAA2CD,YAAY,CAACC,WAAb,CAAyB,CAAzB,CAA3C,GAAyE,IAAhF,CAHqC,CAGiD;AACtF;;AAEDC,gCAA8B,CAACC,YAAD,EAAe;AAC5C,UAAMzkB,WAAW,GAAG,IAAIxB,eAAJ,CAAoB;AACvCkmB,+BAAyB,EAAED,YADY;AAEvCxxB,YAAM,EAAE;AAF+B,KAApB,CAApB;AAIA,UAAM8b,GAAG,GAAI,GAAE,KAAK4T,uBAAwB,IAAG3iB,WAAW,CAACI,QAAZ,EAAuB,EAAtE;AACA,WAAOrD,KAAK,CAACgS,GAAD,EAAM;AACjBtW,YAAM,EAAE,KADS;AAEjB0E,iBAAW,EAAE;AAFI,KAAN,CAAL,CAGJzE,IAHI,CAGC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAHb,CAAP;AAIA,GAzNuD,CA2NxD;AACA;;;AACAqnB,gBAAc,CAACnlB,YAAD,EAAe;AAC5B,UAAMolB,mBAAmB,GAAG,CAAC,GAAG9rB,cAAc,CAAC,KAAKwqB,6BAAN,EAAqC9jB,YAArC,EAAmD,IAAnD,CAAlB,EAA4E7C,IAA5E,CAC3B6O,IAAI,IAAIA,IAAI,CAAChV,WAAL,CAAiBG,KAAjB,CAAuB,KAAK4sB,wBAA5B,CADmB,CAA5B;AAGA,UAAMsB,oBAAoB,GAAGD,mBAAmB,GAC7CrvB,MAAM,CAACqvB,mBAAmB,CAACpuB,WAApB,CAAgCG,KAAhC,CAAsC,KAAK4sB,wBAA3C,EAAqE,CAArE,CAAD,CADuC,GAE7C,CAFH;AAIA,WAAO,CAAC,GAAGzqB,cAAc,CAAC,KAAKsqB,oBAAN,EAA4B5jB,YAA5B,EAA0C,IAA1C,CAAlB,EACLhE,GADK,CACDgQ,IAAI,IAAIA,IAAI,CAACjV,YAAL,CAAkB,IAAlB,CADP,EAELuuB,KAFK,CAEC,CAFD,EAEID,oBAFJ,EAGLrpB,GAHK,CAGDupB,MAAM,IAAIA,MAAM,CAACpuB,KAAP,CAAa,KAAK0sB,eAAlB,EAAmC,CAAnC,CAHT,CAAP;AAIA;;AAED2B,gCAA8B,CAAC/nB,IAAD,EAAOwnB,YAAP,EAAqB;AAClD,UAAMzkB,WAAW,GAAG,IAAIxB,eAAJ,CAAoB;AACvCkmB,+BAAyB,EAAED,YADY;AAEvCQ,yBAAmB,EAAE;AAFkB,KAApB,CAApB;AAIA,UAAMlW,GAAG,GAAI,GAAE,KAAK6T,uBAAwB,IAAG5iB,WAAW,CAACI,QAAZ,EAAuB,EAAtE;AACA,WAAOrD,KAAK,CAACgS,GAAD,EAAM;AACjBtW,YAAM,EAAE,MADS;AAEjB0E,iBAAW,EAAE,SAFI;AAGjBF,UAAI,EAAEoD,IAAI,CAAC0R,SAAL,CAAe9U,IAAf;AAHW,KAAN,CAAL,CAIJvE,IAJI,CAIC2E,QAAQ,IAAIA,QAAQ,CAACkD,IAAT,EAJb,CAAP;AAKA;;AAED,QAAMwjB,4BAAN,CAAmCnpB,IAAnC,EAAyCkE,iBAAzC,EAA4D;AAC3D,UAAM2lB,YAAY,GAAG,KAAKL,uBAAL,CAA6BtlB,iBAA7B,CAArB;;AACA,QAAIglB,eAAe,GAAG,CAAtB;;AACA,QAAIW,YAAJ,EAAkB;AACjB,YAAMS,cAAc,GAAG,MAAM,KAAKV,8BAAL,CAAoCC,YAApC,CAA7B;AACA,YAAMU,aAAa,GAAG,MAAM,KAAKR,cAAL,CAAoBO,cAApB,CAA5B;AACA,YAAME,aAAa,GAAGD,aAAa,CAAC3pB,GAAd,CAAkBgQ,IAAI,IAAI;AAC/C,eAAO;AACN6Z,iBAAO,EAAE;AACRC,mBAAO,EAAE,EADD;AAERC,eAAG,EAAE/Z,IAFG;AAGRga,uBAAW,EAAE,EAHL;AAIRC,eAAG,EAAE;AAJG;AADH,SAAP;AAQA,OATqB,CAAtB;;AAUA,UAAIL,aAAa,CAAC3nB,MAAlB,EAA0B;AACzB,cAAM;AAAEwO;AAAF,YAAc,MAAM,KAAK+Y,8BAAL,CAAoC;AAAEI;AAAF,SAApC,EAAuDX,YAAvD,CAA1B;;AACA,YAAIxY,OAAJ,EAAa;AACZnX,4DAAG,CAAE,KAAIswB,aAAa,CAAC3nB,MAAO,8DAA6D7C,IAAK,EAA7F,CAAH;AACAkpB,yBAAe,GAAGsB,aAAa,CAAC3nB,MAAhC;AACA;AACD;AACD;;AACD,WAAOqmB,eAAe,IAAI,CAA1B;AACA;;AAEDJ,eAAa,CAAC3U,GAAG,GAAG,KAAKgU,0BAAZ,EAAwC;AACpD,WAAOhmB,KAAK,CAACgS,GAAD,EAAM;AACjBtW,YAAM,EAAE,KADS;AAEjB0E,iBAAW,EAAE;AAFI,KAAN,CAAL,CAGJzE,IAHI,CAGC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAHb,CAAP;AAIA;;AAxRuD,CAAzD;AA2Re;AACduD,MAAI,EAAE,SADQ;AAEd5M,QAAM,EAAE,YAFM;AAGduN,QAHc;AAIdwC,iBAAe,EAAE,IAJH;AAKdyB,kBAAgB,EAAEC,wDAAiB,CAACC;AALtB,CAAf,E;;;;;;;;;;;;ACrTA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM;AAAE9M,mBAAF;AAAqBC;AAArB,IAAwCC,0CAA9C;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AAEA,MAAMyyB,QAAQ,GAAG,0BAAjB;AACA,MAAMvnB,aAAa,GAAI,GAAEunB,QAAS,OAAlC;AAEA;;;;;;;;;;;;;;AAcA,MAAMlkB,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,2BAAtB;AACA,SAAK8E,sBAAL,GAA8B,oBAA9B;AACA,SAAK7E,qBAAL,GAA6B,WAA7B;AACA,SAAKsI,mBAAL,GAA2B,mDAA3B;AACA,SAAKgJ,mBAAL,GAA2B,aAA3B;AAEA,SAAK/I,iBAAL,GAAyB,wBAAzB;AACA,SAAKC,0BAAL,GAAkC,iCAAlC;AACA,SAAKC,YAAL,GAAoB,yBAApB;AAEA,SAAKyG,sBAAL,GAA8B,eAA9B;AAEA,UAAM/D,QAAQ,GAAI,GAAEohB,QAAS,kDAA7B;AACA,SAAK7nB,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKgc,gBAAL,GAAyB,GAAEoF,QAAS,iBAApC;AAEA,SAAKvnB,aAAL,GAAqBA,aAArB;AACA,SAAKD,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAKqS,yBAAL,GAAiC,gBAAjC;AAEA,SAAKlS,qBAAL,GAA6B;AAC5B,0BAAoB;AADQ,KAA7B;AAIA,SAAKG,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA;;AAED/F,iBAAe,GAAG;AACjB,UAAMlE,QAAQ,GAAG,MAAMkE,eAAN,EAAjB;AAEA4O,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAEhT,QADO;AAEvBiT,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAED7O,gBAAc,GAAG;AAChB,WAAOvB,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,KAAoD,CAACtL,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAA5D;AACA;;AAEDtT,kBAAgB,GAAG;AAClB,WAAO,KAAKopB,eAAL,GAAuB7nB,IAAvB,CAA4B8G,YAAY,IAAI,CAClD,GAAG,IAAI7D,GAAJ,CACF,CAAC,GAAG7C,cAAc,CAAC,KAAKuP,sBAAN,EAA8B7I,YAA9B,EAA4C,IAA5C,CAAlB,EACEhE,GADF,CACMqH,EAAE,IAAIA,EAAE,CAACtM,YAAH,CAAgB,aAAhB,CADZ,EAEEqM,MAFF,CAESC,EAAE,IAAIC,OAAO,CAACD,EAAD,CAAP,IAAeA,EAAE,KAAK,GAFrC,CADE,CAD+C,CAA5C,CAAP;AAOA;;AAEDxH,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAED2lB,iBAAe,GAAG;AACjB,WAAO,KAAK9gB,eAAL,CAAqB,KAAK6gB,gBAA1B,EAA4C,EAA5C,CAAP;AACA;;AAEDhhB,aAAW,GAAG;AACb,WAAO,KAAKG,eAAL,CAAqB,KAAKtB,aAA1B,EAAyC,EAAzC,EAA6CzF,IAA7C,CAAkDinB,QAAQ,IAAI;AACpE,WAAKgG,YAAL,GAAoBhG,QAApB;AACA,aAAOA,QAAP;AACA,KAHM,CAAP;AAIA;;AAED1gB,iBAAe,GAAG;AACjB,WAAO,KAAKK,WAAL,EAAP;AACA;;AAEDI,kBAAgB,CAAC9E,IAAD,EAAO;AACtB,UAAM+E,eAAe,GAAG,KAAKC,mBAAL,CAAyBhF,IAAzB,EAA+B,KAAK+qB,YAApC,CAAxB;;AACA,QAAI,CAAChmB,eAAL,EAAsB;AACrB;AACA,aAAOvL,OAAO,CAACC,OAAR,EAAP;AACA;;AAED,UAAMwL,iBAAiB,GAAGhH,iBAAiB,CAAC,KAAKS,kBAAN,EAA0B,KAAKqsB,YAA/B,CAA3C;AACA9lB,qBAAiB,CAAC3C,MAAlB,CAAyBK,GAAzB,CAA6BoC,eAA7B,EAA8C,KAAK3F,yBAAnD;AAEA,WAAO,KAAK8F,gBAAL,CAAsBD,iBAAiB,CAAC7C,MAAxC,EAAgD,EAAhD,EAAoD,IAApD,EAA0D6C,iBAAiB,CAAC3C,MAA5E,CAAP;AACA;;AAED3F,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAMuoB,eAAe,GAAG9sB,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAAtC;AACA,YAAMwoB,uBAAuB,GAAG/sB,cAAc,CAAC,KAAK6I,0BAAN,EAAkCtE,QAAlC,CAA9C;AACA,YAAMyoB,UAAU,GAAGhtB,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAAjC;AAEA,YAAM0F,QAAQ,GAAG6iB,eAAe,GAAGhtB,WAAW,CAACgtB,eAAD,CAAd,GAAkC,CAAlE;AACA,YAAM3iB,gBAAgB,GAAG4iB,uBAAuB,GAAGjtB,WAAW,CAACitB,uBAAD,CAAd,GAA0C,CAA1F;AACA,YAAM3iB,GAAG,GAAG4iB,UAAU,GAAGltB,WAAW,CAACktB,UAAD,CAAd,GAA6B,CAAnD;AAEA,aAAO,KAAKxrB,UAAL,CAAgB+C,QAAhB,IAA4B0F,QAA5B,GAAuCG,GAAvC,GAA6CD,gBAApD;AACA,KAVM,CAAP;AAWA;;AAjGuD,CAAzD;AAoGe;AACdpC,MAAI,EAAE,UADQ;AAEd5M,QAAM,EAAE,cAFM;AAGd+P,iBAAe,EAAE,IAHH;AAIdxC;AAJc,CAAf,E;;;;;;;;;;;;AC5HA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAE5I;AAAF,IAAkB3F,6CAAxB;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;;;AAgBA,MAAMyI,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,qBAAtB;AACA,SAAK8E,sBAAL,GAA8B,oBAA9B;AACA,SAAK9D,WAAL,GAAmB,KAAnB;AACA,SAAK6rB,kBAAL,GAA0B,2BAA1B;AACA,SAAKtb,mBAAL,GAA2B,aAA3B;AACA,SAAKub,mBAAL,GAA2B,wBAA3B;AAEA,UAAM1hB,QAAQ,GAAG,gFAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,wBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,sCAAtC;AAEA,SAAKnG,aAAL,GAAqB,qCAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA,SAAKiV,kBAAL,GAA0B,yBAA1B;AACA,SAAKC,uBAAL,GAA+B,wBAA/B;AACA;;AAED/b,gBAAc,GAAG;AAChB,UAAMiS,WAAW,GAAGxT,QAAQ,CAACC,aAAT,CAAwB,GAAE,KAAK2vB,kBAAmB,KAAI,KAAKC,mBAAoB,EAA/E,CAApB;AACA,UAAMzjB,WAAW,GAAGO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAAD,CAA3B;AACA,UAAMjE,OAAO,GAAG1D,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAAD,CAAvB;AAEA,UAAM1F,YAAY,GAAGmW,WAAW,IAAInD,OAAf,IAA0B,CAACjE,WAAhD;AACA,WAAO/O,YAAP;AACA;;AAED6H,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDrD,wBAAsB,GAAG;AACxB;AACA,WAAO,KAAK+H,WAAL,GAAmB5G,IAAnB,CAAwB8G,YAAY,IAAI;AAC9C,YAAMqgB,QAAQ,GAAGjnB,WAAW,CAACE,cAAc,CAAC,KAAK0a,kBAAN,EAA0BhU,YAA1B,CAAf,CAA5B;AACA,YAAM0gB,aAAa,GAAGtnB,WAAW,CAACE,cAAc,CAAC,KAAK2a,uBAAN,EAA+BjU,YAA/B,CAAf,CAAjC;AACA,YAAMygB,UAAU,GAAGJ,QAAQ,IAAI,CAA/B;AACA,YAAMM,eAAe,GAAGD,aAAa,IAAI,CAAzC;AACA,aAAO,KAAK5lB,UAAL,CAAgBkF,YAAhB,IAAgCygB,UAAhC,GAA6CE,eAApD;AACA,KANM,CAAP;AAOA;;AAhDuD,CAAzD;AAmDe;AACdtf,MAAI,EAAE,iBADQ;AAEd5M,QAAM,EAAE,oBAFM;AAGd+P,iBAAe,EAAE,IAHH;AAIdxC;AAJc,CAAf,E;;;;;;;;;;;;ACzEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAM;AAAE7D;AAAF,IAA6B5E,0CAAnC;AAEA;;;;;;;;;;;;;;AAcA,MAAMuL,QAAQ,GAAG,6BAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMnD,gBAAgB,GAAG,wEAAzB;AACA,MAAM0K,uBAAuB,GAAG,2BAAhC;;AACA,MAAMoa,UAAU,GAAG,MAAM9vB,QAAQ,CAACC,aAAT,CAAuByV,uBAAvB,CAAzB;;AAEA,MAAMrK,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AAEA,SAAKiB,WAAL,GAAmB,IAAnB;AAEA,SAAK2D,cAAL,GAAuB,GAAEsD,gBAAiB,iBAA1C;AACA,SAAKpD,kBAAL,GAA2B,GAAEoD,gBAAiB,0BAA9C;AAEA,SAAKhD,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AAEA,SAAKkE,mBAAL,GAA4B,GAAEoK,uBAAwB,0BAAtD;AACA,SAAK5F,cAAL,GAAsB,aAAtB;AACA,SAAKvE,iBAAL,GAAyB,kBAAzB;AACA;;AAEDhK,gBAAc,GAAG;AAChB,UAAMuR,SAAS,GAAG9S,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAAlB;AACA,UAAMgF,OAAO,GAAGtQ,QAAQ,CAACC,aAAT,CAAuB,KAAK6P,cAA5B,CAAhB;AACA,UAAMsD,UAAU,GAAGpT,QAAQ,CAACC,aAAT,CAAuB,KAAKsL,iBAA5B,CAAnB;AACA,WAAOuH,SAAS,IAAI,CAACxC,OAAd,IAAyB,CAAC8C,UAAjC;AACA;;AAEDnS,kBAAgB,GAAG;AAClB,WAAOhD,+CAAO,CAACC,OAAR,GACLqE,IADK,CACA,MAAM;AACX,UAAI,KAAKyG,aAAL,EAAJ,EAA0B;AACzB,eAAOhJ,QAAQ,CAACiJ,eAAT,CAAyBC,SAAhC;AACA;;AACD,aAAO,KAAKC,WAAL,EAAP;AACA,KANK,EAOL5G,IAPK,CAOAmC,IAAI,IAAI;AACb,YAAM0E,oBAAoB,GAAG,KAAKvB,sBAAL,GAC1B,KAAKA,sBADqB,GAE1B,KAAK3E,mBAFR;AAGA,YAAMhC,KAAK,GAAG,CAAC,GAAGsG,sBAAsB,CAAC9C,IAAD,EAAO0E,oBAAP,EAA6B,IAA7B,CAA1B,EAA8D/D,GAA9D,CACbK,OAAO,IAAIA,OAAO,CAACC,SAAR,CAAkBC,IAAlB,GAAyB6L,KAAzB,CAA+B,MAA/B,EAAuC,CAAvC,CADE,CAAd;AAIA,aAAO;AACNvQ,aADM;AAENC,iBAAS,EAAED,KAAK,CAACoG;AAFX,OAAP;AAIA,KAnBK,CAAP;AAoBA;;AAEDpC,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAED7D,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CE,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjG3F,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACAvF,sDAAG,CAAC,wBAAD,EAA2B0F,kBAA3B,CAAH;AAEA,UAAME,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0BoG,iBAAiB,IAAI;AAC9C,YAAMhE,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE;AAJG,OAAf;;AAOA,YAAM8D,YAAY,GAAG,KAAKC,iBAAL,CAAuBF,iBAAvB,CAArB;;AAEA,UAAIC,YAAY,KAAK,IAAjB,IAAyBA,YAAY,KAAK,KAAKH,oCAAnD,EAAyF;AACxF;AACA9D,cAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,eAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AAED,aAAO1G,+CAAO,CAACuP,KAAR,CAAc,IAAd,EACLjL,IADK,CACA,MAAM,KAAKuG,eAAL,EADN,EAELvG,IAFK,CAEAwG,YAAY,IAAI;AACrBpE,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB4E,YAAhB,CAApB;AACApE,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACAD,cAAM,CAACG,SAAP,GAAmB,KAAKR,eAAL,CAAqByE,YAArB,IAAqC1E,kBAAxD;;AAEA,YACCM,MAAM,CAACC,UAAP,GAAoBV,aAApB,IACA;AACCS,cAAM,CAACC,UAAP,KAAsBV,aAAtB,IAAuCS,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDP,0BAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AAED,eAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,OAhBK,CAAP;AAiBA,KAjCD,CADM,EAmCLpC,IAnCK,CAmCA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,WAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,eAAS,EAAEhB,gBAFa;AAGxBL,mBAHwB;AAIxBG;AAJwB,KAAzB,CApCM,CAAP;AA2CA;;AAEDvD,YAAU,CAACgF,cAAD,EAAiB;AAC1B,UAAMvB,gBAAgB,GAAGuB,cAAc,CAACP,SAAxC;AACA,UAAM;AAAErB,mBAAF;AAAiBG;AAAjB,QAAwCyB,cAA9C,CAF0B,CAI1B;;AACAvB,oBAAgB,CAACwB,IAAjB,CAAsB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC/B,UAAIA,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAApB,KAAsC,CAA1C,EAA6C;AAC5C,eAAOoB,CAAC,CAACnB,SAAF,GAAckB,CAAC,CAAClB,SAAvB;AACA;;AACD,aAAOmB,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAA3B;AACA,KALD;AAOA,QAAIqB,YAAY,GAAGhC,aAAnB;AACA,QAAIiC,eAAe,GAAG,CAAtB;AACA,QAAIC,gBAAgB,GAAG,CAAvB;AACA,UAAMC,eAAe,GAAG,EAAxB;AAEA,WAAOpI,+CAAO,CAACuG,IAAR,CAAaD,gBAAb,EAA+Be,QAAQ,IAC7C,KAAKtB,SAAL,CAAesB,QAAQ,CAACb,IAAxB,EACElC,IADF,CACO,MAAMtE,+CAAO,CAACuP,KAAR,CAAc,IAAd,CADb,EAEEjL,IAFF,CAEO,MAAM,KAAKuG,eAAL,EAFb,EAGEvG,IAHF,CAGO8G,YAAY,IAAI;AACrB,YAAMzE,UAAU,GAAG,KAAKT,UAAL,CAAgBkF,YAAhB,CAAnB;AACA,YAAMxE,aAAa,GAAGX,aAAa,GAAGU,UAAtC;AACA,YAAME,SAAS,GAAG,KAAKR,eAAL,CAAqB+E,YAArB,IAAqChF,kBAAvD;AAEA7G,kDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBgH,YAAI,EAAEa,QAAQ,CAACb,IADU;AAEzBG,kBAFyB;AAGzBC,qBAHyB;AAIzBC;AAJyB,OAA1B;;AAOA,UACCF,UAAU,GAAGsB,YAAb,IACA;AACCtB,gBAAU,KAAKsB,YAAf,IAA+BpB,SAAS,GAAGsB,gBAH7C,EAIE;AACDC,uBAAe,CAACpB,IAAhB,CAAqBK,QAAQ,CAACb,IAA9B;AACA0B,uBAAe,GAAGtB,aAAlB;AACAqB,oBAAY,GAAGtB,UAAf;AACAwB,wBAAgB,GAAGtB,SAAnB;AACA,eAAO7G,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,aAAO,KAAKgH,UAAL,CAAgBI,QAAQ,CAACb,IAAzB,EAA+BlC,IAA/B,CAAoC,MAAM;AAChD,YAAI,KAAKmG,4BAAT,EAAuC;AACtC,iBAAOzK,+CAAO,CAACuG,IAAR,CAAa6B,eAAb,EAA8B5B,IAAI,IAAI,KAAKT,SAAL,CAAeS,IAAf,CAAtC,CAAP;AACA;;AACD,eAAOxG,+CAAO,CAACC,OAAR,EAAP;AACA,OALM,CAAP;AAMA,KAhCF,CADM,EAkCLqE,IAlCK,CAkCA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,oBAAV,EAAgC;AAC/ByD,WAAK,EAAEmF,eADwB;AAE/BzB,gBAAU,EAAEsB,YAFmB;AAG/BrB,mBAAa,EAAEsB,eAHgB;AAI/BrB,eAAS,EAAEsB;AAJoB,KAAhC,CAnCM,CAAP;AA0CA;;AAED4C,eAAa,GAAG;AACf,WAAO,CAAC8mB,UAAU,EAAlB;AACA;;AAvKuD,CAAzD;AA0Ke;AACdplB,MAAI,EAAE,SADQ;AAEd5M,QAAM,EAAE,iBAFM;AAGd8P,WAAS,EAAE,IAHG;AAId0B,kBAAgB,EAAEC,wDAAiB,CAACC,OAJtB;AAKdnE,QALc;AAMdwC,iBAAe,EAAE;AANH,CAAf,E;;;;;;;;;;;;ACrMA;AAAA;AAAA;AAEA,MAAMkiB,mBAAmB,GAAG,iCAA5B;AACA;;;;;;;;;;;;;;;;;;;;AAoBA,MAAM1kB,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,+DAAtB;AAEA,UAAMoL,QAAQ,GAAG,uEAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,iBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,8BAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKrG,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AAEA,SAAKoB,kBAAL,GAA0B,IAA1B;AAEA,SAAKiL,qBAAL,GAA6B,oBAA7B;AACA;;AAEDxS,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKgO,qBAA/B,CAAJ,EAA2DpO,GAA3D,CAA+DqH,EAAE,IAC9EA,EAAE,CAACtM,YAAH,CAAgB,kBAAhB,CADa,CAAd;AAIA,WAAO;AACNc,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDpC,YAAU,CAACT,IAAD,EAAO;AAChB,QAAI,KAAKsD,sBAAT,EAAiC;AAChC,WAAKO,iBAAL,CAAuBlB,GAAvB,CAA2B,KAAKW,sBAAhC,EAAwDtD,IAAxD;AACA;;AAED,WAAO,KAAKkF,gBAAL,CAAsB,KAAKhC,eAA3B,EAA4C,KAAKO,sBAAjD,EAAyE,KAAKI,iBAA9E,CAAP;AACA;;AArCuD,CAAzD;AAwCe;AACdoC,MAAI,EAAE,SADQ;AAEd5M,QAAM,EAAE,aAFM;AAGduN,QAHc;;AAIde,aAAW,GAAG;AACb,WAAO,CAAC,CAACpM,QAAQ,CAACC,aAAT,CAAuB,mBAAvB,CAAT;AACA,GANa;;AAOd2O,aAAW,CAAC/D,IAAD,EAAO;AACjB,WAAOA,IAAI,CAACC,UAAL,CAAgB,iCAAhB,KAAsD,CAAC9K,QAAQ,CAACC,aAAT,CAAuB8vB,mBAAvB,CAA9D;AACA;;AATa,CAAf,E;;;;;;;;;;;;AC/DA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM1kB,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKkR,YAAL,GAAoBrJ,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,OAA9B,CAApB;AACA,SAAK4kB,sBAAL,GAA8B,uDAA9B;AACA,SAAKC,gBAAL,GAAwBtlB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,kBAA9B,CAAxB;AAEA,SAAKrI,cAAL,GAAsB,0BAAtB;AACA,UAAMoL,QAAQ,GACb,oGADD;AAEA,SAAKpK,WAAL,GAAmB,IAAnB;AAEA,SAAK2D,cAAL,GAAsByG,QAAtB;AACA,SAAKxG,eAAL,GAAuBwG,QAAvB;AACA,SAAKvG,kBAAL,GAA0BuG,QAA1B;AAEA,SAAKpG,sBAAL,GAA8B,YAA9B;AAEA,SAAKK,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKgB,gBAAL,CAAsBhB,GAAtB,CAA0B,MAA1B,EAAkC,KAAlC;AAEA,SAAKmB,iBAAL,CAAuBnB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AAEA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,MAA3B,EAAmC,QAAnC;AACA;;AAEDnG,kBAAgB,GAAG;AAClB,QAAIC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,8BAA1B,CAAJ,EAA+DJ,GAA/D,CAAmEqH,EAAE,IAChFA,EAAE,CAACtM,YAAH,CAAgB,aAAhB,CADW,CAAZ;AAGAc,SAAK,GAAG,CAAC,GAAG,IAAIsE,GAAJ,CAAQtE,KAAR,CAAJ,CAAR;AACA,WAAO;AACNA,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDjG,iBAAe,GAAG;AACjB,QAAI6uB,iBAAiB,GAAG,IAAxB;AACA,UAAMC,UAAU,GAAG/yB,WAAW,CAAC,MAAM;AACpC;AACA;AACA,YAAMgzB,iBAAiB,GAAGzjB,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,KAAK+vB,sBAA5B,CAAD,CAAjC;AACA,YAAMK,iBAAiB,GAAGD,iBAAiB,KAAKF,iBAAhD;AACA,YAAMI,kBAAkB,GAAG,KAAKtc,YAAL,IAAqB,KAAKic,gBAArD;;AACA,UAAIK,kBAAkB,IAAIF,iBAAtB,IAA2CC,iBAA/C,EAAkE;AACjE7yB,oDAAG,CAACC,KAAJ,CAAU,aAAV;AACAF,qBAAa,CAAC4yB,UAAD,CAAb;AACA;;AACDD,uBAAiB,GAAGE,iBAApB;AACA,KAX6B,EAW3B,IAX2B,CAA9B;AAYA;;AApDuD,CAAzD;AAuDe;AACd1lB,MAAI,EAAE,SADQ;AAEd5M,QAAM,EAAE,iBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdxC,QALc;;AAMduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACCA,IAAI,CAACC,UAAL,CACC,+FADD,KAEKD,IAAI,CAACC,UAAL,CAAgB,kCAAhB,CAHN;AAKA;;AAZa,CAAf,E;;;;;;;;;;;;AC1DA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAEnI;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AAEA;;;;;;;;;;;;;;;AAeA,MAAMkL,aAAa,GAAG,iCAAtB;AACA,MAAM6G,iBAAiB,GAAG,qCAA1B;AACA,MAAM9L,cAAc,GAAG,8EAAvB;AAEA,MAAMsI,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsBA,cAAtB;AACA,SAAKG,mBAAL,GAA2B,qBAA3B;AACA,SAAKa,WAAL,GAAmB,IAAnB;AAEA,SAAKwsB,cAAL,GAAsB,cAAtB;AACA,SAAKC,aAAL,GAAqB,oBAArB;AACA,SAAKC,kBAAL,GAA0B,iBAA1B;AACA,SAAKC,cAAL,GAAsB,WAAtB;AAEA,UAAMviB,QAAQ,GAAG,2EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AAEA,SAAKD,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKyD,iBAAL,GAAyB,+BAAzB;AACA,SAAKC,0BAAL,GAAkC,wCAAlC;AACA,SAAKC,YAAL,GAAoB,gCAApB;AAEA,SAAKrD,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA;;AAEDnH,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKvC,mBAA/B,CAAJ,EAAyDmC,GAAzD,CAA6DqH,EAAE,IAAIA,EAAE,CAAC/G,SAAH,CAAaC,IAAb,EAAnE,CAAd;AACA,WAAO;AACN1E,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDpC,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDrD,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0F,QAAQ,GAAGnK,WAAW,CAACE,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAAf,CAAX,IAAiE,CAAlF;AACA,YAAM2F,kBAAkB,GAAGlK,cAAc,CAAC,KAAK6I,0BAAN,EAAkCtE,QAAlC,CAAzC;AACA,YAAM4F,gBAAgB,GAAGD,kBAAkB,GAAGpK,WAAW,CAACoK,kBAAD,CAAX,IAAmC,CAAtC,GAA0C,CAArF;AACA,YAAME,GAAG,GAAGtK,WAAW,CAACE,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAAf,CAAX,IAA4D,CAAxE;;AACA,YAAMsZ,UAAU,GAAG,KAAKmQ,eAAL,CAAqBzpB,QAArB,CAAnB;;AACA,YAAMoZ,QAAQ,GAAGE,UAAU,GAAG/d,WAAW,CAAC+d,UAAD,CAAd,GAA6B,CAAxD;AACA,aAAO,KAAKrc,UAAL,CAAgB+C,QAAhB,IAA4B0F,QAA5B,GAAuCG,GAAvC,GAA6CuT,QAA7C,GAAwDxT,gBAA/D;AACA,KARM,CAAP;AASA;;AAED6jB,iBAAe,CAACzpB,QAAD,EAAW;AACzB,UAAM0pB,QAAQ,GAAG,CAAC,GAAGjuB,cAAc,CAAC,KAAK6tB,aAAN,EAAqBtpB,QAArB,EAA+B,IAA/B,CAAlB,EAAwDuF,MAAxD,CAA+DC,EAAE,IAAI;AACrF,YAAMmkB,KAAK,GAAGnkB,EAAE,CAACzM,aAAH,CAAiB,KAAKwwB,kBAAtB,CAAd;AACA,aAAOI,KAAK,IAAIA,KAAK,CAACxwB,WAAN,CAAkBG,KAAlB,CAAwB,KAAKkwB,cAA7B,CAAhB;AACA,KAHgB,EAGd,CAHc,CAAjB;AAIA,WAAOE,QAAQ,GAAGA,QAAQ,CAAC3wB,aAAT,CAAuB,KAAKswB,cAA5B,CAAH,GAAiD,IAAhE;AACA;;AA1DuD,CAAzD;AA6De;AACd7lB,MAAI,EAAE,cADQ;AAEd5M,QAAM,EAAE,gBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;;AAKde,aAAW,GAAG;AACb,WAAOpM,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAP;AACA,GAPa;;AAQd2O,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACC,CAAEA,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KAAkChI,QAAQ,CAACC,aAAT,CAAuB,6BAAvB,CAAnC,IACA4K,IAAI,CAACC,UAAL,CAAgB+D,iBAAhB,CADA,IAEAhE,IAAI,CAACO,QAAL,CAAc,iBAAd,CAFA,IAGAP,IAAI,CAACO,QAAL,CAAc,iBAAd,CAHA,IAIAP,IAAI,CAACO,QAAL,CAAc,wBAAd,CAJD,KAKApL,QAAQ,CAACC,aAAT,CAAuB8C,cAAvB,CALA,IAMAN,WAAW,CAACzC,QAAQ,CAACC,aAAT,CAAuB8C,cAAvB,CAAD,CAPZ;AASA;;AAlBa,CAAf,E;;;;;;;;;;;;ACtFA;AAAA;AAAA;AAEA;;;;;;;;;;;;;AAaA,MAAMsI,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,kCAAtB;AACA,SAAK6N,uBAAL,GAA+B,wCAA/B;AACA,SAAKkgB,2BAAL,GAAmC,qBAAnC;AACA,SAAKjgB,+BAAL,GAAuC,2CAAvC;AACA,SAAKkgB,yBAAL,GAAiC,2BAAjC;AACA,SAAKxZ,0BAAL,GAAkC,aAAlC;AAEA,UAAMpJ,QAAQ,GAAG,wEAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,gBAAlC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,yBAAtC;AACA,SAAK6iB,gBAAL,GAAyB,mBAAzB;AAEA,SAAKhpB,aAAL,GAAqB,sCAArB;AAEA,SAAKI,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA;;AAED7F,gBAAc,GAAG;AAChB,UAAMwR,MAAM,GAAGpI,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBJ,WAArB,GAAmCK,UAAnC,CAA8C,KAAK9C,aAAnD,CAAf;AACA,UAAMipB,cAAc,GAAGjxB,QAAQ,CAACC,aAAT,CAAuB,KAAK+wB,gBAA5B,CAAvB;AACA,UAAMtT,aAAa,GAAG,CAAC1d,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,KAA+C,EAAhD,EAAoDuJ,YAA1E;AACA,WAAOyG,MAAM,IAAIke,cAAV,IAA4BvT,aAAnC;AACA;;AAEDzc,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKmL,uBAA/B,CAAJ,EAA6DvL,GAA7D,CACbK,OAAO,IAAIA,OAAO,CAACrF,WAAR,CAAoBuF,IAApB,GAA2B6L,KAA3B,CAAiC,IAAjC,EAAuC,CAAvC,CADE,CAAd;AAIA,WAAO;AACNvQ,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDvG,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAO,KAAKgE,UAAL,CAAgBhE,KAAK,CAAC,CAAD,CAArB,EACLqB,IADK,CACA,MAAM,KAAKuG,eAAL,EADN,EAELvG,IAFK,CAEA2E,QAAQ,IAAI,KAAK/C,UAAL,CAAgB+C,QAAhB,CAFZ,CAAP;AAGA;;AAEDhC,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAED5D,YAAU,CAACK,KAAD,EAAQ;AACjB,QAAIlB,QAAQ,CAACC,aAAT,CAAuB,UAAvB,CAAJ,EAAwC;AACvC;AACA;AACA;AACA0K,YAAM,CAAC+G,OAAP,CAAeC,YAAf,CACChH,MAAM,CAAC+G,OAAP,CAAeE,KADhB,EAECjH,MAAM,CAAC3K,QAAP,CAAgB6R,KAFjB,EAGClH,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqB4G,KAArB,CAA2B,GAA3B,EAAgC,CAAhC,CAHD;AAKA;;AACD,WAAO,KAAKzN,SAAL,CAAe9C,KAAK,CAAC,CAAD,CAApB,CAAP;AACA;;AA5DuD,CAAzD;AA+De;AACdwJ,MAAI,EAAE,WADQ;AAEd5M,QAAM,EAAE,eAFM;AAGduN,QAHc;AAIdwC,iBAAe,EAAE;AAJH,CAAf,E;;;;;;;;;;;;AC9EA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM;AAAElL;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;AAYA,MAAMoF,aAAa,GAAG,6BAAtB;AAEA,MAAMqD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,oBAAtB;AACA,SAAK8E,sBAAL,GAA8B,8CAA9B;AACA,SAAK7E,qBAAL,GAA6B,uDAA7B;AACA,SAAKe,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,sEAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,wBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,sBAAnC;AACA,SAAKvG,kBAAL,GAA0BI,aAA1B;AACA,SAAKuD,iBAAL,GAAyB,uBAAzB;AACA,SAAKE,YAAL,GAAoB,6BAApB;AAEA,SAAKtI,kBAAL,GAA0B,aAA1B;AAEA,SAAK6E,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,QAA9B;AACA,SAAK4D,UAAL,GAAkB,gBAAlB;AACA;;AAED1K,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EAA4DxC,GAA5D,CACboK,WAAW,IAAIA,WAAW,CAACpP,WAAZ,CAAwBG,KAAxB,CAA8B,KAAKmL,UAAnC,EAA+C,CAA/C,CADF,CAAd;AAIA,WAAO;AACNzK,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDlG,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0F,QAAQ,GAAGnK,iEAAW,CAACE,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAAf,CAA5B;AACA,YAAM6K,kBAAkB,GAAG3S,MAAM,CAAC6qB,KAAP,CAAard,QAAb,IAAyB,CAAzB,GAA6BA,QAAxD;AACA,YAAMG,GAAG,GAAGtK,iEAAW,CAACE,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAAf,CAAvB;AACA,YAAM+Q,aAAa,GAAG7Y,MAAM,CAAC6qB,KAAP,CAAald,GAAb,IAAoB,CAApB,GAAwBA,GAA9C;AACA,aAAO,KAAK5I,UAAL,CAAgB+C,QAAhB,IAA4B6K,kBAA5B,GAAiDkG,aAAxD;AACA,KANM,CAAP;AAOA;;AA1CuD,CAAzD;AA6Ce;AACdvN,MAAI,EAAE,QADQ;AAEd5M,QAAM,EAAE,YAFM;AAGdwR,kBAAgB,EAAEC,wDAAiB,CAACC,OAHtB;AAId5B,WAAS,EAAE,IAJG;AAKdvC,QALc;;AAMde,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,YAAvB,CAAD,CAAd;AACA,GARa;;AASd2O,aAAW,CAAC/D,IAAD,EAAO;AACjB,WAAOA,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,CAAP;AACA;;AAXa,CAAf,E;;;;;;;;;;;;ACjEA;AAAA;AAAA;;AAEA,MAAM;AAAEpF,KAAF;AAAO9F;AAAP,IAAkBo0B,mBAAO,CAAC,4CAAD,CAA/B;;AAEA,MAAM;AAAEvuB;AAAF,IAAqBC,GAA3B;AACA,MAAM;AAAEH;AAAF,IAAkB3F,MAAxB;AAEA;;;;;;;;;;;;;AAaA,MAAMqR,QAAQ,GAAG,0BAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMgjB,oBAAoB,GAAI,GAAEhjB,QAAS,oDAAzC;AAEA,MAAM9C,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKE,qBAAL,GAA6B,4DAA7B;AACA,SAAKe,WAAL,GAAmB,IAAnB;AAEA,SAAK2D,cAAL,GAAuB,GAAEypB,oBAAqB,qBAA9C;AACA,SAAKxpB,eAAL,GAAwB,GAAEwpB,oBAAqB,6BAA/C;AACA,SAAKvpB,kBAAL,GAA2B,GAAEupB,oBAAqB,0BAAlD;AACA,SAAKC,eAAL,GAAwB,GAAEjjB,QAAS,qCAAnC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKa,qBAAL,GAA6B;AAC5B,0BAAoB;AADQ,KAA7B;AAIA,SAAKqD,mBAAL,GAA2B,mDAA3B;AACA,SAAK0E,qBAAL,GAA6B,aAA7B;AACA,SAAKsE,mBAAL,GAA2B,aAA3B;AAEA,SAAK9I,0BAAL,GAAkC,wCAAlC;AACA,SAAKD,iBAAL,GAAyB,+BAAzB;AACA,SAAKE,YAAL,GAAoB,gCAApB;AACA,SAAKC,uBAAL,GAA+B,2BAA/B;AACA,SAAKC,UAAL,GAAkB,aAAlB;AAEA,SAAKgK,uBAAL,GAA+B,cAA/B;AACA,SAAKxD,mBAAL,GAA2B,aAA3B;AACA;;AAED5Q,gBAAc,GAAG;AAChB,UAAMsJ,IAAI,GAAGF,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBJ,WAArB,EAAb;AACA,UAAMuH,QAAQ,GAAGnH,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KAAkChI,QAAQ,CAACC,aAAT,CAAuB,KAAKkD,kBAA5B,CAAnD;AACA,UAAMuT,YAAY,GAAG1E,QAAQ,IAAInH,IAAI,CAACO,QAAL,CAAc,4BAAd,CAAZ,IAA2DP,IAAI,CAACO,QAAL,CAAc,UAAd,CAAhF;AACA,UAAMogB,aAAa,GAAGxrB,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAAtB;AACA,UAAM6G,aAAa,GAAGnb,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAAtB;AACA,UAAMjO,YAAY,GAAGqZ,YAAY,IAAI,CAAC8U,aAAjB,IAAkCrQ,aAAvD;AACA,WAAO9d,YAAP;AACA;;AAED,QAAM2D,gBAAN,GAAyB;AACxB,UAAMqwB,aAAa,GAAG,EAAtB;AAEA,UAAM,KAAKC,kBAAL,GAA0B/uB,IAA1B,CAA+B8G,YAAY,IAAI;AACpDgoB,mBAAa,CAACpsB,IAAd,CACC,GAAG,CAAC,GAAGtC,cAAc,CAAC,KAAKgT,uBAAN,EAA+BtM,YAA/B,EAA6C,IAA7C,CAAlB,EACDhE,GADC,CACGqH,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeG,KAAf,CAAqB,KAAK2R,mBAA1B,CADT,EAED1F,MAFC,CAEME,OAFN,EAGDtH,GAHC,CAGGqH,EAAE,IAAIA,EAAE,CAAC,CAAD,CAHX,CADJ;AAMA,KAPK,CAAN;AASA,UAAM,KAAKvD,WAAL,GAAmB5G,IAAnB,CAAwB8G,YAAY,IAAI;AAC7C,YAAMkoB,YAAY,GAAGloB,YAAY,CAAC7I,KAAb,CAAmB,KAAKmL,UAAxB,CAArB;;AACA,UAAI4lB,YAAJ,EAAkB;AACjBF,qBAAa,CAACpsB,IAAd,CAAmB,GAAG,CAACssB,YAAY,CAAC,CAAD,CAAb,CAAtB;AACA;AACD,KALK,CAAN;AAOA,WAAO,CAAC,GAAG,IAAI/rB,GAAJ,CAAQ6rB,aAAR,CAAJ,CAAP;AACA;;AAEDjwB,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0F,QAAQ,GAAGnK,WAAW,CAACE,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAAf,CAAX,IAAiE,CAAlF;AACA,YAAM2F,kBAAkB,GAAGlK,cAAc,CAAC,KAAK6I,0BAAN,EAAkCtE,QAAlC,CAAzC;AACA,YAAM4F,gBAAgB,GAAGD,kBAAkB,GAAGpK,WAAW,CAACoK,kBAAD,CAAd,GAAqC,CAAhF;AACA,YAAME,GAAG,GAAGtK,WAAW,CAACE,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAAf,CAAX,IAA4D,CAAxE;AACA,aAAO,KAAK/C,UAAL,CAAgB+C,QAAhB,IAA4B0F,QAA5B,GAAuCG,GAAvC,GAA6CD,gBAApD;AACA,KANM,CAAP;AAOA;;AAED5H,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAED6sB,oBAAkB,GAAG;AACpB,WAAO1qB,KAAK,CAAC,KAAKwqB,eAAN,EAAuB;AAClC9uB,YAAM,EAAE,KAD0B;AAElC0E,iBAAW,EAAE;AAFqB,KAAvB,CAAL,CAGJzE,IAHI,CAGC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAHb,CAAP;AAIA;;AApFuD,CAAzD;AAuFe;AACduD,MAAI,EAAE,UADQ;AAEd5M,QAAM,EAAE,cAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdxC;AALc,CAAf,E;;;;;;;;;;;;AC/GA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM;AAAE1I;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AAEA;;;;;;;;;;;;;;;;;;AAkBA,MAAM00B,aAAa,GAAG,wBAAtB;AACA,MAAMxpB,aAAa,GAAI,GAAEwpB,aAAc,OAAvC;AAEA,MAAMnmB,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,2BAAtB;AACA,SAAK0uB,mBAAL,GAA2B,2CAA3B;AACA,SAAK5pB,sBAAL,GAA8B,0DAA9B;AAEA,SAAK8N,uBAAL,GAA+B,wBAA/B;AACA,SAAKC,oBAAL,GAA4B,oBAA5B;AAEA,SAAK7R,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,uEAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,wBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,gCAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKG,qBAAL,GAA6B;AAC5B,0BAAoB;AADQ,KAA7B;AAGA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKqM,mBAAL,GAA2B,aAA3B;AAEA,SAAKlM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA;;AAED7G,gBAAc,GAAG;AAChB;AACA,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAM2F,OAAO,GAAG,CAAC5N,cAAc,CAAC,qEAAD,CAAd,IAAyF,EAA1F,EACd2J,YADF;AAEA,UAAMoI,SAAS,GAAG1U,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAAlB;AACA,UAAMvB,MAAM,GAAGlI,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,CAAf;AACA,UAAM0pB,UAAU,GAAG7mB,IAAI,CAACC,UAAL,CAAgB0mB,aAAhB,KAAkC3mB,IAAI,CAACrK,KAAL,CAAW,8CAAX,CAArD;AACA,UAAMmxB,kBAAkB,GAAG9mB,IAAI,CAACO,QAAL,CAAc,kBAAd,CAA3B;AACA,UAAMwmB,kBAAkB,GAAG,CAACjvB,cAAc,CAAC,wBAAD,CAAd,IAA4C,EAA7C,EAAiD2J,YAA5E;AACA,WAAO,CAAE,CAACyG,MAAM,IAAI2e,UAAX,KAA0BnhB,OAA3B,IAAwCohB,kBAAkB,IAAIC,kBAA/D,KAAuF,CAACld,SAA/F;AACA;;AAED1T,kBAAgB,GAAG;AAClB,WAAO,KAAK6wB,gBAAL,GAAwBtvB,IAAxB,CAA6B8G,YAAY,IAAI;AACnD,aAAO,CACN,GAAG,IAAI7D,GAAJ,CACF,CAAC,GAAG7C,cAAc,CAAC,KAAKgT,uBAAN,EAA+BtM,YAA/B,EAA6C,IAA7C,CAAlB,EACEhE,GADF,CACMqH,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeG,KAAf,CAAqB,KAAKoV,oBAA1B,CADZ,EAEEnJ,MAFF,CAESE,OAFT,EAGEtH,GAHF,CAGMqH,EAAE,IAAIA,EAAE,CAAC,CAAD,CAHd,CADE,CADG,CAAP;AAQA,KATM,CAAP;AAUA;;AAEDzL,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EACZxC,GADY,CACRoK,WAAW,IACfA,WAAW,IAAIA,WAAW,CAACrP,YAAZ,CAAyB,iBAAzB,CAAf,GACGqP,WAAW,CAACrP,YAAZ,CAAyB,iBAAzB,CADH,GAEGqP,WAAW,CAAC9J,SAAZ,CAAsBC,IAAtB,EAJS,EAMZ6G,MANY,CAMLE,OANK,CAAd;AAQA,WAAO;AACNzL,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAED3G,kBAAgB,GAAG;AAClB;AACA,QAAIgK,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,iBAA9B,CAAJ,EAAsD;AACrDT,YAAM,CAAC+G,OAAP,CAAeC,YAAf,CAA4BhH,MAAM,CAAC+G,OAAP,CAAeE,KAA3C,EAAkDjH,MAAM,CAAC3K,QAAP,CAAgB6R,KAAlE,EAAyE,KAAK7J,aAA9E;AACA;;AACD,WAAO/J,+CAAO,CAACC,OAAR,EAAP;AACA;;AAEDiG,YAAU,CAACO,IAAD,EAAO;AAChB;AACA,WAAOA,IAAI,GAAG,MAAMP,UAAN,CAAiBO,IAAjB,CAAH,GAA4BjC,WAAW,CAACE,cAAc,CAAC,KAAK8uB,mBAAN,CAAf,CAAlD;AACA;;AAEDI,kBAAgB,GAAG;AAClB,WAAOjrB,KAAK,CAAE,GAAE4qB,aAAc,GAAlB,EAAsB;AACjClvB,YAAM,EAAE,KADyB;AAEjC0E,iBAAW,EAAE;AAFoB,KAAtB,CAAL,CAGJzE,IAHI,CAGC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAHb,CAAP;AAIA;;AA3FuD,CAAzD;AA8Fe;AACduD,MAAI,EAAE,QADQ;AAEd5M,QAAM,EAAE,YAFM;AAGdwR,kBAAgB,EAAEC,wDAAiB,CAACC,OAHtB;AAId5B,WAAS,EAAE,IAJG;AAKdC,iBAAe,EAAE,IALH;AAMdxC;AANc,CAAf,E;;;;;;;;;;;;AC1HA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAE5I;AAAF,IAAkB3F,6CAAxB;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;;;;;AAkBA,MAAMuL,QAAQ,GAAG,gCAAjB;AACA,MAAMnD,gBAAgB,GAAI,GAAEmD,QAAS,wDAArC;AAEA,MAAM9C,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,uBAAtB;AACA,SAAK0I,YAAL,GAAoB,kDAApB;AACA,SAAKF,iBAAL,GAAyB,6CAAzB;AAEA,SAAKvI,qBAAL,GAA6B,oBAA7B;AAEA,SAAKC,uBAAL,GAA+B,yCAA/B;AACA,SAAKC,mBAAL,GAA2B,+BAA3B;AAEA,SAAKwE,cAAL,GAAuB,GAAEsD,gBAAiB,qBAA1C;AACA,SAAKpD,kBAAL,GAA2B,GAAEoD,gBAAiB,0BAA9C;AACA,SAAKhD,aAAL,GAAsB,GAAEmG,QAAS,OAAjC,CAba,CAeb;;AACA,SAAK2jB,kBAAL,GAA0B,CAAE,GAAE3jB,QAAS,WAAb,EAA0B,GAAEA,QAAS,WAArC,EAAkD,GAAEA,QAAS,UAA7D,CAA1B;AAEA,SAAKpK,WAAL,GAAmB,IAAnB;AACA,SAAK+D,qBAAL,GAA6B,YAA7B;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AAEA,SAAKsB,4BAAL,GAAoC,IAApC;AACA,SAAKqpB,mBAAL,GAA2B,mDAA3B;AAEA,SAAKzd,mBAAL,GAA2B,sBAA3B;AACA,SAAKkE,qBAAL,GAA6B,kEAA7B;AACA;;AAEDtT,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDlD,gBAAc,GAAG;AAChB;AACA,UAAMwR,MAAM,GAAGpI,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,KAAK9C,aAArC,CAAf;AACA,UAAM0pB,UAAU,GACf/mB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,KAAK+D,iBAArC,KACAlE,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAiC,GAAEE,gBAAiB,qBAApD,CAFD;AAIA,UAAM8H,SAAS,GAAG9S,QAAQ,CAACC,aAAT,CAAuB,KAAK8xB,mBAA5B,CAAlB;AAEA,UAAMC,YAAY,GAAGhyB,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAArB;AAEA,WACC,CAACvB,MAAM,IAAI2e,UAAX,KACA5e,SADA,IAEAA,SAAS,CAACxG,YAFV,IAGA,EAAE0lB,YAAY,IAAIA,YAAY,CAAC1lB,YAA/B,CAJD;AAMA;;AAEDlL,wBAAsB,GAAG;AACxB,WAAO,KAAKiO,eAAL,GAAuB9M,IAAvB,CAA4B8G,YAAY,IAAI;AAClD,YAAMqH,eAAe,GAAGlR,QAAQ,IAAIiD,WAAW,CAACE,cAAc,CAACnD,QAAD,EAAW6J,YAAX,CAAf,CAA/C;;AAEA,YAAM0D,GAAG,GAAG2D,eAAe,CAAC,KAAKjF,YAAN,CAAf,IAAsC,CAAlD;AACA,YAAMmB,QAAQ,GAAG8D,eAAe,CAAC,KAAKnF,iBAAN,CAAf,IAA2C,CAA5D;AACA,YAAMoF,KAAK,GAAGD,eAAe,CAAC,KAAK3N,cAAN,CAA7B;AAEA,aAAO4N,KAAK,GAAG/D,QAAR,GAAmBG,GAA1B;AACA,KARM,CAAP;AASA;;AAEDsC,iBAAe,GAAG;AACjB,WAAOzI,KAAK,CAAE,GAAEuH,QAAS,QAAb,EAAsB;AACjCnH,iBAAW,EAAE,SADoB;AAEjC1E,YAAM,EAAE;AAFyB,KAAtB,CAAL,CAGJC,IAHI,CAGC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAHb,CAAP;AAIA;;AAED6B,eAAa,GAAG;AACf,WAAO,KAAK8oB,kBAAL,IAA2B9xB,QAAQ,CAACC,aAAT,CAAuB,KAAKuY,qBAA5B,CAAlC;AACA;;AA3EuD,CAAzD;AA8Ee;AACd9N,MAAI,EAAE,kBADQ;AAEd5M,QAAM,EAAE,oBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;AAKdiE,kBAAgB,EAAEC,wDAAiB,CAACC,OALtB;AAMd3B,iBAAe,EAAE;AANH,CAAf,E;;;;;;;;;;;;ACzGA;AAAA;AAAA;AAEA,MAAMxC,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AAEA,SAAKiB,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,2EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,iBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,oBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKpG,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AACA;;AAEDnG,kBAAgB,GAAG;AAClB,QAAIC,KAAK,GAAG,EAAZ;;AACA,QAAIyJ,MAAM,CAACC,QAAP,CAAgBwL,QAAhB,CAAyBhL,QAAzB,CAAkC,OAAlC,CAAJ,EAAgD;AAC/ClK,WAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,oBAA1B,CAAJ,EAAqDJ,GAArD,CAAyD2S,IAAI,IAAIA,IAAI,CAACrS,SAAL,CAAeC,IAAf,EAAjE,CAAR;AACA,KAFD,MAEO;AACN,YAAMU,aAAa,GAAG,CAAC,GAAGtG,QAAQ,CAACyF,gBAAT,CAA0B,mBAA1B,CAAJ,EAAoDJ,GAApD,CAAwDqH,EAAE,IAC/EA,EAAE,CAACtM,YAAH,CAAgB,iBAAhB,CADqB,CAAtB;AAGAc,WAAK,GAAG,CAAC,GAAG,IAAIsE,GAAJ,CAAQc,aAAR,CAAJ,CAAR;AACA;;AAED,WAAO;AACNpF,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAhCuD,CAAzD;AAmCe;AACdoD,MAAI,EAAE,SADQ;AAEd5M,QAAM,EAAE,aAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;;AAKduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACCA,IAAI,CAACC,UAAL,CAAgB,oCAAhB,KACAD,IAAI,CAACC,UAAL,CAAgB,uCAAhB,CAFD;AAIA;;AAVa,CAAf,E;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM;AAAEnI;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AAEA,MAAM8c,QAAQ,GAAG,+BAAjB;AACA,MAAMtF,mBAAmB,GAAG,aAA5B;AAEA;;;;;;;;;;;;;;;;;AAiBA,MAAMjJ,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AAEA,UAAMqL,QAAQ,GAAG,4EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,iBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,oCAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKpK,WAAL,GAAmB,IAAnB;AAEA,SAAKhB,cAAL,GAAsB,2BAAtB;AAEA,SAAKgF,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAK7E,uBAAL,GAA+B,aAA/B;AACA,SAAKC,mBAAL,GAA2B,aAA3B;AACA,SAAKyI,UAAL,GAAkB,6BAAlB;AAEA,SAAKvD,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AAEA,SAAKsB,4BAAL,GAAoC,IAApC;AAEA,SAAKupB,mBAAL,GAA2B,oBAA3B;AACA,SAAKC,gBAAL,GAAwB,oBAAxB;AACAjiB,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAE,IADO;AAEvBC,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAEDpP,kBAAgB,GAAG;AAClB,WAAO,KAAKmxB,mBAAL,GAA2B5vB,IAA3B,CAAgC8G,YAAY,IAAI;AACtD,YAAM+oB,UAAU,GAAG,CAAC,GAAGzvB,cAAc,CAAC,KAAKsvB,mBAAN,EAA2B5oB,YAA3B,EAAyC,IAAzC,CAAlB,EACjBoD,MADiB,CACVE,OADU,EAEjBtH,GAFiB,CAEb2S,IAAI,IAAIA,IAAI,CAAC5X,YAAL,CAAkB,KAAK8xB,gBAAvB,CAFK,EAGjBzlB,MAHiB,CAGVE,OAHU,CAAnB;AAIA,aAAOylB,UAAP;AACA,KANM,CAAP;AAOA;;AAEDD,qBAAmB,GAAG;AACrB,WAAOvrB,KAAK,CAAC,kCAAD,EAAqC;AAChDtE,YAAM,EAAE,KADwC;AAEhD0E,iBAAW,EAAE;AAFmC,KAArC,CAAL,CAGJzE,IAHI,CAGC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAHb,CAAP;AAIA;;AAEDlG,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKvC,mBAA/B,CAAJ,EACZuJ,MADY,CACL/G,OAAO,IAAIA,OAAO,CAACC,SAAR,CAAkBnF,KAAlB,CAAwB,KAAKmL,UAA7B,CADN,EAEZtG,GAFY,CAERK,OAAO,IAAIA,OAAO,CAACC,SAAR,CAAkBnF,KAAlB,CAAwB,KAAKmL,UAA7B,EAAyC,CAAzC,EAA4C/F,IAA5C,EAFH,EAGZ6G,MAHY,CAGLE,OAHK,CAAd;AAIA,WAAO;AACNzL,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDlG,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0F,QAAQ,GAAG,KAAKylB,iBAAL,CAAuBnrB,QAAvB,EAAiC,oBAAjC,KAA0D,CAA3E;AACA,YAAM6F,GAAG,GAAG,KAAKslB,iBAAL,CAAuBnrB,QAAvB,EAAiC,eAAjC,KAAqD,CAAjE;AACA,aAAO,KAAK/C,UAAL,CAAgB+C,QAAhB,IAA4B0F,QAA5B,GAAuCG,GAA9C;AACA,KAJM,CAAP;AAKA;;AAEDslB,mBAAiB,CAACnrB,QAAD,EAAWorB,KAAX,EAAkB;AAClC,UAAM5sB,OAAO,GAAG,CAAC,GAAG/C,cAAc,CAAC,YAAD,EAAeuE,QAAf,EAAyB,IAAzB,CAAlB,EAAkDV,IAAlD,CAAuDkG,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAe+K,QAAf,CAAwBknB,KAAxB,CAA7D,CAAhB;AACA,WAAO5sB,OAAO,GAAGjD,WAAW,CAACiD,OAAO,CAACiJ,kBAAT,CAAd,GAA6C,CAA3D;AACA;;AAvEuD,CAAzD;AA0Ee;AACdjE,MAAI,EAAE,WADQ;AAEd5M,QAAM,EAAE,cAFM;AAGd8P,WAAS,EAAE,IAHG;AAId0B,kBAAgB,EAAEC,wDAAiB,CAACC,OAJtB;AAKdnE,QALc;;AAMde,aAAW,GAAG;AACb,WAAO,CAACpM,QAAQ,CAACC,aAAT,CAAuBqU,mBAAvB,KAA+C,EAAhD,EAAoDhI,YAA3D;AACA,GARa;;AASdsC,aAAW,CAAC/D,IAAD,EAAO;AACjB,WAAOA,IAAI,CAACC,UAAL,CAAgB8O,QAAhB,KAA6B5Z,QAAQ,CAACC,aAAT,CAAuB,kCAAvB,CAApC;AACA;;AAXa,CAAf,E;;;;;;;;;;;;ACrGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA,MAAM;AAAEwC,aAAF;AAAe5F;AAAf,IAA2BC,6CAAjC;AACA,MAAM;AAAE6F,gBAAF;AAAkBie;AAAlB,IAA+Bhe,0CAArC;AACA,MAAM;AAAE6W,WAAF;AAAakH;AAAb,IAA2BjH,mDAAjC;AAEA;;;;;;;;;;;;;;;;;;;;;AAqBA,MAAM6Y,QAAQ,GAAG,0BAAjB;AACA,MAAM3Y,QAAQ,GAAI,GAAE2Y,QAAS,OAA7B;;AACA,MAAMvgB,QAAQ,GAAG,MAAMrH,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC8O,QAAhC,CAAvB;;AACA,MAAMrF,YAAY,GAAG,MAAM5J,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,UAA9B,CAA3B;;AACA,MAAMonB,uBAAuB,GAAG,MAAMxyB,QAAQ,CAACC,aAAT,CAAuB,eAAvB,CAAtC;;AAEA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKkR,YAAL,GAAoBrJ,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,OAA9B,CAApB;AACA,UAAM+C,QAAQ,GAAI,GAAEokB,QAAS,kDAA7B;AACA,SAAK7qB,cAAL,GAAuB,GAAEyG,QAAS,yBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,4BAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAE2qB,QAAS,OAAtC;AACA,SAAKvqB,aAAL,GAAqB4R,QAArB;AACA,SAAKtO,mBAAL,GAA2B,qBAA3B;AACA,SAAKmnB,cAAL,GAAsB,YAAtB;AACA,SAAKC,YAAL,GAAoB,wBAApB;AACA,SAAKC,qBAAL,GAA6B,8BAA7B;AACA,SAAK9qB,sBAAL,GAA8B,mCAA9B;AACA,SAAKI,qBAAL,GAA6B;AAC5B,sBAAgB;AADY,KAA7B;AAGA,SAAKgZ,2BAAL,GAAmC,qBAAnC;AACA,SAAKD,4BAAL,GAAoC,aAApC;AACA,SAAK9Y,sBAAL,GAA8B;AAC7B,sBAAgB;AADa,KAA9B;AAGA,SAAKM,kBAAL,GAA0B,QAA1B;AACA,SAAKC,oCAAL,GAA4C,SAA5C;AACA,SAAKmqB,sBAAL,GAA8B,oCAA9B;AACA;;AAEDvxB,iBAAe,GAAG;AACjB,UAAMlE,QAAQ,GAAG,MAAMkE,eAAN,EAAjB;AAEA4O,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAEhT,QADO;AAEvBiT,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAED7O,gBAAc,GAAG;AAChB,QAAIyQ,QAAQ,MAAM,CAACyH,SAAS,CAAC,WAAD,CAA5B,EAA2C;AAC1CkH,eAAS,CAAC,WAAD,EAAc,IAAd,EAAoB,EAApB,CAAT;AACA;;AACD,QAAIpM,YAAY,MAAMie,uBAAuB,EAAzC,IAA+C,CAAC/Y,SAAS,CAAC,iBAAD,CAA7D,EAAkF;AACjFkH,eAAS,CAAC,iBAAD,EAAoB,IAApB,EAA0B,EAA1B,CAAT;AACA;;AACD,UAAM7N,SAAS,GAAG,CAAC9S,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,KAAoD,EAArD,EAAyDgB,YAA3E;AACA,UAAM+D,OAAO,GAAGrQ,QAAQ,CAACC,aAAT,CAAuB,KAAKwyB,cAA5B,CAAhB;AACA,UAAMI,KAAK,GAAGpZ,SAAS,CAAC,gBAAD,CAAT,KAAgC,OAA9C;AACA,UAAMiG,WAAW,GAAG1f,QAAQ,CAACC,aAAT,CAAuB,KAAK0yB,qBAA5B,CAApB;AAEA,WACC,CAAC3gB,QAAQ,MAAM0N,WAAf,KACA5M,SADA,IAEAzC,OAFA,IAGAwiB,KAHA,KAIC7gB,QAAQ,KAAK,IAAL,GAAY,CAACyH,SAAS,CAAC,WAAD,CAJ/B,CADD;AAOA;;AAEDxY,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EAA4DxC,GAA5D,CAAgEqH,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeuF,IAAf,EAAtE,CAAd;AAEA,WAAO;AACN1E,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDvG,aAAW,CAACG,KAAD,EAAQ;AAClB,QAAIkD,YAAY,GAAG,IAAnB;AACA,WAAOnG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKS,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B2E,QAAQ,IAAI;AACtC9C,kBAAY,GAAG8C,QAAf;AACA,KAFD,CADM,EAIL3E,IAJK,CAIA,OAAO;AACb2B,mBAAa,EAAE,KAAKC,UAAL,CAAgBC,YAAhB,CADF;AAEbC,wBAAkB,EAAE,KAAKC,eAAL,CAAqBF,YAArB;AAFP,KAAP,CAJA,CAAP;AAQA;;AAEDxD,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CE,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjG3F,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACAvF,sDAAG,CAAC,wBAAD,EAA2B0F,kBAA3B,CAAH;AAEA,UAAME,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAAI;AAClC,YAAME,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE;AAJG,OAAf;;AAMA,UAAI2U,SAAS,CAAC,iBAAD,CAAT,IAAgClF,YAAY,EAAhD,EAAoD;AACnD,eAAOtW,+CAAO,CAACuP,KAAR,CAAc,IAAd,EAAoBjL,IAApB,CAAyB,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAA/B,CAAP;AACA;;AACD,aAAO,KAAKX,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0BoG,iBAAiB,IAAI;AACrD,cAAMC,YAAY,GAAG,KAAKC,iBAAL,CAAuBF,iBAAvB,CAArB;;AAEA,YAAIC,YAAY,KAAK,IAAjB,IAAyBA,YAAY,KAAK,KAAKH,oCAAnD,EAAyF;AACxF;AACA9D,gBAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,iBAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AAEDA,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgBwE,iBAAhB,CAApB;AACAhE,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;;AAEA,YACCD,MAAM,CAACC,UAAP,GAAoBV,aAApB,IACA;AACCS,cAAM,CAACC,UAAP,KAAsBV,aAAtB,IAAuCS,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDP,0BAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AAED,eAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,OArBM,CAAP;AAsBA,KAhCM,CAAP;AAiCA;;AAEDvD,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,aAAOrK,OAAO,CAACqK,QAAQ,CAAC1G,KAAT,CAAe,KAAKoyB,sBAApB,EAA4C,CAA5C,CAAD,CAAd;AACA,KAFM,CAAP;AAGA;;AAED5uB,WAAS,CAACS,IAAD,EAAO;AACf,WAAO,KAAKqF,YAAL,CACN,MADM,EAEN,KAAKpC,cAFC,EAGN,KAAKO,qBAHC,EAIN,IAJM,EAKNiC,IAAI,CAAC0R,SAAL,CAAe;AAAEkX,gBAAU,EAAEruB;AAAd,KAAf,CALM,CAAP;AAOA;;AAEDgd,mBAAiB,CAAChd,IAAD,EAAO;AACvB,UAAMid,YAAY,GAAG1hB,QAAQ,CAACC,aAAT,CAAuB,KAAKghB,2BAA5B,CAArB;AACA,UAAMU,YAAY,GAAG3hB,QAAQ,CAACC,aAAT,CAAuB,KAAK+gB,4BAA5B,CAArB;AAEAJ,YAAQ,CAACc,YAAD,EAAejd,IAAf,CAAR;AAEAkd,gBAAY,CAACpU,KAAb;AACA,WAAOtP,+CAAO,CAACC,OAAR,EAAP;AACA;;AAEDgH,YAAU,CAACT,IAAD,EAAO;AAChB,QAAIgV,SAAS,CAAC,iBAAD,CAAT,IAAgClF,YAAY,EAAhD,EAAoD;AACnD,aAAOtW,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,WAAO,KAAK4L,YAAL,CACN,MADM,EAEN,KAAKnC,eAFC,EAGN,KAAKO,sBAHC,EAIN,IAJM,EAKNgC,IAAI,CAAC0R,SAAL,CAAe;AAAEmX,cAAQ,EAAEtuB;AAAZ,KAAf,CALM,CAAP;AAOA;;AAED5D,YAAU,CAACK,KAAD,EAAQ;AACjB,QAAIuY,SAAS,CAAC,iBAAD,CAAT,IAAgClF,YAAY,EAAhD,EAAoD;AACnD,aAAOtW,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,WAAO8T,QAAQ,KAAK,KAAKhO,SAAL,CAAe9C,KAAK,CAAC,CAAD,CAApB,CAAL,GAAgC,KAAKugB,iBAAL,CAAuBvgB,KAAK,CAAC,CAAD,CAA5B,CAA/C;AACA;;AAEDmxB,mBAAiB,CAACnrB,QAAD,EAAW8rB,MAAX,EAAmB;AACnC,WAAO,CAAC,GAAGrwB,cAAc,CAAC,KAAK+vB,YAAN,EAAoBxrB,QAApB,EAA8B,IAA9B,CAAlB,EACLuF,MADK,CACEuL,IAAI,IAAIA,IAAI,CAACrS,SAAL,CAAeyF,QAAf,CAAwB4nB,MAAxB,CADV,EAEL3tB,GAFK,CAED2S,IAAI,IAAIA,IAAI,CAAC/X,aAAL,CAAmB,KAAKwyB,cAAxB,CAFP,EAEgD,CAFhD,CAAP;AAGA;;AAEDtuB,YAAU,CAACoD,IAAD,EAAO;AAChB,QAAIA,IAAJ,EAAU;AACT,YAAMqF,QAAQ,GAAGrF,IAAI,CAAC0rB,YAAL,IAAqB,CAACjhB,QAAQ,EAA9B,GAAmCzK,IAAI,CAAC0rB,YAAxC,GAAuD,CAAxE;AACA,YAAMlmB,GAAG,GAAGxF,IAAI,CAACwF,GAAL,IAAY,CAACiF,QAAQ,EAArB,GAA0BzK,IAAI,CAACwF,GAA/B,GAAqC,CAAjD;AACA,aAAOlQ,OAAO,CAAC0K,IAAI,CAAC2rB,uBAAN,CAAP,GAAwCr2B,OAAO,CAAC+P,QAAD,CAA/C,GAA4D/P,OAAO,CAACkQ,GAAD,CAA1E;AACA;;AACD,WAAOtK,WAAW,CAAC,KAAK4vB,iBAAL,CAAuB,KAAvB,EAA8B,OAA9B,CAAD,CAAlB;AACA;;AAjLuD,CAAzD;AAoLe;AACd3nB,MAAI,EAAE,UADQ;AAEd5M,QAAM,EAAE,cAFM;AAGdwR,kBAAgB,EAAE0C,QAAQ,KAAKzC,wDAAiB,CAACsS,OAAvB,GAAiCtS,wDAAiB,CAACqS,IAH/D;AAIdvW,QAJc;AAKd8nB,YAAU,EAAE,CALE;AAMdtlB,iBAAe,EAAE;AANH,CAAf,E;;;;;;;;;;;;ACzNA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAM;AAAElL;AAAF,IAAqBC,0CAA3B;AAEA,MAAMoF,aAAa,GAAG,8BAAtB;AACA,MAAM8G,gBAAgB,GAAG,iCAAzB;AACA,MAAMkF,YAAY,GAAGrJ,MAAM,CAACC,QAAP,CAAgBwL,QAAhB,CAAyB3L,WAAzB,GAAuCW,QAAvC,CAAgD,OAAhD,CAArB;AAEA;;;;;;;;;;;;;;AAcA,MAAMC,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKswB,oBAAL,GAA4Bpf,YAAY,GAAG,oBAAH,GAA0B,kBAAlE;AAEA,SAAKqf,eAAL,GAAuB,SAAvB;AACA,SAAKC,mBAAL,GAA2B,qBAA3B;AAEA,SAAKvwB,cAAL,GAAsB,oBAAtB;AACA,SAAKwI,iBAAL,GAAyB,wBAAzB;AACA,SAAKE,YAAL,GAAoB,yBAApB;AAEA,UAAM0C,QAAQ,GAAG,wEAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEmH,gBAAiB,MAA3C;AACA,SAAKlH,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKwM,mBAAL,GAA2B,cAA3B;AACA,SAAKhJ,mBAAL,GAA2B,mEAA3B;AAEA,SAAKlD,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,KAArC;AACA;;AAED7F,gBAAc,GAAG;AAChB,UAAMgyB,eAAe,GAAG,CAACvzB,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,KAAoD,EAArD,EAAyDgB,YAAjF;AACA,UAAMoI,SAAS,GAAG1U,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAAlB;AACA,WAAOif,eAAe,IAAI,CAAC7e,SAA3B;AACA;;AAEDzT,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAK2tB,oBAA/B,CAAJ,EAA0D/tB,GAA1D,CAA8DqH,EAAE,IAAI;AACjF,YAAM8mB,SAAS,GAAGxf,YAAY,GAAG,KAAKqf,eAAR,GAA0B,KAAKC,mBAA7D;AACA,aAAO5mB,EAAE,CAACrM,WAAH,CAAeG,KAAf,CAAqBgzB,SAArB,EAAgC,CAAhC,CAAP;AACA,KAHa,CAAd;AAKA,WAAO;AACNtyB,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAED3G,kBAAgB,GAAG;AAClBgK,UAAM,CAAC+G,OAAP,CAAewa,SAAf,CAAyBvhB,MAAM,CAAC+G,OAAP,CAAeE,KAAxC,EAA+CjH,MAAM,CAAC3K,QAAP,CAAgB6R,KAA/D,EAAsE7J,aAAtE;AACA,WAAO/J,OAAO,CAACC,OAAR,EAAP;AACA;;AAEDkD,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0F,QAAQ,GAAGnK,iEAAW,CAACE,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAAf,CAAX,IAAiE,CAAlF;AACA,YAAM6F,GAAG,GAAGtK,iEAAW,CAACE,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAAf,CAAX,IAA4D,CAAxE;AACA,aAAO,KAAK/C,UAAL,CAAgB+C,QAAhB,IAA4B0F,QAA5B,GAAuCG,GAA9C;AACA,KAJM,CAAP;AAKA;;AAzDuD,CAAzD;AA4De;AACdrC,MAAI,EAAE,SADQ;AAEd5M,QAAM,EAAE,aAFM;AAGduN,QAHc;AAIdiE,kBAAgB,EAAEC,iEAAiB,CAACC,OAJtB;AAKd3B,iBAAe,EAAE,IALH;AAMdC,iBAAe,EAAEkG,YAAY,GAAGrJ,MAAM,CAACC,QAAP,CAAgBC,IAAnB,GAA0B;AANzC,CAAf,E;;;;;;;;;;;;ACrFA;AAAA;AAAA;AAEA;;;;;;;;;;;;;AAaA,MAAMsD,QAAQ,GAAG,4BAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMW,gBAAgB,GAAI,GAAEX,QAAS,UAArC;AACA,MAAMnD,gBAAgB,GAAI,GAAEmD,QAAS,+CAArC;AACA,MAAM7C,mBAAmB,GAAG,wBAA5B;;AACA,MAAM0G,QAAQ,GAAG,MAAMrF,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuBqL,mBAAvB,CAAD,CAA9B;;AAEA,MAAMD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKwI,mBAAL,GAA2B,2BAA3B;AACA,SAAK0E,qBAAL,GAA6B,aAA7B;AACA,SAAKtI,cAAL,GAAuB,GAAEsD,gBAAiB,qBAA1C;AACA,SAAKrD,eAAL,GAAwB,GAAEqD,gBAAiB,6BAA3C;AACA,SAAKpD,kBAAL,GAA2B,GAAEoD,gBAAiB,0BAA9C;AAEA,SAAKhD,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA;;AAEDlD,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDuE,eAAa,GAAG;AACf,WAAOgJ,QAAQ,EAAf;AACA;;AAvBuD,CAAzD;AA0Be;AACdtH,MAAI,EAAE,sBADQ;AAEd5M,QAAM,EAAE,gBAFM;AAGduN,QAHc;;AAIduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACC,CAACA,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KACA6C,IAAI,CAACC,UAAL,CAAgBgE,gBAAhB,CADA,IAEAjE,IAAI,CAACO,QAAL,CAAc,WAAd,CAFA,IAGAP,IAAI,CAACO,QAAL,CAAc,WAAd,CAHA,IAIAP,IAAI,CAACO,QAAL,CAAc,qBAAd,CAJD,KAKApL,QAAQ,CAACC,aAAT,CAAwB,8BAA6BqL,mBAAoB,EAAzE,CAND;AAQA,GAba;;AAcdc,aAAW,GAAG;AACb,WAAOpM,QAAQ,CAACC,aAAT,CAAuB,kBAAvB,CAAP;AACA;;AAhBa,CAAf,E;;;;;;;;;;;;AChDA;AAAA;AAAA;AAEA;;;;;;;;;;;;;;;;AAgBA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,mBAAtB;AACA,SAAK8E,sBAAL,GAA8B,4CAA9B;AACA,SAAK6P,qBAAL,GAA6B,4BAA7B;AACA,SAAKpD,mBAAL,GAA2B,oCAA3B;AACA,SAAKkD,wBAAL,GAAgC,kBAAhC;AACA,SAAKzT,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,2FAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,+BAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,+BAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,wCAAtC;AAEA,SAAKnG,aAAL,GAAqB,uCAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKA,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,cAA9B;AAEA,SAAKK,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AACA,SAAKmB,iBAAL,CAAuBnB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AAEA,SAAKoB,kBAAL,GAA0B,IAA1B;AAEA,SAAKirB,0BAAL,GAAkC,EAAlC;AACA;;AAEDlyB,gBAAc,GAAG;AAChB,UAAMmyB,SAAS,GAAG1zB,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAAlB;AACA,UAAMqf,aAAa,GAAG3zB,QAAQ,CAACC,aAAT,CAAuB,KAAKuX,wBAA5B,CAAtB;AACA,UAAMoc,WAAW,GAAG,CAAC5zB,QAAQ,CAACC,aAAT,CAAuB,KAAKyX,qBAA5B,KAAsD,EAAvD,EAA2DpL,YAA/E;AACA,UAAMsL,iBAAiB,GAAG+b,aAAa,IAAIC,WAA3C;AACA,UAAMv2B,YAAY,GAAG,CAACq2B,SAAD,IAAc9b,iBAAnC;AACA,WAAOva,YAAP;AACA;;AAED4D,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EAA4DxC,GAA5D,CACbK,OAAO,IAAIA,OAAO,CAACgO,OAAR,CAAgBmE,WADd,CAAd;AAIA,WAAO;AACN3W,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAED5G,kBAAgB,GAAG;AAClB,WAAO,KAAKmzB,oBAAL,EAAP;AACA;;AAEDA,sBAAoB,GAAG;AACtB;AACA,WAAO,IAAI51B,OAAJ,CAAYC,OAAO,IAAI;AAC7B41B,YAAM,CAACC,OAAP,CAAeC,SAAf,CAAyBC,WAAzB,CAAqCC,GAAG,IAAIA,GAAG,CAACC,SAAJ,IAAiBj2B,OAAO,EAApE;AACA,aAAOk2B,UAAU,CAAC,MAAMl2B,OAAO,EAAd,EAAkB,KAAKu1B,0BAAL,GAAkC,IAApD,CAAjB;AACA,KAHM,CAAP;AAIA;;AA7DuD,CAAzD;AAgEe;AACd/oB,MAAI,EAAE,mBADQ;AAEd5M,QAAM,EAAE,sBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdslB,YAAU,EAAE,EALE;AAKE;AAChB9nB;AANc,CAAf,E;;;;;;;;;;;;AClFA;AAAA;AAAA;AAAA;AACA;AAEA;;;;;;;;;;;;;AAaA,MAAMknB,QAAQ,GAAG,0BAAjB;AACA,MAAMvqB,aAAa,GAAI,GAAEuqB,QAAS,OAAlC;AACA,MAAMzjB,gBAAgB,GAAI,GAAEyjB,QAAS,UAArC,C,CACA;;AACA,MAAMve,YAAY,GAAG,MAAMhU,QAAQ,CAACC,aAAT,CAAuB,wBAAvB,CAA3B;;AAEA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAK+E,sBAAL,GAA8B,oBAA9B;AAEA,UAAMsG,QAAQ,GAAG,2EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,iBAAlC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKusB,yBAAL,GAAiC,wBAAjC;AACA,SAAKC,6BAAL,GAAqC,2BAArC;AACA,SAAKC,kBAAL,GAA0B,aAA1B;AAEA,SAAKnsB,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA;;AAEDlC,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDuE,eAAa,GAAG;AACf,WAAO2D,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,KAAKo0B,yBAA5B,CAAD,CAAd;AACA;;AA1BuD,CAAzD;AA6Be;AACd3pB,MAAI,EAAE,UADQ;AAEd5M,QAAM,EAAE,cAFM;AAGduN,QAHc;AAIdiE,kBAAgB,EAAEC,iEAAiB,CAACC,OAJtB;AAKd1B,iBAAe,EAAEkG,YAAY,KAAKhM,aAAL,GAAqB8G,gBALpC;;AAMdF,aAAW,GAAG;AACb,WAAO5O,QAAQ,CAACC,aAAT,CAAuB,mDAAvB,CAAP;AACA;;AARa,CAAf,E;;;;;;;;;;;;ACnDA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAE0C;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AAEA;;;;;;;;;;;;;;AAcA,MAAMuO,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,2BAAtB;AAEA,UAAMoL,QAAQ,GAAG,2EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,yBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAK5C,iBAAL,GAAyB,+BAAzB;AACA,SAAKC,0BAAL,GAAkC,wCAAlC;AACA,SAAKC,YAAL,GAAoB,gCAApB;AAEA,SAAK3D,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,UAA9B;AAEA,SAAKK,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AAEA,SAAKoB,kBAAL,GAA0B,IAA1B;AAEA,SAAKiL,qBAAL,GAA6B,eAA7B;AACA;;AAEDxS,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,EAAd;AACA,UAAMuO,WAAW,GAAGzP,QAAQ,CAACC,aAAT,CAAuB,KAAKwT,qBAA5B,CAApB;;AACA,QAAIhE,WAAJ,EAAiB;AAChBvO,WAAK,CAAC+D,IAAN,CAAWwK,WAAW,CAACrP,YAAZ,CAAyB,aAAzB,CAAX;AACA;;AAED,WAAO;AACNc,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAED5G,kBAAgB,GAAG;AAClB,WAAO,KAAKoI,eAAL,GAAuBvG,IAAvB,CAA4B6Z,YAAY,IAAI,KAAKjY,UAAL,CAAgBiY,YAAhB,CAA5C,CAAP;AACA;;AAEDpY,WAAS,CAACS,IAAD,EAAO;AACf,SAAK2D,gBAAL,CAAsBhB,GAAtB,CAA0B,KAAKU,qBAA/B,EAAsDrD,IAAtD;AAEA,WAAO,KAAKkF,gBAAL,CAAsB,KAAKjC,cAA3B,EAA2C,KAAKO,qBAAhD,EAAuE,KAAKG,gBAA5E,CAAP;AACA;;AAEDhH,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0F,QAAQ,GAAGnK,WAAW,CAACE,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAAf,CAAX,IAAiE,CAAlF;AACA,YAAM2F,kBAAkB,GAAGlK,cAAc,CAAC,KAAK6I,0BAAN,EAAkCtE,QAAlC,CAAzC;AACA,YAAM4F,gBAAgB,GAAGD,kBAAkB,GAAGpK,WAAW,CAACoK,kBAAD,CAAX,IAAmC,CAAtC,GAA0C,CAArF;AACA,YAAME,GAAG,GAAGtK,WAAW,CAACE,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAAf,CAAX,IAA4D,CAAxE;AACA,aAAO,KAAK/C,UAAL,CAAgB+C,QAAhB,IAA4B0F,QAA5B,GAAuCG,GAAvC,GAA6CD,gBAApD;AACA,KANM,CAAP;AAOA;;AAxDuD,CAAzD;AA2De;AACdpC,MAAI,EAAE,WADQ;AAEd5M,QAAM,EAAE,cAFM;AAGduN,QAHc;;AAIduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WAAOA,IAAI,CAACC,UAAL,CAAgB,2CAAhB,CAAP;AACA;;AANa,CAAf,E;;;;;;;;;;;;AC/EA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAEnI,gBAAF;AAAkB6E;AAAlB,IAA6C5E,0CAAnD;AACA,MAAM;AAAEH,aAAF;AAAe5F;AAAf,IAA2BC,6CAAjC;AAEA;;;;;;;;;;;;;;;AAeA,MAAMqR,QAAQ,GAAG,yBAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMqmB,YAAY,GAAI,GAAErmB,QAAS,gBAAjC;AACA,MAAMsmB,WAAW,GAAI,GAAEtmB,QAAS,UAAhC;;AAEA,SAASumB,eAAT,CAAyBl1B,QAAzB,EAAmCkF,IAAnC,EAAyC;AACxC,SAAOjC,WAAW,CAACE,cAAc,CAACnD,QAAD,EAAWkF,IAAX,CAAf,CAAlB;AACA;;AAED,MAAM2G,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKiB,WAAL,GAAmB,IAAnB;AAEA,SAAKhB,cAAL,GAAsB,gCAAtB;AAEA,UAAMiI,gBAAgB,GAAG,oEAAzB;AACA,SAAKtD,cAAL,GAAuB,GAAEsD,gBAAiB,iBAA1C;AACA,SAAKpD,kBAAL,GAA0BI,aAA1B;AAEA,SAAKA,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAK9E,qBAAL,GAA6B,WAA7B;AACA,SAAK2xB,qBAAL,GAA6B,OAA7B;AACA,SAAK1U,mBAAL,GAA2B,cAA3B;AACA,SAAKyQ,cAAL,GAAsB,WAAtB;AAEA,SAAKtoB,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AAEA,SAAKS,sBAAL,GAA8B,oBAA9B;AACA,SAAK+sB,kBAAL,GAA0B,yBAA1B;AAEA,SAAKrpB,iBAAL,GAAyB,+BAAzB;AACA,SAAKE,YAAL,GAAoB,gCAApB;AACA,SAAKD,0BAAL,GAAkC,wCAAlC;AACA;;AAED/K,iBAAe,GAAG;AACjB,SAAKo0B,cAAL,GAAsB,CAAC,GAAG70B,QAAQ,CAACyF,gBAAT,CAA0B,KAAKzC,qBAA/B,CAAJ,EACpByJ,MADoB,CACbC,EAAE,IAAIA,EAAE,CAACzM,aAAH,CAAiB,KAAK00B,qBAAtB,EAA6ChvB,SAA7C,CAAuDnF,KAAvD,CAA6D,KAAKkwB,cAAlE,CADO,EAEpBrrB,GAFoB,CAEhBqH,EAAE,IAAI7P,OAAO,CAAC6P,EAAE,CAACzM,aAAH,CAAiB,KAAKggB,mBAAtB,EAA2Cta,SAA5C,CAFG,EAGpByP,MAHoB,CAGb,CAACpP,CAAD,EAAIC,CAAJ,KAAUD,CAAC,GAAGC,CAHD,EAGI,CAHJ,CAAtB;AAIA;;AAEDjF,kBAAgB,GAAG;AAClB,WAAO,CAAC,GAAGhB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKmvB,kBAA/B,CAAJ,EAAwDvvB,GAAxD,CAA4DqH,EAAE,IAAIA,EAAE,CAAC/G,SAArE,EAAgF8G,MAAhF,CAAuFE,OAAvF,CAAP;AACA;;AAED1L,kBAAgB,GAAG;AAClB,WAAOhD,OAAO,CAACC,OAAR,GACLqE,IADK,CACA,MAAM;AACX,UAAI,KAAKyG,aAAL,EAAJ,EAA0B;AACzB,eAAOhJ,QAAQ,CAACiJ,eAAT,CAAyBC,SAAhC;AACA;;AACD,aAAO,KAAKC,WAAL,EAAP;AACA,KANK,EAOL5G,IAPK,CAOAmC,IAAI,IAAI;AACb,YAAM0E,oBAAoB,GAAG,KAAKvB,sBAAL,GAC1B,KAAKA,sBADqB,GAE1B,KAAK3E,mBAFR;AAGA,YAAMhC,KAAK,GAAG,CACb,GAAG,IAAIsE,GAAJ,CACF,CAAC,GAAGgC,sBAAsB,CAAC9C,IAAD,EAAO0E,oBAAP,EAA6B,IAA7B,CAA1B,EAA8D/D,GAA9D,CAAkEK,OAAO,IACxEA,OAAO,CAACC,SAAR,CAAkBC,IAAlB,EADD,CADE,CADU,CAAd;AAQA,aAAO;AACN1E,aADM;AAENC,iBAAS,EAAED,KAAK,CAACoG;AAFX,OAAP;AAIA,KAvBK,CAAP;AAwBA;;AAEDpC,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDrD,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0F,QAAQ,GAAGnK,WAAW,CAACE,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAAf,CAAX,IAAiE,CAAlF;AACA,YAAM6F,GAAG,GAAGtK,WAAW,CAACE,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAAf,CAAX,IAA4D,CAAxE;AACA,YAAM2F,kBAAkB,GAAGlK,cAAc,CAAC,KAAK6I,0BAAN,EAAkCtE,QAAlC,CAAzC;AACA,YAAM4F,gBAAgB,GAAGD,kBAAkB,GAAGpK,WAAW,CAACoK,kBAAD,CAAX,IAAmC,CAAtC,GAA0C,CAArF;AACA,aAAO,KAAK1I,UAAL,CAAgB+C,QAAhB,IAA4B0F,QAA5B,GAAuCG,GAAvC,GAA6CD,gBAA7C,GAAgE,KAAK+nB,cAA5E;AACA,KANM,CAAP;AAOA;;AAEDprB,qBAAmB,CAAChF,IAAD,EAAOC,IAAP,EAAa;AAC/B,UAAM4B,aAAa,GAAG3D,cAAc,CAAC,KAAKM,uBAAN,EAA+ByB,IAA/B,EAAqC,IAArC,CAApC;AACA,UAAM6B,oBAAoB,GAAG,CAAC,GAAGD,aAAJ,EAAmBE,IAAnB,CAAwBd,OAAO,IAAI;AAC/D,YAAMe,YAAY,GAAGf,OAAO,CAACzF,aAAR,CAAsB,KAAKiD,mBAA3B,CAArB;AACA,aAAOuD,YAAY,IAAIA,YAAY,CAACd,SAAb,CAAuBC,IAAvB,GAA8B6E,WAA9B,OAAgDhG,IAAI,CAACgG,WAAL,EAAvE;AACA,KAH4B,CAA7B;AAKA,WAAOlE,oBAAoB,GAAGA,oBAAoB,CAACtG,aAArB,CAAmC,KAAKoD,oBAAxC,EAA8DqH,IAAjE,GAAwE,IAAnG;AACA;;AAEDvG,YAAU,CAACO,IAAD,EAAO;AAChB,WAAOgwB,eAAe,CAAC,KAAK3xB,cAAN,EAAsB2B,IAAtB,CAAtB;AACA;;AA7FuD,CAAzD;AAgGe;AACdgG,MAAI,EAAE,SADQ;AAEd5M,QAAM,EAAE,aAFM;AAGdwR,kBAAgB,EAAEC,wDAAiB,CAACC,OAHtB;AAId5B,WAAS,EAAE,IAJG;AAKdvC,QALc;AAMdyC,iBAAe,EAAEnD,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC9C,aAAhC,IAAiDA,aAAjD,GAAiE2C,MAAM,CAACC,QAAP,CAAgBC,IANpF;;AAOd+D,aAAW,CAAC/D,IAAD,EAAO;AACjB,UAAMiqB,gBAAgB,GAAG,yCAAzB;AACA,UAAMxe,aAAa,GAAGzL,IAAI,CAACJ,WAAL,EAAtB;AACA,UAAMsqB,QAAQ,GAAG/0B,QAAQ,CAACC,aAAT,CAAuB60B,gBAAvB,CAAjB;AACA,WACCC,QAAQ,IACRL,eAAe,CAACI,gBAAD,CADf,IAEA,CAAC90B,QAAQ,CAACC,aAAT,CAAuB,wBAAvB,CAFD,IAGAD,QAAQ,CAACC,aAAT,CAAuB,gCAAvB,CAHA,KAICqW,aAAa,CAACxL,UAAd,CAAyB9C,aAAzB,KACAsO,aAAa,CAACxL,UAAd,CAAyB0pB,YAAzB,CADA,IAEAle,aAAa,CAACxL,UAAd,CAAyB2pB,WAAzB,CAND,CADD;AASA,GApBa;;AAqBdroB,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAD,CAAd;AACA;;AAvBa,CAAf,E;;;;;;;;;;;;AC9HA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAMkO,QAAQ,GAAG,4BAAjB;AACA,MAAM6mB,WAAW,GAAI,GAAE7mB,QAAS,oDAAhC;AACA;;;;;;;;;;;;;;AAaA,MAAM9C,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKiB,WAAL,GAAmB,IAAnB;AACA,SAAK2E,4BAAL,GAAoC,IAApC;AAEA,SAAKhB,cAAL,GAAuB,GAAEstB,WAAY,qBAArC;AACA,SAAKptB,kBAAL,GAA2B,GAAEotB,WAAY,0BAAzC;AACA,SAAKhtB,aAAL,GAAsB,GAAEmG,QAAS,OAAjC;AAEA,SAAKpL,cAAL,GAAsB,2BAAtB;AACA,SAAK8E,sBAAL,GAA8B,oBAA9B;AAEA,SAAKO,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AAEA6I,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAE,IADO;AAEvBC,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAEDlL,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAED9D,kBAAgB,GAAG;AAClB;AACA,KAAC,GAAGX,QAAQ,CAACyF,gBAAT,CAA0B,KAAKwvB,uBAA/B,CAAJ,EAA6D5vB,GAA7D,CAAiE6uB,GAAG,IAAIA,GAAG,CAAC5c,MAAJ,EAAxE;AACA,WAAOrZ,+CAAO,CAACC,OAAR,EAAP;AACA;;AA7BuD,CAAzD;AAgCe;AACdwM,MAAI,EAAE,YADQ;AAEd5M,QAAM,EAAE,gBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;AAKdiE,kBAAgB,EAAEC,wDAAiB,CAACC,OALtB;;AAMdpD,aAAW,GAAG;AACb,UAAM4lB,YAAY,GAAGhyB,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAArB;AACA,WAAO+xB,YAAY,IAAIA,YAAY,CAAC1lB,YAApC;AACA,GATa;;AAUdsC,aAAW,CAAC/D,IAAD,EAAO;AACjB,WAAOA,IAAI,CAACJ,WAAL,GAAmBK,UAAnB,CAA+B,GAAEqD,QAAS,OAA1C,CAAP;AACA;;AAZa,CAAf,E;;;;;;;;;;;;ACpDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA,MAAM;AAAEsL;AAAF,IAAgBC,mDAAtB;AACA,MAAM;AAAE/E,aAAF;AAAehS;AAAf,IAAkCC,0CAAxC;AACA,MAAM;AAAE/F,SAAF;AAAW4F;AAAX,IAA2B3F,6CAAjC;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA,MAAMuO,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,wCAAtB;AACA,SAAK0I,YAAL,GAAoB,gCAApB;AACA,SAAKF,iBAAL,GAAyB,qCAAzB;AACA,SAAK1D,sBAAL,GAA8B,6BAA9B;AACA,SAAK7E,qBAAL,GAA6B,uBAA7B;AACA,SAAKkyB,cAAL,GAAsB,aAAtB;AACA,SAAKplB,cAAL,GAAsB,gBAAtB;AACA,SAAK/L,WAAL,GAAmB,IAAnB;AACA,SAAKqQ,wBAAL,GAAgC,sBAAhC;AAEA,SAAKjG,QAAL,GAAgB,gFAAhB;AACA,SAAKzG,cAAL,GAAuB,GAAE,KAAKyG,QAAS,wBAAvC;AACA,SAAKxG,eAAL,GAAwB,GAAE,KAAKwG,QAAS,4BAAxC;AACA,SAAKvG,kBAAL,GAA2B,GAAE,KAAKuG,QAAS,0BAA3C;AACA,SAAKnG,aAAL,GAAsB,GAAE,KAAKmG,QAAS,YAAtC;AAEA,SAAKrG,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,WAA9B;AACA,SAAKotB,SAAL,GAAiB,KAAjB;AAEA,SAAKC,eAAL,GAAuB,KAAK,EAAL,GAAU,IAAjC,CAtBa,CAsB0B;AACvC;;AAED/zB,iBAAe,GAAG;AACjB,UAAMlE,QAAQ,GAAG,MAAMkE,eAAN,EAAjB;AAEA4O,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAEhT,QADO;AAEvBiT,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAED,QAAM7O,cAAN,GAAuB;AACtB,QAAI8zB,mBAAmB,GAAG,IAA1B;AACA,UAAMv2B,aAAa,GAAG,MAAML,wDAAmB,CAACM,gBAApB,CAAqC,KAAKgM,MAA1C,CAA5B;;AACA,QAAIjM,aAAJ,EAAmB;AAClB,YAAMw2B,WAAW,GAAG/2B,IAAI,CAACC,GAAL,KAAaM,aAAa,CAACy2B,iBAA3B,IAAgD,KAAKH,eAAzE;;AACA,UAAIE,WAAJ,EAAiB;AAChB72B,gEAAmB,CAACO,mBAApB,CAAwC,KAAK+L,MAA7C;AACA,OAFD,MAEO;AACNsqB,2BAAmB,GAAGv2B,aAAa,CAAC02B,gBAAd,GAAiC,CAAvD;AACA;AACD;;AACD,UAAM;AAAEC;AAAF,QAAoB9qB,MAAM,CAAC+qB,SAAjC;AACA,UAAMplB,OAAO,GAAGtQ,QAAQ,CAACC,aAAT,CAAuB,KAAK6P,cAA5B,CAAhB;AACA,UAAM6lB,aAAa,GAAG31B,QAAQ,CAACC,aAAT,CAAuB,KAAKi1B,cAA5B,CAAtB;AACA,UAAMU,QAAQ,GAAGD,aAAa,IAAIA,aAAa,CAAChwB,SAAd,CAAwBC,IAAxB,GAA+BpF,KAA/B,CAAqC,kBAArC,CAAlC;AACA,WAAO60B,mBAAmB,IAAI,CAAC/kB,OAAxB,IAAmCslB,QAAnC,IAA+CH,aAAtD;AACA;;AAEDh1B,iBAAe,GAAG;AACjB,WAAO,KAAKuD,SAAL,CAAe,WAAf,EAA4BzB,IAA5B,CAAiC6Z,YAAY,IAAI;AACvD,WAAK+Y,SAAL,GAAiB9qB,MAAM,CAACwrB,IAAP,CAAYzZ,YAAZ,EAA0B9U,MAA1B,KAAqC,CAAtD;AACA,aAAOrJ,+CAAO,CAACC,OAAR,EAAP;AACA,KAHM,CAAP;AAIA;;AAED+C,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,IAAIsE,GAAJ,CACb,CAAC,GAAGxF,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EACE4E,MADF,CACSE,OADT,EAEEtH,GAFF,CAEMqH,EAAE,IAAIA,EAAE,CAACtM,YAAH,CAAgB,WAAhB,CAFZ,CADa,CAAd;AAKA,WAAO;AACNc,WAAK,EAAE,CAAC,GAAGA,KAAJ,CADD;AAENC,eAAS,EAAED,KAAK,CAAC2E;AAFX,KAAP;AAIA;;AAED9E,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAOjD,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAAI,KAAKqxB,mBAAL,CAAyBrxB,IAAzB,CAA5B,EACLlC,IADK,CACA,MAAM,KAAK4G,WAAL,EADN,EAEL5G,IAFK,CAEA2E,QAAQ,IAAI,KAAK/C,UAAL,CAAgB+C,QAAhB,CAFZ,CAAP;AAGA;;AAEDtG,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CE,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjG3F,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACAvF,sDAAG,CAAC,wBAAD,EAA2B0F,kBAA3B,CAAH;AAEA,UAAME,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0BoG,iBAAiB,IAAI;AAC9C,YAAMhE,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE,CAJG;AAKdC,eAAO,EAAE;AALK,OAAf;;AAQA,UACC4D,iBAAiB,CAACotB,kBAAlB,IACA,KAAKZ,SADL,IAEA9qB,MAAM,CAACwrB,IAAP,CAAYltB,iBAAZ,EAA+BrB,MAA/B,KAA0C,CAH3C,EAIE;AACD;AACA3C,cAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,eAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AAED,aAAO,KAAKmE,eAAL,GAAuBvG,IAAvB,CAA4BwG,YAAY,IAAI;AAClDpE,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB4E,YAAhB,CAApB;AACApE,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACAD,cAAM,CAACG,SAAP,GAAmB,KAAKR,eAAL,CAAqByE,YAArB,IAAqC1E,kBAAxD;AACAM,cAAM,CAACI,OAAP,GAAiB,IAAjB;;AAEA,YACCJ,MAAM,CAACC,UAAP,GAAoBV,aAApB,IACA;AACCS,cAAM,CAACC,UAAP,KAAsBV,aAAtB,IAAuCS,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDP,0BAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AAED,eAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,OAfM,CAAP;AAgBA,KAnCD,CADM,EAqCLpC,IArCK,CAqCA,MAAM;AACZ,UAAI,KAAKwB,WAAT,EAAsB;AACrBvG,oDAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,eAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,mBAAS,EAAEhB,gBAFa;AAGxBL,uBAHwB;AAIxBG;AAJwB,SAAzB;AAMA;;AACD,aAAOpG,+CAAO,CAACC,OAAR,EAAP;AACA,KA/CM,CAAP;AAgDA;;AAED,QAAMyC,gBAAN,GAAyB;AACxB,UAAM7B,aAAa,GAAG,MAAML,wDAAmB,CAACM,gBAApB,CAAqC,KAAKgM,MAA1C,CAA5B;AACA,UAAMyqB,gBAAgB,GAAG12B,aAAa,GAAGA,aAAa,CAAC02B,gBAAjB,GAAoC,CAA1E;AACA/2B,4DAAmB,CAACC,gBAApB,CAAqC,KAAKqM,MAA1C,EAAkD;AACjDyqB,sBAAgB,EAAEA,gBAAgB,GAAG,CADY;AAEjDD,uBAAiB,EAAEh3B,IAAI,CAACC,GAAL;AAF8B,KAAlD;AAIA;;AAED4C,wBAAsB,GAAG;AACxB,WAAO,KAAK+H,WAAL,GAAmB5G,IAAnB,CAAwB8G,YAAY,IAAI;AAC9C,YAAMsH,KAAK,GAAG9T,OAAO,CAAC8X,WAAW,CAAC,KAAK5R,cAAN,EAAsBsG,YAAtB,CAAZ,CAArB,CAD8C,CAG9C;;AACA,YAAMiQ,UAAU,GAAG3W,cAAc,CAAC,KAAK4I,iBAAN,EAAyBlC,YAAzB,CAAjC;AACA,YAAM2sB,YAAY,GAAG1c,UAAU,GAAG7W,WAAW,CAAC6W,UAAD,CAAd,GAA6B,CAA5D,CAL8C,CAM9C;;AACA,YAAM1M,QAAQ,GAAGxN,MAAM,CAAC6qB,KAAP,CAAa+L,YAAb,IAA6B,CAA7B,GAAiCA,YAAlD;AAEA,YAAMC,OAAO,GAAGp5B,OAAO,CAAC8X,WAAW,CAAC,KAAKlJ,YAAN,EAAoBpC,YAApB,CAAZ,CAAvB,CAT8C,CAU9C;;AACA,YAAM0D,GAAG,GAAG3N,MAAM,CAAC6qB,KAAP,CAAagM,OAAb,IAAwB,CAAxB,GAA4BA,OAAxC;AAEA,aAAOtlB,KAAK,GAAG/D,QAAR,GAAmBG,GAA1B;AACA,KAdM,CAAP;AAeA;;AAED+oB,qBAAmB,GAAG;AACrB91B,YAAQ,CAACC,aAAT,CAAuB,KAAKmU,wBAA5B,EAAsD7G,KAAtD;AACA,WAAOtP,+CAAO,CAACC,OAAR,EAAP;AACA;;AAEDgH,YAAU,CAACT,IAAD,EAAO;AAChB,QAAI,KAAKsD,sBAAT,EAAiC;AAChC,WAAKO,iBAAL,CAAuBlB,GAAvB,CAA2B,KAAKW,sBAAhC,EAAwDtD,IAAxD,EADgC,CAEhC;;AACA,WAAK6D,iBAAL,CAAuBlB,GAAvB,CAA2B,aAA3B,EAA0CqS,SAAS,CAAC,aAAD,CAAnD;AACA;;AACD,WAAO,KAAKnQ,eAAL,CAAqB,KAAK3B,eAA1B,EAA2C,KAAKO,sBAAhD,EAAwE,KAAKI,iBAA7E,CAAP;AACA;;AA5KuD,CAAzD;AA+Ke;AACdoC,MAAI,EAAE,aADQ;AAEd5M,QAAM,EAAE,gBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdslB,YAAU,EAAE,CALE;AAMd9nB,QANc;AAOdiE,kBAAgB,EAAEC,wDAAiB,CAACC;AAPtB,CAAf,E;;;;;;;;;;;;ACpNA;AAAA;AAAA;AAEA;;;;;;;;;;;;;;AAcA,MAAMoK,QAAQ,GAAG,kCAAjB;AAEA,MAAMvO,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,oBAAtB;AACA,SAAK8E,sBAAL,GAA8B,kBAA9B;AACA,SAAK9D,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,6EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,sBAAnC;AACA,SAAKvG,kBAAL,GAA0BgS,QAA1B;AAEA,SAAKxR,gBAAL,CAAsBhB,GAAtB,CAA0B,cAA1B,EAA0C,qCAA1C;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA;;AAEDnH,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EAA4DxC,GAA5D,CAAgEoK,WAAW,IACxFA,WAAW,CAACrP,YAAZ,CAAyB,gBAAzB,CADa,CAAd;AAIA,WAAO;AACNc,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDtD,WAAS,CAACS,IAAD,EAAO;AACf,SAAK2D,gBAAL,CAAsBhB,GAAtB,CAA0B,WAA1B,EAAuC3C,IAAvC;AACA,SAAK2D,gBAAL,CAAsBhB,GAAtB,CAA0B,mBAA1B,EAA+C3C,IAA/C;AAEA,WAAO,KAAKkF,gBAAL,CAAsB,KAAKjC,cAA3B,EAA2C,KAAKO,qBAAhD,EAAuE,KAAKG,gBAA5E,CAAP;AACA;;AAEDlD,YAAU,CAACT,IAAD,EAAO;AAChB,SAAK6D,iBAAL,CAAuBlB,GAAvB,CAA2B,WAA3B,EAAwC3C,IAAxC;AACA,SAAK6D,iBAAL,CAAuBlB,GAAvB,CAA2B,mBAA3B,EAAgD3C,IAAhD;AAEA,WAAO,KAAKkF,gBAAL,CAAsB,KAAKhC,eAA3B,EAA4C,KAAKO,sBAAjD,EAAyE,KAAKI,iBAA9E,CAAP;AACA;;AAvCuD,CAAzD;AA0Ce;AACdoC,MAAI,EAAE,OADQ;AAEd5M,QAAM,EAAE,WAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;;AAKde,aAAW,GAAG;AACb,WAAOpM,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAP;AACA,GAPa;;AAQd2O,aAAW,CAAC/D,IAAD,EAAO;AACjB,WAAOA,IAAI,CAACC,UAAL,CAAgB8O,QAAhB,CAAP;AACA;;AAVa,CAAf,E;;;;;;;;;;;;AC5DA;AAAA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;AAoBA,MAAMzL,QAAQ,GAAI,GAAExD,MAAM,CAACC,QAAP,CAAgBsrB,QAAS,iBAA7C;AACA,MAAMlrB,gBAAgB,GAAI,GAAEmD,QAAS,+CAArC;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMgoB,YAAY,GAAI,GAAEhoB,QAAS,WAAjC;AACA,MAAMsmB,WAAW,GAAI,GAAEtmB,QAAS,UAAhC;AACA,MAAMqmB,YAAY,GAAI,GAAErmB,QAAS,WAAjC;AACA,MAAMyB,YAAY,GAAI,GAAEzB,QAAS,kEAAjC;;AACA,MAAM6D,QAAQ,GAAG,MAAMrF,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,wBAAvB,CAAD,CAA9B;;AAEA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKiB,WAAL,GAAmB,IAAnB;AAEA,SAAK2D,cAAL,GAAuB,GAAEsD,gBAAiB,iBAA1C;AACA,SAAKpD,kBAAL,GAA0BoK,QAAQ,KAAKhK,aAAL,GAAsB,GAAEgD,gBAAiB,0BAA3E;AAEA,SAAK7H,kBAAL,GAA0B,kCAA1B;AAEA,SAAK6E,aAAL,GAAqBA,aAArB;AAEA,SAAKI,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA;;AAEDlC,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDqE,iBAAe,GAAG;AACjB;AACA;AACA,WAAO,MAAMA,eAAN,GAAwBvG,IAAxB,CAA6B,MAAM,MAAMuG,eAAN,EAAnC,CAAP;AACA;;AAEDE,eAAa,GAAG;AACf,WAAOgJ,QAAQ,EAAf;AACA;;AA3BuD,CAAzD;AA8Be;AACdtH,MAAI,EAAE,OADQ;AAEd5M,QAAM,EAAE,WAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;;AAKduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,UAAMurB,IAAI,GAAG,CAACpuB,aAAD,EAAgBmuB,YAAhB,EAA8B1B,WAA9B,EAA2CD,YAA3C,EAAyD5kB,YAAzD,CAAb;AACA,WACCwmB,IAAI,CAAC5lB,IAAL,CAAUoI,GAAG,IAAI/N,IAAI,CAACO,QAAL,CAAcwN,GAAd,CAAjB,KACA5Y,QAAQ,CAACC,aAAT,CAAuB,mDAAvB,CAFD;AAIA,GAXa;;AAYd6N,iBAAe,EAAEkE,QAAQ,KAAKhK,aAAL,GAAqBysB,WAZhC;;AAadroB,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,kBAAvB,CAAD,CAAd;AACA;;AAfa,CAAf,E;;;;;;;;;;;;AC7DA;AAAA;AAAA;AAEA;;;;;;;;;;;;AAYA,MAAMkO,QAAQ,GAAG,0BAAjB;AACA,MAAMnD,gBAAgB,GAAI,GAAEmD,QAAS,wDAArC;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,aAAlC;AACA,MAAMkoB,iBAAiB,GAAI,GAAErrB,gBAAiB,yBAA9C;AACA,MAAM8D,gBAAgB,GAAI,GAAE9D,gBAAiB,qBAA7C;AAEA,MAAMK,MAAM,GAAG,MAAMA,MAAN,SAAqBxI,6CAArB,CAAsC;AACpDC,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,iDAAtB;AACA,SAAKG,mBAAL,GAA2B,gCAA3B;AACA,SAAKC,kBAAL,GAA0B,cAA1B;AAEA,SAAKuE,cAAL,GAAuB,GAAEsD,gBAAiB,iBAA1C;AACA,SAAKrD,eAAL,GAAwB,GAAEqD,gBAAiB,uBAA3C;AACA,SAAKpD,kBAAL,GAA2B,GAAEoD,gBAAiB,0BAA9C;AAEA,SAAKhD,aAAL,GAAqBA,aAArB;AAEA,SAAKD,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKmB,iBAAL,CAAuBnB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AAEA,SAAKrD,WAAL,GAAmB,IAAnB;AAEA,SAAKuQ,mBAAL,GAA2B,aAA3B;AACA,SAAKgiB,mBAAL,GAA2B,oCAA3B;AACA;;AAED/0B,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAM8J,SAAS,GAAG1U,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAAlB;AACA,UAAMtC,QAAQ,GAAGnH,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,CAAjB;AACA,UAAMuuB,YAAY,GAAG1rB,IAAI,CAACC,UAAL,CAAgBurB,iBAAhB,CAArB;AACA,UAAMG,WAAW,GAAG3rB,IAAI,CAACC,UAAL,CAAgBgE,gBAAhB,CAApB;AACA,UAAM2nB,SAAS,GAAGz2B,QAAQ,CAACC,aAAT,CAAuB,KAAKq2B,mBAA5B,CAAlB;AACA,UAAMI,WAAW,GAAGD,SAAS,GAAGA,SAAS,CAACtpB,OAAb,GAAuB,KAApD;AACA,UAAM9P,YAAY,GAAI2U,QAAQ,IAAI,CAAC0C,SAAd,IAA4B6hB,YAA5B,IAA6CC,WAAW,IAAIE,WAAjF;AACA,WAAOr5B,YAAP;AACA;;AAED6H,YAAU,CAACT,IAAD,EAAO;AAChB,QAAI,KAAKsD,sBAAT,EAAiC;AAChC,WAAKO,iBAAL,CAAuBlB,GAAvB,CAA2B,KAAKW,sBAAhC,EAAwDtD,IAAxD;AACA;;AAED,WAAO,KAAKkF,gBAAL,CAAsB,KAAKhC,eAA3B,EAA4C,KAAKO,sBAAjD,EAAyE,KAAKI,iBAA9E,CAAP;AACA;;AA1CmD,CAArD;AA6Ce;AACdoC,MAAI,EAAE,cADQ;AAEd5M,QAAM,EAAE,cAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdxC,QALc;;AAMduD,aAAW,GAAG;AACb,WAAO,KAAP;AACA;;AARa,CAAf,E;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AACA;AAEA;;;;;;AAMA,MAAMiI,UAAU,GAAG,8BAAnB;AACA,MAAM+C,QAAQ,GAAI,GAAE/C,UAAW,OAA/B;AACA,MAAM1I,QAAQ,GAAI,GAAE0I,UAAW,sDAA/B;AACA,MAAM8f,aAAa,GAAI,GAAE9f,UAAW,yEAApC;AACA,MAAMgZ,mBAAmB,GAAG,wBAA5B;AAEA,MAAMxkB,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKiB,WAAL,GAAmB,IAAnB;AAEA,SAAK2D,cAAL,GAAuB,GAAEyG,QAAS,iBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,4BAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKrG,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AAEA,SAAKY,aAAL,GAAqB4R,QAArB;AACA;;AAED1U,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAnBuD,CAAzD;AAsBe;AACdiG,MAAI,EAAE,uBADQ;AAEd5M,QAAM,EAAE,kBAFM;AAGdwR,kBAAgB,EAAEC,wDAAiB,CAACC,OAHtB;AAId5B,WAAS,EAAE,IAJG;AAKdvC,QALc;;AAMduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACC7K,QAAQ,CAACC,aAAT,CAAuB4vB,mBAAvB,MAAgDhlB,IAAI,CAACC,UAAL,CAAgB8O,QAAhB,KAA6B/O,IAAI,CAACC,UAAL,CAAgB6rB,aAAhB,CAA7E,CADD;AAGA,GAVa;;AAWdvqB,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAD,CAAd;AACA;;AAba,CAAf,E;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAM;AAAE0C,gBAAF;AAAkBgS;AAAlB,IAAkC/R,0CAAxC;AAEA;;;;;;;;;;;;;;;;AAgBA,MAAMyI,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKK,kBAAL,GAA0B,0CAA1B;AACA,SAAKD,mBAAL,GAA2B,gCAA3B;AACA,SAAK2E,sBAAL,GAA8B,kDAA9B;AACA,SAAK9E,cAAL,GAAsB,sDAAtB;AACA,SAAK6zB,aAAL,GAAqB,iBAArB;AAEA,SAAK9uB,qBAAL,GAA6B,YAA7B;AAEA,SAAKE,aAAL,GAAqB,gFAArB;AAEA,UAAM6uB,OAAO,GAAG,sEAAhB;AACA,SAAKnvB,cAAL,GAAuB,GAAEmvB,OAAQ,8BAAjC;AACA,SAAKlvB,eAAL,GAAwB,GAAEkvB,OAAQ,iCAAlC;AACA,SAAKjvB,kBAAL,GAA0B,KAAKI,aAA/B;AAEA,SAAKI,gBAAL,CAAsBhB,GAAtB,CAA0B,2BAA1B,EAAuD,IAAvD;AACA,SAAKgB,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AAEA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,2BAA3B,EAAwD,IAAxD;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AAEA,SAAKmB,iBAAL,CAAuBnB,GAAvB,CAA2B,2BAA3B,EAAwD,IAAxD;AACA,SAAKmB,iBAAL,CAAuBnB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AAEA,SAAKkN,mBAAL,GAA2B,iBAA3B;AACA,SAAKwiB,kBAAL,GAA0B,aAA1B;AACA,SAAKC,oBAAL,GAA4B,YAA5B;AACA,SAAKprB,UAAL,GAAkB,qBAAlB;AACA,SAAKqrB,qBAAL,GAA6B,kCAA7B;AACA,SAAKC,kBAAL,GAA0B,WAA1B;AACA;;AAED11B,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAMssB,YAAY,GAAG,CAACl3B,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,KAA+C;AAAE4C,eAAS,EAAE;AAAb,KAAhD,EAAmEA,SAAnE,CAA6EnF,KAA7E,CACpB,QADoB,CAArB;AAGA,UAAMywB,cAAc,GAAGjxB,QAAQ,CAACC,aAAT,CAAuB,KAAKkD,kBAA5B,CAAvB;AACA,UAAMqa,WAAW,GAAG3S,IAAI,CAACJ,WAAL,GAAmBK,UAAnB,CAA8B,KAAK9C,aAAL,CAAmByC,WAAnB,EAA9B,CAApB;AACA,UAAMiK,SAAS,GAAG1U,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAAlB;AACA,UAAM6iB,KAAK,GAAGn3B,QAAQ,CAACC,aAAT,CAAuB,KAAK22B,aAA5B,CAAd;AACA,WAAOpZ,WAAW,IAAIyT,cAAf,IAAiC,CAACvc,SAAlC,IAA+CwiB,YAA/C,IAA+DC,KAAtE;AACA;;AAEDn2B,kBAAgB,GAAG;AAClB,WAAO,CAAC,GAAGhB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKwxB,kBAA/B,CAAJ,EACL5xB,GADK,CACDqH,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeG,KAAf,CAAqB,KAAKw2B,qBAA1B,CADL,EAELvqB,MAFK,CAEEE,OAFF,EAGLF,MAHK,CAGE+E,GAAG,IAAIA,GAAG,CAAClK,MAAJ,IAAc,CAHvB,EAILjC,GAJK,CAIDmM,GAAG,IAAIA,GAAG,CAAC,CAAD,CAAH,CAAO0G,WAAP,EAJN,EAKLzL,MALK,CAKE,CAAChI,IAAD,EAAO2yB,KAAP,EAAc5lB,GAAd,KAAsBA,GAAG,CAAC6lB,OAAJ,CAAY5yB,IAAZ,MAAsB2yB,KAL9C,CAAP;AAMA;;AAEDn2B,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EAA4DxC,GAA5D,CAAgEoK,WAAW,IACxFA,WAAW,CAAC9J,SAAZ,CAAsBC,IAAtB,EADa,CAAd;AAIA,WAAO;AACN1E,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAED1G,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2C;AACpDxF,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AAEA,WAAOjG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0BoG,iBAAiB,IAAI;AAC9C,YAAMhE,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdE,eAAO,EAAE;AAJK,OAAf;;AAOA,YAAMuyB,SAAS,GAAG,KAAKC,cAAL,CAAoB5uB,iBAApB,CAAlB;;AAEA,UAAI2uB,SAAJ,EAAe;AACd;AACA3yB,cAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,eAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AAED,aAAO,KAAKmE,eAAL,GAAuBvG,IAAvB,CAA4BwG,YAAY,IAAI;AAClDpE,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB4E,YAAhB,CAApB;AACApE,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AAEA,eAAO,KAAKM,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,OALM,CAAP;AAMA,KAtBD,CADM,CAAP;AAyBA;;AAEDvD,wBAAsB,GAAG;AACxB;AACA,WAAOnD,+CAAO,CAACuP,KAAR,CAAc,IAAd,EACLjL,IADK,CACA,MAAM,KAAKuG,eAAL,EADN,EAELvG,IAFK,CAEA8G,YAAY,IAAI;AACrB;AACA,aAAO,KAAKlF,UAAL,CAAgBkF,YAAhB,CAAP;AACA,KALK,CAAP;AAMA;;AAEDkuB,gBAAc,CAAChwB,IAAD,EAAO;AACpB,WACC5E,cAAc,CAAC,KAAKm0B,kBAAN,EAA0BvvB,IAA1B,CAAd,IACAoN,WAAW,CAAC,KAAKoiB,oBAAN,EAA4BxvB,IAA5B,CAAX,CAA6C/G,KAA7C,CAAmD,cAAnD,CAFD;AAIA;;AAEDwI,eAAa,GAAG;AACf,WAAO2B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,KAAK9C,aAArC,KAAuDhI,QAAQ,CAACC,aAAT,CAAuB,KAAKkD,kBAA5B,CAA9D;AACA;;AApHuD,CAAzD;AAuHe;AACduH,MAAI,EAAE,QADQ;AAEd5M,QAAM,EAAE,YAFM;AAGdwR,kBAAgB,EAAEC,wDAAiB,CAACC,OAHtB;AAIdnE,QAJc;AAKdwC,iBAAe,EAAE;AALH,CAAf,E;;;;;;;;;;;;AC9IA;AAAA;AAAA;AAEA;;;;;;AAMA,MAAM7F,aAAa,GAAG,8BAAtB;AAEA,MAAMqD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,2BAAtB;AACA,SAAKgB,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,0EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AAEA,SAAKI,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AAEA,SAAK4I,qBAAL,GAA6B,aAA7B;AAEA,SAAKnE,mBAAL,GAA2B,aAA3B;AACA;;AAEDtK,gBAAc,GAAG;AAChB,UAAMi2B,gBAAgB,GAAGx3B,QAAQ,CAACC,aAAT,CAAuB,KAAK4L,mBAA5B,CAAzB;AACA,UAAM4rB,eAAe,GAAGz3B,QAAQ,CAACC,aAAT,CAAuB,KAAK+P,qBAA5B,CAAxB;AACA,UAAM0nB,iBAAiB,GAAG,CAAC,UAAD,EAAa,SAAb,EAAwB,iBAAxB,CAA1B;AACA,UAAM;AAAE7sB;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAM4S,WAAW,GAAG3S,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KAAkC0vB,iBAAiB,CAAClnB,IAAlB,CAAuBmnB,OAAO,IAAI9sB,IAAI,CAACO,QAAL,CAAcusB,OAAd,CAAlC,CAAtD;AACA,UAAMt6B,YAAY,GAAGo6B,eAAe,IAAI,CAACD,gBAApB,IAAwCha,WAA7D;AACA,WAAOngB,YAAP;AACA;;AAED6H,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDuE,eAAa,GAAG;AACf,WAAOhJ,QAAQ,CAACC,aAAT,CAAuB,KAAKkD,kBAA5B,CAAP;AACA;;AAnCuD,CAAzD;AAsCe;AACduH,MAAI,EAAE,QADQ;AAEd5M,QAAM,EAAE,cAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;AAKdwC,iBAAe,EAAE,IALH;AAMde,aAAW,EAAE,MAAM;AANL,CAAf,E;;;;;;;;;;;;AChDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA,MAAM;AAAEnM;AAAF,IAAkB3F,6CAAxB;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;;;;;AAkBA,MAAMoF,aAAa,GAAG,gCAAtB;AACA,MAAM4vB,iBAAiB,GAAG,oCAA1B;AACA,MAAM9oB,gBAAgB,GAAG,mCAAzB;AACA,MAAMkD,QAAQ,GACbrH,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC9C,aAAhC,KAAkD2C,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBJ,WAArB,GAAmCkV,QAAnC,CAA4C,kBAA5C,CADnD;;AAEA,MAAMD,WAAW,GAAG,MACnB,CAAC,CAAC1f,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,CAAF,IAA8C,CAAC,CAACD,QAAQ,CAACC,aAAT,CAAuB,+BAAvB,CADjD;;AAGA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKwI,mBAAL,GAA2B,2CAA3B;AACA,SAAK0E,qBAAL,GAA6B,aAA7B;AACA,SAAK6nB,sBAAL,GAA8B,gBAA9B;AACA,SAAK90B,cAAL,GAAsB,8BAAtB;AACA,SAAK8I,mBAAL,GAA2B,aAA3B;AACA,SAAKyH,sBAAL,GAA8B,uCAA9B;AACA,SAAKwkB,wBAAL,GAAgC,0BAAhC;AACA,SAAKC,qBAAL,GAA6B,gBAA7B;AACA,SAAKlwB,sBAAL,GAA8B,gCAA9B;AACA,SAAKqP,mBAAL,GAA2B,mCAA3B;AAEA,SAAK3L,iBAAL,GAAyB,iCAAzB;AACA,SAAKC,0BAAL,GAAkC,iCAAlC;AACA,SAAKC,YAAL,GAAoB,kCAApB;AAEA,SAAK0C,QAAL,GAAgB,8EAAhB;AACA,SAAKzG,cAAL,GAAuB,GAAE,KAAKyG,QAAS,qBAAvC;AACA,SAAKxG,eAAL,GAAwB,GAAE,KAAKwG,QAAS,wBAAxC;AACA,SAAKvG,kBAAL,GAA2B,GAAE,KAAKuG,QAAS,0BAA3C;AAEA,SAAKpG,sBAAL,GAA8B,YAA9B;AAEA,SAAKE,qBAAL,GAA6B;AAC5B,0BAAoB;AADQ,KAA7B;AAGA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKG,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AACA,SAAKmB,iBAAL,CAAuBnB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AAEA,SAAKrD,WAAL,GAAmB,KAAnB;AACA;;AAED1C,iBAAe,GAAG;AACjB,UAAMlE,QAAQ,GAAG,MAAMkE,eAAN,EAAjB;AACA,UAAM22B,cAAc,GAAGh4B,QAAQ,CAACC,aAAT,CAAuB,KAAK63B,wBAA5B,CAAvB;;AACA,QAAIE,cAAJ,EAAoB;AACnB,YAAMC,sBAAsB,GAAGD,cAAc,CAACpO,SAAf,CAAyBC,QAAzB,CAAkC,MAAlC,CAA/B;;AACA,UAAI,CAACoO,sBAAL,EAA6B;AAC5Bz6B,oDAAG,CAACC,KAAJ,CAAU,eAAV;AACA;AACD;;AAEDwS,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAEhT,QADO;AAEvBiT,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAED7O,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAMuB,UAAU,GACf6F,QAAQ,IACRnH,IAAI,CAACJ,WAAL,GAAmBK,UAAnB,CAA8B8sB,iBAA9B,CADA,IAEA/sB,IAAI,CAACJ,WAAL,GAAmBK,UAAnB,CAA8BgE,gBAA9B,CAFA,IAGAjE,IAAI,CAACJ,WAAL,GAAmBkV,QAAnB,CAA4B,kBAA5B,CAJD;AAKA,UAAMvT,WAAW,GAAGpM,QAAQ,CAACC,aAAT,CAAuB,KAAK4L,mBAA5B,CAApB;AACA,UAAM0E,OAAO,GAAGvQ,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAAhB;AACA,UAAM4sB,UAAU,GAAGl4B,QAAQ,CAACC,aAAT,CAAuB,KAAK83B,qBAA5B,CAAnB;AACA,UAAM16B,YAAY,GAAG8O,UAAU,IAAI,CAACC,WAAf,IAA8BmE,OAA9B,IAAyC,CAAC2nB,UAA/D;AACA,WAAO76B,YAAP;AACA;;AAED4D,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EACZxC,GADY,CACRqH,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeG,KAAf,CAAqB,KAAK0W,mBAA1B,CADE,EAEZzK,MAFY,CAELE,OAFK,EAGZtH,GAHY,CAGR8yB,OAAO,IAAIA,OAAO,CAAC,CAAD,CAHV,CAAd;AAKA,WAAO;AACNj3B,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAED1G,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CE,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjG3F,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACAvF,sDAAG,CAAC,wBAAD,EAA2B0F,kBAA3B,CAAH;AAEA,WAAOpG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0BoG,iBAAiB,IAAI;AAC9C,YAAMhE,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE,CAJG;AAKdC,eAAO,EAAE;AALK,OAAf;;AAQA,YAAM6D,YAAY,GAAG,KAAKC,iBAAL,CAAuBF,iBAAvB,CAArB;;AAEA,UAAIC,YAAY,KAAK,IAAjB,IAAyBA,YAAY,KAAK,KAAKH,oCAAnD,EAAyF;AACxF;AACA,eAAOjL,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AAED,aAAO,KAAKmE,eAAL,GAAuBvG,IAAvB,CAA4BwG,YAAY,IAAI;AAClDpE,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB4E,YAAhB,CAApB;AACApE,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACAD,cAAM,CAACG,SAAP,GAAmB,KAAKR,eAAL,CAAqByE,YAArB,IAAqC1E,kBAAxD;AACAM,cAAM,CAACI,OAAP,GAAiB,IAAjB;AACA,eAAO,KAAKG,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,OANM,CAAP;AAOA,KAvBD,CADM,CAAP;AA0BA;;AAEDhE,kBAAgB,GAAG;AAClBgK,UAAM,CAAC+G,OAAP,CAAewa,SAAf,CACCvhB,MAAM,CAAC+G,OAAP,CAAeE,KADhB,EAECjH,MAAM,CAAC3K,QAAP,CAAgB6R,KAFjB,EAGC6N,WAAW,KAAK5Q,gBAAL,GAAwBnE,MAAM,CAACC,QAAP,CAAgBC,IAHpD;AAKA,WAAO5M,+CAAO,CAACC,OAAR,EAAP;AACA;;AAEDkD,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM4M,oBAAoB,GAAGnR,cAAc,CAAC,KAAK6I,0BAAN,EAAkCtE,QAAlC,CAA3C;AACA,YAAMkxB,qBAAqB,GAAGtkB,oBAAoB,GAAGrR,WAAW,CAACqR,oBAAD,CAAd,GAAuC,CAAzF;AACA,YAAMlH,QAAQ,GAAGjK,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAA/B;AACA,YAAM6iB,aAAa,GAAGnd,QAAQ,GAAGnK,WAAW,CAACmK,QAAD,CAAX,GAAwBwrB,qBAA3B,GAAmD,CAAjF;AACA,YAAMrrB,GAAG,GAAGpK,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAA1B;AACA,YAAMwiB,QAAQ,GAAG3c,GAAG,GAAGtK,WAAW,CAACsK,GAAD,CAAd,GAAsB,CAA1C;AACA,aAAO,KAAK5I,UAAL,CAAgB+C,QAAhB,IAA4B6iB,aAA5B,GAA4CL,QAAnD;AACA,KARM,CAAP;AASA;;AAED1gB,eAAa,GAAG;AACf,WACC2B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,KAAK9C,aAArC,KACA2C,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBJ,WAArB,GAAmCkV,QAAnC,CAA4C,kBAA5C,CAFD;AAIA;;AAED7V,cAAY,CAACxH,MAAD,EAASsH,UAAT,EAAqB3C,OAArB,EAA8B4C,WAA9B,EAA2CE,QAA3C,EAAqD;AAChE,UAAMC,eAAe,GACpBH,WAAW,IAAIA,WAAW,CAACI,QAAZ,EAAf,GAAyC,GAAEL,UAAW,IAAGC,WAAW,CAACI,QAAZ,EAAuB,EAAhF,GAAoFL,UADrF;AAGA,WAAOwI,sDAAO,CAACpI,eAAD,EAAkB;AAC/B1H,YAD+B;AAE/B0E,iBAAW,EAAE,SAFkB;AAG/BC,aAH+B;AAI/BH,UAAI,EAAEiD;AAJyB,KAAlB,CAAP,CAMLxH,IANK,CAMA2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EANZ,EAOL5E,IAPK,CAOA2E,QAAQ,IAAI;AACjB;AACA,UAAI;AACH,eAAOgD,IAAI,CAACC,KAAL,CAAWjD,QAAX,CAAP;AACA,OAFD,CAEE,OAAOxJ,CAAP,EAAU;AACX,eAAOwJ,QAAP;AACA;AACD,KAdK,CAAP;AAeA;;AA9JuD,CAAzD;AAiKe;AACdwD,MAAI,EAAE,YADQ;AAEd5M,QAAM,EAAE,eAFM;AAGduN,QAHc;AAIdyC,iBAAe,EAAEkE,QAAQ,GAAGhK,aAAH,GAAmB2C,MAAM,CAACC,QAAP,CAAgBC,IAJ9C;AAKdgD,iBAAe,EAAE;AALH,CAAf,E;;;;;;;;;;;;ACpMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;AAYA,MAAM7F,aAAa,GAAG,mCAAtB;AAEA,MAAMqD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKiB,WAAL,GAAmB,KAAnB;AAEA,SAAKoK,QAAL,GAAgB,mFAAhB;AACA,SAAKzG,cAAL,GAAuB,GAAE,KAAKyG,QAAS,gBAAvC;AACA,SAAKxG,eAAL,GAAwB,GAAE,KAAKwG,QAAS,mBAAxC;AACA,SAAKjL,mBAAL,GAA2B,mBAA3B;AACA,SAAK0E,kBAAL,GACC,2FADD;AAGA,SAAKI,aAAL,GAAqBA,aAArB;AACA,SAAKsM,mBAAL,GAA2B,oBAA3B;AAEA,SAAK/Q,eAAL,GAAuB;AACtBC,YAAM,EAAE,mCADc;AAEtB,sBAAgB;AAFM,KAAvB;AAIA;;AAEDjC,gBAAc,GAAG;AAChB,UAAMwR,MAAM,GAAGpI,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,mCAAhC,CAAf;AACA,UAAMyO,SAAS,GAAGvZ,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAAlB;AACA,UAAMof,SAAS,GAAGna,SAAS,IAAIA,SAAS,CAAClZ,WAAV,CAAsB+K,QAAtB,CAA+B,UAA/B,CAA/B;AACA,WAAO2H,MAAM,IAAI,CAAC2gB,SAAlB;AACA;;AAED,QAAMjzB,eAAN,GAAwB;AACvB,UAAM2b,YAAY,GAAG,MAAM,KAAKic,WAAL,CAC1B,yGAD0B,EAE1BnuB,IAAI,CAAC0R,SAAL,CAAe,EAAf,CAF0B,CAA3B;AAIA,SAAKzG,SAAL,GAAiBiH,YAAY,CAAC7U,IAAb,CAAkB4N,SAAnC;AACA;;AAEDlU,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKvC,mBAA/B,CAAJ,EACZuJ,MADY,CACLE,OADK,EAEZtH,GAFY,CAERoK,WAAW,IAAIA,WAAW,CAAC9J,SAFnB,CAAd;AAGA,WAAO;AACNzE,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDvG,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAOjD,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAAI,KAAKS,UAAL,CAAgBT,IAAhB,CAA5B,CAAP;AACA;;AAED/D,kBAAgB,GAAG;AAClB,WAAO,KAAK43B,eAAL,GAAuB/1B,IAAvB,CAA4B6Z,YAAY,IAAI;AAClD,aAAO;AACNlY,qBAAa,EAAE,KAAKsX,WAAL,CAAiBY,YAAjB,CADT;AAEN/X,0BAAkB,EAAE,KAAKk0B,gBAAL,CAAsBnc,YAAtB;AAFd,OAAP;AAIA,KALM,CAAP;AAMA;;AAEDxb,YAAU,CAACM,KAAD,EAAQgD,aAAR,EAAuBG,kBAAvB,EAA2C;AACpD1F,sDAAG,CAAE,mBAAkBuF,aAAc,EAAlC,CAAH;AACAvF,sDAAG,CAAC,wBAAD,EAA2B0F,kBAA3B,CAAH;AACA,UAAME,gBAAgB,GAAG,EAAzB;AAEA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0B6Z,YAAY,IAAI;AACzC,YAAMzX,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE,CAJG;AAKdC,eAAO,EAAE;AALK,OAAf;;AAOA,UAAIqX,YAAY,CAACtG,OAAb,KAAyB,KAA7B,EAAoC;AACnCnR,cAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,eAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AAEDA,YAAM,CAACC,UAAP,GAAoB,KAAK4W,WAAL,CAAiBY,YAAjB,CAApB;AACAzX,YAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACAD,YAAM,CAACG,SAAP,GAAmB,KAAKyzB,gBAAL,CAAsBnc,YAAtB,IAAsC/X,kBAAzD;;AACA,UAAIM,MAAM,CAACE,aAAP,GAAuB,CAAvB,IAA4BF,MAAM,CAACG,SAAP,GAAmB,CAAnD,EAAsD;AACrDP,wBAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AAED,aAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,KArBD,CADM,EAuBLpC,IAvBK,CAuBA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,WAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,eAAS,EAAEhB,gBAFa;AAGxBL,mBAHwB;AAIxBG;AAJwB,KAAzB,CAxBM,CAAP;AA+BA;;AAEDvD,YAAU,CAACgF,cAAD,EAAiB;AAC1B,UAAM;AAAE5E,WAAF;AAASqE,eAAT;AAAoBrB,mBAApB;AAAmCG;AAAnC,QAA0DyB,cAAhE;AAEAP,aAAS,CAACQ,IAAV,CAAe,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACxB,UAAIA,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAApB,KAAsC,CAA1C,EAA6C;AAC5C,eAAOoB,CAAC,CAACnB,SAAF,GAAckB,CAAC,CAAClB,SAAvB;AACA;;AACD,aAAOmB,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAA3B;AACA,KALD;AAOA,QAAIqB,YAAY,GAAGhC,aAAnB;AACA,QAAIs0B,YAAY,GAAG,CAAnB;AACA,QAAIryB,eAAe,GAAG,CAAtB;AACA,UAAME,eAAe,GAAG,EAAxB;AAEA,WAAOpI,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0B2E,QAAQ,IAAI;AACrC,YAAMtC,UAAU,GAAG,KAAK4W,WAAL,CAAiBtU,QAAjB,CAAnB;;AACA,YAAMrC,aAAa,GAAGX,aAAa,GAAGU,UAAtC;AACA,YAAME,SAAS,GAAG,KAAKyzB,gBAAL,CAAsBrxB,QAAtB,IAAkC7C,kBAApD;AAEA7G,kDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AAAEgH,YAAF;AAAQG,kBAAR;AAAoBC,qBAApB;AAAmCC;AAAnC,OAA1B;;AACA,UAAIF,UAAU,GAAGsB,YAAb,IAA6BpB,SAAS,GAAG0zB,YAA7C,EAA2D;AAC1D;AACA,cAAMC,cAAc,GAAG7zB,UAAU,GAAGsB,YAApC;;AACA,YAAI,CAACuyB,cAAL,EAAqB;AACpBpyB,yBAAe,CAACpB,IAAhB,CAAqBR,IAArB;AACA0B,yBAAe,GAAGtB,aAAlB;AACAqB,sBAAY,GAAGtB,UAAf;AACA4zB,sBAAY,GAAG1zB,SAAf;AACA;;AACD,eAAO7G,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,aAAO,KAAKgH,UAAL,CAAgBT,IAAhB,CAAP;AACA,KAlBD,CADM,EAoBLlC,IApBK,CAoBA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,oBAAV,EAAgC;AAC/ByD,WAAK,EAAEmF,eADwB;AAE/BzB,gBAAU,EAAEsB,YAFmB;AAG/BrB,mBAAa,EAAEsB,eAHgB;AAI/BrB,eAAS,EAAE0zB;AAJoB,KAAhC,CArBM,CAAP;AA4BA;;AAEDp3B,wBAAsB,GAAG;AACxB,WAAO,KAAKk3B,eAAL,GAAuB/1B,IAAvB,CAA4B6Z,YAAY,IAAI;AAClD,YAAMsN,QAAQ,GAAGtN,YAAY,CAACsc,GAAb,CAAiB3rB,GAAjB,GAAuBqP,YAAY,CAACsc,GAAb,CAAiB3rB,GAAjB,CAAqB5M,KAA5C,GAAoD,CAArE;AACA,YAAM4pB,aAAa,GAAG3N,YAAY,CAACsc,GAAb,CAAiBC,aAAjB,GAAiCvc,YAAY,CAACsc,GAAb,CAAiBC,aAAjB,CAA+Bx4B,KAAhE,GAAwE,CAA9F;;AACA,YAAM+pB,UAAU,GAAG,KAAK1O,WAAL,CAAiBY,YAAjB,CAAnB;;AACA,aAAO8N,UAAU,GAAGR,QAAb,GAAwBK,aAA/B;AACA,KALM,CAAP;AAMA;;AAED/lB,WAAS,CAACS,IAAD,EAAO;AACf,WAAO,KAAKqX,WAAL,CAAiBrX,IAAjB,EAAuB,KAAKiD,cAA5B,CAAP;AACA;;AAEDxC,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAKqX,WAAL,CAAiBrX,IAAjB,EAAuB,KAAKkD,eAA5B,CAAP;AACA;;AAEDmU,aAAW,CAACrX,IAAD,EAAOmU,GAAP,EAAY;AACtB,UAAM7O,QAAQ,GAAGG,IAAI,CAAC0R,SAAL,CAAe;AAC/Bgd,gBAAU,EAAEn0B,IADmB;AAE/B0Q,eAAS,EAAE,KAAKA;AAFe,KAAf,CAAjB;AAIA,WAAO,KAAKkjB,WAAL,CAAiBzf,GAAjB,EAAsB7O,QAAtB,CAAP;AACA;;AAEDuuB,iBAAe,GAAG;AACjB,WAAOO,8CAAO,CAACC,GAAR,CAAY,iDAAZ,EAA+Dv2B,IAA/D,CAAoE2E,QAAQ,IAAIA,QAAQ,CAACkD,IAAT,EAAhF,CAAP;AACA;;AAEDiuB,aAAW,CAACzf,GAAD,EAAM7O,QAAN,EAAgB;AAC1B,WAAO8uB,8CAAO,CACZE,IADK,CACAngB,GADA,EACK7O,QADL,EACe;AACpB9C,aAAO,EAAE,KAAK1D,eADM;AAEpBy1B,qBAAe,EAAE;AAFG,KADf,EAKLz2B,IALK,CAKA2E,QAAQ,IAAIA,QAAQ,CAACkD,IAAT,EALZ,CAAP;AAMA;;AAEDmuB,kBAAgB,CAACnuB,IAAD,EAAO;AACtB,QAAIA,IAAI,CAAC7C,IAAT,EAAe;AACd,aAAO6C,IAAI,CAAC7C,IAAL,CAAU0xB,KAAV,CAAgB3xB,MAAvB;AACA;;AACD,WAAO8C,IAAI,CAACsuB,GAAL,CAASO,KAAT,CAAe3xB,MAAtB;AACA;;AAEDkU,aAAW,CAACpR,IAAD,EAAO;AACjB,QAAIA,IAAI,CAAC7C,IAAT,EAAe;AACd,aAAO6C,IAAI,CAAC7C,IAAL,CAAU2xB,SAAV,CAAoB/4B,KAA3B;AACA;;AACD,WAAOiK,IAAI,CAACsuB,GAAL,CAASQ,SAAT,CAAmB/4B,KAA1B;AACA;;AAhMuD,CAAzD;AAmMe;AACduK,MAAI,EAAE,eADQ;AAEd5M,QAAM,EAAE,kBAFM;AAGduN,QAHc;AAIdwC,iBAAe,EAAE,IAJH;AAKdD,WAAS,EAAE;AALG,CAAf,E;;;;;;;;;;;;ACtNA;AAAA;AAAA;AAAA;AACA;AAEA;;;;;;;;;;AAUA,MAAM5F,aAAa,GAAG,oCAAtB;AACA,MAAMmxB,gBAAgB,GAAG,uCAAzB;AACA,MAAMC,YAAY,GAAGzuB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC9C,aAAhC,CAArB;AAEA,MAAMqD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,2BAAtB;AACA,SAAKgB,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,0EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AAEA,SAAKI,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA;;AAEDlC,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAjBuD,CAAzD;AAoBe;AACdiG,MAAI,EAAE,WADQ;AAEd5M,QAAM,EAAE,mBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;AAKdyC,iBAAe,EAAE,CAACsrB,YAAD,GAAgBD,gBAAhB,GAAmC,KALtC;AAMd7pB,kBAAgB,EAAEC,wDAAiB,CAACC,OANtB;;AAOdpD,aAAW,GAAG;AACb,WAAOpM,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAP;AACA,GATa;;AAUd2O,aAAW,CAAC/D,IAAD,EAAO;AACjB,UAAMwuB,YAAY,GAAG,CAAC,SAAD,EAAY,2BAAZ,EAAyC,mBAAzC,CAArB;AACA,WACCD,YAAY,IACXC,YAAY,CAAC7oB,IAAb,CAAkBmnB,OAAO,IAAI9sB,IAAI,CAACO,QAAL,CAAcusB,OAAd,CAA7B,KAAwD33B,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,CAF1D;AAIA;;AAhBa,CAAf,E;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM+H,aAAa,GAAG,iCAAtB;AACA,MAAM6G,iBAAiB,GAAG,sCAA1B;AACA,MAAM2I,wBAAwB,GAAG,wBAAjC;AACA,MAAMC,4BAA4B,GAAG,2BAArC;AAEA,MAAMpM,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,UAAMqL,QAAQ,GAAG,gFAAjB;AAEA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKpK,WAAL,GAAmB,IAAnB,CAPa,CASb;AACA;;AACA,SAAK2E,4BAAL,GAAoC,IAApC;AAEA,SAAKV,aAAL,GAAqBA,aAArB;AAEA,SAAK/E,uBAAL,GAA+B,qBAA/B;AACA,SAAKC,mBAAL,GAA2B,uBAA3B;AAEA,SAAKkF,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AAEA,SAAKpE,qBAAL,GAA6B,qEAA7B;AACA;;AAEDkC,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDuE,eAAa,GAAG;AACf,WAAOhJ,QAAQ,CAACC,aAAT,CAAuB,KAAKkD,kBAA5B,CAAP;AACA;;AA9BuD,CAAzD;AAiCe;AACduH,MAAI,EAAE,cADQ;AAEd5M,QAAM,EAAE,iBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;;AAKdiE,kBAAgB,GAAG;AAClB,WAAOtP,QAAQ,CAACC,aAAT,CAAuB,kBAAvB,IAA6CsP,wDAAiB,CAACC,OAA/D,GAAyED,wDAAiB,CAACsS,OAAlG;AACA,GAPa;;AAQdzV,aAAW,GAAG;AACb,WAAOpM,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAP;AACA,GAVa;;AAWd2O,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACC7K,QAAQ,CAACC,aAAT,CAAwB,GAAEwX,4BAA6B,KAAID,wBAAyB,EAApF,MACC3M,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KAAkC6C,IAAI,CAACC,UAAL,CAAgB+D,iBAAhB,CADnC,CADD;AAIA;;AAhBa,CAAf,E;;;;;;;;;;;;ACzCA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM;AAAElM;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA,MAAMuL,QAAQ,GAAG,iCAAjB;AACA,MAAMnD,gBAAgB,GAAI,GAAEmD,QAAS,uDAArC;AACA,MAAMwM,YAAY,GAAI,GAAE3P,gBAAiB,4BAAzC;AACA,MAAMsuB,UAAU,GAAI,GAAEnrB,QAAS,OAA/B;AACA,MAAMorB,UAAU,GAAI,GAAEvuB,gBAAiB,kBAAvC;AACA,MAAM2rB,aAAa,GAAI,GAAExoB,QAAS,0EAAlC;AAEA,MAAM7C,mBAAmB,GAAG,mDAA5B;AAEA,MAAMD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AAEA,SAAK4E,cAAL,GAAuB,GAAEsD,gBAAiB,qBAA1C;AACA,SAAKpD,kBAAL,GAA0B0xB,UAA1B;AACA,SAAKtxB,aAAL,GAAqBsxB,UAArB;AACA,SAAK/kB,YAAL,GAAoB5J,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC6P,YAAhC,CAApB;AAEA,SAAKnS,kBAAL,GAA0B,QAA1B;AACA,SAAKC,oCAAL,GAA4C,SAA5C;AAEA,SAAKzF,qBAAL,GAA6B,WAA7B;AACA,SAAKD,cAAL,GAAsB,cAAtB;AAEA,SAAKG,mBAAL,GAA2B,oBAA3B;AACA,SAAKs2B,mBAAL,GAA2B,OAA3B;AACA,SAAKv2B,uBAAL,GAA+B,kBAA/B;AACA,SAAKI,oBAAL,GAA4B,uBAA5B;AACA,SAAKS,sBAAL,GAA8B,QAA9B;AAEA,SAAKsE,gBAAL,GAAwB,IAAIC,eAAJ,CAAoB;AAC3CvL,YAAM,EAAE;AADmC,KAApB,CAAxB;AAIA,SAAKiH,WAAL,GAAmB,IAAnB;AACA,SAAK01B,aAAL,GAAqB,IAArB;AACA;;AAEDh5B,iBAAe,GAAG;AACjB,WAAO,CAAC,KAAK8T,YAAL,GAAoB,KAAKzL,eAAL,EAApB,GAA6C7K,+CAAO,CAACC,OAAR,CAAgB,IAAhB,CAA9C,EAAqEqE,IAArE,CAA0E8G,YAAY,IAAI;AAChG,WAAKqwB,aAAL,GAAqB,EAArB;AACA,WAAKD,aAAL,GAAqBpwB,YAArB;;AACA,YAAMswB,YAAY,GAAG,KAAK1nB,iBAAL,CAAuB5I,YAAvB,CAArB;;AAEA,UAAIswB,YAAY,CAACryB,MAAjB,EAAyB;AACxB,eAAO,KAAKmR,YAAL,CAAkBkhB,YAAlB,CAAP;AACA;;AAED,aAAO17B,+CAAO,CAACC,OAAR,EAAP;AACA,KAVM,CAAP;AAWA;;AAED+C,kBAAgB,GAAG;AAClB,WAAO;AACNC,WAAK,EAAE,KAAKw4B,aADN;AAENv4B,eAAS,EAAE,KAAKu4B,aAAL,CAAmBpyB;AAFxB,KAAP;AAIA;;AAEDvG,aAAW,GAAG;AACb,WAAO9C,+CAAO,CAACC,OAAR,EAAP;AACA;;AAEDwC,kBAAgB,GAAG;AAClB,WAAO;AACNwD,mBAAa,EAAE,KAAKC,UAAL,CAAgB,KAAKs1B,aAArB,CADT;AAENp1B,wBAAkB,EAAE,KAAKC,eAAL,CAAqB,KAAKm1B,aAA1B;AAFd,KAAP;AAIA;;AAEDxnB,mBAAiB,CAAC1K,IAAD,EAAO;AACvB,UAAMrG,KAAK,GAAG,CAAC,GAAGyB,cAAc,CAAC,KAAKO,mBAAN,EAA2BqE,IAA3B,EAAiC,IAAjC,CAAlB,EAA0DlC,GAA1D,CACbgQ,IAAI,IAAIA,IAAI,CAAChV,WAAL,CAAiBG,KAAjB,CAAuB,KAAKg5B,mBAA5B,EAAiD,CAAjD,CADK,CAAd;AAIA,WAAOt4B,KAAP;AACA;;AAEDuX,cAAY,CAACvX,KAAD,EAAQ;AACnB,WAAOjD,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAAI,KAAKS,UAAL,CAAgBT,IAAhB,CAA5B,EACLlC,IADK,CACA,MAAM,KAAKuG,eAAL,EADN,EAELvG,IAFK,CAEA8G,YAAY,IAAI;AACrB,WAAKqwB,aAAL,GAAqB,CAAC,GAAG,KAAKA,aAAT,EAAwB,GAAGx4B,KAA3B,CAArB;;AACA,YAAMy4B,YAAY,GAAG,KAAK1nB,iBAAL,CAAuB5I,YAAvB,CAArB;;AACA,UAAI,CAACswB,YAAY,CAACryB,MAAlB,EAA0B;AACzB,aAAKmyB,aAAL,GAAqBpwB,YAArB;AACA,eAAOpL,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED,aAAO,KAAKua,YAAL,CAAkBkhB,YAAlB,CAAP;AACA,KAXK,CAAP;AAYA;;AAEDz0B,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAtFuD,CAAzD;AAyFe;AACdiG,MAAI,EAAE,iBADQ;AAEd5M,QAAM,EAAE,qBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;;AAKduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACC,CAACA,IAAI,CAACC,UAAL,CAAgBwuB,UAAhB,KACAzuB,IAAI,CAACC,UAAL,CAAgByuB,UAAhB,CADA,IAEA1uB,IAAI,CAACC,UAAL,CAAgB6P,YAAhB,CAFA,IAGA9P,IAAI,CAACC,UAAL,CAAgB6rB,aAAhB,CAHD,KAIA32B,QAAQ,CAACC,aAAT,CAAuBqL,mBAAvB,CALD;AAOA;;AAba,CAAf,E;;;;;;;;;;;;AClIA;AAAA;AAAA;AAEA;;;;;;;;;;;AAWA,MAAM6C,QAAQ,GAAG,0BAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMU,iBAAiB,GAAI,GAAEV,QAAS,gBAAtC;AACA,MAAMnD,gBAAgB,GAAG,0EAAzB;AAEA,MAAMK,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,iFAAtB;AACA,SAAKgB,WAAL,GAAmB,IAAnB;AACA,SAAKuH,mBAAL,GAA2B,8BAA3B;AAEA,SAAK5D,cAAL,GAAuB,GAAEsD,gBAAiB,2DAA1C;AACA,SAAKrD,eAAL,GAAwB,GAAEqD,gBAAiB,4DAA3C;AACA,SAAKpD,kBAAL,GAA2B,GAAEoD,gBAAiB,gBAA9C;AACA,SAAK4uB,aAAL,GAAsB,GAAE5uB,gBAAiB,yDAAzC;AACA,SAAKzC,iBAAL,GAAyB,IAAIF,eAAJ,CAAoB;AAC5CwxB,+BAAyB,EAAE;AADiB,KAApB,CAAzB;AAIA,SAAK7xB,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,WAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKG,qBAAL,GAA6B;AAC5B,0BAAoB,gBADQ;AAE5B,sBAAgB;AAFY,KAA7B;AAIA,SAAKC,sBAAL,GAA8B;AAC7B,0BAAoB,gBADS;AAE7B,sBAAgB;AAFa,KAA9B;AAKA,SAAKC,sBAAL,GAA8B;AAC7B,0BAAoB;AADS,KAA9B;AAIA,SAAKmM,mBAAL,GAA2B,kBAA3B;AACA;;AAED/S,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAMuB,UAAU,GAAGtB,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KAAkC6C,IAAI,CAACC,UAAL,CAAgB+D,iBAAhB,CAArD;AACA,UAAMirB,WAAW,GAAG95B,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAApB;AACA,UAAM/D,OAAO,GAAGvQ,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAAhB;AACA,WAAOiF,OAAO,IAAI,CAACupB,WAAZ,IAA2B3tB,UAAlC;AACA;;AAEDlL,kBAAgB,GAAG;AAClB,WAAO,KAAK84B,YAAL,GAAoBx3B,IAApB,CAAyB6Z,YAAY,IAAI;AAC/C,YAAMlb,KAAK,GAAGkb,YAAY,CAACgW,UAAb,CAAwBlxB,KAAxB,CAA8BmE,GAA9B,CAAkCqH,EAAE,IAAIA,EAAE,CAACstB,WAA3C,CAAd;AACA,aAAO;AACN94B,aADM;AAENC,iBAAS,EAAED,KAAK,CAACoG;AAFX,OAAP;AAIA,KANM,CAAP;AAOA;;AAEDtD,WAAS,CAACS,IAAD,EAAO;AACf,UAAMqC,IAAI,GAAGoD,IAAI,CAAC0R,SAAL,CAAe;AAAEqe,eAAS,EAAEx1B;AAAb,KAAf,CAAb;AACA,WAAO,KAAKkF,gBAAL,CAAsB,KAAKjC,cAA3B,EAA2C,KAAKO,qBAAhD,EAAuE,IAAvE,EAA6EnB,IAA7E,CAAP;AACA;;AAED5B,YAAU,CAACT,IAAD,EAAO;AAChB,UAAMqC,IAAI,GAAGoD,IAAI,CAAC0R,SAAL,CAAe;AAAEqe,eAAS,EAAEx1B;AAAb,KAAf,CAAb;AACA,WAAO,KAAKkF,gBAAL,CAAsB,KAAKhC,eAA3B,EAA4C,KAAKO,sBAAjD,EAAyE,IAAzE,EAA+EpB,IAA/E,CAAP;AACA;;AAEDizB,cAAY,GAAG;AACd,WAAOnzB,KAAK,CAAC,KAAKgzB,aAAN,EAAqB;AAChCt3B,YAAM,EAAE,MADwB;AAEhC2E,aAAO,EAAE,KAAKgB,qBAFkB;AAGhCnB,UAAI,EAAEoD,IAAI,CAAC0R,SAAL,CAAe;AAAEse,qBAAa,EAAE;AAAjB,OAAf;AAH0B,KAArB,CAAL,CAIJ33B,IAJI,CAIC2E,QAAQ,IAAIA,QAAQ,CAACkD,IAAT,EAJb,CAAP;AAKA;;AArEuD,CAAzD;AAwEe;AACdM,MAAI,EAAE,UADQ;AAEd5M,QAAM,EAAE,cAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdxC;AALc,CAAf,E;;;;;;;;;;;;AC1FA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAExO;AAAF,IAAcC,6CAApB;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;AAcA,MAAMuL,QAAQ,GAAG,uEAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,iBAAlC;AAEA,MAAM9C,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKI,mBAAL,GAA2B,mBAA3B;AACA,SAAKH,cAAL,GAAsB,oCAAtB;AAEA,SAAK2E,cAAL,GAAuB,GAAEyG,QAAS,iBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,oBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,kBAAtC;AACA,SAAKgsB,gBAAL,GAAyB,GAAEhsB,QAAS,iBAApC;AAEA,SAAKisB,mBAAL,GAA2B,cAA3B;AAEA,SAAKr2B,WAAL,GAAmB,IAAnB;AACA,SAAKiE,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,SAA1B,EAAqC,aAArC;AAEA,SAAKizB,yBAAL,GAAiC,uBAAjC;AAEA,SAAKC,oBAAL,GAA4B,sBAA5B;AACA,SAAKzuB,mBAAL,GAA2B,aAA3B;AACA,SAAKqD,sBAAL,GAA8B,gEAA9B;AACA;;AAEDlO,kBAAgB,GAAG;AAClB,WAAO,KAAKqO,eAAL,GAAuB9M,IAAvB,CAA4B8G,YAAY,IAAI;AAClD,aAAO,CACN,GAAG,IAAI7D,GAAJ,CACF,CAAC,GAAG7C,cAAc,CAAC,KAAKuM,sBAAN,EAA8B7F,YAA9B,EAA4C,IAA5C,CAAlB,EACEhE,GADF,CACMqH,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeG,KAAf,CAAqB,KAAK45B,mBAA1B,CADZ,EAEE3tB,MAFF,CAESE,OAFT,EAGEtH,GAHF,CAGMqH,EAAE,IAAIA,EAAE,CAAC,CAAD,CAHd,CADE,CADG,CAAP;AAQA,KATM,CAAP;AAUA;;AAEDnL,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAM8J,SAAS,GAAG1U,QAAQ,CAACC,aAAT,CAAuB,KAAK4L,mBAA5B,CAAlB;AACA,UAAM0uB,UAAU,GAAGv6B,QAAQ,CAACC,aAAT,CAAuB,KAAKq6B,oBAA5B,CAAnB;AACA,UAAME,eAAe,GAAGx6B,QAAQ,CAACC,aAAT,CAAuB,KAAKo6B,yBAA5B,CAAxB;AACA,UAAMI,iBAAiB,GAAG5vB,IAAI,CAACO,QAAL,CAAc,qBAAd,IACvBovB,eAAe,IAAIA,eAAe,CAACrtB,OADZ,GAEvB,IAFH;AAGA,UAAMutB,QAAQ,GACb7vB,IAAI,CAACC,UAAL,CAAgBqD,QAAhB,MACCtD,IAAI,CAACO,QAAL,CAAc,qBAAd,KACAP,IAAI,CAACO,QAAL,CAAc,qBAAd,CADA,IAEAP,IAAI,CAACO,QAAL,CAAc,qBAAd,CAHD,CADD;AAMA,WAAO,CAACsJ,SAAD,IAAcgmB,QAAd,IAA0BH,UAA1B,IAAwCE,iBAA/C;AACA;;AAEDt2B,YAAU,CAACoD,IAAD,EAAO;AAChB,QAAIA,IAAJ,EAAU;AACT,aAAO1K,OAAO,CAAC0K,IAAI,CAACozB,WAAL,CAAiBx6B,KAAlB,CAAd;AACA;;AACD,WAAOtD,OAAO,CAACmD,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,EAA4C4C,SAA7C,CAAd;AACA;;AAEDvE,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B6Z,YAAY,IAAI;AAClD,YAAMxP,QAAQ,GAAGwP,YAAY,CAACwe,cAAb,CAA4Bz6B,KAA7C;AACA,YAAM2R,KAAK,GAAGsK,YAAY,CAACye,SAAb,CAAuB16B,KAArC;AACA,aAAO,KAAKgE,UAAL,CAAgBiY,YAAhB,IAAgCvf,OAAO,CAACiV,KAAK,IAAI,CAAV,CAAvC,GAAsDjV,OAAO,CAAC+P,QAAQ,IAAI,CAAb,CAApE;AACA,KAJM,CAAP;AAKA;;AAEDyC,iBAAe,GAAG;AACjB,WAAO,KAAK/F,eAAL,CAAqB,KAAK6wB,gBAA1B,EAA4C,KAAKhyB,sBAAjD,CAAP;AACA;;AAzEuD,CAAzD;AA4Ee;AACduC,MAAI,EAAE,OADQ;AAEd5M,QAAM,EAAE,WAFM;AAGduN,QAHc;AAIduC,WAAS,EAAE,IAJG;AAKdC,iBAAe,EAAE;AALH,CAAf,E;;;;;;;;;;;;ACnGA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAElL,gBAAF;AAAkBD;AAAlB,IAAwCE,0CAA9C;AACA,MAAM;AAAEH,aAAF;AAAe5F;AAAf,IAA2BC,6CAAjC;AAEA;;;;;;;;;;;;;;;;;AAiBA,MAAMqR,QAAQ,GAAG,0BAAjB;AAEA,MAAM9C,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAK0P,cAAL,GAAsB7H,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,UAA9B,CAAtB;AACA,SAAK0vB,OAAL,GAAgB,GAAE3sB,QAAS,kDAA3B;AACA,SAAKzG,cAAL,GAAuB,GAAE,KAAKozB,OAAQ,qBAAtC;AACA,SAAKnzB,eAAL,GAAwB,GAAE,KAAKmzB,OAAQ,wBAAvC;AACA,SAAKlzB,kBAAL,GAA0B,KAAK4K,cAAL,GAAuB,GAAErE,QAAS,mBAAlC,GAAwD,GAAEA,QAAS,OAA7F;AAEA,SAAKpG,sBAAL,GAA8B,YAA9B;AACA,SAAKW,4BAAL,GAAoC,IAApC;AAEA,SAAK3F,cAAL,GAAsB,wBAAtB;AACA,SAAK0I,YAAL,GAAoB,gCAApB;AACA,SAAKF,iBAAL,GAAyB,+BAAzB;AACA,SAAKC,0BAAL,GAAkC,wCAAlC;AACA,SAAKuvB,uBAAL,GAA+B,sDAA/B;AACA,SAAK53B,kBAAL,GAA0B,uBAA1B;AAEA,SAAKY,WAAL,GAAmB,IAAnB;AACA,SAAKi3B,YAAL,GAAoB,IAApB;AACA,SAAKC,UAAL,GAAkB,IAAlB;AACA;;AAEDx6B,iBAAe,GAAG;AACjB,SAAKw6B,UAAL,GAAkBv4B,iBAAiB,CAAC,KAAKS,kBAAN,CAAnC;AACA,SAAKiF,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AAEA,SAAK8zB,WAAL,GAAmB;AAClB,sBAAgB,mCADE;AAElB,wBAAkB,IAFA;AAGlB,mCAA6B;AAHX,KAAnB;AAKA;;AAEDj6B,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKs1B,uBAA/B,CAAJ,EACZtuB,MADY,CACLC,EAAE,IAAIA,EAAE,CAACrM,WAAH,IAAkB,CAACqM,EAAE,CAACrM,WAAH,CAAeG,KAAf,CAAqB,cAArB,CADpB,EAEZ6E,GAFY,CAERqH,EAAE,IAAIA,EAAE,CAACrM,WAFD,CAAd;AAGA,WAAO;AACNa,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDlG,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B8G,YAAY,IAAI;AAClD,YAAMsH,KAAK,GAAG,KAAKxM,UAAL,CAAgBkF,YAAhB,CAAd;AACA,YAAMsmB,UAAU,GAAGhtB,cAAc,CAAC,KAAK8I,YAAN,EAAoBpC,YAApB,CAAjC;AACA,YAAMomB,eAAe,GAAG9sB,cAAc,CAAC,KAAK4I,iBAAN,EAAyBlC,YAAzB,CAAtC;AACA,YAAMqmB,uBAAuB,GAAG/sB,cAAc,CAAC,KAAK6I,0BAAN,EAAkCnC,YAAlC,CAA9C;AACA,YAAMyD,gBAAgB,GAAG4iB,uBAAuB,GAAGjtB,WAAW,CAACitB,uBAAD,CAAd,GAA0C,CAA1F;AACA,YAAM3iB,GAAG,GAAG4iB,UAAU,IAAI,CAACA,UAAU,CAACtvB,WAAX,CAAuB+K,QAAvB,CAAgC,KAAhC,CAAf,GAAwDukB,UAAU,CAACtvB,WAAnE,GAAiF,CAA7F;AACA,YAAMuM,QAAQ,GACb6iB,eAAe,IAAI,CAACA,eAAe,CAACpvB,WAAhB,CAA4B+K,QAA5B,CAAqC,KAArC,CAApB,GAAkEqkB,eAAe,CAACpvB,WAAlF,GAAgG,CADjG;AAEA,aAAOxD,OAAO,CAAC8T,KAAD,CAAP,GAAiB9T,OAAO,CAACkQ,GAAD,CAAxB,GAAgClQ,OAAO,CAAC+P,QAAD,CAAvC,GAAoDE,gBAA3D;AACA,KAVM,CAAP;AAWA;;AAED9I,WAAS,CAACS,IAAD,EAAO;AACf,QAAI,KAAK+N,cAAT,EAAyB;AACxB,aAAO,KAAK2oB,oBAAL,CAA0B12B,IAA1B,CAAP;AACA;;AACD,WAAO,KAAK22B,gBAAL,CAAsB32B,IAAtB,CAAP;AACA;;AAEDS,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK+N,cAAL,GAAsB,KAAK6oB,qBAAL,CAA2B52B,IAA3B,CAAtB,GAAyD,KAAK62B,iBAAL,CAAuB72B,IAAvB,CAAhE;AACA;;AAED62B,mBAAiB,GAAG;AACnB,SAAKL,UAAL,CAAgBl0B,MAAhB,CAAuBK,GAAvB,CAA2B,uBAA3B,EAAoD,EAApD;AACA,SAAK6zB,UAAL,CAAgBl0B,MAAhB,CAAuBK,GAAvB,CAA2B,oCAA3B,EAAiE,QAAjE;AACA,SAAK6zB,UAAL,CAAgBl0B,MAAhB,CAAuBgV,MAAvB,CAA8B,sBAA9B;AACA,WAAO,KAAKwf,UAAL,CAAgB,KAAKN,UAAL,CAAgBp0B,MAAhC,EAAwC,KAAKo0B,UAAL,CAAgBl0B,MAAxD,CAAP;AACA;;AAEDs0B,uBAAqB,CAAC52B,IAAD,EAAO;AAC3B,QAAI,KAAKsD,sBAAT,EAAiC;AAChC,WAAKO,iBAAL,CAAuBlB,GAAvB,CAA2B,KAAKW,sBAAhC,EAAwDtD,IAAxD;AACA;;AAED,WAAO,KAAK6E,eAAL,CAAqB,KAAK3B,eAA1B,EAA2C,KAAKO,sBAAhD,EAAwE,KAAKI,iBAA7E,CAAP;AACA;;AAED8yB,kBAAgB,CAAC32B,IAAD,EAAO;AACtB,SAAKw2B,UAAL,CAAgBl0B,MAAhB,CAAuBK,GAAvB,CAA2B,uBAA3B,EAAoD3C,IAApD;AACA,SAAKw2B,UAAL,CAAgBl0B,MAAhB,CAAuBK,GAAvB,CAA2B,sBAA3B,EAAmD,sBAAnD;AACA,SAAK6zB,UAAL,CAAgBl0B,MAAhB,CAAuBgV,MAAvB,CAA8B,oCAA9B;AACA,WAAO,KAAKwf,UAAL,CAAgB,KAAKN,UAAL,CAAgBp0B,MAAhC,EAAwC,KAAKo0B,UAAL,CAAgBl0B,MAAxD,CAAP;AACA;;AAEDw0B,YAAU,CAAC3iB,GAAD,EAAM9R,IAAN,EAAY;AACrB,WAAOF,KAAK,CAACgS,GAAD,EAAM;AACjB5R,iBAAW,EAAE,SADI;AAEjBC,aAAO,EAAE,KAAKi0B,WAFG;AAGjBp0B,UAHiB;AAIjBxE,YAAM,EAAE;AAJS,KAAN,CAAL,CAKJC,IALI,CAKCyW,GAAG,IAAIA,GAAG,CAAC7R,IAAJ,EALR,CAAP;AAMA;;AAEDg0B,sBAAoB,CAAC12B,IAAD,EAAO;AAC1B,SAAK2D,gBAAL,CAAsBhB,GAAtB,CAA0B,KAAKU,qBAA/B,EAAsDrD,IAAtD;AAEA,WAAO,KAAK6E,eAAL,CAAqB,KAAK5B,cAA1B,EAA0C,KAAKO,qBAA/C,EAAsE,KAAKG,gBAA3E,CAAP;AACA;;AAEDjE,YAAU,CAACoD,IAAI,GAAG,KAAR,EAAe;AACxB,QAAI,OAAOA,IAAP,KAAgB,QAAhB,IAA4BA,IAAI,KAAK,KAAzC,EAAgD;AAC/C,aAAO9E,WAAW,CAACE,cAAc,CAAC,KAAKI,cAAN,EAAsBwE,IAAtB,CAAf,CAAlB;AACA;;AACD,WAAOA,IAAI,CAACi0B,WAAZ;AACA;;AAjHuD,CAAzD;AAoHe;AACd9wB,MAAI,EAAE,YADQ;AAEd5M,QAAM,EAAE,cAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;;AAKduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACCA,IAAI,CAACC,UAAL,CAAgBqD,QAAhB,MACCnO,QAAQ,CAACC,aAAT,CAAuB,mCAAvB,KACAD,QAAQ,CAACC,aAAT,CAAuB,2BAAvB,CAFD,CADD;AAKA,GAXa;;AAYdwf,8BAA4B,EAAE;AAZhB,CAAf,E;;;;;;;;;;;;AC7IA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAEhd;AAAF,IAAkB3F,6CAAxB;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;AASA,MAAMyI,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,2BAAtB;AACA,SAAK0Q,qBAAL,GAA6B,6BAA7B;AAEA,SAAKzL,aAAL,GAAqB,kCAArB;AACA,SAAKsV,uBAAL,GAA+B,+BAA/B;AACA,SAAK9R,0BAAL,GAAkC,wCAAlC;AAEA,SAAKzH,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,mFAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,wBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKrG,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,YAA9B;AAEA,SAAKK,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AACA;;AAEDnG,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKgO,qBAA/B,CAAJ,EAA2DpO,GAA3D,CAA+D2S,IAAI,IAAIA,IAAI,CAACrS,SAAL,CAAeC,IAAf,EAAvE,CAAd;AAEA,WAAO;AACN1E,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDlG,wBAAsB,GAAG;AACxB;AACA,WAAO,KAAK+H,WAAL,GAAmB5G,IAAnB,CAAwB8G,YAAY,IAAI;AAC9C,YAAM0gB,aAAa,GAAGtnB,WAAW,CAACE,cAAc,CAAC,KAAK2a,uBAAN,EAA+BjU,YAA/B,CAAf,CAAjC;AACA,YAAM2gB,eAAe,GAAG5qB,MAAM,CAAC6qB,KAAP,CAAaF,aAAb,IAA8B,CAA9B,GAAkCA,aAA1D;AACA,YAAMjW,oBAAoB,GAAGnR,cAAc,CAAC,KAAK6I,0BAAN,EAAkCnC,YAAlC,CAA3C;AACA,YAAMyD,gBAAgB,GAAGgH,oBAAoB,GAAGrR,WAAW,CAACqR,oBAAD,CAAd,GAAuC,CAApF;AACA,YAAM2nB,kBAAkB,GAAGr8B,MAAM,CAAC6qB,KAAP,CAAand,gBAAb,IAAiC,CAAjC,GAAqCA,gBAAhE;AACA,YAAMod,UAAU,GAAG,KAAK/lB,UAAL,CAAgBkF,YAAhB,CAAnB;AACA,aAAO6gB,UAAU,GAAGF,eAAb,GAA+ByR,kBAAtC;AACA,KARM,CAAP;AASA;;AA5CuD,CAAzD;AA+Ce;AACd/wB,MAAI,EAAE,cADQ;AAEd5M,QAAM,EAAE,iBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;;AAKde,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAD,CAAd;AACA,GAPa;;AAQd2O,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACC7K,QAAQ,CAACC,aAAT,CAAuB,wBAAvB,MACC4K,IAAI,CAACC,UAAL,CAAgB,kCAAhB,KACAD,IAAI,CAACC,UAAL,CAAgB,8CAAhB,CADA,IAEAD,IAAI,CAACC,UAAL,CAAgB,qCAAhB,CAFA,IAGAD,IAAI,CAACC,UAAL,CAAgB,yCAAhB,CAHA,IAIAD,IAAI,CAACO,QAAL,CAAc,mBAAd,CALD,CADD;AAQA;;AAjBa,CAAf,E;;;;;;;;;;;;AC9DA;AAAA;AAAA;AAAA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;AAoBA,MAAM+C,QAAQ,GAAG,+BAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,MAAlC;;AACA,MAAM6F,YAAY,GAAG,MACpBrJ,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC9C,aAAhC,KAAkDhI,QAAQ,CAACC,aAAT,CAAuB,wBAAvB,CADnD;;AAGA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,cAAtB;AACA,SAAK8E,sBAAL,GAA8B,oBAA9B;AACA,SAAK7E,qBAAL,GAA6BgR,YAAY,KAAK,oBAAL,GAA4B,wCAArE;AACA,SAAK0nB,qBAAL,GAA6B,qBAA7B;AACA,SAAKpwB,mBAAL,GAA2B,mDAA3B;AACA,SAAK0E,qBAAL,GAA6B,aAA7B;AACA,SAAKZ,wBAAL,GAAgC,kCAAhC;AACA,SAAKrL,WAAL,GAAmB,IAAnB;AAEA,UAAMiH,gBAAgB,GAAG,oFAAzB;AACA,SAAKtD,cAAL,GAAuB,GAAEsD,gBAAiB,qBAA1C;AACA,SAAKrD,eAAL,GAAwB,GAAEqD,gBAAiB,6BAA3C;AACA,SAAKpD,kBAAL,GAA2B,GAAEoD,gBAAiB,0BAA9C;AAEA,SAAKhD,aAAL,GAAqBA,aAArB;AACA,SAAKD,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA;;AAED7G,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAM2F,OAAO,GAAGvQ,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAAhB;AACA,UAAM8F,QAAQ,GACbvG,IAAI,CAACC,UAAL,CAAgB,KAAK9C,aAArB,KACA6C,IAAI,CAACC,UAAL,CAAiB,GAAEqD,QAAS,WAA5B,CADA,IAEAtD,IAAI,CAACC,UAAL,CAAiB,GAAEqD,QAAS,UAA5B,CAFA,IAGAtD,IAAI,CAACC,UAAL,CAAiB,GAAEqD,QAAS,WAA5B,CAJD;AAKA,UAAM9Q,YAAY,GAAGkT,OAAO,IAAIa,QAAhC;AACA,WAAO/T,YAAP;AACA;;AAED6H,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDuE,eAAa,GAAG;AACf,WACC2B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,KAAK9C,aAArC,KAAuDhI,QAAQ,CAACC,aAAT,CAAuB,KAAKy7B,qBAA5B,CADxD;AAGA;;AA5CuD,CAAzD;AA+Ce;AACdhxB,MAAI,EAAE,gBADQ;AAEd5M,QAAM,EAAE,mBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdslB,YAAU,EAAE,EALE;AAMd7jB,kBAAgB,EAAEC,wDAAiB,CAACC,OANtB;AAOdnE;AAPc,CAAf,E;;;;;;;;;;;;AC3EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAM;AAAE7D;AAAF,IAA6B5E,0CAAnC;AAEA,MAAMoF,aAAa,GAAG,4CAAtB;AAEA;;;;;;;;AAQA,MAAMqD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,cAAtB;AACA,SAAK8E,sBAAL,GAA8B,4BAA9B;AACA,SAAK8zB,aAAL,GAAqB,uCAArB;AACA,SAAK53B,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,0EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,wBAAnC;AACA,SAAKnG,aAAL,GAAqBA,aAArB;AAEA,SAAKM,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AACA,SAAK8G,kBAAL,GAA0B,sBAA1B;AACA;;AAEDjN,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAClB,QAAQ,CAACC,aAAT,CAAuB,KAAK4H,sBAA5B,CAAD,EACZ4E,MADY,CACLE,OADK,EAEZtH,GAFY,CAERK,OAAO,IAAIA,OAAO,CAACC,SAAR,CAAkBC,IAAlB,GAAyBpF,KAAzB,CAA+B,KAAK0N,kBAApC,EAAwD,CAAxD,CAFH,CAAd;AAIA,WAAO;AACNhN,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDvG,aAAW,CAACG,KAAD,EAAQ;AAClB,SAAK06B,KAAL,GAAa57B,QAAQ,CAACC,aAAT,CAAuB,KAAK07B,aAA5B,EAA2CjoB,OAA3C,CAAmDmoB,IAAhE;AACA,WAAO59B,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAAI,KAAKS,UAAL,CAAgBT,IAAhB,EAAsB,KAAKm3B,KAA3B,CAA5B,EACLr5B,IADK,CACA,MAAM,KAAKuG,eAAL,EADN,EAELvG,IAFK,CAEA2E,QAAQ,IAAI,KAAK/C,UAAL,CAAgB+C,QAAhB,CAFZ,CAAP;AAGA;;AAEDtG,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2C;AACpDxF,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACA,UAAMK,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0Bu5B,YAAY,IAAI;AACzC,YAAMn3B,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE;AAHD,OAAf;;AAMA,UAAI2C,sBAAsB,CAACs0B,YAAD,EAAe,KAAKH,aAApB,CAA1B,EAA8D;AAC7D,aAAKC,KAAL,GAAap0B,sBAAsB,CAACs0B,YAAD,EAAe,KAAKH,aAApB,CAAtB,CAAyDjoB,OAAzD,CAAiEmoB,IAA9E;AAEA,eAAO,KAAK/yB,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9CvC,gBAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB+C,QAAhB,CAApB;AACAvC,gBAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;;AACA,cAAID,MAAM,CAACC,UAAP,GAAoBV,aAAxB,EAAuC;AACtCK,4BAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AAED,iBAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsB,KAAKm3B,KAA3B,EAAkCr5B,IAAlC,CAAuC,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAA7C,CAAP;AACA,SARM,CAAP;AASA;;AACD,aAAOnH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA,KArBD,CADM,EAuBLpC,IAvBK,CAuBA,MAAM;AACZ,UAAI,KAAKwB,WAAT,EAAsB;AACrBvG,oDAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,eAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,mBAAS,EAAEhB,gBAFa;AAGxBL;AAHwB,SAAzB;AAKA;;AACD,aAAOjG,+CAAO,CAACC,OAAR,EAAP;AACA,KAhCM,CAAP;AAiCA;;AAEDgH,YAAU,CAACT,IAAD,EAAOs3B,IAAP,EAAa;AACtB,SAAKzzB,iBAAL,CAAuBlB,GAAvB,CAA2B,MAA3B,EAAmC20B,IAAnC;AAEA,WAAO,KAAKzyB,eAAL,CAAqB,KAAK3B,eAA1B,EAA2C,KAAKO,sBAAhD,EAAwE,KAAKI,iBAA7E,CAAP;AACA;;AA7EuD,CAAzD;AAgFe;AACdoC,MAAI,EAAE,UADQ;AAEd5M,QAAM,EAAE,cAFM;AAGduN,QAHc;AAIdiE,kBAAgB,EAAEC,wDAAiB,CAACC,OAJtB;AAKd5B,WAAS,EAAE,IALG;;AAMdxB,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAD,CAAd;AACA,GARa;;AASd2O,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACC,CAACA,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KAAkC6C,IAAI,CAAC8U,QAAL,CAAc,iBAAd,CAAnC,KACA3f,QAAQ,CAACC,aAAT,CAAuB,wBAAvB,CAFD;AAIA;;AAda,CAAf,E;;;;;;;;;;;;ACjGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA,MAAM;AAAE+7B;AAAF,IAAWtiB,mDAAjB;AAEA,MAAM;AAAE/W;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;;;;;AAkBA,MAAMuL,QAAQ,GAAG,yBAAjB;AACA,MAAMyL,QAAQ,GAAI,GAAEzL,QAAS,OAA7B;AACA,MAAMnD,gBAAgB,GAAI,GAAEmD,QAAS,kDAArC;AACA,MAAM8tB,gBAAgB,GAAI,GAAEjxB,gBAAiB,kBAA7C;AAEA,MAAMK,MAAM,GAAG,MAAMA,MAAN,SAAqBkH,wDAArB,CAAkC;AAChDzP,aAAW,GAAG;AACb;AACA,SAAK+I,mBAAL,GAA2B,kBAA3B;AACA,SAAKqwB,oBAAL,GAA4B,wBAA5B;AACA,SAAKn5B,cAAL,GAAsB,2BAAtB;AACA,SAAKmP,sBAAL,GAA8B,8CAA9B;AACA,SAAKiqB,iBAAL,GAAyB,8CAAzB;AACA,SAAKhqB,mBAAL,GAA2B,gBAA3B;AACA,SAAKpO,WAAL,GAAmB,KAAnB;AACA;;AAED1C,iBAAe,GAAG;AACjB4O,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAE,MAAM9O,eAAN,EADO;AAEvB+O,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAED7O,gBAAc,GAAG;AAChB,UAAM66B,cAAc,GAAGzxB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBJ,WAArB,EAAvB;AAEA,UAAM4xB,UAAU,GAAGD,cAAc,CAAChxB,QAAf,CAAwB,oBAAxB,CAAnB,CAHgB,CAIhB;AACA;;AACA,UAAMgB,WAAW,GAAGpM,QAAQ,CAACC,aAAT,CAAuB,KAAK4L,mBAA5B,CAApB;AACA,UAAMV,MAAM,GACX,CAACixB,cAAc,CAAChxB,QAAf,CAAwBwO,QAAxB,KACAyiB,UADA,IAEAD,cAAc,CAAChxB,QAAf,CAAwB6wB,gBAAgB,CAACxxB,WAAjB,EAAxB,CAFD,KAGAzK,QAAQ,CAACC,aAAT,CAAuB,KAAKi8B,oBAA5B,CAJD;AAKA,WAAO/wB,MAAM,IAAI,CAACiB,WAAlB;AACA;;AAED,QAAMpL,gBAAN,GAAyB;AACxB,UAAMs7B,UAAU,GAAGt8B,QAAQ,CAACkf,aAAT,CAAuB,QAAvB,CAAnB;AACAod,cAAU,CAACC,GAAX,GAAiB3iB,QAAjB;AACAvP,UAAM,CAAC8U,MAAP,CAAcmd,UAAU,CAAChuB,KAAzB,EAAgC;AAAE8Q,aAAO,EAAE;AAAX,KAAhC;AACApf,YAAQ,CAACiJ,eAAT,CAAyBoW,WAAzB,CAAqCid,UAArC;;AACA,UAAME,WAAW,GAAG,MAAM;AACzB,aAAO,CAAC,EACP,CAAC,GAAGF,UAAU,CAACG,eAAX,CAA2Bh3B,gBAA3B,CAA4C,KAAK02B,iBAAjD,CAAJ,EAAyE70B,MAAzE,GAAkF,CAAlF,IACA,CAAC,GAAGg1B,UAAU,CAACG,eAAX,CAA2Bh3B,gBAA3B,CAA4C,KAAKyM,sBAAjD,CAAJ,EAA8E5K,MAA9E,GAAuF,CAFhF,CAAR;AAIA,KALD;;AAMA,UAAM00B,IAAI,CAACQ,WAAD,EAAc,KAAd,EAAqB,GAArB,EAA0B,IAA1B,CAAV;;AACA,QAAIA,WAAW,EAAf,EAAmB;AAClB,aAAO,CACN,GAAG,IAAIh3B,GAAJ,CAAQ,CACV,GAAG,CAAC,GAAG82B,UAAU,CAACG,eAAX,CAA2Bh3B,gBAA3B,CAA4C,KAAKyM,sBAAjD,CAAJ,EACD7M,GADC,CACGqH,EAAE,IAAKA,EAAE,CAAC/G,SAAH,CAAaC,IAAb,GAAoB6E,WAApB,OAAsC,gBAAtC,GAAyD,EAAzD,GAA8DiC,EAAE,CAAC/G,SAAH,CAAaC,IAAb,EADxE,EAED6G,MAFC,CAEME,OAFN,CADO,EAIV,GAAG,CAAC,GAAG2vB,UAAU,CAACG,eAAX,CAA2Bh3B,gBAA3B,CAA4C,KAAK02B,iBAAjD,CAAJ,EACD92B,GADC,CACGqH,EAAE,IAAIA,EAAE,CAACoN,GAAH,CAAOtZ,KAAP,CAAa,KAAK2R,mBAAlB,CADT,EAED1F,MAFC,CAEME,OAFN,EAGDtH,GAHC,CAGG7E,KAAK,IAAIA,KAAK,CAAC,CAAD,CAHjB,CAJO,CAAR,CADG,CAAP;AAWA;;AACD,WAAO,EAAP;AACA;;AAEDM,YAAU,CAACgF,cAAD,EAAiB;AAC1B,UAAM;AAAEP,eAAF;AAAarB;AAAb,QAA+B4B,cAArC,CAD0B,CAG1B;;AACAP,aAAS,CAACQ,IAAV,CAAe,CAACC,CAAD,EAAIC,CAAJ,KAAUA,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAA7C;AACA,QAAIqB,YAAY,GAAGhC,aAAnB;AACA,QAAIiC,eAAe,GAAG,CAAtB;AACA,UAAME,eAAe,GAAG,EAAxB;AACA,WAAOpI,+CAAO,CAACuG,IAAR,CAAae,SAAb,EAAwBD,QAAQ,IACtC,KAAKtB,SAAL,CAAesB,QAAQ,CAACb,IAAxB,EAA8B,KAAKR,YAAL,EAA9B,EAAmD1B,IAAnD,CAAwDmC,IAAI,IAAI;AAC/D,WAAKN,YAAL,GAAoBM,IAApB;AACA,YAAME,UAAU,GAAG,KAAKT,UAAL,CAAgBO,IAAhB,CAAnB;AACA,YAAMG,aAAa,GAAGX,aAAa,GAAGU,UAAtC;AACApH,kDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBgH,YAAI,EAAEa,QAAQ,CAACb,IADU;AAEzBG,kBAFyB;AAGzBC;AAHyB,OAA1B;;AAKA,UAAID,UAAU,GAAGsB,YAAjB,EAA+B;AAC9BG,uBAAe,CAACpB,IAAhB,CAAqBK,QAAQ,CAACb,IAA9B;AACA0B,uBAAe,GAAGtB,aAAlB;AACAqB,oBAAY,GAAGtB,UAAf;AACA,eAAO3G,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,aAAO,KAAKgH,UAAL,CAAgB,KAAKC,gBAAL,CAAsBG,QAAQ,CAACb,IAA/B,CAAhB,EAAsD,KAAKR,YAAL,EAAtD,EAA2E1B,IAA3E,CACNm6B,kBAAkB,IAAI;AACrB,aAAKt4B,YAAL,GAAoBs4B,kBAApB;AACA,eAAOz+B,+CAAO,CAACC,OAAR,EAAP;AACA,OAJK,CAAP;AAMA,KArBD,CADM,EAuBLqE,IAvBK,CAuBA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,oBAAV,EAAgC;AAC/ByD,WAAK,EAAEmF,eADwB;AAE/BzB,gBAAU,EAAEsB,YAFmB;AAG/BrB,mBAAa,EAAEsB;AAHgB,KAAhC,CAxBM,CAAP;AA8BA;;AAEDhB,kBAAgB,CAACV,IAAD,EAAO;AACtB,UAAM6B,aAAa,GAAG3D,cAAc,CAAC,KAAKM,uBAAN,EAA+B,KAAKmB,YAApC,EAAkD,IAAlD,CAApC;AACA,UAAMmC,oBAAoB,GAAG,CAAC,GAAGD,aAAJ,EAAmBE,IAAnB,CAAwBd,OAAO,IAAI;AAC/D,YAAMe,YAAY,GAAGf,OAAO,CAACzF,aAAR,CAAsB,KAAKiD,mBAA3B,CAArB;AACA,aAAOuD,YAAY,IAAIA,YAAY,CAACd,SAAb,CAAuBC,IAAvB,GAA8B6E,WAA9B,OAAgDhG,IAAI,CAACgG,WAAL,EAAvE;AACA,KAH4B,CAA7B;AAKA,WAAOlE,oBAAoB,GACxBA,oBAAoB,CAACtG,aAArB,CAAmC,KAAKoD,oBAAxC,EAA8DqH,IADtC,GAExB,KAAKtH,yBAFR;AAGA;;AAhH+C,CAAjD;AAmHe;AACdsH,MAAI,EAAE,UADQ;AAEd5M,QAAM,EAAE,aAFM;AAGduN,QAHc;AAIdwC,iBAAe,EAAE,IAJH;AAKdyB,kBAAgB,EAAEC,wDAAiB,CAACC;AALtB,CAAf,E;;;;;;;;;;;;ACpJA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM;AAAE7M;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AAEA;;;;;;;;;;;;;;;;;;;;;AAqBA,MAAMkL,aAAa,GAAG,+BAAtB;AACA,MAAMmG,QAAQ,GAAG,4EAAjB;AACA,MAAMhL,kBAAkB,GAAG,kBAA3B;;AACA,MAAMw5B,UAAU,GAAG,MAAMhyB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC9C,aAAhC,KAAkDhI,QAAQ,CAACC,aAAT,CAAuBkD,kBAAvB,CAA3E;;AAEA,MAAMy5B,eAAe,GAAG58B,QAAQ,CAACC,aAAT,CAAuB,sBAAvB,KAAkD,CAACD,QAAQ,CAACC,aAAT,CAAuB,kBAAvB,CAA3E;AACA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB45B,UAAU,KAAK,0BAAL,GAAkC,kCAAlE;AACA,SAAKE,SAAL,GACC,qGADD;AAEA,SAAK94B,WAAL,GAAmB,IAAnB;AACA,SAAKkE,qBAAL,GAA6B,KAAK60B,uBAAL,GAC1B;AAAE,sBAAgB;AAAlB,KAD0B,GAE1B,EAFH;AAIA,SAAKp1B,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,oBAAnC;AACA,SAAKvG,kBAAL,GAA0Bg1B,eAAe,GACrC,GAAEzuB,QAAS,gDAD0B,GAEtCnG,aAFH;AAIA,SAAKA,aAAL,GAAqBA,aAArB;AACA,SAAKD,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA,SAAKuN,uBAAL,GAA+B,yBAA/B;AACA,SAAKC,oBAAL,GAA4B,cAA5B;AAEA,SAAKuT,cAAL,GAAsB,6CAAtB;AACA,SAAKnZ,qBAAL,GAA6B,+BAA7B;AAEA,SAAK+sB,sBAAL,GAA8B,sBAA9B;AACA,SAAKC,kBAAL,GAA0B,kBAA1B;AACA,SAAKt0B,4BAAL,GAAoC,IAApC;AAEA,SAAKu0B,YAAL,GAAoB,wBAApB;AACA,SAAKC,cAAL,GAAsB,iCAAtB;AAEAjtB,qDAAY,CAACC,UAAb,CAAwB;AAAEE,aAAO,EAAE;AAAX,KAAxB;AACA;;AAED7O,gBAAc,GAAG;AAChB,UAAM4J,MAAM,GAAGnL,QAAQ,CAACC,aAAT,CAAuB,KAAK+8B,kBAA5B,CAAf;AACA,UAAMlN,UAAU,GAAG9vB,QAAQ,CAACC,aAAT,CAAuB,KAAK88B,sBAA5B,CAAnB;AACA,UAAMtoB,SAAS,GAAGzU,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAAlB;AACA,UAAMsN,OAAO,GAAGoE,SAAS,IAAI,KAAKtQ,UAAL,EAA7B;AACA,UAAMoN,SAAS,GAAGue,UAAU,IAAI9vB,QAAQ,CAACC,aAAT,CAAuB,KAAKi9B,cAA5B,CAAhC;AACA,WAAO,CAAC/xB,MAAM,IAAIoG,SAAX,KAAyBlB,OAAhC;AACA;;AAEDrP,kBAAgB,GAAG;AAClB,WAAO,CAAC,KAAKgI,aAAL,KAAuB/K,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAvB,GAA+C,KAAKiL,WAAL,EAAhD,EAAoE5G,IAApE,CAAyE8G,YAAY,IAAI;AAC/F,WAAKjF,YAAL,GAAoBiF,YAApB;AACA,aAAO,CACN,GAAG,IAAI7D,GAAJ,CACF,CAAC,GAAG7C,cAAc,CAAC,KAAKgT,uBAAN,EAA+BtM,YAA/B,EAA6C,IAA7C,CAAlB,EACEhE,GADF,CACM2S,IAAI,IAAIA,IAAI,CAACrS,SAAL,CAAenF,KAAf,CAAqB,KAAKoV,oBAA1B,CADd,EAEEnJ,MAFF,CAESE,OAFT,EAGEtH,GAHF,CAGMZ,IAAI,IAAIA,IAAI,CAAC,CAAD,CAHlB,CADE,CADG,CAAP;AAQA,KAVM,CAAP;AAWA;;AAEDxD,kBAAgB,GAAG;AAClB,WAAO,CAAC,KAAKmD,YAAL,GAAoBnG,OAAO,CAACC,OAAR,CAAgB,KAAKkG,YAArB,CAApB,GAAyD,KAAK+E,WAAL,EAA1D,EAA8E5G,IAA9E,CAAmFyW,GAAG,IAAI;AAChG,YAAM9X,KAAK,GAAG,CAAC,GAAG,IAAIsE,GAAJ,CAAQ,CAAC,GAAGwT,GAAG,CAACmkB,QAAJ,CAAa,KAAKF,YAAlB,CAAJ,EAAqC53B,GAArC,CAAyCZ,IAAI,IAAIA,IAAI,CAAC,CAAD,CAArD,CAAR,CAAJ,CAAd;AACA,aAAO;AACNvD,aADM;AAENC,iBAAS,EAAED,KAAK,CAACoG;AAFX,OAAP;AAIA,KANM,CAAP;AAOA;;AAEDpC,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDrD,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,aAAOzE,WAAW,CAACE,cAAc,CAAC,KAAKk6B,SAAN,EAAiB31B,QAAjB,CAAf,CAAlB;AACA,KAFM,CAAP;AAGA;;AAED8B,eAAa,GAAG;AACf,WAAO2zB,UAAU,EAAjB;AACA;;AAED7yB,cAAY,CAACxH,MAAD,EAASsH,UAAT,EAAqB3C,OAArB,EAA8B4C,WAA9B,EAA2CE,QAA3C,EAAqD;AAChE,UAAMC,eAAe,GACpBH,WAAW,IAAIA,WAAW,CAACI,QAAZ,EAAf,GAAyC,GAAEL,UAAW,IAAGC,WAAW,CAACI,QAAZ,EAAuB,EAAhF,GAAoFL,UADrF;AAEA,WAAOwI,sDAAO,CAACpI,eAAD,EAAkB;AAC/B1H,YAD+B;AAE/B0E,iBAAW,EAAE,SAFkB;AAG/BC,aAH+B;AAI/BH,UAAI,EAAEiD;AAJyB,KAAlB,CAAP,CAKJxH,IALI,CAKC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EALb,CAAP;AAMA;;AA/FuD,CAAzD;AAkGe;AACduD,MAAI,EAAE,UADQ;AAEd5M,QAAM,EAAE,cAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdulB,YAAU,EAAE,EAJE;AAKd9nB,QALc;AAMdyC,iBAAe,EAAE8uB,eAAe,GAAI,GAAEzuB,QAAS,mBAAf,GAAoCnG,aANtD;AAOd6F,iBAAe,EAAE;AAPH,CAAf,E;;;;;;;;;;;;ACpIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAEA,MAAM;AAAElL;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAEH,aAAF;AAAe5F;AAAf,IAA2BC,6CAAjC;AAEA;;;;;;;;;;;AAWA,MAAMqR,QAAQ,GAAG,6BAAjB;AACA,MAAMyL,QAAQ,GAAI,GAAEzL,QAAS,QAA7B;AACA,MAAMivB,mBAAmB,GAAG,gBAA5B;AACA,MAAMC,sBAAsB,GAAG,mCAA/B;AAEA,MAAMhyB,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,gCAAtB;AACA,SAAKuI,mBAAL,GAA2B,kBAA3B;AAEA,SAAKtD,aAAL,GAAqB4R,QAArB;AAEA,SAAK0jB,cAAL,GAAsB,oCAAtB;AACA,SAAKz1B,sBAAL,GAA8B,yBAA9B;AACA,SAAKqG,kBAAL,GAA0B,oBAA1B;AACA,SAAK+G,mBAAL,GAA2B,uCAA3B;AAEA,UAAMjK,gBAAgB,GAAI,GAAEmD,QAAS,4CAArC;AACA,SAAKzG,cAAL,GAAuB,GAAEsD,gBAAiB,iBAA1C;AACA,SAAKrD,eAAL,GAAwB,GAAEqD,gBAAiB,4BAA3C;AAEA,SAAKqJ,kBAAL,GAA0B,0BAA1B;AACA,SAAKkpB,qBAAL,GAA6B,gBAA7B;AACA,SAAKj6B,sBAAL,GAA8B,WAA9B;AAEA,SAAK+Z,kBAAL,GAA0B,YAA1B;AACA,SAAKC,uBAAL,GAA+B,KAAKtU,aAAL,KAAuB,gBAAvB,GAA0C,sBAAzE;AACA,SAAK8jB,gCAAL,GAAwC,0BAAxC;AAEA7c,qDAAY,CAACC,UAAb;AACA;;AAED3O,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAM4yB,YAAY,GAAG3yB,IAAI,CAACC,UAAL,CAAgB8O,QAAhB,KAA6B/O,IAAI,CAACO,QAAL,CAAc,gBAAd,CAAlD;AACA,UAAMgB,WAAW,GAAG,CAAC,GAAGpM,QAAQ,CAACyF,gBAAT,CAA0B43B,sBAA1B,CAAJ,EAAuD7sB,IAAvD,CAA4D6E,IAAI,IACnF+nB,mBAAmB,CAAClU,IAApB,CAAyB7T,IAAI,CAAChV,WAA9B,CADmB,CAApB;AAGA,UAAMmT,WAAW,GAAG,CAACxT,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,KAAoD,EAArD,EAAyDgB,YAA7E;AAEA,WAAO,CAACF,WAAD,IAAgBoxB,YAAhB,IAAgChqB,WAAvC;AACA;;AAED/S,iBAAe,GAAG;AACjB,SAAK8d,UAAL,GAAkBve,QAAQ,CAACC,aAAT,CAAuB,KAAKgV,mBAA5B,EAAiD9U,KAAnE;AAEA,SAAKmI,iBAAL,GAAyB,IAAID,eAAJ,EAAzB;AACA,SAAKD,gBAAL,GAAwB,IAAIC,eAAJ,CAAoB;AAC3Co1B,mBAAa,EAAE;AAD4B,KAApB,CAAxB;AAIA,SAAKr5B,YAAL,GAAoB,IAApB;AACA,WAAOnG,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED8C,kBAAgB,GAAG;AAClB,WAAO,KAAK08B,eAAL,CAAqB9jB,QAArB,EAA+BrX,IAA/B,CAAoC2E,QAAQ,IAClD,CAAC,GAAGvE,cAAc,CAAC,KAAK26B,cAAN,EAAsBp2B,QAAtB,EAAgC,IAAhC,CAAlB,EAAyD7B,GAAzD,CAA6DqH,EAAE,IAAIA,EAAE,CAACrM,WAAtE,EAAmFoM,MAAnF,CAA0FE,OAA1F,CADM,CAAP;AAGA;;AAED1L,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,KAAK+Q,iBAAL,EAAd;;AACA,WAAO;AACN/Q,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAED2K,mBAAiB,CAACvN,IAAD,EAAO;AACvB,WAAO,CAAC,GAAG/B,cAAc,CAAC,KAAKkF,sBAAN,EAA8BnD,IAA9B,EAAoC,IAApC,CAAlB,EACL+H,MADK,CACEE,OADF,EAELtH,GAFK,CAEDoK,WAAW,IAAIA,WAAW,CAAC9J,SAAZ,CAAsBnF,KAAtB,CAA4B,KAAK0N,kBAAjC,EAAqD,CAArD,CAFd,CAAP;AAGA;;AAEDnN,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAOjD,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKS,UAAL,CAAgBT,IAAhB,EAAsB,KAAKk5B,YAAL,CAAkBl5B,IAAlB,CAAtB,EAA+ClC,IAA/C,CAAoD2E,QAAQ,IAAI;AAC/D,WAAK9C,YAAL,GAAoB8C,QAApB;AACA,aAAOjJ,+CAAO,CAACC,OAAR,EAAP;AACA,KAHD,CADM,CAAP;AAMA;;AAED0C,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,CAAgB,KAAKC,YAArB,CAAxB,EAA4D;AACrEzF,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AAEA,UAAMK,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAAI;AAClC,aAAO,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0B6Z,YAAY,IAAI;AAChD,cAAMzX,MAAM,GAAG;AACdF,cADc;AAEdG,oBAAU,EAAEV,aAFE;AAGdW,uBAAa,EAAE,CAHD;AAIdE,iBAAO,EAAE;AAJK,SAAf;;AAMA,YAAIqX,YAAY,CAACwhB,KAAb,KAAuB,IAA3B,EAAiC;AAChCj5B,gBAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,iBAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AACD,aAAKP,YAAL,GAAoBgY,YAApB;AACAzX,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgBiY,YAAhB,CAApB;AACAzX,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;;AACA,YAAID,MAAM,CAACC,UAAP,GAAoBV,aAAxB,EAAuC;AACtCK,0BAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AACD,eAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsB,KAAKk5B,YAAL,CAAkBl5B,IAAlB,CAAtB,EAA+ClC,IAA/C,CAAoDs7B,kBAAkB,IAAI;AAChF,eAAKz5B,YAAL,GAAoBy5B,kBAApB;AACA,iBAAOrgC,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA,SAHM,CAAP;AAIA,OArBM,CAAP;AAsBA,KAvBM,EAuBJpC,IAvBI,CAuBC,MACP/E,4CAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,WAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,eAAS,EAAEhB,gBAFa;AAGxBL;AAHwB,KAAzB,CAxBM,CAAP;AA8BA;;AAEDpD,YAAU,CAACgF,cAAD,EAAiB;AAC1B,UAAM;AAAEP,eAAF;AAAarB;AAAb,QAA+B4B,cAArC;AACAP,aAAS,CAACQ,IAAV,CAAe,CAACC,CAAD,EAAIC,CAAJ,KAAUA,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAA7C;AAEA,QAAIqB,YAAY,GAAGhC,aAAnB;AACA,QAAIiC,eAAe,GAAG,CAAtB;AACA,UAAME,eAAe,GAAG,EAAxB;AAEA,WAAOpI,+CAAO,CAACuG,IAAR,CAAae,SAAb,EAAwBD,QAAQ,IAAI;AAC1C,aAAO,KAAKtB,SAAL,CAAesB,QAAQ,CAACb,IAAxB,EAA8BlC,IAA9B,CAAmC6Z,YAAY,IAAI;AACzD,aAAKhY,YAAL,GAAoBgY,YAApB;AACA,cAAMxX,UAAU,GAAG,KAAKT,UAAL,CAAgBiY,YAAhB,CAAnB;AACA,cAAMvX,aAAa,GAAGX,aAAa,GAAGU,UAAtC;AAEApH,oDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBgH,cAAI,EAAEa,QAAQ,CAACb,IADU;AAEzBG,oBAFyB;AAGzBC;AAHyB,SAA1B;;AAMA,YAAID,UAAU,GAAGsB,YAAjB,EAA+B;AAC9BG,yBAAe,CAACpB,IAAhB,CAAqBK,QAAQ,CAACb,IAA9B;AACA0B,yBAAe,GAAGtB,aAAlB;AACAqB,sBAAY,GAAGtB,UAAf;AACA,iBAAO3G,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED,eAAO,KAAKgH,UAAL,CAAgBI,QAAQ,CAACb,IAAzB,EAA+B,KAAKk5B,YAAL,CAAkBr4B,QAAQ,CAACb,IAA3B,CAA/B,EAAiElC,IAAjE,CAAsEm6B,kBAAkB,IAAI;AAClG,eAAKt4B,YAAL,GAAoBs4B,kBAApB;;AACA,gBAAM/C,YAAY,GAAG,KAAK+D,eAAL,CAAqB/yB,MAAM,CAACC,QAAP,CAAgBC,IAArC,EAA2CtI,IAA3C,CAAgD2E,QAAQ,IAC5E,KAAK+K,iBAAL,CAAuB/K,QAAvB,CADoB,CAArB;;AAIA,gBAAM42B,YAAY,GACjBnE,YAAY,CAACryB,MAAb,KAAwBjB,eAAe,CAACiB,MAAxC,IACAqyB,YAAY,CAACoE,KAAb,CAAmBt5B,IAAI,IAAI4B,eAAe,CAAC+E,QAAhB,CAAyB3G,IAAzB,CAA3B,CAFD;;AAIA,cAAIq5B,YAAJ,EAAkB;AACjB,mBAAO7/B,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED,iBAAOD,+CAAO,CAACuG,IAAR,CAAam1B,YAAb,EAA2Bl1B,IAAI,IAAI,KAAKS,UAAL,CAAgBT,IAAhB,EAAsB,KAAKk5B,YAAL,CAAkBl5B,IAAlB,CAAtB,CAAnC,EAAmFlC,IAAnF,CACNy7B,cAAc,IAAI;AACjB,iBAAK55B,YAAL,GAAoB45B,cAApB;AACA,mBAAO//B,+CAAO,CAACuG,IAAR,CAAa6B,eAAb,EAA8B5B,IAAI,IAAI,KAAKT,SAAL,CAAeS,IAAf,CAAtC,CAAP;AACA,WAJK,CAAP;AAMA,SApBM,CAAP;AAqBA,OAvCM,CAAP;AAwCA,KAzCM,EAyCJlC,IAzCI,CAyCC,MACP/E,4CAAG,CAACC,KAAJ,CAAU,oBAAV,EAAgC;AAC/ByD,WAAK,EAAEmF,eADwB;AAE/BzB,gBAAU,EAAEsB,YAFmB;AAG/BrB,mBAAa,EAAEsB;AAHgB,KAAhC,CA1CM,CAAP;AAgDA;;AAED/E,wBAAsB,GAAG;AACxB;AACA,WAAO,KAAKs8B,eAAL,CAAqB/yB,MAAM,CAACC,QAAP,CAAgBC,IAArC,EAA2CtI,IAA3C,CAAgD8G,YAAY,IAAI;AACtE,YAAMqgB,QAAQ,GAAGjnB,WAAW,CAACE,cAAc,CAAC,KAAK0a,kBAAN,EAA0BhU,YAA1B,CAAf,CAA5B;AACA,YAAM0K,YAAY,GAAGpR,cAAc,CAAC,KAAK2a,uBAAN,EAA+BjU,YAA/B,CAAnC;AACA,YAAM0gB,aAAa,GAAGhW,YAAY,GAAGtR,WAAW,CAACsR,YAAD,CAAd,GAA+B,CAAjE;AACA,YAAMD,oBAAoB,GAAGnR,cAAc,CAAC,KAAKmqB,gCAAN,EAAwCzjB,YAAxC,CAA3C;AACA,YAAMyD,gBAAgB,GAAGgH,oBAAoB,GAAGrR,WAAW,CAACqR,oBAAD,CAAd,GAAuC,CAApF;AACA,YAAMoW,UAAU,GAAGznB,WAAW,CAACE,cAAc,CAAC,KAAKI,cAAN,EAAsBsG,YAAtB,CAAf,CAA9B;AACA,aAAO6gB,UAAU,GAAGR,QAAb,GAAwBK,aAAxB,GAAwCjd,gBAA/C;AACA,KARM,CAAP;AASA;;AAED9I,WAAS,CAACS,IAAD,EAAO;AACf,SAAK2D,gBAAL,CAAsBhB,GAAtB,CAA0B,YAA1B,EAAwC3C,IAAxC;AACA,SAAK2D,gBAAL,CAAsBhB,GAAtB,CAA0B,YAA1B,EAAwC,KAAKmX,UAA7C;AACA,WAAO,KAAK7X,UAAL,CAAgB,KAAKgB,cAArB,EAAqC,KAAKU,gBAA1C,CAAP;AACA;;AAEDlD,YAAU,CAACT,IAAD,EAAO4C,eAAP,EAAwB;AACjC,SAAKiB,iBAAL,CAAuBlB,GAAvB,CAA2B,MAA3B,EAAmC3C,IAAnC;AACA,SAAK6D,iBAAL,CAAuBlB,GAAvB,CAA2B,MAA3B,EAAmCC,eAAnC;AACA,WAAO,KAAKX,UAAL,CAAgB,KAAKiB,eAArB,EAAsC,KAAKW,iBAA3C,CAAP;AACA;;AAED5B,YAAU,CAACkS,GAAD,EAAM/O,WAAN,EAAmB;AAC5B,WAAOjD,KAAK,CAAE,GAAEgS,GAAI,IAAG/O,WAAW,CAACI,QAAZ,EAAuB,EAAlC,EAAqC;AAChD3H,YAAM,EAAE,KADwC;AAEhD0E,iBAAW,EAAE;AAFmC,KAArC,CAAL,CAGJzE,IAHI,CAGC2E,QAAQ,IAAIA,QAAQ,CAACkD,IAAT,EAHb,CAAP;AAIA;;AAEDuzB,cAAY,CAACl5B,IAAD,EAAO;AAClB,QAAIw5B,eAAe,GAAG,IAAtB;;AAEA,QAAI,KAAK75B,YAAT,EAAuB;AACtB,UAAI,CAAC,KAAKA,YAAL,CAAkBuY,MAAvB,EAA+B;AAC9Bhf,sEAAiB,CAAC,IAAIuC,KAAJ,CAAU,wBAAV,EAAoC;AAAEuE,cAAF;AAAQyC,kBAAQ,EAAE,KAAK9C;AAAvB,SAApC,CAAD,CAAjB;AACA,eAAO65B,eAAP;AACA;;AACDA,qBAAe,GAAGt7B,cAAc,CAC/B,KAAK0R,kBAD0B,EAE/B,KAAKjQ,YAAL,CAAkBuY,MAAlB,CAAyBuhB,aAFM,CAAd,CAGhB99B,YAHgB,CAGH,KAAKkD,sBAHF,CAAlB;AAIA,KATD,MASO;AACN,YAAMgD,aAAa,GAAG,CAAC,GAAGtG,QAAQ,CAACyF,gBAAT,CAA0B,KAAK4O,kBAA/B,CAAJ,CAAtB;AACA,YAAM9N,oBAAoB,GAAGD,aAAa,CAACE,IAAd,CAAmBd,OAAO,IAAI;AAC1D,cAAMe,YAAY,GAAGf,OAAO,CAACzF,aAAR,CAAsB,KAAK4H,sBAA3B,CAArB;AACA,eAAOpB,YAAY,IAAIA,YAAY,CAACd,SAAb,CAAuBnF,KAAvB,CAA6B,KAAK0N,kBAAlC,EAAsD,CAAtD,MAA6DzJ,IAApF;AACA,OAH4B,CAA7B;;AAIA,UAAI8B,oBAAJ,EAA0B;AACzB03B,uBAAe,GAAG13B,oBAAoB,CACpCtG,aADgB,CACF,KAAKs9B,qBADH,EAEhBn9B,YAFgB,CAEH,KAAKkD,sBAFF,CAAlB;AAGA;AACD;;AACD,WAAO26B,eAAP;AACA;;AAEDP,iBAAe,CAAC9kB,GAAD,EAAM;AACpB,WAAOhS,KAAK,CAACgS,GAAD,EAAM;AACjBtW,YAAM,EAAE,KADS;AAEjB0E,iBAAW,EAAE;AAFI,KAAN,CAAL,CAGJzE,IAHI,CAGC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAHb,CAAP;AAIA;;AAEDhD,YAAU,CAACiG,IAAD,EAAO;AAChB,WAAOA,IAAI,IAAIA,IAAI,CAACuS,MAAb,GACJ9f,OAAO,CAACuN,IAAI,CAACuS,MAAL,CAAYwhB,UAAb,CADH,GAEJ17B,WAAW,CAACzC,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAAD,CAFd;AAGA;;AApPuD,CAAzD;AAuPe;AACd2H,MAAI,EAAE,cADQ;AAEd5M,QAAM,EAAE,iBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdxC;AALc,CAAf,E;;;;;;;;;;;;ACjRA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAE5I;AAAF,IAAkB3F,6CAAxB;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA,MAAMyW,aAAa,GAAG,4BAAtB;AACA,MAAMrR,aAAa,GAAI,GAAEqR,aAAc,OAAvC;AACA,MAAM;AAAExO;AAAF,IAAWF,MAAM,CAACC,QAAxB;AAEA;;;;;;;;;;;;;;;;AAgBA,MAAMS,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKwI,mBAAL,GAA2B,wBAA3B;AACA,SAAKzD,sBAAL,GAA8B,mBAA9B;AACA,SAAKmI,qBAAL,GAA6B,aAA7B;AACA,SAAKjN,cAAL,GAAsB,yDAAtB;AAEA,SAAKq7B,qBAAL,GAA6B,4BAA7B;AACA,SAAKC,oBAAL,GAA4B,gBAA5B;AAEA,SAAKC,uBAAL,GAA+B,6CAA/B;AACA,SAAKn7B,kBAAL,GAA0B,kBAA1B;AAEA,SAAKY,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAI,GAAEkL,aAAc,mDAAlC;AACA,SAAK3R,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,6BAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKD,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA,SAAKlF,mBAAL,GAA2B,mBAA3B;AAEA,SAAKuI,YAAL,GAAoB,2CAApB;AACA,SAAKF,iBAAL,GAAyB,0CAAzB;AACA;;AAEDvK,kBAAgB,GAAG;AAClB,UAAMyD,IAAI,GAAGzE,QAAQ,CAACC,aAAT,CAAuB,KAAKq+B,uBAA5B,CAAb;AACA,WAAO,CAAC75B,IAAI,GAAG,CAAC,GAAGA,IAAI,CAACpE,WAAL,CAAiBoR,KAAjB,CAAuB,GAAvB,CAAJ,CAAH,GAAsC,CAAC,IAAD,CAA3C,EAAmDhF,MAAnD,CAA0DE,OAA1D,EAAmEtH,GAAnE,CAAuEqH,EAAE,IAAIA,EAAE,CAAC9G,IAAH,EAA7E,CAAP;AACA;;AAEDxE,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0F,QAAQ,GAAGnK,WAAW,CAAC,KAAK87B,YAAL,CAAkB,UAAlB,EAA8Br3B,QAA9B,CAAD,CAAX,IAAwD,CAAzE;;AACA,YAAM0M,KAAK,GAAG,KAAK2qB,YAAL,CAAkB,KAAlB,EAAyBr3B,QAAzB,CAAd;;AACA,YAAM6F,GAAG,GAAG6G,KAAK,GAAGnR,WAAW,CAACmR,KAAD,CAAX,IAAsB,CAAzB,GAA6B,CAA9C;AACA,aAAO,KAAKzP,UAAL,CAAgB+C,QAAhB,IAA4B0F,QAA5B,GAAuCG,GAA9C;AACA,KALM,CAAP;AAMA;;AAEDwxB,cAAY,CAACC,YAAD,EAAet3B,QAAf,EAAyB;AACpC,UAAM0pB,QAAQ,GAAG,CAAC,GAAGjuB,cAAc,CAAC,KAAKy7B,qBAAN,EAA6Bl3B,QAA7B,EAAuC,IAAvC,CAAlB,EAAgEV,IAAhE,CAChBkG,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAe+K,QAAf,CAAwBozB,YAAxB,KAAyC,CAAC9xB,EAAE,CAACrM,WAAH,CAAe+K,QAAf,CAAwB,OAAxB,CADhC,CAAjB;AAIA,WAAOwlB,QAAQ,GAAGA,QAAQ,CAAC3wB,aAAT,CAAuB,KAAKo+B,oBAA5B,CAAH,GAAuD,IAAtE;AACA;;AAEDn5B,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDuE,eAAa,GAAG;AACf,WAAO2B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,KAAK9C,aAArC,KAAuDhI,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAA9D;AACA;;AA7DuD,CAAzD;AAgEe;AACdZ,MAAI,EAAE,WADQ;AAEd5M,QAAM,EAAE,oBAFM;AAGdwR,kBAAgB,EAAEC,wDAAiB,CAACC,OAHtB;AAId5B,WAAS,EAAE,IAJG;AAKdvC,QALc;;AAMduD,aAAW,GAAG;AACb,WACC,CAAC/D,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KAAkC6C,IAAI,CAACO,QAAL,CAAc,qBAAd,CAAnC,KACApL,QAAQ,CAACC,aAAT,CAAuB,wBAAvB,CAFD;AAIA,GAXa;;AAYdmM,aAAW,GAAG;AACb,WAAO,CAACpM,QAAQ,CAACC,aAAT,CAAuB,YAAvB,KAAwC,EAAzC,EAA6CqM,YAApD;AACA;;AAda,CAAf,E;;;;;;;;;;;;AC1FA;AAAA;AAAA;AAAA;AACA;AAEA;;;;;;;;;;;;;;;AAgBA;;AACA,MAAM+M,aAAa,GAAG1O,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqB4G,KAArB,CAA2B,mBAA3B,EAAgD,CAAhD,CAAtB;AACA,MAAMzJ,aAAa,GAAI,GAAEqR,aAAc,mBAAvC;AAEA,MAAMhO,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,qBAAtB;AACA,SAAK07B,iBAAL,GAAyB,aAAzB;AACA,SAAK52B,sBAAL,GAA8B,wBAA9B;AACA,SAAK9D,WAAL,GAAmB,KAAnB;AAEA,UAAMoK,QAAQ,GAAGkL,aAAjB;AACA,SAAK3R,cAAL,GAAuB,GAAEyG,QAAS,oBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,uBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,kBAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA;;AAED7G,gBAAc,GAAG;AAChB,UAAM6P,QAAQ,GAAGzG,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC9C,aAAhC,CAAjB;AACA,UAAMqI,OAAO,GAAGrQ,QAAQ,CAACC,aAAT,CAAwB,GAAE,KAAK8C,cAAe,KAAI,KAAK07B,iBAAkB,EAAzE,CAAhB;AACA,WAAOrtB,QAAQ,IAAIf,OAAnB;AACA;;AAED5P,iBAAe,GAAG;AACjB,UAAMkQ,KAAK,GAAG3Q,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAAd;AACA,SAAKA,cAAL,GAAsB4N,KAAK,GAAG,KAAK5N,cAAR,GAAyB,KAAK07B,iBAAzD;AACA;;AAEDx9B,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EACZxC,GADY,CACR2S,IAAI,IAAIA,IAAI,CAACtE,OAAL,IAAgBsE,IAAI,CAACtE,OAAL,CAAagrB,QAD7B,EAEZjyB,MAFY,CAELE,OAFK,CAAd;AAIA,WAAO;AACNzL,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDlG,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B6Z,YAAY,IAAI;AAClD,YAAM;AAAEuiB,gBAAF;AAAYC,uBAAZ;AAA6B9xB;AAA7B,UAAkDsP,YAAxD;AACA,YAAMrP,GAAG,GAAGlQ,6DAAO,CAAC8hC,QAAD,CAAP,IAAqB,CAAjC;AACA,YAAM/xB,QAAQ,GAAG/P,6DAAO,CAAC+hC,eAAD,CAAP,IAA4B,CAA7C;AACA,YAAMC,YAAY,GAAGhiC,6DAAO,CAACiQ,gBAAD,CAAP,IAA6B,CAAlD;AACA,aAAO,KAAK3I,UAAL,CAAgBiY,YAAhB,IAAgCrP,GAAhC,GAAsCH,QAAtC,GAAiDiyB,YAAxD;AACA,KANM,CAAP;AAOA;;AAED16B,YAAU,CAACoD,IAAD,EAAO;AAChB,QAAIA,IAAJ,EAAU;AACT,aAAO1K,6DAAO,CAAC0K,IAAI,CAACu3B,eAAN,CAAd;AACA;;AACD,WAAOr8B,iEAAW,CAACzC,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAAD,CAAlB;AACA;;AA1DuD,CAAzD;AA6De;AACd2H,MAAI,EAAE,kBADQ;AAEd5M,QAAM,EAAE,qBAFM;AAGduN,QAHc;AAIdwC,iBAAe,EAAE;AAJH,CAAf,E;;;;;;;;;;;;ACpFA;AAAA;AAAA;AAEA;;;;;;;;;;;AAWA,MAAM7F,aAAa,GAAG,kCAAtB;AAEA,MAAMqD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,2BAAtB;AACA,SAAKgB,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,gFAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKD,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA;;AAEDlD,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAnBuD,CAAzD;AAsBe;AACdiG,MAAI,EAAE,uBADQ;AAEd5M,QAAM,EAAE,iBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;;AAKde,aAAW,GAAG;AACb,WAAOpM,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAP;AACA,GAPa;;AAQd2O,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACCA,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KACA6C,IAAI,CAACC,UAAL,CACC,mGADD,CAFD;AAMA;;AAfa,CAAf,E;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAMi0B,KAAK,GAAGp0B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,SAA9B,IAA2C,OAA3C,GAAqD,OAAnE;AACA,MAAMwO,QAAQ,GAAI,yBAAwBmlB,KAAM,OAAhD,C,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAM1zB,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKiB,WAAL,GAAmB,IAAnB;AAEA,SAAKhB,cAAL,GAAsB,2BAAtB;AACA,SAAKC,qBAAL,GAA6B,YAA7B;AAEA,SAAK+7B,KAAL,GAAaA,KAAK,KAAK,OAAV,GAAoB,2BAApB,GAAkD,2BAA/D;AACA,UAAM5wB,QAAQ,GAAI,6CAA4C,KAAK4wB,KAAM,GAAzE;AAEA,SAAKr3B,cAAL,GAAuB,GAAEyG,QAAS,6BAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,wBAAnC;AACA,SAAKvG,kBAAL,GAA0BgS,QAA1B;AACA,SAAK7R,sBAAL,GAA8B,YAA9B;AAEA,SAAKK,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AACA;;AAEDxG,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CE,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjG3F,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACAvF,sDAAG,CAAC,wBAAD,EAA2B0F,kBAA3B,CAAH;AAEA,UAAME,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0BoG,iBAAiB,IAAI;AAC9C,YAAMhE,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE;AAJG,OAAf;;AAOA,YAAM8D,YAAY,GAAG,KAAKC,iBAAL,CAAuBF,iBAAvB,CAArB;;AAEA,UACEC,YAAY,KAAK,IAAjB,IAAyBA,YAAY,KAAK,KAAKH,oCAAhD,IACAE,iBAAiB,CAACq2B,OAAlB,CAA0B5zB,QAA1B,CAAmC,2BAAnC,CAFD,EAGE;AACD;AACAzG,cAAM,CAACI,OAAP,GAAiB,KAAjB,CAFC,CAGD;;AACA,eAAO,KAAKG,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA;;AAED,aAAO,KAAKmE,eAAL,GAAuBvG,IAAvB,CAA4BwG,YAAY,IAAI;AAClDpE,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB4E,YAAhB,CAApB;AACApE,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACAD,cAAM,CAACG,SAAP,GAAmB,KAAKR,eAAL,CAAqByE,YAArB,IAAqC1E,kBAAxD;;AAEA,YACCM,MAAM,CAACC,UAAP,GAAoBV,aAApB,IACA;AACCS,cAAM,CAACC,UAAP,KAAsBV,aAAtB,IAAuCS,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDP,0BAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AAED,eAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,OAdM,CAAP;AAeA,KAnCD,CADM,EAqCLpC,IArCK,CAqCA,MAAM;AACZ,UAAI,KAAKwB,WAAT,EAAsB;AACrBvG,oDAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,eAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,mBAAS,EAAEhB,gBAFa;AAGxBL,uBAHwB;AAIxBG;AAJwB,SAAzB;AAMA;;AACD,aAAOpG,+CAAO,CAACC,OAAR,EAAP;AACA,KA/CM,CAAP;AAgDA;;AAED+C,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKpC,oBAA/B,CAAJ,EAA0DgC,GAA1D,CAA8DqH,EAAE,IAAIA,EAAE,CAACgH,OAAH,CAAWklB,UAA/E,CAAd;AACA,WAAO;AACN13B,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAjFuD,CAAzD;AAoFe;AACdoD,MAAI,EAAE,OADQ;AAEd5M,QAAM,EAAE,WAFM;AAGd8P,WAAS,EAAE,IAHG;AAId0B,kBAAgB,EAAEC,wDAAiB,CAACC,OAJtB;AAKdnE,QALc;;AAMduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACCA,IAAI,CAACO,QAAL,CAAe,OAAf,MACCT,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,SAA9B,KAA4CT,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,SAA9B,CAD7C,CADD;AAIA,GAXa;;AAYdgB,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAD,CAAd;AACA,GAda;;AAedwf,8BAA4B,EAAE;AAfhB,CAAf,E;;;;;;;;;;;;ACpGA;AAAA;AAAA;AAAA;AACA;AAEA,MAAMzX,aAAa,GAAG,0CAAtB;AACA,MAAMi3B,uBAAuB,GAAG,CAAC,UAAD,EAAa,UAAb,CAAhC;AACA,MAAMl8B,cAAc,GAAG,sEAAvB;;AAEA,MAAMgQ,MAAM,GAAG,MAAMpI,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBJ,WAArB,GAAmCK,UAAnC,CAA8C9C,aAA9C,CAArB;;AACA,MAAM0pB,UAAU,GAAG,MAAMuN,uBAAuB,CAACzuB,IAAxB,CAA6BmnB,OAAO,IAAIhtB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBJ,WAArB,GAAmCW,QAAnC,CAA4CusB,OAA5C,CAAxC,CAAzB;AAEA;;;;;;;;;;;;;;;AAcA,MAAMtsB,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsBA,cAAtB;AACA,SAAK8E,sBAAL,GAA8B,gBAA9B;AACA,SAAK9D,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,yEAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,wBAAlC;AACA,SAAKxG,eAAL,GAAuB,0CAAvB;AACA,SAAKC,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAK7E,kBAAL,GAA0B,aAA1B;AACA,SAAK+7B,wBAAL,GAAgC,gBAAhC;AACA,SAAKj8B,uBAAL,GAA+B,SAA/B;AACA,SAAKC,mBAAL,GAA2B,gBAA3B;AAEA,SAAKkF,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,oCAA3B,EAAiE,QAAjE;AACA,SAAKsB,4BAAL,GAAoC,IAApC;AACA;;AAEDzH,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKy5B,wBAA/B,CAAJ,EAA8D75B,GAA9D,CAAkEK,OAAO,IACtFA,OAAO,CAACrF,WAAR,CAAoBuF,IAApB,EADa,CAAd;AAIA,WAAO;AACN1E,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAED5G,kBAAgB,GAAG;AAClB;AACA,WAAO,KAAK4I,eAAL,CAAqBqB,MAAM,CAACC,QAAP,CAAgBC,IAArC,EAA2CtI,IAA3C,CAAgD48B,WAAW,IAAI,KAAKh7B,UAAL,CAAgBg7B,WAAhB,CAA/D,CAAP;AACA;;AAEDj6B,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAzCuD,CAAzD;AA4Ce;AACdiG,MAAI,EAAE,kBADQ;AAEd5M,QAAM,EAAE,oBAFM;AAGd8P,WAAS,EAAE,IAHG;AAId0B,kBAAgB,EAAEC,wDAAiB,CAACC,OAJtB;AAI+B;AAC7CnE,QALc;;AAMde,aAAW,GAAG;AACb,WAAO,CAAC,CAACpM,QAAQ,CAACC,aAAT,CAAuB,YAAvB,CAAT;AACA,GARa;;AASd2O,aAAW,GAAG;AACb,WAAO,CAACmE,MAAM,MAAM2e,UAAU,EAAvB,KAA8B,CAAC,GAAG1xB,QAAQ,CAACyF,gBAAT,CAA0B1C,cAA1B,CAAJ,EAA+CyN,IAA/C,CAAoD9D,EAAE,IAAIA,EAAE,CAACJ,YAA7D,CAArC;AACA;;AAXa,CAAf,E;;;;;;;;;;;;ACpEA;AAAA;AAAA;AAAA;CAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAM6B,QAAQ,GAAG,+BAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMwM,YAAY,GAAI,GAAExM,QAAS,WAAjC;AACA,MAAMnD,gBAAgB,GAAI,GAAEmD,QAAS,+CAArC;AACA,MAAMqmB,YAAY,GAAI,GAAExpB,gBAAiB,mBAAzC;AACA,MAAMo0B,iBAAiB,GAAI,GAAEp0B,gBAAiB,qBAA9C;;AACA,MAAMgJ,YAAY,GAAG,MACpB,CAACrJ,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC9C,aAAhC,KAAkD2C,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgCs0B,iBAAhC,CAAnD,KACAp/B,QAAQ,CAACC,aAAT,CAAuB,wBAAvB,CAFD;;AAIA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKiB,WAAL,GAAmB,IAAnB;AACA,SAAKuH,mBAAL,GAA2B,2BAA3B;AACA,SAAK0E,qBAAL,GAA6B,aAA7B;AAEA,SAAKtI,cAAL,GAAuB,GAAEsD,gBAAiB,qBAA1C;AACA,SAAKrD,eAAL,GAAwB,GAAEqD,gBAAiB,6BAA3C;AACA,SAAKpD,kBAAL,GAA2B,GAAEoD,gBAAiB,0BAA9C;AAEA,SAAKhD,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA,SAAKgH,wBAAL,GAAgC,kCAAhC;AACA,SAAKuG,uBAAL,GAA+B,SAA/B;AAEA,SAAK5S,cAAL,GAAsB/C,QAAQ,CAACC,aAAT,CAAuB,YAAvB,IACnB,oBADmB,GAEnB,4BAFH;AAGA;;AAEDe,kBAAgB,GAAG;AAClB,WAAO,CACN,GAAG,IAAIwE,GAAJ,CACF,CAAC,GAAGxF,QAAQ,CAACyF,gBAAT,CAA0B,KAAKkQ,uBAA/B,CAAJ,EACEtQ,GADF,CACMoK,WAAW,IAAIA,WAAW,CAACpP,WAAZ,CAAwBuF,IAAxB,EADrB,EAEE6G,MAFF,CAESC,EAAE,IAAI,CAAC,CAACA,EAAF,IAAQA,EAAE,CAAClM,KAAH,CAAS,SAAT,CAFvB,CADE,CADG,CAAP;AAOA;;AAED0E,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDuE,eAAa,GAAG;AACf,WAAOgL,YAAY,EAAnB;AACA;;AAzCuD,CAAzD;AA4Ce;AACdtJ,MAAI,EAAE,OADQ;AAEd5M,QAAM,EAAE,mBAFM;AAGd8P,WAAS,EAAE,IAHG;AAId0B,kBAAgB,EAAEC,wDAAiB,CAACC,OAJtB;AAKdnE,QALc;;AAMduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACC,CAACA,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KACA6C,IAAI,CAACC,UAAL,CAAgB6P,YAAhB,CADA,IAEA9P,IAAI,CAACC,UAAL,CAAgB0pB,YAAhB,CAFA,IAGA3pB,IAAI,CAACC,UAAL,CAAgBs0B,iBAAhB,CAHD,KAIAp/B,QAAQ,CAACC,aAAT,CAAuB,mDAAvB,CALD;AAOA,GAda;;AAedmM,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,kBAAvB,CAAD,CAAd;AACA;;AAjBa,CAAf,E;;;;;;;;;;;;ACnEA;AAAA;AAAA;AAEA;;;;;;;AAOA,MAAMkO,QAAQ,GAAG,+EAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,YAAlC;AAEA,MAAM9C,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,+BAAtB;AACA,SAAK8E,sBAAL,GAA8B,6CAA9B;AACA,SAAKH,cAAL,GAAuB,GAAEyG,QAAS,eAAlC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,YAAtC;AACA,SAAKxG,eAAL,GAAuB,KAAKD,cAA5B;AACA,SAAKM,aAAL,GAAqBA,aAArB;AACA,SAAKjE,WAAL,GAAmB,KAAnB;AAEA,SAAKgE,sBAAL,GAA8B,oCAA9B;AACA,SAAKD,qBAAL,GAA6B,uBAA7B;AACA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,sBAA1B,EAAkD,OAAlD;AACA,SAAKgB,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA;;AAEDnG,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EAA4DxC,GAA5D,CAAgEoK,WAAW,IACxFA,WAAW,CAACtP,KAAZ,CAAkBmb,OAAlB,CAA0B,QAA1B,EAAoC,EAApC,EAAwC1V,IAAxC,EADa,CAAd;AAGA,WAAO;AACN1E,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDpC,YAAU,CAACT,IAAD,EAAO;AAChB,SAAK6D,iBAAL,CAAuBlB,GAAvB,CAA2B,KAAKW,sBAAhC,EAAyD,UAAStD,IAAK,EAAvE;AACA,WAAO,KAAK6E,eAAL,CAAqB,KAAK3B,eAA1B,EAA2C,KAAKO,sBAAhD,EAAwE,KAAKI,iBAA7E,CAAP;AACA;;AA9BuD,CAAzD;AAiCe;AACdoC,MAAI,EAAE,gBADQ;AAEd5M,QAAM,EAAE,oBAFM;AAGduN,QAHc;;AAIduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACEA,IAAI,CAACC,UAAL,CAAgBqD,QAAhB,KAA6BtD,IAAI,CAACO,QAAL,CAAc,kBAAd,CAA9B,IACAP,IAAI,CAACO,QAAL,CAAc,kBAAd,CADA,IAEAP,IAAI,CAACO,QAAL,CAAc,iCAAd,CAFA,IAGAP,IAAI,CAACO,QAAL,CAAc,WAAd,CAJD;AAMA,GAXa;;AAYdgB,aAAW,GAAG;AACb,UAAMizB,aAAa,GAAGr/B,QAAQ,CAACC,aAAT,CAAuB,iBAAvB,CAAtB;AACA,WAAOo/B,aAAa,GAAGA,aAAa,CAAC15B,SAAd,CAAwByF,QAAxB,CAAiC,UAAjC,CAAH,GAAkD,KAAtE;AACA;;AAfa,CAAf,E;;;;;;;;;;;;AC7CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;AAWA,MAAM+C,QAAQ,GAAG,4BAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMmxB,oBAAoB,GAAI,GAAEnxB,QAAS,mBAAzC;AACA,MAAMoxB,yBAAyB,GAAI,GAAEpxB,QAAS,wBAA9C;AACA,MAAMnD,gBAAgB,GAAG,uEAAzB;AAEA,MAAMw0B,OAAO,GAAG70B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,OAA9B,CAAhB;AAEA,MAAMC,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,sFAAtB;AACA,SAAKuR,mBAAL,GAA2B,aAA3B;AACA,SAAKvQ,WAAL,GAAmB,IAAnB;AACA,SAAKf,qBAAL,GAA6B,qBAA7B;AACA,SAAK0E,cAAL,GAAuB,GAAEsD,gBAAiB,qBAA1C;AACA,SAAKpD,kBAAL,GAA0BI,aAA1B;AACA,SAAKA,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA,SAAK4H,qBAAL,GAA6B,aAA7B;AACA,SAAK1E,mBAAL,GAA2B,2BAA3B;AACA,SAAK4G,sBAAL,GAA8B,2BAA9B;AACA;;AAED3Q,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAM8L,YAAY,GACjB7L,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KACA6C,IAAI,CAACC,UAAL,CAAgBw0B,oBAAhB,CADA,IAEAz0B,IAAI,CAACC,UAAL,CAAgBy0B,yBAAhB,CAHD;AAKA,UAAMnzB,WAAW,GAAGpM,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAApB;AACA,UAAMjE,OAAO,GAAGrQ,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAAhB;AACA,WAAO2T,YAAY,IAAI,CAACtK,WAAjB,IAAgCiE,OAAvC;AACA;;AAEDrP,kBAAgB,GAAG;AAClB,WAAO,KAAKmI,WAAL,GAAmB5G,IAAnB,CAAwBk9B,OAAO,IAAI;AACzC,aAAO98B,iEAAc,CAAC,KAAKuP,sBAAN,EAA8ButB,OAA9B,CAAd,GACJ,CAAC98B,iEAAc,CAAC,KAAKuP,sBAAN,EAA8ButB,OAA9B,CAAd,CAAqDp/B,WAAtD,CADI,GAEJ,EAFH;AAGA,KAJM,CAAP;AAKA;;AAED6E,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAED7D,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CE,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjG3F,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACAvF,sDAAG,CAAC,wBAAD,EAA2B0F,kBAA3B,CAAH;AAEA,UAAME,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0B2E,QAAQ,IAAI;AACrC,YAAMvC,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdE,eAAO,EAAE,IAJK;AAKdD,iBAAS,EAAE;AALG,OAAf;;AAQA,YAAM8D,YAAY,GAAG,KAAKC,iBAAL,CAAuB3B,QAAvB,CAArB;;AAEA,UAAI0B,YAAY,KAAK,IAAjB,IAAyBA,YAAY,KAAK,KAAKH,oCAAnD,EAAyF;AACxF9D,cAAM,CAACI,OAAP,GAAiB,KAAjB,CADwF,CAExF;;AACA,eAAO,KAAKG,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA;;AAED,aAAO,KAAKmE,eAAL,GAAuBvG,IAAvB,CAA4B+nB,YAAY,IAAI;AAClD3lB,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgBmmB,YAAhB,CAApB;AACA3lB,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACAD,cAAM,CAACG,SAAP,GAAmB,KAAKR,eAAL,CAAqBgmB,YAArB,IAAqCjmB,kBAAxD;;AAEA,YACCM,MAAM,CAACC,UAAP,GAAoBV,aAApB,IACA;AACCS,cAAM,CAACC,UAAP,KAAsBV,aAAtB,IAAuCS,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDP,0BAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AAED,eAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,OAdM,CAAP;AAeA,KAhCD,CADM,EAkCLpC,IAlCK,CAkCA,MAAM;AACZ,UAAI,KAAKwB,WAAT,EAAsB;AACrBvG,oDAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,eAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,mBAAS,EAAEhB,gBAFa;AAGxBL,uBAHwB;AAIxBG;AAJwB,SAAzB;AAMA;;AACD,aAAOpG,+CAAO,CAACC,OAAR,EAAP;AACA,KA5CM,CAAP;AA6CA;;AA7FuD,CAAzD;AAgGe;AACdwM,MAAI,EAAE,YADQ;AAEd5M,QAAM,EAAE,gBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdulB,YAAU,EAAE,EAJE;AAKdtlB,iBAAe,EAAE,IALH;AAMdC,iBAAe,EAAE0xB,OAAO,GAAGx3B,aAAH,GAAmB2C,MAAM,CAACC,QAAP,CAAgBC,IAN7C;AAOdQ;AAPc,CAAf,E;;;;;;;;;;;;ACzHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAM;AAAE1I;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;;;;;;;;;AAsBA,MAAMmI,MAAM,GAAG,gBAAf;AACA,MAAMoD,QAAQ,GAAG,4BAAjB;AACA,MAAMyL,QAAQ,GAAI,GAAEzL,QAAS,wBAA7B;;AAEA,MAAM6D,QAAQ,GAAG,MAAMrH,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC8O,QAAhC,CAAvB;;AACA,MAAMvO,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AAEA,SAAK48B,mBAAL,GAA2B,qBAA3B;AACA,SAAK73B,sBAAL,GAA8B,yBAA9B;AACA,SAAK83B,sBAAL,GAA8B,4BAA9B;AACA,SAAKC,mBAAL,GAA2B,2BAA3B;AAEA,SAAK78B,cAAL,GAAsB,KAAK28B,mBAA3B;AAEA,SAAKG,eAAL,GAAuB,8DAAvB;AACA,SAAKn4B,cAAL,GAAsB,KAAKm4B,eAA3B;AACA,SAAKl4B,eAAL,GAAuB,KAAKk4B,eAA5B;AACA,SAAKj4B,kBAAL,GAA0BgS,QAA1B;AACA,SAAK9R,qBAAL,GAA6B,2DAA7B;AACA,SAAKC,sBAAL,GAA8B,+DAA9B;AAEA,SAAK+oB,2BAAL,GAAmC,wBAAnC;AACA,SAAK9W,mBAAL,GAA2B,aAA3B;AACA,SAAK8lB,yBAAL,GAAiC,iCAAjC;AACA,SAAKxrB,mBAAL,GAA2B,gBAA3B;AACA,SAAK4F,kBAAL,GAA0B,gBAA1B;AACA,SAAK6lB,mBAAL,GAA2B,gBAA3B;AACA,SAAKC,gBAAL,GAAwB,gBAAxB;AAEA,SAAK5K,eAAL,GAAuB,KAAK,EAAL,GAAU,IAAjC,CAzBa,CAyB0B;;AACvC,SAAKzf,uBAAL,GAA+B,iCAA/B;AACA,SAAKsqB,YAAL,GAAoB,wBAApB;AACA,SAAK10B,iBAAL,GAAyB,oBAAzB;AACA;;AAEDvK,kBAAgB,GAAG;AAClB,WAAO,CAAC,GAAGhB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKkQ,uBAA/B,CAAJ,EAA6DtQ,GAA7D,CAAiE2S,IAAI,IAAIA,IAAI,CAACrS,SAA9E,EAAyF8G,MAAzF,CAAgGE,OAAhG,CAAP;AACA;;AAEDtL,iBAAe,GAAG;AACjB,UAAMlE,QAAQ,GAAG,MAAMkE,eAAN,EAAjB;AAEA4O,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAEhT,QADO;AAEvBiT,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAED,QAAM7O,cAAN,GAAuB;AACtB,QAAI2+B,qBAAqB,GAAG,KAA5B;AACA,UAAMphC,aAAa,GAAG,MAAML,wDAAmB,CAACM,gBAApB,CAAqCgM,MAArC,CAA5B;;AACA,QAAIjM,aAAJ,EAAmB;AAClBohC,2BAAqB,GAAG3hC,IAAI,CAACC,GAAL,KAAaM,aAAa,CAACy2B,iBAA3B,GAA+C,KAAKH,eAA5E;AACA;;AAED,UAAM3Y,kBAAkB,GAAGzc,QAAQ,CAACC,aAAT,CAAuB,KAAK+Z,mBAA5B,CAA3B;AACA,UAAMmmB,mBAAmB,GAAGngC,QAAQ,CAACC,aAAT,CAAuB,KAAK6wB,2BAA5B,CAA5B;AACA,UAAMnxB,YAAY,GAAGK,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAArB;AACA,UAAMy0B,gBAAgB,GAAGx3B,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAAzB;AACA,UAAMwlB,WAAW,GAAGtC,gBAAgB,GACjCA,gBAAgB,CAACn3B,WAAjB,CAA6BoK,WAA7B,GAA2CjK,KAA3C,CAAiD,KAAKw/B,gBAAtD,CADiC,GAEjC,KAFH;AAGA,UAAM3iC,YAAY,GACjB2U,QAAQ,MACRrS,YADA,IAEC,CAACugC,qBAAD,IAA0B,CAACpG,WAA3B,KAA2Crd,kBAAkB,IAAI0jB,mBAAjE,CAHF;AAIA,WAAO9iC,YAAP;AACA;;AAEDoD,iBAAe,GAAG;AACjB,UAAM2/B,kBAAkB,GAAGpgC,QAAQ,CAACC,aAAT,CAAuB,KAAK0/B,sBAA5B,CAA3B;AACA,UAAMU,WAAW,GAAGD,kBAAkB,GAAGA,kBAAkB,CAACjgC,KAAtB,GAA8B,IAApE;AAEA,UAAMmgC,iBAAiB,GAAGtgC,QAAQ,CAACC,aAAT,CAAuB,KAAK2/B,mBAA5B,CAA1B;AACA,UAAMW,UAAU,GAAGD,iBAAiB,GAAGA,iBAAiB,CAACngC,KAArB,GAA6B,OAAjE;AAEA,SAAKiI,gBAAL,CAAsBhB,GAAtB,CAA0B,MAA1B,EAAkC,gBAAlC;AACA,SAAKgB,gBAAL,CAAsBhB,GAAtB,CAA0B,aAA1B,EAAyCm5B,UAAzC;AACA,SAAKn4B,gBAAL,CAAsBhB,GAAtB,CAA0B,cAA1B,EAA0Ci5B,WAA1C;AACA,SAAKj4B,gBAAL,CAAsBhB,GAAtB,CAA0B,8DAA1B,EAA0F,EAA1F;AACA,SAAKgB,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,6DAApC;AAEA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,MAA3B,EAAmC,iBAAnC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,aAA3B,EAA0Cm5B,UAA1C;AACA,SAAKj4B,iBAAL,CAAuBlB,GAAvB,CAA2B,cAA3B,EAA2Ci5B,WAA3C;AACA,SAAK/3B,iBAAL,CAAuBlB,GAAvB,CAA2B,kEAA3B,EAA+F,EAA/F;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,+DAArC;AACA;;AAEDnG,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAClB,QAAQ,CAACC,aAAT,CAAuB,KAAK4H,sBAA5B,CAAD,EACZ4E,MADY,CACLE,OADK,EAEZtH,GAFY,CAERoK,WAAW,IAAIA,WAAW,CAACtP,KAFnB,CAAd;AAIA,WAAO;AACNe,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDvG,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAO,KAAKgE,UAAL,CAAgBhE,KAAK,CAAC,CAAD,CAArB,EACLqB,IADK,CACA,MAAM,KAAKuG,eAAL,EADN,EAELvG,IAFK,CAEA2E,QAAQ,IAAI,KAAK/C,UAAL,CAAgB+C,QAAhB,CAFZ,CAAP;AAGA;;AAEDtG,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2C;AACpDxF,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACA,WAAOjG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAAI;AAClC,YAAME,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdE,eAAO,EAAE,IAJK;AAKdy7B,oBAAY,EAAE;AALA,OAAf;AAOA,aAAO,KAAKx8B,SAAL,CAAeS,IAAf,EACLlC,IADK,CACA,MAAM,KAAKuG,eAAL,EADN,EAELvG,IAFK,CAEA2E,QAAQ,IAAI;AACjB,YAAI,KAAKqwB,cAAL,CAAoBrwB,QAApB,CAAJ,EAAmC;AAClCvC,gBAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,iBAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AACDA,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB+C,QAAhB,CAApB;AACAvC,cAAM,CAAC67B,YAAP,GAAsB,KAAKC,kBAAL,CAAwBv5B,QAAxB,CAAtB;AACAvC,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACA,eAAO,KAAKM,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,OAXK,CAAP;AAYA,KApBM,CAAP;AAqBA;;AAEDhE,kBAAgB,GAAG;AAClBlC,4DAAmB,CAACC,gBAApB,CAAqCqM,MAArC,EAA6C;AAC5CwqB,uBAAiB,EAAEh3B,IAAI,CAACC,GAAL;AADyB,KAA7C;AAGA;;AAED,QAAM4C,sBAAN,GAA+B;AAC9B,UAAMs/B,QAAQ,GAAG,MAAM,KAAK53B,eAAL,EAAvB;AACA,UAAM6H,KAAK,GAAG,KAAKxM,UAAL,CAAgBu8B,QAAhB,CAAd;AACA,UAAM9zB,QAAQ,GAAGjK,cAAc,CAAC,KAAK4I,iBAAN,EAAyBm1B,QAAzB,CAAd,GACd/rB,8DAAW,CAAC,KAAKpJ,iBAAN,EAAyBm1B,QAAzB,CAAX,CAA8C96B,IAA9C,EADc,GAEd,CAFH;AAGA,UAAM+6B,GAAG,GAAGh+B,cAAc,CAAC,KAAKs9B,YAAN,EAAoBS,QAApB,CAAd,GAA8C/rB,8DAAW,CAAC,KAAKsrB,YAAN,EAAoBS,QAApB,CAAX,CAAyC96B,IAAzC,EAA9C,GAAgG,CAA5G;AAEA,WAAO+K,KAAK,IAAI/D,QAAQ,CAACnC,WAAT,OAA2B,MAA3B,GAAoC5N,6DAAO,CAAC+P,QAAD,CAA3C,GAAwD,CAA5D,CAAL,GAAsE/P,6DAAO,CAAC8jC,GAAD,CAApF;AACA;;AAEDpJ,gBAAc,CAACrwB,QAAD,EAAW;AACxB,UAAM05B,YAAY,GAAGj+B,cAAc,CAAC,KAAKqX,mBAAN,EAA2B9S,QAA3B,CAAnC;AACA,UAAM25B,cAAc,GAAGD,YAAY,IAAIA,YAAY,CAAC/T,IAAb,KAAsB,QAA7D;AACA,UAAMiU,YAAY,GAAGn+B,cAAc,CAAC,KAAKuX,kBAAN,EAA0BhT,QAA1B,CAAnC;AACA,UAAM65B,cAAc,GAAGD,YAAY,GAChC,CAAC,GAAGn+B,cAAc,CAAC,KAAKuX,kBAAN,EAA0BhT,QAA1B,EAAoC,IAApC,CAAlB,EAA6DsJ,IAA7D,CAAkE9D,EAAE,IAAIA,EAAE,CAAC4B,KAAH,CAAS8Q,OAAT,KAAqB,OAA7F,CADgC,GAEhC,KAFH;AAGA,WAAO,CAAClY,QAAD,IAAa25B,cAAb,IAA+BE,cAAtC;AACA;;AAEDN,oBAAkB,CAACv5B,QAAD,EAAW;AAC5B,WAAOyF,OAAO,CACbhK,cAAc,CAAC,KAAKm9B,yBAAN,EAAiC54B,QAAjC,CAAd,CACE7G,WADF,CACcoK,WADd,GAEEjK,KAFF,CAEQ,KAAKu/B,mBAFb,CADa,CAAd;AAKA;;AAjKuD,CAAzD;AAoKe;AACdr1B,MAAI,EAAE,cADQ;AAEd5M,QAAM,EAAE,gBAFM;AAGduN,QAHc;AAId8nB,YAAU,EAAE,EAJE;AAIE;AAChBtlB,iBAAe,EAAE,IALH;AAMdC,iBAAe,EAAE8L,QANH;AAMa;AAC3BtK,kBAAgB,EAAEC,wDAAiB,CAACsS;AAPtB,CAAf,E;;;;;;;;;;;;ACzMA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM;AAAEpf;AAAF,IAAkB3F,6CAAxB;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA,MAAMyW,aAAa,GAAG,yBAAtB;AACA,MAAMrR,aAAa,GAAI,GAAEqR,aAAc,OAAvC;AACA,MAAMmX,aAAa,GAAG,sDAAtB;AACA,MAAMxd,SAAS,GAAGrI,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAiC,GAAEuO,aAAc,UAAjD,CAAlB;AAEA;;;;;;;;;;;;;;;;;;AAkBA,MAAMhO,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,cAAtB;AACA,SAAK8E,sBAAL,GAA8B,EAA9B;AACA,SAAK7E,qBAAL,GAA6BwtB,aAA7B;AAEA,SAAKjlB,iBAAL,GAAyB,+BAAzB;AACA,SAAKE,YAAL,GAAoB,0DAApB;AAEA,SAAKkK,uBAAL,GAA+B,wBAA/B;AACA,SAAKqrB,qBAAL,GAA6B,eAA7B;AAEA,SAAKj9B,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,0EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,6BAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA6H,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAE,IADO;AAEvBC,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAEDpP,kBAAgB,GAAG;AAClB,WAAO,CAACgS,SAAS,GAAG,KAAK7J,WAAL,EAAH,GAAwBlL,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAlC,EAAyDqE,IAAzD,CAA8D8G,YAAY,IAAI;AACpF,YAAMnI,KAAK,GAAG,CAAC,GAAGyB,cAAc,CAAC,KAAKgT,uBAAN,EAA+BtM,YAA/B,EAA6C,IAA7C,CAAlB,EACZhE,GADY,CACR2S,IAAI,IAAIA,IAAI,CAACrS,SAAL,CAAenF,KAAf,CAAqB,KAAKwgC,qBAA1B,CADA,EAEZv0B,MAFY,CAELE,OAFK,EAGZtH,GAHY,CAGR2S,IAAI,IAAIA,IAAI,CAAC,CAAD,CAHJ,CAAd;AAIA,aAAO,CAAC,GAAG,IAAIxS,GAAJ,CAAQtE,KAAR,CAAJ,CAAP;AACA,KANM,CAAP;AAOA;;AAEDgE,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDrD,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B8G,YAAY,IAAI;AAClD,YAAMsH,KAAK,GAAG,KAAKxM,UAAL,CAAgBkF,YAAhB,CAAd;AACA,YAAM0D,GAAG,GAAGtK,WAAW,CAACE,cAAc,CAAC,KAAK8I,YAAN,EAAoBpC,YAApB,CAAf,CAAX,IAAgE,CAA5E;AACA,YAAMuD,QAAQ,GAAGnK,WAAW,CAACE,cAAc,CAAC,KAAK4I,iBAAN,EAAyBlC,YAAzB,CAAf,CAAX,IAAqE,CAAtF;AACA,aAAOsH,KAAK,GAAG5D,GAAR,GAAcH,QAArB;AACA,KALM,CAAP;AAMA;;AAtDuD,CAAzD;AAyDe;AACdlC,MAAI,EAAE,SADQ;AAEd5M,QAAM,EAAE,aAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;AAKdyC,iBAAe,EAAEkF,SAAS,GAAI,GAAEqG,aAAc,WAApB,GAAiC1O,MAAM,CAACC,QAAP,CAAgBC,IAL7D;AAMdyE,kBAAgB,EAAEC,wDAAiB,CAACC,OANtB;;AAOdpD,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,kBAAvB,CAAD,CAAd;AACA,GATa;;AAUd2O,aAAW,CAAC/D,IAAD,EAAO;AACjB,WAAO,CAACA,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KAAkCgL,SAAnC,KAAiDhT,QAAQ,CAACC,aAAT,CAAuBuwB,aAAvB,CAAxD;AACA;;AAZa,CAAf,E;;;;;;;;;;;;ACvFA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA,MAAM;AAAE/tB;AAAF,IAAkB3F,6CAAxB;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;;;;;AAkBA,MAAMiU,UAAU,GAAG,4BAAnB;AAEA,MAAMxL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKkN,qBAAL,GAA6B,aAA7B;AACA,SAAKjN,cAAL,GAAsB,2BAAtB;AACA,SAAKuI,mBAAL,GAA2B,wBAA3B;AACA,SAAKtI,qBAAL,GAA6B,WAA7B;AACA,SAAKgF,aAAL,GAAsB,GAAE6O,UAAW,YAAnC;AAEA,SAAK3T,mBAAL,GAA2B,sCAA3B;AACA,SAAKC,kBAAL,GAA0B,kBAA1B;AAEA,UAAMgL,QAAQ,GAAI,GAAE0I,UAAW,6CAA/B;AACA,SAAKnP,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC,CAZa,CAcb;;AACA,SAAKvG,kBAAL,GAA0B,KAAKI,aAA/B;AAEA,SAAKI,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AAEA,SAAK2N,aAAL,GAAqB,0BAArB;AACA,SAAKC,gBAAL,GAAwB,mCAAxB;AAEA,SAAKisB,eAAL,GAAuB,2BAAvB;AACA,SAAKC,6BAAL,GAAqC,SAArC;AACA,SAAKhvB,sBAAL,GAA8B,YAA9B;AACA,SAAKC,mBAAL,GAA2B,cAA3B;AACAlC,qDAAY,CAACC,UAAb;AACA;;AAED3O,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAMu2B,aAAa,GAAGt2B,IAAI,CAACC,UAAL,CAAgB,KAAK9C,aAArB,CAAtB;AACA,UAAM8K,SAAS,GAAG9S,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAAlB;AAEA,WAAO61B,aAAa,IAAIruB,SAAxB;AACA;;AAED5N,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAED,QAAMzD,gBAAN,GAAyB;AACxB,UAAMogC,yBAAyB,GAAGphC,QAAQ,CAACC,aAAT,CAAuB,KAAKihC,6BAA5B,CAAlC;AACA,UAAMG,kBAAkB,GAAGD,yBAAyB,GAAG,CAACA,yBAAyB,CAAC/gC,WAA3B,CAAH,GAA6C,EAAjG;AAEA,UAAMihC,SAAS,GAAG,CAAC,GAAGthC,QAAQ,CAACyF,gBAAT,CAA0B,KAAKw7B,eAA/B,CAAJ,EAChB57B,GADgB,CACZqH,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeG,KAAf,CAAqB,KAAK2R,mBAA1B,CADM,EAEhB1F,MAFgB,CAETE,OAFS,EAGhBtH,GAHgB,CAGZqH,EAAE,IAAIA,EAAE,CAAC,CAAD,CAHI,CAAlB;AAKA,UAAM60B,QAAQ,GAAG,MAAM36B,KAAK,CAACiQ,UAAD,EAAa;AAAEvU,YAAM,EAAE;AAAV,KAAb,CAA5B;AACA,UAAMk/B,YAAY,GAAG,MAAMD,QAAQ,CAACp6B,IAAT,EAA3B;AACA,UAAMgS,aAAa,GAAGxW,cAAc,CAAC,KAAKuP,sBAAN,EAA8BsvB,YAA9B,EAA4C,IAA5C,CAAd,GACnB,CAAC,GAAG7+B,cAAc,CAAC,KAAKuP,sBAAN,EAA8BsvB,YAA9B,EAA4C,IAA5C,CAAlB,EACCn8B,GADD,CACKgQ,IAAI,IAAIA,IAAI,CAAChV,WAAL,CAAiBG,KAAjB,CAAuB,KAAK2R,mBAA5B,CADb,EAEC1F,MAFD,CAEQE,OAFR,EAGCtH,GAHD,CAGKgQ,IAAI,IAAIA,IAAI,CAAC,CAAD,CAHjB,EAIC5I,MAJD,CAIQE,OAJR,CADmB,GAMnB,EANH;AAQA,WAAO,CAAC,GAAG,IAAInH,GAAJ,CAAQ,CAAC,GAAG87B,SAAJ,EAAe,GAAGnoB,aAAlB,EAAiC,GAAGkoB,kBAApC,CAAR,CAAJ,CAAP;AACA;;AAED,QAAMjgC,sBAAN,GAA+B;AAC9B,UAAMkU,OAAO,GAAG,MAAM1O,KAAK,CAAC,KAAKgB,kBAAN,EAA0B;AAAEZ,iBAAW,EAAE;AAAf,KAA1B,CAAL,CAA2DzE,IAA3D,CAAgE2E,QAAQ,IAC7FA,QAAQ,CAACC,IAAT,EADqB,CAAtB;AAGA,UAAMwJ,KAAK,GAAGlO,WAAW,CAACE,cAAc,CAAC,KAAKI,cAAN,EAAsBuS,OAAtB,CAAf,CAAzB;AACA,UAAMxD,KAAK,GAAG,CAAC,GAAGnP,cAAc,CAAC,KAAKqS,gBAAN,EAAwBM,OAAxB,EAAiC,IAAjC,CAAlB,EACZ7I,MADY,CACLC,EAAE,IAAIA,EAAE,CAAC6I,aAAH,CAAiBlV,WAAjB,CAA6BG,KAA7B,CAAmC,KAAKuU,aAAxC,CADD,EAEZ1P,GAFY,CAER5C,WAFQ,EAGZgK,MAHY,CAGLE,OAHK,EAIZyI,MAJY,CAIL,CAACI,OAAD,EAAUC,MAAV,KAAqBD,OAAO,GAAGC,MAJ1B,EAIkC,CAJlC,CAAd;AAKA,WAAO9E,KAAK,GAAGmB,KAAf;AACA;;AA3EuD,CAAzD;AA8Ee;AACdpH,MAAI,EAAE,iBADQ;AAEd5M,QAAM,EAAE,oBAFM;AAGdwR,kBAAgB,EAAEC,iEAAiB,CAACC,OAHtB;AAIdnE,QAJc;AAKdwC,iBAAe,EAAE;AALH,CAAf,E;;;;;;;;;;;;AC3GA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM4zB,WAAW,GAAG,gCAApB;AACA,MAAMz5B,aAAa,GAAI,GAAEy5B,WAAY,QAArC;AAEA,MAAMp2B,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,gDAAtB;AACA,SAAK8E,sBAAL,GAA8B,oBAA9B;AACA,SAAK9D,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAI,GAAEszB,WAAY,8CAAhC;AACA,SAAK/5B,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,6BAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKD,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA,SAAKs5B,yBAAL,GAAiC,wBAAjC;AACA,SAAKC,6BAAL,GAAqC,2BAArC;AACA,SAAKrtB,mBAAL,GAA2B,wCAA3B;AACA,SAAKstB,cAAL,GAAsB,uBAAtB;AACA;;AAEDvgC,iBAAe,GAAG;AACjB,QAAIC,aAAa,GAAG,KAApB;AACAlE,eAAW,CAAC,MAAM;AACjB,YAAMykC,WAAW,GAChB,CAACl3B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAiC,GAAE22B,WAAY,WAA/C,KACA92B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAiC,GAAE22B,WAAY,WAA/C,CADA,IAEA92B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,iBAA9B,CAFD,KAGApL,QAAQ,CAACC,aAAT,CAAuB,KAAK0hC,6BAA5B,CAJD;AAKA,YAAMjtB,SAAS,GAAG,CAAC1U,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAAnB;AACA,YAAMwtB,UAAU,GAAG9hC,QAAQ,CAACC,aAAT,CAAuB,KAAK2hC,cAA5B,IAChB5hC,QAAQ,CAACC,aAAT,CAAuB,KAAK2hC,cAA5B,EAA4ChY,SAA5C,CAAsDC,QAAtD,CAA+D,uBAA/D,CADgB,GAEhB,KAFH;AAIA,YAAMxsB,YAAY,GAAG,CAAC,KAAK2L,aAAL,MAAwB64B,WAAzB,KAAyC,CAACntB,SAA1C,IAAuD,CAACotB,UAA7E;;AACA,UAAIzkC,YAAY,KAAKiE,aAArB,EAAoC;AACnC9D,oDAAG,CAACC,KAAJ,CAAUJ,YAAY,GAAG,aAAH,GAAmB,eAAzC;AACA;;AACDiE,mBAAa,GAAGjE,YAAhB;AACA,KAhBU,EAgBR,GAhBQ,CAAX;AAiBA;;AAED4D,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,EAAd;AACA,WAAO;AACNA,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDpC,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDuE,eAAa,GAAG;AACf,WACC2B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,KAAK9C,aAArC,KACAhI,QAAQ,CAACC,aAAT,CAAuB,KAAKyhC,yBAA5B,CAFD;AAIA;;AA9DuD,CAAzD;AAiEe;AACdh3B,MAAI,EAAE,iBADQ;AAEd5M,QAAM,EAAE,oBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdyB,kBAAgB,EAAEC,wDAAiB,CAACC,OALtB;AAMdnE,QANc;;AAOduD,aAAW,GAAG;AACb,WAAO,KAAP;AACA;;AATa,CAAf,E;;;;;;;;;;;;ACxEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAM;AAAE/R,SAAF;AAAW4F;AAAX,IAA2B3F,6CAAjC;AACA,MAAM;AAAE6F,gBAAF;AAAkBie;AAAlB,IAA+Bhe,0CAArC;AAEA,MAAMoF,aAAa,GAAG,2BAAtB;;AACA,MAAMgK,QAAQ,GAAG,MAAMrH,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8BpD,aAA9B,KAAgDhI,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAvE;AAEA;;;;;;;;;;;;;;AAaA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GACC,gGADD;AAEA,SAAK8E,sBAAL,GAA8B,qBAA9B;AACA,SAAKyD,mBAAL,GAA2B,kBAA3B;AACA,SAAK8I,wBAAL,GAAgC,uBAAhC;AACA,SAAK2tB,uBAAL,GAA+B,wBAA/B;AACA,SAAK3yB,wBAAL,GAAgC,iBAAhC;AACA,SAAK4yB,eAAL,GAAuB,2CAAvB;AAEA,UAAM7zB,QAAQ,GAAG,qEAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,wBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,yBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,wBAAtC;AACA,SAAK8zB,aAAL,GAAsB,GAAE9zB,QAAS,iEAAjC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKD,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAKM,gBAAL,GAAwB,IAAIC,eAAJ,CAAoB;AAC3CvL,YAAM,EAAE,MADmC;AAE3ColC,SAAG,EAAE,IAFsC;AAG3CrI,+BAAyB,EAAE;AAHgB,KAApB,CAAxB;AAMA,SAAKvxB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA,SAAK+5B,UAAL,GAAkB,IAAlB;AACA;;AAED9gC,iBAAe,GAAG;AACjB,QAAIC,aAAa,GAAG,KAApB;AACAlE,eAAW,CAAC,MAAM;AACjB,YAAMgU,QAAQ,GAAGzG,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC9C,aAAhC,CAAjB;AACA,YAAMo6B,UAAU,GAAGz1B,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,KAAK+hC,eAA5B,CAAD,CAA1B;AACA,YAAM3kC,YAAY,GAAG+T,QAAQ,IAAIgxB,UAAjC;;AACA,UAAI/kC,YAAY,KAAKiE,aAArB,EAAoC;AACnC9D,oDAAG,CAACC,KAAJ,CAAUJ,YAAY,GAAG,aAAH,GAAmB,eAAzC;AACA;;AACDiE,mBAAa,GAAGjE,YAAhB;AACA,KARU,EAQR,GARQ,CAAX;AASA;;AAED0D,aAAW,GAAG;AACb,WAAO9C,+CAAO,CAACC,OAAR,GACLqE,IADK,CACA,MAAO,KAAKyG,aAAL,KAAuB,KAAKq5B,aAAL,EAAvB,GAA8C,KAAKC,oBAAL,EADrD,EAEL//B,IAFK,CAEAggC,aAAa,IAClB,KAAKv5B,aAAL,KAAuB/K,+CAAO,CAACuG,IAAR,CAAa+9B,aAAb,EAA4B99B,IAAI,IAAI,KAAKS,UAAL,CAAgBT,IAAhB,CAApC,CAAvB,GAAoF89B,aAH/E,EAKLhgC,IALK,CAKA,MAAM,KAAKuG,eAAL,EALN,EAMLvG,IANK,CAMA6Z,YAAY,KAAK;AACtBlY,mBAAa,EAAE,KAAKC,UAAL,CAAgBiY,YAAhB,CADO;AAEtB/X,wBAAkB,EAAE,KAAKC,eAAL,CAAqB8X,YAArB;AAFE,KAAL,CANZ,CAAP;AAUA;;AAEDxb,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CE,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjG3F,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACAvF,sDAAG,CAAC,wBAAD,EAA2B0F,kBAA3B,CAAH;AAEA,UAAME,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0BoG,iBAAiB,IAAI;AAC9C,YAAMhE,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE,CAJG;AAKdC,eAAO,EAAE;AALK,OAAf;AAOAJ,YAAM,CAACI,OAAP,GAAiB,CAAC4D,iBAAiB,CAAC65B,YAApC;;AAEA,UAAI,CAAC79B,MAAM,CAACI,OAAZ,EAAqB;AACpB,eAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AAED,aAAO,KAAKmE,eAAL,GAAuBvG,IAAvB,CAA4BwG,YAAY,IAAI;AAClDpE,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB4E,YAAhB,CAApB;AACApE,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACAD,cAAM,CAACG,SAAP,GAAmB,KAAKR,eAAL,CAAqByE,YAArB,IAAqC1E,kBAAxD;AACAM,cAAM,CAACI,OAAP,GAAiB,IAAjB;;AAEA,YACCJ,MAAM,CAACC,UAAP,GAAoBV,aAApB,IACCS,MAAM,CAACC,UAAP,KAAsBV,aAAtB,IAAuCS,MAAM,CAACG,SAAP,GAAmB,CAF5D,EAGE;AACDP,0BAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AACD,eAAO,KAAK09B,aAAL,GACL9/B,IADK,CACAggC,aAAa,IAAI,KAAKr9B,UAAL,CAAgBq9B,aAAa,CAAC,CAAD,CAA7B,CADjB,EAELhgC,IAFK,CAEA,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAFN,CAAP;AAGA,OAfM,CAAP;AAgBA,KA9BD,CADM,EAgCLpC,IAhCK,CAgCA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,WAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,eAAS,EAAEhB,gBAFa;AAGxBL,mBAHwB;AAIxBG;AAJwB,KAAzB,CAjCM,CAAP;AAwCA;;AAEDvD,YAAU,CAACgF,cAAD,EAAiB;AAC1B,UAAM;AAAEP,eAAF;AAAarB,mBAAb;AAA4BG;AAA5B,QAAmDyB,cAAzD;AAEAP,aAAS,CAACQ,IAAV,CAAe,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACxB,UAAIA,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAApB,KAAsC,CAA1C,EAA6C;AAC5C,eAAOoB,CAAC,CAACnB,SAAF,GAAckB,CAAC,CAAClB,SAAvB;AACA;;AACD,aAAOmB,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAA3B;AACA,KALD;AAOA,QAAIqB,YAAY,GAAGhC,aAAnB;AACA,QAAIiC,eAAe,GAAG,CAAtB;AACA,QAAIC,gBAAgB,GAAG,CAAvB;AACA,UAAMC,eAAe,GAAG,EAAxB;AAEA,WAAOpI,+CAAO,CAACuG,IAAR,CAAae,SAAb,EAAwBD,QAAQ,IACtC,KAAKtB,SAAL,CAAesB,QAAQ,CAACb,IAAxB,EACElC,IADF,CACO,MAAM,KAAKuG,eAAL,EADb,EAEEvG,IAFF,CAEO6Z,YAAY,IAAI;AACrB,YAAMxX,UAAU,GAAG,KAAKT,UAAL,CAAgBiY,YAAhB,CAAnB;AACA,YAAMvX,aAAa,GAAGX,aAAa,GAAGU,UAAtC;AACA,YAAME,SAAS,GAAG,KAAKR,eAAL,CAAqB8X,YAArB,IAAqC/X,kBAAvD;AAEA7G,kDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBgH,YAAI,EAAEa,QAAQ,CAACb,IADU;AAEzBG,kBAFyB;AAGzBC,qBAHyB;AAIzBC;AAJyB,OAA1B;;AAOA,UAAIF,UAAU,GAAGsB,YAAb,IAA8BtB,UAAU,KAAKsB,YAAf,IAA+BpB,SAAS,GAAGsB,gBAA7E,EAAgG;AAC/FC,uBAAe,CAACpB,IAAhB,CAAqBK,QAAQ,CAACb,IAA9B;AACA0B,uBAAe,GAAGtB,aAAlB;AACAqB,oBAAY,GAAGtB,UAAf;AACAwB,wBAAgB,GAAGtB,SAAnB;AACA,eAAO7G,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,aAAO,KAAKmkC,aAAL,GACL9/B,IADK,CACAggC,aAAa,IAAI,KAAKr9B,UAAL,CAAgBq9B,aAAa,CAAC,CAAD,CAA7B,CADjB,EAELhgC,IAFK,CAEA,MAAM;AACX,YAAI,KAAKmG,4BAAT,EAAuC;AACtC,iBAAOzK,+CAAO,CAACuG,IAAR,CAAa6B,eAAb,EAA8B5B,IAAI,IAAI,KAAKT,SAAL,CAAeS,IAAf,CAAtC,CAAP;AACA;;AACD,eAAOxG,+CAAO,CAACC,OAAR,EAAP;AACA,OAPK,CAAP;AAQA,KA7BF,CADM,EA+BLqE,IA/BK,CA+BA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,oBAAV,EAAgC;AAC/ByD,WAAK,EAAEmF,eADwB;AAE/BzB,gBAAU,EAAEsB,YAFmB;AAG/BrB,mBAAa,EAAEsB,eAHgB;AAI/BrB,eAAS,EAAEsB;AAJoB,KAAhC,CAhCM,CAAP;AAuCA;;AAEDvF,YAAU,CAACK,KAAD,EAAQ;AACjB,WAAO,CAAC,KAAK8H,aAAL,EAAD,GAAwB,KAAKy5B,mBAAL,CAAyBvhC,KAAzB,CAAxB,GAA0DjD,+CAAO,CAACC,OAAR,EAAjE;AACA;;AAEDukC,qBAAmB,CAACvhC,KAAD,EAAQ;AAC1B,WAAO,KAAKgE,UAAL,CAAgBhE,KAAK,CAAC,CAAD,CAArB,EAA0BqB,IAA1B,CAA+B,MAAM;AAC3Cqe,cAAQ,CAAC5gB,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAAD,EAAmDpK,KAAK,CAAC,CAAD,CAAxD,CAAR;AACAlB,cAAQ,CAACC,aAAT,CAAuB,KAAK8hC,uBAA5B,EAAqDx0B,KAArD;AACA,YAAMyxB,OAAO,GAAGh/B,QAAQ,CAACC,aAAT,CAAuB,KAAKmP,wBAA5B,CAAhB;;AACA,UAAI4vB,OAAJ,EAAa;AACZA,eAAO,CAAC1nB,MAAR;AACA;AACD,KAPM,CAAP;AAQA;;AAEDgrB,sBAAoB,GAAG;AACtB,KAAC,GAAGtiC,QAAQ,CAACyF,gBAAT,CAA0B,KAAK2O,wBAA/B,CAAJ,EAA8DtU,OAA9D,CAAsE4iC,UAAU,IAAIA,UAAU,CAACn1B,KAAX,EAApF;AACA,WAAOtP,+CAAO,CAACC,OAAR,EAAP;AACA;;AAEDiG,YAAU,CAACoD,IAAD,EAAO;AAChB,QAAIA,IAAJ,EAAU;AACT,aAAO1K,OAAO,CAAC0K,IAAI,CAACoJ,KAAN,CAAd;AACA;;AACD,WAAOlO,WAAW,CAACE,cAAc,CAAC,KAAKI,cAAN,CAAf,CAAlB;AACA;;AAEDiG,eAAa,GAAG;AACf,WAAOgJ,QAAQ,EAAf;AACA;;AAEDqwB,eAAa,GAAG;AACf,WAAO,KAAK/4B,eAAL,CAAqB,KAAK24B,aAA1B,EAAyC1/B,IAAzC,CAA8C6Z,YAAY,IAAIA,YAAY,CAAC/W,GAAb,CAAiBK,OAAO,IAAIA,OAAO,CAACm2B,IAApC,CAA9D,CAAP;AACA;;AAhMuD,CAAzD;AAmMe;AACdnxB,MAAI,EAAE,MADQ;AAEd5M,QAAM,EAAE,UAFM;AAGdwR,kBAAgB,EAAE,MAAO0C,QAAQ,KAAKzC,wDAAiB,CAACC,OAAvB,GAAiCD,wDAAiB,CAACqS,IAHtE;AAIdhU,WAAS,EAAE,IAJG;AAKdC,iBAAe,EAAE,IALH;AAMdxC,QANc;;AAOduD,aAAW,GAAG;AACb,WAAO,KAAP;AACA;;AATa,CAAf,E;;;;;;;;;;;;AC3NA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA,MAAMT,QAAQ,GAAG,YAAjB;AACA,MAAMpD,MAAM,GAAI,eAAcoD,QAAS,EAAvC;AAEA;;;;;;;;;;AAUA,MAAM9C,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,2BAAtB;AACA,SAAK8E,sBAAL,GAA8B,gBAA9B;AACA,SAAK9D,WAAL,GAAmB,IAAnB;AAEA,UAAMixB,WAAW,GAAG,sEAApB;AACA,SAAKttB,cAAL,GAAuB,GAAEstB,WAAY,qBAArC;AACA,SAAKrtB,eAAL,GAAwB,GAAEqtB,WAAY,6BAAtC;AACA,SAAKptB,kBAAL,GAA2B,GAAEotB,WAAY,yCAAzC;AACA,SAAKhtB,aAAL,GAAsB,GAAE+C,MAAO,OAA/B;AACA,SAAKhD,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAK66B,uBAAL,GAA+B,wBAA/B;AACA,SAAKlP,0BAAL,GAAkC,EAAlC;AACA,SAAKrrB,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA,SAAKw6B,eAAL,GAAuB,IAAvB;AACA,SAAKC,UAAL,GAAkB,aAAlB;AACA,SAAKC,UAAL,GAAkB,qBAAlB;AACA;;AAEDzhC,iBAAe,GAAG;AACjB,UAAMlE,QAAQ,GAAG,MAAMkE,eAAN,EAAjB;AACA4O,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAEhT,QADO;AAEvBiT,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAED7O,gBAAc,GAAG;AAChB,UAAM8U,SAAS,GAAGrW,QAAQ,CAACC,aAAT,CAAuB,KAAK6iC,UAA5B,CAAlB;AACA,UAAMpuB,SAAS,GAAG1U,QAAQ,CAACC,aAAT,CAAuB,KAAK4iC,UAA5B,CAAlB;AACA,UAAME,WAAW,GAAG,CAAC,EAAE1sB,SAAS,IAAIA,SAAS,CAAC/J,YAAzB,CAAD,IAA2C,CAAC,EAAEoI,SAAS,IAAIA,SAAS,CAACpI,YAAzB,CAAhE;AACA,UAAM+sB,YAAY,GAAG,CAAC,SAAD,EAAY,MAAZ,CAArB;AACA,UAAM;AAAExuB;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAM4S,WAAW,GAAG3S,IAAI,CAACC,UAAL,CAAgBqD,QAAhB,KAA6BkrB,YAAY,CAAC7oB,IAAb,CAAkBmnB,OAAO,IAAI9sB,IAAI,CAACO,QAAL,CAAcusB,OAAd,CAA7B,CAAjD;AAEA,UAAMqL,cAAc,GAAGhjC,QAAQ,CAACC,aAAT,CAAuB,KAAK0iC,uBAA5B,CAAvB;AAEA,WAAOnlB,WAAW,IAAIwlB,cAAf,IAAiC,CAACD,WAAzC;AACA;;AAED9hC,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EAA4DxC,GAA5D,CAAgEqH,EAAE,IAAIA,EAAE,CAACtM,YAAH,CAAgB,MAAhB,CAAtE,CAAd;AAEA,WAAO;AACNc,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAED5G,kBAAgB,GAAG;AAClB,WAAO,KAAKmzB,oBAAL,EAAP;AACA;;AAED/yB,YAAU,CAACgF,cAAD,EAAiB;AAC1B,UAAM;AAAEP,eAAF;AAAarB;AAAb,QAA+B4B,cAArC,CAD0B,CAE1B;;AACAP,aAAS,CAACQ,IAAV,CAAe,CAACC,CAAD,EAAIC,CAAJ,KAAUA,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAA7C;AAEA,QAAIqB,YAAY,GAAGhC,aAAnB;AACA,QAAIiC,eAAe,GAAG,CAAtB;AACA,UAAME,eAAe,GAAG,EAAxB;AAEA,WAAOpI,+CAAO,CAACuG,IAAR,CAAae,SAAb,EAAwBD,QAAQ,IACtC,KAAKtB,SAAL,CAAesB,QAAQ,CAACb,IAAxB,EACElC,IADF,CACO,MAAM,KAAKuG,eAAL,EADb,EAEEvG,IAFF,CAEO8G,YAAY,IAAI;AACrB,YAAMzE,UAAU,GAAG,KAAKT,UAAL,CAAgBkF,YAAhB,CAAnB;AACA,YAAMxE,aAAa,GAAGX,aAAa,GAAGU,UAAtC;AACApH,kDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBgH,YAAI,EAAEa,QAAQ,CAACb,IADU;AAEzBG,kBAFyB;AAGzBC;AAHyB,OAA1B;;AAKA,UAAID,UAAU,GAAGsB,YAAjB,EAA+B;AAC9B,aAAK08B,eAAL,GAAuBt9B,QAAQ,CAACb,IAAhC;AACA4B,uBAAe,CAACpB,IAAhB,CAAqBK,QAAQ,CAACb,IAA9B;AACA0B,uBAAe,GAAGtB,aAAlB;AACAqB,oBAAY,GAAGtB,UAAf;AACA,eAAO3G,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,aAAO,KAAKgH,UAAL,CAAgBI,QAAQ,CAACb,IAAzB,EAA+BlC,IAA/B,CAAoC,MAAM;AAChD,YAAI,KAAKmG,4BAAT,EAAuC;AACtC,iBAAOzK,+CAAO,CAACuG,IAAR,CAAa6B,eAAb,EAA8B5B,IAAI,IAAI,KAAKT,SAAL,CAAeS,IAAf,CAAtC,CAAP;AACA;;AACD,eAAOxG,+CAAO,CAACC,OAAR,EAAP;AACA,OALM,CAAP;AAMA,KAvBF,CADM,EAyBLqE,IAzBK,CAyBA,MACN,KAAK2C,UAAL,CAAgB,KAAK09B,eAArB,EAAsCrgC,IAAtC,CAA2C,MAC1C/E,4CAAG,CAACC,KAAJ,CAAU,oBAAV,EAAgC;AAC/ByD,WAAK,EAAEmF,eADwB;AAE/BzB,gBAAU,EAAEsB,YAFmB;AAG/BrB,mBAAa,EAAEsB;AAHgB,KAAhC,CADD,CA1BM,CAAP;AAkCA;;AAEDxF,kBAAgB,GAAG;AAClB;AACA,UAAMsiC,gBAAgB,GAAGt4B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,iBAA9B,CAAzB;AACAT,UAAM,CAAC+G,OAAP,CAAeC,YAAf,CACChH,MAAM,CAAC+G,OAAP,CAAeE,KADhB,EAECjH,MAAM,CAAC3K,QAAP,CAAgB6R,KAFjB,EAGCoxB,gBAAgB,GAAG,KAAKj7B,aAAR,GAAwB2C,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqB4G,KAArB,CAA2B,GAA3B,EAAgC,CAAhC,CAHzC;AAKA;;AAED5Q,YAAU,GAAG;AACZ,WAAO,KAAKmD,SAAL,CAAe,KAAK4+B,eAApB,CAAP;AACA;;AAED/O,sBAAoB,GAAG;AACtB;AACA,WAAO,IAAI51B,+CAAJ,CAAYC,OAAO,IAAI;AAC7B41B,YAAM,CAACC,OAAP,CAAeC,SAAf,CAAyBC,WAAzB,CAAqCC,GAAG,IAAIA,GAAG,CAACC,SAAJ,IAAiBj2B,OAAO,EAApE;AACA,aAAOk2B,UAAU,CAAC,MAAMl2B,OAAO,EAAd,EAAkB,KAAKu1B,0BAAL,GAAkC,IAApD,CAAjB;AACA,KAHM,CAAP;AAIA;;AAzHuD,CAAzD;AA4He;AACd/oB,MAAI,EAAE,QADQ;AAEd5M,QAAM,EAAE,YAFM;AAGdwR,kBAAgB,EAAEC,iEAAiB,CAACC,OAHtB;AAIdnE,QAJc;AAKdwC,iBAAe,EAAE,IALH;AAMdD,WAAS,EAAE;AANG,CAAf,E;;;;;;;;;;;;AC/IA;AAAA;AAAA;AAAA;AACA;AAEA,MAAMO,QAAQ,GAAG,uBAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMgb,cAAc,GAAG,wBAAvB;AAEA,MAAM;AAAE1mB;AAAF,IAAkB3F,6CAAxB;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAE+d;AAAF,IAAgBjH,mDAAtB;AAEA;;;;;;;;;;;;;;;AAeA,MAAMpB,IAAI,GAAG,CAAE,GAAEnK,QAAS,UAAb,EAAyB,GAAEA,QAAS,WAApC,EAAiD,GAAEA,QAAS,WAA5D,EAAwEnG,aAAxE,CAAb;;AACA,MAAMgK,QAAQ,GAAG,MAAMhS,QAAQ,CAACC,aAAT,CAAuB,kBAAvB,CAAvB;;AAEA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAK2I,YAAL,GAAoB,gCAApB;AACA,SAAKF,iBAAL,GAAyB,+BAAzB;AAEA,SAAK7D,cAAL,GAAsB,uFAAtB;AACA,SAAKE,kBAAL,GAA0BI,aAA1B;AACA,SAAKA,aAAL,GAAqBA,aAArB;AAEA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA,SAAKH,qBAAL,GAA6B;AAC5B,sBAAgB,mCADY;AAE5B,wBAAkB;AAFU,KAA7B;AAIA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAK6M,sBAAL,GAA8B,gBAA9B;AACA;;AAED1T,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B8G,YAAY,IAAI;AAClD,YAAM0O,OAAO,GAAGpV,cAAc,CAAC,KAAK8I,YAAN,EAAoBpC,YAApB,CAA9B;AACA,YAAMqgB,QAAQ,GAAG3R,OAAO,GAAGtV,WAAW,CAACsV,OAAD,CAAd,GAA0B,CAAlD;AACA,YAAMhE,YAAY,GAAGpR,cAAc,CAAC,KAAK4I,iBAAN,EAAyBlC,YAAzB,CAAnC;AACA,YAAM0gB,aAAa,GAAGhW,YAAY,GAAGtR,WAAW,CAACsR,YAAD,CAAX,IAA6B,CAAhC,GAAoC,CAAtE;AACA,YAAMpD,KAAK,GAAG,KAAKxM,UAAL,CAAgBkF,YAAhB,CAAd;AACA,aAAOsH,KAAK,GAAG+Y,QAAR,GAAmBK,aAA1B;AACA,KAPM,CAAP;AAQA;;AAED7kB,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAED6E,iBAAe,CAACM,UAAD,EAAa3C,OAAb,EAAsB4C,WAAtB,EAAmC;AACjD8W,aAAS,CAAC,OAAD,EAAU,YAAV,CAAT;AACA,WAAO,KAAK7W,YAAL,CAAkB,KAAlB,EAAyBF,UAAzB,EAAqC3C,OAArC,EAA8C4C,WAA9C,CAAP;AACA;;AAEDb,eAAa,GAAG;AACf,WAAOgJ,QAAQ,EAAf;AACA;;AA7CuD,CAAzD;AAgDe;AACdtH,MAAI,EAAE,OADQ;AAEd5M,QAAM,EAAE,WAFM;AAGduN,QAHc;AAId8nB,YAAU,EAAE,EAJE;;AAIE;AAChBvkB,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACCyN,IAAI,CAAC9H,IAAL,CAAUoI,GAAG,IAAI/N,IAAI,CAACC,UAAL,CAAgB8N,GAAhB,CAAjB,KACA5Y,QAAQ,CAACC,aAAT,CAAuBkpB,cAAvB,CADA,IAEA,CAACnpB,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,CAHF;AAKA,GAXa;;AAYdqP,kBAAgB,EAAE0C,QAAQ,KAAKzC,wDAAiB,CAACC,OAAvB,GAAiCD,wDAAiB,CAACsS;AAZ/D,CAAf,E;;;;;;;;;;;;AC7EA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAEpf;AAAF,IAAkB3F,6CAAxB;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;;AAeA,MAAMyW,aAAa,GAAG,wBAAtB;;AACA,MAAMlO,MAAM,GAAG,MAAMnL,QAAQ,CAACC,aAAT,CAAuB,wBAAvB,CAArB;;AAEA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,aAAtB;AACA,SAAK0I,YAAL,GAAoB,gCAApB;AACA,SAAKF,iBAAL,GAAyB,+BAAzB;AACA,SAAK2U,iBAAL,GAAyB,2DAAzB;AACA,SAAKrY,sBAAL,GAA8B,sDAA9B;AACA,SAAK8N,uBAAL,GAA+B,iBAA/B;AACA,SAAKC,oBAAL,GAA4B,cAA5B;AAEA,SAAKihB,OAAL,GAAgB,GAAExd,aAAc,gDAAhC;AAEA,SAAK3R,cAAL,GAAuB,GAAE,KAAKmvB,OAAQ,qBAAtC;AACA,SAAKlvB,eAAL,GAAwB,GAAE,KAAKkvB,OAAQ,6BAAvC;AACA,SAAKjvB,kBAAL,GAA2B,GAAE,KAAKivB,OAAQ,0BAA1C;AAEA,SAAKzuB,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,MAArC;AAEA,SAAKa,qBAAL,GAA6B;AAC5B,0BAAoB;AADQ,KAA7B;AAGA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKF,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAK/D,WAAL,GAAmB,IAAnB;AAEA,SAAKolB,cAAL,GAAsB,4BAAtB;AACA;;AAED5nB,gBAAc,GAAG;AAChB,UAAM2hC,WAAW,GAAGljC,QAAQ,CAACC,aAAT,CAAuB,KAAKkpB,cAA5B,CAApB;AACA,UAAM9Y,OAAO,GAAGrQ,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAAhB;AACA,WAAOmgC,WAAW,IAAI7yB,OAAf,IAA0B,KAAKlM,UAAL,EAAjC;AACA;;AAEDnD,kBAAgB,GAAG;AAClB,WAAO,CACN,GAAG,IAAIwE,GAAJ,CACF,CAAC,GAAGxF,QAAQ,CAACyF,gBAAT,CAA0B,KAAKkQ,uBAA/B,CAAJ,EACEtQ,GADF,CACMqH,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeG,KAAf,CAAqB,KAAKoV,oBAA1B,CADZ,EAEEnJ,MAFF,CAESE,OAFT,EAGEtH,GAHF,CAGM8yB,OAAO,IAAIA,OAAO,CAAC,CAAD,CAHxB,CADE,CADG,CAAP;AAQA;;AAEDt3B,YAAU,GAAG;AACZ,QAAIsK,MAAM,EAAV,EAAc;AACb;AACA;AACA;AACAR,YAAM,CAAC+G,OAAP,CAAeC,YAAf,CACChH,MAAM,CAAC+G,OAAP,CAAeE,KADhB,EAECjH,MAAM,CAAC3K,QAAP,CAAgB6R,KAFjB,EAGClH,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqB4G,KAArB,CAA2B,GAA3B,EAAgC,CAAhC,CAHD;AAKA,KAVW,CAWZ;;;AACA,WAAOxT,OAAO,CAACC,OAAR,EAAP;AACA;;AAEDkD,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4BwG,YAAY,IAAI;AAClD,YAAM4H,KAAK,GAAG,KAAKxM,UAAL,CAAgB4E,YAAhB,CAAd;AACA,YAAMgE,GAAG,GAAGtK,WAAW,CAACE,cAAc,CAAC,KAAK8I,YAAN,EAAoB1C,YAApB,CAAf,CAAvB;AACA,YAAM0mB,eAAe,GAAG9sB,cAAc,CAAC,KAAK4I,iBAAN,EAAyBxC,YAAzB,CAAtC;AACA,YAAM6D,QAAQ,GAAG,KAAKsc,IAAL,CAAUuG,eAAe,CAACpvB,WAA1B,IAAyCoC,WAAW,CAACgtB,eAAD,CAApD,GAAwE,CAAzF;AACA,YAAM0T,WAAW,GAAG,CAAC,GAAGxgC,cAAc,CAAC,KAAKud,iBAAN,EAAyBnX,YAAzB,EAAuC,IAAvC,CAAlB,EAClB1D,GADkB,CACd5C,WADc,EAElB2S,MAFkB,CAEX,CAACpP,CAAD,EAAIC,CAAJ,KAAUD,CAAC,GAAGC,CAFH,EAEM,CAFN,CAApB;AAIA,aAAO0K,KAAK,GAAG5D,GAAR,GAAcH,QAAd,GAAyBu2B,WAAhC;AACA,KAVM,CAAP;AAWA;;AA3EuD,CAAzD;AA8Ee;AACdz4B,MAAI,EAAE,QADQ;AAEd5M,QAAM,EAAE,YAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;AAKdiE,kBAAgB,EAAEC,wDAAiB,CAACC,OALtB;AAMd1B,iBAAe,EAAE3C,MAAM,KAAKR,MAAM,CAACC,QAAP,CAAgBC,IAArB,GAA6B,GAAEwO,aAAc,UANtD;AAOdxL,iBAAe,EAAE;AAPH,CAAf,E;;;;;;;;;;;;ACtGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAM;AAAEhR;AAAF,IAAcC,6CAApB;AAEA;;;;;;;;;;;;;;AAcA,MAAMuO,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AAEA,SAAKqL,QAAL,GAAgB,4EAAhB;AACA,SAAKzG,cAAL,GAAuB,GAAE,KAAKyG,QAAS,iBAAvC;AACA,SAAKxG,eAAL,GAAwB,GAAE,KAAKwG,QAAS,4BAAxC;AAEA,SAAKpK,WAAL,GAAmB,IAAnB;AAEA,SAAKhB,cAAL,GAAsB/C,QAAQ,CAACC,aAAT,CAAuB,gBAAvB,IAA2C,kBAA3C,GAAgE,cAAtF;AAEA,SAAK6H,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,MAA9B;AAEA,SAAK9E,uBAAL,GAA+B,0BAA/B;AACA,SAAKmgC,sBAAL,GAA8B,cAA9B;AACA,SAAK//B,oBAAL,GAA4B,gBAA5B;AACA,SAAKC,sBAAL,GAA8B,WAA9B;AAEA,SAAK2R,mBAAL,GAA2B,qBAA3B;AAEA,SAAKvM,4BAAL,GAAoC,IAApC;AAEA,SAAKtE,YAAL,GAAoB,IAApB;AAEA,SAAK8S,mBAAL,GAA2B,SAA3B;AACA;;AAEDzW,iBAAe,GAAG;AACjB,UAAM+gB,SAAS,GAAGxhB,QAAQ,CAACC,aAAT,CAAuB,KAAKgV,mBAA5B,CAAlB;AACA,SAAK7M,gBAAL,CAAsBhB,GAAtB,CAA0B,YAA1B,EAAwCoa,SAAS,GAAGA,SAAS,CAACrhB,KAAb,GAAqB,KAAtE;AACA,WAAOlC,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED+C,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKxC,uBAA/B,CAAJ,EACZwJ,MADY,CACLE,OADK,EAEZtH,GAFY,CAERqH,EAAE,IAAIA,EAAE,CAAC/G,SAAH,CAAanF,KAAb,CAAmB,KAAK0W,mBAAxB,EAA6C,CAA7C,CAFE,CAAd;AAGA,WAAO;AACNhW,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDvG,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAOjD,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKS,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B2E,QAAQ,IAAI;AACtC,WAAK9C,YAAL,GAAoB8C,QAApB;AACA,KAFD,CADM,CAAP;AAKA;;AAEDtG,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,CAAgB,KAAKC,YAArB,CAAxB,EAA4D;AACrEzF,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACA,UAAMK,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0B8gC,YAAY,IAAI;AACzC,YAAM1+B,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE;AAHD,OAAf;;AAKA,UAAIw+B,YAAY,CAACzF,KAAjB,EAAwB;AACvBj5B,cAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,eAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AACD,WAAKP,YAAL,GAAoBi/B,YAApB;AACA1+B,YAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgBk/B,YAAhB,CAApB;AACA1+B,YAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;;AACA,UAAID,MAAM,CAACC,UAAP,GAAoBV,aAAxB,EAAuC;AACtCK,wBAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AACD,aAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B+gC,cAAc,IAAI;AACnD,aAAKl/B,YAAL,GAAoBk/B,cAApB;AACA9lC,oDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B;AACA,OAHM,CAAP;AAIA,KApBD,CADM,EAsBLpC,IAtBK,CAsBA,MAAM;AACZ/E,kDAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,aAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,iBAAS,EAAEhB,gBAFa;AAGxBL;AAHwB,OAAzB;AAKA,aAAOjG,+CAAO,CAACC,OAAR,EAAP;AACA,KA7BM,CAAP;AA8BA;;AAED4C,YAAU,CAACgF,cAAD,EAAiB;AAC1B,UAAMvB,gBAAgB,GAAGuB,cAAc,CAACP,SAAxC;AACA,UAAM;AAAErB;AAAF,QAAoB4B,cAA1B,CAF0B,CAI1B;;AACAvB,oBAAgB,CAACwB,IAAjB,CAAsB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC/B,UAAIA,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAApB,KAAsC,CAA1C,EAA6C;AAC5C,eAAOoB,CAAC,CAACnB,SAAF,GAAckB,CAAC,CAAClB,SAAvB;AACA;;AACD,aAAOmB,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAA3B;AACA,KALD;AAOA,QAAIqB,YAAY,GAAGhC,aAAnB;AACA,QAAIiC,eAAe,GAAG,CAAtB;AACA,UAAME,eAAe,GAAG,EAAxB;AAEA,WAAOpI,+CAAO,CAACuG,IAAR,CAAaD,gBAAb,EAA+Be,QAAQ,IAC7C,KAAKtB,SAAL,CAAesB,QAAQ,CAACb,IAAxB,EAA8BlC,IAA9B,CAAmC8gC,YAAY,IAAI;AAClD,WAAKj/B,YAAL,GAAoBi/B,YAApB;AACA,YAAMz+B,UAAU,GAAG,KAAKT,UAAL,CAAgBk/B,YAAhB,CAAnB;AACA,YAAMx+B,aAAa,GAAGX,aAAa,GAAGU,UAAtC;AAEApH,kDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBgH,YAAI,EAAEa,QAAQ,CAACb,IADU;AAEzBG,kBAFyB;AAGzBC;AAHyB,OAA1B;;AAMA,UAAID,UAAU,GAAGsB,YAAjB,EAA+B;AAC9BG,uBAAe,CAACpB,IAAhB,CAAqBK,QAAQ,CAACb,IAA9B;AACA0B,uBAAe,GAAGtB,aAAlB;AACAqB,oBAAY,GAAGtB,UAAf;AACA,eAAO3G,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,aAAO,KAAKgH,UAAL,CAAgBI,QAAQ,CAACb,IAAzB,EAA+BlC,IAA/B,CAAoC+gC,cAAc,IAAI;AAC5D,aAAKl/B,YAAL,GAAoBk/B,cAApB;AACA,eAAOrlC,+CAAO,CAACuG,IAAR,CAAa6B,eAAb,EAA8B5B,IAAI,IAAI,KAAKT,SAAL,CAAeS,IAAf,CAAtC,CAAP;AACA,OAHM,CAAP;AAIA,KArBD,CADM,EAuBLlC,IAvBK,CAuBA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,oBAAV,EAAgC;AAC/ByD,WAAK,EAAEmF,eADwB;AAE/BzB,gBAAU,EAAEsB,YAFmB;AAG/BrB,mBAAa,EAAEsB;AAHgB,KAAhC,CAxBM,CAAP;AA8BA;;AAEDjB,YAAU,CAACT,IAAD,EAAO;AAChB,SAAK6D,iBAAL,CAAuBlB,GAAvB,CAA2B,MAA3B,EAAmC,KAAKm8B,mBAAL,CAAyB9+B,IAAzB,CAAnC;AACA,WAAO,MAAMS,UAAN,CAAiBT,IAAjB,CAAP;AACA;;AAED8+B,qBAAmB,CAAC9+B,IAAD,EAAO;AACzB,QAAIw5B,eAAe,GAAG,IAAtB;;AACA,QAAI,KAAK75B,YAAT,EAAuB;AACtB,YAAMo/B,YAAY,GAAG,KAAKp/B,YAAL,CAAkBuY,MAAlB,CAAyBpX,SAA9C;;AACA,WAAK,IAAIk+B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,YAAY,CAACl8B,MAAjC,EAAyCm8B,CAAC,EAA1C,EAA8C;AAC7C,cAAMC,WAAW,GAAGF,YAAY,CAACC,CAAD,CAAhC;;AACA,YAAIC,WAAW,IAAIA,WAAW,CAAC9K,UAAZ,KAA2Bn0B,IAA9C,EAAoD;AACnDw5B,yBAAe,GAAGuF,YAAY,CAACC,CAAD,CAAZ,CAAgBlpB,IAAlC;AACA;AACA;AACD;AACD,KATD,MASO;AACN,YAAMjU,aAAa,GAAG1G,KAAK,CAACygB,IAAN,CAAWrgB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKxC,uBAA/B,CAAX,CAAtB;AACA,YAAMsD,oBAAoB,GAAGD,aAAa,CAACE,IAAd,CAAmBd,OAAO,IAAI;AAC1D,cAAMe,YAAY,GAAGf,OAAO,CAACzF,aAAR,CAAsB,KAAKmjC,sBAA3B,CAArB;AACA,eAAO38B,YAAY,IAAIA,YAAY,CAACd,SAAb,CAAuBnF,KAAvB,CAA6B,SAA7B,EAAwC,CAAxC,MAA+CiE,IAAtE;AACA,OAH4B,CAA7B;;AAIA,UAAI8B,oBAAJ,EAA0B;AACzB03B,uBAAe,GAAG13B,oBAAoB,CACpCtG,aADgB,CACF,KAAKoD,oBADH,EAEhBjD,YAFgB,CAEH,KAAKkD,sBAFF,CAAlB;AAGA;AACD;;AACD,WAAO26B,eAAP;AACA;;AAED95B,YAAU,CAACiG,IAAD,EAAO;AAChB,QAAIA,IAAJ,EAAU;AACT,aAAOvN,OAAO,CAACuN,IAAI,CAACuS,MAAL,CAAYwhB,UAAb,CAAd;AACA;;AACD,WAAOthC,OAAO,CAACmD,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,EAA4C1C,WAA7C,CAAd;AACA;;AA5KuD,CAAzD;AA+Ke;AACdqK,MAAI,EAAE,YADQ;AAEd5M,QAAM,EAAE,eAFM;AAGduN,QAHc;AAIduC,WAAS,EAAE,IAJG;;AAKdxB,aAAW,GAAG;AACb,UAAMu3B,QAAQ,GAAG3jC,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAjB;AACA,WAAO0jC,QAAQ,GAAGA,QAAQ,CAACh+B,SAAT,CAAmByF,QAAnB,CAA4B,cAA5B,CAAH,GAAiD,KAAhE;AACA,GARa;;AASdwD,aAAW,GAAG;AACb,WAAO,CAAC,CAAC5O,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAT;AACA;;AAXa,CAAf,E;;;;;;;;;;;;ACpMA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM;AAAE0C;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AAEA,MAAM+Z,UAAU,GAAG,8BAAnB;AACA,MAAM7O,aAAa,GAAI,GAAE6O,UAAW,OAApC;AACA,MAAM1I,QAAQ,GAAI,GAAE0I,UAAW,sDAA/B;AAEA;;;;;;;;;;;;;;AAcA,MAAMxL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAK+E,sBAAL,GAA8B,iBAA9B;AACA,SAAK8D,UAAL,GAAkB,qBAAlB;AACA,SAAKi4B,qBAAL,GAA6B,qBAA7B;AACA,SAAKza,cAAL,GAAsB,mDAAtB;AACA,SAAK7U,mBAAL,GAA2B,aAA3B;AAEA,SAAK/I,iBAAL,GAAyB,+BAAzB;AACA,SAAKC,0BAAL,GAAkC,wCAAlC;AACA,SAAKC,YAAL,GAAoB,gCAApB;AAEA,SAAKyG,sBAAL,GAA8B,oBAA9B;AACA,SAAK2xB,kBAAL,GAA0B,iBAA1B;AAEA,SAAKn8B,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,yBAAnC;AACA,SAAKvG,kBAAL,GAA0B+C,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC9C,aAAhC,IACtB,GAAEmG,QAAS,0BADW,GAEtB,GAAEA,QAAS,kBAFf;AAIA,SAAKrG,qBAAL,GAA6B,uBAA7B;AACA,SAAKC,sBAAL,GAA8B,YAA9B;AAEA,SAAKK,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,CAAuBlB,GAAvB,CAA2B,kBAA3B,EAA+C,MAA/C;AACA6I,qDAAY,CAACC,UAAb;AACA;;AAED3O,gBAAc,GAAG;AAChB,UAAMuR,SAAS,GAAG9S,QAAQ,CAACC,aAAT,CAAuB,KAAKkpB,cAA5B,CAAlB;AACA,UAAM2a,iBAAiB,GAAG9jC,QAAQ,CAACC,aAAT,CAAuB,KAAKqU,mBAA5B,CAA1B;AACA,UAAMG,SAAS,GAAGzU,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAAlB;AACA,UAAMghC,aAAa,GAAGtvB,SAAS,GAAGA,SAAS,CAACpU,WAAV,CAAsB+K,QAAtB,CAA+B,GAA/B,CAAH,GAAyC,KAAxE;AACA,WAAO0H,SAAS,IAAI,CAACgxB,iBAAd,IAAmCC,aAA1C;AACA;;AAED/iC,kBAAgB,GAAG;AAClB,UAAMqwB,aAAa,GAAG,EAAtB;AACA,WAAO,KAAKxQ,QAAL,GAAgBte,IAAhB,CAAqB8G,YAAY,IAAI;AAC3C,YAAMkoB,YAAY,GAAGloB,YAAY,CAAC7I,KAAb,CAAmB,KAAKqjC,kBAAxB,CAArB;;AACA,UAAItS,YAAJ,EAAkB;AACjBF,qBAAa,CAACpsB,IAAd,CAAmBssB,YAAY,CAAC,CAAD,CAA/B;AACA;;AACD,YAAMyS,YAAY,GAAGhkC,QAAQ,CAACC,aAAT,CAAuB,KAAKiS,sBAA5B,CAArB;;AACA,UAAI8xB,YAAJ,EAAkB;AACjB3S,qBAAa,CAACpsB,IAAd,CAAmB++B,YAAY,CAAC3jC,WAAhC;AACA;;AACD,aAAOgxB,aAAP;AACA,KAVM,CAAP;AAWA;;AAEDpwB,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,EAAd;AACA,UAAMuO,WAAW,GAAGzP,QAAQ,CAACC,aAAT,CAAuB,KAAK4H,sBAA5B,CAApB;;AACA,QAAI4H,WAAW,IAAIA,WAAW,CAAC9J,SAAZ,CAAsBnF,KAAtB,CAA4B,KAAKmL,UAAjC,CAAnB,EAAiE;AAChEzK,WAAK,CAAC+D,IAAN,CAAWwK,WAAW,CAAC9J,SAAZ,CAAsBnF,KAAtB,CAA4B,KAAKmL,UAAjC,EAA6C,CAA7C,CAAX;AACA,KAFD,MAEO,IAAI3L,QAAQ,CAACC,aAAT,CAAuB,KAAK2jC,qBAA5B,CAAJ,EAAwD;AAC9D1iC,WAAK,CAAC+D,IAAN,CAAWjF,QAAQ,CAACC,aAAT,CAAuB,KAAK2jC,qBAA5B,EAAmDvjC,WAAnD,CAA+DuF,IAA/D,EAAX;AACA,KAFM,MAEA,IAAI6J,WAAW,IAAIA,WAAW,CAAC9J,SAAZ,CAAsByF,QAAtB,CAA+B,SAA/B,CAAnB,EAA8D;AACpElK,WAAK,CAAC+D,IAAN,CAAWwK,WAAW,CAACpP,WAAZ,CAAwBoR,KAAxB,CAA8B,GAA9B,EAAmC,CAAnC,CAAX;AACA;;AACD,WAAO;AACNvQ,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDlG,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0F,QAAQ,GAAGnK,WAAW,CAACE,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAAf,CAAX,IAAiE,CAAlF;AACA,YAAM2F,kBAAkB,GAAGlK,cAAc,CAAC,KAAK6I,0BAAN,EAAkCtE,QAAlC,CAAzC;AACA,YAAM4F,gBAAgB,GAAGD,kBAAkB,GAAGpK,WAAW,CAACoK,kBAAD,CAAX,IAAmC,CAAtC,GAA0C,CAArF;AACA,YAAME,GAAG,GAAGtK,WAAW,CAACE,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAAf,CAAX,IAA4D,CAAxE;AACA,aAAO,KAAK/C,UAAL,CAAgB+C,QAAhB,IAA4B0F,QAA5B,GAAuCG,GAAvC,GAA6CD,gBAApD;AACA,KANM,CAAP;AAOA;;AAED+T,UAAQ,GAAG;AACV,WAAOja,KAAK,CAAE,GAAEiQ,UAAW,GAAf,EAAmB;AAC9BvU,YAAM,EAAE,KADsB;AAE9B0E,iBAAW,EAAE;AAFiB,KAAnB,CAAL,CAGJzE,IAHI,CAGC2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAHb,CAAP;AAIA;;AAED6B,eAAa,GAAG;AACf,WAAO2B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,KAAK9C,aAArC,KAAuDhI,QAAQ,CAACC,aAAT,CAAuB,KAAKkD,kBAA5B,CAA9D;AACA;;AAxFuD,CAAzD;AA2Fe;AACduH,MAAI,EAAE,eADQ;AAEd5M,QAAM,EAAE,kBAFM;AAGduN,QAHc;AAIdwC,iBAAe,EAAE,IAJH;AAKdC,iBAAe,EACdnD,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,wBAA9B,KAA2DT,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,UAA9B,CAA3D,GACI,GAAE+C,QAAS,kBADf,GAEGxD,MAAM,CAACC,QAAP,CAAgBC;AARN,CAAf,E;;;;;;;;;;;;ACpHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA,MAAM;AAAEhO,SAAF;AAAW4F;AAAX,IAA2B3F,6CAAjC;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;;;;AAiBA,MAAMoF,aAAa,GAAG,0BAAtB;AACA,MAAM7E,kBAAkB,GAAG,yBAA3B;;AAEA,MAAMgI,MAAM,GAAG,MAAMR,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC9C,aAAhC,KAAkDhI,QAAQ,CAACC,aAAT,CAAuBkD,kBAAvB,CAAvE;;AAEA,MAAMkI,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,qFAAtB;AACA,SAAK8E,sBAAL,GAA8B,qBAA9B;AACA,SAAKo8B,gBAAL,GAAwB,8BAAxB;AACA,SAAK9a,cAAL,GAAsB,0CAAtB;AAEA,UAAMhb,QAAQ,GAAG,mEAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,wBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,yBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,wBAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKo8B,2BAAL,GAAmC,sBAAnC;AACA,SAAKnE,mBAAL,GAA2B,iBAA3B;AAEA,SAAK33B,gBAAL,GAAwB,IAAIC,eAAJ,CAAoB;AAC3CvL,YAAM,EAAE,MADmC;AAE3ColC,SAAG,EAAE,IAFsC;AAG3CiC,aAAO,EAAE,KAHkC;AAI3CC,aAAO,EAAE;AAJkC,KAApB,CAAxB;AAOA,SAAKrgC,WAAL,GAAmB,KAAnB;AACA,SAAKuE,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA6H,qDAAY,CAACC,UAAb;AACA;;AAED3O,gBAAc,GAAG;AAChB,UAAM8iC,SAAS,GAAGrkC,QAAQ,CAACC,aAAT,CAAwB,GAAE,KAAKgkC,gBAAiB,KAAI9gC,kBAAmB,EAAvE,CAAlB;AACA,UAAMkN,OAAO,GAAGrQ,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAAhB;AACA,UAAMwN,OAAO,GAAGvQ,QAAQ,CAACC,aAAT,CAAuB,KAAKkpB,cAA5B,CAAhB;AACA,WAAO5Y,OAAO,IAAI8zB,SAAX,IAAwBh0B,OAAxB,IAAmC,KAAKlM,UAAL,EAA1C;AACA;;AAEDpD,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAOjD,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAAI,KAAKS,UAAL,CAAgBT,IAAhB,CAA5B,EACLlC,IADK,CACA,MAAO,KAAKyG,aAAL,KAAuB,KAAKG,WAAL,EAAvB,GAA4C,KAAKL,eAAL,EADnD,EAELvG,IAFK,CAEA2E,QAAQ,IAAI,KAAK/C,UAAL,CAAgB+C,QAAhB,CAFZ,CAAP;AAGA;;AAEDtG,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2C;AACpDxF,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AAEA,WAAOjG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0BoG,iBAAiB,IAAI;AAC9C,YAAMhE,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdE,eAAO,EAAE,IAJK;AAKdy7B,oBAAY,EAAE;AALA,OAAf;AAOA77B,YAAM,CAACI,OAAP,GAAiB,CAAC4D,iBAAiB,CAAC65B,YAApC;;AAEA,UAAI,CAAC79B,MAAM,CAACI,OAAZ,EAAqB;AACpB,eAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AACD,YAAM8I,OAAO,GAAG,KAAKzE,aAAL,KAAuB,KAAKG,WAAL,EAAvB,GAA4C,KAAKL,eAAL,EAA5D;AACA,aAAO2E,OAAO,CAAClL,IAAR,CAAawG,YAAY,IAAI;AACnCpE,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB4E,YAAhB,CAApB;AACApE,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACAD,cAAM,CAAC67B,YAAP,GAAsBr1B,MAAM,KAAK,KAAKm5B,eAAL,CAAqBv7B,YAArB,CAAL,GAA0C,KAAtE;AACA,eAAO,KAAK7D,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,OALM,CAAP;AAMA,KApBD,CADM,CAAP;AAuBA;;AAEDvD,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM6F,GAAG,GAAGlQ,OAAO,CAACqK,QAAQ,CAAC6F,GAAV,CAAnB;AACA,YAAMH,QAAQ,GAAG/P,OAAO,CAACqK,QAAQ,CAACq9B,SAAT,CAAmB,CAAnB,EAAsBC,aAAvB,CAAxB;AACA,aAAO,KAAKrgC,UAAL,CAAgB+C,QAAhB,EAA0B,IAA1B,IAAkC6F,GAAlC,GAAwCH,QAA/C;AACA,KAJM,CAAP;AAKA;;AAED03B,iBAAe,CAACp9B,QAAD,EAAW;AACzB,UAAMu9B,mBAAmB,GAAG9hC,cAAc,CAAC,KAAKuhC,2BAAN,EAAmCh9B,QAAnC,CAA1C;AACA,WAAOyF,OAAO,CAAC83B,mBAAmB,IAAIA,mBAAmB,CAACpkC,WAApB,CAAgCG,KAAhC,CAAsC,KAAKu/B,mBAA3C,CAAxB,CAAd;AACA;;AAED76B,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDN,YAAU,CAACoD,IAAD,EAAOm9B,QAAQ,GAAG,KAAlB,EAAyB;AAClC,QAAKn9B,IAAI,IAAI,CAAC,KAAKyB,aAAL,EAAV,IAAmC07B,QAAvC,EAAiD;AAChD,aAAO7nC,OAAO,CAAC0K,IAAI,CAACoJ,KAAN,CAAd;AACA;;AACD,WAAOlO,WAAW,CAACE,cAAc,CAAC,KAAKI,cAAN,EAAsBwE,IAAtB,CAAf,CAAlB;AACA;;AAEDyB,eAAa,GAAG;AACf,WAAOmC,MAAM,EAAb;AACA;;AApGuD,CAAzD;AAuGe;AACdT,MAAI,EAAE,KADQ;AAEd5M,QAAM,EAAE,SAFM;AAGduN,QAHc;AAIdiE,kBAAgB,EAAEnE,MAAM,KAAKoE,wDAAiB,CAACC,OAAvB,GAAiCD,wDAAiB,CAACsS,OAJ7D;AAKdhU,iBAAe,EAAE;AALH,CAAf,E;;;;;;;;;;;;ACtIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAM;AAAElL;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AACA,MAAMuc,aAAa,GAAG,8BAAtB;AACA,MAAMrR,aAAa,GAAI,GAAEqR,aAAc,OAAvC;AACA,MAAMsrB,mBAAmB,GAAG,wBAA5B;;AACA,MAAM3wB,YAAY,GAAG,MACpBrJ,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC9C,aAAhC,KAAkD2E,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB0kC,mBAAvB,CAAD,CAD1D,C,CAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,MAAMt5B,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,UAAMuN,OAAO,GAAGrQ,QAAQ,CAACC,aAAT,CAAuB,2BAAvB,CAAhB;AACA,SAAK8C,cAAL,GAAsBsN,OAAO,GAAG,2BAAH,GAAiC,yCAA9D;AACA,SAAK9E,iBAAL,GAAyB,+BAAzB;AACA,SAAKE,YAAL,GAAoB,gCAApB;AACA,SAAK5D,sBAAL,GAA8B,oBAA9B;AACA,SAAK8N,uBAAL,GAA+B,2BAA/B;AACA,SAAK3S,qBAAL,GAA6B,oBAA7B;AACA,SAAKsI,mBAAL,GAA2B,2BAA3B;AACA,SAAK0E,qBAAL,GAA6B,aAA7B;AACA,SAAKjM,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,wEAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,kBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AACA;;AAED7G,gBAAc,GAAG;AAChB,UAAMgP,OAAO,GAAGvQ,QAAQ,CAACC,aAAT,CAAwB,GAAE,KAAKqL,mBAAoB,KAAIq5B,mBAAoB,EAA3E,CAAhB;AACA,UAAMt0B,OAAO,GAAGrQ,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,CAAhB;AACA,WAAOwN,OAAO,IAAIF,OAAlB;AACA;;AAEDrP,kBAAgB,GAAG;AAClB,UAAM4jC,gBAAgB,GAAG5kC,QAAQ,CAACC,aAAT,CAAuB,KAAK0V,uBAA5B,CAAzB;AACA,WAAOivB,gBAAgB,GAAG,CAACA,gBAAgB,CAACvkC,WAAlB,CAAH,GAAoC,EAA3D;AACA;;AAED6E,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAED7D,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CE,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjG3F,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACAvF,sDAAG,CAAC,wBAAD,EAA2B0F,kBAA3B,CAAH;AAEA,UAAME,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0BoG,iBAAiB,IAAI;AAC9C,YAAMhE,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE,CAJG;AAKdC,eAAO,EAAE;AALK,OAAf;;AAQA,UACC4D,iBAAiB,CAACk8B,MAAlB,KACCl8B,iBAAiB,CAACk8B,MAAlB,KAA6B,qBAA7B,IACAl8B,iBAAiB,CAACk8B,MAAlB,KAA6B,qBAF9B,CADD,EAIE;AACD;AACAlgC,cAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,eAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AAED,aAAO,KAAKmE,eAAL,GAAuBvG,IAAvB,CAA4BwG,YAAY,IAAI;AAClDpE,cAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB4E,YAAhB,CAApB;AACApE,cAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACAD,cAAM,CAACG,SAAP,GAAmB,KAAKR,eAAL,CAAqByE,YAArB,IAAqC1E,kBAAxD;AACAM,cAAM,CAACI,OAAP,GAAiB,IAAjB;;AAEA,YACCJ,MAAM,CAACC,UAAP,GAAoBV,aAApB,IACA;AACCS,cAAM,CAACC,UAAP,KAAsBV,aAAtB,IAAuCS,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDP,0BAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AAED,eAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,OAfM,CAAP;AAgBA,KAnCD,CADM,EAqCLpC,IArCK,CAqCA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,WAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,eAAS,EAAEhB,gBAFa;AAGxBL,mBAHwB;AAIxBG;AAJwB,KAAzB,CAtCM,CAAP;AA6CA;;AAEDjD,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0M,KAAK,GAAGjR,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAA5B;AACA,YAAM6F,GAAG,GAAG6G,KAAK,GAAGnR,WAAW,CAACmR,KAAD,CAAX,IAAsB,CAAzB,GAA6B,CAA9C;AACA,YAAMhH,QAAQ,GAAGnK,WAAW,CAACE,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAAf,CAAX,IAAiE,CAAlF;AACA,aAAO,KAAK/C,UAAL,CAAgB+C,QAAhB,IAA4B0F,QAA5B,GAAuCG,GAA9C;AACA,KALM,CAAP;AAMA;;AAED5I,YAAU,CAACO,IAAD,EAAO;AAChB,UAAM+P,SAAS,GAAGzU,QAAQ,CAACC,aAAT,CAAuB,2BAAvB,CAAlB;;AACA,QAAIyE,IAAI,IAAI,CAAC+P,SAAb,EAAwB;AACvB,WAAK1R,cAAL,GAAsB,2BAAtB;AACA;;AACD,WAAON,WAAW,CAACE,cAAc,CAAC,KAAKI,cAAN,EAAsB2B,IAAtB,CAAf,CAAlB;AACA;;AAEDsE,eAAa,GAAG;AACf,WAAOgL,YAAY,EAAnB;AACA;;AAjHuD,CAAzD;AAoHe;AACdtJ,MAAI,EAAE,QADQ;AAEd5M,QAAM,EAAE,YAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdi3B,0BAAwB,EAAE,IALZ;AAMdh3B,iBAAe,EAAEkG,YAAY,KAAKrJ,MAAM,CAACC,QAAP,CAAgBC,IAArB,GAA6B,GAAEwO,aAAc,WAN5D;AAOd/J,kBAAgB,EAAEC,wDAAiB,CAACC,OAPtB;AAQdnE;AARc,CAAf,E;;;;;;;;;;;;AC3IA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA,MAAM;AAAExO,SAAF;AAAW4F;AAAX,IAA2B3F,6CAAjC;AACA,MAAM;AAAE6F;AAAF,IAAqBC,0CAA3B;AAEA;;;;;;;;;;;;;;;AAeA,MAAMyI,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AAEA,SAAKqL,QAAL,GAAgB,6DAAhB;AACA,SAAKzG,cAAL,GAAuB,GAAE,KAAKyG,QAAS,iBAAvC;AACA,SAAKxG,eAAL,GAAwB,GAAE,KAAKwG,QAAS,4BAAxC;AAEA,SAAKpK,WAAL,GAAmB,IAAnB;AAEA,SAAKhB,cAAL,GAAsB,mBAAtB;AACA,SAAK+E,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,MAA9B;AAEA,SAAK9E,uBAAL,GAA+B,0BAA/B;AACA,SAAKmgC,sBAAL,GAA8B,cAA9B;AACA,SAAK//B,oBAAL,GAA4B,gBAA5B;AACA,SAAKC,sBAAL,GAA8B,WAA9B;AAEA,SAAK2R,mBAAL,GAA2B,qBAA3B;AACA,SAAKvM,4BAAL,GAAoC,IAApC;AACA,SAAKtE,YAAL,GAAoB,IAApB;AAEA,SAAK2gC,wBAAL,GAAgC,4BAAhC;AACA,SAAKC,sBAAL,GAA8B,uBAA9B;AACA,SAAKC,cAAL,GAAsB,OAAtB;AAEAh1B,qDAAY,CAACC,UAAb;AACA;;AAEDzP,iBAAe,GAAG;AACjB,UAAM+gB,SAAS,GAAGxhB,QAAQ,CAACC,aAAT,CAAuB,KAAKgV,mBAA5B,CAAlB;AACA,SAAK7M,gBAAL,CAAsBhB,GAAtB,CAA0B,YAA1B,EAAwCoa,SAAS,GAAGA,SAAS,CAACrhB,KAAb,GAAqB,KAAtE,EAFiB,CAGjB;;AACA,WAAOlC,+CAAO,CAACuP,KAAR,CAAc,IAAd,CAAP;AACA;;AAEDxP,aAAW,GAAG;AACb,UAAMoP,sBAAsB,GAAGpN,QAAQ,CAACC,aAAT,CAAuB,KAAK8kC,wBAA5B,CAA/B;;AACA,QAAI,CAAC33B,sBAAL,EAA6B;AAC5B,aAAO,IAAP;AACA;;AACD,WAAO;AACNE,sBAAgB,EAAG,IAAGF,sBAAsB,CAAChN,YAAvB,CAAoC,IAApC,CAA0C;AAD1D,KAAP;AAGA;;AAEDa,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAK29B,sBAA/B,CAAJ,EACZ32B,MADY,CACLE,OADK,EAEZtH,GAFY,CAERK,OAAO,IAAIA,OAAO,CAACC,SAAR,CAAkBnF,KAAlB,CAAwB,KAAKykC,cAA7B,EAA6C,CAA7C,CAFH,CAAd;AAGA,WAAO;AACN/jC,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDvG,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAOjD,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKS,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B2E,QAAQ,IAAI;AACtC,WAAK9C,YAAL,GAAoB8C,QAApB;AACA,KAFD,CADM,CAAP;AAKA;;AAEDtG,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,CAAgB,KAAKC,YAArB,CAAxB,EAA4D;AACrEzF,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACA,UAAMK,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAC9B,KAAKT,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0B8gC,YAAY,IAAI;AACzC,YAAM1+B,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE;AAHD,OAAf;;AAKA,UAAIw+B,YAAY,CAACzF,KAAjB,EAAwB;AACvBj5B,cAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,eAAOvH,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AACD,WAAKP,YAAL,GAAoBi/B,YAApB;AACA1+B,YAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgBk/B,YAAhB,CAApB;AACA1+B,YAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;;AACA,UAAID,MAAM,CAACC,UAAP,GAAoBV,aAAxB,EAAuC;AACtCK,wBAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AACD,aAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B+gC,cAAc,IAAI;AACnD,aAAKl/B,YAAL,GAAoBk/B,cAApB;AACA9lC,oDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B;AACA,OAHM,CAAP;AAIA,KApBD,CADM,EAsBLpC,IAtBK,CAsBA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,WAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,eAAS,EAAEhB,gBAFa;AAGxBL;AAHwB,KAAzB,CAvBM,CAAP;AA6BA;;AAEDpD,YAAU,CAACgF,cAAD,EAAiB;AAC1B,UAAMvB,gBAAgB,GAAGuB,cAAc,CAACP,SAAxC;AACA,UAAM;AAAErB;AAAF,QAAoB4B,cAA1B;AAEAvB,oBAAgB,CAACwB,IAAjB,CAAsB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC/B,UAAIA,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAApB,KAAsC,CAA1C,EAA6C;AAC5C,eAAOoB,CAAC,CAACnB,SAAF,GAAckB,CAAC,CAAClB,SAAvB;AACA;;AACD,aAAOmB,CAAC,CAACpB,aAAF,GAAkBmB,CAAC,CAACnB,aAA3B;AACA,KALD;AAOA,QAAIqB,YAAY,GAAGhC,aAAnB;AACA,QAAIiC,eAAe,GAAG,CAAtB;AACA,UAAME,eAAe,GAAG,EAAxB;AAEA,WAAOpI,+CAAO,CAACuG,IAAR,CAAaD,gBAAb,EAA+Be,QAAQ,IAC7C,KAAKtB,SAAL,CAAesB,QAAQ,CAACb,IAAxB,EAA8BlC,IAA9B,CAAmC8gC,YAAY,IAAI;AAClD,UAAIA,YAAY,CAACzF,KAAjB,EAAwB;AACvB,eAAO3/B,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,WAAKkG,YAAL,GAAoBi/B,YAApB;AACA,YAAMz+B,UAAU,GAAG,KAAKT,UAAL,CAAgBk/B,YAAhB,CAAnB;AACA,YAAMx+B,aAAa,GAAGX,aAAa,GAAGU,UAAtC;AAEApH,kDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBgH,YAAI,EAAEa,QAAQ,CAACb,IADU;AAEzBG,kBAFyB;AAGzBC;AAHyB,OAA1B;;AAMA,UAAID,UAAU,GAAGsB,YAAjB,EAA+B;AAC9BG,uBAAe,CAACpB,IAAhB,CAAqBK,QAAQ,CAACb,IAA9B;AACA0B,uBAAe,GAAGtB,aAAlB;AACAqB,oBAAY,GAAGtB,UAAf;AACA,eAAO3G,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,aAAO,KAAKgH,UAAL,CAAgBI,QAAQ,CAACb,IAAzB,EAA+BlC,IAA/B,CAAoC+gC,cAAc,IAAI;AAC5D,aAAKl/B,YAAL,GAAoBk/B,cAApB;AACA,eAAOrlC,+CAAO,CAACuG,IAAR,CAAa6B,eAAb,EAA8B5B,IAAI,IAAI,KAAKT,SAAL,CAAeS,IAAf,CAAtC,CAAP;AACA,OAHM,CAAP;AAIA,KAxBD,CADM,EA0BLlC,IA1BK,CA0BA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,oBAAV,EAAgC;AAC/ByD,WAAK,EAAEmF,eADwB;AAE/BzB,gBAAU,EAAEsB,YAFmB;AAG/BrB,mBAAa,EAAEsB;AAHgB,KAAhC,CA3BM,CAAP;AAiCA;;AAED,QAAMjB,UAAN,CAAiBT,IAAjB,EAAuB;AACtB,UAAMygC,UAAU,GAAG,MAAM,KAAK3B,mBAAL,CAAyB9+B,IAAzB,CAAzB;;AACA,QAAI,CAACygC,UAAL,EAAiB;AAChB,aAAO,IAAP;AACA;;AACD,SAAK58B,iBAAL,CAAuBlB,GAAvB,CAA2B,MAA3B,EAAmC89B,UAAnC;AACA,WAAO,MAAMhgC,UAAN,CAAiBT,IAAjB,CAAP;AACA;;AAEDrD,wBAAsB,CAAC+jC,KAAK,GAAG,KAAT,EAAgB;AACrC;AACA,WAAO,KAAKh8B,WAAL,GAAmB5G,IAAnB,CAAwB8G,YAAY,IAAI;AAC9C,YAAM+7B,YAAY,GAAGziC,cAAc,CAAC,KAAKI,cAAN,EAAsBsG,YAAtB,CAAnC;;AACA,UAAI,CAAC+7B,YAAD,IAAiB,CAACD,KAAtB,EAA6B;AAC5B,eAAO,KAAK/jC,sBAAL,CAA4B,IAA5B,CAAP;AACA;;AACD,aAAOqB,WAAW,CAAC2iC,YAAD,CAAlB;AACA,KANM,CAAP;AAOA;;AAED9nC,2BAAyB,GAAG;AAC3B,WAAO0C,QAAQ,CAACC,aAAT,CAAuB,KAAK+kC,sBAA5B,CAAP;AACA;;AAED/lC,aAAW,CAAClB,QAAD,EAAW;AACrB,UAAM0xB,eAAe,GAAGzvB,QAAQ,CAACC,aAAT,CAAuBlC,QAAQ,CAACuP,gBAAhC,CAAxB;;AACA,QAAImiB,eAAJ,EAAqB;AACpBzvB,cAAQ,CAACC,aAAT,CAAuBlC,QAAQ,CAACuP,gBAAhC,EAAkDC,KAAlD;AACA;;AACD,WAAOtP,+CAAO,CAACC,OAAR,EAAP;AACA;;AAEDqlC,qBAAmB,CAAC9+B,IAAD,EAAO;AACzB,QAAIw5B,eAAe,GAAG,IAAtB;;AACA,QAAI,KAAK75B,YAAT,EAAuB;AACtB,YAAMihC,QAAQ,GAAG,KAAKjhC,YAAL,CAAkBuY,MAAlB,CAAyBpX,SAAzB,CAAmCiB,IAAnC,CAAwC6O,IAAI,IAAIA,IAAI,CAACujB,UAAL,KAAoBn0B,IAApE,CAAjB;;AACA,UAAI4gC,QAAJ,EAAc;AACbpH,uBAAe,GAAGoH,QAAQ,CAAC9qB,IAA3B;AACA;AACD,KALD,MAKO;AACN,YAAMjU,aAAa,GAAG,CAAC,GAAGtG,QAAQ,CAACyF,gBAAT,CAA0B,KAAKxC,uBAA/B,CAAJ,CAAtB;AACA,YAAMsD,oBAAoB,GAAGD,aAAa,CAACE,IAAd,CAAmBd,OAAO,IAAI;AAC1D,cAAMe,YAAY,GAAGf,OAAO,CAACzF,aAAR,CAAsB,KAAKmjC,sBAA3B,CAArB;AACA,eAAO38B,YAAY,IAAIA,YAAY,CAACd,SAAb,CAAuBnF,KAAvB,CAA6B,KAAKykC,cAAlC,EAAkD,CAAlD,MAAyDxgC,IAAhF;AACA,OAH4B,CAA7B;;AAIA,UAAI8B,oBAAJ,EAA0B;AACzB03B,uBAAe,GAAG13B,oBAAoB,CACpCtG,aADgB,CACF,KAAKoD,oBADH,EAEhBjD,YAFgB,CAEH,KAAKkD,sBAFF,CAAlB;AAGA;AACD;;AACD,WAAO26B,eAAP;AACA;;AAED95B,YAAU,CAACiG,IAAD,EAAO;AAChB,QAAIA,IAAI,IAAIA,IAAI,CAACuS,MAAjB,EAAyB;AACxB,aAAO9f,OAAO,CAACuN,IAAI,CAACuS,MAAL,CAAY2oB,QAAb,CAAd;AACA;;AACD,WAAOzoC,OAAO,CAACmD,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,EAA4C1C,WAA7C,CAAd;AACA;;AAhNuD,CAAzD;AAmNe;AACdqK,MAAI,EAAE,MADQ;AAEd5M,QAAM,EAAE,aAFM;AAGduN,QAHc;AAIduC,WAAS,EAAE,IAJG;AAKdhP,iBAAe,EAAE,IALH;;AAMdwN,aAAW,GAAG;AACb,UAAMu3B,QAAQ,GAAG3jC,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAjB;AACA,WAAO0jC,QAAQ,GAAGA,QAAQ,CAACh+B,SAAT,CAAmByF,QAAnB,CAA4B,cAA5B,CAAH,GAAiD,KAAhE;AACA,GATa;;AAUdwD,aAAW,GAAG;AACb,WAAO,CAAC,CAAC5O,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAT;AACA,GAZa;;AAadslC,mBAAiB,EAAE;AAClBvG,WAAO,EAAE,0EADS;AAElBwG,wBAAoB,EAAE;AAFJ;AAbL,CAAf,E;;;;;;;;;;;;AC3OA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAE/iC;AAAF,IAAkB3F,6CAAxB;AACA,MAAM;AAAE4F,mBAAF;AAAqBC;AAArB,IAAwCC,0CAA9C;AAEA;;;;;;;;;;;;;;AAcA,MAAMyI,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,UAAM2iC,eAAe,GAAG/iC,iBAAiB,CAAC,wBAAD,CAAzC;AACA,UAAMgjC,gBAAgB,GAAGhjC,iBAAiB,CAAC,oBAAD,CAA1C,CAHa,CAKb;;AACA,SAAKK,cAAL,GAAsB,eAAtB;AACA,SAAK0Q,qBAAL,GAA6B,gBAA7B;AACA,SAAKhI,YAAL,GAAoB,aAApB;AACA,SAAKF,iBAAL,GAAyB,qBAAzB;AACA,SAAK2U,iBAAL,GAAyB,gBAAzB;AACA,SAAKnc,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,2CAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,UAAlC;AACA,SAAKxG,eAAL,GAAuB,KAAKD,cAA5B;AACA,SAAKE,kBAAL,GAA0BuG,QAA1B;AAEA,SAAKrG,qBAAL,GAA6B,2DAA7B;AACA,SAAKC,sBAAL,GAA8B,wDAA9B;;AAEA,QAAI09B,eAAJ,EAAqB;AACpB,WAAKr9B,gBAAL,GAAwBq9B,eAAe,CAAC1+B,MAAxC;AACA;;AACD,SAAKqB,gBAAL,CAAsBhB,GAAtB,CAA0B,uDAA1B,EAAmF,OAAnF;;AAEA,QAAIs+B,gBAAJ,EAAsB;AACrB,WAAKp9B,iBAAL,GAAyBo9B,gBAAgB,CAAC3+B,MAA1C;AACA;;AACD,SAAKuB,iBAAL,CAAuBlB,GAAvB,CAA2B,QAA3B,EAAqC,QAArC;AACA;;AAEDnG,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKgO,qBAA/B,CAAJ,EACZhH,MADY,CACLuL,IAAI,IAAIA,IAAI,CAAC2G,EAAL,KAAY,iBADf,EAEZtZ,GAFY,CAER2S,IAAI,IAAIA,IAAI,CAAC2G,EAFL,CAAd;AAIA,WAAO;AACNzd,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDlG,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0F,QAAQ,GAAGnK,WAAW,CAACE,cAAc,CAAC,KAAK4I,iBAAN,EAAyBrE,QAAzB,CAAf,CAA5B;AACA,YAAM6K,kBAAkB,GAAG3S,MAAM,CAAC6qB,KAAP,CAAard,QAAb,IAAyB,CAAzB,GAA6BA,QAAxD;AACA,YAAMG,GAAG,GAAGtK,WAAW,CAACE,cAAc,CAAC,KAAK8I,YAAN,EAAoBvE,QAApB,CAAf,CAAvB;AACA,YAAMoZ,QAAQ,GAAG7d,WAAW,CAACE,cAAc,CAAC,KAAKud,iBAAN,EAAyBhZ,QAAzB,CAAf,CAA5B;AACA,aAAO,KAAK/C,UAAL,CAAgB+C,QAAhB,IAA4B6K,kBAA5B,GAAiDhF,GAAjD,GAAuDuT,QAA9D;AACA,KANM,CAAP;AAOA;;AApDuD,CAAzD;AAuDe;AACd5V,MAAI,EAAE,cADQ;AAEd5M,QAAM,EAAE,iBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdulB,YAAU,EAAE,EAJE;AAKd9nB,QALc;;AAMduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACCA,IAAI,CAACC,UAAL,CAAgB,qCAAhB,KACAD,IAAI,CAACC,UAAL,CAAgB,kDAAhB,CAFD;AAIA,GAXa;;AAYdsB,aAAW,GAAG;AACb,WAAOpM,QAAQ,CAACC,aAAT,CAAuB,YAAvB,CAAP;AACA;;AAda,CAAf,E;;;;;;;;;;;;AC3EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAMyV,uBAAuB,GAAG,2BAAhC;AAEA;;;;;;;;;;AAUA,MAAMrK,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKkF,aAAL,GAAqB,4BAArB;AAEA,SAAKmG,QAAL,GAAgB,oEAAhB;AACA,SAAKzG,cAAL,GAAuB,GAAE,KAAKyG,QAAS,qBAAvC;AACA,SAAKvG,kBAAL,GAA2B,GAAE,KAAKuG,QAAS,kBAA3C;AAEA,SAAKw3B,uBAAL,GAA+B,aAA/B;AAEA,SAAK3iC,qBAAL,GAA6B,WAA7B;AAEA,SAAKoF,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AAEA,SAAKjE,kBAAL,GAA0B,kBAA1B;AAEA,SAAK2E,qBAAL,GAA6B,YAA7B;AAEA,SAAK/D,WAAL,GAAmB,IAAnB;AACA;;AAEDtD,iBAAe,GAAG;AACjB,SAAKmlC,aAAL,GAAqB5lC,QAAQ,CAACC,aAAT,CAAuByV,uBAAvB,CAArB;AAEA,WAAOzX,+CAAO,CAACC,OAAR,EAAP;AACA;;AAEDgH,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAED7D,YAAU,CAACM,KAAD,EAAQgD,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CE,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjG3F,sDAAG,CAAC,mBAAD,EAAsBuF,aAAtB,CAAH;AACAvF,sDAAG,CAAC,wBAAD,EAA2B0F,kBAA3B,CAAH;AAEA,UAAME,gBAAgB,GAAG,EAAzB;AACA,WAAOtG,+CAAO,CAACuG,IAAR,CAAatD,KAAb,EAAoBuD,IAAI,IAAI;AAClC,YAAME,MAAM,GAAG;AACdF,YADc;AAEdG,kBAAU,EAAEV,aAFE;AAGdW,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE,CAJG;AAKdC,eAAO,EAAE;AALK,OAAf;AAOA,aAAO,KAAKf,SAAL,CAAeS,IAAf,EAAqBlC,IAArB,CAA0BoG,iBAAiB,IAAI;AACrD,YAAIA,iBAAiB,CAACmN,OAAtB,EAA+B;AAC9BnR,gBAAM,CAACI,OAAP,GAAiB,IAAjB;AACA;;AAED,cAAM6D,YAAY,GAAG,KAAKC,iBAAL,CAAuBF,iBAAvB,CAArB;;AAEA,YAAIC,YAAY,KAAK,IAAjB,IAAyBA,YAAY,KAAK,KAAKH,oCAAnD,EAAyF;AACxF;AACA,iBAAOjL,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAP;AACA;;AAED,eAAO,KAAKmE,eAAL,GAAuBvG,IAAvB,CAA4BwG,YAAY,IAAI;AAClDpE,gBAAM,CAACC,UAAP,GAAoB,KAAKT,UAAL,CAAgB4E,YAAhB,CAApB;AACApE,gBAAM,CAACE,aAAP,GAAuBX,aAAa,GAAGS,MAAM,CAACC,UAA9C;AACAD,gBAAM,CAACG,SAAP,GAAmB,KAAKR,eAAL,CAAqByE,YAArB,IAAqC1E,kBAAxD;;AAEA,cACCM,MAAM,CAACC,UAAP,GAAoBV,aAApB,IACA;AACCS,gBAAM,CAACC,UAAP,KAAsBV,aAAtB,IAAuCS,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDP,4BAAgB,CAACU,IAAjB,CAAsBN,MAAtB;AACA;;AAED,iBAAO,KAAKO,UAAL,CAAgBT,IAAhB,EAAsBlC,IAAtB,CAA2B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BkH,MAA1B,CAAjC,CAAP;AACA,SAdM,CAAP;AAeA,OA3BM,CAAP;AA4BA,KApCM,EAoCJpC,IApCI,CAoCC,MAAM;AACb,UAAI,KAAKwB,WAAT,EAAsB;AACrBvG,oDAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,eAAK,EAAEqD,gBAAgB,CAACc,GAAjB,CAAqBC,QAAQ,IAAIA,QAAQ,CAACb,IAA1C,CADiB;AAExBc,mBAAS,EAAEhB,gBAFa;AAGxBL,uBAHwB;AAIxBG;AAJwB,SAAzB;AAMA;;AACD,aAAOpG,+CAAO,CAACC,OAAR,EAAP;AACA,KA9CM,CAAP;AA+CA;;AAED8K,eAAa,GAAG;AACf,WAAO2B,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,CAAgC,KAAK9C,aAArC,KAAuDhI,QAAQ,CAACC,aAAT,CAAuB,KAAKkD,kBAA5B,CAA9D;AACA;;AAxFuD,CAAzD;AA2Fe;AACduH,MAAI,EAAE,OADQ;AAEd5M,QAAM,EAAE,WAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;AAKdiE,kBAAgB,EAAEC,wDAAiB,CAACC,OALtB;;AAMdpD,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAD,CAAd;AACA,GARa;;AASd2O,aAAW,GAAG;AACb;AACA,WAAO5O,QAAQ,CAACC,aAAT,CAAuB,wBAAvB,KAAoDD,QAAQ,CAACC,aAAT,CAAuByV,uBAAvB,CAA3D;AACA;;AAZa,CAAf,E;;;;;;;;;;;;AC5GA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM;AAAE/S;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AAEA;;;;;;;;;;;;;;;;AAgBA,MAAM+oC,eAAe,GAAG,gCAAxB;AACA,MAAM79B,aAAa,GAAI,GAAE69B,eAAgB,MAAzC;AAEA,MAAMx6B,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,4BAAtB;AACA,SAAK8E,sBAAL,GAA8B,6CAA9B;AACA,SAAKi+B,oBAAL,GAA4B,6BAA5B;AACA,SAAK/hC,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAI,GAAE03B,eAAgB,qDAApC;AACA,SAAKn+B,cAAL,GAAuB,GAAEyG,QAAS,qBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,yBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,6BAAtC;AAEA,SAAKnG,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAK8G,kBAAL,GAA0B,0BAA1B;AAEA,SAAKovB,cAAL,GAAsB,8BAAtB;AACA,SAAKyI,WAAL,GAAmB,cAAnB;AAEA,SAAKl6B,mBAAL,GAA2B,oBAA3B;AACA;;AAEDtK,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAMuB,UAAU,GAAGtB,IAAI,CAACO,QAAL,CAAc,OAAd,KAA0BP,IAAI,CAACO,QAAL,CAAc,cAAd,CAA7C;AACA,UAAM46B,YAAY,GAAGhmC,QAAQ,CAACC,aAAT,CAAuB,KAAK6lC,oBAA5B,CAArB;AACA,UAAM15B,WAAW,GAAGpM,QAAQ,CAACC,aAAT,CAAuB,KAAK4L,mBAA5B,CAApB;AACA,WAAOM,UAAU,IAAI65B,YAAd,IAA8B,CAAC55B,WAAtC;AACA;;AAEDpL,kBAAgB,GAAG;AAClB,WAAO4F,KAAK,CAACi/B,eAAD,CAAL,CACLtjC,IADK,CACAyW,GAAG,IAAIA,GAAG,CAAC7R,IAAJ,EADP,EAEL5E,IAFK,CAEAmC,IAAI,IAAI;AACb,aAAO,CACN,GAAG,IAAIc,GAAJ,CACF,CAAC,GAAG7C,cAAc,CAAC,KAAK26B,cAAN,EAAsB54B,IAAtB,EAA4B,IAA5B,CAAlB,EACEW,GADF,CACMgQ,IAAI,IAAIA,IAAI,CAAChV,WAAL,CAAiBG,KAAjB,CAAuB,KAAKulC,WAA5B,CADd,EAEEt5B,MAFF,CAESE,OAFT,EAGEtH,GAHF,CAGMqH,EAAE,IAAIA,EAAE,CAAC,CAAD,CAHd,CADE,CADG,CAAP;AAQA,KAXK,CAAP;AAYA;;AAEDzL,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EACZxC,GADY,CACRqH,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeG,KAAf,CAAqB,KAAK0N,kBAA1B,EAA8C,CAA9C,CADE,EAEZzB,MAFY,CAELE,OAFK,CAAd;AAIA,WAAO;AACNzL,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDlG,wBAAsB,GAAG;AACxB,WAAO,KAAK0H,eAAL,GAAuBvG,IAAvB,CAA4B2E,QAAQ,IAAI;AAC9C,YAAM0F,QAAQ,GAAG,KAAKylB,iBAAL,CAAuBnrB,QAAvB,EAAiC,UAAjC,CAAjB;;AACA,YAAM6F,GAAG,GAAG,KAAKslB,iBAAL,CAAuBnrB,QAAvB,EAAiC,WAAjC,CAAZ;;AACA,YAAM4F,gBAAgB,GAAG,KAAKulB,iBAAL,CAAuBnrB,QAAvB,EAAiC,mBAAjC,CAAzB;;AAEA,aAAO,KAAK/C,UAAL,CAAgB+C,QAAhB,IAA4B0F,QAA5B,GAAuCE,gBAAvC,GAA0DC,GAAjE;AACA,KANM,CAAP;AAOA;;AAEDslB,mBAAiB,CAACnrB,QAAD,EAAWorB,KAAX,EAAkB;AAClC,UAAM5sB,OAAO,GAAG,CAAC,GAAG/C,cAAc,CAAC,IAAD,EAAOuE,QAAP,EAAiB,IAAjB,CAAlB,EAA0CV,IAA1C,CAA+CkG,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAe+K,QAAf,CAAwBknB,KAAxB,CAArD,CAAhB;AACA,WAAO5sB,OAAO,GAAGjD,WAAW,CAACiD,OAAO,CAACiJ,kBAAT,CAAd,GAA6C,CAA3D;AACA;;AAED3K,WAAS,CAACS,IAAD,EAAO;AACf,SAAK2D,gBAAL,CAAsBhB,GAAtB,CAA0B,KAAKU,qBAA/B,EAAsDrD,IAAtD;AAEA,WAAO,KAAKkF,gBAAL,CAAsB,KAAKjC,cAA3B,EAA2C,KAAKO,qBAAhD,EAAuE,IAAvE,EAA6E,KAAKG,gBAAlF,CAAP;AACA;;AAEDlD,YAAU,CAACT,IAAD,EAAO;AAChB,QAAI,KAAKsD,sBAAT,EAAiC;AAChC,WAAKO,iBAAL,CAAuBlB,GAAvB,CAA2B,KAAKW,sBAAhC,EAAwDtD,IAAxD;AACA;;AAED,WAAO,KAAKkF,gBAAL,CAAsB,KAAKhC,eAA3B,EAA4C,KAAKO,sBAAjD,EAAyE,IAAzE,EAA+E,KAAKI,iBAApF,CAAP;AACA;;AAtFuD,CAAzD;AAyFe;AACdoC,MAAI,EAAE,gBADQ;AAEd5M,QAAM,EAAE,mBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdC,iBAAe,EAAE,IAJH;AAKdxC;AALc,CAAf,E;;;;;;;;;;;;AClHA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AAaA,MAAM8C,QAAQ,GAAG,8BAAjB;AACA,MAAMnG,aAAa,GAAI,GAAEmG,QAAS,OAAlC;AACA,MAAMsmB,WAAW,GAAI,GAAEtmB,QAAS,UAAhC;AACA,MAAM83B,gBAAgB,GAAI,GAAE93B,QAAS,eAArC;AACA,MAAMnD,gBAAgB,GAAI,GAAEmD,QAAS,yDAArC;AACA,MAAM+3B,eAAe,GAAI,GAAEl7B,gBAAiB,kBAA5C;AAEA,MAAMK,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,2BAAtB;AACA,SAAKG,mBAAL,GAA2B,+BAA3B;AACA,SAAKa,WAAL,GAAmB,IAAnB;AAEA,SAAK2D,cAAL,GAAuB,GAAEsD,gBAAiB,qBAA1C;AACA,SAAKrD,eAAL,GAAwB,GAAEqD,gBAAiB,6BAA3C;AACA,SAAKpD,kBAAL,GAA2B,GAAEoD,gBAAiB,0BAA9C;AAEA,SAAKhD,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA,SAAKmD,iBAAL,GAAyB,iCAAzB;AACA,SAAKC,0BAAL,GAAkC,0CAAlC;AACA,SAAKC,YAAL,GAAoB,kCAApB;AACA,SAAK5D,sBAAL,GAA8B,cAA9B;AACA;;AAED3C,YAAU,CAACT,IAAD,EAAO;AAChB,WAAO,KAAK8E,gBAAL,CAAsB9E,IAAtB,CAAP;AACA;;AAEDrD,wBAAsB,GAAG;AACxB,WAAO,KAAKiO,eAAL,GAAuB9M,IAAvB,CAA4B8G,YAAY,IAAI;AAClD,YAAMsH,KAAK,GAAG,KAAKxM,UAAL,CAAgBkF,YAAhB,CAAd;AACA,YAAMyD,gBAAgB,GAAGnK,iEAAc,CAAC,KAAK6I,0BAAN,EAAkCnC,YAAlC,CAAd,IAAiE,CAA1F;AACA,YAAMuD,QAAQ,GAAG+H,8DAAW,CAAC,KAAKpJ,iBAAN,EAAyBlC,YAAzB,CAA5B;AACA,YAAM0D,GAAG,GAAG4H,8DAAW,CAAC,KAAKlJ,YAAN,EAAoBpC,YAApB,CAAvB;AAEA,YAAM88B,0BAA0B,GAAGr5B,gBAAgB,KAAK,CAArB,GAAyBA,gBAAgB,CAACzM,WAA1C,GAAwD,CAA3F;AACA,YAAM0R,kBAAkB,GAAGnF,QAAQ,CAACnC,WAAT,GAAuBW,QAAvB,CAAgC,MAAhC,IAA0C,CAA1C,GAA8CwB,QAAzE;AACA,YAAMqL,aAAa,GAAGlL,GAAG,CAACnH,IAAJ,GAAWwF,QAAX,CAAoB,KAApB,IAA6B,CAA7B,GAAiC2B,GAAvD;AAEA,aAAO4D,KAAK,GAAG9T,6DAAO,CAACkV,kBAAD,CAAf,GAAsClV,6DAAO,CAACob,aAAD,CAA7C,GAA+Dpb,6DAAO,CAACspC,0BAAD,CAA7E;AACA,KAXM,CAAP;AAYA;;AAED92B,iBAAe,GAAG;AACjB,WAAOzI,KAAK,CAAC+D,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,iBAA9B,IAAmDpD,aAAnD,GAAmE2C,MAAM,CAACC,QAAP,CAAgBC,IAApF,EAA0F;AACrGvI,YAAM,EAAE,KAD6F;AAErG0E,iBAAW,EAAE;AAFwF,KAA1F,CAAL,CAGJzE,IAHI,CAGC8G,YAAY,IAAIA,YAAY,CAAClC,IAAb,EAHjB,CAAP;AAIA;;AAhDuD,CAAzD;AAmDe;AACduD,MAAI,EAAE,eADQ;AAEd5M,QAAM,EAAE,kBAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;AAKdiE,kBAAgB,EAAEC,wDAAiB,CAACC,OALtB;AAMd1B,iBAAe,EAAEnD,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,iBAA9B,IAAmDpD,aAAnD,GAAmE2C,MAAM,CAACC,QAAP,CAAgBC,IANtF;;AAOd+D,aAAW,CAAC/D,IAAD,EAAO;AACjB,WACC,CAACA,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KACA6C,IAAI,CAACC,UAAL,CAAgB2pB,WAAhB,CADA,IAEA5pB,IAAI,CAACC,UAAL,CAAgBm7B,gBAAhB,CAFA,IAGAp7B,IAAI,CAACC,UAAL,CAAgBo7B,eAAhB,CAHD,KAIAlmC,QAAQ,CAACC,aAAT,CAAuB,mDAAvB,CALD;AAOA,GAfa;;AAgBdmM,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,kBAAvB,CAAD,CAAd;AACA;;AAlBa,CAAf,E;;;;;;;;;;;;AC5EA;AAAA;AAAA;AAEA,MAAMoL,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKqL,QAAL,GAAgB,+EAAhB;AAEA,SAAKzG,cAAL,GAAuB,GAAE,KAAKyG,QAAS,iBAAvC;AACA,SAAKxG,eAAL,GAAwB,GAAE,KAAKwG,QAAS,oBAAxC;AACA,SAAKvG,kBAAL,GAA2B,GAAE,KAAKuG,QAAS,0BAA3C;AAEA,SAAKpG,sBAAL,GAA8B,KAAKD,qBAAnC;AAEA,SAAKM,gBAAL,CAAsBhB,GAAtB,CAA0B,QAA1B,EAAoC,MAApC;AACA,SAAKkB,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA,SAAKrE,WAAL,GAAmB,IAAnB;AACA;;AAED9C,kBAAgB,GAAG;AAClB,QAAIC,KAAK,GAAG,EAAZ;;AACA,QAAIyJ,MAAM,CAACC,QAAP,CAAgBwL,QAAhB,CAAyBhL,QAAzB,CAAkC,OAAlC,CAAJ,EAAgD;AAC/ClK,WAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKvC,mBAA/B,CAAJ,EAAyDmC,GAAzD,CAA6D2S,IAAI,IAAIA,IAAI,CAACrS,SAAL,CAAeC,IAAf,EAArE,CAAR;AACA,KAFD,MAEO;AACN,YAAMU,aAAa,GAAG,CAAC,GAAGtG,QAAQ,CAACyF,gBAAT,CAA0B,mBAA1B,CAAJ,EAAoDJ,GAApD,CAAwDqH,EAAE,IAC/EA,EAAE,CAACtM,YAAH,CAAgB,iBAAhB,CADqB,CAAtB;AAGAc,WAAK,GAAG,CAAC,GAAG,IAAIsE,GAAJ,CAAQc,aAAR,CAAJ,CAAR;AACA;;AAED,WAAO;AACNpF,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAhCuD,CAAzD;AAmCe;AACdoD,MAAI,EAAE,WADQ;AAEd5M,QAAM,EAAE,eAFM;AAGd8P,WAAS,EAAE,IAHG;AAIdvC,QAJc;;AAKduD,aAAW,CAAC/D,IAAD,EAAO;AACjB,WAAOA,IAAI,CAACC,UAAL,CAAgB,sCAAhB,KAA2DD,IAAI,CAACO,QAAL,CAAc,SAAd,CAAlE;AACA,GAPa;;AAQdgB,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,aAAvB,CAAD,CAAd;AACA;;AAVa,CAAf,E;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAM;AAAE+7B;AAAF,IAAWtiB,mDAAjB;AACA,MAAM;AAAE/W,gBAAF;AAAkByjC,mBAAlB;AAAqCxlB;AAArC,IAAkDhe,0CAAxD;AACA,MAAM;AAAEH;AAAF,IAAkB3F,6CAAxB;AAEA;;;;;;;;;;;;;;;;;AAiBA,MAAMqR,QAAQ,GAAG,6BAAjB;AACA,MAAMnD,gBAAgB,GAAI,GAAEmD,QAAS,qDAArC;;AAEA,MAAMoG,YAAY,GAAG,MAAM5J,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBO,QAArB,CAA8B,UAA9B,CAA3B;;AAEA,MAAMC,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKvD,oBAAL,GAA4B;AAC3BC,cAAQ,EAAE;AADiB,KAA5B;AAGA,SAAKuD,cAAL,GAAsB,KAAKxD,oBAAL,CAA0BC,QAAhD;AACA,SAAK8L,mBAAL,GAA2B,mDAA3B;AACA,SAAK+6B,uBAAL,GAA+B,+BAA/B;AAEA,SAAKpxB,mBAAL,GAA2B,qBAA3B;AAEA,SAAKjN,aAAL,GAAsB,GAAEmG,QAAS,OAAjC;AACA,SAAKzG,cAAL,GAAuB,GAAEsD,gBAAiB,kBAA1C;AACA,SAAKrD,eAAL,GAAwB,GAAEqD,gBAAiB,kBAA3C;AACA,SAAKpD,kBAAL,GAA2B,GAAEoD,gBAAiB,0BAA9C;AAEA,SAAKlD,qBAAL,GAA6B,uBAA7B;AACA,SAAKC,sBAAL,GAA8B,oCAA9B;AAEA,SAAKu+B,wBAAL,GAAgC,gBAAhC;AAEA,SAAKtlB,4BAAL,GAAoC,aAApC;AACA,SAAKC,2BAAL,GAAmC,2BAAnC;AAEA,SAAKkJ,gBAAL,GAAyB,GAAEhc,QAAS,iBAApC;AACA,SAAK+D,sBAAL,GAA8B,gCAA9B;AAEA,SAAKmL,kBAAL,GAA0B,yBAA1B;AACA,SAAKC,uBAAL,GAA+B,wBAA/B;AACA,SAAK9R,0BAAL,GAAkC,iCAAlC;AAEA,SAAKvD,qBAAL,GAA6B;AAC5B,sBAAgB,mCADY;AAE5B,mCAA6B;AAFD,KAA7B;AAIA,SAAKC,sBAAL,GAA8B,KAAKD,qBAAnC;AACA,SAAKE,sBAAL,GAA8B,KAAKF,qBAAnC;AAEA,SAAKs+B,eAAL,GAAuB,KAAvB;AACA;;AAEDllC,iBAAe,GAAG;AACjB,QAAIq0B,SAAS,CAACD,aAAd,EAA6B;AAC5B+Q,kBAAY,CAACC,OAAb,CAAqB,mBAArB,EAA0C,OAA1C;AACA;;AACD,UAAMtpC,QAAQ,GAAG,MAAMkE,eAAN,EAAjB;AAEA4O,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAEhT,QADO;AAEvBiT,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAED7O,gBAAc,GAAG;AAChB,UAAM;AAAEsJ;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAM87B,SAAS,GAAGhR,SAAS,CAACD,aAA5B;AACA,UAAMtpB,UAAU,GACftB,IAAI,CAACO,QAAL,CAAc,OAAd,KACAP,IAAI,CAACO,QAAL,CAAc,kBAAd,CADA,IAEAP,IAAI,CAACO,QAAL,CAAc,WAAd,CAFA,IAGAP,IAAI,CAACO,QAAL,CAAc,WAAd,CAJD;AAKA,UAAMuF,KAAK,GAAG,CAAC3Q,QAAQ,CAACC,aAAT,CAAuB,KAAK8C,cAA5B,KAA+C,EAAhD,EAAoDuJ,YAAlE;AACA,UAAMkH,WAAW,GAAGxT,QAAQ,CAACC,aAAT,CAAuB,KAAKqL,mBAA5B,CAApB;;AACA,QAAI,CAAC,KAAKi7B,eAAN,IAAyBG,SAA7B,EAAwC;AACvC,WAAKH,eAAL,GAAuB,IAAvB;AACAH,uBAAiB,CAAE;sCACgB,KAAKC,uBAAwB;;KAD/C,CAAjB;AAIA;;AACD,WACCK,SAAS,KAAKv6B,UAAU,IAAIwE,KAAnB,CAAT,IAAsC6C,WAAtC,IAAqDgzB,YAAY,CAACG,OAAb,CAAqB,mBAArB,MAA8C,OADpG;AAGA;;AAEDlmC,iBAAe,GAAG;AACjB,UAAM+gB,SAAS,GAAGxhB,QAAQ,CAACC,aAAT,CAAuB,KAAKgV,mBAA5B,CAAlB;AACA,SAAK7M,gBAAL,CAAsBhB,GAAtB,CAA0B,YAA1B,EAAwCoa,SAAS,GAAGA,SAAS,CAACrhB,KAAb,GAAqB,KAAtE;AACA,SAAKmI,iBAAL,CAAuBlB,GAAvB,CAA2B,YAA3B,EAAyCoa,SAAS,GAAGA,SAAS,CAACrhB,KAAb,GAAqB,KAAvE;AACA,WAAOlC,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED2C,YAAU,CAACK,KAAD,EAAQ;AACjB,WAAOqT,YAAY,KAAK,KAAKkN,iBAAL,CAAuBvgB,KAAK,CAAC,CAAD,CAA5B,CAAL,GAAwC,KAAK8C,SAAL,CAAe9C,KAAK,CAAC,CAAD,CAApB,CAA3D;AACA;;AAEDH,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAOqT,YAAY,KAAK,KAAKqyB,kBAAL,EAAL,GAAiC,KAAK1hC,UAAL,CAAgBhE,KAAK,CAAC,CAAD,CAArB,CAApD;AACA;;AAEDF,kBAAgB,GAAG;AAClB,WAAO4F,KAAK,CAAC,KAAKujB,gBAAN,EAAwB;AACnC7nB,YAAM,EAAE;AAD2B,KAAxB,CAAL,CAGLC,IAHK,CAGA2E,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAHZ,EAIL5E,IAJK,CAIA8G,YAAY,IAAI,CACrB,GAAG,IAAI7D,GAAJ,CACF,CAAC,GAAG7C,cAAc,CAAC,KAAKuP,sBAAN,EAA8B7I,YAA9B,EAA4C,IAA5C,CAAlB,EACEhE,GADF,CACMqH,EAAE,IAAIA,EAAE,CAACrM,WADf,EAEEoM,MAFF,CAESC,EAAE,IAAIC,OAAO,CAACD,EAAD,CAAP,IAAeA,EAAE,CAACjC,WAAH,OAAqB,gBAFnD,CADE,CADkB,CAJhB,CAAP;AAWA;;AAEDzG,WAAS,CAACS,IAAD,EAAO;AACf,SAAK2D,gBAAL,CAAsBhB,GAAtB,CAA0B,sBAA1B,EAAkD,sBAAlD;AACA,SAAKgB,gBAAL,CAAsBhB,GAAtB,CAA0B,KAAKU,qBAA/B,EAAsDrD,IAAtD;AACA,WAAO,KAAKkF,gBAAL,CAAsB,KAAKjC,cAA3B,EAA2C,KAAKO,qBAAhD,EAAuE,KAAvE,EAA8E,KAAKG,gBAAnF,CAAP;AACA;;AAEDqZ,mBAAiB,CAAChd,IAAD,EAAO;AACvB,UAAMid,YAAY,GAAG1hB,QAAQ,CAACC,aAAT,CAAuB,KAAKghB,2BAA5B,CAArB;AACA,UAAMU,YAAY,GAAG3hB,QAAQ,CAACC,aAAT,CAAuB,KAAK+gB,4BAA5B,CAArB;AACAJ,YAAQ,CAACc,YAAD,EAAejd,IAAf,CAAR;AACAkd,gBAAY,CAACpU,KAAb;;AACA,UAAMs5B,cAAc,GAAG,MAAM7mC,QAAQ,CAACC,aAAT,CAAuB,KAAKqmC,wBAA5B,CAA7B;;AACA,WAAOtK,IAAI,CAAC6K,cAAD,EAAiB,KAAjB,CAAX;AACA;;AAEDD,oBAAkB,GAAG;AACpB5mC,YAAQ,CAACC,aAAT,CAAuB,KAAKqmC,wBAA5B,EAAsD/4B,KAAtD;;AACA,UAAMu5B,cAAc,GAAG,MAAM,CAAC9mC,QAAQ,CAACC,aAAT,CAAuB,KAAKqmC,wBAA5B,CAA9B;;AACA,WAAOtK,IAAI,CAAC8K,cAAD,EAAiB,KAAjB,CAAJ,CACLvkC,IADK,CACA,MAAM,KAAKuG,eAAL,EADN,EAELvG,IAFK,CAEAyW,GAAG,IAAI,KAAK7U,UAAL,CAAgB6U,GAAhB,CAFP,CAAP;AAGA;;AAED9T,YAAU,CAACT,IAAD,EAAO;AAChB,SAAK6D,iBAAL,CAAuBlB,GAAvB,CAA2B,KAAKW,sBAAhC,EAAwDtD,IAAxD;AACA,WAAO,KAAKkF,gBAAL,CAAsB,KAAKhC,eAA3B,EAA4C,KAAKO,sBAAjD,EAAyE,KAAzE,EAAgF,KAAKI,iBAArF,EACL/F,IADK,CACA,MAAM,KAAKuG,eAAL,EADN,EAELvG,IAFK,CAEAyW,GAAG,IAAI,KAAK7U,UAAL,CAAgB6U,GAAhB,CAFP,CAAP;AAGA;;AAED5X,wBAAsB,GAAG;AACxB,WAAO,KAAK+H,WAAL,GAAmB5G,IAAnB,CAAwB8G,YAAY,IAAI;AAC9C,YAAMqgB,QAAQ,GAAGjnB,WAAW,CAACE,cAAc,CAAC,KAAK0a,kBAAN,EAA0BhU,YAA1B,CAAf,CAAX,IAAsE,CAAvF;AACA,YAAM0gB,aAAa,GAAGtnB,WAAW,CAACE,cAAc,CAAC,KAAK2a,uBAAN,EAA+BjU,YAA/B,CAAf,CAAX,IAA2E,CAAjG;AACA,YAAMwD,kBAAkB,GAAGlK,cAAc,CAAC,KAAK6I,0BAAN,EAAkCnC,YAAlC,CAAzC;AACA,YAAMyD,gBAAgB,GAAGD,kBAAkB,GAAGpK,WAAW,CAACoK,kBAAD,CAAX,IAAmC,CAAtC,GAA0C,CAArF;AACA,aAAO,KAAK1I,UAAL,CAAgBkF,YAAhB,IAAgCqgB,QAAhC,GAA2CK,aAA3C,GAA2Djd,gBAAlE;AACA,KANM,CAAP;AAOA;;AA/IuD,CAAzD;AAkJe;AACdpC,MAAI,EAAE,aADQ;AAEd5M,QAAM,EAAE,iBAFM;AAGd+P,iBAAe,EAAE,IAHH;AAIdxC,QAJc;AAKdiE,kBAAgB,EAAEiF,YAAY,KAAKhF,wDAAiB,CAACqS,IAAvB,GAA8BrS,wDAAiB,CAACsS;AALhE,CAAf,E;;;;;;;;;;;;ACjLA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;AAgBA,MAAM7Z,aAAa,GAAG,gCAAtB;AAEA,MAAMqD,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsB,oBAAtB;AACA,SAAK8E,sBAAL,GAA8B,2CAA9B;AACA,SAAK7E,qBAAL,GAA6B,kCAA7B;AACA,SAAKe,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,4EAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,wBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,sBAAnC;AACA,SAAKvG,kBAAL,GAA0BI,aAA1B;AACA,SAAK++B,kBAAL,GAA2B,GAAE54B,QAAS,qBAAtC;AAEA,SAAK64B,eAAL,GAAuB,0BAAvB;AAEA,SAAKC,sBAAL,GAA8B,wBAA9B;AACA,SAAKC,mBAAL,GAA2B,yBAA3B;AAEA,SAAK5I,uBAAL,GAA+B,gCAA/B;AAEA,SAAKn7B,kBAAL,GAA0B,aAA1B;AAEA,SAAK6E,aAAL,GAAqBA,aAArB;AACA,SAAKF,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,QAA9B;AACA;;AAED/G,kBAAgB,GAAG;AAClB,WAAO,KAAKmmC,mBAAL,GAA2B5kC,IAA3B,CAAgCu5B,YAAY,IAAI;AACtD,UAAI,CAACA,YAAL,EAAmB;AAClB,eAAO79B,OAAO,CAACC,OAAR,EAAP;AACA;;AACD,aAAO,CAAC,GAAGyE,iEAAc,CAAC,KAAK27B,uBAAN,EAA+BxC,YAA/B,EAA6C,IAA7C,CAAlB,EAAsEz2B,GAAtE,CAA0EqH,EAAE,IAClFA,EAAE,CAACrM,WAAH,CAAeuF,IAAf,EADM,CAAP;AAGA,KAPM,CAAP;AAQA;;AAED3E,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,CAAC,GAAGlB,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EACZxC,GADY,CACRoK,WAAW,IAAIA,WAAW,CAAC9J,SAAZ,CAAsBnF,KAAtB,CAA4B,KAAKwmC,eAAjC,CADP,EAEZv6B,MAFY,CAELE,OAFK,EAGZtH,GAHY,CAGR7E,KAAK,IAAIA,KAAK,CAAC,CAAD,CAHN,CAAd;AAIA,WAAO;AACNU,WADM;AAENC,eAAS,EAAED,KAAK,CAACoG;AAFX,KAAP;AAIA;;AAEDhD,iBAAe,CAACI,IAAD,EAAO;AACrB,WAAO/B,iEAAc,CAAC,KAAKK,qBAAN,EAA6B0B,IAA7B,EAAmC,IAAnC,CAAd,CAAuD4C,MAAvD,GAAgE,KAAK8/B,iBAAL,CAAuB1iC,IAAvB,EAA6B4C,MAApG;AACA,GApDuD,CAsDxD;;;AACA8/B,mBAAiB,CAAC1iC,IAAD,EAAO;AACvB,WAAO,CAAC,GAAG/B,iEAAc,CAAC,KAAKskC,sBAAN,EAA8BviC,IAA9B,EAAoC,IAApC,CAAlB,EACLW,GADK,CACDqH,EAAE,IAAIA,EAAE,CAACrM,WAAH,CAAeG,KAAf,CAAqB,KAAK0mC,mBAA1B,CADL,EAELz6B,MAFK,CAEEE,OAFF,CAAP;AAGA;;AAEDw6B,qBAAmB,GAAG;AACrB,WAAO,KAAKr9B,YAAL,CAAkB,KAAlB,EAAyB,KAAKi9B,kBAA9B,CAAP;AACA;;AA/DuD,CAAzD;AAkEe;AACdr8B,MAAI,EAAE,WADQ;AAEd5M,QAAM,EAAE,eAFM;AAGdwR,kBAAgB,EAAEC,wDAAiB,CAACC,OAHtB;AAId5B,WAAS,EAAE,IAJG;AAKdvC,QALc;;AAMde,aAAW,GAAG;AACb,WAAOO,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuB,YAAvB,CAAD,CAAd;AACA,GARa;;AASd2O,aAAW,CAAC/D,IAAD,EAAO;AACjB,WAAOA,IAAI,CAACC,UAAL,CAAgB9C,aAAhB,KAAkChI,QAAQ,CAACC,aAAT,CAAuB,eAAvB,CAAzC;AACA;;AAXa,CAAf,E;;;;;;;;;;;;ACxFA;AAAA;AAAA;AAAA;AACA;AAEA,MAAM8C,cAAc,GAAG,+EAAvB;AACA,MAAM2S,uBAAuB,GAAG,iCAAhC;;AAEA,MAAMoa,UAAU,GAAG,MAAMnjB,OAAO,CAAC3M,QAAQ,CAACC,aAAT,CAAuByV,uBAAvB,CAAD,CAAhC;;AAEA,MAAMrF,OAAO,GAAG,MAAM;AACrB,QAAMM,KAAK,GAAG3Q,QAAQ,CAACC,aAAT,CAAuB8C,cAAvB,CAAd;AACA,SAAO4N,KAAK,IAAI3Q,QAAQ,CAACC,aAAT,CAAuB8C,cAAvB,EAAuC4C,SAAvC,KAAqD,OAArE;AACA,CAHD;AAKA;;;;;;;;;;;;;;;AAcA,MAAM0F,MAAM,GAAG,MAAMA,MAAN,SAAqB5D,6CAArB,CAA0C;AACxD3E,aAAW,GAAG;AACb;AACA,SAAKC,cAAL,GAAsBA,cAAtB;AACA,SAAK8E,sBAAL,GAA8B,gDAA9B;AACA,SAAK7E,qBAAL,GAA6B,uDAA7B;AACA,SAAKe,WAAL,GAAmB,IAAnB;AAEA,UAAMoK,QAAQ,GAAG,wEAAjB;AACA,SAAKzG,cAAL,GAAuB,GAAEyG,QAAS,wBAAlC;AACA,SAAKxG,eAAL,GAAwB,GAAEwG,QAAS,sBAAnC;AACA,SAAKvG,kBAAL,GAA2B,GAAEuG,QAAS,0BAAtC;AAEA,SAAKnG,aAAL,GAAqB2C,MAAM,CAACC,QAAP,CAAgBC,IAArC;AACA,SAAK/C,qBAAL,GAA6B,YAA7B;AACA,SAAKC,sBAAL,GAA8B,QAA9B;AAEA,SAAKO,iBAAL,GAAyB,KAAKF,gBAA9B;AAEA,SAAKi/B,gBAAL,GAAwB,8BAAxB;AACA;;AAEDpmC,kBAAgB,GAAG;AAClB,UAAM2kC,aAAa,GAAG5lC,QAAQ,CAACC,aAAT,CAAuByV,uBAAvB,CAAtB;AACA,QAAIxU,KAAK,GAAG,EAAZ;;AACA,QAAI0kC,aAAJ,EAAmB;AAClB1kC,WAAK,GAAG,IAAIsE,GAAJ,CACP,CAAC,GAAGxF,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EACE4E,MADF,CACSE,OADT,EAEEtH,GAFF,CAEMqH,EAAE,IAAIA,EAAE,CAACtM,YAAH,CAAgB,IAAhB,CAFZ,CADO,CAAR;AAKA,KAND,MAMO;AACNc,WAAK,GAAG,IAAIsE,GAAJ,CACP,CAAC,GAAGxF,QAAQ,CAACyF,gBAAT,CAA0B,KAAKoC,sBAA/B,CAAJ,EACE4E,MADF,CACSC,EAAE,IAAIA,EAAE,CAAC/G,SAAH,CAAanF,KAAb,CAAmB,KAAK6mC,gBAAxB,CADf,EAEEhiC,GAFF,CAEMqH,EAAE,IAAIA,EAAE,CAAC/G,SAAH,CAAanF,KAAb,CAAmB,KAAK6mC,gBAAxB,EAA0C,CAA1C,CAFZ,CADO,CAAR;AAKA;;AAED,WAAO;AACNnmC,WAAK,EAAE,CAAC,GAAGA,KAAJ,CADD;AAENC,eAAS,EAAED,KAAK,CAAC2E;AAFX,KAAP;AAIA;;AA3CuD,CAAzD;AA8Ce;AACd6E,MAAI,EAAE,SADQ;AAEd5M,QAAM,EAAE,aAFM;AAGdwR,kBAAgB,EAAEC,wDAAiB,CAACC,OAHtB;AAId5B,WAAS,EAAE,IAJG;AAKdvC,QALc;;AAMduD,aAAW,GAAG;AACb,WACC5O,QAAQ,CAACC,aAAT,CAAwB,mCAAkCyV,uBAAwB,EAAlF,KACArF,OAAO,EADP,IAEA,CAACyf,UAAU,EAHZ;AAKA,GAZa,CAad;;;AAbc,CAAf,E","file":"drivers__demandwareAJAX.bundle.js","sourcesContent":["import bus from '../bus';\nimport { log, format } from '../../utils';\nimport { backgroundMessaging, handleDriverError } from '../lib';\n\nconst { toFloat } = format;\n\nexport default class BaseDriver {\n\t/**\n\t * @function watchForRestoreUserData - set up a listener to check user data restorement\n\t * @emits bus#RestoreUserData - the event that indicates to the app\tthat user data could be restored\n\t */\n\twatchForRestoreUserData(time = 500) {\n\t\tlet pauseInterval = false;\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tconst currentState = await this.checkRestoreDataCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t\tif (currentState) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tbus.$emit('restore-user-data');\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkRestoreDataCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t}\n\t\t}, time);\n\n\t\treturn interval;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * @function storeUserData\n\t * @param {String} domain - domain to set the driver storage\n\t * @returns {Promise}\n\t */\n\tasync storeUserData(domain) {\n\t\tconst userData = await this.getUserData();\n\n\t\tif (userData === null) {\n\t\t\t// Nothing to store\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst storageRecord = {\n\t\t\tuserData,\n\t\t\tstoredTime: Date.now(),\n\t\t};\n\t\tbackgroundMessaging.setDriverStorage(userDataKey, storageRecord);\n\t\tlog('Stored user data: %O', storageRecord);\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function restoreUserData\n\t * @param {String} domain - domain to access the driver storage\n\t * @param {Number} [maxStorageLifetime] - optional, the lifetime of the stored data (default 10 mins)\n\t * @returns {Promise}\n\t */\n\tasync restoreUserData(domain, maxStorageLifetime = 600000) {\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(userDataKey);\n\n\t\tif (driverStorage) {\n\t\t\tconst { storedTime, userData } = driverStorage;\n\t\t\t// Clear stored user data\n\t\t\tbackgroundMessaging.deleteDriverStorage(userDataKey);\n\n\t\t\tif (Date.now() - storedTime <= maxStorageLifetime) {\n\t\t\t\tlog('Restore user data: %O', userData);\n\t\t\t\treturn this.setUserData(userData);\n\t\t\t}\n\t\t\tlog('User data is outdated, skip restoring');\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserData - get user data which should be stored\n\t * @returns {Object} - object with required user data which should be restored\n\t */\n\tgetUserData() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function setUserData - restore user data on page\n\t * @param {Object} userData - data which was saved and should be restored\n\t * @returns {Promise}\n\t */\n\tsetUserData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserDataStorageKey - unique key for storing user data per merchant\n\t * @returns {String}\n\t */\n\tgetUserDataStorageKey(domain) {\n\t\t// Append `_userData` to avoid possible conflicts with created storage from driver\n\t\treturn `${domain}_userData`;\n\t}\n\n\t/**\n\t * Parses start price from page\n\t *\n\t * @function getStartPrice\n\t * @returns {Promise<Number>|Number} - the total from the page\n\t */\n\tgetStartPrice() {\n\t\tlet startPrice = Number.MAX_SAFE_INTEGER;\n\t\tconst totalElementConfig = this.TOTAL_ELEMENT_CONFIG;\n\t\tif (totalElementConfig) {\n\t\t\tconst { selector, attribute, regex } = totalElementConfig;\n\t\t\tlet totalElement;\n\t\t\t// handle case, when there is array of selectors and we try to take totalElement using these selectors in turn\n\t\t\t// for example dell.com, hertz.com\n\t\t\tif (Array.isArray(selector)) {\n\t\t\t\tselector.forEach(elemSelector => {\n\t\t\t\t\tif (!totalElement) {\n\t\t\t\t\t\ttotalElement = document.querySelector(elemSelector);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\ttotalElement = document.querySelector(selector);\n\t\t\t} else {\n\t\t\t\thandleDriverError(\n\t\t\t\t\tnew Error(`Total selector type mismatch. Expected string | array, got ${typeof selector}`),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (totalElement) {\n\t\t\t\tlet value = attribute ? totalElement.getAttribute(attribute) : totalElement.textContent;\n\n\t\t\t\tif (value && regex) {\n\t\t\t\t\t// Set pattern to null to receive error in case pattern was not defined\n\t\t\t\t\t// otherwise we may silently return undefined or empty string\n\t\t\t\t\tconst { pattern = null, group = 0 } = regex;\n\t\t\t\t\tvalue = value.match(pattern)[group];\n\t\t\t\t}\n\t\t\t\tstartPrice = toFloat(value);\n\t\t\t}\n\t\t}\n\t\treturn startPrice;\n\t}\n\n\t/**\n\t * Perform any needed actions and setup to start codes testing\n\t *\n\t * @function beforeTestCodes\n\t *\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @typedef {Object} OriginalData\n\t * @property {Number} originalPrice the starting price for the cart\n\t * @property {Number} originalItemsCount the starting items count of the cart\n\t */\n\t/**\n\t * Perform any needed actions and setup before `checkCodes()` will be executed\n\t *\n\t * @function beforeCheckCodes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tbeforeCheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Perform any needed actions and setup before `applyCodes()` will be executed\n\t *\n\t * @function beforeApplyCodes\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function checkCodes\n\t *\n\t * @param {String[]} codes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise}\n\t */\n\tcheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes each code in @param codes and actually applies it to the cart,\n\t * typically through a fetch(...) call.\n\t *\n\t * @function applyCodes\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tapplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function stackCodes\n\t *\n\t * @param {Object} validationInfo - contains all required info passed by `checkCodes()` for codes stacking\n\t * @param {String[]} validationInfo.codes\n\t * @param {Float} [validationInfo.originalPrice]\n\t * @param {Object[]} [validationInfo.discounts] - contains all codes mapped with their discounts\n\t * @returns {Promise}\n\t */\n\tstackCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function removeCodes\n\t *\n\t * @param {String[]} codes - passed in case the driver needs to know specific codes to do removal\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request response) which are available and were not applied by user\n\t *\n\t * @function getMerchantCodes\n\t * @returns {String[]} - codes from merhcant page (or request response if possible)\n\t */\n\tgetMerchantCodes() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request) which are available and were applied by user\n\t *\n\t * @typedef {Object} ExistingCodeInfo\n\t * @prop {String[]} codes - list of codes which had been applied, if discoverable\n\t * @prop {Number} codeCount - the number of codes that were applied to the cart\n\t */\n\t/**\n\t * @function getExistingCodes\n\t * @returns {ExistingCodeInfo}\n\t */\n\tgetExistingCodes() {\n\t\treturn {\n\t\t\tcodes: [],\n\t\t\tcodeCount: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Parses pre tax and shipping total from page or request's response\n\t *\n\t * @function getPreTaxShippingTotal\n\t * @returns {Promise<Number>|Number} - the total without tax and shipping\n\t */\n\tgetPreTaxShippingTotal() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function watchForCartUrl - optional function to set up a listener for url changes on SPAs\n\t * @emits bus#CartActive - the event (using the string 'cart-active') that indicates to the app that test codes button should be shown\n\t * @emits bus#CartInactive - the event (using the string 'cart-inactive') that indicates to the app that test codes button should be hidden\n\t */\n\twatchForCartUrl(time = 500) {\n\t\tlet previousState = null;\n\t\tlet pauseInterval = false;\n\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\tlet currentState = null;\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tcurrentState = await this.checkCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t\tif (currentState !== previousState) {\n\t\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t\t}\n\t\t\t\tpreviousState = currentState;\n\t\t\t}\n\t\t}, time);\n\t\t// return the interval to stop it in `watchForCartUrl` if needed from outside\n\t\treturn interval;\n\t}\n\n\t/**\n\t * @function checkCondition - optional function to check for conditions on SPAs\n\t * @returns {Boolean}\n\t */\n\tcheckCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Perform custom completion action on Continue to Checkout button\n\t * Takes best codes in @param codes\n\t *\n\t * @function completeExperience\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tcompleteExperience() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function completeExperiencePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcompleteExperiencePromisified(...args) {\n\t\treturn this._promisify(this.completeExperience, args);\n\t}\n\n\t/**\n\t * @function beforeCodesTestingPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeTestCodes, args);\n\t}\n\n\t/**\n\t * @function getStartPricePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetStartPricePromisified() {\n\t\treturn this._promisify(this.getStartPrice);\n\t}\n\n\t/**\n\t * @function getMerchantCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetMerchantCodesPromisified(...args) {\n\t\treturn this._promisify(this.getMerchantCodes, args);\n\t}\n\n\t/**\n\t * @function getExistingCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetExistingCodesPromisified(...args) {\n\t\treturn this._promisify(this.getExistingCodes, args);\n\t}\n\n\t/**\n\t * @function removeCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tremoveCodesPromisified(...args) {\n\t\treturn this._promisify(this.removeCodes, args);\n\t}\n\n\t/**\n\t * @function beforeApplyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeApplyCodes, args);\n\t}\n\n\t/**\n\t * @function applyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tapplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.applyCodes, args);\n\t}\n\n\t/**\n\t * @function beforeCheckCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeCheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeCheckCodes, args);\n\t}\n\n\t/**\n\t * @function checkCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.checkCodes, args);\n\t}\n\n\t/**\n\t * @function stackCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tstackCodesPromisified(...args) {\n\t\treturn this._promisify(this.stackCodes, args);\n\t}\n\n\t/**\n\t * @function _promisify - promisifies given method and return it's result as a Promise\n\t * @returns {Promise}\n\t */\n\t_promisify(method, args) {\n\t\treturn Promise.resolve().then(() => method.apply(this, args));\n\t}\n}\n","import Promise from 'bluebird';\nimport BaseDriver from '../base';\nimport bus from '../../bus';\nimport { DOM, format, log } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractFormValues, extractElement } = DOM;\n\nexport default class DemandwareDriver extends BaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total td:last-child';\n\t\tthis.PRODUCT_ITEM_SELECTOR = null;\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.rowcoupons';\n\t\tthis.CODE_VALUE_SELECTOR = '.cartcoupon .value';\n\t\tthis.CART_FORM_SELECTOR = '#cart-items-form';\n\n\t\tthis.DEFAULT_REMOVE_CODE_VALUE = 'dwfrm_cart_coupons_i0_deleteCoupon';\n\t\tthis.REMOVE_CODE_SELECTOR = '[name*=\"_deleteCoupon\"]';\n\t\tthis.REMOVE_VALUE_ATTRIBUTE = 'name';\n\n\t\tthis.REQUEST_HEADERS = {\n\t\t\tAccept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t};\n\t\tthis.REQUEST_PARAMS = {\n\t\t\tCOUPON_PARAM_NAME: 'dwfrm_cart_couponCode',\n\t\t\tADD_COUPON_PARAM_NAME: 'dwfrm_cart_addCoupon',\n\t\t\tADD_COUPON_PARAM_VALUE: 'dwfrm_cart_addCoupon',\n\t\t\tREMOVE_COUPON_PARAM_VALUE: 'Remove',\n\t\t};\n\t\tthis.ERROR_MESSAGE_SELECTOR = null;\n\t\tthis.isStackable = true;\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this.isStackable ? Promise.resolve() : this.applyCode(codes[0], this._requestData());\n\t}\n\n\tcheckCodes(codes) {\n\t\tconst originalPrice = this.parseTotal(this.lastResponse);\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst originalItemsCount = this.parseItemsCount(this.lastResponse);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code, this._requestData()).then(html => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\t\t\t\tif (this._codeAppliedCheck(html)) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tthis.lastResponse = html;\n\t\t\t\tresult.finalPrice = this.parseTotal(html);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\t\t\t\tresult.isValid = true;\n\n\t\t\t\tif (\n\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\n\t\t\t\treturn this.removeCode(this._removeValueName(code), this._requestData()).then(removeCodeHtml => {\n\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t\toriginalItemsCount,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.lastResponse = null;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(element => element.innerText.trim()),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.removeCode(this._removeValueName(code), this._requestData()).then(html => {\n\t\t\t\tthis.lastResponse = html;\n\t\t\t\treturn Promise.resolve();\n\t\t\t}),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice, originalItemsCount } = validationInfo;\n\n\t\t// Sort by discount\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code, this._requestData()).then(html => {\n\t\t\t\tthis.lastResponse = html;\n\t\t\t\tconst finalPrice = this.parseTotal(html);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t\tfreeGifts,\n\t\t\t\t});\n\t\t\t\tif (\n\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(this._removeValueName(discount.code), this._requestData()).then(\n\t\t\t\t\tremoveCodeHtml => {\n\t\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\t_requestData() {\n\t\treturn extractFormValues(this.CART_FORM_SELECTOR, this.lastResponse);\n\t}\n\n\t_removeValueName(code) {\n\t\tconst codesElements = extractElement(this.CODES_ELEMENTS_SELECTOR, this.lastResponse, true);\n\t\tconst matchingCodesElement = [...codesElements].find(element => {\n\t\t\tconst codesElement = element.querySelector(this.CODE_VALUE_SELECTOR);\n\t\t\treturn codesElement && codesElement.innerText.trim() === code;\n\t\t});\n\n\t\treturn matchingCodesElement\n\t\t\t? matchingCodesElement.querySelector(this.REMOVE_CODE_SELECTOR).getAttribute(this.REMOVE_VALUE_ATTRIBUTE)\n\t\t\t: this.DEFAULT_REMOVE_CODE_VALUE;\n\t}\n\n\tmanageCode(requestData) {\n\t\treturn fetch(requestData.action, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: requestData.params,\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.REQUEST_HEADERS,\n\t\t}).then(response => response.text());\n\t}\n\n\tapplyCode(code, requestData) {\n\t\trequestData.params.set(this.REQUEST_PARAMS.COUPON_PARAM_NAME, code);\n\t\trequestData.params.set(this.REQUEST_PARAMS.ADD_COUPON_PARAM_NAME, this.REQUEST_PARAMS.ADD_COUPON_PARAM_VALUE);\n\t\treturn this.manageCode(requestData);\n\t}\n\n\tremoveCode(removeValueName, requestData) {\n\t\trequestData.params.set(removeValueName, this.REQUEST_PARAMS.REMOVE_COUPON_PARAM_VALUE);\n\t\treturn this.manageCode(requestData);\n\t}\n\n\tparseTotal(html) {\n\t\tconst totalElement = extractElement(this.TOTAL_SELECTOR, html);\n\t\treturn elemToFloat(totalElement);\n\t}\n\n\tparseItemsCount(html) {\n\t\treturn this.PRODUCT_ITEM_SELECTOR ? extractElement(this.PRODUCT_ITEM_SELECTOR, html, true).length : 0;\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\treturn this.ERROR_MESSAGE_SELECTOR ? extractElement(this.ERROR_MESSAGE_SELECTOR, data) : false;\n\t}\n}\n","import Promise from 'bluebird';\nimport BaseDriver from '../base';\nimport bus from '../../bus';\nimport { DOM, format, log } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElementFromHTML, extractElement, extractFormValues } = DOM;\n\nexport default class DemandwareAJAXDriver extends BaseDriver {\n\t// This class could be used if merchant uses AJAX `GET` requests to manage promo codes\n\t// Could be used too if on cart page POST request is used to remove code\n\tconstructor() {\n\t\tsuper();\n\n\t\t// Should be defined in driver\n\t\tthis.APPLY_CODE_URL = '';\n\t\tthis.REMOVE_CODE_URL = '';\n\t\tthis.UPDATE_REQUEST_URL = '';\n\n\t\tthis.APPLIED_CODES_SELECTOR = null;\n\t\tthis.PRODUCT_ITEM_SELECTOR = null;\n\n\t\t// Redefine in driver in case it differs\n\t\tthis.isStackable = false;\n\t\tthis.TOTAL_SELECTOR = '.order-total td:last-child';\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\n\t\t// Keep empty if no code is passed in remove query params\n\t\tthis.REMOVE_CODE_PARAM_NAME = '';\n\t\tthis.REMOVE_COUPON_PARAM_VALUE = 'Remove';\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.rowcoupons';\n\t\tthis.CODE_VALUE_SELECTOR = '.cartcoupon .value';\n\t\tthis.CART_FORM_SELECTOR = '#cart-items-form';\n\n\t\tthis.DEFAULT_REMOVE_CODE_VALUE = 'dwfrm_cart_coupons_i0_deleteCoupon';\n\t\tthis.REMOVE_CODE_SELECTOR = '[name*=\"_deleteCoupon\"]';\n\n\t\tthis.CART_PAGE_URL = '';\n\n\t\t// Redefine in driver in case they are needed\n\t\tthis.APPLY_REQUEST_HEADERS = {};\n\t\tthis.REMOVE_REQUEST_HEADERS = {};\n\t\tthis.UPDATE_REQUEST_HEADERS = {};\n\n\t\t// Set required static params in driver in case they are present\n\t\tthis.applyQueryParams = new URLSearchParams();\n\t\tthis.removeQueryParams = new URLSearchParams();\n\t\tthis.updateQueryParams = new URLSearchParams();\n\n\t\t// Will try to check if code was applied if JSON response received,\n\t\t// to avoid sending update request if code was not applied.\n\t\t// If sequence of keys were matched to compare value or keys were not found,\n\t\t// update request will be send\n\n\t\t// Sequence corresponds to responseJSON.<key1>.<key2>...\n\t\t// Default to `responseJSON.success`\n\t\tthis.APPLY_RESPONSE_KEY = 'success';\n\n\t\t// Value extracted from JSON will be compared with this value\n\t\tthis.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE = true;\n\n\t\t// In case codes may replace each other\n\t\t// we should reapply the best codes after codes removal to correctly stack next one\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = false;\n\t}\n\n\t// Base Driver methods\n\tapplyCodes(codes) {\n\t\treturn this.isStackable ? Promise.resolve() : this.applyCode(codes[0]);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t};\n\n\t\t\t\tconst successState = this._getValueFromJSON(applyCodeResponse);\n\n\t\t\t\tif (successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount(orderSummary) - originalItemsCount;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.isStackable) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t\toriginalItemsCount,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\treturn Promise.resolve()\n\t\t\t.then(() => {\n\t\t\t\tif (this._isOnCartPage()) {\n\t\t\t\t\treturn document.documentElement.innerHTML;\n\t\t\t\t}\n\t\t\t\treturn this.getCartPage();\n\t\t\t})\n\t\t\t.then(html => {\n\t\t\t\tconst appliedCodesSelector = this.APPLIED_CODES_SELECTOR\n\t\t\t\t\t? this.APPLIED_CODES_SELECTOR\n\t\t\t\t\t: this.CODE_VALUE_SELECTOR;\n\t\t\t\tconst codes = [...extractElementFromHTML(html, appliedCodesSelector, true)].map(element =>\n\t\t\t\t\telement.innerText.trim(),\n\t\t\t\t);\n\n\t\t\t\treturn {\n\t\t\t\t\tcodes,\n\t\t\t\t\tcodeCount: codes.length,\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this.removeCode(code))\n\t\t\t.then(() => this.getOrderSummary())\n\t\t\t.then(response => ({\n\t\t\t\toriginalPrice: this.parseTotal(response),\n\t\t\t\toriginalItemsCount: this.parseItemsCount(response),\n\t\t\t}));\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice, originalItemsCount } = validationInfo;\n\n\t\t// Sort by discount and free gifts count\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code)\n\t\t\t\t.then(() => this.getOrderSummary())\n\t\t\t\t.then(responseHTML => {\n\t\t\t\t\tconst finalPrice = this.parseTotal(responseHTML);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst freeGifts = this.parseItemsCount(responseHTML) - originalItemsCount;\n\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\tfreeGifts,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t\t) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this.removeCode(discount.code).then(() => {\n\t\t\t\t\t\tif (this.REAPPLY_CODES_WHILE_STACKING) {\n\t\t\t\t\t\t\treturn Promise.each(successfulCodes, code => this.applyCode(code));\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t}),\n\t\t);\n\t}\n\n\t// Demandware AJAX Driver methods\n\tapplyCode(code) {\n\t\tthis.applyQueryParams.set(this.APPLY_CODE_PARAM_NAME, code);\n\n\t\treturn this._sendRequestGET(this.APPLY_CODE_URL, this.APPLY_REQUEST_HEADERS, this.applyQueryParams);\n\t}\n\n\tremoveCode(code) {\n\t\tif (this.REMOVE_CODE_PARAM_NAME) {\n\t\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\t}\n\n\t\treturn this._sendRequestGET(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n\n\tremoveCodeOnCart(code) {\n\t\t// Need to get cart page to retrieve form data with a token each time a code was applied\n\t\treturn this.getCartPage().then(responseHTML => {\n\t\t\tconst removeParamName = this._getRemoveValueName(code, responseHTML);\n\t\t\tif (!removeParamName) {\n\t\t\t\t// No need in the reuqest, as parameter name was not found for the code\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\tconst removeRequestData = extractFormValues(this.CART_FORM_SELECTOR, responseHTML);\n\t\t\tremoveRequestData.params.set(removeParamName, this.REMOVE_COUPON_PARAM_VALUE);\n\n\t\t\treturn this._sendRequestPOST(removeRequestData.action, {}, null, removeRequestData.params);\n\t\t});\n\t}\n\n\tgetOrderSummary() {\n\t\treturn this._sendRequestGET(this.UPDATE_REQUEST_URL, this.UPDATE_REQUEST_HEADERS, this.updateQueryParams);\n\t}\n\n\tgetCartPage() {\n\t\treturn this._sendRequestGET(this.CART_PAGE_URL, {});\n\t}\n\n\tparseTotal(html) {\n\t\tconst totalElement = extractElement(this.TOTAL_SELECTOR, html);\n\t\treturn elemToFloat(totalElement);\n\t}\n\n\tparseItemsCount(html) {\n\t\treturn this.PRODUCT_ITEM_SELECTOR ? extractElement(this.PRODUCT_ITEM_SELECTOR, html, true).length : 0;\n\t}\n\n\t_sendRequestGET(requestURL, headers, queryParams) {\n\t\treturn this._sendRequest('GET', requestURL, headers, queryParams);\n\t}\n\n\t_sendRequestPOST(requestURL, headers, queryParams, bodyData) {\n\t\treturn this._sendRequest('POST', requestURL, headers, queryParams, bodyData);\n\t}\n\n\t_sendRequest(method, requestURL, headers, queryParams, bodyData) {\n\t\tconst finalRequestURL =\n\t\t\tqueryParams && queryParams.toString() ? `${requestURL}?${queryParams.toString()}` : requestURL;\n\n\t\treturn fetch(finalRequestURL, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\theaders,\n\t\t\tbody: bodyData,\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\t// Return JSON if it is possible\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t_getValueFromJSON(json) {\n\t\tif (!this.APPLY_RESPONSE_KEY) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Object.prototype.hasOwnProperty.call(json, this.APPLY_RESPONSE_KEY)\n\t\t\t? json[this.APPLY_RESPONSE_KEY]\n\t\t\t: null;\n\t}\n\n\t_getRemoveValueName(code, html) {\n\t\tconst codesElements = extractElement(this.CODES_ELEMENTS_SELECTOR, html, true);\n\t\tconst matchingCodesElement = [...codesElements].find(element => {\n\t\t\tconst codesElement = element.querySelector(this.CODE_VALUE_SELECTOR);\n\t\t\treturn codesElement && codesElement.innerText.trim().toLowerCase() === code.toLowerCase();\n\t\t});\n\n\t\treturn matchingCodesElement\n\t\t\t? matchingCodesElement.querySelector(this.REMOVE_CODE_SELECTOR).name\n\t\t\t: this.DEFAULT_REMOVE_CODE_VALUE;\n\t}\n\n\t_isOnCartPage() {\n\t\treturn window.location.href.startsWith(this.CART_PAGE_URL);\n\t}\n}\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Pages, where extension works: Cart, Billing\n+ Is driver SPA: yes\n+ Gather codes on site pages: yes, from Coupon page: https://www.aeropostale.com/coupons\n+ Restore user data: yes\n\t- shipping method on Cart page\n*/\n\nconst DOMAIN = 'https://www.aeropostale.com';\nconst BASE_REQUEST_URL = `${DOMAIN}/on/demandware.store/Sites-aeropostale-Site`;\nconst BASE_CART_REQUEST_URL = `${BASE_REQUEST_URL}/default`;\nconst BASE_CHECKOUT_REQUEST_URL = `${BASE_REQUEST_URL}/en_US`;\nconst isCart = window.location.href.includes('cart') || window.location.href.includes('Cart-SubmitForm');\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_CHECKOUT_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_CHECKOUT_REQUEST_URL}/COBilling-UpdateSummary`;\n\t\tthis.CODE_VALUE_SELECTOR = '.cartcoupon.clearfix .value';\n\t\tthis.CODE_INPUT_SELECTOR = '[name*=\"couponCode\"]';\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\n\t\tthis.CART_PAGE_URL = `${DOMAIN}/cart/`;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.isStackable = true;\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\t\tthis.CODE_CONTAINER_SELECTOR = '.mobileSpan';\n\t\tthis.CODE_REGEX = /code\\s+(.*?)\\s+/i;\n\t\tthis.LOADER_SELECTOR = '.loader';\n\t\tthis.CART_EMPTY_SELECTOR = '.cart-empty, .mini-cart-header';\n\t\tthis.SHIPPING_PICKUP = '.item-delivery-options input';\n\t\tthis.SHIPPING_OPTIONS_SELECTOR = '[name=\"shippingMethod\"]';\n\t\tthis.SELECTED_SHIPPING = null;\n\t\tthis.SHIPPING_WRAPPER_SELECTOR = '.cart-shipping-methods';\n\t\tthis.APPLIED_CODES_SELECTOR = null;\n\t}\n\n\tcheckCondition() {\n\t\tconst cartEmptyMsg = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\tconst { href } = window.location;\n\t\tconst isRightUrl = href.includes('/cart') || href.includes('/Cart-SubmitForm');\n\t\tconst isCartEmpty = cartEmptyMsg && cartEmptyMsg.textContent.toLowerCase().includes('empty');\n\t\tconst isLoader = (document.querySelector(this.LOADER_SELECTOR) || {}).offsetParent;\n\t\tconst codeInputEl = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\treturn !isCartEmpty && isRightUrl && !isLoader && codeInputEl;\n\t}\n\n\tbeforeTestCodes() {\n\t\tif (isCart) {\n\t\t\tthis.SELECTED_SHIPPING = document.querySelector(`${this.SHIPPING_OPTIONS_SELECTOR}:checked`)\n\t\t\t\t? document.querySelector(`${this.SHIPPING_OPTIONS_SELECTOR}:checked`).getAttribute('value')\n\t\t\t\t: '';\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getPromoPage().then(responseHTML => {\n\t\t\treturn [...extractElement(this.CODE_CONTAINER_SELECTOR, responseHTML, true)]\n\t\t\t\t.filter(el => el.textContent.match(/use code/i))\n\t\t\t\t.map(el => el.textContent.match(this.CODE_REGEX))\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(el => el[1]);\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) || 0 : 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax + shippingDiscount;\n\t\t});\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn this._isShippingOptionsElement() && document.readyState === 'complete';\n\t}\n\n\tgetUserData() {\n\t\tif (!this._isShippingOptionsElement()) {\n\t\t\treturn null;\n\t\t}\n\t\tconst shippingOrPickUpElement = [...document.querySelectorAll(this.SHIPPING_PICKUP)].find(\n\t\t\telement => element.checked,\n\t\t);\n\t\tconst checkedShippingElement = [...document.querySelectorAll(this.SHIPPING_OPTIONS_SELECTOR)].find(\n\t\t\telement => element.checked,\n\t\t);\n\t\treturn {\n\t\t\tshippingOrPickUpSelector: shippingOrPickUpElement\n\t\t\t\t? `#${shippingOrPickUpElement.getAttribute('id')}`\n\t\t\t\t: false,\n\t\t\tshippingSelector: `#${checkedShippingElement.getAttribute('id')}`,\n\t\t};\n\t}\n\n\tsetUserData(userData) {\n\t\tif (userData.shippingOrPickUpSelector) {\n\t\t\tdocument.querySelector(userData.shippingOrPickUpSelector).click();\n\t\t}\n\t\treturn Promise.delay(1000).then(() => document.querySelector(userData.shippingSelector).click());\n\t}\n\n\t_isShippingOptionsElement() {\n\t\treturn (\n\t\t\tdocument.querySelector(this.SHIPPING_WRAPPER_SELECTOR) &&\n\t\t\tdocument.querySelector(`${this.SHIPPING_OPTIONS_SELECTOR}:checked`)\n\t\t);\n\t}\n\n\t_getPromoPage() {\n\t\treturn fetch(`${DOMAIN}/coupons`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\tgetOrderSummary() {\n\t\t// on the cart for right discount we need to send `set shipping and get total` requests\n\t\tconst promise = isCart\n\t\t\t? this._setShipping()\n\t\t\t: this._sendRequestGET(this.UPDATE_REQUEST_URL, this.UPDATE_REQUEST_HEADERS, this.updateQueryParams);\n\t\treturn promise;\n\t}\n\n\t_setShipping() {\n\t\treturn this._sendRequestGET(\n\t\t\t`${BASE_CART_REQUEST_URL}/COShipping-SelectShippingMethod?shippingMethodID=${this.SELECTED_SHIPPING}`,\n\t\t).then(() => this._getTotals());\n\t}\n\n\t_getTotals() {\n\t\treturn this._sendRequestGET(`${BASE_CART_REQUEST_URL}/Cart-GetCartTotalsJson`);\n\t}\n};\n\nexport default {\n\tname: 'Aeropostale',\n\tdomain: 'aeropostale.com',\n\tDriver,\n\tstackable: true,\n\tisSinglePageApp: true,\n\trestoreUserData: true,\n\tcartContinueUrl: `${DOMAIN}/cart`,\n};\n","/*    eslint class-methods-use-this: [\"error\", { \"exceptMethods\": [\"watchForCartUrl\"] }] */\n\nimport DemandwareAJAXDriver from './_base';\n\nconst CART_PAGE_URL = 'https://www.agacistore.com/shoppingbag';\nconst CHECKOUT_INPUT = document.querySelector('#dwfrm_billing_couponCode');\n/*\nDriver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: yes\n    Free gift support: no\n    isValid implemented: yes\n    Manually apply code: no\nOptional:\n    Show message about free shipping on the cart page (without discount info): no\n    Is driver SPA and add the condition to show popup: yes (description)\n    Gather codes on site pages: no\n    Can apply codes on cart and checkout(only when shipping is not active)\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = true;\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-total-price-right, #cart-total';\n\t\tthis.APPLIED_CODES_SELECTOR_ON_CHECKOUT = '#secondary .order-discount';\n\t\tthis.APPLIED_CODES_SELECTOR_ON_CART = '.cart-coupon-code .value';\n\t\tthis.APPLIED_CODE_REGEX = CHECKOUT_INPUT ? /(.+)\\s\\(/ : /(.+)\\s/;\n\n\t\tconst BASE_URL = 'https://www.agacistore.com/on/demandware.store/Sites-agaci-Site/default/';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = CHECKOUT_INPUT ? `${BASE_URL}/COBilling-UpdateSummary` : '';\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.CHECKOUT_SHIP_ELEM = '#shipping-section';\n\t}\n\n\tcheckCondition() {\n\t\tconst checkoutShipElem = CHECKOUT_INPUT\n\t\t\t? document.querySelector(this.CHECKOUT_SHIP_ELEM).style.opacity !== '1'\n\t\t\t: false;\n\t\tconst currentState = !!CHECKOUT_INPUT && !CHECKOUT_INPUT.disabled && checkoutShipElem;\n\t\treturn currentState;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst checkoutCodeEl = document.querySelector(this.APPLIED_CODES_SELECTOR_ON_CHECKOUT);\n\t\tconst checkoutCodes = checkoutCodeEl\n\t\t\t? [checkoutCodeEl.nextElementSibling.querySelector('td:last-child').innerText]\n\t\t\t: [];\n\t\tconst codes = CHECKOUT_INPUT\n\t\t\t? checkoutCodes\n\t\t\t: [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR_ON_CART)]\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(element => element.innerText.trim().match(this.APPLIED_CODE_REGEX)[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this.getCartPage().then(responseHTML => this.parseTotal(responseHTML));\n\t}\n};\n\nexport default {\n\tname: \"A'Gaci Store\",\n\tdomain: 'agacistore.com',\n\tDriver,\n\tisSinglePageApp: Boolean(CHECKOUT_INPUT),\n\tstackable: true,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_PAGE_URL) && (!!CHECKOUT_INPUT || document.querySelector('#dwfrm_cart_couponCode'));\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions, DOM } from '../../../utils';\n\nconst { extractElement } = DOM;\n\nconst BASE_URL = 'https://shop.americantourister.com/';\nconst CHECKOUT_PAGE_URL = `${BASE_URL}checkout`;\nconst BILLING_PAGE_URL = `${BASE_URL}billing`;\nconst CART_PAGE_URL = `${BASE_URL}cart`;\nconst APPLY_COUPON_FLD_SELECTOR = '#dwfrm_cart_couponCode, #dwfrm_billing_couponCode';\nconst IS_ON_CART = () => document.querySelector('#dwfrm_cart_couponCode');\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes \n+ Free shipping:  no\n+ isValid implemented: yes \n+ Pages, where extension works:\n   - cart\n   - billing\n+ Is driver SPA: no\n+ Gather codes on site pages:  yes\n+ Special case about the driver works.\nWe can't avoid redirect on the shipping page from the billing\n */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.BASE_REQUEST_URL = `${BASE_URL}on/demandware.store/Sites-americantourister-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${this.BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${this.BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.isStackable = true;\n\t\tthis.TOTAL_CART_SELECTOR = '.order-subtotal td:last-child';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-row .item-total, .checkout-mini-cart .mini-cart-product';\n\t\tthis.PROPOSED_CODE_SELECTOR = '.html-slot-container p';\n\t\tthis.CODE_REGEX = /code\\s+(\\w+)/i;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.TOTAL_SELECTOR = IS_ON_CART() ? this.TOTAL_CART_SELECTOR : this.TOTAL_SELECTOR;\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t};\n\t\tthis.REMOVE_REQUEST_HEADERS = {\n\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t};\n\t\tthis.UPDATE_REQUEST_HEADERS = {\n\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.CHECKOUT_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.SUCCESS_MESSAGE_SELECTOR = '.success, .coupon-sucess';\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\treturn [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...extractElement(this.PROPOSED_CODE_SELECTOR, responseHTML, true)]\n\t\t\t\t\t\t.map(el => el.textContent.match(this.CODE_REGEX))\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.map(el => el[1]),\n\t\t\t\t),\n\t\t\t];\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_PAGE_URL, {\n\t\t\tcredentials: 'include',\n\t\t\tmethod: 'GET',\n\t\t}).then(response => response.text());\n\t}\n\n\t_isOnCartPage() {\n\t\treturn IS_ON_CART();\n\t}\n};\n\nexport default {\n\tname: 'American Tourister',\n\tdomain: 'americantourister.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tstackable: true,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t(href.startsWith(CART_PAGE_URL) ||\n\t\t\t\thref.startsWith(BILLING_PAGE_URL) ||\n\t\t\t\thref.startsWith(CHECKOUT_PAGE_URL) ||\n\t\t\t\thref.toLowerCase().includes('cart-addtowishlist')) &&\n\t\t\tdocument.querySelector(APPLY_COUPON_FLD_SELECTOR)\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.mini-cart-empty'));\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\n\nconst CHECKOUT_PAGE_URL = 'https://www.ardene.com/us/en/checkout-billing/';\nconst CART_PAGE_URL = 'https://www.ardene.com/us/en/cart';\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.item-details .value';\n\n\t\tconst BASE_URL = 'https://www.ardene.com/on/demandware.store/Sites-ardene-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-DeleteCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(codeElement =>\n\t\t\tcodeElement.innerText.trim(),\n\t\t);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: 'Ardene',\n\tdomain: 'ardene.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_PAGE_URL) || href.startsWith(CHECKOUT_PAGE_URL);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { sessionTimer } from '../../lib';\n\n/* Driver behavior description:\n+ \tExisting code: yes\n+ \tRemove code: yes\n+ \tStackable: yes\n+ \tFree gift support: no\n+ \tFree shipping: no\n+ \tisValid implemented: yes\n+ \tCodes can be replaced by another code: no\n+ \tManually apply code: no\n+ \tPages, where extension works:\n\t\t- Cart page\n\t\t- Wishlist\n+ \tIs driver SPA yes\n    \t- On cart page when total is rendered, on checkout there's a high risk of getting a broken page/alert message after reload, no support there.\n+ \tGather codes on site pages: no\n+  \tSpecial case: no\n+  \tCredentials: no\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tconst BASE_URL = 'https://www.artvan.com';\n\t\tconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-artvan-Site/default`;\n\t\tconst FIRST_CART_URL = `${BASE_URL}/cart`;\n\t\tconst SECOND_CART_URL = `${BASE_REQUEST_URL}/Cart-SubmitForm`;\n\t\tconst WISHLIST_URL = `${BASE_URL}/on/demandware.store/Sites-artvan-Site/default/Cart-AddToWishlist`;\n\n\t\tthis.PAGES = [FIRST_CART_URL, SECOND_CART_URL, WISHLIST_URL];\n\t\tthis.isStackable = true;\n\t\tthis.TOTAL_SELECTOR = '.order-value';\n\t\tthis.EMPTY_SELECTOR = '.cart-empty';\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = FIRST_CART_URL;\n\n\t\tthis.UPDATE_REQUEST_HEADERS = {\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\taccept: 'text/html, */*; q=0.01',\n\t\t};\n\n\t\tthis.CART_PAGE_URL = FIRST_CART_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode, #dwfrm_billing_couponCode';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.SUCCESS_MESSAGE_SELECTOR = '.redemption .success';\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst isEmpty = document.querySelector(this.EMPTY_SELECTOR);\n\t\tconst isInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\n\t\treturn this._isOnCartPage() && isTotal && isInput && !isEmpty;\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn this.PAGES.some(page => window.location.href.includes(page));\n\t}\n};\n\nexport default {\n\tname: 'Art Van',\n\tdomain: 'artvan.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions, format, DOM } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n/* Behaviour\n-    Existing code: yes\n-    Remove code: yes\n-    Stackable: yes\n-    Free gift support: yes\n-    'isValid' implemented: yes\n-    Manually apply code: no\n-    Is driver SPA and add the condition to show popup: no\n * Special case:\nWe can't get price with tax on the checkout page\nDon't support checkout pages\n */\n\nconst BASE_URL = 'https://www.ashleystewart.com';\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-ashleystewart-Site/en_US`;\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-row .item-total, .checkout-mini-cart .mini-cart-product';\n\n\t\tthis.isStackable = true;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t\tsessionTimer.initialize();\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst getSummaryValue = selector => elemToFloat(extractElement(selector, responseHTML));\n\n\t\t\tconst tax = getSummaryValue(this.TAX_SELECTOR) || 0;\n\t\t\tconst shipping = getSummaryValue(this.SHIPPING_SELECTOR) || 0;\n\t\t\tconst total = getSummaryValue(this.TOTAL_SELECTOR);\n\n\t\t\treturn total - shipping - tax;\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(`${BASE_URL}/cart/`, {\n\t\t\tcredentials: 'include',\n\t\t\tmethod: 'GET',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Ashley Stewart',\n\tdomain: 'ashleystewart.com',\n\tcompletionAction: completionActions.revisit,\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\tdocument.querySelector('#dwfrm_cart_couponCode') &&\n\t\t\t(href.includes('/cart') || href.includes('/Cart-UpdateCartAJAX'))\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst CART_PAGE_URL = 'https://www.avenue.com/en_US/cart';\n\nconst { toFloat } = format;\nconst { extractElement } = DOM;\n/*\nDriver behavior:\n Existing code: yes\n Remove code: yes\n Code retesting: yes\n Stackable: no\n Free gift support: no\n isValid implemented: yes\n Show message about free shipping: no\n Cart, checkout payment section\n Driver is SPA: yes, on cart or checkout pages if it's not empty\n Gather merchant codes: yes\n\ndriver similar to loralette.com\nwe don't need to set completionAction to revisit for FF.\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-totals-value';\n\t\tthis.APPLIED_COUPON_SELECTOR = '.coupon-discount-success, .coupon-name';\n\t\tthis.HAVE_PROMO_CODE_BUTTON_SELECTOR = '#have_promo_code, .cart-coupon-code-input';\n\t\tthis.COUNT_EL_SELECTOR = '.mini-cart-amount';\n\t\tthis.EXTRA_CART_ELEMENT_SELECTOR = '.pt_cart';\n\t\tthis.MERCHANT_PROMO_SELECTOR = '.promo-info a';\n\t\tthis.MERCHANT_PROMO_REGEX = /code\\s*(\\w+)/im;\n\t\tthis.CODE_FORM_SELECTOR = '[name=\"dwfrm_cart\"]';\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping .order-totals-value';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax .order-totals-value';\n\n\t\tthis.ACTIVE_PAYMENT_SELECTOR = '.billing_block .section-box-header.active';\n\n\t\tconst BASE_URL = 'https://www.avenue.com/on/demandware.store/Sites-Avenue-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t}\n\n\tcheckCondition() {\n\t\tconst isOnHref = window.location.href.startsWith(this.CART_PAGE_URL);\n\t\tconst cartForm = document.querySelector(this.CODE_FORM_SELECTOR);\n\t\tconst countEl = document.querySelector(this.COUNT_EL_SELECTOR);\n\t\tconst isPayment = document.querySelector(this.ACTIVE_PAYMENT_SELECTOR);\n\t\tconst isCartEmpty = countEl && countEl.innerText === '0';\n\t\treturn ((isOnHref && cartForm) || isPayment) && !isCartEmpty;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.MERCHANT_PROMO_SELECTOR)]\n\t\t\t.map(el => el.innerText.match(this.MERCHANT_PROMO_REGEX))\n\t\t\t.filter(arr => arr && arr.length > 0)\n\t\t\t.map(el => el[1]);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_COUPON_SELECTOR)].map(\n\t\t\telement => element.textContent.trim().split(/\\s/)[0],\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this.removeCode(codes[0])\n\t\t\t.then(() => this.getOrderSummary())\n\t\t\t.then(response => this.parseTotal(response));\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tapplyCodes(codes) {\n\t\tif (document.querySelector(this.EXTRA_CART_ELEMENT_SELECTOR)) {\n\t\t\t// We should remove query parameters, to prevent form submitting again on cart page only\n\t\t\t// `cannotRefresh` parameter can't be used\n\t\t\t// because on checkout page `POST` request should be used for page reloading\n\t\t\twindow.history.replaceState(\n\t\t\t\twindow.history.state,\n\t\t\t\twindow.document.title,\n\t\t\t\twindow.location.href.split('?')[0],\n\t\t\t);\n\t\t}\n\t\treturn this.applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(responseHTML => {\n\t\t\tconst total = this.parseTotal(responseHTML);\n\t\t\tconst shipping = extractElement(this.SHIPPING_SELECTOR, responseHTML);\n\t\t\tconst taxes = extractElement(this.TAX_SELECTOR, responseHTML);\n\t\t\t// we have `free` for shipping when it is not calculated\n\t\t\tconst calculatedShipping = shipping && shipping.textContent.includes('FREE') ? 0 : shipping;\n\t\t\treturn (\n\t\t\t\ttotal - toFloat((taxes || {}).textContent || 0) - toFloat((calculatedShipping || {}).textContent || 0)\n\t\t\t);\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Avenue',\n\tdomain: 'avenue.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport DemandwareAJAXDriver from './_base';\nimport DWBaseDriver from '../demandware/_base';\nimport { completionActions, log, sendXhr, format, DOM } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable:  no\n+ Free gift support:  no\n+ Free shipping:  no\n+ isValid implemented:  no\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart page, billing step of the checkout\n+ Is driver SPA no\n+ Gather codes on site pages: yes, from Cart\n+ Special case about the driver works: Implemented as 2 separate drivers for Cart, Checkout\n+ Credentials (for signing in): ypa@mail.com / Temporary_1\n+ sessionTimer: 15 min\n*/\n\n// check is this cart url to manage comletionaActions and call proper driver\nconst isOnCart = () =>\n\t(window.location.href.includes('bathandbodyworks.com/cart') ||\n\t\twindow.location.href.includes('bathandbodyworks.com/on')) &&\n\tdocument.querySelector('#cart-items-form');\n// get existing codes function is same for both drivers\nconst APPLIED_CODES_SELECTOR = '[data-couponcode]';\nfunction _getExistingCodes() {\n\tconst codes = [...document.querySelectorAll(APPLIED_CODES_SELECTOR)].map(el => el.getAttribute('data-couponcode'));\n\n\treturn {\n\t\tcodes,\n\t\tcodeCount: codes.length,\n\t};\n}\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode, #dwfrm_cart_couponCode';\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\n\t\tthis.MERCHANT_CODE_SELECTOR = '.promo-banner';\n\t\tthis.MERCHANT_CODE_REGEX = /Code: (\\w+)/i;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\n\t\tconst BASE_URL = 'https://www.bathandbodyworks.com/on/demandware.store/Sites-BathAndBodyWorks-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-RemoveCouponCode`;\n\n\t\tthis.CART_PAGE_URL = 'https://www.bathandbodyworks.com/cart';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\treturn [...extractElement(this.MERCHANT_CODE_SELECTOR, response, true)]\n\t\t\t\t.filter(el => el.innerHTML.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t.map(el => el.innerHTML.match(this.MERCHANT_CODE_REGEX)[1]);\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\treturn _getExistingCodes();\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\tconst bodyData = new URLSearchParams({ code });\n\t\treturn this._sendRequestPOST(\n\t\t\tthis.REMOVE_CODE_URL,\n\t\t\t{ 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' },\n\t\t\tnull,\n\t\t\tbodyData,\n\t\t);\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch('https://www.bathandbodyworks.com/cart', {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_sendRequest(method, requestURL, headers, queryParams, bodyData) {\n\t\tconst finalRequestURL = queryParams ? `${requestURL}?${queryParams.toString()}` : requestURL;\n\t\t// In Firefox we may fail with fetch (possibly because of origin header)\n\t\treturn sendXhr(finalRequestURL, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\theaders,\n\t\t\tbody: bodyData,\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\t// Return JSON if it is possible\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t});\n\t}\n};\n\nconst RegularDwDriver = class DwDriver extends DWBaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\n\t\tthis.MERCHANT_CODE_SELECTOR = '.promo-banner';\n\t\tthis.MERCHANT_CODE_REGEX = /Code: (\\w+)/i;\n\n\t\tthis.isStackable = false;\n\t\tthis.ERROR_MESSAGE_SELECTOR = '.error-form';\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.MERCHANT_CODE_SELECTOR)]\n\t\t\t.filter(el => el.innerHTML.match(this.MERCHANT_CODE_REGEX))\n\t\t\t.map(el => el.innerHTML.match(this.MERCHANT_CODE_REGEX)[1]);\n\t}\n\n\tgetExistingCodes() {\n\t\treturn _getExistingCodes();\n\t}\n\n\tcheckCodes(codes) {\n\t\tconst originalPrice = this.parseTotal(this.lastResponse);\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst originalItemsCount = this.parseItemsCount(this.lastResponse);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code => {\n\t\t\treturn Promise.delay(1000).then(() =>\n\t\t\t\tthis.applyCode(code, this._requestData()).then(html => {\n\t\t\t\t\tconst result = {\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\t\tisValid: false,\n\t\t\t\t\t};\n\t\t\t\t\tif (this._codeAppliedCheck(html)) {\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t}\n\t\t\t\t\tthis.lastResponse = html;\n\t\t\t\t\tresult.finalPrice = this.parseTotal(html);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\t\t\t\t\tresult.isValid = true;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(this._removeValueName(code), this._requestData()).then(removeCodeHtml => {\n\t\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t);\n\t\t}).then(() => {\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t\toriginalItemsCount,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Bath & Body Works',\n\tdomain: 'bathandbodyworks.com',\n\tcompletionAction: completionActions.revisit,\n\tget Driver() {\n\t\treturn isOnCart() ? RegularDwDriver : Driver;\n\t},\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t(href.includes('bathandbodyworks.com/cart') ||\n\t\t\t\thref.includes('bathandbodyworks.com/checkout') ||\n\t\t\t\thref.includes('bathandbodyworks.com/on')) &&\n\t\t\tdocument.querySelector('#cart-items-form, #dwfrm_billing')\n\t\t);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { extractElement } from '../../../utils/DOM';\nimport { elemToFloat } from '../../../utils/format';\n\nconst CART_PAGE_URL = 'https://www.bcbg.com/en/cart';\nconst IS_ON_CHECKOUT = window.location.href.toLowerCase().includes('checkout');\n\n/* Driver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout(where is code input)\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n* */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-total-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.appliedCoupon .cartcoupon .value';\n\t\tthis.isStackable = false;\n\n\t\tconst BASE_URL = 'https://www.bcbg.com/on/demandware.store/Sites-BCBG-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Checkout-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/Checkout-RefreshSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.CODE_INPUT_SELECTOR = '.toShow #dwfrm_billing_couponCode, #dwfrm_cart_couponCode';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t\tthis.updateQueryParams.set('format', 'ajax');\n\n\t\tthis.BILLING_SECTION = '#onepage_billing.active';\n\t\tthis.SAME_TO_SHIIPING_SELECTOR = '#shipAsBill:checked';\n\t\tthis.LOGIN_SECTION = '#onepage_account.active';\n\t\tthis.ORDER_SUMMARY_ACTIVE = '#onepage_summary.active';\n\t\tthis.SHIPPING_ACTIVE = '#onepage_shipping.active';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t}\n\n\tcheckCondition() {\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst onCart = window.location.href.toLowerCase().includes('cart');\n\t\tconst isBilling = document.querySelector(this.BILLING_SECTION);\n\t\tconst isSameToShipping = document.querySelector(this.SAME_TO_SHIIPING_SELECTOR);\n\t\tconst isLogin = document.querySelector(this.LOGIN_SECTION);\n\t\tconst isOrderSummary = document.querySelector(this.ORDER_SUMMARY_ACTIVE);\n\t\tconst isShipping = document.querySelector(this.SHIPPING_ACTIVE);\n\t\tconst currentState =\n\t\t\t((IS_ON_CHECKOUT && ((isBilling && isSameToShipping) || isLogin || isOrderSummary || isShipping)) ||\n\t\t\t\tonCart) &&\n\t\t\t(codeInput && codeInput.offsetParent);\n\t\treturn currentState;\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'BCBG',\n\tdomain: 'bcbg.com',\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { completionActions, DOM, log } from '../../../utils';\n\nconst { extractFormValues } = DOM;\n\nconst CART_PAGE_URL = 'https://www.bobstores.com/shoppingcart';\nconst CART_INPUT = 'dwfrm_cart_couponCode';\nconst CHECKOUT_INPUT = 'dwfrm_billing_couponCode';\nconst isOnCart = () => document.querySelector(`#${CART_INPUT}`);\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = true;\n\n\t\tthis.CART_FORM_SELECTOR = 'form[name=dwfrm_cart]';\n\t\tthis.CHECKOUT_FORM_SELECTOR = '#dwfrm_billing';\n\n\t\tthis.APPLY_CODE_URL = CART_PAGE_URL;\n\t\tthis.REMOVE_CODE_URL = this.APPLY_CODE_URL;\n\t\tthis.UPDATE_REQUEST_URL = CART_PAGE_URL;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = isOnCart() ? CART_INPUT : CHECKOUT_INPUT;\n\t\tthis.REMOVE_CODE_PARAM_NAME = CART_INPUT;\n\t\tthis.CODE_INPUTS_SELECTOR = `#${CART_INPUT}, #${CHECKOUT_INPUT}`;\n\t\tthis.CART_EMPTY_SELECTOR = '.cart-empty';\n\t}\n\n\twatchForCartUrl() {\n\t\tlet previousState = false;\n\t\tsetInterval(() => {\n\t\t\tconst isCodeInput = document.querySelector(this.CODE_INPUTS_SELECTOR);\n\t\t\tconst isCartEmpty = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\t\tconst currentState = isCodeInput && !isCartEmpty;\n\t\t\tif (currentState !== previousState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tpreviousState = currentState;\n\t\t}, 500);\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.applyQueryParams = extractFormValues(\n\t\t\tisOnCart() ? this.CART_FORM_SELECTOR : this.CHECKOUT_FORM_SELECTOR,\n\t\t).params;\n\t\treturn Promise.resolve();\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(response => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t};\n\n\t\t\t\tconst successState = this._getValueFromJSON(response);\n\n\t\t\t\tif (successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\tresult.finalPrice = this.parseTotal(response);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.freeGifts = this.parseItemsCount(response) - originalItemsCount;\n\n\t\t\t\tif (\n\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\n\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.isStackable) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t\toriginalItemsCount,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tapplyCode(code) {\n\t\tthis.applyQueryParams.set(this.APPLY_CODE_PARAM_NAME, code);\n\t\tif (isOnCart()) {\n\t\t\tthis.applyQueryParams.set('dwfrm_cart_addCoupon', 'dwfrm_cart_addCoupon');\n\t\t} else {\n\t\t\tthis.applyQueryParams.set('dwfrm_billing_applyCoupon', 'Apply');\n\t\t}\n\n\t\treturn this._sendRequestPOST(window.location.href, this.APPLY_REQUEST_HEADERS, null, this.applyQueryParams);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn isOnCart();\n\t}\n};\n\nexport default {\n\tname: \"Bob's Stores\",\n\tdomain: 'bobstores.com',\n\tcompletionAction: completionActions.revisit,\n\tisSinglePageApp: true,\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn true;\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { extractElement } from '../../../utils/DOM';\nimport { elemToFloat } from '../../../utils/format';\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Manually apply code: no\n+ Pages, where extension works: Billing\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.APPLIED_CODE_SELECTOR = 'button[data-coupon]';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tconst BASE_URL = 'https://us.boohoo.com/on/demandware.store/Sites-boohoo-NA-Site/en_US/';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}COBilling-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}COBilling-UpdateSummary`;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'couponID';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODE_SELECTOR)].map(el => el.dataset.coupon);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeCheckCodes(originalPrice) {\n\t\tif (originalPrice) {\n\t\t\treturn originalPrice;\n\t\t}\n\t\t// if delete code manually on page present two different totals price (current and old)\n\t\t// need to send request to get right total\n\t\treturn this.getOrderSummary().then(response => this.parseTotal(response));\n\t}\n\n\tapplyCode(code) {\n\t\tthis.applyQueryParams.set(this.APPLY_CODE_PARAM_NAME, code);\n\n\t\treturn this._sendRequestPOST(this.APPLY_CODE_URL, this.APPLY_REQUEST_HEADERS, this.applyQueryParams);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst taxEl = extractElement(this.TAX_SELECTOR, response);\n\t\t\tconst tax = taxEl ? elemToFloat(taxEl) || 0 : 0;\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Boohoo',\n\tdomain: 'boohoo.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://us.boohoo.com/billing-continue');\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { toFloat } from '../../../utils/format';\nimport { extractElement } from '../../../utils/DOM';\n\n/* Diver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Pages, where extension works: billing\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_SUMMARY_SELECTOR = '.js-checkout-order-totals';\n\t\tthis.TOTAL_SELECTOR = `${this.CART_SUMMARY_SELECTOR} .order-total .order-value`;\n\t\tthis.SHIPPING_SELECTOR = `${this.CART_SUMMARY_SELECTOR} .order-shipping td:last-child`;\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = `${this.CART_SUMMARY_SELECTOR} .discounts-delivery-row`;\n\t\tthis.isStackable = false;\n\n\t\tconst BASE_URL = 'https://www.boohooman.com/on/demandware.store/Sites-boohooman-US-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'couponID';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.js-couponcode [data-coupon]';\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(element =>\n\t\t\telement.getAttribute('data-coupon'),\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tapplyCode(code) {\n\t\tthis.applyQueryParams.set(this.APPLY_CODE_PARAM_NAME, code);\n\t\treturn this._sendRequestPOST(this.APPLY_CODE_URL, this.APPLY_REQUEST_HEADERS, this.applyQueryParams);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shippingDiscountElem = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst shippingElem = extractElement(this.SHIPPING_SELECTOR, response);\n\t\t\tconst shipping = shippingElem ? toFloat(shippingElem.innerText) : 0;\n\t\t\tconst shippingDiscount = shippingDiscountElem ? toFloat(shippingDiscountElem.innerText) : 0;\n\t\t\treturn this.parseTotal(response) - shipping + shippingDiscount;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Boohoo Man',\n\tdomain: 'boohooman.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.boohooman.com/us/billing-continue');\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM } from '../../../utils';\n\nconst { extractElementFromHTML } = DOM;\n\nconst CART_PAGE_URL = 'https://www.boxlunch.com/cart';\nconst CART_FORM_SELECTOR = '#cart-items-form';\nconst isOnCartPage = () => Boolean(document.querySelector(CART_FORM_SELECTOR));\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: yes\n    Free gift support: no\n    isValid implemented: yes\n    Manually apply code: no\nOptional:\n    Show message about free shipping on the cart page: no\n    Is driver SPA and add the condition to show popup: yes\n    Gather codes on site pages: no */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode, #dwfrm_billing_couponCode';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon, #apply-coupon';\n\t\tthis.REMOVE_SELECTOR = '.remove-coupon, .coupon-applied .remove';\n\n\t\tthis.BASE_URL = 'https://www.boxlunch.com/on/demandware.store/Sites-boxlunch-Site/default';\n\t\tthis.APPLY_CODE_URL = `${this.BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${this.BASE_URL}/Cart-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${this.BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.isStackable = true;\n\n\t\tthis.MAX_WAIT_TIME = 2500;\n\t\tthis.TIME_STEP = 500;\n\t}\n\n\tcheckCondition() {\n\t\tconst currentState = !!document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\treturn currentState && isOnCartPage();\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this.getCartPage().then(html => {\n\t\t\tconst codes = [...extractElementFromHTML(html, this.CODE_VALUE_SELECTOR, true)]\n\t\t\t\t.filter(el => Boolean(el))\n\t\t\t\t.map(element => element.innerText.trim());\n\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn super.applyCodes(codes).then(() => super.applyCode(codes[0]));\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn isOnCartPage();\n\t}\n};\n\nexport default {\n\tname: 'BoxLunch',\n\tdomain: 'boxlunch.com',\n\tisSinglePageApp: true,\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\n\nconst CART_PAGE_URL = 'https://www.carolsdaughter.com/cart';\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: yes\n    Free gift support: no\n    isValid implemented: no\n    Active pages: cart, checkout(payment step)\nOptional:\n    Show message about free shipping on the cart page: no\n    Is driver SPA and add the condition to show popup: yes\n    Gather codes on site pages: no */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order_total td:nth-child(2)';\n\n\t\tthis.CODE_REMOVE_BTN_SELECTOR = '.remove_coupon, .couponcode_remove_button';\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tconst BASE_URL =\n\t\t\t'https://www.carolsdaughter.com/on/demandware.store/Sites-carolsdaughter-us-Site/default/Cart-AddRemoveCoupon';\n\t\tthis.APPLY_CODE_URL = BASE_URL;\n\t\tthis.REMOVE_CODE_URL = BASE_URL;\n\t\tthis.UPDATE_REQUEST_URL = this.CART_PAGE_URL;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.isStackable = true;\n\n\t\tthis.CODE_ELEM_SELECTOR = '#form_couponcode';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart_empty';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.applyQueryParams.set('type', 'add');\n\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('type', 'remove');\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnCart = href.startsWith(CART_PAGE_URL) || href.includes('/Cart-AddToWishlist');\n\t\tconst isOnCheckout = href.includes('/COCheckout-Show');\n\t\tconst checkoutCouponForm = document.querySelector(this.CODE_ELEM_SELECTOR);\n\t\tconst totalElem = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\treturn !emptyCart && totalElem && (isOnCart || (isOnCheckout && checkoutCouponForm));\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.CODE_REMOVE_BTN_SELECTOR)]\n\t\t\t.filter(Boolean) // need for checkout\n\t\t\t.map(codeElement => codeElement.getAttribute('value') || codeElement.getAttribute('data-coupon'))\n\t\t\t.filter(Boolean);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: \"Carol's Daughter\",\n\tdomain: 'carolsdaughter.com',\n\tstackable: true,\n\tDriver,\n\tisSinglePageApp: true,\n};\n","/*    eslint class-methods-use-this: [\"error\", { \"exceptMethods\": [\"_isOnCartPage\", \"applyCodes\", \"_codeAppliedCheck\", \"watchForCartUrl\"] }] */\nimport Promise from 'bluebird';\n\nimport DemandwareDriver from './_base';\nimport { DOM, completionActions } from '../../../utils';\nimport { elemToFloat } from '../../../utils/format';\n\nconst { extractData, extractFormValues, extractElement } = DOM;\n\nconst MERCHANT_URL = 'https://www.christopherandbanks.com';\nconst CART_PAGE_URL = `${MERCHANT_URL}/cart`;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+\n+ Pages, where extension works:\n    - Cart page\n    - Checkout page (all steps except 'Shipping and Address' step)\n+ Is driver SPA yes/no\n    - right URL\n\t- not empty\n\t- right step on the checkout\n+ Gather codes on site pages: no\n+ Credentials (for signing in)\n*/\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.REMOVE_PARAMS = extractFormValues('#cart-items-form');\n\n\t\tthis.TOTAL_SELECTOR = '.order-value ';\n\n\t\tthis.isStackable = true;\n\n\t\tthis.DEFAULT_REMOVE_CODE_VALUE = '';\n\n\t\tconst BASE_URL = `${MERCHANT_URL}/on/demandware.store/Sites-CBKB2C-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.REMOVE_COUPON_PARAM_VALUE = 'delete';\n\n\t\tthis.APPLY_RESPONSE_KEY = null;\n\n\t\tthis.CART_EMPTY_SELECTOR = '.cart-empty';\n\t\tthis.SHIPPING_STEP_SELECTOR = '#dwfrm_singleshipping_shippingAddress';\n\t\tthis.isOnCartPage = () => window.location.href.startsWith(CART_PAGE_URL);\n\n\t\tthis.CHARGES_REGEX = /(shipping|tax)/i;\n\t\tthis.CHARGES_SELECTOR = '.order-totals-table .value';\n\n\t\tthis.CSRF_TOKEN_SELECTOR = '[name*=csrf_token]';\n\t}\n\n\tcheckCondition() {\n\t\tconst isOnCartUrl = this.isOnCartPage() || window.location.href.startsWith(`${MERCHANT_URL}/checkout`);\n\t\tconst isShippingStep = (document.querySelector(this.SHIPPING_STEP_SELECTOR) || {}).offsetParent;\n\t\tconst emptyCart = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\treturn isOnCartUrl && !emptyCart && !isShippingStep;\n\t}\n\n\tbeforeTestCodes() {\n\t\treturn this.getCartPage().then(response => {\n\t\t\tconst csrfToken = [...extractElement(this.CSRF_TOKEN_SELECTOR, response, true)].reduce(item => item.value)\n\t\t\t\t.value;\n\n\t\t\treturn this.applyQueryParams.set('csrf_token', csrfToken);\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\treturn (this.isOnCartPage() ? Promise.resolve(null) : this._sendRequestGET(this.CART_PAGE_URL, {})).then(\n\t\t\tresponseHTML => {\n\t\t\t\tconst codes = extractData(this.CODE_VALUE_SELECTOR, responseHTML, true).map(code => code.trim());\n\n\t\t\t\treturn {\n\t\t\t\t\tcodes,\n\t\t\t\t\tcodeCount: codes.length,\n\t\t\t\t};\n\t\t\t},\n\t\t);\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await this.getOrderSummary();\n\t\tconst total = this.parseTotal(cartStr);\n\n\t\tconst taxes = [...extractElement(this.CHARGES_SELECTOR, cartStr, true)]\n\t\t\t.filter(el => el.parentElement.textContent.match(this.CHARGES_REGEX))\n\t\t\t.map(el => (el.textContent.toLowerCase().trim() !== 'free' ? elemToFloat(el) : 0))\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((charges, charge) => charges + charge, 0); // shipping & tax might not be counted on cart\n\t\treturn total - taxes;\n\t}\n\n\t_getRemoveValueName(code, html) {\n\t\tconst matchingCodesElement = [...extractElement(this.CODES_ELEMENTS_SELECTOR, html, true)].find(element => {\n\t\t\tconst codesElement = element.querySelector(this.CODE_VALUE_SELECTOR);\n\t\t\treturn codesElement && codesElement.innerText.trim().toLowerCase() === code.toLowerCase();\n\t\t});\n\n\t\treturn matchingCodesElement\n\t\t\t? matchingCodesElement.querySelector(this.REMOVE_CODE_SELECTOR).name\n\t\t\t: this.DEFAULT_REMOVE_CODE_VALUE;\n\t}\n};\n\nexport default {\n\tname: 'Christopher & Banks',\n\tdomain: 'christopherandbanks.com',\n\tisSinglePageApp: true,\n\tcompletionAction: completionActions.revisit,\n\tstackable: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { extractElement } from '../../../utils/DOM';\nimport { log } from '../../../utils';\nimport { elemToFloat } from '../../../utils/format';\n\n/**\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support:  no\n+ Free shipping: no\n+ isValid implemented:  no\n+ Codes can be replaced by another code: no\n+ Pages, where extension works:\n   - cart\n   - billing page\n+ Is driver SPA: no\n+ Gather codes on site pages:  no\n+ Merchant has a bug. On some codes, merchant can show a bigger discount than we have on the page.\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLIED_CODES_SELECTOR = '.cart-v2-coupon-block div span.v2-small.v2-semi-bold';\n\n\t\tthis.TOTAL_SELECTOR =\n\t\t\t'.order-total .order-value, #cart-v2-order-totals-body .cart-v2-actions span:last-of-type';\n\n\t\tconst BASE_URL = 'https://www.claires.com/on/demandware.store/Sites-clairesNA-Site/en_US/';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}Cart-CheckCoupon`;\n\n\t\tthis.CART_PAGE_URL = 'https://www.claires.com/us/shopping-cart/';\n\t\tthis.REMOVE_CODE_URL = 'https://www.claires.com/us/shopping-cart-coupon/';\n\t\tthis.UPDATE_REQUEST_URL = this.REMOVE_CODE_URL;\n\n\t\tthis.APPLY_RESPONSE_KEY = null;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\taccept: 'application/json, text/javascript, */*; q=0.01',\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\t\tthis.REMOVE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\t\tthis.UPDATE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\n\t\tthis.CHECKOUT_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\t\tthis.CHECKOUT_BUTTON_SELECTOR = '#add-coupon';\n\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\t\tthis.MERCHANT_CODES_SELECTOR = '#homepage-promotion-banners span b';\n\t\tthis.MERCHANT_CODES_REGEX = /:\\s([\\d\\w]+)/;\n\t\tthis.CHARGES_SELECTOR = '#cart-v2-order-totals-body span:last-child, .order-totals-table td:last-child';\n\t\tthis.DELIVERY_REGEX = /delivery|shipping/i;\n\t\tthis.CHARGES_REGEX = /delivery|tax|shipping|subtotal/i;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._sendRequestGET('https://www.claires.com/us/').then(responseHTML => {\n\t\t\treturn [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...extractElement(this.MERCHANT_CODES_SELECTOR, responseHTML, true)]\n\t\t\t\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODES_REGEX))\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.map(el => el[1]),\n\t\t\t\t),\n\t\t\t];\n\t\t});\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this.removeCode(code))\n\t\t\t.then(() => this.getCartPage())\n\t\t\t.then(response => ({\n\t\t\t\toriginalPrice: this.parseTotal(response),\n\t\t\t\toriginalItemsCount: this.parseItemsCount(response),\n\t\t\t}));\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.getCartPage().then(responseHTML => {\n\t\t\tconst removeParamName = this._getRemoveValueName(code, responseHTML);\n\t\t\tif (!removeParamName) {\n\t\t\t\t// No need in the reuqest, as parameter name was not found for the code\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\tthis.removeQueryParams.set(removeParamName, 'Remove');\n\n\t\t\treturn this._sendRequestPOST(\n\t\t\t\tthis.REMOVE_CODE_URL,\n\t\t\t\t{ 'x-requested-with': 'XMLHttpRequest' },\n\t\t\t\tnull,\n\t\t\t\tthis.removeQueryParams,\n\t\t\t);\n\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\n\t\t\t\tif (!applyCodeResponse.success) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this.getCartPage().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await this.getCartPage();\n\t\tconst total = this.parseTotal(cartStr);\n\t\tconst chargesElem = [...extractElement(this.CHARGES_SELECTOR, cartStr, true)];\n\n\t\tconst allTaxes = chargesElem\n\t\t\t.filter(el => el.parentElement.textContent.match(this.CHARGES_REGEX))\n\t\t\t.map(elemToFloat)\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((charges, charge) => charges + charge, 0); // shipping might not be counted on cart\n\t\tconst delivery = chargesElem\n\t\t\t.filter(el => el.parentElement.textContent.match(this.DELIVERY_REGEX))\n\t\t\t.map(elemToFloat)\n\t\t\t.filter(Boolean);\n\t\t// when user test codes on the checkout page we can't send request to this page and get all charges due to the very big body in the request.\n\t\t// also on the cart page tax is not present in the page but it is counted to the total price\n\t\t// so we send request to the cart page, get from there all subtotal, shipping and subtract from the total it to determine tax value\n\t\tconst tax = total - allTaxes;\n\t\treturn total - tax - delivery;\n\t}\n};\n\nexport default {\n\tname: \"Claire's\",\n\tdomain: 'claires.com',\n\tDriver,\n\tisCartEmpty() {\n\t\tconst emptyCart = !document.querySelector(\n\t\t\t'.order-total .order-value, #cart-v2-order-totals-body .cart-v2-actions span:last-of-type',\n\t\t);\n\t\tconst header = document.querySelector('#primary h1');\n\n\t\tconst path = window.location.pathname.toLowerCase();\n\t\tconst errorPage =\n\t\t\theader &&\n\t\t\theader.innerText === 'An Error Occurred!' &&\n\t\t\t(path.includes('/shopping-cart-coupon') || path.includes('/us/checkout-billing/'));\n\n\t\treturn errorPage || emptyCart;\n\t},\n\tisOnCartUrl(href) {\n\t\tconst hrefLowerCase = href.toLowerCase();\n\t\treturn (\n\t\t\threfLowerCase.startsWith('https://www.claires.com/us/shopping-cart') ||\n\t\t\threfLowerCase.startsWith('https://www.claires.com/us/checkout-billing')\n\t\t);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\nconst DOMAIN = 'https://www.clubmonaco.com';\nconst BASE_URL = `${DOMAIN}/on/demandware.store/Sites-ClubMonaco_US-Site/en_US`;\nconst CHECKOUT_PAGE_URL = `${DOMAIN}/en/billing`;\nconst REVIEW_PAGE_URL = `${BASE_URL}/COBilling-Billing`;\nconst isOnReview = () => window.location.href.includes(REVIEW_PAGE_URL);\nconst CART_PAGE_URL = `${DOMAIN}/en/cart`;\nconst isOnCart = window.location.href.includes(CART_PAGE_URL);\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: yes\n+ Free shipping: no\n+ isValid implemented: yes\n+ Replace code: yes\n+ Manually apply code: no\n+ Pages, where extension works: \n\t- Cart\n\t- Checkout(shipping and payment steps)\n+ Is SPA: yes\n+ Gather codes on site pages: no\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_ELEMENT_CONFIG = {\n\t\t\tselector: this.TOTAL_SELECTOR,\n\t\t};\n\t\tthis.APPLIED_CODES_SELECTOR = '#success-coupon-code strong';\n\t\tthis.PRODUCT_ITEM_SELECTOR = isOnReview() ? '.cart-row' : '.mini-cart-product';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-DeleteCouponCode`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'couponcode';\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping > td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax > td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount > td:last-child';\n\t\tthis.SPINNER_SELECTOR = '.loader-indicator';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnRightUrl = isOnCart || href.includes(CHECKOUT_PAGE_URL) || href.includes(REVIEW_PAGE_URL);\n\t\tconst isSpinner = document.querySelector(this.SPINNER_SELECTOR);\n\t\tconst isItemInCart = document.querySelector(this.PRODUCT_ITEM_SELECTOR);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\treturn isOnRightUrl && !isSpinner && isItemInCart && isTotal;\n\t}\n\n\tremoveCode(code) {\n\t\tif (isOnCart) {\n\t\t\treturn this.removeCodeOnCart(code);\n\t\t}\n\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\treturn this._sendRequestGET(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) || 0 : 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax + shippingDiscount;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Club Monaco',\n\tdomain: 'clubmonaco.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\n\n// Behavior description:\n// we can apply only one code at the same time\n// we can`t replace a valid code with invalid one\n// we can`t remove applied code\n// one valid code can replace invalid code\n// requests for the cart are used on the checkout page\n// discount is counted from the total that was set before run extension\n// we support only cart, bacause on the checkout page all user data will be erased\n\nconst DOMAIN_URL = 'coldwatercreek.com';\nconst DOMAIN_CART_URL = `${DOMAIN_URL}/cart`;\nconst CHECKOUT_INPUT_CODE_FLD = '#dwfrm_billing_couponCode';\nconst CART_INPUT_CODE_FLD = '#dwfrm_cart_couponCode';\nconst INPUT_CODE_FLD = `${CART_INPUT_CODE_FLD}, ${CHECKOUT_INPUT_CODE_FLD}`;\nconst isOnCart = () => Boolean(document.querySelector(CART_INPUT_CODE_FLD));\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.IS_ON_CART = isOnCart();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-totals-value';\n\t\tthis.APPLIED_CODES_REGEX = /order_coupon_promo_code\": \"(\\w*)/;\n\t\tthis.isStackable = false;\n\n\t\tthis.CART_PAGE_URL = `https://www.${DOMAIN_CART_URL}`;\n\t\tconst BASE_URL = `https://www.${DOMAIN_URL}/on/demandware.store/Sites-coldwater_us-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = this.IS_ON_CART ? this.CART_PAGE_URL : `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\n\t\tthis.CHECKOUT_APPLY_BTN_SELECTOR = '#add-coupon';\n\t\tthis.CHECKOUT_CODE_MESSAGE_SELECTOR = '.form-indent .redemption-code, .form-indent .error';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t}\n\n\tgetExistingCodes() {\n\t\t/* On the checkout page codes are applied without refreshing the page, so if a user applies codes 2\n\t\ttimes manually without refreshing the page before extension work then the first code will be extracted.\n\t\tFrom UpdatedCart we can get it right. */\n\n\t\treturn this.getCartPage().then(responseHTML => {\n\t\t\tconst codesRegex = responseHTML.match(this.APPLIED_CODES_REGEX);\n\t\t\tconst codes = codesRegex ? [codesRegex[1]] : [];\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\tapplyCodes(codes) {\n\t\t// remove messages from previous applied codes\n\t\t[...document.querySelectorAll(this.CHECKOUT_CODE_MESSAGE_SELECTOR)].map(element => element.remove());\n\t\treturn this.applyCode(codes[0]);\n\t}\n\n\t// No possibility to remove a code\n\tremoveCode() {\n\t\treturn Promise.resolve();\n\t}\n};\n\nexport default {\n\tname: 'Coldwater Creek',\n\tdomain: 'coldwatercreek.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.includes(DOMAIN_CART_URL) && Boolean(document.querySelector(INPUT_CODE_FLD));\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { format, DOM } from '../../../utils';\nimport { handleDriverError } from '../../lib';\n\nconst { elemToFloat, toFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nDriver behavior:\n   Existing code: yes\n   Remove code: yes\n   Code retesting: yes\n   Stackable: yes\n   Free gift support: no\n   isValid implemented: no\n   Show message about free shipping: no\n   Driver is SPA: yes, on cart & checkout-payment\n   Gather merchant codes: no\n   Special case:\n\t\t- after visiting PayPal checkout page, coupon codes can be neither applied nor removed.\n\t\tAs a result, once user returns back to cart from the PP checkout, all codes would be\n\t\tmarked as not valid\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLY_CODE_BUTTON_SELECTOR = '#csc-checkout-btn-apply-promo-code';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty:not([class*=\"d-none\"])';\n\t\tthis.CART_CODE_INPUT_SELECTOR = '#csc-coupon-code';\n\t\tthis.CHECKOUT_CODE_INPUT_SELECTOR = '#csc-checkout-promo-code';\n\t\tthis.CODE_VALUE_SELECTOR = '#csc-table-coupon-codes [data-transaction]';\n\t\tthis.PAYMENT_STEP_SELECTOR = '#csc-collapse-payment.show';\n\t\tthis.TOTAL_SELECTOR =\n\t\t\t'#csc-amount-total, #csc-amount-paypal, #csc-checkout-order-summary-total, #csc-amount_due';\n\t\tthis.CONTAINER_SELECTOR = '#csc-checkout-order-summary-child';\n\t\tthis.SHIPPING_SELECTOR = `${this.CONTAINER_SELECTOR} #csc-checkout-order-summary-shipping`;\n\t\tthis.TAX_SELECTOR = `${this.CONTAINER_SELECTOR} .summary-container.summary .text-left`;\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.columbia.com/on/demandware.store/Sites-Columbia_US-Site/en_US/SinglePageCheckout';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}-AddCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}-UpdateOrderSummary`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'removeCoupon';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t\tthis.updateQueryParams.set('format', 'ajax');\n\n\t\tthis.APPLY_RESPONSE_KEY = null;\n\t}\n\n\tcheckCondition() {\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst promoInputVisible =\n\t\t\tdocument.querySelector(this.CART_CODE_INPUT_SELECTOR) ||\n\t\t\t(document.querySelector(this.CHECKOUT_CODE_INPUT_SELECTOR) &&\n\t\t\t\tdocument.querySelector(this.PAYMENT_STEP_SELECTOR));\n\n\t\treturn !isCartEmpty && promoInputVisible;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(\n\t\t\telement => element.dataset.transaction,\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(responseHTML => {\n\t\t\tlet total;\n\t\t\t// seems like sometimes response might not contain total selector\n\t\t\ttry {\n\t\t\t\ttotal = this.parseTotal(responseHTML);\n\t\t\t} catch (e) {\n\t\t\t\thandleDriverError(new Error('Invalid response string. Cannot parse total'), {\n\t\t\t\t\terrorMessage: e,\n\t\t\t\t\tresponse: responseHTML,\n\t\t\t\t});\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// shipping may be free\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, responseHTML)) || 0;\n\t\t\tconst taxElem = [...extractElement(this.TAX_SELECTOR, responseHTML, true)]\n\t\t\t\t.filter(elem => elem.innerText.trim().toLowerCase() === 'sales tax')\n\t\t\t\t.map(elem => elem.nextElementSibling.innerText);\n\t\t\tconst tax = toFloat(taxElem[0]) || 0;\n\t\t\treturn total - shipping - tax;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Columbia',\n\tdomain: 'columbia.com',\n\tisSinglePageApp: true,\n\tstackable: true,\n\tDriver,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { elemToFloat } from '../../../utils/format';\nimport { extractElement } from '../../../utils/DOM';\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes (can remove on basket)\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Manually apply code: no\n+ Pages, where extension works: Payment\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_PAGE_URL = 'https://www.crabtree-evelyn.com/cart';\n\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\n\t\tthis.BASE_URL = 'https://www.crabtree-evelyn.com/on/demandware.store/Sites-crabtreeevelyn_us-Site/default';\n\t\tthis.APPLY_CODE_URL = `${this.BASE_URL}/Cart-AddCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${this.BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.rowcoupons .cart-value';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping .valuealign';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax .valuealign';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.isStackable = true;\n\t}\n\n\tcheckCondition() {\n\t\treturn Boolean(document.querySelector(this.CODE_INPUT_SELECTOR));\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response));\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response));\n\t\t\tconst calculatedTax = tax || 0;\n\t\t\tconst calculatedShipping = shipping || 0;\n\t\t\treturn this.parseTotal(response) - calculatedShipping - calculatedTax;\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code.toUpperCase());\n\t}\n\n\tapplyCode(code) {\n\t\treturn super.applyCode(code.toUpperCase());\n\t}\n\n\t_isOnCartPage() {\n\t\treturn document.querySelector(this.CART_FORM_SELECTOR);\n\t}\n};\n\nexport default {\n\tname: 'Crabtree & Evelyn',\n\tdomain: 'crabtree-evelyn.com',\n\tisSinglePageApp: true,\n\tstackable: true,\n\tDriver,\n};\n","import DemandwareAJAXDriver from './_base';\n\n// Behavior description:\n// Driver is not stackable\n// codes can be applied on the cart and on the checkout page\n// codes can be removed only on the cart\n// a valid code can't be replaced by another code or removed by applying invalid code\n// GET requests from the checkout page is used for applying code\n// POST request from the cart is used for removing code\n\nconst DOMAIN_URL = 'destinationmaternity.com';\nconst DOMAIN_CART_URL = `${DOMAIN_URL}/cart/`;\nconst DOMAIN_CHECKOUT_URL = `${DOMAIN_URL}/billing/`;\nconst INPUT_CODE_FLD_SELECTOR = '#dwfrm_cart_couponCode, #dwfrm_billing_couponCode';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value';\n\n\t\tthis.CART_PAGE_URL = `https://www.${DOMAIN_CART_URL}`;\n\t\tthis.CHECKOUT_PAGE_URL = `https://www.${DOMAIN_CHECKOUT_URL}`;\n\t\tconst BASE_URL = `https://www.${DOMAIN_URL}/on/demandware.store/Sites-dmat-us-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = this._isOnCartPage ? this.CART_PAGE_URL : this.CHECKOUT_PAGE_URL;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isRightUrl =\n\t\t\thref.includes(this.CART_PAGE_URL) ||\n\t\t\thref.includes(this.CHECKOUT_PAGE_URL) ||\n\t\t\thref.includes('/Cart-SubmitForm') ||\n\t\t\thref.includes('/shipping') ||\n\t\t\thref.includes(`${DOMAIN_URL}/on/demandware.store/Sites-dmat-us-Site/default/Cart-AddToWishlist`);\n\t\tconst isCodeInput = document.querySelector(INPUT_CODE_FLD_SELECTOR);\n\t\treturn isRightUrl && isCodeInput;\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t// the checkout page also can startsWith cart\n\t_isOnCartPage() {\n\t\treturn Boolean(document.querySelector(this.CART_FORM_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'Destination Maternity',\n\tdomain: 'destinationmaternity.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import DemandwareAJAXDriver from './_base';\n\nconst BASE_URL = 'https://www.donaldpliner.com';\n\nconst INPUT_CODE_FLD_SELECTOR = '#dwfrm_cart_couponCode';\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: yes\n    Free gift support: no\n    isValid implemented: yes\n    Manually apply code: no\nOptional:\n    Show message about free shipping on the cart page (without discount info): no\n    Is driver SPA and add the condition to show popup: no\n    Gather codes on site pages: no\n    Can apply code only on `Cart` page\n\n======== Special case ==========\nNot support `Checkout`. Site applies code and shows\nsuccessful message but doesn't change total. */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = true;\n\n\t\tthis.CART_PAGE_URL = `${BASE_URL}/cart`;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/on/demandware.store/Sites-donaldpliner-Site/default/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = this.CART_PAGE_URL;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n};\n\nexport default {\n\tname: 'Donald Pliner',\n\tdomain: 'donaldpliner.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t(href.startsWith(`${BASE_URL}/cart`) ||\n\t\t\t\thref.startsWith(`${BASE_URL}/on/demandware.store/Sites-donaldpliner-Site/default/Cart-SubmitForm`)) &&\n\t\t\tBoolean(document.querySelector(INPUT_CODE_FLD_SELECTOR))\n\t\t);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst CART_PAGE_URL = 'https://www.dwr.com/cart';\nconst TOTAL_SELECTOR = '.order-total .order-value';\nconst INPUT_CODE_BLOCK_SELECTOR = '.have-a-promo-code';\nconst BASE_URL = 'https://www.dwr.com';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+\n+ Pages, where extension works:\n\t- Cart page\n\t- Checkout page\n\n+ Is driver SPA no\n+ Gather codes on site pages: no\n*/\n\nconst URLS = [\n\t`${BASE_URL}/billing`,\n\t`${BASE_URL}/shipping`,\n\t`${BASE_URL}/checkout`,\n\t`${BASE_URL}/on/demandware.store/Sites-dwr-Site`,\n\tCART_PAGE_URL,\n];\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = TOTAL_SELECTOR;\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.DISCOUNT_SELECTOR = '.order-discount.rowcoupons';\n\n\t\tthis.APPLY_CODE_URL = 'https://www.dwr.com/on/demandware.store/Sites-dwr-Site/en_US/Cart-AddCouponJson';\n\t\tthis.REMOVE_CODE_URL = this.APPLY_CODE_URL;\n\t\tthis.UPDATE_REQUEST_URL = CART_PAGE_URL;\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\t// Looks like we may recieve that code isn't valid, but actually it is\n\t\t// so safer to skip this check\n\t\tthis.APPLY_RESPONSE_KEY = null;\n\t\tthis.APPLIED_CODES_REGEX = /couponCode=(\\w*)/;\n\t\tthis.APPLIED_CODE_SELECTOR = '.country a';\n\t\tthis.CHECKOUT_BTN_SELECTOR = '#button-checkout-cart';\n\n\t\t// seems like it's better not to check url here since there are some cases\n\t\t// where url can change after some activity on the page\n\t\tthis.isOnCartPage = () => document.querySelector(this.CHECKOUT_BTN_SELECTOR);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.APPLIED_CODE_SELECTOR)]\n\t\t\t\t.map(element => element.href.match(this.APPLIED_CODES_REGEX))\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(element => element[1])\n\t\t\t\t.filter(Boolean),\n\t\t);\n\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn this._removeCodes();\n\t}\n\n\tbeforeCheckCodes(originalPrice) {\n\t\t// Sometimes after code testing, applied code may disappear from the page. In such case code\n\t\t// retesting won't show any results. This method was added in order to get correct original price.\n\t\tconst isDiscountElement = (document.querySelector(this.DISCOUNT_SELECTOR) || {}).offsetParent;\n\n\t\tif (!originalPrice && isDiscountElement) {\n\t\t\treturn this._removeCodes();\n\t\t}\n\n\t\treturn Promise.resolve(originalPrice);\n\t}\n\n\tbeforeApplyCodes() {\n\t\t// once an invalid code is applied on the cart page, the url will change and as a result\n\t\t// code won't be applied after the code testing\n\n\t\tif (this.isOnCartPage()) {\n\t\t\twindow.history.replaceState(window.history.state, window.document.title, CART_PAGE_URL);\n\t\t}\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this.applyCode(codes[0]);\n\t}\n\n\tremoveCode() {\n\t\treturn this.applyCode('fake code');\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(responseHTML => {\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, responseHTML)) || 0;\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, responseHTML)) || 0;\n\t\t\tconst total = this.parseTotal(responseHTML);\n\n\t\t\treturn total - tax - shipping;\n\t\t});\n\t}\n\n\t_removeCodes() {\n\t\treturn this.removeCode()\n\t\t\t.then(() => this.getCartPage())\n\t\t\t.then(resonseHTML => this.parseTotal(resonseHTML));\n\t}\n};\n\nexport default {\n\tname: 'Design Within Reach',\n\tdomain: 'dwr.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn URLS.some(url => href.startsWith(url) && document.querySelector(INPUT_CODE_BLOCK_SELECTOR));\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { sessionTimer } from '../../lib';\nimport { elemToFloat } from '../../../utils/format';\nimport { extractElement } from '../../../utils/DOM';\n\nconst CART_PAGE_URL = 'https://www.elfcosmetics.com/shopping-bag';\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: yes\n    Free gift support: no\n    isValid implemented: yes\n    Manually apply code: no\n    sessionTimer: 15min.\nOptional:\n    Show message about free shipping on the cart page (without discount info):no\n    Is driver SPA and add the condition to show popup: no\n    Gather codes on site pages: no */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = 'https://www.elfcosmetics.com/on/demandware.store/Sites-elf-us-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${this.BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${this.BASE_URL}/COBilling-UpdateSummary`;\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.cartcoupon';\n\t\tthis.CODE_VALUE_SELECTOR = '.value';\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value';\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.APPLY_RESPONSE_KEY = null;\n\n\t\tthis.isStackable = true;\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response));\n\t\t\tconst calculatedShipping = shipping || 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response));\n\t\t\tconst calculatedTax = tax || 0;\n\t\t\treturn this.parseTotal(response) - calculatedShipping - calculatedTax;\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\tconst { href } = window.location;\n\t\treturn href.startsWith(CART_PAGE_URL) || href.includes('Cart-SubmitForm');\n\t}\n};\n\nconst _continueUrl = () => {\n\tconst { href } = window.location;\n\tif (href.includes('shopping-bag') || href.includes('Cart-SubmitForm')) {\n\t\treturn CART_PAGE_URL;\n\t}\n\treturn 'https://www.elfcosmetics.com/billing';\n};\n\nexport default {\n\tname: 'Elf Cosmetics',\n\tdomain: 'elfcosmetics.com',\n\tstackable: true,\n\tDriver,\n\tcartContinueUrl: _continueUrl(),\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_PAGE_URL) || href.includes('billing') || href.includes('/Cart-SubmitForm');\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty')) || Boolean(document.querySelector('.error-page-message'));\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { elemToFloat } from '../../../utils/format';\nimport { extractElement } from '../../../utils/DOM';\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: yes\n    Free gift support: yes\n    isValid implemented: yes\n    Manually apply code: no\n    Pages, where extension works: Cart\nOptional:\n    Show message about free shipping on the cart page (without discount info): no\n    Is driver SPA and add the condition to show popup: no\n    Gather codes on site pages: no */\n\nconst BASE_URL = 'https://www.elizabetharden.com/on/demandware.store/Sites-ElizabethArden-Site/default';\nconst CART_PAGE_URL = `${BASE_URL}/Cart-Show`;\nconst SECOND_CART_URL = `${BASE_URL}/Cart-AddToWishlist`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = CART_PAGE_URL;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.isStackable = true;\n\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-row .item-total, .checkout-mini-cart .mini-cart-product';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\n\t\tthis.CART_MERCHANT_CODES_ELEM_SELECTOR = '[class=\"header-promotion\"]';\n\t\tthis.MERCHANT_CODES_REGEX = /Code: (\\w+)/i;\n\t\tthis.MAIN_PAGE_MERCHANT_CODES_ELEM_SELECTOR = '.promoCode-line';\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn fetch('https://www.elizabetharden.com/special-offers/', {\n\t\t\tcredentials: 'include',\n\t\t})\n\t\t\t.then(res => res.text())\n\t\t\t.then(responseHTML => {\n\t\t\t\tconst cartPageCodesElem = [...document.querySelectorAll(this.CART_MERCHANT_CODES_ELEM_SELECTOR)].find(\n\t\t\t\t\tel => el.offsetParent && el.textContent.match(this.MERCHANT_CODES_REGEX),\n\t\t\t\t);\n\t\t\t\tconst cartCode = cartPageCodesElem\n\t\t\t\t\t? [cartPageCodesElem.textContent.match(this.MERCHANT_CODES_REGEX)[1]]\n\t\t\t\t\t: [];\n\n\t\t\t\tconst mainPageCodes = [\n\t\t\t\t\t...extractElement(this.MAIN_PAGE_MERCHANT_CODES_ELEM_SELECTOR, responseHTML, true),\n\t\t\t\t]\n\t\t\t\t\t.map(el => el.textContent.trim().match(this.MERCHANT_CODES_REGEX))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(el => el[1]);\n\n\t\t\t\treturn [...new Set([...mainPageCodes, ...cartCode])];\n\t\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - tax - shipping;\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n};\n\nexport default {\n\tname: 'Elizabeth Arden',\n\tdomain: 'elizabetharden.com',\n\tstackable: true,\n\tDriver,\n\tenableFreeGiftsWarning: true,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith(CART_PAGE_URL) ||\n\t\t\thref.startsWith(SECOND_CART_URL) ||\n\t\t\tdocument.querySelector('#dwfrm_cart_couponCode')\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\n\nconst DOMAIN_URL = 'https://www.exofficio.com';\nconst BASE_URL = `${DOMAIN_URL}/on/demandware.store`;\nconst CART_PAGE_URL = `${DOMAIN_URL}/checkout`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.isStackable = true;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Sites-ExOfficio_US-Site/en_US/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Sites-ExOfficio_US-Site/en_US/Cart-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/Sites-ExOfficio_US-Site/en_US/OnePageCheckout-UpdateSummary`;\n\n\t\tthis.CART_FORM_SELECTOR = '#next';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.CODE_VALUE_SELECTOR = '[data-couponcode]';\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(codeElement =>\n\t\t\tcodeElement.getAttribute('data-couponcode'),\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: 'ExOfficio',\n\tdomain: 'exofficio.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith(BASE_URL) ||\n\t\t\thref.startsWith(CART_PAGE_URL) ||\n\t\t\t(href.startsWith(DOMAIN_URL) && href.includes('cart'))\n\t\t);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, format, completionActions } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: yes\n    Free gift support: no\n    isValid implemented: yes\nOptional:\n    Show message about free shipping on the cart page (without discount info):no\n    Is driver SPA and add the condition to show popup: no\n    Gather codes on site pages: no \n    can't avoid redirect from the billing to the shipping page\n*/\n\nconst BASE_SITE_URL = 'https://www.foodsaver.com';\nconst CART_PAGE_URL = `${BASE_SITE_URL}/cart`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = `${BASE_SITE_URL}/on/demandware.store/Sites-food-saver-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t}\n\n\tgetExistingCodes() {\n\t\treturn (this._isOnCartPage() ? Promise.resolve(null) : this.getCartPage()).then(responseHTML => {\n\t\t\tconst codes = [...extractElement(this.CODE_VALUE_SELECTOR, responseHTML, true)].map(element =>\n\t\t\t\telement.innerText.trim(),\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\tif (this._isOnCartPage()) {\n\t\t\t// We should remove query parameters, to prevent form submitting again on cart page only\n\t\t\t// `cannotRefresh` parameter can't be used\n\t\t\t// because on checkout page `POST` request should be used for page reloading\n\t\t\twindow.history.replaceState(\n\t\t\t\twindow.history.state,\n\t\t\t\twindow.document.title,\n\t\t\t\twindow.location.href.split('?')[0],\n\t\t\t);\n\t\t}\n\t\treturn this.applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst taxEl = extractElement(this.TAX_SELECTOR, response);\n\t\t\tconst shippingEl = extractElement(this.SHIPPING_SELECTOR, response);\n\t\t\tconst tax = taxEl ? elemToFloat(taxEl) || 0 : 0;\n\t\t\tconst shipping = shippingEl ? elemToFloat(shippingEl) || 0 : 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn window.location.href.startsWith(this.CART_PAGE_URL) && document.querySelector(this.CART_FORM_SELECTOR);\n\t}\n};\n\nexport default {\n\tname: 'Food Saver',\n\tdomain: 'foodsaver.com',\n\tstackable: true,\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tisCartEmpty() {\n\t\tconst emptyElem = document.querySelector('.total-products');\n\t\treturn document.querySelector('.mini-cart-empty') || (emptyElem && emptyElem.innerText === '(0)');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t(href.startsWith(CART_PAGE_URL) ||\n\t\t\t\thref.startsWith(`${BASE_SITE_URL}/shipping`) ||\n\t\t\t\thref.startsWith(`${BASE_SITE_URL}/customer`) ||\n\t\t\t\thref.startsWith(`${BASE_SITE_URL}/billing`) ||\n\t\t\t\thref.startsWith(\n\t\t\t\t\t`${BASE_SITE_URL}/on/demandware.store/Sites-food-saver-Site/default/Cart-AddToWishlist`,\n\t\t\t\t)) &&\n\t\t\tdocument.querySelector('#dwfrm_cart_couponCode')\n\t\t);\n\t},\n};\n","/*    eslint class-methods-use-this: [\"error\", { \"exceptMethods\": [\"_getHeaders\", \"getMerchantCodes\"] }] */\nimport Promise from 'bluebird';\nimport bus from '../../bus';\n\nimport DemandwareAJAXDriver from './_base';\nimport BaseDriver from '../base';\nimport { sessionTimer } from '../../lib';\nimport { DOM, log, format, browserUtils, completionActions } from '../../../utils';\n\nconst { extractFormValues, extractElement, extractData } = DOM;\n\nconst { elemToFloat, getRandomInt } = format;\nconst { getCookie } = browserUtils;\n\n/* Driver behavior description:\n+   Existing code: yes\n+   Remove code: yes\n+   Stackable: no\n+   Free gift support: no\n+   isValid implemented: yes\n+\tIs driver SPA: yes\n+   Pages where extension works: Cart, Checkout(Payment Details step) - https://www.fullbeauty.com;\n\tCart, Checkout - only Log in step, on other steps we lose a lot of information - https://www2.fullbeauty.com\n+ \tGather codes on site pages: yes(cart page)\n+ \tSessionTimer 15 min\nOptional:\n+\tWe may get merchant codes only on cart page\n+    credentials:  (adler7891@gmail.com 19942111Ts)\n*/\n\nconst checkingVersion = window.location.href.includes('/www2');\n\nconst BASE_URL = 'https://www.fullbeauty.com';\nconst CART_URL = `${BASE_URL}/cart`;\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-fboutlet-Site/default`;\nconst MERCHANT_CODE_SELECTOR = '#monetate_selectorBanner_75f998f4_00 > img';\nconst MERCHANT_CODE_REGEX = /use code (\\w+)/i;\n\nconst isOnCart = () =>\n\twindow.location.href.includes(CART_URL) ||\n\twindow.location.href.includes(`${BASE_REQUEST_URL}/Cart-SubmitForm`) ||\n\twindow.location.href.includes(`${BASE_REQUEST_URL}/Cart-AddToWishlist`);\n\nconst _getMerchantCodes = () => {\n\treturn extractElement(MERCHANT_CODE_SELECTOR)\n\t\t? [extractElement(MERCHANT_CODE_SELECTOR)]\n\t\t\t\t.map(elem => elem.alt.match(MERCHANT_CODE_REGEX))\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(code => code[1])\n\t\t: [];\n};\nconst DriverDemandwareAjax = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = false;\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\n\t\tthis.INPUT_CODE_SELECTOR = '#dwfrm_cart_couponCode, #dwfrm_billing_couponCode';\n\t\tthis.APPLY_BTN_SELECTOR = '#add-coupon';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/Cart-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.ERROR_MSG_SELECTOR = '.error.coupon-code-error';\n\t\tthis.REMOVE_ATTRIBUTE_SELECTOR = '#remove-coupon';\n\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\t\tthis.REMOVE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\t\tthis.UPDATE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\t}\n\n\tcheckCondition() {\n\t\tconst isRightUrl = window.location.href.includes('cart');\n\t\tconst inputField = document.querySelector(this.INPUT_CODE_SELECTOR);\n\t\treturn isRightUrl && inputField;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn _getMerchantCodes();\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.applyQueryParams = new URLSearchParams();\n\t\tthis.removeQueryParams = new URLSearchParams();\n\t\tthis.updateQueryParams = new URLSearchParams();\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t\tthis.updateQueryParams.set('format', 'ajax');\n\n\t\tconst codeValue = document.querySelector(this.CODE_VALUE_SELECTOR);\n\t\tif (isOnCart() && codeValue) {\n\t\t\treturn this._getUpdatedCheckout().then(response => {\n\t\t\t\tthis.UUID = this._getRemoveParam(response);\n\t\t\t});\n\t\t}\n\t\tif (codeValue) {\n\t\t\tthis.UUID = this._getRemoveParam();\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\n\t\t\t\tif (this._codeAppliedCheck(applyCodeResponse)) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\treturn this._getUpdatedCheckout().then(response => {\n\t\t\t\t\t\tthis.UUID = this._getRemoveParam(response);\n\t\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this.applyCode(codes[0]);\n\t}\n\n\tremoveCode(code) {\n\t\tthis.removeQueryParams.set('uuid', this.UUID);\n\t\tif (this.REMOVE_CODE_PARAM_NAME) {\n\t\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\t}\n\n\t\treturn this._sendRequestPOST(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n\n\t_getRemoveParam(data) {\n\t\treturn extractData(this.REMOVE_ATTRIBUTE_SELECTOR, data, false, 'data-uuid');\n\t}\n\n\t_getUpdatedCheckout() {\n\t\treturn fetch(`${BASE_URL}/billing?${this.updateQueryParams.toString()}`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t},\n\t\t}).then(response => response.text());\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\tconst errorMsg = extractElement(this.ERROR_MSG_SELECTOR, data);\n\t\treturn errorMsg && errorMsg.textContent ? errorMsg.textContent.match(/invalid or expired/i) : false;\n\t}\n};\n\nconst DOMAIN = 'https://www2.fullbeauty.com';\nconst SHOPING_BAG_URL = `${DOMAIN}/Shopping_bag/ShoppingBag.aspx`;\nconst CHECKOUT_URL = `${DOMAIN}/checkout/processcheckout.ashx`;\nconst IS_ON_CART = window.location.href.toLowerCase().includes('shopping_bag');\n\nconst DriverBase = class Driver extends BaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.PREFIX_NAME = '#ctl00_GlobalBodyContentPlaceHolder';\n\t\tthis.CART_PREFIX = 'ctl00$GlobalBodyContentPlaceHolder';\n\t\tthis.TOTAL_SELECTOR = `${\n\t\t\tthis.PREFIX_NAME\n\t\t}_ucTotals_lblNonFinalSubTotal, #ctl00_BodyContent_OrderTotal_OrderTotal .AddTotal`;\n\t\tthis.APPLIED_CODE_SELECTOR = `${\n\t\t\tthis.PREFIX_NAME\n\t\t}_ucDisplayPromotionCode_promoCodeRpt_ctl00_lblPromo, .promo-code-applied .code-applied`;\n\t\tthis.CODE_INPUT_SELECTOR = `#promo-code, ${this.PREFIX_NAME}_ucPromotionCode_txtCode`;\n\t\tthis.formData = null;\n\t\tthis.FORM_SELECTOR = '#aspnetForm';\n\t\tthis.LOGIN_STEP_SELECTOR = '#login.collapsible-panel.active';\n\t\tthis.ERROR_SELECTOR = '.couponFailedMsg';\n\t}\n\n\tcheckCondition() {\n\t\tconst hrefLowerCase = window.location.href.toLowerCase();\n\t\tconst isCodeInputEl = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isOnCartUrl = hrefLowerCase.includes('shopping_bag') && !hrefLowerCase.includes('shoppersclub');\n\t\tconst isOnLoginStep = hrefLowerCase.includes('checkout') && document.querySelector(this.LOGIN_STEP_SELECTOR);\n\t\tconst currenState = (isOnCartUrl || isOnLoginStep) && isCodeInputEl;\n\t\treturn currenState;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn _getMerchantCodes();\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.formData = IS_ON_CART ? extractFormValues(this.FORM_SELECTOR).params : new URLSearchParams();\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [];\n\t\tconst codeElement = document.querySelector(this.APPLIED_CODE_SELECTOR);\n\t\tif (codeElement) {\n\t\t\tcodes.push(\n\t\t\t\tcodeElement.textContent\n\t\t\t\t\t.replace(' - Promo Code: ', '')\n\t\t\t\t\t.split(' ')[0]\n\t\t\t\t\t.replace(',', ''),\n\t\t\t);\n\t\t}\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0])\n\t\t\t.then(responseHTML => (IS_ON_CART ? responseHTML : this._getUpdatedCart()))\n\t\t\t.then(response => this._parseTotal(response));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code)\n\t\t\t\t.then(responseHTML => (IS_ON_CART ? responseHTML : this._getUpdatedCart()))\n\t\t\t\t.then(responseHTML => {\n\t\t\t\t\tconst finalPrice = this._parseTotal(responseHTML);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst isValid = this._isValidCode(responseHTML);\n\t\t\t\t\treturn this._removeCode(code).then(() =>\n\t\t\t\t\t\tbus.$emit('code-checked', {\n\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\t\tisValid,\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\t_applyCode(code) {\n\t\tlet queryUrl = null;\n\t\tif (IS_ON_CART) {\n\t\t\tthis.formData.set('__EVENTTARGET', '');\n\t\t\tthis.formData.set(`${this.CART_PREFIX}$ucPromotionCode$ibtnApplyCode.x`, getRandomInt(15, 31));\n\t\t\tthis.formData.set(`${this.CART_PREFIX}$ucPromotionCode$ibtnApplyCode.y`, getRandomInt(0, 15));\n\t\t\tthis.formData.set(`${this.CART_PREFIX}$ucPromotionCode$txtCode`, code);\n\t\t\tqueryUrl = SHOPING_BAG_URL;\n\t\t} else {\n\t\t\tqueryUrl = `${CHECKOUT_URL}?Action=ApplyPromotion`;\n\t\t\tthis.formData.set('InputData', JSON.stringify({ PromotionCode: code }));\n\t\t}\n\t\treturn this._manageCode(queryUrl);\n\t}\n\n\t_removeCode(code) {\n\t\tlet queryUrl = null;\n\t\tif (IS_ON_CART) {\n\t\t\tthis.formData.set(\n\t\t\t\t'__EVENTTARGET',\n\t\t\t\t`${this.CART_PREFIX}$ucDisplayPromotionCode$promoCodeRpt$ctl00$lbtnRemovePromo`,\n\t\t\t);\n\t\t\tthis.formData.set(`${this.CART_PREFIX}$ucPromotionCode$txtCode`, '');\n\t\t\tthis.formData.delete(`${this.CART_PREFIX}$ucPromotionCode$ibtnApplyCode.x`);\n\t\t\tthis.formData.delete(`${this.CART_PREFIX}$ucPromotionCode$ibtnApplyCode.y`);\n\t\t\tqueryUrl = SHOPING_BAG_URL;\n\t\t} else {\n\t\t\tqueryUrl = `${CHECKOUT_URL}?Action=RemovePromotion`;\n\t\t\tthis.formData.set('InputData', JSON.stringify({ PromotionCode: code }));\n\t\t}\n\t\treturn this._manageCode(queryUrl);\n\t}\n\n\t_manageCode(url) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this._getHeaders(),\n\t\t\tbody: this.formData,\n\t\t}).then(response => response.text());\n\t}\n\n\t_isValidCode(response) {\n\t\tif (IS_ON_CART) {\n\t\t\treturn !extractElement(this.ERROR_SELECTOR, response);\n\t\t}\n\t\treturn Boolean(response.ApplyPromotions.SuccessText[0] && response.ApplyPromotions.SuccessText[0].Code);\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(`${CHECKOUT_URL}?Action=OrderTotal`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: this._getHeaders(),\n\t\t}).then(responseJSON => responseJSON.json());\n\t}\n\n\t_getHeaders() {\n\t\tif (IS_ON_CART) {\n\t\t\treturn {\n\t\t\t\tAccept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\t'X-Request-Verification-Token': getCookie('__RequestVerification'),\n\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t};\n\t}\n\n\t_parseTotal(data) {\n\t\tlet totalElement = null;\n\t\tif (IS_ON_CART) {\n\t\t\ttotalElement = elemToFloat(extractElement(this.TOTAL_SELECTOR, data));\n\t\t} else {\n\t\t\ttotalElement = data\n\t\t\t\t? data.OrderTotal.FinalSubTotal\n\t\t\t\t: elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t\t}\n\t\treturn totalElement;\n\t}\n};\n\nexport default {\n\tname: 'fullbeauty',\n\tdomain: 'fullbeauty.com',\n\tisSinglePageApp: true,\n\tcompletionAction: completionActions.revisit,\n\tcartContinueUrl: isOnCart() ? CART_URL : window.location.href.split('#')[0],\n\tget Driver() {\n\t\treturn checkingVersion ? DriverBase : DriverDemandwareAjax;\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { format } from '../../../utils';\n\nconst { toFloat } = format;\n\n/*\nBehavior description:\n- existing code: yes\n- merchant codes: yes\n- remove code: yes\n- stackable: no\n- free gift support: no\n- 'isValid' implemented: no\n- manually apply code: no\n- replace code: yes\n- SPA: yes\n- can run code testing only on Cart page\n */\n\nconst BASE_URL = 'https://www.glassesusa.com';\nconst BASE_REQUEST_URL = `${BASE_URL}/backend/optimaxcart/react`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\t// Base class attributes\n\t\tthis.TOTAL_SELECTOR = '#summary_grand_total';\n\t\tthis.MERCHANT_CODES_SELECTOR = '#usa-cart-reminder';\n\t\tthis.MERCHANT_CODES_REGEX = /code:\\s(\\w+)/i;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/applyCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/removeCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/getQuote`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.APPLY_RESPONSE_KEY = null;\n\n\t\t// Current class attributes\n\t\tthis.CODE_SELECTOR = '[class^=\"cartSummaryDiscount__couponName\"]';\n\t\tthis.CODE_REGEXP = /\\((.*?)\\)/;\n\t\tthis.CODE_INPUT_SELECTOR = '[name=\"couponField\"]';\n\t\tthis.EMPTY_CART_SELECTOR = '.empty-cart';\n\t}\n\n\tcheckCondition() {\n\t\tconst isCodeInputElement = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isCartEmptyElement = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\treturn isCodeInputElement && !isCartEmptyElement;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.MERCHANT_CODES_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODES_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.CODE_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el.innerText.trim().match(this.CODE_REGEXP)[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = toFloat(response.totals.shippingPrice) || 0;\n\t\t\treturn this.parseTotal(response) - shipping;\n\t\t});\n\t}\n\n\tparseTotal(objJSON) {\n\t\tlet total = null;\n\t\tif (objJSON) {\n\t\t\t({ total } = objJSON.totals);\n\t\t} else {\n\t\t\ttotal = document.querySelector(this.TOTAL_SELECTOR).innerText;\n\t\t}\n\t\treturn toFloat(total);\n\t}\n};\n\nexport default {\n\tname: 'GlassesUSA',\n\tdomain: 'glassesusa.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { log, format, DOM, completionActions } from '../../../utils';\nimport { handleDriverError, sessionTimer } from '../../lib';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/* Behavior description:\n\t+ Existing code: yes\n\t+ Remove code: yes\n\t+ Replace code: yes\n\t+ Stackable: yes\n\t+ Free gift support: no\n\t+ Free shipping: no\n\t+ isValid implemented: yes\n\t+ Pages, where extension works: side cart, checkout\n\t+ Is driver SPA: no\n\t+ Gather codes on site pages: no\n\t+ Session timer: 15min\n*/\n\nconst MERCHANT_DOMAIN = 'https://www.gnc.com';\nconst CART_PAGE_URL = `${MERCHANT_DOMAIN}/cart`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = true;\n\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.TOTAL_ELEMENT_CONFIG = { selector: this.TOTAL_SELECTOR };\n\n\t\tconst BASE_URL = `${MERCHANT_DOMAIN}/on/demandware.store/Sites-GNC2-Site/default/`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = CART_PAGE_URL;\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:last-of-type';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tthis.REMOVE_REQUEST_HEADERS = {\n\t\t\t'content-type': 'application/x-www-form-urlencoded',\n\t\t\t'upgrade-insecure-requests': 1,\n\t\t\taccept:\n\t\t\t\t'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3',\n\t\t};\n\n\t\tthis.SIDE_CART_SELECTOR = '.flyout-active #flyoutcart-content';\n\t\tthis.OPEN_SIDE_CART_BTN_SELECTOR = '#mini-cart .mini-cart-total';\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isSideCartOpen = document.querySelector(this.SIDE_CART_SELECTOR);\n\t\tconst codeInputSelector = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isOnCheckout = href.startsWith(`${MERCHANT_DOMAIN}/shipping`);\n\t\treturn (isSideCartOpen || isOnCheckout) && codeInputSelector;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn document.querySelector(this.OPEN_SIDE_CART_BTN_SELECTOR);\n\t}\n\n\tgetUserData() {\n\t\treturn { sideCartCodeTesting: !!document.querySelector(this.SIDE_CART_SELECTOR) };\n\t}\n\n\tsetUserData(userData) {\n\t\tif (userData.sideCartCodeTesting && document.querySelector(this.OPEN_SIDE_CART_BTN_SELECTOR)) {\n\t\t\tdocument.querySelector(this.OPEN_SIDE_CART_BTN_SELECTOR).click();\n\t\t}\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\n\t\t\t\tconst successState = this._getValueFromJSON(applyCodeResponse);\n\n\t\t\t\tif (successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount(orderSummary) - originalItemsCount;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.isStackable) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t\toriginalItemsCount,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst taxEl = extractElement(this.TAX_SELECTOR, response);\n\t\t\tconst tax = taxEl ? elemToFloat(taxEl) || 0 : 0;\n\t\t\tconst shippingEl = extractElement(this.SHIPPING_SELECTOR, response);\n\t\t\tconst shipping = shippingEl ? elemToFloat(shippingEl) || 0 : 0;\n\t\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) || 0 : 0;\n\t\t\ttry {\n\t\t\t\treturn this.parseTotal(response) - shipping - tax + shippingDiscount;\n\t\t\t} catch (e) {\n\t\t\t\thandleDriverError(new Error(`Can't get total in getPreTaxShippingTotal method.`), {\n\t\t\t\t\tresponse,\n\t\t\t\t\turl: window.location.href,\n\t\t\t\t\ttax,\n\t\t\t\t\tshipping,\n\t\t\t\t\tshippingDiscount,\n\t\t\t\t});\n\t\t\t\treturn null;\n\t\t\t}\n\t\t});\n\t}\n\n\t_isOnCartPage() {\n\t\tconst href = window.location.href.toLowerCase();\n\t\treturn href.startsWith(this.CART_PAGE_URL);\n\t}\n};\n\nexport default {\n\tname: 'GNC',\n\tdomain: 'gnc.com',\n\tstackable: true,\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tisSinglePageApp: true,\n\trestoreUserData: true,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, format } from '../../../utils';\nimport { extractElement } from '../../../utils/DOM';\n\nconst { extractData } = DOM;\nconst { elemToFloat } = format;\n\n/**\nDriver behavior:\n   Existing code: yes, not always\n   Remove code: yes\n   Code retesting: yes\n   Stackable: yes\n   Free gift support: n\n   isValid implemented: yes\n   Show message about free shipping: n\n   Driver is SPA: yes, on cart and checkout billing step\n   Gather merchant codes: n\n */\n\nconst BASE_URL = 'https://www.hannaandersson.com';\nconst BASE_API_URL = `${BASE_URL}/on/demandware.store/Sites-hannaandersson-Site/default`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = true;\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value';\n\t\tthis.APPLY_CODE_URL = `${BASE_API_URL}/COBilling-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_API_URL}/COBilling-UpdateSummary`;\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode, #dwfrm_billing_couponCode';\n\t\tthis.CART_PAGE_URL = `${BASE_URL}/cart`;\n\t\tthis.TAX_VALUE_SELECTOR = '.order-sales-tax .scp-order-total';\n\t\tthis.SHIPPING_VALUE_SELECTOR = '.order-shipping .scp-order-total';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount .scp-shipping-discount';\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.correctHrefs = [\n\t\t\t'/cart',\n\t\t\t'/Cart-SubmitForm',\n\t\t\t'/Cart-AddToWishlist',\n\t\t\t'/billing',\n\t\t\t'/COShipping-SingleShipping',\n\t\t];\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst emptyCart = document.querySelector('.cart-empty, .mini-cart-empty, .is-error-callout');\n\t\tconst correctPage =\n\t\t\thref.includes('www.hannaandersson.com') &&\n\t\t\tthis.correctHrefs.some(hrefPart => href.toLowerCase().includes(hrefPart.toLowerCase()));\n\t\tconst codeInput = (document.querySelector(this.CODE_INPUT_SELECTOR) || {}).offsetParent;\n\t\tconst totalRendered = (document.querySelector(this.TOTAL_SELECTOR) || {}).offsetParent;\n\t\treturn !emptyCart && correctPage && totalRendered && codeInput;\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getCart().then(responseHTML => {\n\t\t\tconst codes = extractData(this.APPLIED_CODES_SELECTOR, responseHTML, true)\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(code => code.trim());\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tgetOrderSummary() {\n\t\treturn this._sendRequestPOST(this.UPDATE_REQUEST_URL, this.UPDATE_REQUEST_HEADERS, this.updateQueryParams);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(responseHTML => {\n\t\t\tconst total = elemToFloat(extractElement(this.TOTAL_SELECTOR, responseHTML)) || 0;\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_VALUE_SELECTOR, responseHTML)) || 0;\n\t\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, responseHTML);\n\t\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) || 0 : 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_VALUE_SELECTOR, responseHTML)) || 0;\n\t\t\treturn total - shipping - tax + shippingDiscount;\n\t\t});\n\t}\n\n\t_getCart() {\n\t\treturn fetch(this.CART_PAGE_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Hanna Andersson',\n\tdomain: 'hannaandersson.com',\n\tstackable: true,\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport completionActions from '../../../utils/completion-actions';\nimport { DOM, format, log } from '../../../utils';\nimport bus from '../../bus';\n\nconst { elemToFloat, toFloat } = format;\nconst { extractElement } = DOM;\n\n// Driver behaviour description:\n//     Existing code: yes\n//     Remove code: yes\n//     Stackable: yes\n//     Free gift support: no\n//     'isValid' implemented: no\n//     Codes can be replaced by another code: no\n//     works on cart and checkout\n\nconst BASE_URL = 'https://www.harley-davidsonfootwear.com';\nconst CART_PAGE_URL = `${BASE_URL}/US/en/cart`;\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-harleydavidson_us-Site/default`;\nconst IsOnCheckout = () => window.location.href.includes('checkout');\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CODE_VALUE_SELECTOR = '.coupon-info .value';\n\t\tthis.isStackable = true;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/Cart-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/Cart-UpdateBasketTotals`;\n\n\t\tthis.APPLY_CODE_URL_CHECKOUT = `${BASE_REQUEST_URL}/Coupon-ApplyCoupon`;\n\t\tthis.REMOVE_CODE_URL_CHECKOUT = `${BASE_REQUEST_URL}/Coupon-RemoveCoupon`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.SELECTED_SHIPPING_SELECTOR = '.shipping-method-v2.selected input';\n\t\tthis.EXISTING_CODE_SELECTOR = '.coupon-info';\n\t\tthis.EXISTING_CODE_SELECTOR_CHECKOUT = '.spc-applied-discount-message';\n\t\tthis.EXISTING_CODE_REGEX = /applied - (.\\w+)/i;\n\t\tthis.PROMO_INPUT_SELECTOR = '#dwfrm_cart_couponCode, .spc-drawer-promoCode';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isCorrectURL = href.includes('cart') || href.includes('checkout');\n\t\tconst isInputPresent = (document.querySelector(this.PROMO_INPUT_SELECTOR) || {}).offsetParent;\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\treturn isCorrectURL && isInputPresent && !isCartEmpty;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = IsOnCheckout()\n\t\t\t? [...document.querySelectorAll(this.EXISTING_CODE_SELECTOR_CHECKOUT)]\n\t\t\t\t\t.map(el => el.textContent.match(this.EXISTING_CODE_REGEX))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(elem => elem[1])\n\t\t\t: [...document.querySelectorAll(this.EXISTING_CODE_SELECTOR)]\n\t\t\t\t\t.map(el => el.textContent.split(' '))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(elem => elem[0].trim());\n\n\t\tthis.EXISTING_CODE_EXIST = !!codes.length;\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeTestCodes() {\n\t\tif (IsOnCheckout()) {\n\t\t\tthis.CSRF_TOKEN = this._getWindowObjectData('window.data.csrfToken');\n\t\t}\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.removeCode(code).then(response => {\n\t\t\t\tthis.lastResponse = response;\n\t\t\t}),\n\t\t)\n\t\t\t.then(() => (IsOnCheckout() ? this.lastResponse : this.getOrderSummary()))\n\t\t\t.then(res => {\n\t\t\t\treturn {\n\t\t\t\t\toriginalPrice: this.parseTotal(res),\n\t\t\t\t\toriginalItemsCount: this.parseItemsCount(res),\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tbeforeCheckCodes() {\n\t\tif (!this.EXISTING_CODE_EXIST && !IsOnCheckout()) {\n\t\t\tconst shippingMethodElem = document.querySelector(this.SELECTED_SHIPPING_SELECTOR);\n\t\t\tconst shippingMethodValue = document.querySelector(\n\t\t\t\t`label[for*=${shippingMethodElem ? `${shippingMethodElem.id}` : '#shipping-method-001'}] span`,\n\t\t\t);\n\t\t\tthis.shippingPrice = elemToFloat(shippingMethodValue) || 0;\n\t\t}\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlet originPrice = originalPrice;\n\t\tif (this.shippingPrice) {\n\t\t\toriginPrice -= this.shippingPrice;\n\t\t}\n\t\tlog('originalPrice: %s', originPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t};\n\n\t\t\t\tconst successState = this._getValueFromJSON(applyCodeResponse);\n\n\t\t\t\tif (successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn (IsOnCheckout() ? Promise.resolve(applyCodeResponse) : this.getOrderSummary()).then(\n\t\t\t\t\torderSummary => {\n\t\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\t\tresult.finalDiscount = originPrice - result.finalPrice;\n\t\t\t\t\t\tresult.freeGifts = this.parseItemsCount(orderSummary) - originalItemsCount;\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.isStackable) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t\toriginalItemsCount,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\t// eslint-disable-next-line prefer-const\n\t\tlet { originalPrice, originalItemsCount } = validationInfo;\n\n\t\tif (this.shippingPrice) {\n\t\t\toriginalPrice -= this.shippingPrice;\n\t\t}\n\n\t\t// Sort by discount and free gifts count\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code)\n\t\t\t\t.then(res => (IsOnCheckout() ? res : this.getOrderSummary()))\n\t\t\t\t.then(responseHTML => {\n\t\t\t\t\tconst finalPrice = this.parseTotal(responseHTML);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst freeGifts = this.parseItemsCount(responseHTML) - originalItemsCount;\n\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\tfreeGifts,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t\t) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this.removeCode(discount.code).then(() => {\n\t\t\t\t\t\tif (this.REAPPLY_CODES_WHILE_STACKING) {\n\t\t\t\t\t\t\treturn Promise.each(successfulCodes, code => this.applyCode(code));\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t}),\n\t\t);\n\t}\n\n\t// Demandware AJAX Driver methods\n\tapplyCode(code) {\n\t\tif (IsOnCheckout()) {\n\t\t\tthis.applyQueryParams.set('code', code);\n\t\t\tthis.applyQueryParams.set('csrf_token', this.CSRF_TOKEN);\n\n\t\t\treturn this._sendRequestPOST(\n\t\t\t\tthis.APPLY_CODE_URL_CHECKOUT,\n\t\t\t\tthis.APPLY_REQUEST_HEADERS,\n\t\t\t\tundefined,\n\t\t\t\tthis.applyQueryParams,\n\t\t\t);\n\t\t}\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.applyQueryParams.set(this.APPLY_CODE_PARAM_NAME, code);\n\t\treturn this._sendRequestGET(this.APPLY_CODE_URL, this.APPLY_REQUEST_HEADERS, this.applyQueryParams);\n\t}\n\n\tremoveCode(code) {\n\t\tif (IsOnCheckout()) {\n\t\t\tthis.removeQueryParams.set('code', code);\n\t\t\tthis.removeQueryParams.set('csrf_token', this.CSRF_TOKEN);\n\n\t\t\treturn this._sendRequestPOST(\n\t\t\t\tthis.REMOVE_CODE_URL_CHECKOUT,\n\t\t\t\tthis.REMOVE_REQUEST_HEADERS,\n\t\t\t\tundefined,\n\t\t\t\tthis.removeQueryParams,\n\t\t\t);\n\t\t}\n\n\t\tif (this.REMOVE_CODE_PARAM_NAME) {\n\t\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\t}\n\n\t\treturn this._sendRequestGET(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n\n\tparseTotal(data) {\n\t\tif (IsOnCheckout()) {\n\t\t\tif (data) {\n\t\t\t\treturn toFloat(data.cart.totals.orderTotal);\n\t\t\t}\n\t\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t\t}\n\t\tconst totalElement = extractElement(this.TOTAL_SELECTOR, data);\n\t\treturn elemToFloat(totalElement);\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn window.location.href.includes('cart');\n\t}\n\n\tgetUserData() {\n\t\tconst shippingMethodElem = document.querySelector(this.SELECTED_SHIPPING_SELECTOR);\n\t\treturn shippingMethodElem ? `#${shippingMethodElem.id}` : '#shipping-method-001';\n\t}\n\n\tsetUserData(userData) {\n\t\tdocument.querySelector(userData).click();\n\t\treturn Promise.resolve();\n\t}\n\n\t_getWindowObjectData(variableString) {\n\t\t// We will put generated request payload to this element\n\t\tconst requestDataElement = document.createElement('div');\n\t\trequestDataElement.id = 'get-data-genie';\n\t\tObject.assign(requestDataElement.style, { display: 'none' });\n\n\t\tdocument.documentElement.appendChild(requestDataElement);\n\n\t\t// Script which will generate request payload\n\t\tconst requestDataScript = document.createElement('script');\n\t\trequestDataScript.textContent = `document.getElementById(\"${\n\t\t\trequestDataElement.id\n\t\t}\").innerText = JSON.stringify(${variableString});`;\n\t\tdocument.documentElement.appendChild(requestDataScript);\n\t\tconst data = JSON.parse(requestDataElement.innerText);\n\t\t// Remove created blocks\n\t\trequestDataElement.parentNode.removeChild(requestDataElement);\n\t\trequestDataScript.parentNode.removeChild(requestDataScript);\n\t\treturn data;\n\t}\n};\n\nexport default {\n\tname: 'Harley-Davidson Footwear',\n\tdomain: 'harley-davidsonfootwear.com',\n\trestoreUserData: true,\n\tisSinglePageApp: true,\n\tcompletionAction: completionActions.revisit,\n\tshowDifferentDiscountMessage: true,\n\tstackable: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport DemandwareAJAXDriver from './_base';\nimport { DOM, completionActions, format, log } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works:\n    - Cart page\n    - Checkout page (Billing step with folded address form)\n\n+ Is driver SPA yes\n\t- Right page\n\t- Address form on the billing step is collapsed without an applied code\n    - Not empty\n\n+ Gather codes on site pages: no\n*/\n\nconst CART_PAGE_URL = 'https://www.hickoryfarms.com/cart';\nconst isOnCart = () => window.location.href.startsWith(CART_PAGE_URL);\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .hf-price-right';\n\n\t\tconst BASE_URL = 'https://www.hickoryfarms.com/on/demandware.store/Sites-HickoryFarms-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.applyQueryParams.set('sourceCode', true);\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.APPLIED_CODE_SELECTOR = '.delete-coupon';\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.currentPrice = null;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping .hf-price-right';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount .hf-price-right';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax .hf-price-right a';\n\t}\n\n\tcheckCondition() {\n\t\tconst isCartEmpty = (document.querySelector('.cart-empty') || {}).offsetParent;\n\t\tconst isOnBilling = window.location.href.endsWith('https://www.hickoryfarms.com/billing');\n\t\tconst isBillingForm = (document.querySelector('.billing-upper') || {}).offsetParent;\n\t\tconst isCodeUnappplied = !this._getExistingCodes().codeCount;\n\t\treturn (isOnCart() || (isOnBilling && !isBillingForm && isCodeUnappplied)) && !isCartEmpty;\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getExistingCodes();\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this.removeCode(codes[0])\n\t\t\t.then(() => this._getOrderSummary())\n\t\t\t.then(response => {\n\t\t\t\tthis.currentPrice = this.parseTotal(response);\n\t\t\t\treturn this.currentPrice;\n\t\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tthis.currentPrice = originalPrice;\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\n\t\t\t\tconst successState = this._getValueFromJSON(applyCodeResponse);\n\n\t\t\t\tif (successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this._getOrderSummary().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\tif (result.finalDiscount < 0) {\n\t\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\t_getOrderSummary() {\n\t\tif (isOnCart()) {\n\t\t\treturn this.getCartPage();\n\t\t}\n\t\treturn super.getOrderSummary();\n\t}\n\n\t_getExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODE_SELECTOR)].map(el => el.value);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getOrderSummary().then(response => {\n\t\t\tconst shippingDiscountElem = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst total = this.parseTotal(response);\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst shippingDiscount = shippingDiscountElem && shipping ? elemToFloat(shippingDiscountElem) : 0;\n\t\t\treturn total - tax - shipping + shippingDiscount;\n\t\t});\n\t}\n\n\tgetCartPage(count = 0) {\n\t\t// In some case total price doesn't change with first response,\n\t\t// so we try repeat request again and check when price change.\n\t\treturn this._sendRequestGET(CART_PAGE_URL, {}).then(response => {\n\t\t\tconst total = this.parseTotal(response);\n\t\t\tif (this.currentPrice && this.currentPrice <= total && count < 2) {\n\t\t\t\treturn this.getCartPage(count + 1);\n\t\t\t}\n\t\t\treturn response;\n\t\t});\n\t}\n\n\tparseTotal(html) {\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, html));\n\t}\n};\n\nexport default {\n\tname: 'Hickory Farms',\n\tdomain: 'hickoryfarms.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tcompletionAction: completionActions.revisit,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { elemToFloat } from '../../../utils/format';\nimport { extractElement } from '../../../utils/DOM';\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Manually apply code: no\n+ Pages, where extension works: cart and checkout\n+ Is driver SPA: yes\n+ Gather codes on site pages: yes\n*/\n\nconst CART_FORM_SELECTOR = 'form[name=\"dwfrm_cart\"]';\nconst CHECKOUT_FORM_SELECTOR = '#dwfrm_billing';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .orderTotal';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping  td:last-child';\n\n\t\tthis.isStackable = true;\n\n\t\tthis.BASE_URL = 'https://www.hottopic.com/on/demandware.store/Sites-hottopic-Site/default/';\n\t\tthis.APPLY_CODE_URL = `${this.BASE_URL}Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${this.BASE_URL}COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${this.BASE_URL}COBilling-UpdateSummary`;\n\t\tthis.CART_PRODUCT_ITEM_SELECTOR = '.cart-row, .mini-cart-product';\n\t\tthis.ITEM_PRICE_SELECTOR = '.price-total, .price-original';\n\t\tthis.DONATION_SELECTOR = '[title*=Donation]';\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.MERCHANT_PROMO_SELECTOR = '.html-slot-container .text--bold';\n\t\tthis.MERCHANT_PROMO_REGEX = /use code: (\\w+)/i;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [document.querySelector(this.MERCHANT_PROMO_SELECTOR)]\n\t\t\t.filter(code => Boolean(code) && code.textContent.match(this.MERCHANT_PROMO_REGEX))\n\t\t\t.map(code => code.textContent.match(this.MERCHANT_PROMO_REGEX)[1].trim());\n\t}\n\n\tgetExistingCodes() {\n\t\tconst ON_CART_SELECTOR = '.coupon-applied > span';\n\t\tconst ON_CHECKOUT_SELECTOR = '.promo-li > span:not([class*=\"promo-text\"])';\n\t\tconst selector = document.querySelector(CART_FORM_SELECTOR) ? ON_CART_SELECTOR : ON_CHECKOUT_SELECTOR;\n\n\t\tconst codes = Array.from(document.querySelectorAll(selector)).map(element => element.innerText.trim());\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(responseHTML => {\n\t\t\tconst donation = [...document.querySelectorAll(this.CART_PRODUCT_ITEM_SELECTOR)]\n\t\t\t\t.filter(itemEl => itemEl.querySelector(this.DONATION_SELECTOR))\n\t\t\t\t.map(donationEl => (donationEl.querySelector(this.ITEM_PRICE_SELECTOR) || {}).offsetParent)\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(el => elemToFloat(el))\n\t\t\t\t.reduce((cur, prev) => cur + prev, 0);\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, responseHTML)) || 0;\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, responseHTML)) || 0;\n\t\t\treturn this.parseTotal(responseHTML) - shipping - tax - donation;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Hot Topic',\n\tdomain: 'hottopic.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl() {\n\t\t// For this merchant it is safer to check form existence\n\t\treturn document.querySelector(CART_FORM_SELECTOR) || document.querySelector(CHECKOUT_FORM_SELECTOR);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { browserUtils, completionActions, DOM, format } from '../../../utils';\n\nconst { setCookie, getCookie } = browserUtils;\nconst { extractElement, setValue } = DOM;\nconst { elemToFloat } = format;\n\nconst DOMAIN = 'https://www.hugoboss.com';\nconst CART_URL = `${DOMAIN}/us/cart`;\nconst BASE_URL = `${DOMAIN}/on/demandware.store/Sites-US-Site/en_US`;\nconst IS_ON_CART = window.location.href.startsWith(CART_URL);\n\nconst _getPage = url => {\n\treturn fetch(url).then(response => response.text());\n};\nconst isOnPaymentStep = () => window.location.href.includes('CheckoutOnePage-UpdateSection');\n\n/**\n * Driver behavior description:\n * Existing code: yes\n * Remove code: yes\n * Stackable: no\n * Free gift support: yes\n * Free shipping: no\n * isValid implemented: yes\n * Replaced code: no\n * Manually remove code: on Payment step\n * Pages, where extension works:\n * \t- Cart sidebar\n *  - Cart page\n *  - Checkout (Billing step)\n * Is SPA: yes\n * Gather codes on site pages: no\n */\n\nconst CartDriver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-totals .order-total td:last-child';\n\t\tthis.TOTAL_ELEMENT_CONFIG = {\n\t\t\tselector: this.TOTAL_SELECTOR,\n\t\t};\n\t\tthis.SHIPPING_SELECTOR = '.order-totals__row--shipping .order-totals__col--sidebar-price';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax > td:last-child';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Coupon-AddLineItem`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Coupon-RemoveLineItem`;\n\t\tthis.UPDATE_REQUEST_URL = `${DOMAIN}/us/cart`;\n\n\t\tthis.CART_FORM_SELECTOR = '.cart-items-form';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.APPLY_RESPONSE_KEY = 'status';\n\t\tthis.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE = 'OK';\n\n\t\tthis.APPLIED_CODE_BUTTON_SELECTOR = '[data-as-click=\"couponSent\"]';\n\t\tthis.APPLIED_CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t\tthis.updateQueryParams.set('format', 'ajax');\n\t\tthis.CSRF_TOKEN_SELECTOR = '[name=\"csrf_token\"]';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-product__wrapper';\n\t\tthis.SPINNER_SELECTOR = '.loader--active';\n\t\tthis.SIDEBAR_CART_SELECTOR = '.sidebar--visible';\n\t\tthis.SIDEBAR_CART_BUTTON = '.context-nav__list-item--shopping-bag--onepagecheckout a';\n\t}\n\n\tcheckCondition() {\n\t\tconst isGenieUsed = getCookie('is-genie-used');\n\t\tconst isOnRightUrl = IS_ON_CART || window.location.href.includes(`${BASE_URL}/CheckoutOnePage`);\n\t\tconst sidebarWithCart = document.querySelector(this.SIDEBAR_CART_SELECTOR);\n\t\tconst isSpinner = document.querySelector(this.SPINNER_SELECTOR);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst isItemOnPage = document.querySelector(this.PRODUCT_ITEM_SELECTOR);\n\t\tconst btnSidebarOpen = document.querySelector(this.SIDEBAR_CART_BUTTON);\n\t\tif (\n\t\t\tisGenieUsed === '1' &&\n\t\t\t!sidebarWithCart &&\n\t\t\tbtnSidebarOpen &&\n\t\t\tdocument.readyState === 'complete' &&\n\t\t\t!isOnRightUrl\n\t\t) {\n\t\t\tbtnSidebarOpen.click();\n\t\t\tsetCookie('is-genie-used', '0', 90);\n\t\t}\n\t\treturn (isOnRightUrl || sidebarWithCart) && !isSpinner && isTotal && isItemOnPage;\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst tokenElem = document.querySelector(this.CSRF_TOKEN_SELECTOR);\n\t\tthis.applyQueryParams.set('csrf_token', tokenElem ? tokenElem.value : false);\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll('.product-table__coupon__cartcoupon > span')]\n\t\t\t.filter(Boolean)\n\t\t\t.map(element => element.innerText.trim());\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tapplyCode(code) {\n\t\tthis.applyQueryParams.set(this.APPLY_CODE_PARAM_NAME, code);\n\t\treturn this._sendRequestPOST(this.APPLY_CODE_URL, this.APPLY_REQUEST_HEADERS, this.applyQueryParams);\n\t}\n\n\tapplyCodeManually(code) {\n\t\tconst codeInputElm = document.querySelector(this.APPLIED_CODE_INPUT_SELECTOR);\n\t\tconst codeApplyBtn = document.querySelector(this.APPLIED_CODE_BUTTON_SELECTOR);\n\n\t\tsetValue(codeInputElm, code);\n\n\t\tcodeApplyBtn.click();\n\t\treturn Promise.resolve();\n\t}\n\n\tremoveCode(code) {\n\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\treturn this._sendRequestPOST(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n\n\tapplyCodes(codes) {\n\t\tsetCookie('is-genie-used', '1', 90);\n\t\treturn isOnPaymentStep() ? this.applyCodeManually(codes[0]) : this.applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn _getPage(CART_URL).then(responseHTML => {\n\t\t\tconst total = elemToFloat(extractElement(this.TOTAL_SELECTOR, responseHTML));\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, responseHTML)) || 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, responseHTML)) || 0;\n\t\t\treturn total - shipping - tax;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Hugo Boss',\n\tdomain: 'hugoboss.com',\n\tDriver: CartDriver,\n\tisSinglePageApp: true,\n\tcompletionAction: isOnPaymentStep() ? completionActions.none : completionActions.default,\n};\n","import DemandwareAJAXDriver from './_base';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isOnCartPage = window.location.href.includes('/cart');\n\t\tthis.TOTAL_SELECTOR = '.order-total .textalign-right';\n\t\tconst BASE_URL = 'https://www.hushpuppies.com/on/demandware.store/Sites-hushpuppies_us-Site/default/';\n\t\tthis.CODE_SELECTOR = this.isOnCartPage ? '.cartcoupon .value' : '.info-line';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}Cart-AddCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = 'https://www.hushpuppies.com/US/en/cart';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.updateQueryParams.set('format', 'ajax');\n\t}\n\n\tgetExistingCodes() {\n\t\tlet codes = [...document.querySelectorAll(this.CODE_SELECTOR)].map(el => {\n\t\t\tif (this.isOnCartPage) {\n\t\t\t\treturn el.innerText.trim();\n\t\t\t}\n\t\t\treturn el.getAttribute('data-couponcode');\n\t\t});\n\t\tcodes = [...new Set(codes)];\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tapplyCodes(codes) {\n\t\t// We should remove query parameters, to prevent form submitting again on cart page only\n\t\t// `revisit` completion action parameter can't be used\n\t\t// because on checkout page `POST` request should be used for page reloading\n\t\tif (document.querySelector('#cart-table')) {\n\t\t\twindow.history.replaceState(\n\t\t\t\twindow.history.state,\n\t\t\t\twindow.document.title,\n\t\t\t\twindow.location.href.split('?')[0],\n\t\t\t);\n\t\t}\n\t\treturn this.applyCode(codes[0]);\n\t}\n};\n\nexport default {\n\tname: 'Hush Puppies',\n\tdomain: 'hushpuppies.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\tconst baseUrl = 'https://www.hushpuppies.com/US/en/';\n\t\treturn href.startsWith(`${baseUrl}cart`) || href.startsWith(`${baseUrl}billing`);\n\t},\n};\n","import aeropostale from './aeropostale.com';\nimport agacistore from './agacistore.com';\nimport americantourister from './americantourister.com';\nimport ardene from './ardene.com';\nimport artvan from './artvan.com';\nimport ashleystewart from './ashleystewart.com';\nimport avenue from './avenue.com';\nimport bathandbodyworks from './bathandbodyworks.com';\nimport bcbg from './bcbg.com';\nimport bobstores from './bobstores.com';\nimport boohoo from './boohoo.com';\nimport boohooman from './boohooman.com';\nimport boxlunch from './boxlunch.com';\nimport carolsdaughter from './carolsdaughter.com';\nimport christopherandbanks from './christopherandbanks.com';\nimport claires from './claires.com';\nimport clubmonaco from './clubmonaco.com';\nimport coldwatercreek from './coldwatercreek.com';\nimport columbia from './columbia.com';\nimport crabtree from './crabtree-evelyn.com';\nimport destinationmaternity from './destinationmaternity.com';\nimport donaldpliner from './donaldpliner.com';\nimport dwr from './dwr.com';\nimport elfcosmetics from './elfcosmetics.com';\nimport elizabetharden from './elizabetharden.com';\nimport exofficio from './exofficio.com';\nimport foodsaver from './foodsaver.com';\nimport fullbeauty from './fullbeauty.com';\nimport glassesusa from './glassesusa.com';\nimport gnc from './gnc.com';\nimport hannaandersson from './hannaandersson.com';\nimport harleyDavidsonfootwear from './harley-davidsonfootwear.com';\nimport hickoryfarms from './hickoryfarms.com';\nimport hottopic from './hottopic.com';\nimport hugoboss from './hugoboss.com';\nimport hushpuppies from './hushpuppies.com';\nimport intermixonline from './intermixonline.com';\nimport itcosmetics from './itcosmetics.com';\nimport jessicalondon from './jessicalondon.com';\nimport johnhardy from './johnhardy.com';\nimport johnvarvatos from './johnvarvatos.com';\nimport katespade from './katespade.com';\nimport keds from './keds.com';\nimport kiehls from './kiehls.com';\nimport kingsize from './kingsize.com';\nimport kingsizedirect from './kingsizedirect.com';\nimport kipling from './kipling-usa.com';\nimport lacoste from './lacoste.com';\nimport lancomeUsa from './lancome-usa.com';\nimport lifeisgood from './lifeisgood.com';\nimport loralette from './loralette.com';\nimport lumens from './lumens.com';\nimport madewell from './madewell.com';\nimport marmot from './marmot.com';\nimport melissaanddoug from './melissaanddoug.com';\nimport merrell from './merrell.com';\nimport michaels from './michaels.com';\nimport modcloth from './modcloth.com';\nimport modells from './modells.com';\nimport motherhood from './motherhood.com';\nimport mountainhardwear from './mountainhardwear.com';\nimport mrcoffee from './mrcoffee.com';\nimport nastygal from './nastygal.com';\nimport nautica from './nautica.com';\nimport neutrogena from './neutrogena.com';\nimport newbalance from './newbalance.com';\nimport nixon from './nixon.com';\nimport oster from './oster.com';\nimport otterbox from './otterbox.com';\nimport pacificcoast from './pacificcoast.com';\nimport pacsun from './pacsun.com';\nimport parkerny from './parkerny.com';\nimport partycity from './partycity.com';\nimport paulaschoice from './paulaschoice.com';\nimport pendletonUsa from './pendleton-usa.com';\nimport perriconemd from './perriconemd.com';\nimport peterthomasroth from './peterthomasroth.com';\nimport petsmart from './petsmart.com';\nimport pier1 from './pier1.com';\nimport ragbone from './ragbone.com';\nimport puma from './us.puma.com';\nimport ralphlauren from './ralphlauren.com';\nimport rebeccataylor from './rebeccataylor.com';\nimport redcross from './redcross.org';\nimport roamans from './roamans.com';\nimport rockport from './rockport.com';\nimport sallybeauty from './sallybeauty.com';\nimport samsonite from './shop.samsonite.com';\nimport scholastic from './shop.scholastic.com';\nimport slumberland from './slumberland.com';\nimport sonos from './sonos.com';\nimport southmoonunder from './southmoonunder.com';\nimport speckproducts from './speckproducts.com';\nimport crossfit from './store.crossfit.com';\nimport surfstitch from './surfstitch.com';\nimport surlatable from './surlatable.com';\nimport talbots from './talbots.com';\nimport tartecosmetics from './tartecosmetics.com';\nimport taylormadegolf from './taylormadegolf.com';\nimport teva from './teva.com';\nimport tillys from './tillys.com';\nimport timex from './timex.com';\nimport torrid from './torrid.com';\nimport trinaturk from './trinaturk.com';\nimport truereligion from './truereligion.com';\nimport ugg from './ugg.com';\nimport uniqlo from './uniqlo.com';\nimport verabradley from './verabradley.com';\nimport vineyardvines from './vineyardvines.com';\nimport vince from './vince.com';\nimport vitaminworld from './vitaminworld.com';\nimport wolverine from './wolverine.com';\nimport wonamwithin from './womanwithin.com';\nimport ylighting from './ylighting.com';\nimport yliving from './yliving.com';\n\nexport default [\n\taeropostale,\n\tagacistore,\n\tamericantourister,\n\tardene,\n\tartvan,\n\tashleystewart,\n\tavenue,\n\tbathandbodyworks,\n\tbcbg,\n\tbobstores,\n\tboohoo,\n\tboohooman,\n\tboxlunch,\n\tcarolsdaughter,\n\tchristopherandbanks,\n\tclaires,\n\tclubmonaco,\n\tcoldwatercreek,\n\tcolumbia,\n\tcrabtree,\n\tdestinationmaternity,\n\tdonaldpliner,\n\tdwr,\n\telfcosmetics,\n\telizabetharden,\n\texofficio,\n\tfoodsaver,\n\tfullbeauty,\n\tglassesusa,\n\tgnc,\n\thannaandersson,\n\tharleyDavidsonfootwear,\n\thickoryfarms,\n\thottopic,\n\thugoboss,\n\thushpuppies,\n\tintermixonline,\n\titcosmetics,\n\tjessicalondon,\n\tjohnhardy,\n\tjohnvarvatos,\n\tkatespade,\n\tkeds,\n\tkiehls,\n\tkingsize,\n\tkingsizedirect,\n\tkipling,\n\tlacoste,\n\tlancomeUsa,\n\tlifeisgood,\n\tloralette,\n\tlumens,\n\tmadewell,\n\tmarmot,\n\tmelissaanddoug,\n\tmerrell,\n\tmichaels,\n\tmodcloth,\n\tmodells,\n\tmotherhood,\n\tmountainhardwear,\n\tmrcoffee,\n\tnastygal,\n\tnautica,\n\tneutrogena,\n\tnewbalance,\n\tnixon,\n\toster,\n\totterbox,\n\tpacificcoast,\n\tpacsun,\n\tparkerny,\n\tpartycity,\n\tpaulaschoice,\n\tpendletonUsa,\n\tperriconemd,\n\tpeterthomasroth,\n\tpetsmart,\n\tpier1,\n\tragbone,\n\tpuma,\n\tralphlauren,\n\trebeccataylor,\n\tredcross,\n\troamans,\n\trockport,\n\tsallybeauty,\n\tsamsonite,\n\tscholastic,\n\tslumberland,\n\tsonos,\n\tsouthmoonunder,\n\tspeckproducts,\n\tcrossfit,\n\tsurfstitch,\n\tsurlatable,\n\ttalbots,\n\ttartecosmetics,\n\ttaylormadegolf,\n\tteva,\n\ttillys,\n\ttimex,\n\ttorrid,\n\ttrinaturk,\n\ttruereligion,\n\tugg,\n\tuniqlo,\n\tverabradley,\n\tvince,\n\tvineyardvines,\n\tvitaminworld,\n\twolverine,\n\twonamwithin,\n\tylighting,\n\tyliving,\n];\n","import DemandwareDriver from './_base';\n\n/* Driver behavior:\n Existing code: yes (sometimes no - in case when we have text `15 %`)\n Remove code: no (We can't be sure that codes which we got in getExistingCodes is right)\n Code retesting: yes\n Stackable: yes\n Free gift support: no\n isValid implemented: yes\n Show message about free shipping: no\n Driver is SPA: yes, on cart & checkout\n Gather merchant codes: no\n So, we don't remove codes, only add.\n */\nconst BASE_URL = 'https://www.intermixonline.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-Intermix-Site/en_US`;\nconst cartContinueUrl = () => {\n\tconst { href } = window.location;\n\tif (href.includes('Cart-SubmitForm')) {\n\t\treturn CART_PAGE_URL;\n\t}\n\tif (href.includes('COBilling-Billing')) {\n\t\treturn `${BASE_URL}/revieworder`;\n\t}\n\treturn href;\n};\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .bfx-total-grandtotal, .order-subtotal .bfx-total-subtotal';\n\t\tthis.CODE_VALUE_SELECTOR = '.discount span:last-child';\n\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\n\t\tthis.isStackable = true;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.EMPTY_CART_SELECTOR = '.mini-cart-empty';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isCodeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isRightUrl =\n\t\t\thref.includes('cart') ||\n\t\t\thref.includes('revieworder') ||\n\t\t\thref.includes('orderconfirmation') ||\n\t\t\thref.includes('COBilling-Billing') ||\n\t\t\thref.includes('Cart-SubmitForm');\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst currentState = isCodeInput && isCodeInput.offsetParent && isRightUrl && !isCartEmpty;\n\t\treturn currentState;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.CODE_VALUE_SELECTOR)]\n\t\t\t\t.filter(element => !/%/.test(element.innerText))\n\t\t\t\t.map(element => element.innerText.replace(' Not Applied', '').replace(' Applied', '')),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tremoveCode() {\n\t\treturn Promise.resolve();\n\t}\n};\n\nexport default {\n\tname: 'INTERMIX',\n\tdomain: 'intermixonline.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tcartContinueUrl: cartContinueUrl(),\n\tDriver,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions, DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\nconst BASE_URL = 'https://www.itcosmetics.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst CHECKOUT_PAGE_URL = `${BASE_URL}/checkout`;\nconst IS_ON_CHECKOUT = window.location.href.startsWith(CHECKOUT_PAGE_URL);\n/*\nDriver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: no\n    Free gift support: yes\n    isValid implemented: no\n    active pages: cart, checkout\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR =\n\t\t\t'.cart_order_totals .order_total td:last-child, .checkout_order_totals .order_total td:last-child';\n\t\tthis.APPLIED_CODES_SELECTOR = '.remove_coupon';\n\t\tthis.INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '#cart_table tbody tr, .checkout_minicart_product';\n\t\tthis.REVIEW_SELECTOR = '.chsection_preview.current';\n\t\tthis.ICON_SELECTOR = '.b-minicart_quantity span';\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_URL =\n\t\t\t'https://www.itcosmetics.com/on/demandware.store/Sites-itcosmetics-us-Site/default/Cart-AddRemoveCoupon';\n\t\tthis.REMOVE_CODE_URL = this.APPLY_CODE_URL;\n\t\tthis.UPDATE_REQUEST_URL = this._isOnCartPage() ? this.CART_PAGE_URL : CHECKOUT_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.applyQueryParams.set('type', 'add');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('type', 'remove');\n\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart_row, .bonus_row, .b-checkout_minicart_product';\n\t\tthis.FIRST_STEP_SELECTOR = '#form_emailonly';\n\n\t\tthis.TAX_VALUE_SELECTOR = '.estimated_tax_amount';\n\t\tthis.HIDDEN_TAX_SELECTOR = '.estimated_tax_result_box';\n\t\tthis.SHIPPING_VALUE_SELECTOR = '.order_shipping td:last-child';\n\t\tthis.CART_PAGE_URL = 'https://www.itcosmetics.com/cart';\n\t}\n\n\tcheckCondition() {\n\t\tconst cartPage = window.location.href.startsWith(this.CART_PAGE_URL);\n\t\tconst isInput = document.querySelector(`${this.INPUT_SELECTOR}, ${this.APPLIED_CODES_SELECTOR}`);\n\t\tconst isEmpty = document.querySelector(this.TOTAL_SELECTOR) && this.parseTotal() === 0;\n\t\tconst isOnFirstStep = document.querySelector(this.FIRST_STEP_SELECTOR);\n\t\treturn (cartPage && !isEmpty && isInput) || (IS_ON_CHECKOUT && isOnFirstStep && !isEmpty && isInput);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(\n\t\t\tcodeElement => codeElement.dataset.coupon,\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this.applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\t// Tax and shipping are included on cart and checkout pages\n\t\treturn this.getCartPage().then(responseHTML => {\n\t\t\tconst taxValue = elemToFloat(extractElement(this.TAX_VALUE_SELECTOR, responseHTML));\n\t\t\tconst hiddenTax = extractElement(this.HIDDEN_TAX_SELECTOR, responseHTML).classList.contains('hidden');\n\t\t\tconst isTaxValue = hiddenTax ? 0 : taxValue;\n\t\t\tconst shippingValue = elemToFloat(extractElement(this.SHIPPING_VALUE_SELECTOR, responseHTML));\n\t\t\tconst isShippingValue = Number.isNaN(shippingValue) ? 0 : shippingValue;\n\t\t\tconst totalValue = this.parseTotal(responseHTML);\n\t\t\treturn totalValue - isTaxValue - isShippingValue;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'It Cosmetics',\n\tdomain: 'itcosmetics.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tenableFreeGiftsWarning: true,\n\tcompletionAction: completionActions.revisit,\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport DemandwareAJAXDriver from './_base';\nimport { DOM, format, log } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { extractElement, extractElementFromHTML } = DOM;\nconst { elemToFloat } = format;\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Payment\n+ Is driver SPA: yes\n+ Gather codes on site pages: yes, from this url: https://www.jessicalondon.com/offers-coupons\n*/\n\nconst BASE_URL = 'https://www.jessicalondon.com';\nconst CART_URL = `${BASE_URL}/cart`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = false;\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode, #dwfrm_billing_couponCode';\n\n\t\tthis.CHARGES_REGEX = /(handling:|tax)/i;\n\t\tthis.CHARGES_SELECTOR = '.order-totals-table .order-detail span.value:last-child';\n\n\t\tthis.BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-oss-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${this.BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${this.BASE_REQUEST_URL}/Cart-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${this.BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.ERROR_MSG_SELECTOR = '.error.coupon-code-error';\n\t\tthis.REMOVE_ATTRIBUTE_SELECTOR = '#remove-coupon';\n\t\tthis.MERCHANT_CODE_SELECTOR = '.promo-code b, .oc-coupon-code';\n\t\tthis.COUPONS_PAGE_URL = `${BASE_URL}/offers-coupons`;\n\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\t\tthis.REMOVE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\t\tthis.UPDATE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t\tthis.updateQueryParams.set('format', 'ajax');\n\n\t\tthis.MAX_WAIT_TIME = 15;\n\t}\n\n\twatchForCartUrl() {\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: super.watchForCartUrl(),\n\t\t\ttimeout: this.MAX_WAIT_TIME,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isRightUrl =\n\t\t\thref.includes('/cart') ||\n\t\t\thref.includes('/Cart-SubmitForm') ||\n\t\t\thref.includes('/checkout') ||\n\t\t\thref.includes('/shipping') ||\n\t\t\thref.includes('/billing') ||\n\t\t\thref.startsWith(`${this.BASE_REQUEST_URL}/Cart-AddToWishlist`);\n\t\tconst isCodeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\treturn isRightUrl && isCodeInput;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getCouponsPage().then(responseHTML => [\n\t\t\t...new Set(\n\t\t\t\t[...extractElement(this.MERCHANT_CODE_SELECTOR, responseHTML, true)]\n\t\t\t\t\t.map(el => el.textContent)\n\t\t\t\t\t.filter(el => Boolean(el) && el.toLowerCase() !== 'no code needed')\n\t\t\t\t\t.map(code => code.toUpperCase()),\n\t\t\t),\n\t\t]);\n\t}\n\n\tgetExistingCodes() {\n\t\treturn Promise.resolve()\n\t\t\t.then(() => {\n\t\t\t\tif (this._isOnCartPage()) {\n\t\t\t\t\treturn document.documentElement.innerHTML;\n\t\t\t\t}\n\t\t\t\treturn this.getCartPage();\n\t\t\t})\n\t\t\t.then(html => {\n\t\t\t\tconst appliedCodesSelector = this.APPLIED_CODES_SELECTOR\n\t\t\t\t\t? this.APPLIED_CODES_SELECTOR\n\t\t\t\t\t: this.CODE_VALUE_SELECTOR;\n\t\t\t\tconst codes = [...extractElementFromHTML(html, appliedCodesSelector, true)].map(element =>\n\t\t\t\t\telement.innerText.trim(),\n\t\t\t\t);\n\n\t\t\t\treturn {\n\t\t\t\t\tcodes: codes.map(code => code.toUpperCase()),\n\t\t\t\t\tcodeCount: codes.length,\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, async code => {\n\t\t\tconst responseSammary = await this._getUpdatedCart();\n\t\t\treturn this.removeCode(code, responseSammary);\n\t\t})\n\t\t\t.then(() => this.getOrderSummary())\n\t\t\t.then(response => ({\n\t\t\t\toriginalPrice: this.parseTotal(response),\n\t\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t};\n\n\t\t\t\tif (this._codeAppliedCheck(applyCodeResponse)) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(async orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tconst cartResponse = await this._getUpdatedCart();\n\t\t\t\t\tconst idElement = [...extractElement('.cartcoupon span', cartResponse, true)].find(\n\t\t\t\t\t\tel => el.textContent.trim().toLowerCase() === code.toLowerCase(),\n\t\t\t\t\t);\n\t\t\t\t\t// if no idElement - code is not applied\n\t\t\t\t\tif (!idElement) {\n\t\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(code, cartResponse).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await this.getOrderSummary();\n\t\tconst total = this.parseTotal(cartStr);\n\t\tconst taxes = [...extractElement(this.CHARGES_SELECTOR, cartStr, true)]\n\t\t\t.filter(el => el.parentElement.textContent.match(this.CHARGES_REGEX))\n\t\t\t.map(elemToFloat)\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((charges, charge) => charges + charge, 0);\n\t\treturn total - taxes;\n\t}\n\n\tremoveCode(code, cartResponse) {\n\t\tconst couponId = [...extractElement('.cartcoupon span', cartResponse, true)].find(\n\t\t\tel => el.textContent.trim().toLowerCase() === code.toLowerCase(),\n\t\t).nextElementSibling.name;\n\t\treturn fetch(`${this.BASE_REQUEST_URL}/Cart-SubmitForm`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'content-type': 'application/x-www-form-urlencoded',\n\t\t\t},\n\t\t\tbody: `dwfrm_cart_couponCode=&${couponId}=Remove`,\n\t\t}).then(response => response.text());\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t}).then(response => response.text());\n\t}\n\n\t_getCouponsPage() {\n\t\treturn fetch(this.COUPONS_PAGE_URL, {\n\t\t\tmethod: 'GET',\n\t\t}).then(response => response.text());\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\tconst errorMsg = extractElement(this.ERROR_MSG_SELECTOR, data);\n\t\treturn errorMsg && errorMsg.textContent ? errorMsg.textContent.match(/invalid or expired/i) : false;\n\t}\n};\n\nexport default {\n\tname: 'Jessica London',\n\tdomain: 'jessicalondon.com',\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { format, DOM, completionActions } from '../../../utils';\n\nconst { toFloat, toInt } = format;\nconst { extractData, setValue } = DOM;\n\n/*\nBehavior description:\n- can get existing codes;\n- can remove codes;\n- valid code can't be replaced with another valid code;\n- can apply multiple codes (stackable);\n- code testing may be run on 'Cart' and 'Checkout' page;\n*/\n\nconst CART_FORM_SELECTOR = '#cart-promo-form';\n\nconst isOnCart = () => Boolean(document.querySelector(CART_FORM_SELECTOR));\n\nconst CART_PAGE_URL = 'https://www.johnhardy.com/cart';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total td:last-child';\n\t\tthis.APPLIED_CODES_SELECTOR = '.discount .label';\n\t\tthis.COUNT_ITEM_SELECTOR = '.mini-cart-quantity-label';\n\t\tthis.INPUT_CODE_SELECTOR = '#dwfrm_billing_couponCode, #dwfrm_cart_couponCode';\n\t\tthis.INPUT_DISABLED_SELECTOR = '.pt_checkout #secondary .summary .checkout-disable';\n\t\tthis.APPLY_BTN_SELECTOR = '#add-coupon';\n\n\t\tthis.CART_FORM_SELECTOR = CART_FORM_SELECTOR;\n\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.johnhardy.com/on/demandware.store/Sites-johnhardy-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-DeleteCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = window.location.href;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.TOTAL_REG = /(&#36;)|[^0-9.-]+/g;\n\t\tthis.EXISTING_CODE_REG = /code:\\s+(\\w+)/;\n\t}\n\n\twatchForCartUrl() {\n\t\tlet previousState = false;\n\t\tsetInterval(() => {\n\t\t\tconst isInput = Boolean(document.querySelector(this.INPUT_CODE_SELECTOR));\n\t\t\tconst isTotal = Boolean(document.querySelector(this.TOTAL_SELECTOR));\n\t\t\tconst isInputDisabled = Boolean(document.querySelector(this.INPUT_DISABLED_SELECTOR));\n\t\t\tconst currentState = isInput && isTotal && !isInputDisabled;\n\t\t\tif (currentState !== previousState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tpreviousState = currentState;\n\t\t}, 500);\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el.innerText.match(this.EXISTING_CODE_REG)[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tparseItemsCount(data) {\n\t\treturn toInt(extractData(this.COUNT_ITEM_SELECTOR, data) || 0);\n\t}\n\n\tparseTotal(data = false) {\n\t\treturn toFloat(extractData(this.TOTAL_SELECTOR, data).replace(this.TOTAL_REG, ''));\n\t}\n\n\tapplyCodes(codes) {\n\t\tif (isOnCart()) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\t// code from stack codes, that will be set manually to refresh page with applied codes for the checkout page\n\t\tconst lastCode = codes[codes.length - 1];\n\t\treturn this.removeCode(lastCode);\n\t}\n\n\tcompleteExperience(codes) {\n\t\treturn this._manuallyCodeApply(codes[0]);\n\t}\n\n\t_manuallyCodeApply(code) {\n\t\tconst codeInput = document.querySelector(this.INPUT_CODE_SELECTOR);\n\t\tconst codeBtn = document.querySelector(this.APPLY_BTN_SELECTOR);\n\t\tsetValue(codeInput, code);\n\t\tcodeBtn.click();\n\t\treturn Promise.resolve();\n\t}\n};\n\nexport default {\n\tname: 'John Hardy',\n\tdomain: 'johnhardy.com',\n\tcompletionAction: () => (isOnCart() ? completionActions.revisit : completionActions.custom),\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n\t// isCartEmpty is not necessarily\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\n\n/* Behavior description:\n+ Existing code: yes, but not always;\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: no\n+ Codes can be replaced by another code: valid code be replaced with another valid code with bigger discount\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout(if Shipping form is not active)\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n+ credentials: joseph@gmail.com, 12345qwerty\n======== Special case ========\nSometimes element with getExistingCode disappears.\n(We have similar problems if get code from a page, but from another elements)\n\nNot always can get existing code. If we want to remove code,\nwe need to pass valid code in removeCodes params, but this is not possible.\nsometimes we can see fake discount with FAKE_CODE after code testing on popup.\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = false;\n\n\t\tthis.TOTAL_SELECTOR = '.order-total-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.promo-code-applied .message';\n\t\tthis.REG_EXP = /applied code ([\\w-]+)/;\n\t\tthis.REG_TOKEN = /var\\s+token\\s+=\\s+\\{\"token\":\"(\\w+)/;\n\n\t\tconst BASE_URL = 'https://www.johnvarvatos.com/on/demandware.store/Sites-johnvarvatos-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/FluidCheckout-ApplyPromotionCode`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/FluidCheckout-RemovePromotionCode`;\n\t\tthis.UPDATE_REQUEST_URL = window.location.href;\n\n\t\tthis.CART_PAGE_URL = 'https://www.johnvarvatos.com/shoppingbag';\n\t\tthis.APPLY_CODE_PARAM_NAME = 'promoCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.EMPTY_CART_SELECTOR = '.empty-cart';\n\t\tthis.CODE_INPUT_SELECTOR = '[name=\"promoCode\"]';\n\t\tthis.NOT_SHIPPING_STEP_SELECTOR = '#shippingForm.summary';\n\t\tthis.SHIPPING_FORM_FILLED_SELECTOR = '#shipping-addressForm .saved-addresses';\n\t\tthis.OUT_OF_STOCK_SELECTOR = '.cart-error';\n\t\tthis.applyQueryParams.set('returnObject', 'Basket,OrderSummary,ShippingOptions');\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isEmptyCartEl = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isCodeInputEl = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst itemOutOfStockEl = document.querySelector(this.OUT_OF_STOCK_SELECTOR);\n\t\tconst isNotShipping = href.includes('checkoutpage')\n\t\t\t? document.querySelector(this.NOT_SHIPPING_STEP_SELECTOR) ||\n\t\t\t  (document.querySelector(this.SHIPPING_FORM_FILLED_SELECTOR) || {}).offsetParent\n\t\t\t: true;\n\t\treturn isCodeInputEl && !isEmptyCartEl && isNotShipping && !itemOutOfStockEl;\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst token = [...document.querySelectorAll('script')]\n\t\t\t.map(el => el.textContent)\n\t\t\t.find(element => element.match(this.REG_TOKEN))\n\t\t\t.match(this.REG_TOKEN)[1];\n\n\t\tthis.applyQueryParams.set('token', token);\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el.innerText.match(this.REG_EXP)[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: 'John Varvatos',\n\tdomain: 'johnvarvatos.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","/*    eslint class-methods-use-this: [\"error\", { \"exceptMethods\": [\"beforeApplyCodes\"] }] */\n\nimport DemandwareAJAXDriver from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout(Payment, can't avoid redirect on the shipping step)\n+ Is driver SPA: no\n+ Gather codes on site pages: yes, from main page\nSpecial case:\n+ Can't use redirect because merchant redirect to the error page, so on FF browser's window may be shown\n*/\n\nconst BASE_SITE_URL = 'https://www.katespade.com';\n\nconst onCart = () => window.location.href.match(/(bag|cart)/i);\nconst SURPRISE = window.location.href.includes('surprise');\nconst CART_FORM_SELECTOR = '#cart-items-form';\nconst CHECKOUT_FORM_SELECTOR = '#dwfrm_billing';\n\nconst Driver = class extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value, .order-total .price';\n\n\t\tthis.NO_TAX_SELECTOR = '.order-sales-tax img';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax :nth-child(2)';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:nth-child(2)';\n\t\tthis.MERCHANT_CODE_SELECTOR = '#homepage-banner-slider strong';\n\t\tthis.MERCHANT_CODE_IMAGE = '.katespade-sale-dropdown img';\n\t\tthis.MERCHANT_CODE_REGEXP = /code\\s(\\w+)/i;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.APPLIED_CODES_SELECTOR = `.rowcoupons ${onCart() ? '.cartcoupon' : '.message'} .value`;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.BASE_SURPRIZE_URL = 'https://surprise.katespade.com';\n\n\t\tconst BASE_URL = SURPRISE\n\t\t\t? `${this.BASE_SURPRIZE_URL}/on/demandware.store/Sites-KateSale-Site/en_US/`\n\t\t\t: `${BASE_SITE_URL}/on/demandware.store/Sites-Shop-Site/en_US/`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}Cart-DeleteCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}COBilling-UpdateSummary`;\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst mainPageURL = SURPRISE ? this.BASE_SURPRIZE_URL : BASE_SITE_URL;\n\t\treturn this._sendRequestGET(mainPageURL).then(responseHTML => {\n\t\t\tconst codes = [...extractElement(this.MERCHANT_CODE_SELECTOR, responseHTML, true)]\n\t\t\t\t.map(elem => elem.innerText.trim())\n\t\t\t\t.filter(Boolean);\n\t\t\t[...extractElement(this.MERCHANT_CODE_IMAGE, responseHTML, true)]\n\t\t\t\t.map(elem => elem.alt.match(this.MERCHANT_CODE_REGEXP))\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(elem => codes.push(elem[1]));\n\t\t\treturn [...new Set(codes)];\n\t\t});\n\t}\n\n\tbeforeApplyCodes() {\n\t\tif (document.querySelector(CART_FORM_SELECTOR)) {\n\t\t\t// Remove query params to avoid form resubmitting\n\t\t\twindow.history.pushState(window.history.state, window.document.title, window.location.href.split('?')[0]);\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst noTax = extractElement(this.NO_TAX_SELECTOR, response);\n\t\t\tconst taxElem = extractElement(this.TAX_SELECTOR, response);\n\t\t\tconst tax = noTax || !taxElem ? 0 : elemToFloat(taxElem);\n\t\t\tconst shippingEl = extractElement(this.SHIPPING_SELECTOR, response);\n\t\t\tconst shipping =\n\t\t\t\tshippingEl && shippingEl.innerText.toLowerCase().trim() === 'free' ? 0 : elemToFloat(shippingEl);\n\t\t\treturn this.parseTotal(response) - tax - shipping;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Kate Spade',\n\tdomain: 'katespade.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn (document.querySelector('.cart-empty-msg') || {}).offsetParent;\n\t},\n\tisOnCartUrl(href) {\n\t\t// For this merchant it is safer to check form existence\n\t\treturn (\n\t\t\t!href.includes('eu.katespade.com') &&\n\t\t\t(document.querySelector(CART_FORM_SELECTOR) || document.querySelector(CHECKOUT_FORM_SELECTOR))\n\t\t);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.keds.com/on/demandware.store/Sites-keds_us-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/Cart-UpdateBasketTotals`;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t}\n\n\tgetExistingCodes() {\n\t\tlet codes = [];\n\t\tif (window.location.pathname.includes('/cart')) {\n\t\t\tcodes = [...document.querySelectorAll('.cartcoupon .value')].map(elem => elem.innerText.trim());\n\t\t} else {\n\t\t\tconst codesElements = [...document.querySelectorAll('[data-couponcode]')].map(el =>\n\t\t\t\tel.getAttribute('data-couponcode'),\n\t\t\t);\n\t\t\tcodes = [...new Set(codesElements)];\n\t\t}\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: 'Keds',\n\tdomain: 'keds.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.keds.com/en/cart') || href.startsWith('https://www.keds.com/en/billing');\n\t},\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport DemandwareAJAXDriver from './_base';\nimport { completionActions, format, log, DOM } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst BASE_URL = 'https://www.kiehls.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\n\n/*\nDriver behavior description:\n    Merchant code: yes\n    Existing code: yes\n    Remove code: yes\n    Stackable: no\n    Free gift support: yes\n    Discount support: yes\n    isValid implemented: yes\n    active pages: cart\n    PreTaxShipping: yes\n======== Special case ========\nsometimes we have the code with free gifts, which we can choose in the pop-up.\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order_total td:last-child';\n\t\tthis.APPLIED_CODES_SELECTOR = '.remove_coupon';\n\t\tthis.MERCHANT_CODE_SELECTOR = 'span.promo-code';\n\t\tthis.OFFER_PROMO_SELECTOR = '.b-main_menu_product_description p';\n\t\tthis.OFFER_PROMO_REGEX = /code:\\s+(\\w+)/i;\n\t\tthis.SHIPPING_TYPE_SELECTOR = '[name=\"shippingmethods\"]';\n\t\tthis.INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.PRODUCT_ITEM_GIFT_SELECTOR = '.bonus_row .item_quantity';\n\t\tthis.PRODUCT_ITEM_SELECTOR = `select[name^=\"dwfrm_cart_shipments_i0_items_i\"],\n\t\t\t.sample_row .rigth_colums_row .qty,\n\t\t\t.bonus_row .rigth_colums_row .qty,\n\t\t\t${this.PRODUCT_ITEM_GIFT_SELECTOR}`;\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.BASE_REQUEST_URL = 'https://www.kiehls.com/on/demandware.store/Sites-kiehls_us-Site/en_US';\n\t\tthis.GET_PRODUCT_REQUEST_URL = `${this.BASE_REQUEST_URL}/Product-GetBonusProducts`;\n\t\tthis.ADD_PRODUCT_REQUEST_URL = `${this.BASE_REQUEST_URL}/Cart-AddBonusProduct`;\n\t\tthis.APPLY_CODE_URL = `${this.BASE_REQUEST_URL}/Cart-AddRemoveCoupon`;\n\t\tthis.REMOVE_CODE_URL = this.APPLY_CODE_URL;\n\t\tthis.UPDATE_CART_REQUEST_URL = `${this.BASE_REQUEST_URL}/COCheckout-GetOrderSummaryModel`;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.SHIPPING_REQUEST_URL = `${this.BASE_REQUEST_URL}/COShipping-SelectShippingMethod`;\n\t\tthis.GET_OFFER_PAGE_REQUEST_URL = `${BASE_URL}/offers`;\n\t\tthis.applyQueryParams = new URLSearchParams({\n\t\t\tformat: 'ajax',\n\t\t\ttype: 'add',\n\t\t});\n\t\tthis.removeQueryParams = new URLSearchParams({\n\t\t\tformat: 'ajax',\n\t\t\ttype: 'remove',\n\t\t});\n\n\t\tthis.TAX_VALUE_SELECTOR = '.order_sales_tax td:last-child';\n\t\tthis.HIDDEN_TAX_SELECTOR = '.estimated_tax_result_box .estimated_tax_amount';\n\t\tthis.SHIPPING_VALUE_SELECTOR = '.order_shipping td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_VALUE_SELECTOR = '.order_shipping_discount td:last-child';\n\t\tthis.ORDER_SUB_TOTAL_SELECTOR = '.order_subtotal td:last-child';\n\t\tthis.GIFT_SCRIPT_SELECTOR = '#statuses';\n\t\tthis.PRODUCT_PID_SELECTOR = '[id*=\"check-bonus-\"]';\n\t\tthis.PRODUCT_PID_REG = /(\\d+)/g;\n\t\tthis.PROMO_MAX_ITEM_COUNT_SELECTOR = '.promotion p';\n\t\tthis.PROMO_MAX_ITEM_COUNT_REG = /please\\s+select\\s+(\\d+)/i;\n\t\tthis.isStackable = false;\n\t}\n\n\tcheckCondition() {\n\t\tconst cartPage = window.location.href.startsWith(this.CART_PAGE_URL);\n\t\tconst isInput = document.querySelector(`${this.INPUT_SELECTOR}, ${this.APPLIED_CODES_SELECTOR}`);\n\t\tconst isEmpty = document.querySelector(this.TOTAL_SELECTOR) && this.parseTotal() === 0;\n\t\tconst subTotalEl = document.querySelector(this.ORDER_SUB_TOTAL_SELECTOR);\n\t\tconst isSubTotalNotZero = subTotalEl && elemToFloat(subTotalEl);\n\t\treturn cartPage && !isEmpty && isInput && isSubTotalNotZero;\n\t}\n\n\tasync getMerchantCodes() {\n\t\tconst responseHTML = await this._getOfferPage();\n\t\tconst offerCodes = [...extractElement(this.OFFER_PROMO_SELECTOR, responseHTML, true)]\n\t\t\t.map(elem => elem.innerText.match(this.OFFER_PROMO_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(elem => elem[1]);\n\n\t\tconst cartPageCodes = [...document.querySelectorAll(this.MERCHANT_CODE_SELECTOR)]\n\t\t\t.map(el => el.textContent.trim())\n\t\t\t.filter(Boolean);\n\t\treturn [...new Set([...offerCodes, ...cartPageCodes])];\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(\n\t\t\tcodeElement => codeElement.dataset.coupon,\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this.removeCode(codes[0]).then(responseHTML => {\n\t\t\treturn this._getCartPage().then(response => ({\n\t\t\t\toriginalPrice: this.parseTotal(response),\n\t\t\t\toriginalItemsCount: this.parseItemsCount(responseHTML),\n\t\t\t}));\n\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tfreeGifts: 0,\n\t\t\t};\n\t\t\treturn this.applyCode(code).then(async applyCodeResponse => {\n\t\t\t\tconst successState = this._getValueFromJSON(applyCodeResponse);\n\n\t\t\t\tif (successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tconst extraItemsCount = await this._checkAndApplyGiftsFromPopup(code, applyCodeResponse);\n\n\t\t\t\tconst orderSummary = await this._getCartPage();\n\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.freeGifts = this.parseItemsCount(applyCodeResponse) + extraItemsCount - originalItemsCount;\n\n\t\t\t\tif (\n\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\t\t\t\tawait this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\treturn Promise.resolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tasync applyCodes(codes) {\n\t\tconst applyCodeResponse = await this.applyCode(codes[0]);\n\t\tawait this._checkAndApplyGiftsFromPopup(codes[0], applyCodeResponse);\n\t\treturn Promise.resolve();\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst responseJSON = await this._getCartPage();\n\t\tconst { estimatedTotal, shippingDiscount = 0, shippingAmount, tax } = responseJSON;\n\t\treturn toFloat(estimatedTotal) - toFloat(shippingAmount) - toFloat(tax) + toFloat(shippingDiscount);\n\t}\n\n\tparseTotal(data) {\n\t\tif (data) {\n\t\t\treturn toFloat(data.estimatedTotal);\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR));\n\t}\n\n\tparseItemsCount(html) {\n\t\treturn [...extractElement(this.PRODUCT_ITEM_SELECTOR, html, true)]\n\t\t\t.filter(item => item.value || item.textContent)\n\t\t\t.map(item => item.value || item.textContent)\n\t\t\t.reduce((a, b) => toFloat(a) + toFloat(b), 0);\n\t}\n\n\t// this method return json total without info about free gifts\n\t// if we use get /cart html response, we can't get correct full tax and shipping info\n\t// because it partly load in demandware AJAX and sometimes this info can be incorrect\n\t_getCartPage() {\n\t\treturn this._sendRequestGET(this.UPDATE_CART_REQUEST_URL, this.UPDATE_REQUEST_HEADERS, this.updateQueryParams);\n\t}\n\n\t_sendRequest(method, requestURL, headers, queryParams, bodyData) {\n\t\tconst finalRequestURL =\n\t\t\tqueryParams && queryParams.toString() ? `${requestURL}?${queryParams.toString()}` : requestURL;\n\n\t\treturn this._shippingRequest().then(() =>\n\t\t\tfetch(finalRequestURL, {\n\t\t\t\tmethod,\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders,\n\t\t\t\tbody: bodyData,\n\t\t\t})\n\t\t\t\t.then(response => response.text())\n\t\t\t\t.then(response => {\n\t\t\t\t\t// Return JSON if it is possible\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn response;\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t);\n\t}\n\n\t// we should send shipping request each time because shipping can set by default after other requests\n\t_shippingRequest() {\n\t\tconst shippingEl = document.querySelector(this.SHIPPING_TYPE_SELECTOR);\n\t\tif (shippingEl) {\n\t\t\tconst queryParams = new URLSearchParams({\n\t\t\t\tshippingMethodID: Number(shippingEl.value),\n\t\t\t});\n\t\t\tconst url = `${this.SHIPPING_REQUEST_URL}?${queryParams.toString()}`;\n\t\t\treturn fetch(url, {\n\t\t\t\tmethod: 'GET',\n\t\t\t\tcredentials: 'include',\n\t\t\t}).then(response => response.json());\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t_extraGiftsIdAfterApply(responseHTML) {\n\t\tconst scriptTextContent = extractElement(this.GIFT_SCRIPT_SELECTOR, responseHTML);\n\t\tconst scriptObject = scriptTextContent ? JSON.parse(scriptTextContent.textContent.trim()) : null;\n\t\treturn scriptObject && scriptObject.bonusItemId ? scriptObject.bonusItemId[0] : null; // null or bonusId\n\t}\n\n\t_getExtraGiftsFromPopupRequest(extraGiftsId) {\n\t\tconst queryParams = new URLSearchParams({\n\t\t\tbonusDiscountLineItemUUID: extraGiftsId,\n\t\t\tformat: 'ajax',\n\t\t});\n\t\tconst url = `${this.GET_PRODUCT_REQUEST_URL}?${queryParams.toString()}`;\n\t\treturn fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t// we can add max 3 bonus items,\n\t// get 3 product PID\n\t_getProductPID(responseHTML) {\n\t\tconst promoMaxItemCountEl = [...extractElement(this.PROMO_MAX_ITEM_COUNT_SELECTOR, responseHTML, true)].find(\n\t\t\titem => item.textContent.match(this.PROMO_MAX_ITEM_COUNT_REG),\n\t\t);\n\t\tconst maxSelectedItemCount = promoMaxItemCountEl\n\t\t\t? Number(promoMaxItemCountEl.textContent.match(this.PROMO_MAX_ITEM_COUNT_REG)[1])\n\t\t\t: 0;\n\n\t\treturn [...extractElement(this.PRODUCT_PID_SELECTOR, responseHTML, true)]\n\t\t\t.map(item => item.getAttribute('id'))\n\t\t\t.slice(0, maxSelectedItemCount)\n\t\t\t.map(itemId => itemId.match(this.PRODUCT_PID_REG)[0]);\n\t}\n\n\t_addExtraGiftsFromPopupRequest(body, extraGiftsId) {\n\t\tconst queryParams = new URLSearchParams({\n\t\t\tbonusDiscountLineItemUUID: extraGiftsId,\n\t\t\tpersonalizationFlow: false,\n\t\t});\n\t\tconst url = `${this.ADD_PRODUCT_REQUEST_URL}?${queryParams.toString()}`;\n\t\treturn fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: JSON.stringify(body),\n\t\t}).then(response => response.json());\n\t}\n\n\tasync _checkAndApplyGiftsFromPopup(code, applyCodeResponse) {\n\t\tconst extraGiftsId = this._extraGiftsIdAfterApply(applyCodeResponse);\n\t\tlet extraItemsCount = 0;\n\t\tif (extraGiftsId) {\n\t\t\tconst extraGiftsHTML = await this._getExtraGiftsFromPopupRequest(extraGiftsId);\n\t\t\tconst extraGiftsPID = await this._getProductPID(extraGiftsHTML);\n\t\t\tconst bonusproducts = extraGiftsPID.map(item => {\n\t\t\t\treturn {\n\t\t\t\t\tproduct: {\n\t\t\t\t\t\toptions: {},\n\t\t\t\t\t\tpid: item,\n\t\t\t\t\t\tproductName: '',\n\t\t\t\t\t\tqty: 1,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t});\n\t\t\tif (bonusproducts.length) {\n\t\t\t\tconst { success } = await this._addExtraGiftsFromPopupRequest({ bonusproducts }, extraGiftsId);\n\t\t\t\tif (success) {\n\t\t\t\t\tlog(`% ${bonusproducts.length} free gifts were added from the gift-popup after applying: ${code}`);\n\t\t\t\t\textraItemsCount = bonusproducts.length;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn extraItemsCount || 0;\n\t}\n\n\t_getOfferPage(url = this.GET_OFFER_PAGE_REQUEST_URL) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: \"Kiehl's\",\n\tdomain: 'kiehls.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tcompletionAction: completionActions.revisit,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, format } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { extractFormValues, extractElement } = DOM;\nconst { elemToFloat } = format;\n\nconst HOME_URL = 'https://www.kingsize.com';\nconst CART_PAGE_URL = `${HOME_URL}/cart`;\n\n/* Behavior description:\n+ Existing code: yes\n+ Merchant code: yes (offers page)\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: yes\n+ Free shipping: no\n+ isValid implemented: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Payment\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-row';\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode, #dwfrm_cart_couponCode';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping .value';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount .value';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax .value';\n\n\t\tthis.MERCHANT_CODE_SELECTOR = '[data-coupon]';\n\n\t\tconst BASE_URL = `${HOME_URL}/on/demandware.store/Sites-kingsize-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.COUPONS_PAGE_URL = `${HOME_URL}/offers-coupons`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.REMOVE_ATTRIBUTE_SELECTOR = '#remove-coupon';\n\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\treturn document.querySelector(this.CODE_INPUT_SELECTOR) && !document.querySelector(this.EMPTY_CART_SELECTOR);\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getCouponsPage().then(responseHTML => [\n\t\t\t...new Set(\n\t\t\t\t[...extractElement(this.MERCHANT_CODE_SELECTOR, responseHTML, true)]\n\t\t\t\t\t.map(el => el.getAttribute('data-coupon'))\n\t\t\t\t\t.filter(el => Boolean(el) && el !== '#'),\n\t\t\t),\n\t\t]);\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_getCouponsPage() {\n\t\treturn this._sendRequestGET(this.COUPONS_PAGE_URL, {});\n\t}\n\n\tgetCartPage() {\n\t\treturn this._sendRequestGET(this.CART_PAGE_URL, {}).then(cartPage => {\n\t\t\tthis.lastCartPage = cartPage;\n\t\t\treturn cartPage;\n\t\t});\n\t}\n\n\tgetOrderSummary() {\n\t\treturn this.getCartPage();\n\t}\n\n\tremoveCodeOnCart(code) {\n\t\tconst removeParamName = this._getRemoveValueName(code, this.lastCartPage);\n\t\tif (!removeParamName) {\n\t\t\t// No need in the reuqest, as parameter name was not found for the code\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst removeRequestData = extractFormValues(this.CART_FORM_SELECTOR, this.lastCartPage);\n\t\tremoveRequestData.params.set(removeParamName, this.REMOVE_COUPON_PARAM_VALUE);\n\n\t\treturn this._sendRequestPOST(removeRequestData.action, {}, null, removeRequestData.params);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shippingElement = extractElement(this.SHIPPING_SELECTOR, response);\n\t\t\tconst shippingDiscountElement = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst taxElement = extractElement(this.TAX_SELECTOR, response);\n\n\t\t\tconst shipping = shippingElement ? elemToFloat(shippingElement) : 0;\n\t\t\tconst shippingDiscount = shippingDiscountElement ? elemToFloat(shippingDiscountElement) : 0;\n\t\t\tconst tax = taxElement ? elemToFloat(taxElement) : 0;\n\n\t\t\treturn this.parseTotal(response) - shipping - tax + shippingDiscount;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'KingSize',\n\tdomain: 'kingsize.com',\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout(Payment step)\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n+ Credentials: joseph@gmail.com, 12345qwert\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value';\n\t\tthis.isStackable = false;\n\t\tthis.INPUT_BILLING_CODE = '#dwfrm_billing_couponCode';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t\tthis.CART_INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\n\t\tconst BASE_URL = 'https://www.kingsizedirect.com/on/demandware.store/Sites-kingsize-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary?stepCount=2`;\n\n\t\tthis.CART_PAGE_URL = 'https://www.kingsizedirect.com/cart';\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.TAX_VALUE_SELECTOR = '.order-sales-tax .value';\n\t\tthis.SHIPPING_VALUE_SELECTOR = '.order-shipping .value';\n\t}\n\n\tcheckCondition() {\n\t\tconst isCodeInput = document.querySelector(`${this.INPUT_BILLING_CODE}, ${this.CART_INPUT_SELECTOR}`);\n\t\tconst isCartEmpty = Boolean(document.querySelector(this.EMPTY_CART_SELECTOR));\n\t\tconst isTotal = Boolean(document.querySelector(this.TOTAL_SELECTOR));\n\n\t\tconst currentState = isCodeInput && isTotal && !isCartEmpty;\n\t\treturn currentState;\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\t// Tax and shipping are included on cart and checkout pages\n\t\treturn this.getCartPage().then(responseHTML => {\n\t\t\tconst taxValue = elemToFloat(extractElement(this.TAX_VALUE_SELECTOR, responseHTML));\n\t\t\tconst shippingValue = elemToFloat(extractElement(this.SHIPPING_VALUE_SELECTOR, responseHTML));\n\t\t\tconst isTaxValue = taxValue || 0;\n\t\t\tconst isShippingValue = shippingValue || 0;\n\t\t\treturn this.parseTotal(responseHTML) - isTaxValue - isShippingValue;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'KingSize Direct',\n\tdomain: 'kingsizedirect.com',\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { completionActions, DOM, log } from '../../../utils';\n\nconst { extractElementFromHTML } = DOM;\n\n/* BEHAVIOUR\n+ Existing code: yes \n+ Remove code: yes \n+ Stackable: yes \n+ Free gift support:  no\n+ Free shipping:  no\n+ isValid implemented: yes\n+ Pages, where extension works:\n   - cart\n   - checkout (2, 3 steps)\n+ Is driver SPA: yes\n+ Gather codes on site pages:  no\n */\n\nconst BASE_URL = 'https://www.kipling-usa.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst BASE_REQUEST_URL = 'https://www.kipling-usa.com/on/demandware.store/Sites-kip-Site/default';\nconst CHECKOUT_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\nconst isCheckout = () => document.querySelector(CHECKOUT_INPUT_SELECTOR);\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.isStackable = true;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.CODE_INPUT_SELECTOR = `${CHECKOUT_INPUT_SELECTOR}, #dwfrm_cart_couponCode`;\n\t\tthis.EMPTY_SELECTOR = '.cart-empty';\n\t\tthis.SHIPPING_SELECTOR = '.shipping.active';\n\t}\n\n\tcheckCondition() {\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isEmpty = document.querySelector(this.EMPTY_SELECTOR);\n\t\tconst isShipping = document.querySelector(this.SHIPPING_SELECTOR);\n\t\treturn codeInput && !isEmpty && !isShipping;\n\t}\n\n\tgetExistingCodes() {\n\t\treturn Promise.resolve()\n\t\t\t.then(() => {\n\t\t\t\tif (this._isOnCartPage()) {\n\t\t\t\t\treturn document.documentElement.innerHTML;\n\t\t\t\t}\n\t\t\t\treturn this.getCartPage();\n\t\t\t})\n\t\t\t.then(html => {\n\t\t\t\tconst appliedCodesSelector = this.APPLIED_CODES_SELECTOR\n\t\t\t\t\t? this.APPLIED_CODES_SELECTOR\n\t\t\t\t\t: this.CODE_VALUE_SELECTOR;\n\t\t\t\tconst codes = [...extractElementFromHTML(html, appliedCodesSelector, true)].map(\n\t\t\t\t\telement => element.innerText.trim().split(/ |\\n/)[0],\n\t\t\t\t);\n\n\t\t\t\treturn {\n\t\t\t\t\tcodes,\n\t\t\t\t\tcodeCount: codes.length,\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t};\n\n\t\t\t\tconst successState = this._getValueFromJSON(applyCodeResponse);\n\n\t\t\t\tif (successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.delay(1000)\n\t\t\t\t\t.then(() => this.getOrderSummary())\n\t\t\t\t\t.then(orderSummary => {\n\t\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tresult.freeGifts = this.parseItemsCount(orderSummary) - originalItemsCount;\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t});\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t\toriginalItemsCount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice, originalItemsCount } = validationInfo;\n\n\t\t// Sort by discount and free gifts count\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code)\n\t\t\t\t.then(() => Promise.delay(1000))\n\t\t\t\t.then(() => this.getOrderSummary())\n\t\t\t\t.then(responseHTML => {\n\t\t\t\t\tconst finalPrice = this.parseTotal(responseHTML);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst freeGifts = this.parseItemsCount(responseHTML) - originalItemsCount;\n\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\tfreeGifts,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t\t) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this.removeCode(discount.code).then(() => {\n\t\t\t\t\t\tif (this.REAPPLY_CODES_WHILE_STACKING) {\n\t\t\t\t\t\t\treturn Promise.each(successfulCodes, code => this.applyCode(code));\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t}),\n\t\t);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn !isCheckout();\n\t}\n};\n\nexport default {\n\tname: 'Kipling',\n\tdomain: 'kipling-usa.com',\n\tstackable: true,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import DemandwareAJAXDriver from './_base';\n\nconst LOGIN_USER_SELECTOR = '.logout.nav-ico-after.js-logout';\n/*\nDriver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: no\n    Free gift support: no\n    isValid implemented: no\n    Manually apply code: no\nOptional:\n    Show message about free shipping on the cart page (without discount info): no\n    Is driver SPA and add the condition to show popup: no\n    Gather codes on site pages: no\n\n   Can apply code on `Cart` page\n\n======== Special case ==========\nNot support login users due to behavior of driver.\nSite applies code and shows successful message but doesn't change total.\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total td:last-child, .cart-price-total span:last-child';\n\n\t\tconst BASE_URL = 'https://www.lacoste.com/on/demandware.store/Sites-FlagShip-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/CartV2-RemoveCouponLineItem`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.APPLY_RESPONSE_KEY = null;\n\n\t\tthis.APPLIED_CODE_SELECTOR = '[data-coupon-code]';\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODE_SELECTOR)].map(el =>\n\t\t\tel.getAttribute('data-coupon-code'),\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCode(code) {\n\t\tif (this.REMOVE_CODE_PARAM_NAME) {\n\t\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\t}\n\n\t\treturn this._sendRequestPOST(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n};\n\nexport default {\n\tname: 'Lacoste',\n\tdomain: 'lacoste.com',\n\tDriver,\n\tisCartEmpty() {\n\t\treturn !!document.querySelector('.cart-empty-title');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.lacoste.com/us/cart') && !document.querySelector(LOGIN_USER_SELECTOR);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isOnCartPage = window.location.href.includes('/cart');\n\t\tthis.CODES_INPUTS_SELECTORS = '#dwfrm_couponcode_couponCode , #dwfrm_cart_couponCode';\n\t\tthis.isOnCheckoutPage = window.location.href.includes('/COCheckout-Show');\n\n\t\tthis.TOTAL_SELECTOR = '.order_total .text_right';\n\t\tconst BASE_URL =\n\t\t\t'https://www.lancome-usa.com/on/demandware.store/Sites-lancome-us-Site/default/Cart-AddRemoveCoupon';\n\t\tthis.isStackable = true;\n\n\t\tthis.APPLY_CODE_URL = BASE_URL;\n\t\tthis.REMOVE_CODE_URL = BASE_URL;\n\t\tthis.UPDATE_REQUEST_URL = BASE_URL;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'couponCode';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.applyQueryParams.set('type', 'add');\n\n\t\tthis.updateQueryParams.set('format', 'ajax');\n\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('type', 'remove');\n\t}\n\n\tgetExistingCodes() {\n\t\tlet codes = [...document.querySelectorAll('.coupon__info .remove_coupon')].map(el =>\n\t\t\tel.getAttribute('data-coupon'),\n\t\t);\n\t\tcodes = [...new Set(codes)];\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\twatchForCartUrl() {\n\t\tlet inputExistsBefore = null;\n\t\tconst intervalId = setInterval(() => {\n\t\t\t// Activate extension popup in case we are on the right URL and\n\t\t\t// we have codes input visible\n\t\t\tconst checkoutCodeInput = Boolean(document.querySelector(this.CODES_INPUTS_SELECTORS));\n\t\t\tconst inputStateChanged = checkoutCodeInput !== inputExistsBefore;\n\t\t\tconst isOnCartOrCheckout = this.isOnCartPage || this.isOnCheckoutPage;\n\t\t\tif (isOnCartOrCheckout && checkoutCodeInput && inputStateChanged) {\n\t\t\t\tbus.$emit('cart-active');\n\t\t\t\tclearInterval(intervalId);\n\t\t\t}\n\t\t\tinputExistsBefore = checkoutCodeInput;\n\t\t}, 1000);\n\t}\n};\n\nexport default {\n\tname: 'Lancome',\n\tdomain: 'lancome-usa.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith(\n\t\t\t\t'https://www.lancome-usa.com/on/demandware.store/Sites-lancome-us-Site/default/COCheckout-Show',\n\t\t\t) && href.startsWith('https://www.lancome-usa.com/cart')\n\t\t);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+ Pages, where extension works: Checkout (no input on Cart)\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n*/\n\nconst CART_PAGE_URL = 'https://www.lifeisgood.com/cart';\nconst CHECKOUT_PAGE_URL = 'https://www.lifeisgood.com/checkout';\nconst TOTAL_SELECTOR = '.order-summary-footer .order-total td:last-child, .order-total td:last-child';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = TOTAL_SELECTOR;\n\t\tthis.CODE_VALUE_SELECTOR = '.cart-coupon .value';\n\t\tthis.isStackable = true;\n\n\t\tthis.PRICE_SELECTOR = '.price-sales';\n\t\tthis.ITEM_SELECTOR = '.mini-cart-product';\n\t\tthis.ITEM_NAME_SELECTOR = '.mini-cart-name';\n\t\tthis.DONATION_REGEX = /donation/i;\n\n\t\tconst BASE_URL = 'https://www.lifeisgood.com/on/demandware.store/Sites-LIG2015-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(el => el.innerText.trim());\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) || 0 : 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\tconst donationEl = this._findDonationEl(response);\n\t\t\tconst donation = donationEl ? elemToFloat(donationEl) : 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax - donation + shippingDiscount;\n\t\t});\n\t}\n\n\t_findDonationEl(response) {\n\t\tconst targetEl = [...extractElement(this.ITEM_SELECTOR, response, true)].filter(el => {\n\t\t\tconst skuEl = el.querySelector(this.ITEM_NAME_SELECTOR);\n\t\t\treturn skuEl && skuEl.textContent.match(this.DONATION_REGEX);\n\t\t})[0];\n\t\treturn targetEl ? targetEl.querySelector(this.PRICE_SELECTOR) : null;\n\t}\n};\n\nexport default {\n\tname: 'Life Is Good',\n\tdomain: 'lifeisgood.com',\n\tstackable: true,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t((href.startsWith(CART_PAGE_URL) && document.querySelector('.promo-code .payment-dialog')) ||\n\t\t\t\thref.startsWith(CHECKOUT_PAGE_URL) ||\n\t\t\t\thref.includes('COSummary-Start') ||\n\t\t\t\thref.includes('Cart-DonateJson') ||\n\t\t\t\thref.includes('Cart-RemoveProductAjax')) &&\n\t\t\tdocument.querySelector(TOTAL_SELECTOR) &&\n\t\t\telemToFloat(document.querySelector(TOTAL_SELECTOR))\n\t\t);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\n\n/**\nDriver behavior:\n   Existing code: yes\n   Remove code: yes\n   Code retesting: yes\n   Stackable: no\n   Free gift support: no\n   isValid implemented: yes\n   Show message about free shipping: no\n   Driver is SPA: yes, on cart & checkout billing step\n   Gather merchant codes: no\n */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-totals-value';\n\t\tthis.APPLIED_COUPON_SELECTOR = '.coupon-discount-success, .coupon-name';\n\t\tthis.REMOVE_CODE_BUTTON_SELECTOR = '.remove-coupon-ajax';\n\t\tthis.HAVE_PROMO_CODE_BUTTON_SELECTOR = '#have_promo_code, .cart-coupon-code-input';\n\t\tthis.APPLY_CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\t\tthis.APPLY_CODE_BUTTON_SELECTOR = '#add-coupon';\n\n\t\tconst BASE_URL = 'https://www.loralette.com/on/demandware.store/Sites-Avenue-Site/en_US/';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}Cart-AddCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}COBilling-UpdateSummary`;\n\t\tthis.CART_COUPON_FORM = `.cart-coupon-code`;\n\n\t\tthis.CART_PAGE_URL = 'https://www.loralette.com/en_us/cart';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t}\n\n\tcheckCondition() {\n\t\tconst onCart = window.location.href.toLowerCase().startsWith(this.CART_PAGE_URL);\n\t\tconst cartCouponForm = document.querySelector(this.CART_COUPON_FORM);\n\t\tconst totalRendered = (document.querySelector(this.TOTAL_SELECTOR) || {}).offsetParent;\n\t\treturn onCart && cartCouponForm && totalRendered;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_COUPON_SELECTOR)].map(\n\t\t\telement => element.textContent.trim().split(/\\s/)[0],\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this.removeCode(codes[0])\n\t\t\t.then(() => this.getOrderSummary())\n\t\t\t.then(response => this.parseTotal(response));\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tapplyCodes(codes) {\n\t\tif (document.querySelector('.pt_cart')) {\n\t\t\t// We should remove query parameters, to prevent form submitting again on cart page only\n\t\t\t// `cannotRefresh` parameter can't be used\n\t\t\t// because on checkout page `POST` request should be used for page reloading\n\t\t\twindow.history.replaceState(\n\t\t\t\twindow.history.state,\n\t\t\t\twindow.document.title,\n\t\t\t\twindow.location.href.split('?')[0],\n\t\t\t);\n\t\t}\n\t\treturn this.applyCode(codes[0]);\n\t}\n};\n\nexport default {\n\tname: 'Loralette',\n\tdomain: 'loralette.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, completionActions } from '../../../utils';\nimport { elemToFloat } from '../../../utils/format';\n\nconst { extractElement } = DOM;\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ isValid implemented: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Gather codes on site pages: no\n*/\n\nconst CART_PAGE_URL = 'https://www.lumens.com/cart';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.ordertotal .value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.applycoupon li, .redemption .submitedcoupon';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cartproductrow, .checkoutminisummary .summaryproduct';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.lumens.com/on/demandware.store/Sites-Lumens-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/COBilling-ApplyCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCLI`;\n\t\tthis.UPDATE_REQUEST_URL = CART_PAGE_URL;\n\t\tthis.SHIPPING_SELECTOR = '.ordershipping .value';\n\t\tthis.TAX_SELECTOR = '.ordersalestax .taxCalcSpan';\n\n\t\tthis.CART_FORM_SELECTOR = '#dwfrm_cart';\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'coupon';\n\t\tthis.CODE_REGEX = /: (.*?) Remove/;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(\n\t\t\tcodeElement => codeElement.textContent.match(this.CODE_REGEX)[1],\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response));\n\t\t\tconst calculatedShipping = Number.isNaN(shipping) ? 0 : shipping;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response));\n\t\t\tconst calculatedTax = Number.isNaN(tax) ? 0 : tax;\n\t\t\treturn this.parseTotal(response) - calculatedShipping - calculatedTax;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Lumens',\n\tdomain: 'lumens.com',\n\tcompletionAction: completionActions.revisit,\n\tstackable: true,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cartempty'));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_PAGE_URL);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\n\nconst { DOM, format } = require('../../../utils');\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/** Behavior description:\n * - existing code: yes\n * - remove code: yes\n * - stackable: yes\n * - free gift support: yes\n * - 'isValid' implemented: yes\n * - Gather codes on site pages: yes\n * - replace code: can't check, currently there is only one valid code\n * - we run testing on the checkout and cart pages. They will be reloaded at the end.\n * - after testing on the checkout payment data will be erased.\n * - Also, on the FF we have modal before reloading page. Because with completion action `revisit` we can't appply codes at the end of the testing\n * */\n\nconst BASE_URL = 'https://www.madewell.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst BASE_URL_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-madewellUS-Site/default`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.mini-cart-product, .checkout-mini-cart .mini-cart-product';\n\t\tthis.isStackable = true;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL_REQUEST_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL_REQUEST_URL}/COBilling-UpdateSummary`;\n\t\tthis.PROMO_CODES_URL = `${BASE_URL}/promo-codes-discounts-coupons.html`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode, #dwfrm_cart_couponCode';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:last-child';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tthis.CODE_CONTAINER_SELECTOR = '.slick-track .slick-slide';\n\t\tthis.CODE_REGEX = /CODE (\\w+)./;\n\n\t\tthis.MERCHANT_CODES_SELECTOR = '.sections h3';\n\t\tthis.MERCHANT_CODE_REGEX = /code (\\w+)/i;\n\t}\n\n\tcheckCondition() {\n\t\tconst href = window.location.href.toLowerCase();\n\t\tconst isOnCart = href.startsWith(CART_PAGE_URL) && document.querySelector(this.CART_FORM_SELECTOR);\n\t\tconst isOnRightUrl = isOnCart || href.includes('/coshipping-singleshipping') || href.includes('/billing');\n\t\tconst isEmptyCartEl = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isCodeInputEl = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst currentState = isOnRightUrl && !isEmptyCartEl && isCodeInputEl;\n\t\treturn currentState;\n\t}\n\n\tasync getMerchantCodes() {\n\t\tconst merchantCodes = [];\n\n\t\tawait this._getPromoCodesPage().then(responseHTML => {\n\t\t\tmerchantCodes.push(\n\t\t\t\t...[...extractElement(this.MERCHANT_CODES_SELECTOR, responseHTML, true)]\n\t\t\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(el => el[1]),\n\t\t\t);\n\t\t});\n\n\t\tawait this.getCartPage().then(responseHTML => {\n\t\t\tconst merchantCode = responseHTML.match(this.CODE_REGEX);\n\t\t\tif (merchantCode) {\n\t\t\t\tmerchantCodes.push(...[merchantCode[1]]);\n\t\t\t}\n\t\t});\n\n\t\treturn [...new Set(merchantCodes)];\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) : 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax + shippingDiscount;\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_getPromoCodesPage() {\n\t\treturn fetch(this.PROMO_CODES_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Madewell',\n\tdomain: 'madewell.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport { completionActions, DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/*\nDriver behavior:\n   Existing code: yes\n   Remove code: yes\n   Code retesting: yes\n   Stackable: yes\n   Free gift support: no\n   isValid implemented: no\n   Show message about free shipping: no\n   Driver is SPA: yes, when genie is on right cart or checkout url and cart is not empty\n   Gather merchant codes: no\n======== Special case ========\n pages:\n- cart urls\n- /checkout (payment)\n- /expresscheckout (can't get existing and remove code when we have applied code)\n*/\n\nconst BASE_CART_URL = 'https://www.marmot.com';\nconst CART_PAGE_URL = `${BASE_CART_URL}/cart`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.PAGE_TOTAL_SELECTOR = '[class*=footer] .order-total .order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value, .redemption.coupon [data-couponcode]';\n\n\t\tthis.MERCHANT_CODES_SELECTOR = '.header-promotion span';\n\t\tthis.MERCHANT_CODES_REGEX = /with\\scode\\s(\\w+)/i;\n\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.marmot.com/on/demandware.store/Sites-Marmot_US-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/ExpressCheckout-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\t\tthis.REMOVE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tcheckCondition() {\n\t\t// Activate extension popup only when the code input is visible and we're on checkout\n\t\tconst { href } = window.location;\n\t\tconst isInput = (extractElement('#dwfrm_cart_couponCode, .promo-codes-fieldset.code-payment-fieldset') || {})\n\t\t\t.offsetParent;\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst onCart = href.startsWith(CART_PAGE_URL);\n\t\tconst onCheckout = href.startsWith(BASE_CART_URL) && href.match(/cart-submitform|cart-addtowishlist|checkout/i);\n\t\tconst secureCheckoutLink = href.includes('/expresscheckout');\n\t\tconst secureCheckoutForm = (extractElement('.express-checkout-form') || {}).offsetParent;\n\t\treturn (((onCart || onCheckout) && isInput) || (secureCheckoutLink && secureCheckoutForm)) && !emptyCart;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getHomePageHTML().then(responseHTML => {\n\t\t\treturn [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...extractElement(this.MERCHANT_CODES_SELECTOR, responseHTML, true)]\n\t\t\t\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODES_REGEX))\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.map(el => el[1]),\n\t\t\t\t),\n\t\t\t];\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(codeElement =>\n\t\t\t\tcodeElement && codeElement.getAttribute('data-couponcode')\n\t\t\t\t\t? codeElement.getAttribute('data-couponcode')\n\t\t\t\t\t: codeElement.innerText.trim(),\n\t\t\t)\n\t\t\t.filter(Boolean);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeApplyCodes() {\n\t\t// replace destructive URL\n\t\tif (window.location.href.includes('Cart-SubmitForm')) {\n\t\t\twindow.history.replaceState(window.history.state, window.document.title, this.CART_PAGE_URL);\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tparseTotal(html) {\n\t\t// total selector on the page differs from the one in the response\n\t\treturn html ? super.parseTotal(html) : elemToFloat(extractElement(this.PAGE_TOTAL_SELECTOR));\n\t}\n\n\t_getHomePageHTML() {\n\t\treturn fetch(`${BASE_CART_URL}/`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Marmot',\n\tdomain: 'marmot.com',\n\tcompletionAction: completionActions.revisit,\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions, format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/* Driver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+\n+ Pages, where extension works:\n   - Cart page\n   - Checkout page\n\n+ Is driver SPA yes\n+ Gather codes on site pages: no\n */\n\nconst BASE_URL = 'https://www.melissaanddoug.com';\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-melissaanddoug-Site/default`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.bfx-total-grandtotal';\n\t\tthis.TAX_SELECTOR = '.order-totals__order-sales-tax div.bfx-total-tax';\n\t\tthis.SHIPPING_SELECTOR = '.order-totals__order-shipping div.bfx-price';\n\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.mini-cart-product';\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.small-column .item-specific-properties';\n\t\tthis.CODE_VALUE_SELECTOR = '.item-details__value.clearfix';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\t\tthis.CART_PAGE_URL = `${BASE_URL}/cart`;\n\n\t\t// possible checkout url options\n\t\tthis.CHECKOUT_PAGE_URLS = [`${BASE_URL}/shipping`, `${BASE_URL}/checkout`, `${BASE_URL}/billing`];\n\n\t\tthis.isStackable = true;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\t\tthis.CODE_FIELD_SELECTOR = '#dwfrm_cart_couponCode, #dwfrm_billing_couponCode';\n\n\t\tthis.EMPTY_CART_SELECTOR = '#primary .cart-empty';\n\t\tthis.CHECKOUT_BTN_SELECTOR = '.malachite-btn.button.cart-actions__checkout-button.bfx-checkout';\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tcheckCondition() {\n\t\t// Activate extension popup only when the code input is visible and we're on cart\n\t\tconst onCart = window.location.href.startsWith(this.CART_PAGE_URL);\n\t\tconst onCheckout =\n\t\t\twindow.location.href.startsWith(this.CHECKOUT_PAGE_URL) ||\n\t\t\twindow.location.href.startsWith(`${BASE_REQUEST_URL}/Cart-AddToWishlist`);\n\n\t\tconst codeInput = document.querySelector(this.CODE_FIELD_SELECTOR);\n\n\t\tconst emptyCartMsg = document.querySelector(this.EMPTY_CART_SELECTOR);\n\n\t\treturn (\n\t\t\t(onCart || onCheckout) &&\n\t\t\tcodeInput &&\n\t\t\tcodeInput.offsetParent &&\n\t\t\t!(emptyCartMsg && emptyCartMsg.offsetParent)\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst getSummaryValue = selector => elemToFloat(extractElement(selector, responseHTML));\n\n\t\t\tconst tax = getSummaryValue(this.TAX_SELECTOR) || 0;\n\t\t\tconst shipping = getSummaryValue(this.SHIPPING_SELECTOR) || 0;\n\t\t\tconst total = getSummaryValue(this.TOTAL_SELECTOR);\n\n\t\t\treturn total - shipping - tax;\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(`${BASE_URL}/cart/`, {\n\t\t\tcredentials: 'include',\n\t\t\tmethod: 'GET',\n\t\t}).then(response => response.text());\n\t}\n\n\t_isOnCartPage() {\n\t\treturn this.CHECKOUT_PAGE_URLS && document.querySelector(this.CHECKOUT_BTN_SELECTOR);\n\t}\n};\n\nexport default {\n\tname: 'Melissa And Doug',\n\tdomain: 'melissaanddoug.com',\n\tstackable: true,\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tisSinglePageApp: true,\n};\n","import DemandwareAJAXDriver from './_base';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.merrell.com/on/demandware.store/Sites-merrell_us-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/Cart-UpdateBasketTotals`;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t}\n\n\tgetExistingCodes() {\n\t\tlet codes = [];\n\t\tif (window.location.pathname.includes('/cart')) {\n\t\t\tcodes = [...document.querySelectorAll('.cartcoupon .value')].map(elem => elem.innerText.trim());\n\t\t} else {\n\t\t\tconst codesElements = [...document.querySelectorAll('[data-couponcode]')].map(el =>\n\t\t\t\tel.getAttribute('data-couponcode'),\n\t\t\t);\n\t\t\tcodes = [...new Set(codesElements)];\n\t\t}\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: 'Merrell',\n\tdomain: 'merrell.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith('https://www.merrell.com/US/en/cart') ||\n\t\t\thref.startsWith('https://www.merrell.com/US/en/billing')\n\t\t);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, completionActions, format } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\nconst CART_URL = 'https://www.michaels.com/cart';\nconst EMPTY_CART_SELECTOR = '.cart-empty';\n\n/*\nDriver behavior description:\n+ Existing code: yes (also caught valid, but not working codes)\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support:  no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+\n+ Pages, where extension works:\n    - Cart page\n+ Is driver SPA no\n+ Gather codes on site pages: yes\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\n\t\tconst BASE_URL = 'https://www.michaels.com/on/demandware.store/Sites-MichaelsUS-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COSinglePageCheckout-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.isStackable = true;\n\n\t\tthis.TOTAL_SELECTOR = '.order-total-value .value';\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.cartcoupon';\n\t\tthis.CODE_VALUE_SELECTOR = '.bonus-item';\n\t\tthis.CODE_REGEX = /[pP]romo.*( [A-Z\\d]+[\\s$]?)/;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\n\t\tthis.COUPON_BOX_SELECTOR = '.coupon-bottom-box';\n\t\tthis.COUPON_BOX_VALUE = 'data-barcode-value';\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 30,\n\t\t});\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getMerchantCoupons().then(responseHTML => {\n\t\t\tconst promoCodes = [...extractElement(this.COUPON_BOX_SELECTOR, responseHTML, true)]\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(elem => elem.getAttribute(this.COUPON_BOX_VALUE))\n\t\t\t\t.filter(Boolean);\n\t\t\treturn promoCodes;\n\t\t});\n\t}\n\n\t_getMerchantCoupons() {\n\t\treturn fetch('https://www.michaels.com/coupons', {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODE_VALUE_SELECTOR)]\n\t\t\t.filter(element => element.innerText.match(this.CODE_REGEX))\n\t\t\t.map(element => element.innerText.match(this.CODE_REGEX)[1].trim())\n\t\t\t.filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = this._findValueByLabel(response, 'Estimated Shipping') || 0;\n\t\t\tconst tax = this._findValueByLabel(response, 'Estimated Tax') || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\t_findValueByLabel(response, label) {\n\t\tconst element = [...extractElement('span.label', response, true)].find(el => el.textContent.includes(label));\n\t\treturn element ? elemToFloat(element.nextElementSibling) : 0;\n\t}\n};\n\nexport default {\n\tname: 'Michael`s',\n\tdomain: 'michaels.com',\n\tstackable: true,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn (document.querySelector(EMPTY_CART_SELECTOR) || {}).offsetParent;\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('[name=\"dwfrm_cart_checkoutCart\"]');\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport { sessionTimer } from '../../lib';\nimport { browserUtils, completionActions, DOM, format, log } from '../../../utils';\nimport bus from '../../bus';\n\nconst { elemToFloat, toFloat } = format;\nconst { extractElement, setValue } = DOM;\nconst { getCookie, setCookie } = browserUtils;\n\n/** Behavior description:\n   Existing code: yes\n   Remove code: yes\n   Code retesting: yes\n   Stackable: no\n   Free gift support: no\n   isValid implemented: no\n   Show message about free shipping: no\n   Is SPA: yes\n   Gather merchant codes: no\n   Pages where extension work: Cart, checkout billing step \n====Special cases====\n\t- session timer: 15 min\n\t- Sometimes site have strange behavior and may send us wrong total\n\t- On checkout we applied code manually\n\t- we have some strange site behavior so we cover this 3 cases:\n\t\tIn case user was on Cart - we do not show Genie popup on Checkout.\n\t\tIn case user goes directly to Checkout, but has applied code manually, we provide fake code testing.\n\t\tIn case user goes directly to Checkout, but the code wasn't applied manually - we can run code testing.\n*/\n\nconst MAIN_URL = 'https://www.modcloth.com';\nconst CART_URL = `${MAIN_URL}/cart`;\nconst isOnCart = () => window.location.href.startsWith(CART_URL);\nconst isOnCheckout = () => window.location.href.includes('checkout');\nconst isCodeAppliedOnCheckout = () => document.querySelector('.activePromos');\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isOnCartPage = window.location.href.includes('/cart');\n\t\tconst BASE_URL = `${MAIN_URL}/on/demandware.store/Sites-modcloth-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/CheckoutCart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/CheckoutCart-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${MAIN_URL}/cart`;\n\t\tthis.CART_PAGE_URL = CART_URL;\n\t\tthis.CODE_INPUT_SELECTOR = '[name=\"couponCode\"]';\n\t\tthis.VALUE_SELECTOR = '.orderCost';\n\t\tthis.ROW_SELECTOR = '#orderCostBreakdown tr';\n\t\tthis.BILLING_STEP_SELECTOR = '#react-checkout-billing-step';\n\t\tthis.APPLIED_CODES_SELECTOR = '#promoContainer .summaryHighlight';\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'content-type': 'application/json;charset=UTF-8',\n\t\t};\n\t\tthis.APPLIED_CODE_INPUT_SELECTOR = '[name=\"couponCode\"]';\n\t\tthis.APPLIED_CODE_BUTTON_SELECTOR = '.actionLink';\n\t\tthis.REMOVE_REQUEST_HEADERS = {\n\t\t\t'content-type': 'application/json;charset=UTF-8',\n\t\t};\n\t\tthis.APPLY_RESPONSE_KEY = 'status';\n\t\tthis.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE = 'APPLIED';\n\t\tthis.PRE_TAX_SHIPPING_REGEX = /adjustedMerchandizeCost\":([\\d.]+)/i;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tif (isOnCart() && !getCookie('wasOnCart')) {\n\t\t\tsetCookie('wasOnCart', true, 20);\n\t\t}\n\t\tif (isOnCheckout() && isCodeAppliedOnCheckout() && !getCookie('skipCodeTesting')) {\n\t\t\tsetCookie('skipCodeTesting', true, 20);\n\t\t}\n\t\tconst codeInput = (document.querySelector(this.CODE_INPUT_SELECTOR) || {}).offsetParent;\n\t\tconst isTotal = document.querySelector(this.VALUE_SELECTOR);\n\t\tconst isUsa = getCookie('Globale_Simple') === 'USUSD';\n\t\tconst isOnBilling = document.querySelector(this.BILLING_STEP_SELECTOR);\n\n\t\treturn (\n\t\t\t(isOnCart() || isOnBilling) &&\n\t\t\tcodeInput &&\n\t\t\tisTotal &&\n\t\t\tisUsa &&\n\t\t\t(isOnCart() ? true : !getCookie('wasOnCart'))\n\t\t);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(el => el.textContent.trim());\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\tlet lastResponse = null;\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.removeCode(code).then(response => {\n\t\t\t\tlastResponse = response;\n\t\t\t}),\n\t\t).then(() => ({\n\t\t\toriginalPrice: this.parseTotal(lastResponse),\n\t\t\toriginalItemsCount: this.parseItemsCount(lastResponse),\n\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tfreeGifts: 0,\n\t\t\t};\n\t\t\tif (getCookie('skipCodeTesting') && isOnCheckout()) {\n\t\t\t\treturn Promise.delay(2000).then(() => bus.$emit('code-checked', result));\n\t\t\t}\n\t\t\treturn this.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst successState = this._getValueFromJSON(applyCodeResponse);\n\n\t\t\t\tif (successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\tresult.finalPrice = this.parseTotal(applyCodeResponse);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\tif (\n\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\n\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\treturn toFloat(response.match(this.PRE_TAX_SHIPPING_REGEX)[1]);\n\t\t});\n\t}\n\n\tapplyCode(code) {\n\t\treturn this._sendRequest(\n\t\t\t'POST',\n\t\t\tthis.APPLY_CODE_URL,\n\t\t\tthis.APPLY_REQUEST_HEADERS,\n\t\t\tnull,\n\t\t\tJSON.stringify({ CouponCode: code }),\n\t\t);\n\t}\n\n\tapplyCodeManually(code) {\n\t\tconst codeInputElm = document.querySelector(this.APPLIED_CODE_INPUT_SELECTOR);\n\t\tconst codeApplyBtn = document.querySelector(this.APPLIED_CODE_BUTTON_SELECTOR);\n\n\t\tsetValue(codeInputElm, code);\n\n\t\tcodeApplyBtn.click();\n\t\treturn Promise.resolve();\n\t}\n\n\tremoveCode(code) {\n\t\tif (getCookie('skipCodeTesting') && isOnCheckout()) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\treturn this._sendRequest(\n\t\t\t'POST',\n\t\t\tthis.REMOVE_CODE_URL,\n\t\t\tthis.REMOVE_REQUEST_HEADERS,\n\t\t\tnull,\n\t\t\tJSON.stringify({ couponID: code }),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\tif (getCookie('skipCodeTesting') && isOnCheckout()) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\treturn isOnCart() ? this.applyCode(codes[0]) : this.applyCodeManually(codes[0]);\n\t}\n\n\t_findValueByLabel(response, string) {\n\t\treturn [...extractElement(this.ROW_SELECTOR, response, true)]\n\t\t\t.filter(elem => elem.innerText.includes(string))\n\t\t\t.map(elem => elem.querySelector(this.VALUE_SELECTOR))[0];\n\t}\n\n\tparseTotal(data) {\n\t\tif (data) {\n\t\t\tconst shipping = data.shippingCost && !isOnCart() ? data.shippingCost : 0;\n\t\t\tconst tax = data.tax && !isOnCart() ? data.tax : 0;\n\t\t\treturn toFloat(data.adjustedMerchandizeCost) + toFloat(shipping) + toFloat(tax);\n\t\t}\n\t\treturn elemToFloat(this._findValueByLabel(false, 'Total'));\n\t}\n};\n\nexport default {\n\tname: 'ModCloth',\n\tdomain: 'modcloth.com',\n\tcompletionAction: isOnCart() ? completionActions.default : completionActions.none,\n\tDriver,\n\tmaxCoupons: 5,\n\tisSinglePageApp: true,\n};\n","import DemandwareAJAXDriver from './_base';\nimport completionActions from '../../../utils/completion-actions';\nimport { DOM } from '../../../utils';\nimport { elemToFloat } from '../../../utils/format';\n\nconst { extractElement } = DOM;\n\nconst CART_PAGE_URL = 'https://www.modells.com/cart';\nconst BILLING_PAGE_URL = 'https://www.modells.com/billing';\nconst isOnCartPage = window.location.pathname.toLowerCase().includes('/cart');\n\n/** Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Billing\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n * */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLY_CODES_SELECTOR = isOnCartPage ? '.cartcoupon .value' : '.coupon .success';\n\n\t\tthis.CODE_REGEX_CART = /\\S(\\w+)/;\n\t\tthis.CODE_REGEX_CHECKOUT = /Coupon code \\S(\\w+)/;\n\n\t\tthis.TOTAL_SELECTOR = '.value.order-value';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping .value';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax .value';\n\n\t\tconst BASE_URL = 'https://www.modells.com/on/demandware.store/Sites-Modells-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BILLING_PAGE_URL}page`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.EMPTY_CART_SELECTOR = '.cart__empty';\n\t\tthis.CODE_INPUT_SELECTOR = '[name=\"dwfrm_cart_couponCode\"], [name=\"dwfrm_billing_couponCode\"]';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'old');\n\t}\n\n\tcheckCondition() {\n\t\tconst isCodeInputElem = (document.querySelector(this.CODE_INPUT_SELECTOR) || {}).offsetParent;\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\treturn isCodeInputElem && !emptyCart;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLY_CODES_SELECTOR)].map(el => {\n\t\t\tconst codeRegex = isOnCartPage ? this.CODE_REGEX_CART : this.CODE_REGEX_CHECKOUT;\n\t\t\treturn el.textContent.match(codeRegex)[1];\n\t\t});\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeApplyCodes() {\n\t\twindow.history.pushState(window.history.state, window.document.title, CART_PAGE_URL);\n\t\treturn Promise.resolve();\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Modells',\n\tdomain: 'modells.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tisSinglePageApp: true,\n\tcartContinueUrl: isOnCartPage ? window.location.href : 'https://www.modells.com/billing',\n};\n","import DemandwareAJAXDriver from './_base';\n\n/*\n Driver behavior description:\n -    Existing code: yes\n -    Remove code: yes\n -    Stackable:  no\n -    Free gift support: yes\n -    isValid implemented: yes\n Optional:\n -    Is driver SPA and add the condition to show popup: no\n -\tShow popup on the Cart and Checkout (2 step, after reloadind user will be redirected\n\t to the first step without without erasing adress data) pages\n  */\n\nconst BASE_URL = 'https://www.motherhood.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst BILLING_PAGE_URL = `${BASE_URL}/billing`;\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-mh-us-Site/default`;\nconst CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode';\nconst isOnCart = () => Boolean(document.querySelector(CODE_INPUT_SELECTOR));\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn isOnCart();\n\t}\n};\n\nexport default {\n\tname: 'Motherhood Maternity',\n\tdomain: 'motherhood.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t(href.startsWith(CART_PAGE_URL) ||\n\t\t\t\thref.startsWith(BILLING_PAGE_URL) ||\n\t\t\t\thref.includes('/shipping') ||\n\t\t\t\thref.includes('/checkout') ||\n\t\t\t\thref.includes('/Cart-AddToWishlist')) &&\n\t\t\tdocument.querySelector(`#dwfrm_billing_couponCode, ${CODE_INPUT_SELECTOR}`)\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.mini-cart-empty');\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\n\n/** Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout (Payment step with redirect)\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n *\n * Added 25s wait for the outclick tab to close\n * as the driver works much faster than it takes for the outclick tab to close.\n * */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '#csc-amount-total';\n\t\tthis.APPLIED_CODES_SELECTOR = '#csc-table-coupon-codes [data-transaction]';\n\t\tthis.PAYMENT_STEP_SELECTOR = '#csc-collapse-payment.show';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty:not([class*=\"d-none\"])';\n\t\tthis.CART_CODE_INPUT_SELECTOR = '#csc-coupon-code';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.mountainhardwear.com/on/demandware.store/Sites-MountainHardwear_US-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/SinglePageCheckout-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/SinglePageCheckout-AddCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/SinglePageCheckout-UpdateOrderSummary`;\n\n\t\tthis.CART_PAGE_URL = 'https://www.mountainhardwear.com/cart';\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'removeCoupon';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t\tthis.updateQueryParams.set('format', 'ajax');\n\n\t\tthis.APPLY_RESPONSE_KEY = null;\n\n\t\tthis.OUTCLICK_TAB_CLOSE_TIMEOUT = 25;\n\t}\n\n\tcheckCondition() {\n\t\tconst cartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst cartCodeInput = document.querySelector(this.CART_CODE_INPUT_SELECTOR);\n\t\tconst paymentStep = (document.querySelector(this.PAYMENT_STEP_SELECTOR) || {}).offsetParent;\n\t\tconst promoInputVisible = cartCodeInput || paymentStep;\n\t\tconst currentState = !cartEmpty && promoInputVisible;\n\t\treturn currentState;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(\n\t\t\telement => element.dataset.transaction,\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this._watchForOutclickTab();\n\t}\n\n\t_watchForOutclickTab() {\n\t\t// outclick tab won't close by itself sometimes\n\t\treturn new Promise(resolve => {\n\t\t\tchrome.runtime.onMessage.addListener(msg => msg.tabClosed && resolve());\n\t\t\treturn setTimeout(() => resolve(), this.OUTCLICK_TAB_CLOSE_TIMEOUT * 1000);\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Mountain Hardware',\n\tdomain: 'mountainhardwear.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tmaxCoupons: 25, // driver is fast\n\tDriver,\n};\n","import DemandwareAJAXDriver from './_base';\nimport completionActions from '../../../utils/completion-actions';\n\n/*\nDriver behavior description:\n-    Existing code: yes\n-    Remove code: yes\n-    Stackable:no\n-    Free gift support: no\n-    isValid implemented: yes\nOptional:\n-    Show message about free shipping on the cart page (without discount info): no\n-    Is driver SPA and add the condition to show popup: no\n-\t We can apply code on Cart page and on Billing\n */\n\nconst MAIN_URL = 'https://www.mrcoffee.com';\nconst CART_PAGE_URL = `${MAIN_URL}/cart`;\nconst BILLING_PAGE_URL = `${MAIN_URL}/billing`;\n// it is safer to check code input, because sometimes we can move from Cart to Checkout without url change\nconst isOnCartPage = () => document.querySelector('#dwfrm_cart_couponCode');\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value';\n\n\t\tconst BASE_URL = 'https://www.mrcoffee.com/on/demandware.store/Sites-mr-coffee-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.PROMO_INPUT_SELECTOR_CART = '#dwfrm_cart_couponCode';\n\t\tthis.PROMO_INPUT_SELECTOR_CHECKOUT = '#dwfrm_billing_couponCode';\n\t\tthis.PROMO_BTN_SELECTOR = '#add-coupon';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn Boolean(document.querySelector(this.PROMO_INPUT_SELECTOR_CART));\n\t}\n};\n\nexport default {\n\tname: 'MrCoffee',\n\tdomain: 'mrcoffee.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tcartContinueUrl: isOnCartPage() ? CART_PAGE_URL : BILLING_PAGE_URL,\n\tisOnCartUrl() {\n\t\treturn document.querySelector('#dwfrm_cart_couponCode, #dwfrm_billing_couponCode');\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/*\nBehavior description:\n\t+ Existing code: yes\n\t+ Remove code: yes\n\t+ Stackable: no\n\t+ Free gift support: no\n\t+ Free shipping: no\n\t+ isValid implemented: no\n\t+ Replace code: no\n\t+ Pages, where extension works: Billing\n\t+ Is SPA: no\n\t+ Gather codes on site pages: no\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\n\t\tconst BASE_URL = 'https://www.nastygal.com/on/demandware.store/Sites-nastygal-US-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'couponID';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\n\t\tthis.APPLY_RESPONSE_KEY = null;\n\n\t\tthis.APPLIED_CODE_SELECTOR = '[data-coupon]';\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [];\n\t\tconst codeElement = document.querySelector(this.APPLIED_CODE_SELECTOR);\n\t\tif (codeElement) {\n\t\t\tcodes.push(codeElement.getAttribute('data-coupon'));\n\t\t}\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this.getOrderSummary().then(responseJSON => this.parseTotal(responseJSON));\n\t}\n\n\tapplyCode(code) {\n\t\tthis.applyQueryParams.set(this.APPLY_CODE_PARAM_NAME, code);\n\n\t\treturn this._sendRequestPOST(this.APPLY_CODE_URL, this.APPLY_REQUEST_HEADERS, this.applyQueryParams);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) || 0 : 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax + shippingDiscount;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Nasty Gal',\n\tdomain: 'nastygal.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.nastygal.com/billing-continue');\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions, DOM, format } from '../../../utils';\n\nconst { extractElement, extractElementFromHTML } = DOM;\nconst { elemToFloat, toFloat } = format;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: yes\n*/\n\nconst BASE_URL = 'https://www.nautica.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst SHIPPING_URL = `${BASE_URL}/shippingstart`;\nconst BILLING_URL = `${BASE_URL}/billing`;\n\nfunction parseTotalValue(selector, html) {\n\treturn elemToFloat(extractElement(selector, html));\n}\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = true;\n\n\t\tthis.TOTAL_SELECTOR = '.estimated-total td:last-child';\n\n\t\tconst BASE_REQUEST_URL = 'https://www.nautica.com/on/demandware.store/Sites-nau-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = CART_PAGE_URL;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-row';\n\t\tthis.PRODUCT_NAME_SELECTOR = '.name';\n\t\tthis.ITEM_PRICE_SELECTOR = '.price-total';\n\t\tthis.DONATION_REGEX = /donation/i;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value';\n\t\tthis.PROMOTION_SELECTOR = '[class*=coupon-default]';\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:last-child';\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.donationAmount = [...document.querySelectorAll(this.PRODUCT_ITEM_SELECTOR)]\n\t\t\t.filter(el => el.querySelector(this.PRODUCT_NAME_SELECTOR).innerText.match(this.DONATION_REGEX))\n\t\t\t.map(el => toFloat(el.querySelector(this.ITEM_PRICE_SELECTOR).innerText))\n\t\t\t.reduce((a, b) => a + b, 0);\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.PROMOTION_SELECTOR)].map(el => el.innerText).filter(Boolean);\n\t}\n\n\tgetExistingCodes() {\n\t\treturn Promise.resolve()\n\t\t\t.then(() => {\n\t\t\t\tif (this._isOnCartPage()) {\n\t\t\t\t\treturn document.documentElement.innerHTML;\n\t\t\t\t}\n\t\t\t\treturn this.getCartPage();\n\t\t\t})\n\t\t\t.then(html => {\n\t\t\t\tconst appliedCodesSelector = this.APPLIED_CODES_SELECTOR\n\t\t\t\t\t? this.APPLIED_CODES_SELECTOR\n\t\t\t\t\t: this.CODE_VALUE_SELECTOR;\n\t\t\t\tconst codes = [\n\t\t\t\t\t...new Set(\n\t\t\t\t\t\t[...extractElementFromHTML(html, appliedCodesSelector, true)].map(element =>\n\t\t\t\t\t\t\telement.innerText.trim(),\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t];\n\n\t\t\t\treturn {\n\t\t\t\t\tcodes,\n\t\t\t\t\tcodeCount: codes.length,\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) || 0 : 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax + shippingDiscount - this.donationAmount;\n\t\t});\n\t}\n\n\t_getRemoveValueName(code, html) {\n\t\tconst codesElements = extractElement(this.CODES_ELEMENTS_SELECTOR, html, true);\n\t\tconst matchingCodesElement = [...codesElements].find(element => {\n\t\t\tconst codesElement = element.querySelector(this.CODE_VALUE_SELECTOR);\n\t\t\treturn codesElement && codesElement.innerText.trim().toLowerCase() === code.toLowerCase();\n\t\t});\n\n\t\treturn matchingCodesElement ? matchingCodesElement.querySelector(this.REMOVE_CODE_SELECTOR).name : null;\n\t}\n\n\tparseTotal(html) {\n\t\treturn parseTotalValue(this.TOTAL_SELECTOR, html);\n\t}\n};\n\nexport default {\n\tname: 'Nautica',\n\tdomain: 'nautica.com',\n\tcompletionAction: completionActions.revisit,\n\tstackable: true,\n\tDriver,\n\tcartContinueUrl: window.location.href.startsWith(CART_PAGE_URL) ? CART_PAGE_URL : window.location.href,\n\tisOnCartUrl(href) {\n\t\tconst subtotalSelector = '.order-totals-table .bfx-total-subtotal';\n\t\tconst hrefLowerCase = href.toLowerCase();\n\t\tconst subtotal = document.querySelector(subtotalSelector);\n\t\treturn (\n\t\t\tsubtotal &&\n\t\t\tparseTotalValue(subtotalSelector) &&\n\t\t\t!document.querySelector('.checkout-order-totals') &&\n\t\t\tdocument.querySelector('[name=\"dwfrm_cart_couponCode\"]') &&\n\t\t\t(hrefLowerCase.startsWith(CART_PAGE_URL) ||\n\t\t\t\threfLowerCase.startsWith(SHIPPING_URL) ||\n\t\t\t\threfLowerCase.startsWith(BILLING_URL))\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport { completionActions } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst BASE_URL = 'https://www.neutrogena.com';\nconst REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-Neutrogena-Site/default`;\n/**\n * Driver behavior description:\n -    Existing code: yes\n -    Remove code: yes\n -    Stackable: yes\n -    Free gift support: no\n -    isValid implemented: yes\n Optional:\n -    Show message about free shipping on the cart page (without discount info): no\n -    Is driver SPA and add the condition to show popup: no\n -\t  sessionTimer 15 min\n -\t  run only on the cart page\n */\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = true;\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\n\t\tthis.APPLY_CODE_URL = `${REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${REQUEST_URL}/COBilling-UpdateSummary`;\n\t\tthis.CART_PAGE_URL = `${BASE_URL}/cart`;\n\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tbeforeApplyCodes() {\n\t\t// remove codes apply message to avoid duplicates\n\t\t[...document.querySelectorAll(this.CODE_APPLY_MSG_SELECTOR)].map(msg => msg.remove());\n\t\treturn Promise.resolve();\n\t}\n};\n\nexport default {\n\tname: 'Neutrogena',\n\tdomain: 'neutrogena.com',\n\tstackable: true,\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tisCartEmpty() {\n\t\tconst emptyCartMsg = document.querySelector('.cart-empty');\n\t\treturn emptyCartMsg && emptyCartMsg.offsetParent;\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.toLowerCase().startsWith(`${BASE_URL}/cart`);\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { sessionTimer, backgroundMessaging } from '../../lib';\nimport { completionActions, log, DOM, format, browserUtils } from '../../../utils';\n\nconst { getCookie } = browserUtils;\nconst { extractData, extractElement } = DOM;\nconst { toFloat, elemToFloat } = format;\n\n/** Behavior description:\n+ Existing code: yes\n+ Remove code: not always, can remove code if couponToken presents in cookie\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: yes (checkout)\n+ Pages, where extension works:\n\t* cart\n+ Is driver SPA yes\n    * cookie is enabled\n\t* is not empty\n\t* header text\n\t* is not maxCodeTesting\n+ Gather codes on site pages: no\n+ Special case about the driver works\n\t* maxCoupons 5\n\t* sessionTimer yes/15min\n\t* disable codes testing after 2 runs for 60 minutes\nWe do not show a popup for 60 minutes, and we also have a limit on maxCoupons of 5, due to blocking\nAlso, if the problem persists after 60 minutes, we mark the codes as invalid\nRemove codes manually because on remove code request is token which is not present anywhere\nBut if manually click on remove code button couponToken appears in cookie\n * */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-total .total-value';\n\t\tthis.TAX_SELECTOR = '.order-total .tax .total-value';\n\t\tthis.SHIPPING_SELECTOR = '.order-total .shipping .total-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.promo .action-remove-promo';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.product-line.product';\n\t\tthis.TITLE_SELECTOR = '.cart-title';\n\t\tthis.EMPTY_SELECTOR = '.h1.cart-empty';\n\t\tthis.isStackable = true;\n\t\tthis.CODE_REMOVE_BTN_SELECTOR = '.action-remove-promo';\n\n\t\tthis.BASE_URL = 'https://www.newbalance.com/on/demandware.store/Sites-newbalance_us2-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${this.BASE_URL}/COBilling-ApplyCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${this.BASE_URL}/COBilling-RemovePromoCode`;\n\t\tthis.UPDATE_REQUEST_URL = `${this.BASE_URL}/COBilling-UpdateSummary`;\n\t\tthis.CART_PAGE_URL = `${this.BASE_URL}/Cart-Show`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'promoCode';\n\t\tthis.isInvalid = false;\n\n\t\tthis.DISABLE_TIME_MS = 60 * 60 * 1000; // 60 minutes\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tasync checkCondition() {\n\t\tlet isNotMaxCodeTesting = true;\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(this.DOMAIN);\n\t\tif (driverStorage) {\n\t\t\tconst dataExpired = Date.now() - driverStorage.lastTestTimestamp >= this.DISABLE_TIME_MS;\n\t\t\tif (dataExpired) {\n\t\t\t\tbackgroundMessaging.deleteDriverStorage(this.DOMAIN);\n\t\t\t} else {\n\t\t\t\tisNotMaxCodeTesting = driverStorage.codeTestingCount < 2;\n\t\t\t}\n\t\t}\n\t\tconst { cookieEnabled } = window.navigator;\n\t\tconst isEmpty = document.querySelector(this.EMPTY_SELECTOR);\n\t\tconst headerElement = document.querySelector(this.TITLE_SELECTOR);\n\t\tconst isHeader = headerElement && headerElement.innerText.trim().match(/my (?:cart|bag)/i);\n\t\treturn isNotMaxCodeTesting && !isEmpty && isHeader && cookieEnabled;\n\t}\n\n\tbeforeTestCodes() {\n\t\treturn this.applyCode('fake-code').then(responseJSON => {\n\t\t\tthis.isInvalid = Object.keys(responseJSON).length === 0;\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(el => el.getAttribute('data-code')),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this._removeCodeManually(code))\n\t\t\t.then(() => this.getCartPage())\n\t\t\t.then(response => this.parseTotal(response));\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\n\t\t\t\tif (\n\t\t\t\t\tapplyCodeResponse.redemptionErrorMsg ||\n\t\t\t\t\tthis.isInvalid ||\n\t\t\t\t\tObject.keys(applyCodeResponse).length === 0\n\t\t\t\t) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount(orderSummary) - originalItemsCount;\n\t\t\t\t\tresult.isValid = true;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.isStackable) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t\toriginalItemsCount,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tasync beforeApplyCodes() {\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(this.DOMAIN);\n\t\tconst codeTestingCount = driverStorage ? driverStorage.codeTestingCount : 0;\n\t\tbackgroundMessaging.setDriverStorage(this.DOMAIN, {\n\t\t\tcodeTestingCount: codeTestingCount + 1,\n\t\t\tlastTestTimestamp: Date.now(),\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getCartPage().then(responseHTML => {\n\t\t\tconst total = toFloat(extractData(this.TOTAL_SELECTOR, responseHTML));\n\n\t\t\t// shipping element not always presents on the page\n\t\t\tconst shippingEl = extractElement(this.SHIPPING_SELECTOR, responseHTML);\n\t\t\tconst shippingData = shippingEl ? elemToFloat(shippingEl) : 0;\n\t\t\t// Might be \"Please select a shipping method\"\n\t\t\tconst shipping = Number.isNaN(shippingData) ? 0 : shippingData;\n\n\t\t\tconst taxData = toFloat(extractData(this.TAX_SELECTOR, responseHTML));\n\t\t\t// Tax will be estimated after visiting checkout page\n\t\t\tconst tax = Number.isNaN(taxData) ? 0 : taxData;\n\n\t\t\treturn total - shipping - tax;\n\t\t});\n\t}\n\n\t_removeCodeManually() {\n\t\tdocument.querySelector(this.CODE_REMOVE_BTN_SELECTOR).click();\n\t\treturn Promise.resolve();\n\t}\n\n\tremoveCode(code) {\n\t\tif (this.REMOVE_CODE_PARAM_NAME) {\n\t\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\t\t// if manually click on remove code button couponToken appears in cookie\n\t\t\tthis.removeQueryParams.set('couponToken', getCookie('couponToken'));\n\t\t}\n\t\treturn this._sendRequestGET(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n};\n\nexport default {\n\tname: 'New Balance',\n\tdomain: 'newbalance.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tmaxCoupons: 5,\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n};\n","import DemandwareAJAXDriver from './_base';\n\n/**\nDriver behavior description:\n+ Existing code: yes \n+ Remove code: yes \n+ Stackable: yes \n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Pages, where extension works: cart\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n */\n\nconst CART_URL = 'https://www.nixon.com/us/en/cart';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '[data-promocode]';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.nixon.com/on/demandware.store/Sites-US-Site/en_US/FluidCheckout';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}-ApplyPromotionCode`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}-RemovePromotionCode`;\n\t\tthis.UPDATE_REQUEST_URL = CART_URL;\n\n\t\tthis.applyQueryParams.set('returnObject', 'Basket,OrderSummary,ShippingOptions');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(codeElement =>\n\t\t\tcodeElement.getAttribute('data-promocode'),\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tapplyCode(code) {\n\t\tthis.applyQueryParams.set('promoCode', code);\n\t\tthis.applyQueryParams.set('userSubmittedCode', code);\n\n\t\treturn this._sendRequestPOST(this.APPLY_CODE_URL, this.APPLY_REQUEST_HEADERS, this.applyQueryParams);\n\t}\n\n\tremoveCode(code) {\n\t\tthis.removeQueryParams.set('promoCode', code);\n\t\tthis.removeQueryParams.set('userSubmittedCode', code);\n\n\t\treturn this._sendRequestPOST(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n};\n\nexport default {\n\tname: 'Nixon',\n\tdomain: 'nixon.com',\n\tstackable: true,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.empty-cart');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\n\n/* Driver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+\n+ Pages, where extension works:\n    - Cart page\n    - Checkout page (billing step)\n+ Is driver SPA no\n+ Gather codes on site pages: no\n+\n+ Credentials (for signing in):\n\t- email address: oster@d-link.ml; password: 12345Temporary\n*/\n\nconst BASE_URL = `${window.location.protocol}//www.oster.com`;\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-oster-Site/default`;\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst CUSTOMER_URL = `${BASE_URL}/customer`;\nconst BILLING_URL = `${BASE_URL}/billing`;\nconst SHIPPING_URL = `${BASE_URL}/shipping`;\nconst WISHLIST_URL = `${BASE_URL}/on/demandware.store/Sites-oster-Site/default/Cart-AddToWishlist`;\nconst isOnCart = () => Boolean(document.querySelector('#dwfrm_cart_couponCode'));\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = true;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = isOnCart() ? CART_PAGE_URL : `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_FORM_SELECTOR = '#cart-items-form, #dwfrm_billing';\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tgetOrderSummary() {\n\t\t// sending 2 identical requests and parsing total from the 2nd response,\n\t\t// since 1st one, for some reason, does not contain valid total amount\n\t\treturn super.getOrderSummary().then(() => super.getOrderSummary());\n\t}\n\n\t_isOnCartPage() {\n\t\treturn isOnCart();\n\t}\n};\n\nexport default {\n\tname: 'Oster',\n\tdomain: 'oster.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\tconst urls = [CART_PAGE_URL, CUSTOMER_URL, BILLING_URL, SHIPPING_URL, WISHLIST_URL];\n\t\treturn (\n\t\t\turls.some(url => href.includes(url)) &&\n\t\t\tdocument.querySelector('#dwfrm_billing_couponCode, #dwfrm_cart_couponCode')\n\t\t);\n\t},\n\tcartContinueUrl: isOnCart() ? CART_PAGE_URL : BILLING_URL,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.mini-cart-empty'));\n\t},\n};\n","import DemandwareDriver from './_base';\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: yes\n    Free gift support: no\n    isValid implemented: yes\n    Manually apply code: no\nOptional:\n    Show message about free shipping on the cart page (without discount info): no\n    Is driver SPA and add the condition to show popup: yes\n    Gather codes on site pages: no */\n\nconst BASE_URL = 'https://www.otterbox.com';\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-otterbox_us_v2-Site/default`;\nconst CART_PAGE_URL = `${BASE_URL}/en-us/cart`;\nconst DELIVERY_PAGE_URL = `${BASE_REQUEST_URL}/BasicShipping-Delivery`;\nconst BILLING_PAGE_URL = `${BASE_REQUEST_URL}/BasicBilling-Start`;\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.checkout-order-totals .order-total .value span';\n\t\tthis.CODE_VALUE_SELECTOR = '.b-coupon_minisummary-coupon a';\n\t\tthis.CART_FORM_SELECTOR = '#coupon-form';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/Cartcon-DeleteCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.updateQueryParams.set('format', 'ajax');\n\n\t\tthis.isStackable = true;\n\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t\tthis.CHECK_ELEM_SELECTOR = '#dwfrm_basicbilling_sameAsShipping';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isOnCart = href.startsWith(CART_PAGE_URL);\n\t\tconst isOnDelivery = href.startsWith(DELIVERY_PAGE_URL);\n\t\tconst isOnPayment = href.startsWith(BILLING_PAGE_URL);\n\t\tconst checkElem = document.querySelector(this.CHECK_ELEM_SELECTOR);\n\t\tconst isCheckElem = checkElem ? checkElem.checked : false;\n\t\tconst currentState = (isOnCart && !emptyCart) || isOnDelivery || (isOnPayment && isCheckElem);\n\t\treturn currentState;\n\t}\n\n\tremoveCode(code) {\n\t\tif (this.REMOVE_CODE_PARAM_NAME) {\n\t\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\t}\n\n\t\treturn this._sendRequestPOST(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n};\n\nexport default {\n\tname: 'Otterbox.com',\n\tdomain: 'otterbox.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions } from '../../../utils';\n\n/* BEHAVIOUR\n * Can apply more than one code at the same time (stackable)\n * Can remove on cart page\n * Can getExistingCodes\n */\n\nconst DOMAIN_URL = 'https://www.pacificcoast.com';\nconst CART_URL = `${DOMAIN_URL}/cart`;\nconst BASE_URL = `${DOMAIN_URL}/on/demandware.store/Sites-PacificCoast-Site/default`;\nconst WISH_LIST_URL = `${DOMAIN_URL}/on/demandware.store/Sites-PacificCoast-Site/default/Cart-AddToWishlist`;\nconst CART_INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = true;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemovePromoCode`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.CART_PAGE_URL = CART_URL;\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n};\n\nexport default {\n\tname: 'Pacific Coast Feather',\n\tdomain: 'pacificcoast.com',\n\tcompletionAction: completionActions.revisit,\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\tdocument.querySelector(CART_INPUT_SELECTOR) && (href.startsWith(CART_URL) || href.startsWith(WISH_LIST_URL))\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport DemandwareAJAXDriver from './_base';\nimport { DOM, completionActions, log } from '../../../utils';\n\nconst { extractElement, extractData } = DOM;\n\n/*\nDriver behavior:\n   Existing code: yes\n   Remove code: yes\n   Code retesting: yes\n   Stackable: no\n   Free gift support: no\n   isValid implemented: yes\n   Show message about free shipping: no\n   Driver is SPA: yes, on cart when total is present\n   Gather merchant codes: yes\n   Special case: no\n   Credentials: no\n   support only cart page\n */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_FORM_SELECTOR = '.cart-coupon-code [class*=\"coupon-code\"]';\n\t\tthis.CODE_VALUE_SELECTOR = '.cart-table .cartcoupon .value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cart-table .cartcoupon .value, #promoCodeHolder';\n\t\tthis.TOTAL_SELECTOR = '.order-subtotal .right, .value.ocp-order-total-value';\n\t\tthis.FLAG_SELECTOR = '.flag[title=US]';\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\n\t\tthis.CART_PAGE_URL = 'https://www.pacsun.com/on/demandware.store/Sites-pacsun-Site/default/Cart-Show';\n\n\t\tconst baseURL = 'https://www.pacsun.com/on/demandware.store/Sites-pacsun-Site/default';\n\t\tthis.APPLY_CODE_URL = `${baseURL}/COCheckoutUtil-AddPromoCode`;\n\t\tthis.REMOVE_CODE_URL = `${baseURL}/COCheckoutUtil-DeletePromoCode`;\n\t\tthis.UPDATE_REQUEST_URL = this.CART_PAGE_URL;\n\n\t\tthis.applyQueryParams.set('instart_disable_injection', true);\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.removeQueryParams.set('instart_disable_injection', true);\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\n\t\tthis.updateQueryParams.set('instart_disable_injection', true);\n\t\tthis.updateQueryParams.set('format', 'ajax');\n\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty-msg';\n\t\tthis.CODE_ERROR_MESSAGE = '.promoError';\n\t\tthis.CODE_NOT_APPLIED_MSG = '.bonusitem';\n\t\tthis.CODE_REGEX = /Promo Code:\\s+(\\w+)/;\n\t\tthis.MERCHANT_COUPON_REGEX = /(code|coupon|promo)\\W{1,3}(\\w+)/i;\n\t\tthis.PROMO_BAR_SELECTOR = '.nano-bar';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst correctTotal = (document.querySelector(this.TOTAL_SELECTOR) || { innerText: '' }).innerText.match(\n\t\t\t'[0-9]+',\n\t\t);\n\t\tconst cartCouponForm = document.querySelector(this.CART_FORM_SELECTOR);\n\t\tconst correctPage = href.toLowerCase().startsWith(this.CART_PAGE_URL.toLowerCase());\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isUSA = document.querySelector(this.FLAG_SELECTOR);\n\t\treturn correctPage && cartCouponForm && !emptyCart && correctTotal && isUSA;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.PROMO_BAR_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.MERCHANT_COUPON_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.filter(arr => arr.length >= 3)\n\t\t\t.map(arr => arr[2].toUpperCase())\n\t\t\t.filter((code, index, arr) => arr.indexOf(code) === index);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(codeElement =>\n\t\t\tcodeElement.innerText.trim(),\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\n\t\t\t\tconst codeCheck = this._isCodeInvalid(applyCodeResponse);\n\n\t\t\t\tif (codeCheck) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\t// delay added because of sentry errors\n\t\treturn Promise.delay(3000)\n\t\t\t.then(() => this.getOrderSummary())\n\t\t\t.then(responseHTML => {\n\t\t\t\t// no taxes on the cart page, and no shipping\n\t\t\t\treturn this.parseTotal(responseHTML);\n\t\t\t});\n\t}\n\n\t_isCodeInvalid(data) {\n\t\treturn (\n\t\t\textractElement(this.CODE_ERROR_MESSAGE, data) ||\n\t\t\textractData(this.CODE_NOT_APPLIED_MSG, data).match(/Not Applied/i)\n\t\t);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn window.location.href.startsWith(this.CART_PAGE_URL) && document.querySelector(this.CART_FORM_SELECTOR);\n\t}\n};\n\nexport default {\n\tname: 'PacSun',\n\tdomain: 'pacsun.com',\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import DemandwareAJAXDriver from './_base';\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - can apply multiple codes (stackable)\n * */\n\nconst CART_PAGE_URL = 'https://www.parkerny.com/bag';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.parkerny.com/on/demandware.store/Sites-parkerny-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\n\t\tthis.CART_EMPTY_SELECTOR = '.cart-empty';\n\t}\n\n\tcheckCondition() {\n\t\tconst emptyCartElement = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\tconst addCouponButton = document.querySelector(this.APPLY_BUTTON_SELECTOR);\n\t\tconst correctPagesParts = ['shipping', 'billing', 'Cart-SubmitForm'];\n\t\tconst { href } = window.location;\n\t\tconst correctPage = href.startsWith(CART_PAGE_URL) || correctPagesParts.some(urlPart => href.includes(urlPart));\n\t\tconst currentState = addCouponButton && !emptyCartElement && correctPage;\n\t\treturn currentState;\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn document.querySelector(this.CART_FORM_SELECTOR);\n\t}\n};\n\nexport default {\n\tname: 'Parker',\n\tdomain: 'parkerny.com',\n\tstackable: true,\n\tDriver,\n\tisSinglePageApp: true,\n\tisOnCartUrl: () => false,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { sessionTimer } from '../../lib';\nimport { log, DOM, format, sendXhr } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/* Behavior description:\n\t* Existing code: yes\n\t* Remove code: yes\n\t* Replace code:  no\n\t* Stackable:  no\n\t* Free gift:  no\n\t* Free shipping:  no\n\t* isValid implemented: yes\n\t* SessionTimer yes (15min)\n\t* Pages, where extension works: cart, billing\n\t* Is SPA: yes\n====Special cases====\n \t* Also if the user selected 'Pick Up In Store' we have two another pages where we can apply the code,\n\t* so in the first checkout step after the cart, we can apply code only after revisiting page.\n\t* Next step we can't support because we need to save user data.\n\n*/\n\nconst CART_PAGE_URL = 'https://www.partycity.com/cart';\nconst SHIPPING_PAGE_URL = 'https://www.partycity.com/shipping';\nconst BILLING_PAGE_URL = 'https://www.partycity.com/billing';\nconst isOnCart =\n\twindow.location.href.startsWith(CART_PAGE_URL) || window.location.href.toLowerCase().endsWith('/cart-submitform');\nconst isOnBilling = () =>\n\t!!document.querySelector('#dwfrm_billing') && !!document.querySelector('.billing-address-section.hide');\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode, .bill-coupn input';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.REMOVE_BUTTON_SELECTOR = '#remove-coupon';\n\t\tthis.TOTAL_SELECTOR = '.order-total span:last-child';\n\t\tthis.CART_EMPTY_SELECTOR = '.cart-empty';\n\t\tthis.CHECKOUT_FORM_SELECTOR = '#dwfrm_singleshipping_shippingAddress';\n\t\tthis.BILLING_SECTION_SELECTOR = '.billing-address-section';\n\t\tthis.HEADING_ELEM_SELECTOR = '.step-1.active';\n\t\tthis.APPLIED_CODES_SELECTOR = 'script[type=\"text/javascript\"]';\n\t\tthis.APPLIED_CODES_REGEX = /\"coupon_codes\":\\s+?\\[\\s+?\"(\\w+)\"/i;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping span:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.promo-shipping>span:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax span:last-child';\n\n\t\tthis.BASE_URL = 'https://www.partycity.com/on/demandware.store/Sites-partycity_us2-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${this.BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${this.BASE_URL}/Cart-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${this.BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'couponCode';\n\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\t\tthis.REMOVE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t\tthis.updateQueryParams.set('format', 'ajax');\n\n\t\tthis.isStackable = false;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\t\tconst billingSection = document.querySelector(this.BILLING_SECTION_SELECTOR);\n\t\tif (billingSection) {\n\t\t\tconst isBillingSectionFilled = billingSection.classList.contains('hide');\n\t\t\tif (!isBillingSectionFilled) {\n\t\t\t\tbus.$emit('cart-inactive');\n\t\t\t}\n\t\t}\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isRightUrl =\n\t\t\tisOnCart ||\n\t\t\thref.toLowerCase().startsWith(SHIPPING_PAGE_URL) ||\n\t\t\thref.toLowerCase().startsWith(BILLING_PAGE_URL) ||\n\t\t\thref.toLowerCase().endsWith('/cart-submitform');\n\t\tconst isCartEmpty = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\tconst isInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst activeStep = document.querySelector(this.HEADING_ELEM_SELECTOR);\n\t\tconst currentState = isRightUrl && !isCartEmpty && isInput && !activeStep;\n\t\treturn currentState;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.APPLIED_CODES_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(matched => matched[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\n\t\t\t\tconst successState = this._getValueFromJSON(applyCodeResponse);\n\n\t\t\t\tif (successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount(orderSummary) - originalItemsCount;\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\tbeforeApplyCodes() {\n\t\twindow.history.pushState(\n\t\t\twindow.history.state,\n\t\t\twindow.document.title,\n\t\t\tisOnBilling() ? BILLING_PAGE_URL : window.location.href,\n\t\t);\n\t\treturn Promise.resolve();\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shippingDiscountElem = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst shippingDiscountValue = shippingDiscountElem ? elemToFloat(shippingDiscountElem) : 0;\n\t\t\tconst shipping = extractElement(this.SHIPPING_SELECTOR, response);\n\t\t\tconst shippingValue = shipping ? elemToFloat(shipping) - shippingDiscountValue : 0;\n\t\t\tconst tax = extractElement(this.TAX_SELECTOR, response);\n\t\t\tconst taxValue = tax ? elemToFloat(tax) : 0;\n\t\t\treturn this.parseTotal(response) - shippingValue - taxValue;\n\t\t});\n\t}\n\n\t_isOnCartPage() {\n\t\treturn (\n\t\t\twindow.location.href.startsWith(this.CART_PAGE_URL) ||\n\t\t\twindow.location.href.toLowerCase().endsWith('/cart-submitform')\n\t\t);\n\t}\n\n\t_sendRequest(method, requestURL, headers, queryParams, bodyData) {\n\t\tconst finalRequestURL =\n\t\t\tqueryParams && queryParams.toString() ? `${requestURL}?${queryParams.toString()}` : requestURL;\n\n\t\treturn sendXhr(finalRequestURL, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\theaders,\n\t\t\tbody: bodyData,\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\t// Return JSON if it is possible\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Party City',\n\tdomain: 'partycity.com',\n\tDriver,\n\tcartContinueUrl: isOnCart ? CART_PAGE_URL : window.location.href,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport { log, request } from '../../../utils';\nimport bus from '../../bus';\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: no\n    Free gift support: yes\n    isValid implemented: yes\n    can run code testing only on Cart page\nOptional:\n    Show message about free shipping on the cart page (without discount info): no\n    Is driver SPA and add the condition to show popup: no\n    Gather codes on site pages: no */\n\nconst CART_PAGE_URL = 'https://www.paulaschoice.com/cart';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = false;\n\n\t\tthis.BASE_URL = 'https://www.paulaschoice.com/on/demandware.store/Sites-paulaschoice_us-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${this.BASE_URL}/Bag-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${this.BASE_URL}/Bag-RemoveCoupon`;\n\t\tthis.CODE_VALUE_SELECTOR = '.normal.uppercase';\n\t\tthis.UPDATE_REQUEST_URL =\n\t\t\t'https://www.paulaschoice.com/on/demandware.store/Sites-paulaschoice_us-Site/en_US/Bag-Get';\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.EMPTY_CART_SELECTOR = '.large3.normalcase';\n\n\t\tthis.REQUEST_HEADERS = {\n\t\t\tAccept: 'application/json, text/plain, */*',\n\t\t\t'Content-Type': 'application/json;charset=UTF-8',\n\t\t};\n\t}\n\n\tcheckCondition() {\n\t\tconst onCart = window.location.href.startsWith('https://www.paulaschoice.com/cart');\n\t\tconst emptyElem = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst cartEmpty = emptyElem && emptyElem.textContent.includes('no items');\n\t\treturn onCart && !cartEmpty;\n\t}\n\n\tasync beforeTestCodes() {\n\t\tconst responseJSON = await this.sendRequest(\n\t\t\t'https://www.paulaschoice.com/on/demandware.store/Sites-paulaschoice_us-Site/en_US/Customer-GetCSRFToken',\n\t\t\tJSON.stringify({}),\n\t\t);\n\t\tthis.csrfToken = responseJSON.data.csrfToken;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODE_VALUE_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(codeElement => codeElement.innerText);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this.removeCode(code));\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this._sendGETRequest().then(responseJSON => {\n\t\t\treturn {\n\t\t\t\toriginalPrice: this._parseTotal(responseJSON),\n\t\t\t\toriginalItemsCount: this._parseItemsCount(responseJSON),\n\t\t\t};\n\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice, originalItemsCount) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\t\tconst workingDiscounts = [];\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(responseJSON => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\t\t\t\tif (responseJSON.success === false) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\tresult.finalPrice = this._parseTotal(responseJSON);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.freeGifts = this._parseItemsCount(responseJSON) - originalItemsCount;\n\t\t\t\tif (result.finalDiscount > 0 || result.freeGifts > 0) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\n\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t\toriginalItemsCount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst { codes, discounts, originalPrice, originalItemsCount } = validationInfo;\n\n\t\tdiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentGifts = 0;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(response => {\n\t\t\t\tconst finalPrice = this._parseTotal(response);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst freeGifts = this._parseItemsCount(response) - originalItemsCount;\n\n\t\t\t\tbus.$emit('code-stacked', { code, finalPrice, finalDiscount, freeGifts });\n\t\t\t\tif (finalPrice < currentPrice || freeGifts > currentGifts) {\n\t\t\t\t\t// we can worsen the price with the code that gives the gift with less discount\n\t\t\t\t\tconst priceIncreased = finalPrice > currentPrice;\n\t\t\t\t\tif (!priceIncreased) {\n\t\t\t\t\t\tsuccessfulCodes.push(code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\tcurrentGifts = freeGifts;\n\t\t\t\t\t}\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(code);\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentGifts,\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._sendGETRequest().then(responseJSON => {\n\t\t\tconst taxValue = responseJSON.bag.tax ? responseJSON.bag.tax.value : 0;\n\t\t\tconst shippingValue = responseJSON.bag.shippingTotal ? responseJSON.bag.shippingTotal.value : 0;\n\t\t\tconst totalValue = this._parseTotal(responseJSON);\n\t\t\treturn totalValue - taxValue - shippingValue;\n\t\t});\n\t}\n\n\tapplyCode(code) {\n\t\treturn this._manageCode(code, this.APPLY_CODE_URL);\n\t}\n\n\tremoveCode(code) {\n\t\treturn this._manageCode(code, this.REMOVE_CODE_URL);\n\t}\n\n\t_manageCode(code, url) {\n\t\tconst bodyData = JSON.stringify({\n\t\t\tcouponCode: code,\n\t\t\tcsrfToken: this.csrfToken,\n\t\t});\n\t\treturn this.sendRequest(url, bodyData);\n\t}\n\n\t_sendGETRequest() {\n\t\treturn request.get('https://www.paulaschoice.com/cart?customer=true').then(response => response.json());\n\t}\n\n\tsendRequest(url, bodyData) {\n\t\treturn request\n\t\t\t.post(url, bodyData, {\n\t\t\t\theaders: this.REQUEST_HEADERS,\n\t\t\t\twithCredentials: false,\n\t\t\t})\n\t\t\t.then(response => response.json());\n\t}\n\n\t_parseItemsCount(json) {\n\t\tif (json.data) {\n\t\t\treturn json.data.items.length;\n\t\t}\n\t\treturn json.bag.items.length;\n\t}\n\n\t_parseTotal(json) {\n\t\tif (json.data) {\n\t\t\treturn json.data.amountDue.value;\n\t\t}\n\t\treturn json.bag.amountDue.value;\n\t}\n};\n\nexport default {\n\tname: 'Paulas Choice',\n\tdomain: 'paulaschoice.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tstackable: true,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions } from '../../../utils';\n\n/* Behavior description:\n\t- can get existing codes\n\t- can remove codes on cart page\n\t- cannot apply invalid code\n\t- can apply multiple codes (stackable)\n\n\t======== Special case ========\n\thave to reload checkout page to apply code, can't avoid loss of data\n*/\n\nconst CART_PAGE_URL = 'https://www.pendleton-usa.com/cart';\nconst BIILING_PAGE_URL = 'https://www.pendleton-usa.com/billing';\nconst ON_CART_PAGE = window.location.href.startsWith(CART_PAGE_URL);\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.pendleton-usa.com/on/demandware.store/Sites-PWM-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n};\n\nexport default {\n\tname: 'Pendleton',\n\tdomain: 'pendleton-usa.com',\n\tstackable: true,\n\tDriver,\n\tcartContinueUrl: !ON_CART_PAGE ? BIILING_PAGE_URL : false,\n\tcompletionAction: completionActions.revisit,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\tconst correctPages = ['billing', 'COShipping-SingleShipping', 'COBilling-Billing'];\n\t\treturn (\n\t\t\tON_CART_PAGE ||\n\t\t\t(correctPages.some(urlPart => href.includes(urlPart)) && document.querySelector('#dwfrm_billing'))\n\t\t);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions } from '../../../utils';\n\nconst CART_PAGE_URL = 'https://www.perriconemd.com/bag';\nconst CHECKOUT_PAGE_URL = 'https://www.perriconemd.com/shipping';\nconst CART_CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode';\nconst CHECKOUT_CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tconst BASE_URL = 'https://www.perriconemd.com/on/demandware.store/Sites-perriconemd-Site/default';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.isStackable = true;\n\n\t\t// Need to reapply codes because some codes might have different names\n\t\t// after they are applied, so codes retesting may fail\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.applied-coupons-tr';\n\t\tthis.CODE_VALUE_SELECTOR = '.applied-coupons-code';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.pt_cart .mini-cart-product, .checkout-mini-cart .mini-cart-product';\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn document.querySelector(this.CART_FORM_SELECTOR);\n\t}\n};\n\nexport default {\n\tname: 'Perricone MD',\n\tdomain: 'perriconemd.com',\n\tstackable: true,\n\tDriver,\n\tcompletionAction() {\n\t\treturn document.querySelector('#cart-items-form') ? completionActions.revisit : completionActions.default;\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\tdocument.querySelector(`${CHECKOUT_CODE_INPUT_SELECTOR}, ${CART_CODE_INPUT_SELECTOR}`) &&\n\t\t\t(href.startsWith(CART_PAGE_URL) || href.startsWith(CHECKOUT_PAGE_URL))\n\t\t);\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport { DOM } from '../../../utils';\n\nconst { extractElement } = DOM;\n\n/*\nDriver behavior description:\n+ Existing code: yes (also caught valid, but not working codes)\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+\n+ Pages, where extension works:\n\t- Cart page #1\n\t- Cart page #2\n\t- Checkout page\n\n+ Is driver SPA no\n+ Gather codes on site pages: no\n+ Special case about the driver works (if it needed).\n\t- Some codes can replace one another. After deleting the last applied code, the previous one may appear on the page.\n\t- Revisit cannot be used here because of reloading a wrong page.\n\n+ Credentials (for signing in)\n\t- bodyanets@gmail.com / Temporary_1\n*/\n\nconst BASE_URL = 'https://www.peterthomasroth.com';\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-PeterThomasRoth-Site/en_US`;\nconst CHECKOUT_URL = `${BASE_REQUEST_URL}/COShipping-SingleShipping`;\nconst CART_URL_1 = `${BASE_URL}/cart`;\nconst CART_URL_2 = `${BASE_REQUEST_URL}/Cart-SubmitForm`;\nconst WISH_LIST_URL = `${BASE_URL}/on/demandware.store/Sites-PeterThomasRoth-Site/en_US/Cart-AddToWishlist`;\n\nconst CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode, #dwfrm_billing_couponCode';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = CART_URL_1;\n\t\tthis.CART_PAGE_URL = CART_URL_1;\n\t\tthis.isOnCheckout = window.location.href.startsWith(CHECKOUT_URL);\n\n\t\tthis.APPLY_RESPONSE_KEY = 'status';\n\t\tthis.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE = 'APPLIED';\n\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-row';\n\t\tthis.TOTAL_SELECTOR = '.order-value';\n\n\t\tthis.CODE_VALUE_SELECTOR = '.cartcoupon .value';\n\t\tthis.APPLIED_CODE_REGEXP = /[\\w]+/;\n\t\tthis.CODES_ELEMENTS_SELECTOR = 'div.item-details';\n\t\tthis.REMOVE_CODE_SELECTOR = '.item-quantity button';\n\t\tthis.ERROR_MESSAGE_SELECTOR = '.error';\n\n\t\tthis.applyQueryParams = new URLSearchParams({\n\t\t\tformat: 'ajax',\n\t\t});\n\n\t\tthis.isStackable = true;\n\t\tthis.firstResponse = null;\n\t}\n\n\tbeforeTestCodes() {\n\t\treturn (this.isOnCheckout ? this.getOrderSummary() : Promise.resolve(null)).then(responseHTML => {\n\t\t\tthis.existingCodes = [];\n\t\t\tthis.firstResponse = responseHTML;\n\t\t\tconst currentCodes = this._getExistingCodes(responseHTML);\n\n\t\t\tif (currentCodes.length) {\n\t\t\t\treturn this._removeCodes(currentCodes);\n\t\t\t}\n\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\treturn {\n\t\t\tcodes: this.existingCodes,\n\t\t\tcodeCount: this.existingCodes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn {\n\t\t\toriginalPrice: this.parseTotal(this.firstResponse),\n\t\t\toriginalItemsCount: this.parseItemsCount(this.firstResponse),\n\t\t};\n\t}\n\n\t_getExistingCodes(data) {\n\t\tconst codes = [...extractElement(this.CODE_VALUE_SELECTOR, data, true)].map(\n\t\t\titem => item.textContent.match(this.APPLIED_CODE_REGEXP)[0],\n\t\t);\n\n\t\treturn codes;\n\t}\n\n\t_removeCodes(codes) {\n\t\treturn Promise.each(codes, code => this.removeCode(code))\n\t\t\t.then(() => this.getOrderSummary())\n\t\t\t.then(responseHTML => {\n\t\t\t\tthis.existingCodes = [...this.existingCodes, ...codes];\n\t\t\t\tconst currentCodes = this._getExistingCodes(responseHTML);\n\t\t\t\tif (!currentCodes.length) {\n\t\t\t\t\tthis.firstResponse = responseHTML;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\n\t\t\t\treturn this._removeCodes(currentCodes);\n\t\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n};\n\nexport default {\n\tname: 'PeterThomasRoth',\n\tdomain: 'peterthomasroth.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t(href.startsWith(CART_URL_1) ||\n\t\t\t\thref.startsWith(CART_URL_2) ||\n\t\t\t\thref.startsWith(CHECKOUT_URL) ||\n\t\t\t\thref.startsWith(WISH_LIST_URL)) &&\n\t\t\tdocument.querySelector(CODE_INPUT_SELECTOR)\n\t\t);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\n\n/* BEHAVIOUR\n+ Remove/apply code methods work with POST\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ Codes can be replaced by another code: no\n+ Is driver SPA: yes (Cart/Checkout)\n */\n\nconst BASE_URL = 'https://www.petsmart.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst CHECKOUT_PAGE_URL = `${BASE_URL}/cart-checkout`;\nconst BASE_REQUEST_URL = 'https://www.petsmart.com/on/demandware.store/Sites-PetSmart-Site/default';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.estimated-total .value, .mini-cart-subtotals .value, .order-total .order-value';\n\t\tthis.isStackable = true;\n\t\tthis.CODE_INPUT_SELECTOR = '.promocode, .cart-promo-code';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/CartController-ApplyPromo?instart_disable_injection=true`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/CartController-RemovePromo?instart_disable_injection=true`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/Cart-MiniCart`;\n\t\tthis.CART_DATA_URL = `${BASE_REQUEST_URL}/CartController-CartData?instart_disable_injection=true`;\n\t\tthis.updateQueryParams = new URLSearchParams({\n\t\t\tinstart_disable_injection: true,\n\t\t});\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'promocode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t'content-type': 'application/json;charset=UTF-8',\n\t\t};\n\t\tthis.REMOVE_REQUEST_HEADERS = {\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t'content-type': 'application/json;charset=UTF-8',\n\t\t};\n\n\t\tthis.UPDATE_REQUEST_HEADERS = {\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.EMPTY_CART_SELECTOR = '.mini-cart-empty';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isRightUrl = href.startsWith(CART_PAGE_URL) || href.startsWith(CHECKOUT_PAGE_URL);\n\t\tconst isEmptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\treturn isInput && !isEmptyCart && isRightUrl;\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getCartData().then(responseJSON => {\n\t\t\tconst codes = responseJSON.promoCodes.codes.map(el => el.promoCodeID);\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tapplyCode(code) {\n\t\tconst body = JSON.stringify({ promocode: code });\n\t\treturn this._sendRequestPOST(this.APPLY_CODE_URL, this.APPLY_REQUEST_HEADERS, null, body);\n\t}\n\n\tremoveCode(code) {\n\t\tconst body = JSON.stringify({ promocode: code });\n\t\treturn this._sendRequestPOST(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, null, body);\n\t}\n\n\t_getCartData() {\n\t\treturn fetch(this.CART_DATA_URL, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: this.APPLY_REQUEST_HEADERS,\n\t\t\tbody: JSON.stringify({ errorMessages: [] }),\n\t\t}).then(response => response.json());\n\t}\n};\n\nexport default {\n\tname: 'PetSmart',\n\tdomain: 'petsmart.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst { toFloat } = format;\nconst { extractElement } = DOM;\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: yes\n    Free gift support: no\n    isValid implemented: no\n    Manually apply code: no\n    Active pages: cart, checkout (payment -- only when checkbox is checked and review steps)\nOptional:\n    Show message about free shipping on the cart page: no\n    Is driver SPA and add the condition to show popup: yes\n    Gather codes on site pages: yes\n    Credentials: ypa@mail.com / Temporary_1 */\n\nconst BASE_URL = 'https://www.pier1.com/on/demandware.store/Sites-pier1_us-Site/default';\nconst CART_PAGE_URL = `${BASE_URL}/Checkout-Start`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CODE_VALUE_SELECTOR = '.coupon-code span';\n\t\tthis.TOTAL_SELECTOR = '.order-total .orderdetails-pricing';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/Checkout-Basket`;\n\t\tthis.CART_UPDATED_URL = `${BASE_URL}/Checkout-Start`;\n\n\t\tthis.PROPOSED_CODE_REGEX = /code\\s+(\\w+)/;\n\n\t\tthis.isStackable = true;\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.applyQueryParams.set('imgrole', 'productLine');\n\n\t\tthis.PAYMENT_CHECKBOX_SELECTOR = '#use-ship-box-in-page';\n\n\t\tthis.INPUT_CODES_SELECTOR = '[name=\"coupon_code\"]';\n\t\tthis.CART_EMPTY_SELECTOR = '.cart-empty';\n\t\tthis.PROPOSED_CODE_SELECTOR = '.checkout-banner-text-row strong, .checkout-fs-banner .message';\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\treturn [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...extractElement(this.PROPOSED_CODE_SELECTOR, responseHTML, true)]\n\t\t\t\t\t\t.map(el => el.textContent.match(this.PROPOSED_CODE_REGEX))\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.map(el => el[1]),\n\t\t\t\t),\n\t\t\t];\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst emptyCart = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\tconst promoField = document.querySelector(this.INPUT_CODES_SELECTOR);\n\t\tconst paymentCheckbox = document.querySelector(this.PAYMENT_CHECKBOX_SELECTOR);\n\t\tconst isCheckboxChecked = href.includes('/Checkout-Start#c_2')\n\t\t\t? paymentCheckbox && paymentCheckbox.checked\n\t\t\t: true;\n\t\tconst promoURL =\n\t\t\thref.startsWith(BASE_URL) &&\n\t\t\t(href.includes('/Checkout-Start#c_0') ||\n\t\t\t\thref.includes('/Checkout-Start#c_2') ||\n\t\t\t\thref.includes('/Checkout-Start#c_3'));\n\n\t\treturn !emptyCart && promoURL && promoField && isCheckboxChecked;\n\t}\n\n\tparseTotal(data) {\n\t\tif (data) {\n\t\t\treturn toFloat(data.order_total.value);\n\t\t}\n\t\treturn toFloat(document.querySelector(this.TOTAL_SELECTOR).innerText);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(responseJSON => {\n\t\t\tconst shipping = responseJSON.shipping_total.value;\n\t\t\tconst taxes = responseJSON.tax_total.value;\n\t\t\treturn this.parseTotal(responseJSON) - toFloat(taxes || 0) - toFloat(shipping || 0);\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn this._sendRequestGET(this.CART_UPDATED_URL, this.UPDATE_REQUEST_HEADERS);\n\t}\n};\n\nexport default {\n\tname: 'Pier1',\n\tdomain: 'pier1.com',\n\tDriver,\n\tstackable: true,\n\tisSinglePageApp: true,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement, extractFormValues } = DOM;\nconst { elemToFloat, toFloat } = format;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works:\n    - the cart page\n    - the checkout page (payment). user info is removed after code testing (default site behavior)\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n*/\n\nconst BASE_URL = 'https://www.rag-bone.com';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.IS_ON_CHECKOUT = window.location.href.includes('checkout');\n\t\tthis.API_URL = `${BASE_URL}/on/demandware.store/Sites-ragandbone-Site/en_US`;\n\t\tthis.APPLY_CODE_URL = `${this.API_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${this.API_URL}/Cart-DeleteCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = this.IS_ON_CHECKOUT ? `${BASE_URL}/checkout-billing` : `${BASE_URL}/cart`;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\n\t\tthis.TOTAL_SELECTOR = '.order-total td strong';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:last-child';\n\t\tthis.EXISTING_CODES_SELECTOR = '.promo-remove p strong, .coupon-redemption-message b';\n\t\tthis.CART_FORM_SELECTOR = 'form[name=dwfrm_cart]';\n\n\t\tthis.isStackable = true;\n\t\tthis.codesToApply = null;\n\t\tthis.formValues = null;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.formValues = extractFormValues(this.CART_FORM_SELECTOR);\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\n\t\tthis.cartHeaders = {\n\t\t\t'content-type': 'application/x-www-form-urlencoded',\n\t\t\t'sec-fetch-user': '?1',\n\t\t\t'upgrade-insecure-requests': '1',\n\t\t};\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.EXISTING_CODES_SELECTOR)]\n\t\t\t.filter(el => el.textContent && !el.textContent.match(/promo error/i))\n\t\t\t.map(el => el.textContent);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(responseHTML => {\n\t\t\tconst total = this.parseTotal(responseHTML);\n\t\t\tconst taxElement = extractElement(this.TAX_SELECTOR, responseHTML);\n\t\t\tconst shippingElement = extractElement(this.SHIPPING_SELECTOR, responseHTML);\n\t\t\tconst shippingDiscountElement = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, responseHTML);\n\t\t\tconst shippingDiscount = shippingDiscountElement ? elemToFloat(shippingDiscountElement) : 0;\n\t\t\tconst tax = taxElement && !taxElement.textContent.includes('N/A') ? taxElement.textContent : 0;\n\t\t\tconst shipping =\n\t\t\t\tshippingElement && !shippingElement.textContent.includes('N/A') ? shippingElement.textContent : 0;\n\t\t\treturn toFloat(total) - toFloat(tax) - toFloat(shipping) + shippingDiscount;\n\t\t});\n\t}\n\n\tapplyCode(code) {\n\t\tif (this.IS_ON_CHECKOUT) {\n\t\t\treturn this._applyCodeOnCheckout(code);\n\t\t}\n\t\treturn this._applyCodeOnCart(code);\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.IS_ON_CHECKOUT ? this._removeCodeOnCheckout(code) : this._removeCodeOnCart(code);\n\t}\n\n\t_removeCodeOnCart() {\n\t\tthis.formValues.params.set('dwfrm_cart_couponCode', '');\n\t\tthis.formValues.params.set('dwfrm_cart_coupons_i0_deleteCoupon', 'Remove');\n\t\tthis.formValues.params.delete('dwfrm_cart_addCoupon');\n\t\treturn this._sendFetch(this.formValues.action, this.formValues.params);\n\t}\n\n\t_removeCodeOnCheckout(code) {\n\t\tif (this.REMOVE_CODE_PARAM_NAME) {\n\t\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\t}\n\n\t\treturn this._sendRequestGET(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n\n\t_applyCodeOnCart(code) {\n\t\tthis.formValues.params.set('dwfrm_cart_couponCode', code);\n\t\tthis.formValues.params.set('dwfrm_cart_addCoupon', 'dwfrm_cart_addCoupon');\n\t\tthis.formValues.params.delete('dwfrm_cart_coupons_i0_deleteCoupon');\n\t\treturn this._sendFetch(this.formValues.action, this.formValues.params);\n\t}\n\n\t_sendFetch(url, body) {\n\t\treturn fetch(url, {\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.cartHeaders,\n\t\t\tbody,\n\t\t\tmethod: 'POST',\n\t\t}).then(res => res.text());\n\t}\n\n\t_applyCodeOnCheckout(code) {\n\t\tthis.applyQueryParams.set(this.APPLY_CODE_PARAM_NAME, code);\n\n\t\treturn this._sendRequestGET(this.APPLY_CODE_URL, this.APPLY_REQUEST_HEADERS, this.applyQueryParams);\n\t}\n\n\tparseTotal(data = false) {\n\t\tif (typeof data === 'string' || data === false) {\n\t\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, data));\n\t\t}\n\t\treturn data.baskettotal;\n\t}\n};\n\nexport default {\n\tname: 'rag & bone',\n\tdomain: 'rag-bone.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith(BASE_URL) &&\n\t\t\t(document.querySelector('input[name=dwfrm_cart_couponCode]') ||\n\t\t\t\tdocument.querySelector('#dwfrm_billing_couponCode'))\n\t\t);\n\t},\n\tshowDifferentDiscountMessage: true,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/* Behavior description:\n * - can get existing codes\n * - can remove codes\n * - cannot apply invalid code\n *\n * =============== Special case ============\n * cannot support pages of payment and review steps due to loss of users data\n */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.APPLIED_CODE_SELECTOR = '#success-coupon-code strong';\n\n\t\tthis.CART_PAGE_URL = 'https://www.ralphlauren.com/cart';\n\t\tthis.SHIPPING_VALUE_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:last-child';\n\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.ralphlauren.com/on/demandware.store/Sites-RalphLauren_US-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-DeleteCouponCode`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'couponcode';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODE_SELECTOR)].map(elem => elem.innerText.trim());\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\t// Tax is present at the end of checkout page\n\t\treturn this.getCartPage().then(responseHTML => {\n\t\t\tconst shippingValue = elemToFloat(extractElement(this.SHIPPING_VALUE_SELECTOR, responseHTML));\n\t\t\tconst isShippingValue = Number.isNaN(shippingValue) ? 0 : shippingValue;\n\t\t\tconst shippingDiscountElem = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, responseHTML);\n\t\t\tconst shippingDiscount = shippingDiscountElem ? elemToFloat(shippingDiscountElem) : 0;\n\t\t\tconst isShippingDiscount = Number.isNaN(shippingDiscount) ? 0 : shippingDiscount;\n\t\t\tconst totalValue = this.parseTotal(responseHTML);\n\t\t\treturn totalValue - isShippingValue + isShippingDiscount;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Ralph Lauren',\n\tdomain: 'ralphlauren.com',\n\tstackable: true,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\tdocument.querySelector('#coupon-code-accordion') &&\n\t\t\t(href.startsWith('https://www.ralphlauren.com/cart') ||\n\t\t\t\thref.startsWith('https://www.ralphlauren.com/checkoutshipping') ||\n\t\t\t\thref.startsWith('https://www.ralphlauren.com/billing') ||\n\t\t\t\thref.startsWith('https://www.ralphlauren.com/revieworder') ||\n\t\t\t\thref.includes('COBilling-Billing'))\n\t\t);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions } from '../../../utils';\n\n/**\n Driver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ isValid implemented: yes \n+ Pages, where extension works:\n * cart\n * billing\n * checkout\n * shipping\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n+ Special case about the driver works (if it needed).\n * maxCoupons (25, site is very fast)\n * we can avoid cart page\n */\n\nconst BASE_URL = 'https://www.rebeccataylor.com';\nconst CART_PAGE_URL = `${BASE_URL}/bag`;\nconst isOnCartPage = () =>\n\twindow.location.href.startsWith(CART_PAGE_URL) && document.querySelector('#dwfrm_cart_couponCode');\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value';\n\t\tthis.PRODUCT_ITEM_SELECTOR = isOnCartPage() ? '.mini-cart-product' : '.checkout-mini-cart .mini-cart-product';\n\t\tthis.CART_ELEMENT_SELECTOR = '.cart-actions-title';\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode, #dwfrm_cart_couponCode';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.SUCCESS_MESSAGE_SELECTOR = '.coupon .success, .coupon-sucess';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_REQUEST_URL = 'https://www.rebeccataylor.com/on/demandware.store/Sites-rebeccataylor-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isOnHref =\n\t\t\thref.startsWith(this.CART_PAGE_URL) ||\n\t\t\thref.startsWith(`${BASE_URL}/shipping`) ||\n\t\t\thref.startsWith(`${BASE_URL}/billing`) ||\n\t\t\thref.startsWith(`${BASE_URL}/checkout`);\n\t\tconst currentState = isInput && isOnHref;\n\t\treturn currentState;\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn (\n\t\t\twindow.location.href.startsWith(this.CART_PAGE_URL) && document.querySelector(this.CART_ELEMENT_SELECTOR)\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Rebecca Taylor',\n\tdomain: 'rebeccataylor.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tmaxCoupons: 25,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { completionActions, DOM, log } from '../../../utils';\n\nconst { extractElementFromHTML } = DOM;\n\nconst CART_PAGE_URL = 'https://www.redcross.org/take-a-class/cart';\n\n/* Behavior description\n * We can apply not only one code(i guess)\n * We can get existing code\n * We can remove code\n * We can apply code on cart page\n * We can't save user data on checkout page so that we not support that page\n */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon, .coupon-promo';\n\t\tthis.UUID_SELECTOR = '.removeCoupon, [id*=\"remove-coupon-\"]';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.redcross.org/on/demandware.store/Sites-RedCross-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-RemoveCouponJson`;\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t\tthis.APPLIED_CODE_REGEX = /code\\s(.+)\\sapplied/i;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(element => element.innerText.trim().match(this.APPLIED_CODE_REGEX)[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\tthis.UU_ID = document.querySelector(this.UUID_SELECTOR).dataset.uuid;\n\t\treturn Promise.each(codes, code => this.removeCode(code, this.UU_ID))\n\t\t\t.then(() => this.getOrderSummary())\n\t\t\t.then(response => this.parseTotal(response));\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(responseText => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t};\n\n\t\t\t\tif (extractElementFromHTML(responseText, this.UUID_SELECTOR)) {\n\t\t\t\t\tthis.UU_ID = extractElementFromHTML(responseText, this.UUID_SELECTOR).dataset.uuid;\n\n\t\t\t\t\treturn this.getOrderSummary().then(response => {\n\t\t\t\t\t\tresult.finalPrice = this.parseTotal(response);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tif (result.finalPrice < originalPrice) {\n\t\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this.removeCode(code, this.UU_ID).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.isStackable) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tremoveCode(code, uuId) {\n\t\tthis.removeQueryParams.set('uuid', uuId);\n\n\t\treturn this._sendRequestGET(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n};\n\nexport default {\n\tname: 'RedCross',\n\tdomain: 'redcross.org',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tstackable: true,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t(href.startsWith(CART_PAGE_URL) || href.endsWith('Cart-SubmitForm')) &&\n\t\t\tdocument.querySelector('#dwfrm_cart_couponCode')\n\t\t);\n\t},\n};\n","import Promise from 'bluebird';\nimport DWBaseDriver from '../demandware/_base';\nimport bus from '../../bus';\nimport { sessionTimer } from '../../lib';\nimport { DOM, completionActions, browserUtils } from '../../../utils';\n\nconst { wait } = browserUtils;\n\nconst { extractElement } = DOM;\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: yes\n========Special case=========\n+ Don't support Checkout because can get out sign in on checkout page\n+ Driver works as stackable, but can apply only two codes with discount\n+ other codes will be applied but without discount\n*/\n\nconst BASE_URL = 'https://www.roamans.com';\nconst CART_URL = `${BASE_URL}/cart`;\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-fbbrands-Site/default`;\nconst ANOTHER_CART_URL = `${BASE_REQUEST_URL}/Cart-SubmitForm`;\n\nconst Driver = class Driver extends DWBaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_EMPTY_SELECTOR = '.mini-cart-empty';\n\t\tthis.CART_COUPON_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.MERCHANT_CODE_SELECTOR = '.oc-content-row[data-coupon] .oc-coupon-code';\n\t\tthis.MERCHANT_CODE_IMG = 'map[id*=\"monetate_selectorBanner\"] area[alt]';\n\t\tthis.MERCHANT_CODE_REGEX = /code:?\\s(\\w*)/i;\n\t\tthis.isStackable = false;\n\t}\n\n\twatchForCartUrl() {\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: super.watchForCartUrl(),\n\t\t\ttimeout: 20,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst windowLocation = window.location.href.toLowerCase();\n\n\t\tconst isWishList = windowLocation.includes('cart-addtowishlist');\n\t\t// For checkout and shipping pages we need have billing section,\n\t\t// on the cart page we can omit it\n\t\tconst isCartEmpty = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\tconst isCart =\n\t\t\t(windowLocation.includes(CART_URL) ||\n\t\t\t\tisWishList ||\n\t\t\t\twindowLocation.includes(ANOTHER_CART_URL.toLowerCase())) &&\n\t\t\tdocument.querySelector(this.CART_COUPON_SELECTOR);\n\t\treturn isCart && !isCartEmpty;\n\t}\n\n\tasync getMerchantCodes() {\n\t\tconst iframeElem = document.createElement('iframe');\n\t\tiframeElem.src = CART_URL;\n\t\tObject.assign(iframeElem.style, { display: 'none' });\n\t\tdocument.documentElement.appendChild(iframeElem);\n\t\tconst getCodeElem = () => {\n\t\t\treturn !!(\n\t\t\t\t[...iframeElem.contentDocument.querySelectorAll(this.MERCHANT_CODE_IMG)].length > 0 &&\n\t\t\t\t[...iframeElem.contentDocument.querySelectorAll(this.MERCHANT_CODE_SELECTOR)].length > 0\n\t\t\t);\n\t\t};\n\t\tawait wait(getCodeElem, 20000, 300, true);\n\t\tif (getCodeElem()) {\n\t\t\treturn [\n\t\t\t\t...new Set([\n\t\t\t\t\t...[...iframeElem.contentDocument.querySelectorAll(this.MERCHANT_CODE_SELECTOR)]\n\t\t\t\t\t\t.map(el => (el.innerText.trim().toLowerCase() === 'no code needed' ? '' : el.innerText.trim()))\n\t\t\t\t\t\t.filter(Boolean),\n\t\t\t\t\t...[...iframeElem.contentDocument.querySelectorAll(this.MERCHANT_CODE_IMG)]\n\t\t\t\t\t\t.map(el => el.alt.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.map(match => match[1]),\n\t\t\t\t]),\n\t\t\t];\n\t\t}\n\t\treturn [];\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst { discounts, originalPrice } = validationInfo;\n\n\t\t// Sort by discount\n\t\tdiscounts.sort((a, b) => b.finalDiscount - a.finalDiscount);\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(discounts, discount =>\n\t\t\tthis.applyCode(discount.code, this._requestData()).then(html => {\n\t\t\t\tthis.lastResponse = html;\n\t\t\t\tconst finalPrice = this.parseTotal(html);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t});\n\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(this._removeValueName(discount.code), this._requestData()).then(\n\t\t\t\t\tremoveCodeResponse => {\n\t\t\t\t\t\tthis.lastResponse = removeCodeResponse;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t}),\n\t\t);\n\t}\n\n\t_removeValueName(code) {\n\t\tconst codesElements = extractElement(this.CODES_ELEMENTS_SELECTOR, this.lastResponse, true);\n\t\tconst matchingCodesElement = [...codesElements].find(element => {\n\t\t\tconst codesElement = element.querySelector(this.CODE_VALUE_SELECTOR);\n\t\t\treturn codesElement && codesElement.innerText.trim().toLowerCase() === code.toLowerCase();\n\t\t});\n\n\t\treturn matchingCodesElement\n\t\t\t? matchingCodesElement.querySelector(this.REMOVE_CODE_SELECTOR).name\n\t\t\t: this.DEFAULT_REMOVE_CODE_VALUE;\n\t}\n};\n\nexport default {\n\tname: \"Roaman's\",\n\tdomain: 'roamans.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tcompletionAction: completionActions.revisit,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { sessionTimer } from '../../lib';\nimport { DOM, format, sendXhr } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/* Behavior description:\nExisting code: yes\nRemove code: yes\nStackable: yes\nFree gift support: no\nFree shipping: no\n'isValid' implemented: no\nCodes can be replaced by another code: no\nManually apply code: no\nIs driver SPA and add the condition to show popup: yes\n     - is on cart url or is on checkout(payment)\n     - is total element\nPages, where extension works: `Cart` and `Checkout(payment, review)`\nGather codes on site pages: yes\nsessionTimer: 20min\nSpecial case about the driver works:\nOn bag page we need to calculate the total price with tax to get correct discount (because the discount applies to the tax)\nCredentials (joq@gmail.com, 12345qwerty)\nwe cannot implement code testing at all steps of the checkout due to data loss (we cannot correctly apply)\n*/\n\nconst CART_PAGE_URL = 'https://www.rockport.com/cart';\nconst BASE_URL = 'https://www.rockport.com/on/demandware.store/Sites-RockportUS-Site/default';\nconst CART_FORM_SELECTOR = '#cart-items-form';\nconst isCartPage = () => window.location.href.startsWith(CART_PAGE_URL) && document.querySelector(CART_FORM_SELECTOR);\n\nconst isOnBillingPage = document.querySelector('.billing-coupon-code') || !document.querySelector('#cart-items-form');\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = isCartPage() ? '.cart-right .order-value' : '.order-totals-table .order-value';\n\t\tthis.SUB_TOTAL =\n\t\t\t'.cart-order-totals .order-subtotal td:last-child, .place-order-totals .order-subtotal td:last-child';\n\t\tthis.isStackable = true;\n\t\tthis.APPLY_REQUEST_HEADERS = this.BILLING_COUPON_SELECTOR\n\t\t\t? { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' }\n\t\t\t: '';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = isOnBillingPage\n\t\t\t? `${BASE_URL}/COSummary-Start?onepageentry=true&format=ajax`\n\t\t\t: CART_PAGE_URL;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.MERCHANT_CODES_SELECTOR = '.promo-link .promo-text';\n\t\tthis.MERCHANT_CODES_REGEX = /code\\s(\\w+)/i;\n\n\t\tthis.INPUT_SELECTOR = '.cart-coupon-code #dwfrm_billing_couponCode';\n\t\tthis.APPLY_BUTTON_SELECTOR = '.cart-coupon-code #add-coupon';\n\n\t\tthis.CHECKOUT_PAGE_SELECTOR = '.pt_onepage_checkout';\n\t\tthis.CART_PAGE_SELECTOR = '#cart-items-form';\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\n\t\tthis.CODES_REGEXP = /couponcode':\\s\"(\\w+)/gi;\n\t\tthis.ACTIVE_BILLING = '.onepage-billing:not(.disabled)';\n\n\t\tsessionTimer.initialize({ timeout: 20 });\n\t}\n\n\tcheckCondition() {\n\t\tconst isCart = document.querySelector(this.CART_PAGE_SELECTOR);\n\t\tconst isCheckout = document.querySelector(this.CHECKOUT_PAGE_SELECTOR);\n\t\tconst totalElem = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst isTotal = totalElem && this.parseTotal();\n\t\tconst isPayment = isCheckout && document.querySelector(this.ACTIVE_BILLING);\n\t\treturn (isCart || isPayment) && isTotal;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn (this._isOnCartPage() ? Promise.resolve(null) : this.getCartPage()).then(responseHTML => {\n\t\t\tthis.lastResponse = responseHTML;\n\t\t\treturn [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...extractElement(this.MERCHANT_CODES_SELECTOR, responseHTML, true)]\n\t\t\t\t\t\t.map(elem => elem.innerText.match(this.MERCHANT_CODES_REGEX))\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.map(code => code[1]),\n\t\t\t\t),\n\t\t\t];\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\treturn (this.lastResponse ? Promise.resolve(this.lastResponse) : this.getCartPage()).then(res => {\n\t\t\tconst codes = [...new Set([...res.matchAll(this.CODES_REGEXP)].map(code => code[1]))];\n\t\t\treturn {\n\t\t\t\tcodes,\n\t\t\t\tcodeCount: codes.length,\n\t\t\t};\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\treturn elemToFloat(extractElement(this.SUB_TOTAL, response));\n\t\t});\n\t}\n\n\t_isOnCartPage() {\n\t\treturn isCartPage();\n\t}\n\n\t_sendRequest(method, requestURL, headers, queryParams, bodyData) {\n\t\tconst finalRequestURL =\n\t\t\tqueryParams && queryParams.toString() ? `${requestURL}?${queryParams.toString()}` : requestURL;\n\t\treturn sendXhr(finalRequestURL, {\n\t\t\tmethod,\n\t\t\tcredentials: 'include',\n\t\t\theaders,\n\t\t\tbody: bodyData,\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Rockport',\n\tdomain: 'rockport.com',\n\tstackable: true,\n\tmaxCoupons: 10,\n\tDriver,\n\tcartContinueUrl: isOnBillingPage ? `${BASE_URL}/COCustomer-Start` : CART_PAGE_URL,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { sessionTimer, handleDriverError } from '../../lib';\n\nimport { DOM, log, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat, toFloat } = format;\n\n/* Driver behavior:\n Existing code: yes\n Remove code: yes\n Stackable: yes\n Free gift support: no\n isValid implemented: yes\n Show message about free shipping: no\n Driver is SPA: yes, on cart and checkout payment step\n Gather merchant codes: yes\n Can run code testing on Cart and Checkout */\n\nconst BASE_URL = 'https://www.sallybeauty.com';\nconst CART_URL = `${BASE_URL}/cart/`;\nconst IS_CART_EMPTY_REGEX = /cart is empty/i;\nconst IS_CART_EMPTY_SELECTOR = '.container.cart-page, .cart-empty';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.grand-total, .grand-total-sum';\n\t\tthis.CODE_INPUT_SELECTOR = '.cart-promo-code';\n\n\t\tthis.CART_PAGE_URL = CART_URL;\n\n\t\tthis.PROMO_SELECTOR = '.carousel-item strong:nth-child(2)';\n\t\tthis.APPLIED_CODES_SELECTOR = '.coupon-code__wrapper p';\n\t\tthis.APPLIED_CODE_REGEX = /Applied Code (\\w+)/;\n\t\tthis.CSRF_TOKEN_SELECTOR = '.promo-code-form1 [name=\"csrf_token\"]';\n\n\t\tconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-SA-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/Cart-RemoveCouponLineItem`;\n\n\t\tthis.CODE_ELEM_SELECTOR = '.coupon-price-adjustment';\n\t\tthis.REMOVE_VALUE_SELECTOR = '.remove-coupon';\n\t\tthis.REMOVE_VALUE_ATTRIBUTE = 'data-uuid';\n\n\t\tthis.TAX_VALUE_SELECTOR = '.tax-total';\n\t\tthis.SHIPPING_VALUE_SELECTOR = this._isOnCartPage() ? '.shipping-cost' : '.shipping-total-cost';\n\t\tthis.SHIPPING_DISCOUNT_VALUE_SELECTOR = '.shipping-discount-total';\n\n\t\tsessionTimer.initialize();\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnRightURL = href.startsWith(CART_URL) || href.includes('Checkout-Begin');\n\t\tconst isCartEmpty = [...document.querySelectorAll(IS_CART_EMPTY_SELECTOR)].some(item =>\n\t\t\tIS_CART_EMPTY_REGEX.test(item.textContent),\n\t\t);\n\t\tconst isCodeInput = (document.querySelector(this.CODE_INPUT_SELECTOR) || {}).offsetParent;\n\n\t\treturn !isCartEmpty && isOnRightURL && isCodeInput;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.CSRF_TOKEN = document.querySelector(this.CSRF_TOKEN_SELECTOR).value;\n\n\t\tthis.removeQueryParams = new URLSearchParams();\n\t\tthis.applyQueryParams = new URLSearchParams({\n\t\t\tloyaltyreward: 'false',\n\t\t});\n\n\t\tthis.lastResponse = null;\n\t\treturn Promise.resolve();\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getUpdatedPage(CART_URL).then(response =>\n\t\t\t[...extractElement(this.PROMO_SELECTOR, response, true)].map(el => el.textContent).filter(Boolean),\n\t\t);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = this._getExistingCodes();\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\t_getExistingCodes(html) {\n\t\treturn [...extractElement(this.APPLIED_CODES_SELECTOR, html, true)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(codeElement => codeElement.innerText.match(this.APPLIED_CODE_REGEX)[1]);\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.removeCode(code, this._removeValue(code)).then(response => {\n\t\t\t\tthis.lastResponse = response;\n\t\t\t\treturn Promise.resolve();\n\t\t\t}),\n\t\t);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(this.lastResponse)) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code => {\n\t\t\treturn this.applyCode(code).then(responseJSON => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\t\t\t\tif (responseJSON.error === true) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tthis.lastResponse = responseJSON;\n\t\t\t\tresult.finalPrice = this.parseTotal(responseJSON);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tif (result.finalPrice < originalPrice) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(code, this._removeValue(code)).then(removeCoderesponse => {\n\t\t\t\t\tthis.lastResponse = removeCoderesponse;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(() =>\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t}),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst { discounts, originalPrice } = validationInfo;\n\t\tdiscounts.sort((a, b) => b.finalDiscount - a.finalDiscount);\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(discounts, discount => {\n\t\t\treturn this.applyCode(discount.code).then(responseJSON => {\n\t\t\t\tthis.lastResponse = responseJSON;\n\t\t\t\tconst finalPrice = this.parseTotal(responseJSON);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t});\n\n\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\n\t\t\t\treturn this.removeCode(discount.code, this._removeValue(discount.code)).then(removeCodeResponse => {\n\t\t\t\t\tthis.lastResponse = removeCodeResponse;\n\t\t\t\t\tconst currentCodes = this._getUpdatedPage(window.location.href).then(response =>\n\t\t\t\t\t\tthis._getExistingCodes(response),\n\t\t\t\t\t);\n\n\t\t\t\t\tconst isCodesEqual =\n\t\t\t\t\t\tcurrentCodes.length === successfulCodes.length &&\n\t\t\t\t\t\tcurrentCodes.every(code => successfulCodes.includes(code));\n\n\t\t\t\t\tif (isCodesEqual) {\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.each(currentCodes, code => this.removeCode(code, this._removeValue(code))).then(\n\t\t\t\t\t\tremoveResponse => {\n\t\t\t\t\t\t\tthis.lastResponse = removeResponse;\n\t\t\t\t\t\t\treturn Promise.each(successfulCodes, code => this.applyCode(code));\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\t// Tax and shipping are included on cart and checkout pages\n\t\treturn this._getUpdatedPage(window.location.href).then(responseHTML => {\n\t\t\tconst taxValue = elemToFloat(extractElement(this.TAX_VALUE_SELECTOR, responseHTML));\n\t\t\tconst shippingElem = extractElement(this.SHIPPING_VALUE_SELECTOR, responseHTML);\n\t\t\tconst shippingValue = shippingElem ? elemToFloat(shippingElem) : 0;\n\t\t\tconst shippingDiscountElem = extractElement(this.SHIPPING_DISCOUNT_VALUE_SELECTOR, responseHTML);\n\t\t\tconst shippingDiscount = shippingDiscountElem ? elemToFloat(shippingDiscountElem) : 0;\n\t\t\tconst totalValue = elemToFloat(extractElement(this.TOTAL_SELECTOR, responseHTML));\n\t\t\treturn totalValue - taxValue - shippingValue + shippingDiscount;\n\t\t});\n\t}\n\n\tapplyCode(code) {\n\t\tthis.applyQueryParams.set('couponCode', code);\n\t\tthis.applyQueryParams.set('csrf_token', this.CSRF_TOKEN);\n\t\treturn this.manageCode(this.APPLY_CODE_URL, this.applyQueryParams);\n\t}\n\n\tremoveCode(code, removeValueName) {\n\t\tthis.removeQueryParams.set('code', code);\n\t\tthis.removeQueryParams.set('uuid', removeValueName);\n\t\treturn this.manageCode(this.REMOVE_CODE_URL, this.removeQueryParams);\n\t}\n\n\tmanageCode(url, queryParams) {\n\t\treturn fetch(`${url}?${queryParams.toString()}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.json());\n\t}\n\n\t_removeValue(code) {\n\t\tlet removeValueUuid = null;\n\n\t\tif (this.lastResponse) {\n\t\t\tif (!this.lastResponse.totals) {\n\t\t\t\thandleDriverError(new Error('Response is incorrect.', { code, response: this.lastResponse }));\n\t\t\t\treturn removeValueUuid;\n\t\t\t}\n\t\t\tremoveValueUuid = extractElement(\n\t\t\t\tthis.CODE_ELEM_SELECTOR,\n\t\t\t\tthis.lastResponse.totals.discountsHtml,\n\t\t\t).getAttribute(this.REMOVE_VALUE_ATTRIBUTE);\n\t\t} else {\n\t\t\tconst codesElements = [...document.querySelectorAll(this.CODE_ELEM_SELECTOR)];\n\t\t\tconst matchingCodesElement = codesElements.find(element => {\n\t\t\t\tconst codesElement = element.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\t\t\treturn codesElement && codesElement.innerText.match(this.APPLIED_CODE_REGEX)[1] === code;\n\t\t\t});\n\t\t\tif (matchingCodesElement) {\n\t\t\t\tremoveValueUuid = matchingCodesElement\n\t\t\t\t\t.querySelector(this.REMOVE_VALUE_SELECTOR)\n\t\t\t\t\t.getAttribute(this.REMOVE_VALUE_ATTRIBUTE);\n\t\t\t}\n\t\t}\n\t\treturn removeValueUuid;\n\t}\n\n\t_getUpdatedPage(url) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\tparseTotal(json) {\n\t\treturn json && json.totals\n\t\t\t? toFloat(json.totals.grandTotal)\n\t\t\t: elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'Sally Beauty',\n\tdomain: 'sallybeauty.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { format, DOM, completionActions } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst BASE_SITE_URL = 'https://shop.samsonite.com';\nconst CART_PAGE_URL = `${BASE_SITE_URL}/cart`;\nconst { href } = window.location;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Don't support checkout due to strange site behaviour\n+ Is driver SPA: no\n+ Gather codes on site pages: yes, from Cart header\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.APPLIED_CODES_SELECTOR = '.promoCodes .code';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.TOTAL_SELECTOR = '.order-total .summary-value, .order-total td:last-child';\n\n\t\tthis.TABLE_TOTALS_SELECTOR = '.order-totals .nomarginrow';\n\t\tthis.PRICE_VALUE_SELECTOR = '.summary-value';\n\n\t\tthis.PROPOSED_CODES_SELECTOR = '.header-top-banner .textbold b:nth-child(2)';\n\t\tthis.CART_FORM_SELECTOR = '#promo-area form';\n\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = `${BASE_SITE_URL}/on/demandware.store/Sites-samsonite-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.CODE_VALUE_SELECTOR = '.promoCodes .code';\n\n\t\tthis.TAX_SELECTOR = '.order-sales-tax .order-totals-value-text';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping .order-totals-value-text';\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst code = document.querySelector(this.PROPOSED_CODES_SELECTOR);\n\t\treturn (code ? [...code.textContent.split('&')] : [null]).filter(Boolean).map(el => el.trim());\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(this._findElement('Shipping', response)) || 0;\n\t\t\tconst taxEl = this._findElement('Tax', response);\n\t\t\tconst tax = taxEl ? elemToFloat(taxEl) || 0 : 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\t_findElement(targetString, response) {\n\t\tconst targetEl = [...extractElement(this.TABLE_TOTALS_SELECTOR, response, true)].find(\n\t\t\tel => el.textContent.includes(targetString) && !el.textContent.includes('Total'),\n\t\t);\n\n\t\treturn targetEl ? targetEl.querySelector(this.PRICE_VALUE_SELECTOR) : null;\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn window.location.href.startsWith(this.CART_PAGE_URL) && document.querySelector(this.CODE_INPUT_SELECTOR);\n\t}\n};\n\nexport default {\n\tname: 'Samsonite',\n\tdomain: 'shop.samsonite.com',\n\tcompletionAction: completionActions.revisit,\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn (\n\t\t\t(href.startsWith(CART_PAGE_URL) || href.includes('/Cart-AddToWishlist')) &&\n\t\t\tdocument.querySelector('#dwfrm_cart_couponCode')\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn (document.querySelector('.empty-msg') || {}).offsetParent;\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { toFloat, elemToFloat } from '../../../utils/format';\n\n/**\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Pages, where extension works: cart\n+ Is driver SPA yes (total and url) \n+ Gather codes on site pages: no\n+ Special case about the driver works (if it needed).\nsometimes we dont have the total on the page, in this case we take the price from the subtotal\n*/\n\n// need this because url can be different\nconst BASE_SITE_URL = window.location.href.split('Cart-AjaxCartView')[0];\nconst CART_PAGE_URL = `${BASE_SITE_URL}Cart-AjaxCartView`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.amount.order-total';\n\t\tthis.SUBTOTAL_SELECTOR = '.totalPrice';\n\t\tthis.APPLIED_CODES_SELECTOR = '#RemovePromoCodeButton';\n\t\tthis.isStackable = false;\n\n\t\tconst BASE_URL = BASE_SITE_URL;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}Cart-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}Cart-CartSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tcheckCondition() {\n\t\tconst isOnHref = window.location.href.startsWith(CART_PAGE_URL);\n\t\tconst isTotal = document.querySelector(`${this.TOTAL_SELECTOR}, ${this.SUBTOTAL_SELECTOR}`);\n\t\treturn isOnHref && isTotal;\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst total = document.querySelector(this.TOTAL_SELECTOR);\n\t\tthis.TOTAL_SELECTOR = total ? this.TOTAL_SELECTOR : this.SUBTOTAL_SELECTOR;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(elem => elem.dataset && elem.dataset.couponid)\n\t\t\t.filter(Boolean);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(responseJSON => {\n\t\t\tconst { orderTax, shippingCharges, shippingDiscount } = responseJSON;\n\t\t\tconst tax = toFloat(orderTax) || 0;\n\t\t\tconst shipping = toFloat(shippingCharges) || 0;\n\t\t\tconst shippingDisc = toFloat(shippingDiscount) || 0;\n\t\t\treturn this.parseTotal(responseJSON) - tax - shipping + shippingDisc;\n\t\t});\n\t}\n\n\tparseTotal(data) {\n\t\tif (data) {\n\t\t\treturn toFloat(data.totalOrderPrice);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'Scholastic Store',\n\tdomain: 'shop.scholastic.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import DemandwareAJAXDriver from './_base';\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - can apply multiple codes (stackable)\n * - isValid - yes\n *\n * ======== Special case ========\n * have to reload checkout page to apply code, can't avoid loss of data\n * apply codes only on Cart and wish list page\n * */\n\nconst CART_PAGE_URL = 'https://www.slumberland.com/cart';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.slumberland.com/on/demandware.store/Sites-slumberland-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n};\n\nexport default {\n\tname: 'Slumberland Furniture',\n\tdomain: 'slumberland.com',\n\tstackable: true,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith(CART_PAGE_URL) ||\n\t\t\thref.startsWith(\n\t\t\t\t'https://www.slumberland.com/on/demandware.store/Sites-slumberland-Site/default/Cart-AddToWishlist',\n\t\t\t)\n\t\t);\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport { completionActions, log } from '../../../utils';\nimport bus from '../../bus';\n\nconst US_CA = window.location.href.includes('/en-ca/') ? 'en-ca' : 'en-us';\nconst CART_URL = `https://www.sonos.com/${US_CA}/cart`;\n\n// Driver behavior description:\n//  Existing code: yes\n//  Remove code: yes\n//  Stackable: yes\n//  Free gift support: yes\n//  isValid implemented: yes\n//  Manually apply code: no\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = true;\n\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-item';\n\n\t\tthis.US_CA = US_CA === 'en-ca' ? 'Sites-Sonos_CA-Site/en_CA' : 'Sites-Sonos_US-Site/en_US';\n\t\tconst BASE_URL = `https://www.sonos.com/on/demandware.store/${this.US_CA}/`;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}RapidCheckout-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}COBilling-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = CART_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'couponCode';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t};\n\n\t\t\t\tconst successState = this._getValueFromJSON(applyCodeResponse);\n\n\t\t\t\tif (\n\t\t\t\t\t(successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) ||\n\t\t\t\t\tapplyCodeResponse.message.includes('cannot currently be added')\n\t\t\t\t) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\t// need remove not valid codes\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount(orderSummary) - originalItemsCount;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.isStackable) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t\toriginalItemsCount,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.REMOVE_CODE_SELECTOR)].map(el => el.dataset.couponCode);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: 'Sonos',\n\tdomain: 'sonos.com',\n\tstackable: true,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.includes(`/cart`) &&\n\t\t\t(window.location.href.includes('/en-ca/') || window.location.href.includes('/en-us/'))\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n\tshowDifferentDiscountMessage: true,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions } from '../../../utils';\n\nconst CART_PAGE_URL = 'https://www.southmoonunder.com/view-cart';\nconst CHECKOUT_URL_CONDITIONS = ['shipping', 'checkout'];\nconst TOTAL_SELECTOR = '.cartTotals.cartTotalsLast .cartSubTotal.cartVal, .ordertotal .value';\n\nconst onCart = () => window.location.href.toLowerCase().startsWith(CART_PAGE_URL);\nconst onCheckout = () => CHECKOUT_URL_CONDITIONS.some(urlPart => window.location.href.toLowerCase().includes(urlPart));\n\n/*\nDriver behavior:\n   Existing code: yes\n   Remove code: yes\n   Code retesting: yes\n   Stackable: yes\n   Free gift support: no\n   isValid implemented: no\n   Show message about free shipping: no\n   Driver is SPA: no\n   Gather merchant codes: no\n   Special case: driver work on cart & checkout\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = TOTAL_SELECTOR;\n\t\tthis.APPLIED_CODES_SELECTOR = '.coupon .value';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.southmoonunder.com/on/demandware.store/Sites-SMU-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/COBilling-ApplyCoupon`;\n\t\tthis.REMOVE_CODE_URL = 'https://www.southmoonunder.com/view-cart';\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.CART_FORM_SELECTOR = '#dwfrm_cart';\n\t\tthis.APPLIED_COUPONS_SELECTOR = '.coupon .value';\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.coupon';\n\t\tthis.CODE_VALUE_SELECTOR = '.coupon .value';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('dwfrm_cart_coupons_i0_deleteCoupon', 'Remove');\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_COUPONS_SELECTOR)].map(element =>\n\t\t\telement.textContent.trim(),\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeCheckCodes() {\n\t\t// total doesn't always update on the page\n\t\treturn this._sendRequestGET(window.location.href).then(responseTxt => this.parseTotal(responseTxt));\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n};\n\nexport default {\n\tname: 'South Moon Under',\n\tdomain: 'southmoonunder.com',\n\tstackable: true,\n\tcompletionAction: completionActions.revisit, // avoid alert on cart\n\tDriver,\n\tisCartEmpty() {\n\t\treturn !!document.querySelector('.emptycart');\n\t},\n\tisOnCartUrl() {\n\t\treturn (onCart() || onCheckout()) && [...document.querySelectorAll(TOTAL_SELECTOR)].some(el => el.offsetParent);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions } from '../../../utils';\n\n// Driver behavior description:\n// -    Existing code: yes\n// -    Remove code: yes\n// -    Stackable: yes\n// -    Free gift support: no\n// -    isValid implemented: yes\n// Optional:\n// -    Is driver SPA and add the condition to show popup: no\n// - \trun code testing on the cart, wish list page and checkout-billing(user will be redirected to the previous step, data will be erased)\n\nconst BASE_URL = 'https://www.speckproducts.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout`;\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-speck-Site/default`;\nconst SHIPPING_URL = `${BASE_REQUEST_URL}/COShipping-Start`;\nconst CART_WISHLIST_URL = `${BASE_REQUEST_URL}/Cart-AddToWishlist`;\nconst isOnCartPage = () =>\n\t(window.location.href.startsWith(CART_PAGE_URL) || window.location.href.startsWith(CART_WISHLIST_URL)) &&\n\tdocument.querySelector('#dwfrm_cart_couponCode');\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = true;\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t\tthis.SUCCESS_MESSAGE_SELECTOR = '.coupon .success, .coupon-sucess';\n\t\tthis.MERCHANT_CODES_SELECTOR = '.coupon';\n\n\t\tthis.TOTAL_SELECTOR = document.querySelector('.cart-logo')\n\t\t\t? '.order-subtotal td'\n\t\t\t: '.order-total td:last-child';\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [\n\t\t\t...new Set(\n\t\t\t\t[...document.querySelectorAll(this.MERCHANT_CODES_SELECTOR)]\n\t\t\t\t\t.map(codeElement => codeElement.textContent.trim())\n\t\t\t\t\t.filter(el => !!el && el.match(/^\\S+$/gm)),\n\t\t\t),\n\t\t];\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn isOnCartPage();\n\t}\n};\n\nexport default {\n\tname: 'Speck',\n\tdomain: 'speckproducts.com',\n\tstackable: true,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t(href.startsWith(CART_PAGE_URL) ||\n\t\t\t\thref.startsWith(CHECKOUT_URL) ||\n\t\t\t\thref.startsWith(SHIPPING_URL) ||\n\t\t\t\thref.startsWith(CART_WISHLIST_URL)) &&\n\t\t\tdocument.querySelector('#dwfrm_cart_couponCode, #dwfrm_billing_couponCode')\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.mini-cart-empty'));\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\n\n/** Behavior description:\n * - can get existing codes\n * - can remove codes\n * - valid code can't be replaced with another valid or invalid code\n * - can't apply multiple codes (isn't stackable)\n * */\n\nconst BASE_URL = 'https://www.store.crossfit.com/on/demandware.store/Sites-Reebok-CF-Site/en_CY';\nconst CART_PAGE_URL = `${BASE_URL}/Cart-Show`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.ordertotal.bg .summary_value';\n\t\tthis.APPLIED_CODES_SELECTOR = '[name=\"dwfrm_cart_coupons_i0_deleteCoupon\"]';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-Submits`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/Cart-Show`;\n\t\tthis.REMOVE_CODE_URL = this.APPLY_CODE_URL;\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.isStackable = false;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'dwfrm_cart_coupons_i0_deleteCoupon';\n\t\tthis.APPLY_CODE_PARAM_NAME = 'dwfrm_cart_couponCode';\n\t\tthis.applyQueryParams.set('dwfrm_cart_addCoupon', 'Apply');\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(codeElement =>\n\t\t\tcodeElement.value.replace('Remove', '').trim(),\n\t\t);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCode(code) {\n\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, `Remove ${code}`);\n\t\treturn this._sendRequestGET(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, this.removeQueryParams);\n\t}\n};\n\nexport default {\n\tname: 'CrossFit Store',\n\tdomain: 'store.crossfit.com',\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t(href.startsWith(BASE_URL) && href.includes('CODelivery-Start')) ||\n\t\t\thref.includes('COSummary2-Start') ||\n\t\t\thref.includes('COPayment-HostedPaymentContinue') ||\n\t\t\thref.includes('Cart-Show')\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\tconst TITLE_ELEMENT = document.querySelector('.checkout-title');\n\t\treturn TITLE_ELEMENT ? TITLE_ELEMENT.innerText.includes('IS EMPTY') : false;\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { log } from '../../../utils';\nimport { extractElement } from '../../../utils/DOM';\n\n/* Driver behavior description:\n   + Existing code: yes\n   + Remove code: yes\n   + Stackable: yes\n   + Free gift support: yes\n   + isValid implemented: yes\n   + Gather codes on site pages: yes(cart page)\n   + Free shipping: no\n   + is SPA: yes\n*/\n\nconst BASE_URL = 'https://www.surfstitch.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst CHECKOUT_BILLING_URL = `${BASE_URL}/checkout-billing`;\nconst CHECKOUT_BILLING_BACK_URL = `${BASE_URL}/checkout-billing-back`;\nconst BASE_REQUEST_URL = 'https://www.surfstitch.com/on/demandware.store/Sites-ss-au-Site/en_AU';\n\nconst IS_CART = window.location.href.includes('/cart');\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value, .ss-order-summary__total .ss-order-summary__total__amount';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\t\tthis.isStackable = true;\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-row, .product';\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = CART_PAGE_URL;\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\t\tthis.MERCHANT_CODE_SELECTOR = '.header-promotion__coupon';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnRightUrl =\n\t\t\thref.startsWith(CART_PAGE_URL) ||\n\t\t\thref.startsWith(CHECKOUT_BILLING_URL) ||\n\t\t\thref.startsWith(CHECKOUT_BILLING_BACK_URL);\n\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\treturn isOnRightUrl && !isCartEmpty && isTotal;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this.getCartPage().then(resHtml => {\n\t\t\treturn extractElement(this.MERCHANT_CODE_SELECTOR, resHtml)\n\t\t\t\t? [extractElement(this.MERCHANT_CODE_SELECTOR, resHtml).textContent]\n\t\t\t\t: [];\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(response => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t};\n\n\t\t\t\tconst successState = this._getValueFromJSON(response);\n\n\t\t\t\tif (successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(cartResponse => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(cartResponse);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount(cartResponse) - originalItemsCount;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tif (this.isStackable) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t\toriginalItemsCount,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'SurfStitch',\n\tdomain: 'surfstitch.com',\n\tstackable: true,\n\tmaxCoupons: 10,\n\tisSinglePageApp: true,\n\tcartContinueUrl: IS_CART ? CART_PAGE_URL : window.location.href,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { DOM, completionActions, log } from '../../../utils';\nimport { sessionTimer, backgroundMessaging } from '../../lib';\nimport { extractData } from '../../../utils/DOM';\nimport { toFloat } from '../../../utils/format';\n\nconst { extractElement } = DOM;\n\n/** Driver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: yes\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works:\n    - Cart\n+ Is driver SPA: yes\n    - is on Cart page and there are promocode input field(or delete code button) and total price\n\t- cart isn't empty\n+ Gather codes on site pages: yes\n+ Special case about the driver works (if it needed).\n    - maxCoupons: 10 - site blocks us\n\t- sessionTimer yes (20min)\n\t- doesn't allow retesting, because site blocks us\n+ Credentials (joseph@gmail.com, 12345qwerty)\n*/\n\nconst DOMAIN = 'surlatable.com';\nconst BASE_URL = 'https://www.surlatable.com';\nconst CART_URL = `${BASE_URL}/cart/shoppingCart.jsp`;\n\nconst isOnCart = () => window.location.href.startsWith(CART_URL);\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.CART_TOTAL_SELECTOR = '.orderSumTotalPrice';\n\t\tthis.APPLIED_CODES_SELECTOR = '#couponCodeToBeRemove_0';\n\t\tthis.DYN_SESS_CONF_SELECTOR = 'input[name=\"_dynSessConf\"]';\n\t\tthis.DYNCHARSET_SELECTOR = 'input[name=\"_dyncharset\"]';\n\n\t\tthis.TOTAL_SELECTOR = this.CART_TOTAL_SELECTOR;\n\n\t\tthis.MANAGE_CODE_URL = 'https://www.surlatable.com/checkout/opc/singlePageSignIn.jsp';\n\t\tthis.APPLY_CODE_URL = this.MANAGE_CODE_URL;\n\t\tthis.REMOVE_CODE_URL = this.MANAGE_CODE_URL;\n\t\tthis.UPDATE_REQUEST_URL = CART_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = '/atg/commerce/promotion/CouponFormHandler.couponClaimCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = '/atg/commerce/order/ShoppingCartModifier.couponCodeToBeRemove';\n\n\t\tthis.REMOVE_CODE_BUTTON_SELECTOR = '.remove, #removeCoupon';\n\t\tthis.INPUT_CODE_SELECTOR = '#couponCode';\n\t\tthis.CODE_DESCRIPTION_SELECTOR = '#helpBlockPromo, #promocodespay';\n\t\tthis.EMPTY_CART_SELECTOR = '.ppError + div';\n\t\tthis.ERROR_MSG_SELECTOR = '.Zebra_Tooltip';\n\t\tthis.FREE_SHIPPING_REGEX = /free shipping/g;\n\t\tthis.EMPTY_CART_REGEX = /cart is empty/g;\n\n\t\tthis.DISABLE_TIME_MS = 20 * 60 * 1000; // 20 minutes\n\t\tthis.MERCHANT_CODES_SELECTOR = '#freeship-banner-evergreen span';\n\t\tthis.FEE_SELECTOR = '.orderSumHandlingPrice';\n\t\tthis.SHIPPING_SELECTOR = '.orderSumShipPrice';\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.MERCHANT_CODES_SELECTOR)].map(elem => elem.innerText).filter(Boolean);\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 20,\n\t\t});\n\t}\n\n\tasync checkCondition() {\n\t\tlet isDisabledCodeTesting = false;\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(DOMAIN);\n\t\tif (driverStorage) {\n\t\t\tisDisabledCodeTesting = Date.now() - driverStorage.lastTestTimestamp < this.DISABLE_TIME_MS;\n\t\t}\n\n\t\tconst isCodeInputElement = document.querySelector(this.INPUT_CODE_SELECTOR);\n\t\tconst isRemoveCodeElement = document.querySelector(this.REMOVE_CODE_BUTTON_SELECTOR);\n\t\tconst totalElement = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst emptyCartElement = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isEmptyCart = emptyCartElement\n\t\t\t? emptyCartElement.textContent.toLowerCase().match(this.EMPTY_CART_REGEX)\n\t\t\t: false;\n\t\tconst currentState =\n\t\t\tisOnCart() &&\n\t\t\ttotalElement &&\n\t\t\t(!isDisabledCodeTesting && !isEmptyCart && (isCodeInputElement || isRemoveCodeElement));\n\t\treturn currentState;\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst dynSessConfElement = document.querySelector(this.DYN_SESS_CONF_SELECTOR);\n\t\tconst dynSessConf = dynSessConfElement ? dynSessConfElement.value : null;\n\n\t\tconst dyncharsetElement = document.querySelector(this.DYNCHARSET_SELECTOR);\n\t\tconst dyncharset = dyncharsetElement ? dyncharsetElement.value : 'UTF-8';\n\n\t\tthis.applyQueryParams.set('from', 'applyPromotion');\n\t\tthis.applyQueryParams.set('_dyncharset', dyncharset);\n\t\tthis.applyQueryParams.set('_dynSessConf', dynSessConf);\n\t\tthis.applyQueryParams.set('_D:/atg/commerce/promotion/CouponFormHandler.couponClaimCode', '');\n\t\tthis.applyQueryParams.set('_DARGS', '/checkout/opc/includes/promoSum.jsp.paymentAddPromoCodeForm');\n\n\t\tthis.removeQueryParams.set('from', 'removePromotion');\n\t\tthis.removeQueryParams.set('_dyncharset', dyncharset);\n\t\tthis.removeQueryParams.set('_dynSessConf', dynSessConf);\n\t\tthis.removeQueryParams.set('_D:/atg/commerce/order/ShoppingCartModifier.couponCodeToBeRemove', '');\n\t\tthis.removeQueryParams.set('_DARGS', '/checkout/opc/includes/promoSum.jsp.paymentFormPromoCodesId_0');\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(codeElement => codeElement.value);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this.removeCode(codes[0])\n\t\t\t.then(() => this.getOrderSummary())\n\t\t\t.then(response => this.parseTotal(response));\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t\tfreeShipping: false,\n\t\t\t};\n\t\t\treturn this.applyCode(code)\n\t\t\t\t.then(() => this.getOrderSummary())\n\t\t\t\t.then(response => {\n\t\t\t\t\tif (this._isCodeInvalid(response)) {\n\t\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t}\n\t\t\t\t\tresult.finalPrice = this.parseTotal(response);\n\t\t\t\t\tresult.freeShipping = this._checkFreeShipping(response);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t});\n\t}\n\n\tbeforeApplyCodes() {\n\t\tbackgroundMessaging.setDriverStorage(DOMAIN, {\n\t\t\tlastTestTimestamp: Date.now(),\n\t\t});\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartHTML = await this.getOrderSummary();\n\t\tconst total = this.parseTotal(cartHTML);\n\t\tconst shipping = extractElement(this.SHIPPING_SELECTOR, cartHTML)\n\t\t\t? extractData(this.SHIPPING_SELECTOR, cartHTML).trim()\n\t\t\t: 0;\n\t\tconst fee = extractElement(this.FEE_SELECTOR, cartHTML) ? extractData(this.FEE_SELECTOR, cartHTML).trim() : 0;\n\n\t\treturn total - (shipping.toLowerCase() !== 'free' ? toFloat(shipping) : 0) - toFloat(fee);\n\t}\n\n\t_isCodeInvalid(response) {\n\t\tconst inputElement = extractElement(this.INPUT_CODE_SELECTOR, response);\n\t\tconst isInputElement = inputElement && inputElement.type !== 'hidden';\n\t\tconst errorElement = extractElement(this.ERROR_MSG_SELECTOR, response);\n\t\tconst isErorrElement = errorElement\n\t\t\t? [...extractElement(this.ERROR_MSG_SELECTOR, response, true)].some(el => el.style.display === 'block')\n\t\t\t: false;\n\t\treturn !response || isInputElement || isErorrElement;\n\t}\n\n\t_checkFreeShipping(response) {\n\t\treturn Boolean(\n\t\t\textractElement(this.CODE_DESCRIPTION_SELECTOR, response)\n\t\t\t\t.textContent.toLowerCase()\n\t\t\t\t.match(this.FREE_SHIPPING_REGEX),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Sur la Table',\n\tdomain: 'surlatable.com',\n\tDriver,\n\tmaxCoupons: 10, // due to site blocks us\n\tisSinglePageApp: true,\n\tcartContinueUrl: CART_URL, // after removing code manually on Cart URL address is changed so need to change URL\n\tcompletionAction: completionActions.default,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, format, completionActions } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst BASE_SITE_URL = 'https://www.talbots.com';\nconst CART_PAGE_URL = `${BASE_SITE_URL}/cart`;\nconst ITEM_SELECTOR = '.cart-row, .mini-summary-products .mini-cart-product';\nconst isBilling = window.location.href.startsWith(`${BASE_SITE_URL}/billing`);\n\n/**\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ isValid implemented: yes \n+ Codes can be replaced by another code: no\n+ Pages, where extension works:\n   - cart\n   - billing\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n+ Special case about the driver works.\nOn the checkout page we will be redirected on the shipping page after codes testing \n */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '';\n\t\tthis.PRODUCT_ITEM_SELECTOR = ITEM_SELECTOR;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-tax td:last-child, .order-sales-tax td:last-child';\n\n\t\tthis.MERCHANT_CODES_SELECTOR = '.promo-bar-header span';\n\t\tthis.MERCHANT_CODES_REGEXP = /code:\\s(\\w+)/i;\n\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.talbots.com/on/demandware.store/Sites-talbotsus-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn (isBilling ? this.getCartPage() : Promise.resolve(null)).then(responseHTML => {\n\t\t\tconst codes = [...extractElement(this.MERCHANT_CODES_SELECTOR, responseHTML, true)]\n\t\t\t\t.map(elem => elem.innerText.match(this.MERCHANT_CODES_REGEXP))\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(elem => elem[1]);\n\t\t\treturn [...new Set(codes)];\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(responseHTML => {\n\t\t\tconst total = this.parseTotal(responseHTML);\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, responseHTML)) || 0;\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, responseHTML)) || 0;\n\t\t\treturn total - tax - shipping;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Talbots',\n\tdomain: 'talbots.com',\n\tstackable: true,\n\tDriver,\n\tcartContinueUrl: isBilling ? `${BASE_SITE_URL}/shipping` : window.location.href,\n\tcompletionAction: completionActions.revisit,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.mini-cart-empty'));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn (href.startsWith(CART_PAGE_URL) || isBilling) && document.querySelector(ITEM_SELECTOR);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport completionActions from '../../../utils/completion-actions';\n\nimport { format, DOM } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: yes\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works:\n\t- Cart page\n+ Is driver SPA yes\n+ Gather codes on site pages: yes (https://tartecosmetics.com), cart page\n+ SessionTimer: 15min\nCredentials: ypa@mail.com / Temporary_1\n*/\n\nconst DOMAIN_URL = 'https://tartecosmetics.com';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-row';\n\t\tthis.CART_PAGE_URL = `${DOMAIN_URL}/en_US/bag`;\n\n\t\tthis.CODE_VALUE_SELECTOR = '.cartcoupon .value, .coupon .success';\n\t\tthis.CART_FORM_SELECTOR = '.cart-items-form';\n\n\t\tconst BASE_URL = `${DOMAIN_URL}/on/demandware.store/Sites-tarte-Site/en_US`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\n\t\t// On cart page shipping and tax is not included, need to get updated total from cart\n\t\tthis.UPDATE_REQUEST_URL = this.CART_PAGE_URL;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.CHARGES_REGEX = /(shipping|handling|tax)/i;\n\t\tthis.CHARGES_SELECTOR = '.order-totals-table td:last-child';\n\n\t\tthis.BANNER_SELECTOR = 'a[data-click=\"hyperlink\"]';\n\t\tthis.SUBSCRIBED_USER_CODE_SELECTOR = '.coupon';\n\t\tthis.MERCHANT_CODE_SELECTOR = '.code-text';\n\t\tthis.MERCHANT_CODE_REGEX = /code. (\\w+)/i;\n\t\tsessionTimer.initialize();\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnRightPage = href.startsWith(this.CART_PAGE_URL);\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\n\t\treturn isOnRightPage && codeInput;\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tasync getMerchantCodes() {\n\t\tconst subscribedUserCodeElement = document.querySelector(this.SUBSCRIBED_USER_CODE_SELECTOR);\n\t\tconst subscribedUserCode = subscribedUserCodeElement ? [subscribedUserCodeElement.textContent] : [];\n\n\t\tconst cartCodes = [...document.querySelectorAll(this.BANNER_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\n\t\tconst mainPage = await fetch(DOMAIN_URL, { method: 'GET' });\n\t\tconst mainPageHtml = await mainPage.text();\n\t\tconst mainPageCodes = extractElement(this.MERCHANT_CODE_SELECTOR, mainPageHtml, true)\n\t\t\t? [...extractElement(this.MERCHANT_CODE_SELECTOR, mainPageHtml, true)]\n\t\t\t\t\t.map(item => item.textContent.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(item => item[1])\n\t\t\t\t\t.filter(Boolean)\n\t\t\t: [];\n\n\t\treturn [...new Set([...cartCodes, ...mainPageCodes, ...subscribedUserCode])];\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await fetch(this.UPDATE_REQUEST_URL, { credentials: 'include' }).then(response =>\n\t\t\tresponse.text(),\n\t\t);\n\t\tconst total = elemToFloat(extractElement(this.TOTAL_SELECTOR, cartStr));\n\t\tconst taxes = [...extractElement(this.CHARGES_SELECTOR, cartStr, true)]\n\t\t\t.filter(el => el.parentElement.textContent.match(this.CHARGES_REGEX))\n\t\t\t.map(elemToFloat)\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((charges, charge) => charges + charge, 0);\n\t\treturn total - taxes;\n\t}\n};\n\nexport default {\n\tname: 'Tarte Cosmetics',\n\tdomain: 'tartecosmetics.com',\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions } from '../../../utils';\nimport bus from '../../bus';\n\nconst DEFAULT_URL = 'https://www.taylormadegolf.com';\nconst CART_PAGE_URL = `${DEFAULT_URL}/cart/`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .value, .order-total .order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = `${DEFAULT_URL}/on/demandware.store/Sites-TMaG-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.CART_INPUT_FIELD_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.CHECKOUT_INPUT_FIELD_SELECTOR = '#dwfrm_billing_couponCode';\n\t\tthis.EMPTY_CART_SELECTOR = '.mini-cart-product, .minicart-quantity';\n\t\tthis.MODAL_SELECTOR = '#checkout-login-modal';\n\t}\n\n\twatchForCartUrl() {\n\t\tlet previousState = false;\n\t\tsetInterval(() => {\n\t\t\tconst checkoutURL =\n\t\t\t\t(window.location.href.startsWith(`${DEFAULT_URL}/checkout`) ||\n\t\t\t\t\twindow.location.href.startsWith(`${DEFAULT_URL}/shipping`) ||\n\t\t\t\t\twindow.location.href.includes('COBilling-Start')) &&\n\t\t\t\tdocument.querySelector(this.CHECKOUT_INPUT_FIELD_SELECTOR);\n\t\t\tconst emptyCart = !document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\t\tconst modalPopup = document.querySelector(this.MODAL_SELECTOR)\n\t\t\t\t? document.querySelector(this.MODAL_SELECTOR).classList.contains('tinymodal-window-open')\n\t\t\t\t: false;\n\n\t\t\tconst currentState = (this._isOnCartPage() || checkoutURL) && !emptyCart && !modalPopup;\n\t\t\tif (currentState !== previousState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tpreviousState = currentState;\n\t\t}, 500);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [];\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn (\n\t\t\twindow.location.href.startsWith(this.CART_PAGE_URL) &&\n\t\t\tdocument.querySelector(this.CART_INPUT_FIELD_SELECTOR)\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'TaylorMade Golf',\n\tdomain: 'taylormadegolf.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { completionActions, format, DOM, log } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement, setValue } = DOM;\n\nconst CART_PAGE_URL = 'https://www.teva.com/cart';\nconst isOnCart = () => window.location.href.includes(CART_PAGE_URL) && document.querySelector('#cart-table');\n\n/*\nBehavior description:\n- can get existing codes;\n- can remove codes;\n- valid code can't be replaced with another valid or invalid code;\n- can apply multiple codes (stackable);\n- code testing may be run on 'Cart' and 'Checkout' pages;\n======== Special case ========\nto remove the codes we need an additional request that receives the codes 'uuid' and in request of remove we will use this uuid\non checkout page we need to apply and to remove by click\nI think that the site can give us gift items, but we can not test it now, because there is no such code\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR =\n\t\t\t'.cart__checkout__wrapper .order-total td:last-child, .table-totals tr:last-child td:last-child';\n\t\tthis.APPLIED_CODES_SELECTOR = '.coupon-code .value';\n\t\tthis.CODE_INPUT_SELECTOR = '#spc-coupon-code';\n\t\tthis.CODE_REMOVE_BTN_SELECTOR = '.coupon__alert button';\n\t\tthis.CODE_APPLY_BTN_SELECTOR = '[value=\"Apply Coupon\"]';\n\t\tthis.SUCCESS_MESSAGE_SELECTOR = '.coupon__status';\n\t\tthis.ACTIVE_SELECTOR = '#cart-table, #spc-panel-billing.is-active';\n\n\t\tconst BASE_URL = 'https://www.teva.com/on/demandware.store/Sites-TEVA-US-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/COBilling-ApplyCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/SPC-UpdateCartSummary`;\n\t\tthis.CODE_INFO_URL = `${BASE_URL}/SPC-GetCouponsInBasket?spc=true&instart_disable_injection=true`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.applyQueryParams = new URLSearchParams({\n\t\t\tformat: 'ajax',\n\t\t\tspc: true,\n\t\t\tinstart_disable_injection: true,\n\t\t});\n\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t\tthis.itemNumber = null;\n\t}\n\n\twatchForCartUrl() {\n\t\tlet previousState = false;\n\t\tsetInterval(() => {\n\t\t\tconst isOnHref = window.location.href.startsWith(CART_PAGE_URL);\n\t\t\tconst isSelector = Boolean(document.querySelector(this.ACTIVE_SELECTOR));\n\t\t\tconst currentState = isOnHref && isSelector;\n\t\t\tif (currentState !== previousState) {\n\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t}\n\t\t\tpreviousState = currentState;\n\t\t}, 500);\n\t}\n\n\tremoveCodes() {\n\t\treturn Promise.resolve()\n\t\t\t.then(() => (this._isOnCartPage() ? this._getCodesInfo() : this._removeCodesManually()))\n\t\t\t.then(responseARRAY =>\n\t\t\t\tthis._isOnCartPage() ? Promise.each(responseARRAY, code => this.removeCode(code)) : responseARRAY,\n\t\t\t)\n\t\t\t.then(() => this.getOrderSummary())\n\t\t\t.then(responseJSON => ({\n\t\t\t\toriginalPrice: this.parseTotal(responseJSON),\n\t\t\t\toriginalItemsCount: this.parseItemsCount(responseJSON),\n\t\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\t\t\t\tresult.isValid = !applyCodeResponse.couponStatus;\n\n\t\t\t\tif (!result.isValid) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount(orderSummary) - originalItemsCount;\n\t\t\t\t\tresult.isValid = true;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\t\t\t\t\treturn this._getCodesInfo()\n\t\t\t\t\t\t.then(responseARRAY => this.removeCode(responseARRAY[0]))\n\t\t\t\t\t\t.then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t\toriginalItemsCount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst { discounts, originalPrice, originalItemsCount } = validationInfo;\n\n\t\tdiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(discounts, discount =>\n\t\t\tthis.applyCode(discount.code)\n\t\t\t\t.then(() => this.getOrderSummary())\n\t\t\t\t.then(responseJSON => {\n\t\t\t\t\tconst finalPrice = this.parseTotal(responseJSON);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst freeGifts = this.parseItemsCount(responseJSON) - originalItemsCount;\n\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\tfreeGifts,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (finalPrice < currentPrice || (finalPrice === currentPrice && freeGifts > currentFreeGifts)) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this._getCodesInfo()\n\t\t\t\t\t\t.then(responseARRAY => this.removeCode(responseARRAY[0]))\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tif (this.REAPPLY_CODES_WHILE_STACKING) {\n\t\t\t\t\t\t\t\treturn Promise.each(successfulCodes, code => this.applyCode(code));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn !this._isOnCartPage() ? this._applyCodesManually(codes) : Promise.resolve();\n\t}\n\n\t_applyCodesManually(codes) {\n\t\treturn this.removeCode(codes[0]).then(() => {\n\t\t\tsetValue(document.querySelector(this.CODE_INPUT_SELECTOR), codes[0]);\n\t\t\tdocument.querySelector(this.CODE_APPLY_BTN_SELECTOR).click();\n\t\t\tconst message = document.querySelector(this.SUCCESS_MESSAGE_SELECTOR);\n\t\t\tif (message) {\n\t\t\t\tmessage.remove();\n\t\t\t}\n\t\t});\n\t}\n\n\t_removeCodesManually() {\n\t\t[...document.querySelectorAll(this.CODE_REMOVE_BTN_SELECTOR)].forEach(buttonElem => buttonElem.click());\n\t\treturn Promise.resolve();\n\t}\n\n\tparseTotal(data) {\n\t\tif (data) {\n\t\t\treturn toFloat(data.total);\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR));\n\t}\n\n\t_isOnCartPage() {\n\t\treturn isOnCart();\n\t}\n\n\t_getCodesInfo() {\n\t\treturn this._sendRequestGET(this.CODE_INFO_URL).then(responseJSON => responseJSON.map(element => element.uuid));\n\t}\n};\n\nexport default {\n\tname: 'Teva',\n\tdomain: 'teva.com',\n\tcompletionAction: () => (isOnCart() ? completionActions.revisit : completionActions.none),\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport completionActions from '../../../utils/completion-actions';\nimport bus from '../../bus';\nimport { sessionTimer } from '../../lib';\n\nconst BASE_URL = 'tillys.com';\nconst DOMAIN = `https://www.${BASE_URL}`;\n\n/** Behaviour description:\n Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: yes\n    Free gift support:  no\n    isValid implemented: no\n    Manually apply code: no\n * */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.remove-coupon';\n\t\tthis.isStackable = true;\n\n\t\tconst REQUEST_URL = 'https://www.tillys.com/on/demandware.store/Sites-tillys-Site/default';\n\t\tthis.APPLY_CODE_URL = `${REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${REQUEST_URL}/COBilling-RemoveCouponCode`;\n\t\tthis.UPDATE_REQUEST_URL = `${REQUEST_URL}/COBilling-UpdateSummary?checkoutStep=3`;\n\t\tthis.CART_PAGE_URL = `${DOMAIN}/cart`;\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.CODE_INPUT_ELM_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.OUTCLICK_TAB_CLOSE_TIMEOUT = 15;\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t\tthis.lastStackedCode = null;\n\t\tthis.EMPTY_CART = '.cart-empty';\n\t\tthis.ERROR_PAGE = '.error-page-message';\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 10,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst errorPage = document.querySelector(this.ERROR_PAGE);\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART);\n\t\tconst invalidCart = !!(errorPage && errorPage.offsetParent) || !!(emptyCart && emptyCart.offsetParent);\n\t\tconst correctPages = ['billing', 'cart'];\n\t\tconst { href } = window.location;\n\t\tconst correctPage = href.startsWith(BASE_URL) || correctPages.some(urlPart => href.includes(urlPart));\n\n\t\tconst codeInputField = document.querySelector(this.CODE_INPUT_ELM_SELECTOR);\n\n\t\treturn correctPage && codeInputField && !invalidCart;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(el => el.getAttribute('code'));\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this._watchForOutclickTab();\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst { discounts, originalPrice } = validationInfo;\n\t\t// Sort by discount\n\t\tdiscounts.sort((a, b) => b.finalDiscount - a.finalDiscount);\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(discounts, discount =>\n\t\t\tthis.applyCode(discount.code)\n\t\t\t\t.then(() => this.getOrderSummary())\n\t\t\t\t.then(responseHTML => {\n\t\t\t\t\tconst finalPrice = this.parseTotal(responseHTML);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t});\n\t\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\t\tthis.lastStackedCode = discount.code;\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this.removeCode(discount.code).then(() => {\n\t\t\t\t\t\tif (this.REAPPLY_CODES_WHILE_STACKING) {\n\t\t\t\t\t\t\treturn Promise.each(successfulCodes, code => this.applyCode(code));\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t).then(() =>\n\t\t\tthis.removeCode(this.lastStackedCode).then(() =>\n\t\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\t\tcodes: successfulCodes,\n\t\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\t}),\n\t\t\t),\n\t\t);\n\t}\n\n\tbeforeApplyCodes() {\n\t\t// this page looks like cart but upon page reload it shows an error\n\t\tconst unstableCartPage = window.location.href.includes('Cart-SubmitForm');\n\t\twindow.history.replaceState(\n\t\t\twindow.history.state,\n\t\t\twindow.document.title,\n\t\t\tunstableCartPage ? this.CART_PAGE_URL : window.location.href.split('?')[0],\n\t\t);\n\t}\n\n\tapplyCodes() {\n\t\treturn this.applyCode(this.lastStackedCode);\n\t}\n\n\t_watchForOutclickTab() {\n\t\t// 30s max watch for outclick tab to close\n\t\treturn new Promise(resolve => {\n\t\t\tchrome.runtime.onMessage.addListener(msg => msg.tabClosed && resolve());\n\t\t\treturn setTimeout(() => resolve(), this.OUTCLICK_TAB_CLOSE_TIMEOUT * 1000);\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Tillys',\n\tdomain: 'tillys.com',\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisSinglePageApp: true,\n\tstackable: true,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { format, DOM, browserUtils, completionActions } from '../../../utils';\n\nconst BASE_URL = 'https://www.timex.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\nconst { setCookie } = browserUtils;\n\n/* Driver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works:\n\t- Cart page\n\t- Checkout page\n+ Is driver SPA no\n+ Gather codes on site pages: no */\n\nconst URLS = [`${BASE_URL}/billing`, `${BASE_URL}/shipping`, `${BASE_URL}/checkout`, CART_PAGE_URL];\nconst isOnCart = () => document.querySelector('#cart-items-form');\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\n\t\tthis.APPLY_CODE_URL = 'https://www.timex.com/on/demandware.store/Sites-timexus-Site/en_US/Cart-AddCouponJson';\n\t\tthis.UPDATE_REQUEST_URL = CART_PAGE_URL;\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'content-type': 'application/x-www-form-urlencoded',\n\t\t\t'sec-fetch-dest': 'document',\n\t\t};\n\t\tthis.REMOVE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\t\tthis.SHIPPING_STEP_SELECTOR = '.step-1.active';\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(responseHTML => {\n\t\t\tconst taxElem = extractElement(this.TAX_SELECTOR, responseHTML);\n\t\t\tconst taxValue = taxElem ? elemToFloat(taxElem) : 0;\n\t\t\tconst shippingElem = extractElement(this.SHIPPING_SELECTOR, responseHTML);\n\t\t\tconst shippingValue = shippingElem ? elemToFloat(shippingElem) || 0 : 0;\n\t\t\tconst total = this.parseTotal(responseHTML);\n\t\t\treturn total - taxValue - shippingValue;\n\t\t});\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\t_sendRequestGET(requestURL, headers, queryParams) {\n\t\tsetCookie('_gali', 'add-coupon');\n\t\treturn this._sendRequest('GET', requestURL, headers, queryParams);\n\t}\n\n\t_isOnCartPage() {\n\t\treturn isOnCart();\n\t}\n};\n\nexport default {\n\tname: 'Timex',\n\tdomain: 'timex.com',\n\tDriver,\n\tmaxCoupons: 12, // due to testing time on Checkout\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\tURLS.some(url => href.startsWith(url)) &&\n\t\t\tdocument.querySelector(INPUT_SELECTOR) &&\n\t\t\t!document.querySelector('.step-1.active')\n\t\t);\n\t},\n\tcompletionAction: isOnCart() ? completionActions.revisit : completionActions.default,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions, DOM, format } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Payment\n+ Is driver SPA: yes\n+ Gather codes on site pages: yes, from current page\n*/\n\nconst BASE_SITE_URL = 'https://www.torrid.com';\nconst isCart = () => document.querySelector('#dwfrm_cart_couponCode');\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.orderTotal';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.DONATION_SELECTOR = '[data-itemprimarycat=\"torrid_foundation\"] .price-original';\n\t\tthis.APPLIED_CODES_SELECTOR = '.coupon-applied span, .promo-li .success:first-child';\n\t\tthis.MERCHANT_CODES_SELECTOR = '.promotion span';\n\t\tthis.MERCHANT_CODES_REGEX = /code: (\\w+)/i;\n\n\t\tthis.baseURL = `${BASE_SITE_URL}/on/demandware.store/Sites-torrid-Site/default`;\n\n\t\tthis.APPLY_CODE_URL = `${this.baseURL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${this.baseURL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${this.baseURL}/COBilling-UpdateSummary`;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('format', 'ajax');\n\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t};\n\t\tthis.REMOVE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.isStackable = true;\n\n\t\tthis.INPUT_SELECTOR = 'input[name*=\"_couponCode\"]';\n\t}\n\n\tcheckCondition() {\n\t\tconst couponInput = document.querySelector(this.INPUT_SELECTOR);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\treturn couponInput && isTotal && this.parseTotal();\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [\n\t\t\t...new Set(\n\t\t\t\t[...document.querySelectorAll(this.MERCHANT_CODES_SELECTOR)]\n\t\t\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODES_REGEX))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(matched => matched[1]),\n\t\t\t),\n\t\t];\n\t}\n\n\tapplyCodes() {\n\t\tif (isCart()) {\n\t\t\t// We should remove query parameters, to prevent form submitting again on cart page only\n\t\t\t// `cannotRefresh` parameter can't be used\n\t\t\t// because on checkout page `POST` request should be used for page reloading\n\t\t\twindow.history.replaceState(\n\t\t\t\twindow.history.state,\n\t\t\t\twindow.document.title,\n\t\t\t\twindow.location.href.split('?')[0],\n\t\t\t);\n\t\t}\n\t\t// Do nothing because `stackCodes()` will apply best codes\n\t\treturn Promise.resolve();\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(orderSummary => {\n\t\t\tconst total = this.parseTotal(orderSummary);\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, orderSummary));\n\t\t\tconst shippingElement = extractElement(this.SHIPPING_SELECTOR, orderSummary);\n\t\t\tconst shipping = /\\d/.test(shippingElement.textContent) ? elemToFloat(shippingElement) : 0;\n\t\t\tconst donationSum = [...extractElement(this.DONATION_SELECTOR, orderSummary, true)]\n\t\t\t\t.map(elemToFloat)\n\t\t\t\t.reduce((a, b) => a + b, 0);\n\n\t\t\treturn total - tax - shipping - donationSum;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Torrid',\n\tdomain: 'torrid.com',\n\tstackable: true,\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tcartContinueUrl: isCart() ? window.location.href : `${BASE_SITE_URL}/billing`,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { format, log } from '../../../utils';\n\nconst { toFloat } = format;\n\n/*\nDriver behavior description:\n Existing code: yes;\n Remove code: yes;\n Stackable: yes;\n Free gift support: no;\n isValid implemented: yes;\n Manually apply code: no;\nOptional:\n Show message about free shipping on the cart page (without discount info): no;\n Is driver SPA and add the condition to show popup: no;\n Gather codes on site pages: no;\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.BASE_URL = 'https://www.trinaturk.com/on/demandware.store/Sites-trinaturk-Site/default';\n\t\tthis.APPLY_CODE_URL = `${this.BASE_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${this.BASE_URL}/Cart-RemoveCouponLineItem`;\n\n\t\tthis.isStackable = true;\n\n\t\tthis.TOTAL_SELECTOR = document.querySelector('#checkout-main') ? '.grand-total-sum' : '.grand-total';\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'code';\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.coupon-price-adjustment';\n\t\tthis.CODES_ELEMENT_SELECTOR = '.coupon-code';\n\t\tthis.REMOVE_CODE_SELECTOR = '.remove-coupon';\n\t\tthis.REMOVE_VALUE_ATTRIBUTE = 'data-uuid';\n\n\t\tthis.CSRF_TOKEN_SELECTOR = '[name=\"csrf_token\"]';\n\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\n\t\tthis.lastResponse = null;\n\n\t\tthis.APPLIED_CODES_REGEX = /(\\w+) -/;\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst tokenElem = document.querySelector(this.CSRF_TOKEN_SELECTOR);\n\t\tthis.applyQueryParams.set('csrf_token', tokenElem ? tokenElem.value : false);\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODES_ELEMENTS_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el.innerText.match(this.APPLIED_CODES_REGEX)[1]);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.removeCode(code).then(response => {\n\t\t\t\tthis.lastResponse = response;\n\t\t\t}),\n\t\t);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(this.lastResponse)) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(responseJson => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t};\n\t\t\t\tif (responseJson.error) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tthis.lastResponse = responseJson;\n\t\t\t\tresult.finalPrice = this.parseTotal(responseJson);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tif (result.finalPrice < originalPrice) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(code).then(removeCodeJson => {\n\t\t\t\t\tthis.lastResponse = removeCodeJson;\n\t\t\t\t\tbus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice } = validationInfo;\n\n\t\t// Sort by discount\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code).then(responseJson => {\n\t\t\t\tthis.lastResponse = responseJson;\n\t\t\t\tconst finalPrice = this.parseTotal(responseJson);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t});\n\n\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(discount.code).then(removeCodeJson => {\n\t\t\t\t\tthis.lastResponse = removeCodeJson;\n\t\t\t\t\treturn Promise.each(successfulCodes, code => this.applyCode(code));\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tremoveCode(code) {\n\t\tthis.removeQueryParams.set('uuid', this._getRemoveUuidValue(code));\n\t\treturn super.removeCode(code);\n\t}\n\n\t_getRemoveUuidValue(code) {\n\t\tlet removeValueUuid = null;\n\t\tif (this.lastResponse) {\n\t\t\tconst codesObjects = this.lastResponse.totals.discounts;\n\t\t\tfor (let i = 0; i < codesObjects.length; i++) {\n\t\t\t\tconst codesObject = codesObjects[i];\n\t\t\t\tif (codesObject && codesObject.couponCode === code) {\n\t\t\t\t\tremoveValueUuid = codesObjects[i].UUID;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst codesElements = Array.from(document.querySelectorAll(this.CODES_ELEMENTS_SELECTOR));\n\t\t\tconst matchingCodesElement = codesElements.find(element => {\n\t\t\t\tconst codesElement = element.querySelector(this.CODES_ELEMENT_SELECTOR);\n\t\t\t\treturn codesElement && codesElement.innerText.match(/(\\w+) -/)[1] === code;\n\t\t\t});\n\t\t\tif (matchingCodesElement) {\n\t\t\t\tremoveValueUuid = matchingCodesElement\n\t\t\t\t\t.querySelector(this.REMOVE_CODE_SELECTOR)\n\t\t\t\t\t.getAttribute(this.REMOVE_VALUE_ATTRIBUTE);\n\t\t\t}\n\t\t}\n\t\treturn removeValueUuid;\n\t}\n\n\tparseTotal(json) {\n\t\tif (json) {\n\t\t\treturn toFloat(json.totals.grandTotal);\n\t\t}\n\t\treturn toFloat(document.querySelector(this.TOTAL_SELECTOR).textContent);\n\t}\n};\n\nexport default {\n\tname: 'Trina Turk',\n\tdomain: 'trinaturk.com',\n\tDriver,\n\tstackable: true,\n\tisCartEmpty() {\n\t\tconst cartElem = document.querySelector('.page-title');\n\t\treturn cartElem ? cartElem.innerText.includes('BAG IS EMPTY') : false;\n\t},\n\tisOnCartUrl() {\n\t\treturn !!document.querySelector('#couponCode');\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { sessionTimer } from '../../lib';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\nconst DOMAIN_URL = 'https://www.truereligion.com';\nconst CART_PAGE_URL = `${DOMAIN_URL}/cart`;\nconst BASE_URL = `${DOMAIN_URL}/on/demandware.store/Sites-TrueReligion-Site/default`;\n\n/* Driver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: no\n    Free gift support:  no\n    isValid implemented: no\n    Manually apply code: no\nOptional:\n    Show message about free shipping on the cart page: no\n    Is driver SPA and add the condition to show popup: yes\n    Gather codes on site pages: yes\n    Active pages: cart, checkout(billing)\n    sessionTimer: 15min */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.APPLIED_CODES_SELECTOR = '.coupon-applied';\n\t\tthis.CODE_REGEX = /Promo Number: (\\w+)/;\n\t\tthis.APPLIED_ELEM_SELECTOR = '.promo-coupon-style';\n\t\tthis.INPUT_SELECTOR = '#dwfrm_cart_couponCode, #dwfrm_billing_couponCode';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\n\t\tthis.MERCHANT_CODE_SELECTOR = '.bx-row-coupon div';\n\t\tthis.MERCHANT_CODES_REG = /Use Code: (\\w+)/;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponAjax`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-DeleteCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = window.location.href.startsWith(CART_PAGE_URL)\n\t\t\t? `${BASE_URL}/COBilling-UpdateSummary`\n\t\t\t: `${BASE_URL}/COBilling-Start`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'dwfrm_cart_couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'couponCode';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams.set('gcPromoSubmitted', 'true');\n\t\tsessionTimer.initialize();\n\t}\n\n\tcheckCondition() {\n\t\tconst codeInput = document.querySelector(this.INPUT_SELECTOR);\n\t\tconst emptyCartSelector = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst totalElem = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst rightCurrency = totalElem ? totalElem.textContent.includes('$') : false;\n\t\treturn codeInput && !emptyCartSelector && rightCurrency;\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst merchantCodes = [];\n\t\treturn this._getPage().then(responseHTML => {\n\t\t\tconst merchantCode = responseHTML.match(this.MERCHANT_CODES_REG);\n\t\t\tif (merchantCode) {\n\t\t\t\tmerchantCodes.push(merchantCode[1]);\n\t\t\t}\n\t\t\tconst codeFromPage = document.querySelector(this.MERCHANT_CODE_SELECTOR);\n\t\t\tif (codeFromPage) {\n\t\t\t\tmerchantCodes.push(codeFromPage.textContent);\n\t\t\t}\n\t\t\treturn merchantCodes;\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [];\n\t\tconst codeElement = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\tif (codeElement && codeElement.innerText.match(this.CODE_REGEX)) {\n\t\t\tcodes.push(codeElement.innerText.match(this.CODE_REGEX)[1]);\n\t\t} else if (document.querySelector(this.APPLIED_ELEM_SELECTOR)) {\n\t\t\tcodes.push(document.querySelector(this.APPLIED_ELEM_SELECTOR).textContent.trim());\n\t\t} else if (codeElement && codeElement.innerText.includes('Applied')) {\n\t\t\tcodes.push(codeElement.textContent.split(' ')[2]);\n\t\t}\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) || 0 : 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax + shippingDiscount;\n\t\t});\n\t}\n\n\t_getPage() {\n\t\treturn fetch(`${DOMAIN_URL}/`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_isOnCartPage() {\n\t\treturn window.location.href.startsWith(this.CART_PAGE_URL) && document.querySelector(this.CART_FORM_SELECTOR);\n\t}\n};\n\nexport default {\n\tname: 'True Religion',\n\tdomain: 'truereligion.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tcartContinueUrl:\n\t\twindow.location.href.includes('COBilling-DeleteCoupon') || window.location.href.includes('shipping')\n\t\t\t? `${BASE_URL}/COBilling-Start`\n\t\t\t: window.location.href,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { log, completionActions, DOM, format } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/* Driver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: yes\n+ isValid implemented: yes\n+ Codes can be replaced by another code: no\n+ Pages, where extension works: Cart, Checkout (Payment step)\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n+ Session timer: 15 minutes\n+ Special case about the driver works:\nWe don't use completionAction.revisit for FF, because user can avoid cart page\nand we will receive popup in FF\n */\n\nconst CART_PAGE_URL = 'https://www.ugg.com/cart';\nconst CART_FORM_SELECTOR = 'form[name=\"dwfrm_cart\"]';\n\nconst isCart = () => window.location.href.startsWith(CART_PAGE_URL) && document.querySelector(CART_FORM_SELECTOR);\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.cart__checkout__wrapper .order-total td:last-child, [ng-bind*=\"cartSummary.total\"]';\n\t\tthis.APPLIED_CODES_SELECTOR = '.coupon-code .value';\n\t\tthis.PAYMENT_SELECTOR = '#spc-panel-billing.is-active';\n\t\tthis.INPUT_SELECTOR = '#spc-coupon-code, #dwfrm_cart_couponCode';\n\n\t\tconst BASE_URL = 'https://www.ugg.com/on/demandware.store/Sites-UGG-US-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/COBilling-ApplyCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/SPC-UpdateCartSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.COUPON_DESCRIPTION_SELECTOR = '.item-coupon-details';\n\t\tthis.FREE_SHIPPING_REGEX = /free.*shipping/i;\n\n\t\tthis.applyQueryParams = new URLSearchParams({\n\t\t\tformat: 'ajax',\n\t\t\tspc: true,\n\t\t\tfromPos: false,\n\t\t\torderNo: null,\n\t\t});\n\n\t\tthis.isStackable = false;\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tsessionTimer.initialize();\n\t}\n\n\tcheckCondition() {\n\t\tconst isSection = document.querySelector(`${this.PAYMENT_SELECTOR}, ${CART_FORM_SELECTOR}`);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst isInput = document.querySelector(this.INPUT_SELECTOR);\n\t\treturn isInput && isSection && isTotal && this.parseTotal();\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this.removeCode(code))\n\t\t\t.then(() => (this._isOnCartPage() ? this.getCartPage() : this.getOrderSummary()))\n\t\t\t.then(response => this.parseTotal(response));\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t\tfreeShipping: false,\n\t\t\t\t};\n\t\t\t\tresult.isValid = !applyCodeResponse.couponStatus;\n\n\t\t\t\tif (!result.isValid) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tconst promise = this._isOnCartPage() ? this.getCartPage() : this.getOrderSummary();\n\t\t\t\treturn promise.then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeShipping = isCart() ? this._isFreeShipping(orderSummary) : false;\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst tax = toFloat(response.tax);\n\t\t\tconst shipping = toFloat(response.shipments[0].shipping_cost);\n\t\t\treturn this.parseTotal(response, true) - tax - shipping;\n\t\t});\n\t}\n\n\t_isFreeShipping(response) {\n\t\tconst couponDescriptionEl = extractElement(this.COUPON_DESCRIPTION_SELECTOR, response);\n\t\treturn Boolean(couponDescriptionEl && couponDescriptionEl.textContent.match(this.FREE_SHIPPING_REGEX));\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tparseTotal(data, isPretax = false) {\n\t\tif ((data && !this._isOnCartPage()) || isPretax) {\n\t\t\treturn toFloat(data.total);\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, data));\n\t}\n\n\t_isOnCartPage() {\n\t\treturn isCart();\n\t}\n};\n\nexport default {\n\tname: 'UGG',\n\tdomain: 'ugg.com',\n\tDriver,\n\tcompletionAction: isCart() ? completionActions.revisit : completionActions.default,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { DOM, format, log, completionActions } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\nconst BASE_SITE_URL = 'https://www.uniqlo.com/us/en';\nconst CART_PAGE_URL = `${BASE_SITE_URL}/cart`;\nconst INPUT_CART_SELECTOR = '#dwfrm_cart_couponCode';\nconst isOnCartPage = () =>\n\twindow.location.href.startsWith(CART_PAGE_URL) && Boolean(document.querySelector(INPUT_CART_SELECTOR));\n\n// Driver behavior description:\n// -    Existing code: yes\n// -    Remove code: yes\n// -    Stackable: yes\n// -    Free gift support: yes\n// -    isValid implemented: yes\n// Optional:\n// -    Is driver SPA and add the condition to show popup: yes\n// -\t\twe support cart and checkout (payment) pages with reloading\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tconst isTotal = document.querySelector('.order-total .order-value');\n\t\tthis.TOTAL_SELECTOR = isTotal ? '.order-total .order-value' : '.order-subtotal .order-value:last-child';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cartcoupon .value';\n\t\tthis.MERCHANT_CODES_SELECTOR = '.bx-click-to-copy .coupon';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.mini-cart-product';\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.uniqlo.com/on/demandware.store/Sites-UniqloUS-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/Cart-SubmitForm`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\t}\n\n\tcheckCondition() {\n\t\tconst isInput = document.querySelector(`${this.CODE_INPUT_SELECTOR}, ${INPUT_CART_SELECTOR}`);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\treturn isInput && isTotal;\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst welcomeOfferCode = document.querySelector(this.MERCHANT_CODES_SELECTOR);\n\t\treturn welcomeOfferCode ? [welcomeOfferCode.textContent] : [];\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\n\t\t\t\tif (\n\t\t\t\t\tapplyCodeResponse.status &&\n\t\t\t\t\t(applyCodeResponse.status === 'NO_ACTIVE_PROMOTION' ||\n\t\t\t\t\t\tapplyCodeResponse.status === 'COUPON_CODE_UNKNOWN')\n\t\t\t\t) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount(orderSummary) - originalItemsCount;\n\t\t\t\t\tresult.isValid = true;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t\toriginalItemsCount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst taxEl = extractElement(this.TAX_SELECTOR, response);\n\t\t\tconst tax = taxEl ? elemToFloat(taxEl) || 0 : 0;\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\tparseTotal(html) {\n\t\tconst totalElem = document.querySelector('.order-total .order-value');\n\t\tif (html && !totalElem) {\n\t\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\t}\n\t\treturn elemToFloat(extractElement(this.TOTAL_SELECTOR, html));\n\t}\n\n\t_isOnCartPage() {\n\t\treturn isOnCartPage();\n\t}\n};\n\nexport default {\n\tname: 'UNIQLO',\n\tdomain: 'uniqlo.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tenforceOriginalCaseCodes: true,\n\tcartContinueUrl: isOnCartPage() ? window.location.href : `${BASE_SITE_URL}/Billing/`,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { format, DOM, log } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/* Driver behavior description:\n Existing code: yes;\n Remove code: yes;\n Stackable: yes;\n Free gift support: no;\n isValid implemented: yes;\n Manually apply code: no;\n Active pages: Cart, Checkout\nOptional:\n Show message about free shipping on the cart page (without discount info): no;\n Is driver SPA and add the condition to show popup: no;\n Gather codes on site pages: no;\n====Special case====\nNeed to take subtotal because sometimes we receive response without shipping and tax values */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.BASE_URL = 'https://us.puma.com/on/demandware.store/Sites-NA-Site/en_US';\n\t\tthis.APPLY_CODE_URL = `${this.BASE_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${this.BASE_URL}/Cart-RemoveCouponLineItem`;\n\n\t\tthis.isStackable = true;\n\n\t\tthis.TOTAL_SELECTOR = '.sub-total .value';\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'code';\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.coupon-price-adjustment';\n\t\tthis.CODES_ELEMENT_SELECTOR = '.coupon-code';\n\t\tthis.REMOVE_CODE_SELECTOR = '.remove-coupon';\n\t\tthis.REMOVE_VALUE_ATTRIBUTE = 'data-uuid';\n\n\t\tthis.CSRF_TOKEN_SELECTOR = '[name=\"csrf_token\"]';\n\t\tthis.REAPPLY_CODES_WHILE_STACKING = true;\n\t\tthis.lastResponse = null;\n\n\t\tthis.SHIPPING_METHOD_SELECTOR = '.form-check.selected input';\n\t\tthis.SHIPPING_LIST_SELECTOR = '.shipping-method-list';\n\t\tthis.EXISTING_REGEX = /(\\w+)/;\n\n\t\tsessionTimer.initialize();\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst tokenElem = document.querySelector(this.CSRF_TOKEN_SELECTOR);\n\t\tthis.applyQueryParams.set('csrf_token', tokenElem ? tokenElem.value : false);\n\t\t// this pause is needed in case removing code by user\n\t\treturn Promise.delay(2500);\n\t}\n\n\tgetUserData() {\n\t\tconst checkedShippingElement = document.querySelector(this.SHIPPING_METHOD_SELECTOR);\n\t\tif (!checkedShippingElement) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {\n\t\t\tshippingSelector: `#${checkedShippingElement.getAttribute('id')}`,\n\t\t};\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODES_ELEMENT_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(element => element.innerText.match(this.EXISTING_REGEX)[0]);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.removeCode(code).then(response => {\n\t\t\t\tthis.lastResponse = response;\n\t\t\t}),\n\t\t);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(this.lastResponse)) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(responseJson => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t};\n\t\t\t\tif (responseJson.error) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tthis.lastResponse = responseJson;\n\t\t\t\tresult.finalPrice = this.parseTotal(responseJson);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tif (result.finalPrice < originalPrice) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(code).then(removeCodeJson => {\n\t\t\t\t\tthis.lastResponse = removeCodeJson;\n\t\t\t\t\tbus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t}),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice } = validationInfo;\n\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code).then(responseJson => {\n\t\t\t\tif (responseJson.error) {\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\tthis.lastResponse = responseJson;\n\t\t\t\tconst finalPrice = this.parseTotal(responseJson);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t});\n\n\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(discount.code).then(removeCodeJson => {\n\t\t\t\t\tthis.lastResponse = removeCodeJson;\n\t\t\t\t\treturn Promise.each(successfulCodes, code => this.applyCode(code));\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tasync removeCode(code) {\n\t\tconst removeUuid = await this._getRemoveUuidValue(code);\n\t\tif (!removeUuid) {\n\t\t\treturn null;\n\t\t}\n\t\tthis.removeQueryParams.set('uuid', removeUuid);\n\t\treturn super.removeCode(code);\n\t}\n\n\tgetPreTaxShippingTotal(retry = false) {\n\t\t// subtotal includes discount\n\t\treturn this.getCartPage().then(responseHTML => {\n\t\t\tconst subTotalElem = extractElement(this.TOTAL_SELECTOR, responseHTML);\n\t\t\tif (!subTotalElem && !retry) {\n\t\t\t\treturn this.getPreTaxShippingTotal(true);\n\t\t\t}\n\t\t\treturn elemToFloat(subTotalElem);\n\t\t});\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn document.querySelector(this.SHIPPING_LIST_SELECTOR);\n\t}\n\n\tsetUserData(userData) {\n\t\tconst shippingElement = document.querySelector(userData.shippingSelector);\n\t\tif (shippingElement) {\n\t\t\tdocument.querySelector(userData.shippingSelector).click();\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t_getRemoveUuidValue(code) {\n\t\tlet removeValueUuid = null;\n\t\tif (this.lastResponse) {\n\t\t\tconst codeUuid = this.lastResponse.totals.discounts.find(item => item.couponCode === code);\n\t\t\tif (codeUuid) {\n\t\t\t\tremoveValueUuid = codeUuid.UUID;\n\t\t\t}\n\t\t} else {\n\t\t\tconst codesElements = [...document.querySelectorAll(this.CODES_ELEMENTS_SELECTOR)];\n\t\t\tconst matchingCodesElement = codesElements.find(element => {\n\t\t\t\tconst codesElement = element.querySelector(this.CODES_ELEMENT_SELECTOR);\n\t\t\t\treturn codesElement && codesElement.innerText.match(this.EXISTING_REGEX)[0] === code;\n\t\t\t});\n\t\t\tif (matchingCodesElement) {\n\t\t\t\tremoveValueUuid = matchingCodesElement\n\t\t\t\t\t.querySelector(this.REMOVE_CODE_SELECTOR)\n\t\t\t\t\t.getAttribute(this.REMOVE_VALUE_ATTRIBUTE);\n\t\t\t}\n\t\t}\n\t\treturn removeValueUuid;\n\t}\n\n\tparseTotal(json) {\n\t\tif (json && json.totals) {\n\t\t\treturn toFloat(json.totals.subTotal);\n\t\t}\n\t\treturn toFloat(document.querySelector(this.TOTAL_SELECTOR).textContent);\n\t}\n};\n\nexport default {\n\tname: 'Puma',\n\tdomain: 'us.puma.com',\n\tDriver,\n\tstackable: true,\n\trestoreUserData: true,\n\tisCartEmpty() {\n\t\tconst cartElem = document.querySelector('.page-title');\n\t\treturn cartElem ? cartElem.innerText.includes('BAG IS EMPTY') : false;\n\t},\n\tisOnCartUrl() {\n\t\treturn !!document.querySelector('#couponCode');\n\t},\n\tadditionalCallout: {\n\t\tmessage: 'Note: the total price may have changed to include tax after code testing',\n\t\tshowWhenCodeWasFound: true,\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractFormValues, extractElement } = DOM;\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout(Shipping page)\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n+ maxCoupons: 12, long code testing time\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tconst applyFormValues = extractFormValues('form[name=\"frmCoupon\"]');\n\t\tconst removeFormValues = extractFormValues('form.coupanapplied');\n\n\t\t// Overridden values\n\t\tthis.TOTAL_SELECTOR = 'h3.cart-total';\n\t\tthis.APPLIED_CODE_SELECTOR = '.coupanapplied';\n\t\tthis.TAX_SELECTOR = '.taxes span';\n\t\tthis.SHIPPING_SELECTOR = '.shippingprice span';\n\t\tthis.DONATION_SELECTOR = '.donation span';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.verabradley.com/store/us/cart';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/coupons`;\n\t\tthis.REMOVE_CODE_URL = this.APPLY_CODE_URL;\n\t\tthis.UPDATE_REQUEST_URL = BASE_URL;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = '/atg/commerce/promotion/CouponFormHandler.couponClaimCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = '/atg/commerce/promotion/CouponFormHandler.couponRepoID';\n\n\t\tif (applyFormValues) {\n\t\t\tthis.applyQueryParams = applyFormValues.params;\n\t\t}\n\t\tthis.applyQueryParams.set('/atg/commerce/promotion/CouponFormHandler.claimCoupon', 'APPLY');\n\n\t\tif (removeFormValues) {\n\t\t\tthis.removeQueryParams = removeFormValues.params;\n\t\t}\n\t\tthis.removeQueryParams.set('remove', 'Remove');\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODE_SELECTOR)]\n\t\t\t.filter(elem => elem.id !== 'dummyCouponForm')\n\t\t\t.map(elem => elem.id);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response));\n\t\t\tconst calculatedShipping = Number.isNaN(shipping) ? 0 : shipping;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response));\n\t\t\tconst donation = elemToFloat(extractElement(this.DONATION_SELECTOR, response));\n\t\t\treturn this.parseTotal(response) - calculatedShipping - tax - donation;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Vera Bradley',\n\tdomain: 'verabradley.com',\n\tstackable: true,\n\tmaxCoupons: 12,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith('https://www.verabradley.com/us/cart') ||\n\t\t\thref.startsWith('https://www.verabradley.com/us/checkout/shipping')\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.emptycart');\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\nimport { completionActions, log } from '../../../utils';\n\nconst CHECKOUT_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\n/* Behaviour description:\n-    Existing code: yes\n-    Remove code: yes\n-    Stackable: no\n-    Free gift support: only on the cart page\n-    isValid implemented: yes\nOptional:\n-    Is driver SPA and add the condition to show popup: no\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_PAGE_URL = 'https://www.vince.com/cart';\n\n\t\tthis.BASE_URL = 'https://www.vince.com/on/demandware.store/Sites-vince-Site/default';\n\t\tthis.APPLY_CODE_URL = `${this.BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${this.BASE_URL}/COBilling-Start`;\n\n\t\tthis.APPLY_CODE_BTN_SELECTOR = '#add-coupon';\n\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-row';\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\n\t\tthis.CART_FORM_SELECTOR = '#cart-items-form';\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\n\t\tthis.isStackable = true;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.checkoutInput = document.querySelector(CHECKOUT_INPUT_SELECTOR);\n\n\t\treturn Promise.resolve();\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tfreeGifts: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this.applyCode(code).then(applyCodeResponse => {\n\t\t\t\tif (applyCodeResponse.success) {\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t}\n\n\t\t\t\tconst successState = this._getValueFromJSON(applyCodeResponse);\n\n\t\t\t\tif (successState !== null && successState !== this.APPLY_RESPONSE_COMPARE_SUCCESS_VALUE) {\n\t\t\t\t\t// Code was not applied\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\treturn this.getOrderSummary().then(orderSummary => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal(orderSummary);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount(orderSummary) - originalItemsCount;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(() => {\n\t\t\tif (this.isStackable) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t\toriginalItemsCount,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\t_isOnCartPage() {\n\t\treturn window.location.href.startsWith(this.CART_PAGE_URL) && document.querySelector(this.CART_FORM_SELECTOR);\n\t}\n};\n\nexport default {\n\tname: 'Vince',\n\tdomain: 'vince.com',\n\tstackable: true,\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n\tisOnCartUrl() {\n\t\t// there can be different urls\n\t\treturn document.querySelector('#dwfrm_cart_couponCode') || document.querySelector(CHECKOUT_INPUT_SELECTOR);\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/*\nDriver behavior description:\n    Existing code: yes\n    Remove code: yes\n    Stackable: yes\n    Free gift support: no\n    isValid implemented: yes\nOptional:\n    Is driver SPA and add the condition to show popup: yes\n    Gather codes on site pages: yes\n    Can apply codes on cart and checkout\n=======Special case=======\nSometimes after deleting codes merchant can relocate us to \"/express\" page. \nWe don't support this page because of strange behavior on it.\n */\n\nconst API_REQUEST_URL = 'https://www.vineyardvines.com/';\nconst CART_PAGE_URL = `${API_REQUEST_URL}cart`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = 'dd.ordersummary_cost_total';\n\t\tthis.APPLIED_CODES_SELECTOR = '.ordersummary .ordersummary_promotion_title';\n\t\tthis.INPUT_FIELD_SELECTOR = '#promo-code, #billingCoupon';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = `${API_REQUEST_URL}on/demandware.store/Sites-Vineyard-Vines-Site/en_US`;\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/Cart-OrderSummaryVariation`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.APPLIED_CODE_REGEX = /promotion (.*?) applied/i;\n\n\t\tthis.PROMO_SELECTOR = '#TT_main .feature_title span';\n\t\tthis.PROMO_REGEX = /code: (\\w+)/i;\n\n\t\tthis.CART_EMPTY_SELECTOR = '#bag .bag_emptymsg';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isRightUrl = href.includes('/cart') || href.includes('/billinginfo');\n\t\tconst isInputField = document.querySelector(this.INPUT_FIELD_SELECTOR);\n\t\tconst isCartEmpty = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\treturn isRightUrl && isInputField && !isCartEmpty;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn fetch(API_REQUEST_URL)\n\t\t\t.then(res => res.text())\n\t\t\t.then(html => {\n\t\t\t\treturn [\n\t\t\t\t\t...new Set(\n\t\t\t\t\t\t[...extractElement(this.PROMO_SELECTOR, html, true)]\n\t\t\t\t\t\t\t.map(item => item.textContent.match(this.PROMO_REGEX))\n\t\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t\t.map(el => el[1]),\n\t\t\t\t\t),\n\t\t\t\t];\n\t\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.APPLIED_CODE_REGEX)[1])\n\t\t\t.filter(Boolean);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getOrderSummary().then(response => {\n\t\t\tconst shipping = this._findValueByLabel(response, 'Shipping');\n\t\t\tconst tax = this._findValueByLabel(response, 'Sales Tax');\n\t\t\tconst shippingDiscount = this._findValueByLabel(response, 'Shipping Discount');\n\n\t\t\treturn this.parseTotal(response) - shipping + shippingDiscount - tax;\n\t\t});\n\t}\n\n\t_findValueByLabel(response, label) {\n\t\tconst element = [...extractElement('dt', response, true)].find(el => el.textContent.includes(label));\n\t\treturn element ? elemToFloat(element.nextElementSibling) : 0;\n\t}\n\n\tapplyCode(code) {\n\t\tthis.applyQueryParams.set(this.APPLY_CODE_PARAM_NAME, code);\n\n\t\treturn this._sendRequestPOST(this.APPLY_CODE_URL, this.APPLY_REQUEST_HEADERS, null, this.applyQueryParams);\n\t}\n\n\tremoveCode(code) {\n\t\tif (this.REMOVE_CODE_PARAM_NAME) {\n\t\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\t}\n\n\t\treturn this._sendRequestPOST(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, null, this.removeQueryParams);\n\t}\n};\n\nexport default {\n\tname: 'vineyard vines',\n\tdomain: 'vineyardvines.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions } from '../../../utils';\nimport { toFloat } from '../../../utils/format';\nimport { extractData, extractElement } from '../../../utils/DOM';\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ isValid implemented: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout(Billing)\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n */\n\nconst BASE_URL = 'https://www.vitaminworld.com';\nconst CART_PAGE_URL = `${BASE_URL}/cart`;\nconst BILLING_URL = `${BASE_URL}/billing`;\nconst BILLING_EDIT_URL = `${BASE_URL}/billing-edit`;\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-vitaminworld_us-Site/default`;\nconst CART_SUBMIT_URL = `${BASE_REQUEST_URL}/Cart-SubmitForm`;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.CODE_VALUE_SELECTOR = '.billing-applied .label-promo';\n\t\tthis.isStackable = true;\n\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCouponJson`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/COBilling-RemoveCouponJson`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-of-type';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:last-of-type';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-of-type';\n\t\tthis.APPLIED_CODES_SELECTOR = '.label-promo';\n\t}\n\n\tremoveCode(code) {\n\t\treturn this.removeCodeOnCart(code);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst total = this.parseTotal(responseHTML);\n\t\t\tconst shippingDiscount = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, responseHTML) || 0;\n\t\t\tconst shipping = extractData(this.SHIPPING_SELECTOR, responseHTML);\n\t\t\tconst tax = extractData(this.TAX_SELECTOR, responseHTML);\n\n\t\t\tconst calculatedShippingDiscount = shippingDiscount !== 0 ? shippingDiscount.textContent : 0;\n\t\t\tconst calculatedShipping = shipping.toLowerCase().includes('free') ? 0 : shipping;\n\t\t\tconst calculatedTax = tax.trim().includes('TBD') ? 0 : tax;\n\n\t\t\treturn total - toFloat(calculatedShipping) - toFloat(calculatedTax) + toFloat(calculatedShippingDiscount);\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(window.location.href.includes('Cart-SubmitForm') ? CART_PAGE_URL : window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(responseHTML => responseHTML.text());\n\t}\n};\n\nexport default {\n\tname: 'Vitamin World',\n\tdomain: 'vitaminworld.com',\n\tstackable: true,\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tcartContinueUrl: window.location.href.includes('Cart-SubmitForm') ? CART_PAGE_URL : window.location.href,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t(href.startsWith(CART_PAGE_URL) ||\n\t\t\t\thref.startsWith(BILLING_URL) ||\n\t\t\t\thref.startsWith(BILLING_EDIT_URL) ||\n\t\t\t\thref.startsWith(CART_SUBMIT_URL)) &&\n\t\t\tdocument.querySelector('#dwfrm_cart_couponCode, #dwfrm_billing_couponCode')\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.mini-cart-empty'));\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = 'https://www.wolverine.com/on/demandware.store/Sites-wolverine_us-Site/default';\n\n\t\tthis.APPLY_CODE_URL = `${this.BASE_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${this.BASE_URL}/Cart-RemoveCoupon`;\n\t\tthis.UPDATE_REQUEST_URL = `${this.BASE_URL}/Cart-UpdateBasketTotals`;\n\n\t\tthis.REMOVE_CODE_PARAM_NAME = this.APPLY_CODE_PARAM_NAME;\n\n\t\tthis.applyQueryParams.set('format', 'ajax');\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.isStackable = true;\n\t}\n\n\tgetExistingCodes() {\n\t\tlet codes = [];\n\t\tif (window.location.pathname.includes('/cart')) {\n\t\t\tcodes = [...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(elem => elem.innerText.trim());\n\t\t} else {\n\t\t\tconst codesElements = [...document.querySelectorAll('[data-couponcode]')].map(el =>\n\t\t\t\tel.getAttribute('data-couponcode'),\n\t\t\t);\n\t\t\tcodes = [...new Set(codesElements)];\n\t\t}\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: 'Wolverine',\n\tdomain: 'wolverine.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.wolverine.com/US/en/cart') || href.includes('billing');\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport { sessionTimer } from '../../lib';\nimport { browserUtils, completionActions, DOM, format } from '../../../utils';\n\nconst { wait } = browserUtils;\nconst { extractElement, runEmbeddedScript, setValue } = DOM;\nconst { elemToFloat } = format;\n\n/*\nBehavior description:\n\t+ Existing code: yes\n\t+ Remove code: yes\n\t+ Stackable: no\n\t+ Free gift support: no\n\t+ Free shipping: no\n\t+ isValid implemented: yes\n\t+ Replace code: no\n\t+ Manually apply code: yes(checkout page)\n\t+ Pages, where extension works: Cart, Payment\n\t+ Is driver SPA: yes\n\t+ Gather codes on site pages: yes, from https://www.womanwithin.com/offers-coupons page\n====Spesial case====\n\t+ Session timer: 20min\n*/\n\nconst BASE_URL = 'https://www.womanwithin.com';\nconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-womanwithin-Site/default`;\n\nconst isOnCheckout = () => window.location.href.includes('checkout');\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_ELEMENT_CONFIG = {\n\t\t\tselector: '.order-total .order-value',\n\t\t};\n\t\tthis.TOTAL_SELECTOR = this.TOTAL_ELEMENT_CONFIG.selector;\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode, #dwfrm_billing_couponCode';\n\t\tthis.PRODUCT_REMOVE_SELECTOR = '.remove-btn, .add-to-wishlist';\n\n\t\tthis.CSRF_TOKEN_SELECTOR = '[name=\"csrf_token\"]';\n\n\t\tthis.CART_PAGE_URL = `${BASE_URL}/cart`;\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-SubmitForm`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/Cart-SubmitForm`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_REQUEST_URL}/COBilling-UpdateSummary`;\n\n\t\tthis.APPLY_CODE_PARAM_NAME = 'dwfrm_cart_couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'dwfrm_cart_coupons_i0_deleteCoupon';\n\n\t\tthis.REMOVE_CODE_BTN_SELECTOR = '#remove-coupon';\n\n\t\tthis.APPLIED_CODE_BUTTON_SELECTOR = '#add-coupon';\n\t\tthis.APPLIED_CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\n\t\tthis.COUPONS_PAGE_URL = `${BASE_URL}/offers-coupons`;\n\t\tthis.MERCHANT_CODE_SELECTOR = '.promo-code b, .oc-coupon-code';\n\n\t\tthis.TAX_VALUE_SELECTOR = '.order-sales-tax .value';\n\t\tthis.SHIPPING_VALUE_SELECTOR = '.order-shipping .value';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount .value';\n\n\t\tthis.APPLY_REQUEST_HEADERS = {\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t'upgrade-insecure-requests': 1,\n\t\t};\n\t\tthis.REMOVE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\t\tthis.UPDATE_REQUEST_HEADERS = this.APPLY_REQUEST_HEADERS;\n\n\t\tthis.isListenerAdded = false;\n\t}\n\n\twatchForCartUrl() {\n\t\tif (navigator.cookieEnabled) {\n\t\t\tlocalStorage.setItem('lastProductRemove', 'false');\n\t\t}\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 20,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst cookiesOn = navigator.cookieEnabled;\n\t\tconst isRightUrl =\n\t\t\thref.includes('/cart') ||\n\t\t\thref.includes('/Cart-SubmitForm') ||\n\t\t\thref.includes('/checkout') ||\n\t\t\thref.includes('/shipping');\n\t\tconst total = (document.querySelector(this.TOTAL_SELECTOR) || {}).offsetParent;\n\t\tconst isCodeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tif (!this.isListenerAdded && cookiesOn) {\n\t\t\tthis.isListenerAdded = true;\n\t\t\trunEmbeddedScript(`\n\t\t\t\t\t[...document.querySelectorAll('${this.PRODUCT_REMOVE_SELECTOR}')]\n\t\t\t\t\t.map(el => el.addEventListener('click', () => localStorage.setItem('lastProductRemove', true)));\n\t\t\t\t`);\n\t\t}\n\t\treturn (\n\t\t\tcookiesOn && (isRightUrl || total) && isCodeInput && localStorage.getItem('lastProductRemove') === 'false'\n\t\t);\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst tokenElem = document.querySelector(this.CSRF_TOKEN_SELECTOR);\n\t\tthis.applyQueryParams.set('csrf_token', tokenElem ? tokenElem.value : false);\n\t\tthis.removeQueryParams.set('csrf_token', tokenElem ? tokenElem.value : false);\n\t\treturn Promise.resolve();\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn isOnCheckout() ? this.applyCodeManually(codes[0]) : this.applyCode(codes[0]);\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn isOnCheckout() ? this.removeCodeManually() : this.removeCode(codes[0]);\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn fetch(this.COUPONS_PAGE_URL, {\n\t\t\tmethod: 'GET',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(responseHTML => [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...extractElement(this.MERCHANT_CODE_SELECTOR, responseHTML, true)]\n\t\t\t\t\t\t.map(el => el.textContent)\n\t\t\t\t\t\t.filter(el => Boolean(el) && el.toLowerCase() !== 'no code needed'),\n\t\t\t\t),\n\t\t\t]);\n\t}\n\n\tapplyCode(code) {\n\t\tthis.applyQueryParams.set('dwfrm_cart_addCoupon', 'dwfrm_cart_addCoupon');\n\t\tthis.applyQueryParams.set(this.APPLY_CODE_PARAM_NAME, code);\n\t\treturn this._sendRequestPOST(this.APPLY_CODE_URL, this.APPLY_REQUEST_HEADERS, false, this.applyQueryParams);\n\t}\n\n\tapplyCodeManually(code) {\n\t\tconst codeInputElm = document.querySelector(this.APPLIED_CODE_INPUT_SELECTOR);\n\t\tconst codeApplyBtn = document.querySelector(this.APPLIED_CODE_BUTTON_SELECTOR);\n\t\tsetValue(codeInputElm, code);\n\t\tcodeApplyBtn.click();\n\t\tconst codeWasApplied = () => document.querySelector(this.REMOVE_CODE_BTN_SELECTOR);\n\t\treturn wait(codeWasApplied, 10000);\n\t}\n\n\tremoveCodeManually() {\n\t\tdocument.querySelector(this.REMOVE_CODE_BTN_SELECTOR).click();\n\t\tconst codeWasRemoved = () => !document.querySelector(this.REMOVE_CODE_BTN_SELECTOR);\n\t\treturn wait(codeWasRemoved, 10000)\n\t\t\t.then(() => this.getOrderSummary())\n\t\t\t.then(res => this.parseTotal(res));\n\t}\n\n\tremoveCode(code) {\n\t\tthis.removeQueryParams.set(this.REMOVE_CODE_PARAM_NAME, code);\n\t\treturn this._sendRequestPOST(this.REMOVE_CODE_URL, this.REMOVE_REQUEST_HEADERS, false, this.removeQueryParams)\n\t\t\t.then(() => this.getOrderSummary())\n\t\t\t.then(res => this.parseTotal(res));\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getCartPage().then(responseHTML => {\n\t\t\tconst taxValue = elemToFloat(extractElement(this.TAX_VALUE_SELECTOR, responseHTML)) || 0;\n\t\t\tconst shippingValue = elemToFloat(extractElement(this.SHIPPING_VALUE_SELECTOR, responseHTML)) || 0;\n\t\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, responseHTML);\n\t\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) || 0 : 0;\n\t\t\treturn this.parseTotal(responseHTML) - taxValue - shippingValue + shippingDiscount;\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'womanwithin',\n\tdomain: 'womanwithin.com',\n\tisSinglePageApp: true,\n\tDriver,\n\tcompletionAction: isOnCheckout() ? completionActions.none : completionActions.default,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions } from '../../../utils';\nimport { extractElement } from '../../../utils/DOM';\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ isValid implemented: no\n+ Codes can be replaced by another code: yes\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Don't support Checkout due to clear data, can't avoid Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n+ credentials: josephq@gmail.com, 12345qwerty\n*/\n\nconst CART_PAGE_URL = 'https://www.ylighting.com/cart';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.ordertotal .value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.submitedcoupon, .coupon-applied-block li';\n\t\tthis.PRODUCT_ITEM_SELECTOR = 'tr.cartproductrow, .ordersummary';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.ylighting.com/on/demandware.store/Sites-YLighting-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/COBilling-ApplyCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCLI`;\n\t\tthis.UPDATE_REQUEST_URL = CART_PAGE_URL;\n\t\tthis.PROPOSED_CODES_URL = `${BASE_URL}/Page-GetPromosOnly`;\n\n\t\tthis.CART_CODE_REGEX = /Promo Code \\w+: ((\\w+))?/;\n\n\t\tthis.FREE_GIFT_MSG_SELECTOR = '.cartproductrow .promo';\n\t\tthis.FREE_GIFT_MSG_REGEX = /applied for a free gift/;\n\n\t\tthis.PROPOSED_CODES_SELECTOR = '.promoDetailContainer p strong';\n\n\t\tthis.CART_FORM_SELECTOR = '#dwfrm_cart';\n\n\t\tthis.CART_PAGE_URL = CART_PAGE_URL;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'coupon';\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getProposedCoupons().then(responseText => {\n\t\t\tif (!responseText) {\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\treturn [...extractElement(this.PROPOSED_CODES_SELECTOR, responseText, true)].map(el =>\n\t\t\t\tel.textContent.trim(),\n\t\t\t);\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(codeElement => codeElement.innerText.match(this.CART_CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(match => match[1]);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tparseItemsCount(html) {\n\t\treturn extractElement(this.PRODUCT_ITEM_SELECTOR, html, true).length + this._parseFreeGiftMsg(html).length;\n\t}\n\n\t// there are some codes which don't increase item count only add msg that code with free gift is applied\n\t_parseFreeGiftMsg(html) {\n\t\treturn [...extractElement(this.FREE_GIFT_MSG_SELECTOR, html, true)]\n\t\t\t.map(el => el.textContent.match(this.FREE_GIFT_MSG_REGEX))\n\t\t\t.filter(Boolean);\n\t}\n\n\t_getProposedCoupons() {\n\t\treturn this._sendRequest('GET', this.PROPOSED_CODES_URL);\n\t}\n};\n\nexport default {\n\tname: 'Ylighting',\n\tdomain: 'ylighting.com',\n\tcompletionAction: completionActions.revisit,\n\tstackable: true,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cartempty'));\n\t},\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_PAGE_URL) && document.querySelector('.cart-content');\n\t},\n};\n","import DemandwareAJAXDriver from './_base';\nimport { completionActions } from '../../../utils';\n\nconst TOTAL_SELECTOR = '.checkoutminisummary .ordertotal .value, .ordertotalstable .ordertotal .value';\nconst CHECKOUT_INPUT_SELECTOR = '#dwfrm_billingcoupon_couponCode';\n\nconst isCheckout = () => Boolean(document.querySelector(CHECKOUT_INPUT_SELECTOR));\n\nconst isTotal = () => {\n\tconst total = document.querySelector(TOTAL_SELECTOR);\n\treturn total && document.querySelector(TOTAL_SELECTOR).innerText !== '$0.00';\n};\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ isValid implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = TOTAL_SELECTOR;\n\t\tthis.APPLIED_CODES_SELECTOR = '.coupon-applied-block li, .remove.promo-remove';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cartproductrow, .checkoutminisummary .summaryproduct';\n\t\tthis.isStackable = true;\n\n\t\tconst BASE_URL = 'https://www.yliving.com/on/demandware.store/Sites-YLiving-Site/default';\n\t\tthis.APPLY_CODE_URL = `${BASE_URL}/COBilling-ApplyCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_URL}/COBilling-RemoveCLI`;\n\t\tthis.UPDATE_REQUEST_URL = `${BASE_URL}/COOnePage-UpdateSummary`;\n\n\t\tthis.CART_PAGE_URL = window.location.href;\n\t\tthis.APPLY_CODE_PARAM_NAME = 'couponCode';\n\t\tthis.REMOVE_CODE_PARAM_NAME = 'coupon';\n\n\t\tthis.removeQueryParams = this.applyQueryParams;\n\n\t\tthis.APPLIED_CODE_REG = /Code Applied:(\\s|\\s\\()(\\w+)/i;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst checkoutInput = document.querySelector(CHECKOUT_INPUT_SELECTOR);\n\t\tlet codes = [];\n\t\tif (checkoutInput) {\n\t\t\tcodes = new Set(\n\t\t\t\t[...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(el => el.getAttribute('id')),\n\t\t\t);\n\t\t} else {\n\t\t\tcodes = new Set(\n\t\t\t\t[...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t\t\t.filter(el => el.innerText.match(this.APPLIED_CODE_REG))\n\t\t\t\t\t.map(el => el.innerText.match(this.APPLIED_CODE_REG)[2]),\n\t\t\t);\n\t\t}\n\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: 'YLiving',\n\tdomain: 'yliving.com',\n\tcompletionAction: completionActions.revisit,\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn (\n\t\t\tdocument.querySelector(`[name=\"dwfrm_cart_couponCode\"], ${CHECKOUT_INPUT_SELECTOR}`) &&\n\t\t\tisTotal() &&\n\t\t\t!isCheckout()\n\t\t);\n\t},\n\t// isCartEmpty() is not necessarily\n};\n"],"sourceRoot":""}