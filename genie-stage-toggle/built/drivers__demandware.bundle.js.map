{"version":3,"sources":["webpack:///./src/inject/drivers/base.js","webpack:///./src/inject/drivers/demandware/1800mattress.com.js","webpack:///./src/inject/drivers/demandware/_base.js","webpack:///./src/inject/drivers/demandware/apeainthepod.com.js","webpack:///./src/inject/drivers/demandware/ashleyfurniture.com.js","webpack:///./src/inject/drivers/demandware/bareminerals.com.js","webpack:///./src/inject/drivers/demandware/blu.com.js","webpack:///./src/inject/drivers/demandware/bowflex.com.js","webpack:///./src/inject/drivers/demandware/brooksbrothers.com.js","webpack:///./src/inject/drivers/demandware/brookstone.com.js","webpack:///./src/inject/drivers/demandware/callawayapparel.com.js","webpack:///./src/inject/drivers/demandware/campingworld.com.js","webpack:///./src/inject/drivers/demandware/coach.com.js","webpack:///./src/inject/drivers/demandware/cottonon.com.js","webpack:///./src/inject/drivers/demandware/crocs.com.js","webpack:///./src/inject/drivers/demandware/ctshirts.com.js","webpack:///./src/inject/drivers/demandware/cubavera.com.js","webpack:///./src/inject/drivers/demandware/dcshoes.com.js","webpack:///./src/inject/drivers/demandware/dickies.com.js","webpack:///./src/inject/drivers/demandware/dooney.com.js","webpack:///./src/inject/drivers/demandware/duluthtrading.com.js","webpack:///./src/inject/drivers/demandware/ems.com.js","webpack:///./src/inject/drivers/demandware/gamestop.com.js","webpack:///./src/inject/drivers/demandware/ganderoutdoors.com.js","webpack:///./src/inject/drivers/demandware/icing.com.js","webpack:///./src/inject/drivers/demandware/illy.com.js","webpack:///./src/inject/drivers/demandware/index.js","webpack:///./src/inject/drivers/demandware/joann.com.js","webpack:///./src/inject/drivers/demandware/juicycouturebeauty.com.js","webpack:///./src/inject/drivers/demandware/kennethcole.com.js","webpack:///./src/inject/drivers/demandware/lasenza.com.js","webpack:///./src/inject/drivers/demandware/legendarywhitetails.com.js","webpack:///./src/inject/drivers/demandware/luckybrand.com.js","webpack:///./src/inject/drivers/demandware/mattressfirm.com.js","webpack:///./src/inject/drivers/demandware/narscosmetics.com.js","webpack:///./src/inject/drivers/demandware/originalpenguin.com.js","webpack:///./src/inject/drivers/demandware/perryellis.com.js","webpack:///./src/inject/drivers/demandware/philosophy.com.js","webpack:///./src/inject/drivers/demandware/quiksilver.com.js","webpack:///./src/inject/drivers/demandware/roxy.com.js","webpack:///./src/inject/drivers/demandware/shoecarnival.com.js","webpack:///./src/inject/drivers/demandware/tatcha.com.js","webpack:///./src/inject/drivers/demandware/tervis.com.js","webpack:///./src/inject/drivers/demandware/thelimited.com.js","webpack:///./src/inject/drivers/demandware/toryburch.com.js"],"names":["toFloat","format","BaseDriver","watchForRestoreUserData","time","pauseInterval","interval","setInterval","currentState","checkRestoreDataCondition","clearInterval","bus","$emit","e","handleDriverError","source","storeUserData","domain","userData","getUserData","Promise","resolve","userDataKey","getUserDataStorageKey","storageRecord","storedTime","Date","now","backgroundMessaging","setDriverStorage","log","restoreUserData","maxStorageLifetime","driverStorage","getDriverStorage","deleteDriverStorage","setUserData","getStartPrice","startPrice","Number","MAX_SAFE_INTEGER","totalElementConfig","TOTAL_ELEMENT_CONFIG","selector","attribute","regex","totalElement","Array","isArray","forEach","elemSelector","document","querySelector","Error","value","getAttribute","textContent","pattern","group","match","beforeTestCodes","beforeCheckCodes","beforeApplyCodes","checkCodes","applyCodes","stackCodes","removeCodes","getMerchantCodes","getExistingCodes","codes","codeCount","getPreTaxShippingTotal","watchForCartUrl","previousState","checkCondition","completeExperience","completeExperiencePromisified","args","_promisify","beforeTestCodesPromisified","getStartPricePromisified","getMerchantCodesPromisified","getExistingCodesPromisified","removeCodesPromisified","beforeApplyCodesPromisified","applyCodesPromisified","beforeCheckCodesPromisified","checkCodesPromisified","stackCodesPromisified","method","then","apply","BASE_URL","Driver","DemandwareDriver","constructor","TOTAL_SELECTOR","name","stackable","isOnCartUrl","href","startsWith","elemToFloat","extractFormValues","extractElement","DOM","PRODUCT_ITEM_SELECTOR","CODES_ELEMENTS_SELECTOR","CODE_VALUE_SELECTOR","CART_FORM_SELECTOR","DEFAULT_REMOVE_CODE_VALUE","REMOVE_CODE_SELECTOR","REMOVE_VALUE_ATTRIBUTE","REQUEST_HEADERS","Accept","REQUEST_PARAMS","COUPON_PARAM_NAME","ADD_COUPON_PARAM_NAME","ADD_COUPON_PARAM_VALUE","REMOVE_COUPON_PARAM_VALUE","ERROR_MESSAGE_SELECTOR","isStackable","applyCode","_requestData","originalPrice","parseTotal","lastResponse","originalItemsCount","parseItemsCount","workingDiscounts","each","code","html","result","finalPrice","finalDiscount","freeGifts","isValid","_codeAppliedCheck","push","removeCode","_removeValueName","removeCodeHtml","map","discount","discounts","Set","querySelectorAll","element","innerText","trim","size","validationInfo","sort","a","b","currentPrice","currentDiscount","currentFreeGifts","successfulCodes","codesElements","matchingCodesElement","find","codesElement","manageCode","requestData","fetch","action","body","params","credentials","headers","response","text","set","removeValueName","length","data","completionAction","completionActions","revisit","isCartEmpty","TOKEN_SELECTOR","CART_EMPTY_SELECTOR","ITEM_LINK_SELECTOR","ITEM_QTY_SELECTOR","PROPOSED_CODES_SELECTOR","PROPOSED_CODES_REGEX","SHIPPING_SELECTOR","TAX_SELECTOR","EMPTY_CART_SELECTOR","CART_URL","sessionTimer","initialize","actionInterval","timeout","window","location","totalEl","isOnRightUrl","includes","el","filter","Boolean","_getCartSummary","shipping","tax","responseStatus","delay","status","_showDriverError","responseHTML","extraInfo","_parseItemsInfo","manageCodeStatus","manageCodeResponse","items","qty","csrfTokenElement","formValues","delete","cartContinueUrl","showDifferentDiscountMessage","isSinglePageApp","TO_CHECKOUT_BTN_SELECTOR","isOnCart","offsetParent","SHIPPING_DISCOUNT_SELECTOR","CART_ELEM_SELECTOR","CODE_INPUT_SELECTOR","REVIEW_STEP_SELECTOR","MERCHANT_CODE_SELECTOR","SPINER_SELECTOR","isCodeInput","onReviewStep","spiner","innerHTML","res","resHtml","total","shippingDiscount","toLowerCase","maxCoupons","extractData","MERCHANT_CODES_SELECTOR","codeInput","_getPage","elem","CODE_MESSAGE_SELECTOR","INPUT_CODE_SELECTOR","PRICES_SELECTOR","PRICE_SELECTOR","inputCode","codeMsg","isTotal","donationEl","_findElement","donation","parseFloat","taxes","targetString","targetEl","CHECKOUT_URL","CHECKOUT_FORM_SELECTOR","TOTAL_ELEM","isOnCartPage","isOnCheckoutPage","CODE_REGEX","_getCart","BASE_SITE_URL","CART_PAGE_URL","APPLIED_CODES_SELECTOR","CODES_REGEX","MERCHANTS_CODE_SELECTOR","SUBSCRIPTION_CODE_SELECTOR","PRODUCT_PROMO_SELECTOR","PRODUCT_PROMO_REGEX","subscriptionCode","fromProductDesc","taxElem","shippingElem","_findValueByLabel","additionalFreightElem","addFreight","totalShipping","string","nextElementSibling","url","CART_ACTION_SELECTOR","SIDEBAR_SELECTOR","SIDEBAR_BUTTON_SELECTOR","INPUT_FIELD_SELECTOR","popupEl","isOnPopupCart","isOnShippingUrl","isRightUrl","isInputField","getCheckoutPage","sessionStorage","setItem","requestUrl","openSideBar","click","removeItem","DOMAIN","ITEM_SELECTOR","applyData","URLSearchParams","removeData","CSRF_TOKEN_SELECTOR","isCartEmptyEl","toUpperCase","_getUpdatedCart","json","success","replace","isOriginalCaseCodes","CART_PAGE","CHARGES_REGEX","CHARGES_SELECTOR","checkoutURL","emptyCart","bodyData","updates","removeValueUuid","cartStr","summary","parentElement","reduce","charges","charge","codesObjects","cartPromos","couponItemPromos","i","codesObject","couponCode","uuid","from","cartEstimatedTotal","DemandwareAJAXDriver","history","pushState","state","title","split","SUMMARY_ITEMS_SELECTOR","TAX_VALUE_SELECTOR","SHIPPING_VALUE_SELECTOR","SHIPPING_WITH_DISCOUNT_SELECTOR","CART_ITEM_SELECTOR","item","replaceState","orderDiscount","taxValue","shippingValue","totalValue","pop","shippingDiscountEl","wait","browserUtils","SHOPPING_CART_URL","SUB_TOTAL_SELECTOR","CODE_ERROR_MESSAGE","MERCHANT_CODE_REGEX","iframeElem","createElement","src","Object","assign","style","display","documentElement","appendChild","getCodeElem","contentDocument","alt","applyCodeHtml","_checkInvalidCode","_getUpdatedPage","subTotal","BASE_REQUEST_URL","APPLY_CODE_URL","REMOVE_CODE_URL","CODE_ELEM_SELECTOR","REMOVE_VALUE_SELECTOR","IS_CART_EMPTY_SELECTOR","isOnRightURL","CSRF_TOKEN","removeQueryParams","applyQueryParams","_removeValue","responseJSON","error","removeCoderesponse","removeCodeResponse","currentCodes","_getExistingCodes","isCodesEqual","every","removeResponse","totals","discountsHtml","queryParams","toString","grandTotal","APPLIED_CODES_REGEX","_1800mattress","apeainthepod","ashleyfurniture","bareminerals","blu","bowflex","brooksbrothers","brookstone","callawayapparel","campingworld","coach","cottonon","crocs","ctshirts","cubavera","dcshoes","dickies","dooney","duluthtrading","ems","gamestop","ganderoutdoors","icing","illy","joann","juicycouturebeauty","kennethcole","lasenza","legendarywhitetails","luckybrand","mattressfirm","narscosmetics","originalpenguin","perryellis","philosophy","quiksilver","roxy","shoecarnival","tatcha","tervis","thelimited","toryburch","IS_PLUS_SUBDOMAIN","MERCHANTS_CODES_SELECTOR","EMPTY_CART_REGEX","SESSION_TIMEOUT","cartForm","isCart","responseText","retry","PROMO_SELECTOR","PROMO_REGEX","errorEl","PROMO_CODE_REGEX","toInt","PAYMENT_URL","EXISTING_CODE_SELECTOR","EXISTING_CODE_REGEXP","IS_ON_CART","codeSelector","inputElement","CART_COUPON_SELECTOR","CART_CONTAINER_SELECTOR","cartCouponEl","TypeError","orderSectionEl","pageSection","errorPayload","_manageCode","calculatedShipping","PRODUCT_ITEM_CHECKOUT_SELECTOR","MERCHANT_CODE_REGEXP","getCartPage","cartItems","extractElementFromHTML","INVALID_CODE_SELECTOR","MERCHANT_CODES_REGEX","INVALID_CODE_REGEX","mainPage","_getMainPage","itemPage","_getItemPage","promoPages","concat","_invalidCodeApplied","shippingElement","taxElement","_getApi","test","getCookie","VALUE_SELECTOR","INDEX_SELECTOR","PROMO_CODE_SELECTOR","shipToUs","couponCodeInput","readyState","individualMerchantCode","merchantCode","taxEl","shippingEl","DEMANDWARE_CART_URL","CURRENT_CART","CODES_SELECTOR","MERCHANT_CODES_REGEXP","_getHomePage","endPoint","EDIT_PAYMENT_URL","REVIEW_URL","IS_ON_PAYMENT","pathname","IS_ON_REVIEW","APPLY_BUTTON_SELECTOR","IS_ON_SHIPPING_PAYMENT","some","str","APPLY_URL","REMOVE_URL","BILLING_ADDRESS_SELECTOR","SHIPPING_ADDRESS_SELECTOR","SPINNER_ONE_SELECTOR","SPINNER_TWO_SELECTOR","REMOVE_BUTTON_SELECTOR","MODAL_SELECTOR","PROMO_ITEM_ELEMENT","isForm","spinnerElementOne","spinnerElementTwo","isSpinnerOneActive","isSinnerTwoActive","isModalActive","isSippingFieldsOpen","itemElements","itemElemCount","_continueUrl","MANAGE_CODE_URL","EXISTING_CODES_SELECTOR","CODE_UUID_SELECTOR","onCart","csrfToken","csrf_token","_getUUID","accept","mode","errorMessage","getCode","DOMAIN_CART_URL","DONATION_SELECTOR","cur","prev"],"mappings":"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","file":"drivers__demandware.bundle.js","sourcesContent":["import bus from '../bus';\nimport { log, format } from '../../utils';\nimport { backgroundMessaging, handleDriverError } from '../lib';\n\nconst { toFloat } = format;\n\nexport default class BaseDriver {\n\t/**\n\t * @function watchForRestoreUserData - set up a listener to check user data restorement\n\t * @emits bus#RestoreUserData - the event that indicates to the app\tthat user data could be restored\n\t */\n\twatchForRestoreUserData(time = 500) {\n\t\tlet pauseInterval = false;\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tconst currentState = await this.checkRestoreDataCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t\tif (currentState) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tbus.$emit('restore-user-data');\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkRestoreDataCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t}\n\t\t}, time);\n\n\t\treturn interval;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * @function storeUserData\n\t * @param {String} domain - domain to set the driver storage\n\t * @returns {Promise}\n\t */\n\tasync storeUserData(domain) {\n\t\tconst userData = await this.getUserData();\n\n\t\tif (userData === null) {\n\t\t\t// Nothing to store\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst storageRecord = {\n\t\t\tuserData,\n\t\t\tstoredTime: Date.now(),\n\t\t};\n\t\tbackgroundMessaging.setDriverStorage(userDataKey, storageRecord);\n\t\tlog('Stored user data: %O', storageRecord);\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function restoreUserData\n\t * @param {String} domain - domain to access the driver storage\n\t * @param {Number} [maxStorageLifetime] - optional, the lifetime of the stored data (default 10 mins)\n\t * @returns {Promise}\n\t */\n\tasync restoreUserData(domain, maxStorageLifetime = 600000) {\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(userDataKey);\n\n\t\tif (driverStorage) {\n\t\t\tconst { storedTime, userData } = driverStorage;\n\t\t\t// Clear stored user data\n\t\t\tbackgroundMessaging.deleteDriverStorage(userDataKey);\n\n\t\t\tif (Date.now() - storedTime <= maxStorageLifetime) {\n\t\t\t\tlog('Restore user data: %O', userData);\n\t\t\t\treturn this.setUserData(userData);\n\t\t\t}\n\t\t\tlog('User data is outdated, skip restoring');\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserData - get user data which should be stored\n\t * @returns {Object} - object with required user data which should be restored\n\t */\n\tgetUserData() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function setUserData - restore user data on page\n\t * @param {Object} userData - data which was saved and should be restored\n\t * @returns {Promise}\n\t */\n\tsetUserData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserDataStorageKey - unique key for storing user data per merchant\n\t * @returns {String}\n\t */\n\tgetUserDataStorageKey(domain) {\n\t\t// Append `_userData` to avoid possible conflicts with created storage from driver\n\t\treturn `${domain}_userData`;\n\t}\n\n\t/**\n\t * Parses start price from page\n\t *\n\t * @function getStartPrice\n\t * @returns {Promise<Number>|Number} - the total from the page\n\t */\n\tgetStartPrice() {\n\t\tlet startPrice = Number.MAX_SAFE_INTEGER;\n\t\tconst totalElementConfig = this.TOTAL_ELEMENT_CONFIG;\n\t\tif (totalElementConfig) {\n\t\t\tconst { selector, attribute, regex } = totalElementConfig;\n\t\t\tlet totalElement;\n\t\t\t// handle case, when there is array of selectors and we try to take totalElement using these selectors in turn\n\t\t\t// for example dell.com, hertz.com\n\t\t\tif (Array.isArray(selector)) {\n\t\t\t\tselector.forEach(elemSelector => {\n\t\t\t\t\tif (!totalElement) {\n\t\t\t\t\t\ttotalElement = document.querySelector(elemSelector);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\ttotalElement = document.querySelector(selector);\n\t\t\t} else {\n\t\t\t\thandleDriverError(\n\t\t\t\t\tnew Error(`Total selector type mismatch. Expected string | array, got ${typeof selector}`),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (totalElement) {\n\t\t\t\tlet value = attribute ? totalElement.getAttribute(attribute) : totalElement.textContent;\n\n\t\t\t\tif (value && regex) {\n\t\t\t\t\t// Set pattern to null to receive error in case pattern was not defined\n\t\t\t\t\t// otherwise we may silently return undefined or empty string\n\t\t\t\t\tconst { pattern = null, group = 0 } = regex;\n\t\t\t\t\tvalue = value.match(pattern)[group];\n\t\t\t\t}\n\t\t\t\tstartPrice = toFloat(value);\n\t\t\t}\n\t\t}\n\t\treturn startPrice;\n\t}\n\n\t/**\n\t * Perform any needed actions and setup to start codes testing\n\t *\n\t * @function beforeTestCodes\n\t *\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @typedef {Object} OriginalData\n\t * @property {Number} originalPrice the starting price for the cart\n\t * @property {Number} originalItemsCount the starting items count of the cart\n\t */\n\t/**\n\t * Perform any needed actions and setup before `checkCodes()` will be executed\n\t *\n\t * @function beforeCheckCodes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tbeforeCheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Perform any needed actions and setup before `applyCodes()` will be executed\n\t *\n\t * @function beforeApplyCodes\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function checkCodes\n\t *\n\t * @param {String[]} codes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise}\n\t */\n\tcheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes each code in @param codes and actually applies it to the cart,\n\t * typically through a fetch(...) call.\n\t *\n\t * @function applyCodes\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tapplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function stackCodes\n\t *\n\t * @param {Object} validationInfo - contains all required info passed by `checkCodes()` for codes stacking\n\t * @param {String[]} validationInfo.codes\n\t * @param {Float} [validationInfo.originalPrice]\n\t * @param {Object[]} [validationInfo.discounts] - contains all codes mapped with their discounts\n\t * @returns {Promise}\n\t */\n\tstackCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function removeCodes\n\t *\n\t * @param {String[]} codes - passed in case the driver needs to know specific codes to do removal\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request response) which are available and were not applied by user\n\t *\n\t * @function getMerchantCodes\n\t * @returns {String[]} - codes from merhcant page (or request response if possible)\n\t */\n\tgetMerchantCodes() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request) which are available and were applied by user\n\t *\n\t * @typedef {Object} ExistingCodeInfo\n\t * @prop {String[]} codes - list of codes which had been applied, if discoverable\n\t * @prop {Number} codeCount - the number of codes that were applied to the cart\n\t */\n\t/**\n\t * @function getExistingCodes\n\t * @returns {ExistingCodeInfo}\n\t */\n\tgetExistingCodes() {\n\t\treturn {\n\t\t\tcodes: [],\n\t\t\tcodeCount: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Parses pre tax and shipping total from page or request's response\n\t *\n\t * @function getPreTaxShippingTotal\n\t * @returns {Promise<Number>|Number} - the total without tax and shipping\n\t */\n\tgetPreTaxShippingTotal() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function watchForCartUrl - optional function to set up a listener for url changes on SPAs\n\t * @emits bus#CartActive - the event (using the string 'cart-active') that indicates to the app that test codes button should be shown\n\t * @emits bus#CartInactive - the event (using the string 'cart-inactive') that indicates to the app that test codes button should be hidden\n\t */\n\twatchForCartUrl(time = 500) {\n\t\tlet previousState = null;\n\t\tlet pauseInterval = false;\n\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\tlet currentState = null;\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tcurrentState = await this.checkCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t\tif (currentState !== previousState) {\n\t\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t\t}\n\t\t\t\tpreviousState = currentState;\n\t\t\t}\n\t\t}, time);\n\t\t// return the interval to stop it in `watchForCartUrl` if needed from outside\n\t\treturn interval;\n\t}\n\n\t/**\n\t * @function checkCondition - optional function to check for conditions on SPAs\n\t * @returns {Boolean}\n\t */\n\tcheckCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Perform custom completion action on Continue to Checkout button\n\t * Takes best codes in @param codes\n\t *\n\t * @function completeExperience\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tcompleteExperience() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function completeExperiencePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcompleteExperiencePromisified(...args) {\n\t\treturn this._promisify(this.completeExperience, args);\n\t}\n\n\t/**\n\t * @function beforeCodesTestingPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeTestCodes, args);\n\t}\n\n\t/**\n\t * @function getStartPricePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetStartPricePromisified() {\n\t\treturn this._promisify(this.getStartPrice);\n\t}\n\n\t/**\n\t * @function getMerchantCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetMerchantCodesPromisified(...args) {\n\t\treturn this._promisify(this.getMerchantCodes, args);\n\t}\n\n\t/**\n\t * @function getExistingCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetExistingCodesPromisified(...args) {\n\t\treturn this._promisify(this.getExistingCodes, args);\n\t}\n\n\t/**\n\t * @function removeCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tremoveCodesPromisified(...args) {\n\t\treturn this._promisify(this.removeCodes, args);\n\t}\n\n\t/**\n\t * @function beforeApplyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeApplyCodes, args);\n\t}\n\n\t/**\n\t * @function applyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tapplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.applyCodes, args);\n\t}\n\n\t/**\n\t * @function beforeCheckCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeCheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeCheckCodes, args);\n\t}\n\n\t/**\n\t * @function checkCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.checkCodes, args);\n\t}\n\n\t/**\n\t * @function stackCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tstackCodesPromisified(...args) {\n\t\treturn this._promisify(this.stackCodes, args);\n\t}\n\n\t/**\n\t * @function _promisify - promisifies given method and return it's result as a Promise\n\t * @returns {Promise}\n\t */\n\t_promisify(method, args) {\n\t\treturn Promise.resolve().then(() => method.apply(this, args));\n\t}\n}\n","import DemandwareDriver from './_base';\n\nconst BASE_URL = 'https://www.1800mattress.com';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t}\n};\n\nexport default {\n\tname: '1800Mattress',\n\tdomain: '1800mattress.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith(`${BASE_URL}/cart`) ||\n\t\t\thref.startsWith(`${BASE_URL}/on/demandware.store/Sites-1800Mattress-RV-Site/default/Cart-SubmitForm`)\n\t\t);\n\t},\n};\n","import Promise from 'bluebird';\nimport BaseDriver from '../base';\nimport bus from '../../bus';\nimport { DOM, format, log } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractFormValues, extractElement } = DOM;\n\nexport default class DemandwareDriver extends BaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total td:last-child';\n\t\tthis.PRODUCT_ITEM_SELECTOR = null;\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.rowcoupons';\n\t\tthis.CODE_VALUE_SELECTOR = '.cartcoupon .value';\n\t\tthis.CART_FORM_SELECTOR = '#cart-items-form';\n\n\t\tthis.DEFAULT_REMOVE_CODE_VALUE = 'dwfrm_cart_coupons_i0_deleteCoupon';\n\t\tthis.REMOVE_CODE_SELECTOR = '[name*=\"_deleteCoupon\"]';\n\t\tthis.REMOVE_VALUE_ATTRIBUTE = 'name';\n\n\t\tthis.REQUEST_HEADERS = {\n\t\t\tAccept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t};\n\t\tthis.REQUEST_PARAMS = {\n\t\t\tCOUPON_PARAM_NAME: 'dwfrm_cart_couponCode',\n\t\t\tADD_COUPON_PARAM_NAME: 'dwfrm_cart_addCoupon',\n\t\t\tADD_COUPON_PARAM_VALUE: 'dwfrm_cart_addCoupon',\n\t\t\tREMOVE_COUPON_PARAM_VALUE: 'Remove',\n\t\t};\n\t\tthis.ERROR_MESSAGE_SELECTOR = null;\n\t\tthis.isStackable = true;\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this.isStackable ? Promise.resolve() : this.applyCode(codes[0], this._requestData());\n\t}\n\n\tcheckCodes(codes) {\n\t\tconst originalPrice = this.parseTotal(this.lastResponse);\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst originalItemsCount = this.parseItemsCount(this.lastResponse);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code, this._requestData()).then(html => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\t\t\t\tif (this._codeAppliedCheck(html)) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tthis.lastResponse = html;\n\t\t\t\tresult.finalPrice = this.parseTotal(html);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\t\t\t\tresult.isValid = true;\n\n\t\t\t\tif (\n\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\n\t\t\t\treturn this.removeCode(this._removeValueName(code), this._requestData()).then(removeCodeHtml => {\n\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t\toriginalItemsCount,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.lastResponse = null;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(element => element.innerText.trim()),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.removeCode(this._removeValueName(code), this._requestData()).then(html => {\n\t\t\t\tthis.lastResponse = html;\n\t\t\t\treturn Promise.resolve();\n\t\t\t}),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice, originalItemsCount } = validationInfo;\n\n\t\t// Sort by discount\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code, this._requestData()).then(html => {\n\t\t\t\tthis.lastResponse = html;\n\t\t\t\tconst finalPrice = this.parseTotal(html);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t\tfreeGifts,\n\t\t\t\t});\n\t\t\t\tif (\n\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(this._removeValueName(discount.code), this._requestData()).then(\n\t\t\t\t\tremoveCodeHtml => {\n\t\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\t_requestData() {\n\t\treturn extractFormValues(this.CART_FORM_SELECTOR, this.lastResponse);\n\t}\n\n\t_removeValueName(code) {\n\t\tconst codesElements = extractElement(this.CODES_ELEMENTS_SELECTOR, this.lastResponse, true);\n\t\tconst matchingCodesElement = [...codesElements].find(element => {\n\t\t\tconst codesElement = element.querySelector(this.CODE_VALUE_SELECTOR);\n\t\t\treturn codesElement && codesElement.innerText.trim() === code;\n\t\t});\n\n\t\treturn matchingCodesElement\n\t\t\t? matchingCodesElement.querySelector(this.REMOVE_CODE_SELECTOR).getAttribute(this.REMOVE_VALUE_ATTRIBUTE)\n\t\t\t: this.DEFAULT_REMOVE_CODE_VALUE;\n\t}\n\n\tmanageCode(requestData) {\n\t\treturn fetch(requestData.action, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: requestData.params,\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.REQUEST_HEADERS,\n\t\t}).then(response => response.text());\n\t}\n\n\tapplyCode(code, requestData) {\n\t\trequestData.params.set(this.REQUEST_PARAMS.COUPON_PARAM_NAME, code);\n\t\trequestData.params.set(this.REQUEST_PARAMS.ADD_COUPON_PARAM_NAME, this.REQUEST_PARAMS.ADD_COUPON_PARAM_VALUE);\n\t\treturn this.manageCode(requestData);\n\t}\n\n\tremoveCode(removeValueName, requestData) {\n\t\trequestData.params.set(removeValueName, this.REQUEST_PARAMS.REMOVE_COUPON_PARAM_VALUE);\n\t\treturn this.manageCode(requestData);\n\t}\n\n\tparseTotal(html) {\n\t\tconst totalElement = extractElement(this.TOTAL_SELECTOR, html);\n\t\treturn elemToFloat(totalElement);\n\t}\n\n\tparseItemsCount(html) {\n\t\treturn this.PRODUCT_ITEM_SELECTOR ? extractElement(this.PRODUCT_ITEM_SELECTOR, html, true).length : 0;\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\treturn this.ERROR_MESSAGE_SELECTOR ? extractElement(this.ERROR_MESSAGE_SELECTOR, data) : false;\n\t}\n}\n","import DemandwareDriver from './_base';\nimport { completionActions } from '../../../utils';\n/*\nBehavior description:\n- can get existing codes;\n- can remove codes;\n- valid code can't be replaced with another valid code;\n- can't apply multiple codes (not stackable);\n- code testing may be run only on 'Cart' page;\n======== Special case ========\nwe have code input on billing page but we can't apply code manually \nbecause the behavior of the site will clear all of the user's data\nso we don't support billing page\n*/\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t}\n};\n\nexport default {\n\tname: 'A Pea In The Pod',\n\tdomain: 'apeainthepod.com',\n\tstackable: true,\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\t(href.startsWith('https://www.apeainthepod.com/cart') ||\n\t\t\t\thref.startsWith(\n\t\t\t\t\t'https://www.apeainthepod.com/on/demandware.store/Sites-pea-us-Site/default/Cart-AddToWishlist',\n\t\t\t\t)) &&\n\t\t\tdocument.querySelector('#dwfrm_cart_couponCode')\n\t\t);\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareDriver from './_base';\nimport bus from '../../bus';\nimport { DOM, format, log } from '../../../utils';\nimport { handleDriverError, sessionTimer } from '../../lib';\n\nconst { extractFormValues, extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n+ session timer: 20 min\n+ if during testing Cart becomes empty send error to the Sentry for further investigation\n*/\n\nconst BASE_URL = 'https://www.ashleyfurniture.com';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.TOTAL_ELEMENT_CONFIG = { selector: this.TOTAL_SELECTOR };\n\t\tthis.TOKEN_SELECTOR = '[name=\"csrf_token\"]';\n\t\tthis.CODE_VALUE_SELECTOR = '.cartcoupon .coupon-code';\n\t\tthis.CART_FORM_SELECTOR = '#cart-items-form';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.line-item-wrapper:not(.visually-hidden)';\n\t\tthis.CART_EMPTY_SELECTOR = '.cart-empty';\n\t\tthis.ITEM_LINK_SELECTOR = '.line-item-wrapper .name  a';\n\t\tthis.ITEM_QTY_SELECTOR = '.line-item-wrapper .item-quantity [selected]';\n\n\t\tthis.PROPOSED_CODES_SELECTOR = '.header-promo-container .trisectional-banner-inner';\n\t\tthis.PROPOSED_CODES_REGEX = /code: (\\w+)/i;\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax-value';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty';\n\n\t\tthis.CART_URL = `${BASE_URL}/cart`;\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 20,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst totalEl = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst isOnRightUrl =\n\t\t\thref.startsWith(this.CART_URL) ||\n\t\t\t(href.startsWith(BASE_URL) && href.includes('/Cart-SubmitForm')) ||\n\t\t\thref.startsWith(`${BASE_URL}/check-out`);\n\n\t\treturn !isCartEmpty && isOnRightUrl && totalEl && !totalEl.textContent.includes('N/A');\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.PROPOSED_CODES_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.PROPOSED_CODES_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getCartSummary().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response));\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response));\n\t\t\treturn this.parseTotal(response) - (shipping || 0) - (tax || 0);\n\t\t});\n\t}\n\n\tmanageCode(requestData) {\n\t\tlet responseStatus = null;\n\t\treturn Promise.delay(1000).then(() =>\n\t\t\tfetch(requestData.action, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: requestData.params,\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: this.REQUEST_HEADERS,\n\t\t\t})\n\t\t\t\t.then(response => {\n\t\t\t\t\tresponseStatus = response.status;\n\t\t\t\t\treturn response.text();\n\t\t\t\t})\n\t\t\t\t.then(response => {\n\t\t\t\t\tif (!this.parseItemsCount(response)) {\n\t\t\t\t\t\treturn this._showDriverError(responseStatus, response, requestData.params).then(() => null);\n\t\t\t\t\t}\n\t\t\t\t\treturn response;\n\t\t\t\t}),\n\t\t);\n\t}\n\n\t_showDriverError(status, response, body) {\n\t\treturn this._getCartSummary().then(responseHTML => {\n\t\t\tif (extractElement(this.CART_EMPTY_SELECTOR, responseHTML)) {\n\t\t\t\tconst extraInfo = {\n\t\t\t\t\t...this._parseItemsInfo(),\n\t\t\t\t\tmanageCodeStatus: status,\n\t\t\t\t\tmanageCodeResponse: response,\n\t\t\t\t\tbody,\n\t\t\t\t};\n\t\t\t\thandleDriverError(new Error('Cart is empty'), extraInfo);\n\t\t\t}\n\t\t});\n\t}\n\n\t_parseItemsInfo() {\n\t\treturn {\n\t\t\titems: [...document.querySelectorAll(this.PRODUCT_ITEM_SELECTOR)].map(el => {\n\t\t\t\treturn {\n\t\t\t\t\thref: el.querySelector(this.ITEM_LINK_SELECTOR).getAttribute('href'),\n\t\t\t\t\tqty: el.querySelector(this.ITEM_QTY_SELECTOR).getAttribute('value'),\n\t\t\t\t};\n\t\t\t}),\n\t\t};\n\t}\n\n\t_getCartSummary() {\n\t\treturn fetch(this.CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t}).then(response => response.text());\n\t}\n\n\t_requestData() {\n\t\t// Token is not present in the form, need to add it manually to use template\n\t\tconst csrfTokenElement = extractElement(this.TOKEN_SELECTOR, this.lastResponse);\n\t\tconst formValues = extractFormValues(this.CART_FORM_SELECTOR, this.lastResponse);\n\t\tformValues.params.set('csrf_token', csrfTokenElement.value);\n\t\tformValues.params.set('dwfrm_cart_updateCart', 'dwfrm_cart_updateCart');\n\t\tformValues.params.delete('inventory');\n\t\treturn formValues;\n\t}\n\n\tcheckCodes(codes) {\n\t\tconst originalPrice = this.parseTotal(this.lastResponse);\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst originalItemsCount = this.parseItemsCount(this.lastResponse);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code, this._requestData())\n\t\t\t\t.then(() => this._getCartSummary())\n\t\t\t\t.then(html => {\n\t\t\t\t\tconst result = {\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\t\tisValid: true,\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.lastResponse = html;\n\t\t\t\t\tresult.finalPrice = this.parseTotal(html);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\t\t\t\t\tresult.isValid = originalPrice > result.finalPrice;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(this._removeValueName(code), this._requestData())\n\t\t\t\t\t\t.then(() => this._getCartSummary())\n\t\t\t\t\t\t.then(removeCodeHtml => {\n\t\t\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t\t});\n\t\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t\toriginalItemsCount,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice, originalItemsCount } = validationInfo;\n\n\t\t// Sort by discount\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code, this._requestData())\n\t\t\t\t.then(() => this._getCartSummary())\n\t\t\t\t.then(html => {\n\t\t\t\t\tthis.lastResponse = html;\n\t\t\t\t\tconst finalPrice = this.parseTotal(html);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\tfreeGifts,\n\t\t\t\t\t});\n\t\t\t\t\tif (\n\t\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t\t) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this.removeCode(this._removeValueName(discount.code), this._requestData())\n\t\t\t\t\t\t.then(() => this._getCartSummary())\n\t\t\t\t\t\t.then(removeCodeHtml => {\n\t\t\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.removeCode(this._removeValueName(code), this._requestData())\n\t\t\t\t.then(() => this._getCartSummary())\n\t\t\t\t.then(html => {\n\t\t\t\t\tthis.lastResponse = html;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Ashley Homestore',\n\tdomain: 'ashleyfurniture.com',\n\tstackable: true,\n\tDriver,\n\tcartContinueUrl: `${BASE_URL}/cart`,\n\tshowDifferentDiscountMessage: true,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport DemandwareDriver from './_base';\nimport bus from '../../bus';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works:\n    - Cart page\n\t- Checkout page (Review & Complete)\n\t\tcan be with 2 URLs - one of them is similiar to cart URL\n\n+ Is driver SPA yes\n    - Code input field\n    - Not empty\n    - On the cart or on the right step of the checkout\n\n+ Gather codes on site pages: no\n+ Special case about the driver works (if it needed).\n    - maxCoupons 5 to avoid blocking\n*/\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tconst TO_CHECKOUT_BTN_SELECTOR = '.checkoutButton button[value=\"Checkout\"]';\n\t\tthis.isOnCart = () => (document.querySelector(TO_CHECKOUT_BTN_SELECTOR) || {}).offsetParent;\n\t\tthis.TOTAL_SELECTOR = '.order-value';\n\t\tthis.SHIPPING_SELECTOR = '.shipping-method-price';\n\t\tthis.TAX_SELECTOR = '.tax-estimate-values';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount > td:last-child';\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.coupon-code-item';\n\t\tthis.CODE_VALUE_SELECTOR = '#applied-coupon-code';\n\n\t\tthis.REQUEST_HEADERS = {\n\t\t\t'content-type': 'application/x-www-form-urlencoded; charset=UTF-8',\n\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t};\n\n\t\tthis.CART_FORM_SELECTOR = '.coupon-form';\n\t\tthis.CART_ELEM_SELECTOR = '#shoprunnerCartContainer';\n\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-row';\n\n\t\tthis.CART_EMPTY_SELECTOR = '.cart-empty';\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.REVIEW_STEP_SELECTOR = '.step-3.active.selected';\n\t\tthis.MERCHANT_CODE_SELECTOR = '.bx-click-to-copy > span';\n\t\tthis.SPINER_SELECTOR = '.loading';\n\t}\n\n\tcheckCondition() {\n\t\tconst isCartEmpty = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\tconst isCodeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isOnCart = document.querySelector(this.CART_ELEM_SELECTOR);\n\t\tconst onReviewStep = document.querySelector(this.REVIEW_STEP_SELECTOR);\n\t\tconst spiner = document.querySelector(this.SPINER_SELECTOR);\n\t\treturn !spiner && isCodeInput && ((!isCartEmpty && isOnCart) || onReviewStep);\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.DEFAULT_REMOVE_CODE_VALUE = this.isOnCart()\n\t\t\t? 'dwfrm_cart_coupons_i0_deleteCoupon'\n\t\t\t: 'dwfrm_singlepagecheckout_coupons_i0_deleteCoupon';\n\t\tthis.REQUEST_PARAMS = {\n\t\t\tCOUPON_PARAM_NAME: 'dwfrm_cart_couponCode',\n\t\t\tADD_COUPON_PARAM_NAME: 'dwfrm_cart_addCoupon',\n\t\t\tADD_COUPON_PARAM_VALUE: 'dwfrm_cart_addCoupon',\n\t\t\tREMOVE_COUPON_PARAM_VALUE: this.isOnCart() ? 'dwfrm_cart_addCoupon' : 'dwfrm_singlepagecheckout_addCoupon',\n\t\t};\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [\n\t\t\t...new Set(\n\t\t\t\t[...document.querySelectorAll(this.MERCHANT_CODE_SELECTOR)]\n\t\t\t\t\t.map(el => el.innerHTML.trim())\n\t\t\t\t\t.filter(Boolean),\n\t\t\t),\n\t\t];\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODE_VALUE_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(element => element.getAttribute('value'));\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice, originalItemsCount } = validationInfo;\n\n\t\t// Sort by discount\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code, this._requestData()).then(html => {\n\t\t\t\tthis.lastResponse = html;\n\t\t\t\tconst finalPrice = this.parseTotal(html);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t\tfreeGifts,\n\t\t\t\t});\n\t\t\t\tif (\n\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(this._removeValueName(discount.code), this._requestData()).then(\n\t\t\t\t\tPromise.each(successfulCodes, code => this.applyCode(code, this._requestData())),\n\t\t\t\t);\n\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tmanageCode(requestData) {\n\t\trequestData.params.set('format', 'ajax');\n\t\treturn super.manageCode(requestData);\n\t}\n\n\tremoveCode(removeValueName, requestData) {\n\t\trequestData.params.delete('dwfrm_cart_addCoupon');\n\t\trequestData.params.delete('dwfrm_singlepagecheckout_addCoupon');\n\t\treturn super.removeCode(removeValueName, requestData);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn fetch('https://www.bareminerals.com/on/demandware.store/Sites-BareMinerals_US_CA-Site/en_US/Cart-Show', {\n\t\t\tmethod: 'GET',\n\t\t})\n\t\t\t.then(res => res.text())\n\t\t\t.then(resHtml => {\n\t\t\t\tconst total = this.parseTotal(resHtml);\n\t\t\t\tconst shippingDiscount = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, resHtml)\n\t\t\t\t\t? elemToFloat(extractElement(this.SHIPPING_DISCOUNT_SELECTOR, resHtml))\n\t\t\t\t\t: 0;\n\t\t\t\tconst shipping =\n\t\t\t\t\textractElement(this.SHIPPING_SELECTOR, resHtml)\n\t\t\t\t\t\t.innerText.toLowerCase()\n\t\t\t\t\t\t.trim() === 'free'\n\t\t\t\t\t\t? 0\n\t\t\t\t\t\t: elemToFloat(extractElement(this.SHIPPING_SELECTOR, resHtml));\n\t\t\t\tconst tax = extractElement(this.TAX_SELECTOR, resHtml)\n\t\t\t\t\t? elemToFloat(extractElement(this.TAX_SELECTOR, resHtml))\n\t\t\t\t\t: 0;\n\t\t\t\treturn total - tax - (shipping - shippingDiscount);\n\t\t\t});\n\t}\n};\n\nexport default {\n\tname: 'bareMinerals',\n\tdomain: 'bareminerals.com',\n\tmaxCoupons: 5, // server block us if we do many requests\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import DemandwareDriver from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst { toFloat } = format;\nconst { extractData, extractFormValues, extractElement } = DOM;\n\n/*\nBehavior description:\n- can get existing codes;\n- can remove codes;\n- valid code can't be replaced with another valid code;\n- can apply multiple codes (stackable);\n- code testing may be run on 'Cart' page;\n\n- tax does not add to the total price on the cart page,\n- but when a user  goes  after cart to the checkout page and\n- comes again to cart page tax will be added to the total price\n*/\n\nconst BASE_URL = 'https://www.blu.com';\nconst CART_URL = `${BASE_URL}/en/US/cart`;\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_EMPTY_SELECTOR = '.cart-empty';\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.ERROR_MESSAGE_SELECTOR = '#add-coupon+.error';\n\t\tthis.MERCHANT_CODES_SELECTOR = '[data-testid=\"desktop-banner-section-body\"] p strong';\n\t}\n\n\tcheckCondition() {\n\t\tconst isOnRightUrl = window.location.href.includes(CART_URL);\n\t\tconst isCartEmpty = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\treturn isOnRightUrl && !isCartEmpty && codeInput;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getPage().then(responseHTML => {\n\t\t\treturn [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...extractElement(this.MERCHANT_CODES_SELECTOR, responseHTML, true)]\n\t\t\t\t\t\t.map(elem => elem.textContent.trim())\n\t\t\t\t\t\t.filter(Boolean),\n\t\t\t\t),\n\t\t\t];\n\t\t});\n\t}\n\n\t// need to do this to get original price\n\tbeforeCheckCodes() {\n\t\treturn this.applyCode('fake_code', this._requestData()).then(response => {\n\t\t\tthis.lastResponse = response;\n\t\t});\n\t}\n\n\t_requestData() {\n\t\tconst formValues = extractFormValues(this.CART_FORM_SELECTOR, this.lastResponse);\n\t\tif (formValues) {\n\t\t\tthis.requestData = formValues;\n\t\t} else {\n\t\t\t// If last response doesn't contain form,\n\t\t\t// parse current document\n\t\t\tthis.requestData = extractFormValues(this.CART_FORM_SELECTOR, null);\n\t\t}\n\t\treturn this.requestData;\n\t}\n\n\t_removeValueName(code) {\n\t\tconst codesElements = extractElement(this.CODES_ELEMENTS_SELECTOR, this.lastResponse, true);\n\t\tconst matchingCodesElement = [...codesElements].find(element => {\n\t\t\tconst codesElement = element.querySelector(this.CODE_VALUE_SELECTOR);\n\t\t\treturn codesElement && codesElement.innerText.toLowerCase().trim() === code.toLowerCase();\n\t\t});\n\t\treturn matchingCodesElement\n\t\t\t? matchingCodesElement.querySelector(this.REMOVE_CODE_SELECTOR).getAttribute(this.REMOVE_VALUE_ATTRIBUTE)\n\t\t\t: this.DEFAULT_REMOVE_CODE_VALUE;\n\t}\n\n\t_getPage() {\n\t\treturn fetch(BASE_URL).then(response => response.text());\n\t}\n\n\tparseTotal(html) {\n\t\treturn toFloat(extractData(this.TOTAL_SELECTOR, html));\n\t}\n};\n\nexport default {\n\tname: 'Blu',\n\tdomain: 'blu.com',\n\tisSinglePageApp: true,\n\tmaxCoupons: 10, // site is slow\n\tcartContinueUrl: CART_URL, // after removing code manually URL address is changed so we need change URL\n\tstackable: true,\n\tDriver,\n};\n","import DemandwareDriver from './_base';\nimport completionActions from '../../../utils/completion-actions';\n\n/* BEHAVIOUR\n * Can apply code only on cart page\n * One to one with base driver\n */\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = false;\n\t}\n};\n\nexport default {\n\tname: 'Bowflex',\n\tdomain: 'bowflex.com',\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.bowflex.com/cart') && document.querySelector('#dwfrm_cart_couponCode');\n\t},\n};\n","import DemandwareDriver from './_base';\nimport { DOM, completionActions, format } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/**\n * Driver behavior description:\n -    Existing code: yes\n -    Remove code: yes\n -    Stackable: no\n -    Free gift support: no\n -    ‘isValid’ implemented: no\n -    Valid code can be replaced with another valid code: no\n -    Manually apply code: no\n -\t  sessionTimer 15 min\n - \t  code testing may be run on 'Cart' page;\n =========Special case=========\n If u come on checkout step choose city with paid shipping and tax then coming back to cart price will include tax, but responses will not include. \n So in this case original price in extension will shown without tax and shipping and discount will shown correct.\n */\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .price-value';\n\t\tthis.CODE_MESSAGE_SELECTOR = '.code-message';\n\t\tthis.INPUT_CODE_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.CODE_VALUE_SELECTOR = '.code-applied .code-number';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping .price-value';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax';\n\t\tthis.PRICES_SELECTOR = '.order-subtotal';\n\t\tthis.PRICE_SELECTOR = '.price-value';\n\n\t\tthis.isStackable = false;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst inputCode = document.querySelector(this.INPUT_CODE_SELECTOR);\n\t\tconst codeMsg = document.querySelector(this.CODE_MESSAGE_SELECTOR);\n\t\tconst total = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst isTotal = total && total.offsetParent;\n\t\tconst currentState = (inputCode || codeMsg) && isTotal;\n\t\treturn currentState;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.CODE_VALUE_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(element => element.textContent.trim());\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tasync beforeTestCodes() {\n\t\tthis.lastResponse = await this._getPage();\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getPage().then(responseHTML => {\n\t\t\tconst total = this.parseTotal(responseHTML);\n\t\t\tconst donationEl = this._findElement('Donation', responseHTML);\n\t\t\tconst donation = donationEl ? elemToFloat(donationEl) || 0 : 0;\n\t\t\tconst shipping = parseFloat(extractElement(this.SHIPPING_SELECTOR, responseHTML).textContent || 0) || 0;\n\t\t\tconst taxes = elemToFloat(extractElement(this.TAX_SELECTOR, responseHTML) || 0) || 0;\n\t\t\treturn total - donation - shipping - taxes;\n\t\t});\n\t}\n\n\t_findElement(targetString, response) {\n\t\tconst targetEl = [...extractElement(this.PRICES_SELECTOR, response, true)].find(el =>\n\t\t\tel.textContent.includes(targetString),\n\t\t);\n\t\treturn targetEl ? targetEl.querySelector(this.PRICE_SELECTOR) : null;\n\t}\n\n\t_getPage() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tDriver,\n\tname: 'Brooks Brothers',\n\tdomain: 'brooksbrothers.com',\n\tcompletionAction: completionActions.revisit,\n\tisSinglePageApp: true,\n};\n","import DemandwareDriver from './_base';\nimport { completionActions, format } from '../../../utils';\n\nconst { elemToFloat } = format;\n\n/* Behavior description:\n- existing code: yes\n- remove code: yes\n- stackable: no\n- free gift support: no\n- free shipping: no\n- 'isValid' implemented: yes\n- manually apply code: no\n- replace code: no\n- Pages, where extension works: Cart page and Checkout page on Billing step\n- SPA: no\n- gather codes on site pages: no\n- credentials (joseph@gmail.com, 12345qwerty)\n*/\n\nconst BASE_URL = 'https://www.brookstone.com';\nconst CART_URL = `${BASE_URL}/cart`;\nconst CHECKOUT_URL = `${BASE_URL}/billing`;\n\nconst CART_FORM_SELECTOR = 'form[name=\"dwfrm_cart\"]';\nconst CHECKOUT_FORM_SELECTOR = '#dwfrm_billing';\nconst TOTAL_SELECTOR = '.order-total .order-totals-value';\n\n// For this merchant it is safer to check form existence,\n// because URL paths may vary for same pages\nconst TOTAL_ELEM = document.querySelector(TOTAL_SELECTOR);\nconst isOnCartPage = document.querySelector(CART_FORM_SELECTOR);\nconst isOnCheckoutPage = document.querySelector(CHECKOUT_FORM_SELECTOR);\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = TOTAL_SELECTOR;\n\t\tthis.CODE_VALUE_SELECTOR = `${CART_FORM_SELECTOR} .success-code-text, #promo-code-fields .coupon-container .text-container`;\n\t\tthis.CODE_REGEX = /Promo Code\\s*([^ ]+)/;\n\t\tthis.ERROR_MESSAGE_SELECTOR = `${CART_FORM_SELECTOR} .error`;\n\t\tthis.isStackable = false;\n\t}\n\n\tbeforeTestCodes() {\n\t\t// for Checkout page need to get form from Cart page\n\t\tif (!isOnCartPage) {\n\t\t\treturn this._getCart().then(response => {\n\t\t\t\tthis.lastResponse = response;\n\t\t\t\treturn Promise.resolve();\n\t\t\t});\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODE_VALUE_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.filter(el => el.textContent.match(this.CODE_REGEX))\n\t\t\t.map(el => el.textContent.match(this.CODE_REGEX)[1]);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t_getCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Brookstone',\n\tdomain: 'brookstone.com',\n\tcartContinueUrl: isOnCartPage ? window.location.href : CHECKOUT_URL,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n\tisOnCartUrl() {\n\t\treturn (isOnCartPage || isOnCheckoutPage) && TOTAL_ELEM && elemToFloat(TOTAL_ELEM);\n\t},\n};\n","import DemandwareDriver from './_base';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t}\n};\n\nexport default {\n\tname: 'callawayapparel.com',\n\tdomain: 'callawayapparel.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith('https://www.callawayapparel.com/basket') &&\n\t\t\tdocument.querySelector('#dwfrm_cart_couponCode')\n\t\t);\n\t},\n};\n","import DemandwareDriver from './_base';\nimport { completionActions, format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst BASE_SITE_URL = 'https://www.campingworld.com';\nconst CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode, form .cart-coupon-code';\nconst CART_PAGE_URL = `${BASE_SITE_URL}/cart`;\nconst isOnCart = window.location.href.startsWith(CART_PAGE_URL);\n\n/**\n * Driver behavior description:\n -    Existing code: yes, but not always\n -    Remove code: yes\n -    Stackable: no\n -    Free gift support: yes\n -    ‘isValid’ implemented: no\n -\t\tGather codes on site pages: yes\n\t\t\t + from current page\n\t\t\t + https://www.campingworld.com/shop\n Optional:\n -    Is driver SPA and add the condition to show popup: no\n * Code can be replaced with another valid code\n * Code can't be removed or replaced with empty code\n * Can run testing on cart and Payment pages\n */\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.estimated-price, .order-total td:last-child';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cart-footer .coupon-apply-title, .coupon .success';\n\t\tthis.CART_FORM_SELECTOR = '[name=\"dwfrm_cart\"]';\n\t\tthis.CODES_REGEX = /code\\s(\\w+)/;\n\t\tthis.MERCHANTS_CODE_SELECTOR = '.promotion-content strong:last-of-type';\n\t\tthis.SUBSCRIPTION_CODE_SELECTOR = '.bx-wrap .coupon';\n\t\tthis.PRODUCT_PROMO_SELECTOR = '.promo-message';\n\t\tthis.PRODUCT_PROMO_REGEX = /code (\\w+)/i;\n\t\tthis.isStackable = false;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping .left-col';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax .right-col';\n\t}\n\n\tbeforeTestCodes() {\n\t\tif (isOnCart) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\t// need to send request for getting data for checkout\n\t\treturn this._getPage();\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst subscriptionCode = [...document.querySelectorAll(this.SUBSCRIPTION_CODE_SELECTOR)].map(\n\t\t\tel => el.textContent,\n\t\t);\n\n\t\treturn this._getPage(`${BASE_SITE_URL}/shop`).then(responseHTML => {\n\t\t\tconst fromProductDesc = [...extractElement(this.PRODUCT_PROMO_SELECTOR, responseHTML, true)]\n\t\t\t\t.filter(el => el.textContent.match(this.PRODUCT_PROMO_REGEX))\n\t\t\t\t.map(el => el.textContent.match(this.PRODUCT_PROMO_REGEX)[1]);\n\n\t\t\treturn [...new Set([...fromProductDesc, ...subscriptionCode])];\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(element => (isOnCart ? element.textContent.trim() : element.textContent.match(this.CODES_REGEX)))\n\t\t\t.map(code => (isOnCart ? code : code[1]))\n\t\t\t.filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this.removeCode(this.DEFAULT_REMOVE_CODE_VALUE, this._requestData()).then(() =>\n\t\t\tthis._getPage(CART_PAGE_URL),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getPage().then(responseHTML => {\n\t\t\tconst taxElem = extractElement(this.TAX_SELECTOR, responseHTML);\n\t\t\tconst shippingElem = this._findValueByLabel(responseHTML, 'Shipping');\n\t\t\tconst shipping = shippingElem ? elemToFloat(shippingElem) || 0 : 0;\n\t\t\tconst additionalFreightElem = this._findValueByLabel(responseHTML, 'Additional Freight');\n\t\t\tconst addFreight = additionalFreightElem ? elemToFloat(additionalFreightElem) || 0 : 0;\n\t\t\tconst totalShipping = shipping + addFreight;\n\t\t\tconst taxes = taxElem ? elemToFloat(taxElem) || 0 : 0;\n\t\t\treturn this.parseTotal(responseHTML) - totalShipping - taxes;\n\t\t});\n\t}\n\n\t_findValueByLabel(response, string) {\n\t\treturn [...extractElement(this.SHIPPING_SELECTOR, response, true)]\n\t\t\t.filter(elem => elem.innerText.includes(string))\n\t\t\t.map(elem => elem.nextElementSibling)[0];\n\t}\n\n\t_getPage(url = CART_PAGE_URL) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\tif (url === CART_PAGE_URL) {\n\t\t\t\t\tthis.lastResponse = response;\n\t\t\t\t}\n\t\t\t\treturn response;\n\t\t\t});\n\t}\n\n\tapplyCode(code, requestData) {\n\t\trequestData.params.set(this.REQUEST_PARAMS.COUPON_PARAM_NAME, code);\n\t\trequestData.params.set(this.REQUEST_PARAMS.ADD_COUPON_PARAM_NAME, this.REQUEST_PARAMS.ADD_COUPON_PARAM_VALUE);\n\t\treturn this.manageCode(requestData).then(() => this._getPage());\n\t}\n\n\tremoveCode(removeValueName, requestData) {\n\t\trequestData.params.set(this.DEFAULT_REMOVE_CODE_VALUE, this.REQUEST_PARAMS.REMOVE_COUPON_PARAM_VALUE);\n\t\treturn this.manageCode(requestData).then(() => this._getPage());\n\t}\n};\n\nexport default {\n\tname: 'Camping World',\n\tdomain: 'campingworld.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tcartContinueUrl: document.querySelector('#cart-items-form') ? CART_PAGE_URL : `${BASE_SITE_URL}/billing`,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\tdocument.querySelector(CODE_INPUT_SELECTOR) &&\n\t\t\t(href.includes('cart') || href.includes('payment') || href.includes('billing'))\n\t\t);\n\t},\n};\n","import DemandwareDriver from './_base';\nimport { sessionTimer } from '../../lib';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: yes\n+ Free shipping: no\n+ ‘isValid’ implemented: yes (only on sidebar)\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: sidebar, checkout(shipping)\n+ Is driver SPA: yes\n+ Gather codes on site pages: yes\n+ sessionTimer: 15 min\n*/\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = 'https://www.coach.com/';\n\t\tthis.TOTAL_SELECTOR = '.order-total .value, .sub-total-area .value';\n\t\tthis.TOTAL_ELEMENT_CONFIG = {\n\t\t\tselector: this.TOTAL_SELECTOR,\n\t\t};\n\t\tthis.CODE_VALUE_SELECTOR = '#promo-list';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.product-info-wrap, .mini-cart-product';\n\t\tthis.CART_ACTION_SELECTOR = '#cartAction';\n\n\t\tthis.SIDEBAR_SELECTOR = '.cart-drawer';\n\t\tthis.SIDEBAR_BUTTON_SELECTOR = '#miniCartContainer';\n\n\t\tthis.INPUT_FIELD_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.ERROR_MESSAGE_SELECTOR = '.error';\n\t\tthis.CART_FORM_SELECTOR = '#dwfrm_cart';\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping span:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax span:last-child';\n\n\t\tthis.isStackable = false;\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst popupEl = document.querySelector(this.SIDEBAR_SELECTOR);\n\t\tthis.isOnPopupCart = popupEl ? popupEl.getAttribute('style').match(/visibility: inherit/) : false;\n\n\t\tconst isOnShippingUrl = window.location.href.includes('shipping');\n\t\tconst isRightUrl = window.location.href.startsWith(this.BASE_URL);\n\t\tconst isInputField = document.querySelector(this.INPUT_FIELD_SELECTOR);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\treturn isRightUrl && (this.isOnPopupCart || isOnShippingUrl) && isInputField && isTotal;\n\t}\n\n\tasync beforeTestCodes() {\n\t\tconst getCheckoutPage = await this._getPage(`${this.BASE_URL}/checkout`);\n\t\tthis.lastResponse = getCheckoutPage;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(element => element.value).filter(Boolean),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tbeforeApplyCodes() {\n\t\tif (this.isOnPopupCart) {\n\t\t\treturn sessionStorage.setItem('genieOpenSidebar', true);\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tmanageCode(requestData) {\n\t\tconst requestUrl = [extractElement(this.CART_ACTION_SELECTOR, this.lastResponse).value];\n\t\treturn fetch(requestUrl, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: requestData.params,\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.REQUEST_HEADERS,\n\t\t}).then(response => response.text());\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getPage(`${this.BASE_URL}/checkout`).then(responseHTML => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, responseHTML)) || 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, responseHTML)) || 0;\n\t\t\treturn this.parseTotal(responseHTML) - shipping - tax;\n\t\t});\n\t}\n\n\tgetUserData() {\n\t\treturn true;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn document.querySelector(this.SIDEBAR_BUTTON_SELECTOR);\n\t}\n\n\tsetUserData() {\n\t\tconst openSideBar = document.querySelector(this.SIDEBAR_BUTTON_SELECTOR);\n\t\tif (openSideBar) {\n\t\t\topenSideBar.click();\n\t\t\tsessionStorage.removeItem('genieOpenSidebar');\n\t\t}\n\t}\n\n\t_getPage(url) {\n\t\treturn fetch(url).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Coach',\n\tdomain: 'coach.com',\n\tstackable: false,\n\tDriver,\n\tisSinglePageApp: true,\n\trestoreUserData: true,\n};\n","import Promise from 'bluebird';\nimport DemandwareDriver from './_base';\nimport bus from '../../bus';\nimport { DOM, format, log, completionActions } from '../../../utils';\n\nconst { toFloat } = format;\nconst { extractElement } = DOM;\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: yes\n•    Free gift support: yes\n•    ‘isValid’ implemented: no\n•    Manually apply code: no\nOptional:\n•    Show message about free shipping on the cart page (without discount info): no\n•    Is driver SPA and add the condition to show popup: no\n•    Gather codes on site pages: no */\n\nconst DOMAIN = 'https://cottonon.com';\nconst BASE_URL = `${DOMAIN}/on/demandware.store/Sites-cog-us-Site/en_US`;\nconst CART_URL = `${DOMAIN}/US/bag/`;\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.row.order-total-row .order-total';\n\t\tthis.ITEM_SELECTOR = '.primary-content';\n\n\t\tthis.TOTAL_ELEMENT_CONFIG = {\n\t\t\tselector: this.TOTAL_SELECTOR,\n\t\t};\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.row.promo-code-row';\n\t\tthis.CODE_VALUE_SELECTOR = '.promo-code-item';\n\t\tthis.CART_FORM_SELECTOR = '#cart-items-form';\n\n\t\tthis.REQUEST_PARAMS = {\n\t\t\tCOUPON_PARAM_NAME: 'promoCode',\n\t\t};\n\n\t\tthis.applyData = {\n\t\t\taction: `${BASE_URL}/Cart-AddPromoCode`,\n\t\t\tparams: new URLSearchParams(),\n\t\t};\n\n\t\tthis.removeData = {\n\t\t\taction: `${BASE_URL}/Cart-RemovePromoCode`,\n\t\t\tparams: new URLSearchParams(),\n\t\t};\n\n\t\tthis.CSRF_TOKEN_SELECTOR = '[name=\"csrf_token\"]';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-product-row';\n\t\tthis.lastResponse = false;\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isRightUrl =\n\t\t\thref.includes(`${DOMAIN}/US`) && (href.includes('/bag/') || href.includes('/Cart-SubmitForm'));\n\t\tconst isCartEmptyEl = document.querySelector(this.ITEM_SELECTOR);\n\t\tconst isCartEmpty = isCartEmptyEl\n\t\t\t? isCartEmptyEl.innerText.trim().match(/empty|page no longer exists/i)\n\t\t\t: false;\n\t\treturn isRightUrl && !isCartEmpty;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.applyData.params.set('csrf_token', document.querySelector(this.CSRF_TOKEN_SELECTOR).value);\n\t\tthis.removeData.params = this.applyData.params;\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(element =>\n\t\t\t\telement.innerText.trim().toUpperCase(),\n\t\t\t),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this.removeCode(code)).then(() => this._getUpdatedCart());\n\t}\n\n\tcheckCodes(codes) {\n\t\tconst originalPrice = this.parseTotal();\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst originalItemsCount = this.parseItemsCount();\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code).then(json => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\t\t\t\tif (!json.success) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\treturn this._getUpdatedCart().then(() => {\n\t\t\t\t\tresult.finalPrice = this.parseTotal();\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.freeGifts = this.parseItemsCount() - originalItemsCount;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t\toriginalItemsCount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst { discounts, originalPrice } = validationInfo;\n\n\t\t// Sort by discount\n\t\tdiscounts.sort((a, b) => b.finalDiscount - a.finalDiscount);\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(discounts, discount =>\n\t\t\tthis.applyCode(discount.code).then(() =>\n\t\t\t\tthis._getUpdatedCart().then(() => {\n\t\t\t\t\tconst finalPrice = this.parseTotal();\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t});\n\t\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this.removeCode(discount.code);\n\t\t\t\t}),\n\t\t\t),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCode(code) {\n\t\tthis.applyData.params.set(this.REQUEST_PARAMS.COUPON_PARAM_NAME, code);\n\t\treturn this.manageCode(this.applyData);\n\t}\n\n\tremoveCode(code) {\n\t\tthis.removeData.params.set(this.REQUEST_PARAMS.COUPON_PARAM_NAME, code);\n\t\treturn this.manageCode(this.removeData);\n\t}\n\n\tmanageCode(requestData) {\n\t\treturn fetch(requestData.action, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: requestData.params,\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.REQUEST_HEADERS,\n\t\t}).then(response => response.json());\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(html => {\n\t\t\t\tthis.lastResponse = html;\n\t\t\t});\n\t}\n\n\tparseTotal() {\n\t\treturn toFloat(extractElement(this.TOTAL_SELECTOR, this.lastResponse).textContent.replace('US', ''));\n\t}\n\n\tparseItemsCount() {\n\t\treturn extractElement(this.PRODUCT_ITEM_SELECTOR, this.lastResponse, true).length;\n\t}\n};\n\nexport default {\n\tname: 'CottonOn',\n\tdomain: 'cottonon.com',\n\tstackable: true,\n\tcompletionAction: completionActions.revisit,\n\tisOriginalCaseCodes: true,\n\tDriver,\n\tisSinglePageApp: true,\n\tisCartEmpty() {\n\t\treturn Boolean(\n\t\t\tdocument\n\t\t\t\t.querySelector('.primary-content')\n\t\t\t\t.innerText.trim()\n\t\t\t\t.match(/empty|page no longer exists/i),\n\t\t);\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareDriver from './_base';\nimport { format } from '../../../utils';\nimport { sessionTimer } from '../../lib';\nimport { extractElement } from '../../../utils/DOM';\nimport { elemToFloat } from '../../../utils/format';\n\nconst { toFloat } = format;\n/**\n * Driver behavior description:\n -    Existing code: yes\n -    Remove code: yes\n -    Stackable: yes\n -    Free gift support: yes\n -    ‘isValid’ implemented: yes\n -    Manually apply code:no\n -    Is driver SPA and add the condition to show popup: yes\n -\tsessionTimer 15 min\n */\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '#estimatedTotal';\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.couponAppliedItem';\n\t\tthis.CODE_VALUE_SELECTOR = '.promoCuponCode';\n\t\tthis.REMOVE_VALUE_ATTRIBUTE = 'data-uuid';\n\n\t\tthis.REMOVE_CODE_SELECTOR = '.removecoup';\n\t\tthis.EMPTY_CART_SELECTOR = '#emptyCart';\n\t\tthis.CART_PAGE = 'https://www.crocs.com/on/demandware.store/Sites-crocs_us-Site/default/Cart-Show';\n\n\t\tthis.CHARGES_REGEX = /(checkout|tax)/i;\n\t\tthis.CHARGES_SELECTOR = '.cart-footer-table .child-padding>div:last-child';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\n\t\tconst checkoutURL = href.startsWith(this.CART_PAGE);\n\t\tconst emptyCart = Boolean(document.querySelector(this.EMPTY_CART_SELECTOR));\n\n\t\treturn checkoutURL && !emptyCart;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.bodyData = new URLSearchParams({\n\t\t\tupdates: 'approaching|promos|shipping|delivery',\n\t\t});\n\n\t\treturn Promise.resolve();\n\t}\n\n\tapplyCode(code) {\n\t\tthis.bodyData.set('action', 'addcoupon');\n\t\tthis.bodyData.set('coupon', code);\n\t\tthis.bodyData.delete('uuid');\n\t\treturn this.manageCode();\n\t}\n\n\tremoveCode(removeValueUuid) {\n\t\tthis.bodyData.set('uuid', removeValueUuid);\n\t\tthis.bodyData.set('action', 'removecoupon');\n\t\tthis.bodyData.delete('coupon');\n\t\treturn this.manageCode();\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await this._getUpdatedCart();\n\t\tconst total = elemToFloat(extractElement(this.TOTAL_SELECTOR, cartStr));\n\t\tconst taxes = [...extractElement(this.CHARGES_SELECTOR, cartStr.summary, true)]\n\t\t\t.filter(el => el.parentElement.textContent.match(this.CHARGES_REGEX))\n\t\t\t.map(elemToFloat)\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((charges, charge) => charges + charge, 0); // shipping & tax might not be counted on cart\n\t\treturn total - taxes;\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\t_removeValueName(code) {\n\t\tlet removeValueUuid = null;\n\n\t\tif (this.lastResponse) {\n\t\t\tconst codesObjects = this.lastResponse.data.cartPromos.couponItemPromos;\n\t\t\tfor (let i = 0; i < codesObjects.length; i++) {\n\t\t\t\tconst codesObject = codesObjects[i];\n\t\t\t\tif (codesObject && codesObject.couponCode === code) {\n\t\t\t\t\tremoveValueUuid = codesObjects[i].uuid;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst codesElements = Array.from(document.querySelectorAll(this.CODES_ELEMENTS_SELECTOR));\n\t\t\tconst matchingCodesElement = codesElements.find(element => {\n\t\t\t\tconst codesElement = element.querySelector(this.CODE_VALUE_SELECTOR);\n\t\t\t\treturn codesElement && codesElement.innerText.trim() === code;\n\t\t\t});\n\t\t\tif (matchingCodesElement) {\n\t\t\t\tremoveValueUuid = matchingCodesElement\n\t\t\t\t\t.querySelector(this.REMOVE_CODE_SELECTOR)\n\t\t\t\t\t.getAttribute(this.REMOVE_VALUE_ATTRIBUTE);\n\t\t\t}\n\t\t}\n\t\treturn removeValueUuid;\n\t}\n\n\tmanageCode() {\n\t\treturn fetch('https://www.crocs.com/on/demandware.store/Sites-crocs_us-Site/default/Cart-API', {\n\t\t\tmethod: 'POST',\n\t\t\tbody: this.bodyData,\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.json());\n\t}\n\n\tparseTotal(response) {\n\t\tif (response) {\n\t\t\treturn toFloat(response.data.cartEstimatedTotal);\n\t\t}\n\t\treturn toFloat(document.querySelector(this.TOTAL_SELECTOR).innerText);\n\t}\n};\n\nexport default {\n\tname: 'Crocs',\n\tdomain: 'crocs.com',\n\tstackable: true,\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import DemandwareAJAXDriver from './_base';\nimport completionActions from '../../../utils/completion-actions';\nimport { sessionTimer } from '../../lib';\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    ‘isValid’ implemented: no\n•    testing can be run on Cart page\n•    sessionTimer: 20min\nOptional:\n•    Show message about free shipping on the cart page (without discount info): no\n•    Is driver SPA and add the condition to show popup: no\n•    Gather codes on site pages: no */\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.item-list__coupon';\n\t\tthis.CODE_VALUE_SELECTOR = '.coupon-radio label';\n\t\tthis.TOTAL_SELECTOR = '.totals__container .item__price--large:last-child';\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 20,\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Charles Tyrwhitt',\n\tdomain: 'ctshirts.com',\n\tstackable: true,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn document.querySelector('#dwfrm_cart_couponCode') && href.startsWith('https://www.ctshirts.com/us/cart');\n\t},\n};\n","import DemandwareDriver from './_base';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\n\t\tthis.ERROR_MESSAGE_SELECTOR = '.cart-coupon-code .error';\n\t}\n\n\tapplyCodes(codes) {\n\t\twindow.history.pushState(window.history.state, window.document.title, window.location.href.split('?')[0]);\n\t\treturn super.applyCodes(codes);\n\t}\n};\n\nexport default {\n\tname: 'Cubavera',\n\tdomain: 'cubavera.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith('https://www.cubavera.com/basket') &&\n\t\t\tdocument.querySelector('[name=\"dwfrm_cart_couponCode\"]')\n\t\t);\n\t},\n};\n","import DemandwareDriver from './_base';\n\nimport { format, DOM } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable:  yes\n•    Free gift support: no\n•    ‘isValid’ implemented:  no\n•    Gather codes: yes\n•    Can run codes testing only on Cart\nOptional:\n•    Show message about free shipping on the cart page (without discount info): no\n•    Is driver SPA and add the condition to show popup: no\n*/\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = 'https://www.dcshoes.com';\n\t\tthis.TOTAL_SELECTOR = '.total-value-container .ordertotal';\n\t\tthis.CODE_VALUE_SELECTOR = '.cartcoupon-code';\n\t\tthis.CART_FORM_SELECTOR = '#dwfrm_cart-tableform';\n\n\t\tthis.SUMMARY_ITEMS_SELECTOR = '.total-label-container .total-set';\n\t\tthis.TAX_VALUE_SELECTOR = '.total-value-container .total-set:nth-last-child(2)';\n\t\tthis.SHIPPING_VALUE_SELECTOR = '.total-value-container .total-set:nth-child(2)';\n\t\tthis.SHIPPING_WITH_DISCOUNT_SELECTOR = '.total-value-container .total-set:nth-child(3)';\n\t\tthis.ERROR_MESSAGE_SELECTOR = '.cart__couponerrors';\n\t\tthis.CART_ITEM_SELECTOR = '.cart__item';\n\t\tthis.MERCHANT_CODE_SELECTOR = '.coupon';\n\n\t\tthis.isStackable = true;\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnCart =\n\t\t\thref.includes(`${this.BASE_URL}/cart`) ||\n\t\t\thref.includes(`${this.BASE_URL}/on/demandware.store/Sites-DC-US-Site/en_US/Cart-SubmitForm`);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst item = document.querySelector(this.CART_ITEM_SELECTOR);\n\t\treturn isOnCart && isTotal && item;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [\n\t\t\t...new Set(\n\t\t\t\t[...document.querySelectorAll(this.MERCHANT_CODE_SELECTOR)].map(el => el.innerText).filter(Boolean),\n\t\t\t),\n\t\t];\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(element => element.innerText.trim()),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tbeforeApplyCodes() {\n\t\twindow.history.replaceState(window.history.state, window.document.title, `${this.BASE_URL}/cart`);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst tax = [...extractElement(this.SUMMARY_ITEMS_SELECTOR, responseHTML, true)].filter(el =>\n\t\t\t\tel.textContent.includes('Tax'),\n\t\t\t);\n\t\t\tconst shipping = [...extractElement(this.SUMMARY_ITEMS_SELECTOR, responseHTML, true)].filter(el =>\n\t\t\t\tel.textContent.includes('Shipping'),\n\t\t\t);\n\t\t\tconst orderDiscount = [...extractElement(this.SUMMARY_ITEMS_SELECTOR, responseHTML, true)].filter(el =>\n\t\t\t\tel.textContent.includes('Discount'),\n\t\t\t);\n\t\t\tconst taxValue = tax[0] ? elemToFloat(extractElement(this.TAX_VALUE_SELECTOR, responseHTML)) || 0 : 0;\n\t\t\tconst shippingValue = shipping[0]\n\t\t\t\t? elemToFloat(\n\t\t\t\t\t\textractElement(\n\t\t\t\t\t\t\torderDiscount[0] ? this.SHIPPING_WITH_DISCOUNT_SELECTOR : this.SHIPPING_VALUE_SELECTOR,\n\t\t\t\t\t\t\tresponseHTML,\n\t\t\t\t\t\t),\n\t\t\t\t  ) || 0\n\t\t\t\t: 0;\n\t\t\tconst totalValue = this.parseTotal(responseHTML);\n\t\t\treturn totalValue - taxValue - shippingValue;\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(window.location.href, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'DC SHOES',\n\tdomain: 'dcshoes.com',\n\tisSinglePageApp: true,\n\tDriver,\n\tstackable: true,\n};\n","import DemandwareDriver from './_base';\nimport { sessionTimer } from '../../lib';\n\nconst CART_URL = 'https://www.dickies.com/cart';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Dickies',\n\tdomain: 'dickies.com',\n\tstackable: true,\n\tcartContinueUrl: CART_URL,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('[name=\"dwfrm_cart_couponCode\"]');\n\t},\n};\n","import DemandwareDriver from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat, toFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: yes, from Cart page\n*/\n\nconst CART_URL = 'https://www.dooney.com/cart';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.PROPOSED_CODES_SELECTOR = '.top-promo-banner a';\n\t\tthis.CODE_REGEX = /(code\\s+|code:\\s+)(\\w+)/g;\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-row';\n\t\tthis.ERROR_MESSAGE_SELECTOR = '.error';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:nth-child(2)';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:nth-child(2)';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:nth-child(2)';\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getUpdatedCart().then(responseHTML =>\n\t\t\t[...extractElement(this.PROPOSED_CODES_SELECTOR, responseHTML, true)]\n\t\t\t\t.map(el => el.textContent.match(this.CODE_REGEX))\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(el => el[0].split(' ').pop()),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\tconst shippingDiscount = shippingDiscountEl ? toFloat(shippingDiscountEl.textContent.replace('-', '')) : 0;\n\t\t\treturn this.parseTotal(response) - tax - shipping + shippingDiscount;\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Dooney & Bourke',\n\tdomain: 'dooney.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('#cart-coupon-code');\n\t},\n\tisCartEmpty() {\n\t\treturn (document.querySelector('.cart-empty') || {}).offsetParent;\n\t},\n};\n","import DemandwareDriver from './_base';\nimport { sessionTimer } from '../../lib';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = 'duluthtrading.com';\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.CART_ITEM_SELECTOR = '.product-list-item';\n\t\tthis.isStackable = false;\n\t\tthis.CODE_VALUE_SELECTOR = '.js-coupon-code';\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnCart =\n\t\t\thref.includes(`${this.BASE_URL}/cart/`) ||\n\t\t\thref.includes(`${this.BASE_URL}/on/demandware.store/Sites-DTC-Site/default/Cart-AddToWishlist`);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst item = document.querySelector(this.CART_ITEM_SELECTOR);\n\t\treturn isOnCart && isTotal && item;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(element => element.value.trim()),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n};\n\nexport default {\n\tname: 'DuluthTrading',\n\tdomain: 'duluthtrading.com',\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport DemandwareDriver from './_base';\nimport bus from '../../bus';\nimport { DOM, format, completionActions, log, browserUtils } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\nconst { wait } = browserUtils;\n\n/* Driver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    ‘isValid’ implemented: yes\n•    Active page: Checkout\nOptional:\n•    Show message about free shipping on the cart page: no\n•    Is driver SPA and add the condition to show popup: no\n•    Gather codes on site pages: yes(from current page) */\n\nconst BASE_URL = 'https://www.ems.com';\nconst CHECKOUT_URL = `${BASE_URL}/checkout-minicart`;\nconst SHOPPING_CART_URL = `${BASE_URL}/shoppingcart`;\nconst CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_FORM_SELECTOR = '#dwfrm_billing';\n\t\tthis.CODE_VALUE_SELECTOR = '.promo-name strong';\n\t\tthis.SUB_TOTAL_SELECTOR = '.order-subtotal td:last-child';\n\n\t\tthis.isStackable = false;\n\n\t\tthis.DEFAULT_REMOVE_CODE_VALUE = 'dwfrm_billing_coupons_i0_deleteCoupon';\n\n\t\tthis.REQUEST_PARAMS = {\n\t\t\tCOUPON_PARAM_NAME: 'dwfrm_billing_couponCode',\n\t\t\tADD_COUPON_PARAM_NAME: 'dwfrm_billing_applyCoupon',\n\t\t\tADD_COUPON_PARAM_VALUE: 'Apply',\n\t\t\tREMOVE_COUPON_PARAM_VALUE: 'Remove',\n\t\t};\n\n\t\tthis.CODE_ERROR_MESSAGE = '.coupon-code-error';\n\n\t\tthis.PROPOSED_CODES_SELECTOR = '[name=\"image-map-site\"] area:last-child';\n\t\tthis.MERCHANT_CODE_REGEX = /use code (\\w+)/i;\n\n\t\tthis.MERCHANT_CODE_SELECTOR = '[name=\"map-sitewide\"] area';\n\t}\n\n\tasync getMerchantCodes() {\n\t\tconst iframeElem = document.createElement('iframe');\n\t\tiframeElem.src = '/';\n\t\tObject.assign(iframeElem.style, { display: 'none' });\n\t\tdocument.documentElement.appendChild(iframeElem);\n\t\tconst getCodeElem = () => [...iframeElem.contentDocument.querySelectorAll(this.MERCHANT_CODE_SELECTOR)].length;\n\t\tawait wait(getCodeElem, 15000, 300, true);\n\n\t\tif (getCodeElem()) {\n\t\t\treturn [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...iframeElem.contentDocument.querySelectorAll(this.MERCHANT_CODE_SELECTOR)]\n\t\t\t\t\t\t.filter(item => item.alt.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t\t\t.map(item => item.alt.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t\t\t.map(el => el[1])\n\t\t\t\t\t\t.filter(Boolean),\n\t\t\t\t),\n\t\t\t];\n\t\t}\n\t\treturn [];\n\t}\n\n\tcheckCodes(codes) {\n\t\tconst originalPrice = this.parseTotal(this.lastResponse);\n\t\tlog(`Orginal price: ${originalPrice}`);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\treturn this.applyCode(code, this._requestData()).then(applyCodeHtml => {\n\t\t\t\tthis.lastResponse = applyCodeHtml;\n\t\t\t\tif (this._checkInvalidCode(applyCodeHtml)) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tresult.finalPrice = this.parseTotal(applyCodeHtml);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\treturn this.removeCode(this._removeValueName(code), this._requestData()).then(removeCodeHtml => {\n\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedPage().then(response => {\n\t\t\tconst subTotal = extractElement(this.SUB_TOTAL_SELECTOR, response);\n\t\t\treturn elemToFloat(subTotal);\n\t\t});\n\t}\n\n\t_checkInvalidCode(html) {\n\t\treturn extractElement(this.CODE_ERROR_MESSAGE, html);\n\t}\n\n\t_getUpdatedPage() {\n\t\treturn fetch(`${BASE_URL}/billing`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Eastern Mountain Sports',\n\tdomain: 'ems.com',\n\tDriver,\n\tcartContinueUrl: `${BASE_URL}/billing`,\n\tcompletionAction: completionActions.revisit,\n\tisOnCartUrl: href =>\n\t\tdocument.querySelector(CODE_INPUT_SELECTOR) &&\n\t\t(href.startsWith(CHECKOUT_URL) ||\n\t\t\thref.startsWith(`${BASE_URL}/billing`) ||\n\t\t\thref.includes('/COShipping-Start') ||\n\t\t\thref.includes(SHOPPING_CART_URL)),\n};\n","import Promise from 'bluebird';\nimport DemandwareDriver from './_base';\nimport { DOM, log, format } from '../../../utils';\nimport bus from '../../bus';\n\nconst { extractElement } = DOM;\nconst { elemToFloat, toFloat } = format;\n\n/* Driver behaviour description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: yes\n•    Free gift support: no\n•    'isValid' implemented: no\n•     Codes can be replaced by another code: no\n•    Manually apply code: no\n•    Is driver SPA and add the condition to show popup: yes\n•    Can run testing on the cart page */\n\nconst BASE_URL = 'https://www.gamestop.com';\nconst CART_URL = `${BASE_URL}/cart`;\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.grand-total';\n\t\tthis.APPLIED_CODES_SELECTOR = '.promo-number-value';\n\n\t\tthis.TAX_VALUE_SELECTOR = '.tax-total';\n\t\tthis.SHIPPING_VALUE_SELECTOR = '.shipping-cost';\n\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.coupon-code';\n\t\tthis.CODE_VALUE_SELECTOR = '.promo-number-value';\n\t\tthis.CART_FORM_SELECTOR = '[name=\"promo-code-form\"]';\n\n\t\tthis.CSRF_TOKEN_SELECTOR = '.promo-code-form [name=\"csrf_token\"]';\n\n\t\tconst BASE_REQUEST_URL = `${BASE_URL}/on/demandware.store/Sites-gamestop-us-Site/default`;\n\t\tthis.APPLY_CODE_URL = `${BASE_REQUEST_URL}/Cart-AddCoupon`;\n\t\tthis.REMOVE_CODE_URL = `${BASE_REQUEST_URL}/Cart-RemoveCouponLineItem`;\n\n\t\tthis.CODE_ELEM_SELECTOR = '.coupon-price-adjustment';\n\t\tthis.REMOVE_VALUE_SELECTOR = '.remove-coupon';\n\t\tthis.REMOVE_VALUE_ATTRIBUTE = 'data-uuid';\n\n\t\tthis.CODE_INPUT_SELECTOR = '#couponCode';\n\t\tthis.IS_CART_EMPTY_SELECTOR = '.container.cart-page, .cart-empty';\n\t}\n\n\tcheckCondition() {\n\t\tconst isOnRightURL = window.location.href.startsWith(CART_URL);\n\t\tconst isCartEmpty = isOnRightURL\n\t\t\t? document.querySelector(this.IS_CART_EMPTY_SELECTOR).textContent.includes('Cart is Empty')\n\t\t\t: false;\n\t\tconst isCodeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\n\t\treturn !isCartEmpty && isOnRightURL && isCodeInput;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.CSRF_TOKEN = document.querySelector(this.CSRF_TOKEN_SELECTOR).value;\n\t\tthis.removeQueryParams = new URLSearchParams();\n\t\tthis.applyQueryParams = new URLSearchParams({});\n\t\treturn Promise.resolve();\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.removeCode(code, this._removeValue(code)).then(response => {\n\t\t\t\tthis.lastResponse = response;\n\t\t\t\treturn Promise.resolve();\n\t\t\t}),\n\t\t);\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(this.lastResponse)) {\n\t\tlog('originalPrice: %s', originalPrice);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code => {\n\t\t\treturn this.applyCode(code).then(responseJSON => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\t\t\t\tif (responseJSON.error === true) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tthis.lastResponse = responseJSON;\n\t\t\t\tresult.finalPrice = this.parseTotal(responseJSON);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tif (result.finalPrice < originalPrice) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(code, this._removeValue(code)).then(removeCoderesponse => {\n\t\t\t\t\tthis.lastResponse = removeCoderesponse;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(() =>\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t}),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst { discounts, originalPrice } = validationInfo;\n\t\tdiscounts.sort((a, b) => b.finalDiscount - a.finalDiscount);\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(discounts, discount => {\n\t\t\treturn this.applyCode(discount.code).then(responseJSON => {\n\t\t\t\tthis.lastResponse = responseJSON;\n\t\t\t\tconst finalPrice = this.parseTotal(responseJSON);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t});\n\n\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\n\t\t\t\treturn this.removeCode(discount.code, this._removeValue(discount.code)).then(removeCodeResponse => {\n\t\t\t\t\tthis.lastResponse = removeCodeResponse;\n\t\t\t\t\tconst currentCodes = this._getUpdatedPage().then(response => this._getExistingCodes(response));\n\n\t\t\t\t\tconst isCodesEqual =\n\t\t\t\t\t\tcurrentCodes.length === successfulCodes.length &&\n\t\t\t\t\t\tcurrentCodes.every(code => successfulCodes.includes(code));\n\n\t\t\t\t\tif (isCodesEqual) {\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.each(currentCodes, code => this.removeCode(code, this._removeValue(code))).then(\n\t\t\t\t\t\tremoveResponse => {\n\t\t\t\t\t\t\tthis.lastResponse = removeResponse;\n\t\t\t\t\t\t\treturn Promise.each(successfulCodes, code => this.applyCode(code));\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst taxValue = elemToFloat(extractElement(this.TAX_VALUE_SELECTOR, responseHTML));\n\t\t\tconst shippingValue = elemToFloat(extractElement(this.SHIPPING_VALUE_SELECTOR, responseHTML));\n\t\t\tconst totalValue = elemToFloat(extractElement(this.TOTAL_SELECTOR, responseHTML));\n\t\t\treturn totalValue - taxValue - shippingValue;\n\t\t});\n\t}\n\n\t_removeValue(code) {\n\t\tlet removeValueUuid = null;\n\n\t\tif (this.lastResponse) {\n\t\t\tremoveValueUuid = extractElement(\n\t\t\t\tthis.CODE_ELEM_SELECTOR,\n\t\t\t\tthis.lastResponse.totals.discountsHtml,\n\t\t\t).getAttribute(this.REMOVE_VALUE_ATTRIBUTE);\n\t\t} else {\n\t\t\tconst codesElements = [...document.querySelectorAll(this.CODE_ELEM_SELECTOR)];\n\t\t\tconst matchingCodesElement = codesElements.find(element => {\n\t\t\t\tconst codesElement = element.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\t\t\treturn codesElement && codesElement.innerText.trim() === code;\n\t\t\t});\n\t\t\tif (matchingCodesElement) {\n\t\t\t\tremoveValueUuid = matchingCodesElement\n\t\t\t\t\t.querySelector(this.REMOVE_VALUE_SELECTOR)\n\t\t\t\t\t.getAttribute(this.REMOVE_VALUE_ATTRIBUTE);\n\t\t\t}\n\t\t}\n\t\treturn removeValueUuid;\n\t}\n\n\tapplyCode(code) {\n\t\tthis.applyQueryParams.set('couponCode', code);\n\t\tthis.applyQueryParams.set('csrf_token', this.CSRF_TOKEN);\n\t\treturn this.manageCode(this.APPLY_CODE_URL, this.applyQueryParams);\n\t}\n\n\tremoveCode(code, removeValueName) {\n\t\tthis.removeQueryParams.set('code', code);\n\t\tthis.removeQueryParams.set('uuid', removeValueName);\n\t\treturn this.manageCode(this.REMOVE_CODE_URL, this.removeQueryParams);\n\t}\n\n\tmanageCode(url, queryParams) {\n\t\treturn fetch(`${url}?${queryParams.toString()}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.json());\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tcredentials: 'include',\n\t\t\tmethod: 'GET',\n\t\t}).then(response => response.text());\n\t}\n\n\tparseTotal(json) {\n\t\treturn json && json.totals\n\t\t\t? toFloat(json.totals.grandTotal)\n\t\t\t: elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'Game Stop',\n\tdomain: 'gamestop.com',\n\tstackable: true,\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import DemandwareDriver from './_base';\nimport { completionActions, format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\nconst BASE_SITE_URL = 'https://www.ganderoutdoors.com';\nconst CODE_INPUT_SELECTOR = '#dwfrm_billing_couponCode, form .cart-coupon-code';\nconst CART_PAGE_URL = `${BASE_SITE_URL}/cart`;\nconst isOnCart = window.location.href.startsWith(CART_PAGE_URL);\n\n/**\n * Driver behavior description:\n -    Existing code: yes, but not always\n -    Remove code: yes\n -    Stackable: no\n -    Free gift support: no\n -    ‘isValid’ implemented: no\n Optional:\n -    Is driver SPA and add the condition to show popup: no\n * Code can be replaced with another valid code\n * Code can't be removed or replaced with empty code\n * Can run testing on cart and Payment pages\n */\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.estimated-price, .order-total td:last-child';\n\t\tthis.APPLIED_CODES_SELECTOR = '.cart-footer .coupon-apply-title, .coupon .success';\n\t\tthis.CART_FORM_SELECTOR = '[name=\"dwfrm_cart\"]';\n\t\tthis.CODES_REGEX = /code\\s(\\w+)/;\n\t\tthis.MERCHANTS_CODE_SELECTOR = '.bx-row-coupon-default .coupon';\n\t\tthis.isStackable = false;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping .right-col';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax .right-col';\n\t}\n\n\tbeforeTestCodes() {\n\t\tif (isOnCart) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\t// need to send request for getting data for checkout\n\t\treturn this._getPage();\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [\n\t\t\t...new Set(\n\t\t\t\t[...document.querySelectorAll(this.MERCHANTS_CODE_SELECTOR)]\n\t\t\t\t\t.map(elem => elem.textContent.trim())\n\t\t\t\t\t.filter(Boolean),\n\t\t\t),\n\t\t];\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)]\n\t\t\t.map(element => (isOnCart ? element.textContent.trim() : element.textContent.match(this.CODES_REGEX)))\n\t\t\t.map(code => (isOnCart ? code : code[1]))\n\t\t\t.filter(Boolean);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this.removeCode(this.DEFAULT_REMOVE_CODE_VALUE, this._requestData()).then(() =>\n\t\t\tthis._getPage(CART_PAGE_URL),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getPage().then(responseHTML => {\n\t\t\tconst shippingElem = extractElement(this.SHIPPING_SELECTOR, responseHTML);\n\t\t\tconst taxElem = extractElement(this.TAX_SELECTOR, responseHTML);\n\t\t\tconst shipping = shippingElem ? elemToFloat(shippingElem) || 0 : 0;\n\t\t\tconst taxes = taxElem ? elemToFloat(taxElem) || 0 : 0;\n\t\t\treturn this.parseTotal(responseHTML) - shipping - taxes;\n\t\t});\n\t}\n\n\t_getPage(url = CART_PAGE_URL) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\tthis.lastResponse = response;\n\t\t\t\treturn response;\n\t\t\t});\n\t}\n\n\tapplyCode(code, requestData) {\n\t\trequestData.params.set(this.REQUEST_PARAMS.COUPON_PARAM_NAME, code);\n\t\trequestData.params.set(this.REQUEST_PARAMS.ADD_COUPON_PARAM_NAME, this.REQUEST_PARAMS.ADD_COUPON_PARAM_VALUE);\n\t\treturn this.manageCode(requestData).then(() => this._getPage());\n\t}\n\n\tremoveCode(removeValueName, requestData) {\n\t\trequestData.params.set(this.DEFAULT_REMOVE_CODE_VALUE, this.REQUEST_PARAMS.REMOVE_COUPON_PARAM_VALUE);\n\t\treturn this.manageCode(requestData).then(() => this._getPage());\n\t}\n};\n\nexport default {\n\tname: 'ganderoutdoors',\n\tdomain: 'ganderoutdoors.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tcartContinueUrl: document.querySelector('#cart-items-form') ? CART_PAGE_URL : `${BASE_SITE_URL}/billing`,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\tdocument.querySelector(CODE_INPUT_SELECTOR) &&\n\t\t\t(href.includes('cart') || href.includes('payment') || href.includes('billing'))\n\t\t);\n\t},\n};\n","import DemandwareDriver from './_base';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t}\n};\n\nexport default {\n\tname: 'Icing',\n\tdomain: 'icing.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.icing.com/us/shopping-cart');\n\t},\n};\n","import DemandwareDriver from './_base';\nimport completionActions from '../../../utils/completion-actions';\n\n/** Behavior:\n * Site isn't stackable (pretends to be, but remove request doesn't contain code value)\n * Code can be applied only on cart page\n */\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.APPLIED_CODES_SELECTOR = '.coupon-box .cartcoupon.clearfix';\n\t\tthis.APPLIED_CODES_REGEX = /[a-zA-Z0-9]+/;\n\n\t\tthis.isStackable = false;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(\n\t\t\tel => el.innerText.match(this.APPLIED_CODES_REGEX)[0],\n\t\t);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tapplyCodes(codes) {\n\t\twindow.history.replaceState(window.history.state, window.document.title, window.location.href.split('?')[0]);\n\t\treturn this.applyCode(codes[0], this._requestData());\n\t}\n};\n\nexport default {\n\tname: 'illy Shop',\n\tdomain: 'illy.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit, // sometimes website shows an alert\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.illy.com/en-us/shop/cart') && document.querySelector('#promo-code');\n\t},\n\tisCartEmpty() {\n\t\treturn !!document.querySelector('.cart-empty');\n\t},\n};\n","import _1800mattress from './1800mattress.com';\nimport apeainthepod from './apeainthepod.com';\nimport ashleyfurniture from './ashleyfurniture.com';\nimport bareminerals from './bareminerals.com';\nimport blu from './blu.com';\nimport bowflex from './bowflex.com';\nimport brooksbrothers from './brooksbrothers.com';\nimport brookstone from './brookstone.com';\nimport callawayapparel from './callawayapparel.com';\nimport campingworld from './campingworld.com';\nimport coach from './coach.com';\nimport cottonon from './cottonon.com';\nimport crocs from './crocs.com';\nimport ctshirts from './ctshirts.com';\nimport cubavera from './cubavera.com';\nimport dcshoes from './dcshoes.com';\nimport dickies from './dickies.com';\nimport dooney from './dooney.com';\nimport duluthtrading from './duluthtrading.com';\nimport ems from './ems.com';\nimport gamestop from './gamestop.com';\nimport ganderoutdoors from './ganderoutdoors.com';\nimport icing from './icing.com';\nimport illy from './illy.com';\nimport joann from './joann.com';\nimport juicycouturebeauty from './juicycouturebeauty.com';\nimport kennethcole from './kennethcole.com';\nimport lasenza from './lasenza.com';\nimport legendarywhitetails from './legendarywhitetails.com';\nimport luckybrand from './luckybrand.com';\nimport mattressfirm from './mattressfirm.com';\nimport narscosmetics from './narscosmetics.com';\nimport originalpenguin from './originalpenguin.com';\nimport perryellis from './perryellis.com';\nimport philosophy from './philosophy.com';\nimport quiksilver from './quiksilver.com';\nimport roxy from './roxy.com';\nimport shoecarnival from './shoecarnival.com';\nimport tatcha from './tatcha.com';\nimport tervis from './tervis.com';\nimport thelimited from './thelimited.com';\nimport toryburch from './toryburch.com';\n\nexport default [\n\t_1800mattress,\n\tapeainthepod,\n\tashleyfurniture,\n\tbareminerals,\n\tblu,\n\tbowflex,\n\tbrooksbrothers,\n\tbrookstone,\n\tcallawayapparel,\n\tcampingworld,\n\tcoach,\n\tcottonon,\n\tcrocs,\n\tctshirts,\n\tcubavera,\n\tdcshoes,\n\tdickies,\n\tdooney,\n\tduluthtrading,\n\tems,\n\tgamestop,\n\tganderoutdoors,\n\ticing,\n\tilly,\n\tjoann,\n\tjuicycouturebeauty,\n\tkennethcole,\n\tlasenza,\n\tlegendarywhitetails,\n\tluckybrand,\n\tmattressfirm,\n\tnarscosmetics,\n\toriginalpenguin,\n\tperryellis,\n\tphilosophy,\n\tquiksilver,\n\troxy,\n\tshoecarnival,\n\ttatcha,\n\ttervis,\n\tthelimited,\n\ttoryburch,\n];\n","import DemandwareDriver from './_base';\nimport { completionActions, DOM, format } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { extractData, extractElement } = DOM;\nconst { elemToFloat } = format;\n\nconst IS_PLUS_SUBDOMAIN = window.location.href.includes('plus');\nconst BASE_URL = `https://${IS_PLUS_SUBDOMAIN ? 'plus' : 'www'}.joann.com`;\nconst CART_URL = `${BASE_URL}/cart`;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: yes\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: yes\n+ Gather codes on site pages: yes, from https://www.joann.com/coupon/\n+ Session timer: 20 min\n+ maxCoupons: 10\n*/\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.isStackable = false;\n\t\tthis.TOTAL_SELECTOR = '.cart__totals__row--total span:not(.cart__totals__label)';\n\t\tthis.PRICES_SELECTOR = '.cart__totals__row';\n\t\tthis.PRICE_SELECTOR = 'span:last-child';\n\t\tthis.CART_EMPTY_SELECTOR = '.mini-cart-empty';\n\t\tthis.CART_FORM_SELECTOR = '#cart-items-form';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart__product';\n\t\tthis.ERROR_MESSAGE_SELECTOR = '.cart-coupon-code .error';\n\t\tthis.MERCHANTS_CODES_SELECTOR = '.coupon__promo-code';\n\t\tthis.EMPTY_CART_REGEX = /is empty/i;\n\t\tthis.SESSION_TIMEOUT = 20;\n\t}\n\n\twatchForCartUrl() {\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: super.watchForCartUrl(),\n\t\t\ttimeout: this.SESSION_TIMEOUT,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst isCartEmpty = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\tconst cartForm = document.querySelector(this.CART_FORM_SELECTOR);\n\t\tconst isCart =\n\t\t\t(window.location.href.match(/\\/cart/i) || window.location.href.match('/my-account-home')) && cartForm;\n\n\t\tconst emptyCart = isCartEmpty || (cartForm && cartForm.textContent.match(this.EMPTY_CART_REGEX));\n\n\t\treturn !emptyCart && isCart;\n\t}\n\n\tgetMerchantCodes() {\n\t\tif (!IS_PLUS_SUBDOMAIN) {\n\t\t\treturn this._getUpdatedPage('https://www.joann.com/coupon/', true).then(resHtml => [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...extractElement(this.MERCHANTS_CODES_SELECTOR, resHtml, true)]\n\t\t\t\t\t\t.map(el => el.innerText.trim())\n\t\t\t\t\t\t.filter(Boolean),\n\t\t\t\t),\n\t\t\t]);\n\t\t}\n\t\treturn [];\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getUpdatedPage().then(responseText => {\n\t\t\tconst codes = new Set(extractData(this.CODE_VALUE_SELECTOR, responseText, true).map(code => code.trim()));\n\t\t\treturn {\n\t\t\t\tcodes: [...codes],\n\t\t\t\tcodeCount: codes.size,\n\t\t\t};\n\t\t});\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this._getUpdatedPage().then(responseText => {\n\t\t\tthis.lastResponse = responseText;\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedPage().then(response => {\n\t\t\tconst shipping = elemToFloat(this._findElement('Shipping', response)) || 0;\n\t\t\tconst tax = elemToFloat(this._findElement('Tax', response)) || 0;\n\t\t\treturn this.parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\t_findElement(targetString, response) {\n\t\tconst targetEl = [...extractElement(this.PRICES_SELECTOR, response, true)].find(el =>\n\t\t\tel.textContent.includes(targetString),\n\t\t);\n\t\treturn targetEl ? targetEl.querySelector(this.PRICE_SELECTOR) : null;\n\t}\n\n\t_getUpdatedPage(url = CART_URL, retry = false) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\tif (!extractElement(this.TOTAL_SELECTOR, response) && !retry) {\n\t\t\t\t\treturn this._getUpdatedPage(CART_URL, true);\n\t\t\t\t}\n\t\t\t\treturn response;\n\t\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Joann',\n\tdomain: 'joann.com',\n\tcompletionAction: completionActions.revisit,\n\tisSinglePageApp: true,\n\tcartContinueUrl: CART_URL,\n\tmaxCoupons: 10, // site works slow\n\tDriver,\n};\n","import DemandwareDriver from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: can't use manual apply, because driver is stackable (we can't apply many codes manually)\n+ Pages, where extension works: Cart (don't support Checkout, because clear user data)\n+ Is driver SPA: no\n+ Gather codes on site pages: yes, from Cart header\n*/\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tconst BASE_URL = 'https://www.juicycouturebeauty.com';\n\t\tthis.CART_URL = `${BASE_URL}/cart`;\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.cart-table-body .cart-row';\n\t\tthis.ERROR_MESSAGE_SELECTOR = '.coupon-error';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping .bfx-total-shipping';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax .bfx-total-tax';\n\t\tthis.PROMO_SELECTOR = '.header-promotion';\n\t\tthis.PROMO_REGEX = /code:?\\s?(\\w+)/i;\n\t\tthis.lastResponse = null;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [\n\t\t\t...new Set(\n\t\t\t\t[...document.querySelectorAll(this.PROMO_SELECTOR)]\n\t\t\t\t\t.map(el => el.textContent.match(this.PROMO_REGEX))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(el => el[1]),\n\t\t\t),\n\t\t];\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response));\n\t\t\treturn this.parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(this.CART_URL).then(res => res.text());\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\tconst errorEl = extractElement(this.ERROR_MESSAGE_SELECTOR, data);\n\t\treturn errorEl && errorEl.textContent.match(/not be added/i);\n\t}\n};\n\nexport default {\n\tname: 'Juicy Couture Beauty',\n\tdomain: 'juicycouturebeauty.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl() {\n\t\treturn document.querySelector('#dwfrm_cart_couponCode');\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n};\n","import DemandwareDriver from './_base';\nimport completionActions from '../../../utils/completion-actions';\nimport { DOM } from '../../../utils';\n\nconst { extractElement } = DOM;\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .td-totals';\n\t\tthis.CODE_VALUE_SELECTOR = '.item-details > .name';\n\t\tthis.PROMO_CODE_REGEX = /Promo ([^ ]+)/i;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODE_VALUE_SELECTOR)].map(\n\t\t\telement => element.innerText.match(this.PROMO_CODE_REGEX)[1],\n\t\t);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\t_removeValueName(code) {\n\t\tconst codesElements = extractElement(this.CODES_ELEMENTS_SELECTOR, this.lastResponse, true);\n\t\tconst matchingCodesElement = [...codesElements].find(element => {\n\t\t\tconst codesElement = element.querySelector(this.CODE_VALUE_SELECTOR);\n\t\t\treturn (\n\t\t\t\tcodesElement &&\n\t\t\t\tcodesElement.innerText.match(this.PROMO_CODE_REGEX)[1].toLowerCase() === code.toLowerCase()\n\t\t\t);\n\t\t});\n\t\treturn matchingCodesElement\n\t\t\t? matchingCodesElement.querySelector(this.REMOVE_CODE_SELECTOR).name\n\t\t\t: this.DEFAULT_REMOVE_CODE_VALUE;\n\t}\n};\n\nexport default {\n\tname: 'Kenneth Cole',\n\tdomain: 'kennethcole.com',\n\tstackable: true,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.kennethcole.com/cart') && document.querySelector('#cart-items-form');\n\t},\n};\n","import DemandwareDriver from './_base';\n\n/* BEHAVIOUR\n * Can apply more than one code at the same time (stackable)\n * Can remove on cart page\n * Can getExistingCodes\n */\n\nexport default {\n\tname: 'La Senza US',\n\tdomain: 'lasenza.com',\n\t// can't check it, only one code\n\tstackable: true,\n\tDriver: DemandwareDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.lasenza.com/us/checkout/cart');\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareDriver from './_base';\nimport { completionActions, DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { toInt } = format;\n\n/** Behavior description:\n * - existing code: yes\n * - remove code: yes\n * - stackable: yes\n * - free gift support: yes\n * - 'isValid' implemented: no\n * - manually apply code: no\n * - replace code: true\n * */\n\nconst BASE_URL = 'https://www.legendarywhitetails.com';\nconst CART_URL = `${BASE_URL}/cart`;\nconst PAYMENT_URL = `${BASE_URL}/payment`;\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.minicart-quantity';\n\t\tthis.EXISTING_CODE_SELECTOR = '.coupon .success';\n\t\tthis.EXISTING_CODE_REGEXP = /(code\\s)(\\w+)/i;\n\t\tthis.IS_ON_CART = window.location.href.startsWith(CART_URL);\n\t}\n\n\tbeforeTestCodes() {\n\t\t// we have to get Cart from Checkout page, because only on Cart removing codes is allowed\n\t\tif (!this.IS_ON_CART) {\n\t\t\treturn this._getCart().then(response => {\n\t\t\t\tthis.lastResponse = response;\n\t\t\t\treturn Promise.resolve();\n\t\t\t});\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\t// we need different selector to get existing codes for Cart and Checkout\n\t\tconst codeSelector = this.IS_ON_CART ? this.CODE_VALUE_SELECTOR : this.EXISTING_CODE_SELECTOR;\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(codeSelector)].map(element =>\n\t\t\t\tthis.IS_ON_CART\n\t\t\t\t\t? element.innerText.trim()\n\t\t\t\t\t: element.innerText.trim().match(this.EXISTING_CODE_REGEXP)[2],\n\t\t\t),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tparseItemsCount(html) {\n\t\treturn toInt(extractElement(this.PRODUCT_ITEM_SELECTOR, html).textContent);\n\t}\n\n\t_getCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Legendary Whitetails',\n\tdomain: 'legendarywhitetails.com',\n\tstackable: true,\n\tDriver,\n\tcartContinueUrl: window.location.href.startsWith(CART_URL) ? CART_URL : PAYMENT_URL,\n\tcompletionAction: completionActions.revisit,\n\tisOnCartUrl(href) {\n\t\tconst inputElement = document.querySelector('#dwfrm_cart_couponCode, #dwfrm_billing_couponCode');\n\t\treturn (\n\t\t\t(href.startsWith(CART_URL) || href.startsWith(PAYMENT_URL) || href.startsWith(`${BASE_URL}/on`)) &&\n\t\t\tinputElement\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareDriver from './_base';\nimport bus from '../../bus';\nimport { completionActions, DOM, format, log } from '../../../utils';\nimport { sessionTimer, handleDriverError } from '../../lib';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractElement, extractData } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n+ SessionTimer: 10min\n */\n\nconst CART_URL = 'https://www.luckybrand.com/cart';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CODE_VALUE_SELECTOR = '.rowcoupons.cart-row .product-list-item div:nth-of-type(1) .value';\n\t\tthis.CART_FORM_SELECTOR = 'div.cart-coupon-code > form';\n\t\tthis.CART_COUPON_SELECTOR = '.cart-coupon-code';\n\t\tthis.CART_CONTAINER_SELECTOR = '.cart-main-container';\n\n\t\tthis.isStackable = false;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount td:last-of-type';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t\tthis.ERROR_MESSAGE_SELECTOR = '#open-promo .error';\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 10,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnRightUrl = href.startsWith(CART_URL) || href.includes('Cart-SubmitForm');\n\t\tconst cartCouponEl = document.querySelector(this.CART_COUPON_SELECTOR);\n\t\treturn isOnRightUrl && cartCouponEl;\n\t}\n\n\tcheckCodes(codes) {\n\t\tconst originalPrice = this.parseTotal(this.lastResponse);\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst originalItemsCount = this.parseItemsCount(this.lastResponse);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code, this._requestData()).then(html => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\t\t\t\tif (this._codeAppliedCheck(html)) {\n\t\t\t\t\t// need to remove even invalid codes, because some of them still to be present on the page\n\t\t\t\t\treturn this.removeCode(this._removeValueName(code), this._requestData()).then(() =>\n\t\t\t\t\t\tbus.$emit('code-checked', result),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tthis.lastResponse = html;\n\t\t\t\tresult.finalPrice = this.parseTotal(html);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\t\t\t\tresult.isValid = true;\n\n\t\t\t\treturn this.removeCode(this._removeValueName(code), this._requestData()).then(removeCodeHtml => {\n\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst responseHTML = await this._getUpdatedCart();\n\t\tlet total = 0;\n\t\ttry {\n\t\t\ttotal = this.parseTotal(responseHTML);\n\t\t} catch (TypeError) {\n\t\t\tconst orderSectionEl = extractElement(this.CART_CONTAINER_SELECTOR, responseHTML);\n\t\t\tconst pageSection = orderSectionEl && orderSectionEl.innerHTML;\n\t\t\thandleDriverError(new Error('Invalid reponse without total'), { errorPayload: pageSection });\n\t\t\treturn null;\n\t\t}\n\t\tconst shipping = toFloat(extractData(this.SHIPPING_SELECTOR, responseHTML)) || 0;\n\t\tconst tax = toFloat(extractData(this.TAX_SELECTOR, responseHTML)) || 0;\n\n\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, responseHTML);\n\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) || 0 : 0;\n\n\t\treturn total - shipping - tax + shippingDiscount;\n\t}\n\n\tremoveCode(removeValueName, requestData) {\n\t\trequestData.params.set('dwfrm_cart_updateCart', 'dwfrm_cart_updateCart');\n\t\trequestData.params.set(removeValueName, this.REQUEST_PARAMS.REMOVE_COUPON_PARAM_VALUE);\n\n\t\treturn this.manageCode(requestData);\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Lucky Brand',\n\tdomain: 'luckybrand.com',\n\tDriver,\n\tcartContinueUrl: CART_URL,\n\tisSinglePageApp: true,\n\tcompletionAction: completionActions.revisit,\n};\n","import DemandwareDriver from './_base';\nimport { extractElement } from '../../../utils/DOM';\nimport { elemToFloat } from '../../../utils/format';\n\n/*\nDriver behaviour description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: yes\n•    Free gift support: no\n•    'isValid' implemented: no\n•     Codes can be replaced by another code: no\n•    Manually apply code: no\n•    Is driver SPA and add the condition to show popup: no\nCan run testing on the cart and deliveryinfo pages because on the addresses page after manual click user data will be erased\n*/\n\nconst CART_URL = 'https://www.mattressfirm.com/cart';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.rowcoupons, .coupon-applied-row';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t}\n\n\tapplyCode(code, requestData) {\n\t\tif (window.location.href.includes('deliveryinfo')) {\n\t\t\treturn this._manageCode(\n\t\t\t\t`https://www.mattressfirm.com/on/demandware.store/Sites-Mattress-Firm-Site/default/Cart-AddCouponCheckoutJson?couponCode=${code}&format=ajax`,\n\t\t\t);\n\t\t}\n\t\trequestData.params.set(this.REQUEST_PARAMS.COUPON_PARAM_NAME, code);\n\t\trequestData.params.set(this.REQUEST_PARAMS.ADD_COUPON_PARAM_NAME, this.REQUEST_PARAMS.ADD_COUPON_PARAM_VALUE);\n\t\treturn this.manageCode(requestData);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response));\n\t\t\tconst calculatedShipping = shipping || 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response));\n\t\t\treturn this.parseTotal(response) - calculatedShipping - tax;\n\t\t});\n\t}\n\n\t_removeValueName(code) {\n\t\tconst codesElements = extractElement(this.CODES_ELEMENTS_SELECTOR, this.lastResponse, true);\n\t\tconst matchingCodesElement = [...codesElements].filter(element => {\n\t\t\tconst codesElement = [...element.querySelectorAll(this.CODE_VALUE_SELECTOR)];\n\t\t\tlet res = false;\n\t\t\tif (codesElement) {\n\t\t\t\tres = codesElement.find(el => el.innerText.trim() === code);\n\t\t\t}\n\t\t\treturn !!res;\n\t\t});\n\n\t\treturn matchingCodesElement.length\n\t\t\t? matchingCodesElement[0].querySelector(this.REMOVE_CODE_SELECTOR).getAttribute(this.REMOVE_VALUE_ATTRIBUTE)\n\t\t\t: this.DEFAULT_REMOVE_CODE_VALUE;\n\t}\n\n\t_manageCode(url) {\n\t\treturn fetch(url)\n\t\t\t.then(() => fetch(window.location.href))\n\t\t\t.then(response => response.text());\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tcredentials: 'include',\n\t\t\tmethod: 'GET',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Mattress Firm',\n\tdomain: 'mattressfirm.com',\n\tstackable: true,\n\tcartContinueUrl: window.location.href,\n\tDriver,\n\tmaxCoupons: 10, // due to big total test time\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) || href.includes('deliveryinfo');\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cart-empty');\n\t},\n};\n","import DemandwareDriver from './_base';\nimport { sessionTimer } from '../../lib';\nimport { DOM, format } from '../../../utils';\n\nconst { extractFormValues, extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: yes\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: cart, checkout\n+ Is driver SPA: yes\n+ Gather codes on site pages: yes\n*/\n\nconst BASE_URL = 'https://www.narscosmetics.com/';\nconst CART_URL = `${BASE_URL}USA/cart`;\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-value';\n\t\tthis.TOTAL_ELEMENT_CONFIG = {\n\t\t\tselector: this.TOTAL_SELECTOR,\n\t\t};\n\t\tthis.PRODUCT_ITEM_SELECTOR = '.product-list-item';\n\t\tthis.PRODUCT_ITEM_CHECKOUT_SELECTOR = '.mini-cart-product';\n\t\tthis.TOKEN_SELECTOR = '[name=\"csrf_token\"]';\n\n\t\tthis.INPUT_FIELD_SELECTOR = '[name=\"dwfrm_cart_couponCode\"]';\n\t\tthis.ERROR_MESSAGE_SELECTOR = '.error';\n\t\tthis.CART_FORM_SELECTOR = '#cart-items-form, [name=\"dwfrm_cart\"]';\n\n\t\tthis.MERCHANT_CODE_SELECTOR = '.promotion-bar-link';\n\t\tthis.MERCHANT_CODE_REGEXP = /code (\\w+)/i;\n\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping div:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax div:last-child';\n\n\t\tthis.isStackable = false;\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst isInputField = document.querySelector(this.INPUT_FIELD_SELECTOR);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\treturn isInputField && isTotal;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getPage(BASE_URL).then(responseHTML => {\n\t\t\treturn [...extractElement(this.MERCHANT_CODE_SELECTOR, responseHTML, true)]\n\t\t\t\t.map(elem => elem.innerText.match(this.MERCHANT_CODE_REGEXP))\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(elem => elem[1]);\n\t\t});\n\t}\n\n\tasync getExistingCodes() {\n\t\tconst getCartPage = await this._getPage(CART_URL);\n\t\tconst codes = new Set(\n\t\t\t[...extractElement(this.CODE_VALUE_SELECTOR, getCartPage, true)].map(element => element.innerText.trim()),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getPage(CART_URL).then(responseHTML => {\n\t\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, responseHTML)) || 0;\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, responseHTML)) || 0;\n\t\t\treturn this.parseTotal(responseHTML) - shipping - tax;\n\t\t});\n\t}\n\n\tparseItemsCount(html) {\n\t\tconst cartItems = document.querySelector(this.PRODUCT_ITEM_SELECTOR);\n\t\treturn cartItems\n\t\t\t? extractElement(this.PRODUCT_ITEM_SELECTOR, html, true).length\n\t\t\t: extractElement(this.PRODUCT_ITEM_CHECKOUT_SELECTOR, html, true).length;\n\t}\n\n\t_requestData() {\n\t\t// Token is not present in the form, need to add it manually to use template\n\t\tconst csrfTokenElement = extractElement(this.TOKEN_SELECTOR, this.lastResponse);\n\t\tconst formValues = extractFormValues(this.CART_FORM_SELECTOR, this.lastResponse);\n\t\tformValues.params.set('csrf_token', csrfTokenElement.value);\n\t\treturn formValues;\n\t}\n\n\t_getPage(url) {\n\t\treturn fetch(url).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'NARS',\n\tdomain: 'narscosmetics.com',\n\tstackable: false,\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import DemandwareDriver from './_base';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t}\n\n\tbeforeApplyCodes() {\n\t\twindow.history.pushState(window.history.state, window.document.title, window.location.href.split('?')[0]);\n\t\treturn Promise.resolve();\n\t}\n};\n\nexport default {\n\tname: 'Original Penguin',\n\tdomain: 'originalpenguin.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.includes('https://www.originalpenguin.com/basket') && document.querySelector('#dwfrm_cart_couponCode')\n\t\t);\n\t},\n};\n","import DemandwareDriver from './_base';\n\n/* BEHAVIOUR\n * One to one to template\n * Added checking isCartEmpty\n */\n\nexport default {\n\tname: 'Perry Ellis',\n\tdomain: 'perryellis.com',\n\tstackable: true,\n\tcartContinueUrl: 'https://www.perryellis.com/basket',\n\tDriver: DemandwareDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith('https://www.perryellis.com/basket') && document.querySelector('#dwfrm_cart_couponCode');\n\t},\n\tisCartEmpty() {\n\t\treturn Boolean(document.querySelector('.cart-empty'));\n\t},\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport DemandwareAJAXDriver from './_base';\nimport { DOM, format, log, completionActions } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElementFromHTML, extractElement, extractFormValues } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: yes\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: yes\n\t- https://www.philosophy.com\n\t- https://www.philosophy.com/purity-made-simple.html (at the moment there is a valid code)\n+ Restore user data: no\n+ Special case: sometimes valid code that doesn't give any freegift or discount\n\t(because required conditions aren't achieved) can cancel discount given by previous valid code.\n\tThus _invalidCodeApplied method was added to manage this case.\n*/\n\nconst BASE_URL = 'https://www.philosophy.com';\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_FORM_SELECTOR = 'form[id*=\"dwfrm_cart_\"]:not([class*=\"formcheckout\"])';\n\t\tthis.TOKEN_SELECTOR = 'input[name=\"csrf_token\"]';\n\t\tthis.TOTAL_SELECTOR = '.ordertotal .value';\n\t\tthis.ERROR_MESSAGE_SELECTOR = '.cart-coupon-code .error';\n\t\tthis.SHIPPING_SELECTOR = '.ordershipping .value';\n\t\tthis.TAX_SELECTOR = '.ordersalestax .value';\n\t\tthis.MERCHANT_CODES_SELECTOR = '#home-promo-codes a, .mini-description strong';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '#cart-table .eachproductdetails';\n\t\tthis.INVALID_CODE_SELECTOR = '.bonus-item';\n\t\tthis.MERCHANT_CODES_REGEX = /code:\\s+(\\w+)/i;\n\t\tthis.INVALID_CODE_REGEX = /not applied/i;\n\t\tthis.isStackable = false;\n\t}\n\n\tasync getMerchantCodes() {\n\t\tconst mainPage = await this._getMainPage();\n\t\tconst itemPage = await this._getItemPage();\n\t\tconst promoPages = mainPage.concat(' ', itemPage);\n\n\t\tconst codes = [...extractElement(this.MERCHANT_CODES_SELECTOR, promoPages, true)]\n\t\t\t.map(el => el.textContent.match(this.MERCHANT_CODES_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(match => match[1]);\n\n\t\treturn [...new Set(codes)];\n\t}\n\n\tcheckCodes(codes) {\n\t\tconst originalPrice = this.parseTotal(this.lastResponse);\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst originalItemsCount = this.parseItemsCount(this.lastResponse);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code, this._requestData()).then(html => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\n\t\t\t\tif (this._codeAppliedCheck(html)) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\n\t\t\t\tif (this._invalidCodeApplied(html)) {\n\t\t\t\t\treturn this.removeCode(this._removeValueName(code), this._requestData()).then(removeCodeHtml => {\n\t\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.lastResponse = html;\n\t\t\t\tresult.finalPrice = this.parseTotal(html);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\n\t\t\t\tif (\n\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t) {\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t}\n\n\t\t\t\treturn this.removeCode(this._removeValueName(code), this._requestData()).then(removeCodeHtml => {\n\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(html => {\n\t\t\tconst shippingElement = extractElement(this.SHIPPING_SELECTOR, html);\n\t\t\tconst shipping = shippingElement ? elemToFloat(shippingElement) || 0 : 0;\n\t\t\tconst taxElement = extractElement(this.TAX_SELECTOR, html);\n\t\t\tconst tax = taxElement ? elemToFloat(taxElement) : 0;\n\t\t\treturn this.parseTotal(html) - shipping - tax;\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn this._getApi(this._requestData().action);\n\t}\n\n\t_getMainPage() {\n\t\treturn this._getApi(BASE_URL);\n\t}\n\n\t_getItemPage() {\n\t\treturn this._getApi(`${BASE_URL}/purity-made-simple.html`);\n\t}\n\n\t_getApi(url) {\n\t\treturn fetch(url, { method: 'GET', credentials: 'include' }).then(response => response.text());\n\t}\n\n\t_requestData() {\n\t\t// Token is not present in the form, need to add it manually to use template\n\t\tconst csrfTokenElement = this.lastResponse\n\t\t\t? extractElementFromHTML(this.lastResponse, this.TOKEN_SELECTOR)\n\t\t\t: document.querySelector(this.TOKEN_SELECTOR);\n\n\t\tconst formValues = extractFormValues(this.CART_FORM_SELECTOR, this.lastResponse);\n\t\tformValues.params.set('csrf_token', csrfTokenElement.value);\n\t\treturn formValues;\n\t}\n\n\t_invalidCodeApplied(html) {\n\t\treturn (\n\t\t\textractElement(this.INVALID_CODE_SELECTOR, html) &&\n\t\t\tthis.INVALID_CODE_REGEX.test(extractElement(this.INVALID_CODE_SELECTOR, html).textContent)\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Philosophy',\n\tdomain: 'philosophy.com',\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn document.querySelector('#dwfrm_cart_couponCode') && href.startsWith(`${BASE_URL}/cart`);\n\t},\n};\n","import Promise from 'bluebird';\nimport DemandwareDriver from './_base';\nimport bus from '../../bus';\nimport { browserUtils, DOM, format, completionActions } from '../../../utils';\n\nconst { getCookie } = browserUtils;\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/* Behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: yes, cart page\n*/\n\nconst BASE_URL = 'https://www.quiksilver.com';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_FORM_SELECTOR = '#dwfrm_cart-tableform';\n\t\tthis.CODE_VALUE_SELECTOR = '.cartcoupon-code';\n\t\tthis.TOTAL_SELECTOR = '.ordertotal td:last-child';\n\t\tthis.VALUE_SELECTOR = '.total-value-container > div';\n\t\tthis.INDEX_SELECTOR = '.total-label-container > div';\n\t\tthis.CODE_INPUT_SELECTOR = '#dwfrm_cart_couponCode';\n\t\tthis.PROMO_CODE_SELECTOR = '.coupon';\n\t\tthis.MERCHANT_CODE_SELECTOR = '.unslider-carousel li';\n\t\tthis.MERCHANT_CODE_REGEX = /use code:? ? ?(\\w+)/i;\n\t\tthis.PRICES_SELECTOR = '.total-set-row';\n\t\tthis.PRICE_SELECTOR = '.value';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnRightUrl = href.includes(`${BASE_URL}/cart`) || href.includes(`Cart-SubmitForm`);\n\t\tconst shipToUs = getCookie('ShipToCountry') === 'US';\n\t\tconst couponCodeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\treturn isOnRightUrl && couponCodeInput && isTotal && shipToUs && document.readyState === 'complete';\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst individualMerchantCode = [document.querySelector(this.PROMO_CODE_SELECTOR)]\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el.textContent);\n\t\tconst merchantCode = [\n\t\t\t...new Set(\n\t\t\t\t[...document.querySelectorAll(this.MERCHANT_CODE_SELECTOR)]\n\t\t\t\t\t.map(item => item.textContent.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(item => item[1]),\n\t\t\t),\n\t\t];\n\t\treturn [...individualMerchantCode, ...merchantCode];\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice, originalItemsCount } = validationInfo;\n\n\t\t// Sort by discount\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code, this._requestData()).then(html => {\n\t\t\t\tthis.lastResponse = html;\n\t\t\t\tconst finalPrice = this.parseTotal(html);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t\tfreeGifts,\n\t\t\t\t});\n\t\t\t\tif (\n\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this.removeCode(this._removeValueName(discount.code), this._requestData()).then(\n\t\t\t\t\tremoveCodeHtml => {\n\t\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}),\n\t\t).then(() => {\n\t\t\treturn Promise.each(successfulCodes, code => this.applyCode(code, this._requestData())).then(() => {\n\t\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\t\tcodes: successfulCodes,\n\t\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t\t});\n\t\t\t\treturn Promise.resolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn fetch(`${BASE_URL}/cart/`, {\n\t\t\tmethod: 'GET',\n\t\t})\n\t\t\t.then(res => res.text())\n\t\t\t.then(responseHTML => {\n\t\t\t\tconst taxEl = this._findElement('Tax', responseHTML);\n\t\t\t\tconst tax = taxEl ? elemToFloat(taxEl) : 0;\n\t\t\t\tconst shippingEl = this._findElement('Shipping', responseHTML);\n\t\t\t\tconst shipping = shippingEl ? elemToFloat(shippingEl) || 0 : 0;\n\t\t\t\treturn this.parseTotal(responseHTML) - shipping - tax;\n\t\t\t});\n\t}\n\n\t_findElement(targetString, response) {\n\t\tconst targetEl = [...extractElement(this.PRICES_SELECTOR, response, true)].find(el =>\n\t\t\tel.textContent.includes(targetString),\n\t\t);\n\t\treturn targetEl ? targetEl.querySelector(this.PRICE_SELECTOR) : null;\n\t}\n};\n\nexport default {\n\tname: 'Quiksilver',\n\tdomain: 'quiksilver.com',\n\tcartContinueUrl: `${BASE_URL}/cart`,\n\tstackable: true,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisSinglePageApp: true,\n\tshowDifferentDiscountMessage: true,\n};\n","import Promise from 'bluebird';\nimport DemandwareAJAXDriver from './_base';\nimport bus from '../../bus';\n\nimport { DOM, completionActions, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat } = format;\n\n/**\nDriver behavior:\n•   Existing code: yes\n•   Remove code: yes\n•   Code retesting: yes\n•   Stackable: yes\n•   Free gift support: no\n•   isValid implemented: no\n•   Show message about free shipping: no\n•   Driver is SPA: no, works on cart page when coupon form is present\n•   Gather merchant codes: no\n•   Special case: no\n•   Credentials: no\n•   Test Item(s): https://www.roxy.com/sunset-road-small-faux-leather-purse-192504045226.html\n•   Valid Code(s): PERKSPOT\n */\n\nconst CART_URL = 'https://www.roxy.com/cart';\nconst DEMANDWARE_CART_URL = 'https://www.roxy.com/on/demandware.store/Sites-RX-US-Site/en_US/Cart-SubmitForm';\n\nconst CURRENT_CART = window.location.href.includes('/cart') ? CART_URL : DEMANDWARE_CART_URL;\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.cart__promoCodeList .detailscolumn';\n\t\tthis.CART_FORM_SELECTOR = '#dwfrm_cart-tableform';\n\t\tthis.CODE_VALUE_SELECTOR = '.cartcoupon .cartcoupon-code';\n\t\tthis.TOTAL_SELECTOR = '.ordertotal .value';\n\t\tthis.MERCHANT_CODES_SELECTOR = '.bx-wrap .coupon';\n\n\t\tthis.PRICES_SELECTOR = '.total-set-row';\n\t\tthis.PRICE_SELECTOR = '.total-set-row .value';\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.MERCHANT_CODES_SELECTOR)].filter(Boolean).map(el => el.textContent),\n\t\t);\n\t\treturn [...codes];\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice, originalItemsCount } = validationInfo;\n\n\t\t// Sort by discount\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis.applyCode(discount.code, this._requestData())\n\t\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t\t.then(html => {\n\t\t\t\t\tthis.lastResponse = html;\n\t\t\t\t\tconst finalPrice = this.parseTotal(html);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst freeGifts = this.parseItemsCount(html) - originalItemsCount;\n\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\tfreeGifts,\n\t\t\t\t\t});\n\t\t\t\t\tif (\n\t\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t\t) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this.removeCode(this._removeValueName(discount.code), this._requestData()).then(\n\t\t\t\t\t\tremoveCodeHtml => {\n\t\t\t\t\t\t\tthis.lastResponse = removeCodeHtml;\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}),\n\t\t).then(() => {\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t});\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await this._getUpdatedCart();\n\t\tconst total = elemToFloat(extractElement(this.TOTAL_SELECTOR, cartStr));\n\t\tconst shippingEl = this._findElement('Shipping', cartStr);\n\t\tconst shipping = shippingEl ? elemToFloat(shippingEl) || 0 : 0;\n\t\tconst taxEl = this._findElement('Tax', cartStr);\n\t\tconst tax = taxEl ? elemToFloat(taxEl) || 0 : 0;\n\t\treturn total - shipping - tax;\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_URL, { credentials: 'include' }).then(response => response.text());\n\t}\n\n\t_findElement(targetString, response) {\n\t\tconst targetEl = [...extractElement(this.PRICES_SELECTOR, response, true)].find(el =>\n\t\t\tel.textContent.includes(targetString),\n\t\t);\n\t\treturn targetEl ? targetEl.querySelector(this.PRICE_SELECTOR) : null;\n\t}\n};\n\nexport default {\n\tname: 'Roxy',\n\tdomain: 'roxy.com',\n\tstackable: true,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn document.querySelector('#dwfrm_cart_couponCode') && href.startsWith(CURRENT_CART);\n\t},\n\tcartContinueUrl: CART_URL,\n};\n","import DemandwareAJAXDriver from './_base';\nimport { sessionTimer } from '../../lib';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: yes, from main page\n+ SessionTimer: 15 min\n*/\n\nconst Driver = class Driver extends DemandwareAJAXDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = 'https://www.shoecarnival.com';\n\t\tthis.CODES_SELECTOR = '.rowcoupons .cartcoupon .value';\n\t\tthis.ERROR_MESSAGE_SELECTOR = '.cart-coupon-code .error';\n\t\tthis.MERCHANT_CODES_SELECTOR = '.home-flex-banner picture img, .home-bottom-slots picture img';\n\t\tthis.MERCHANT_CODES_REGEXP = /code:\\s([\\d\\w]+)/i;\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:last-child';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.order-shipping-discount.discount td:last-child';\n\t\tthis.TAX_SELECTOR = '.order-sales-tax td:last-child';\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnCart = href.startsWith(`${this.BASE_URL}/cart`) || href.includes('Cart-SubmitForm');\n\t\tconst isTotal = (document.querySelector(this.TOTAL_SELECTOR) || {}).offsetParent;\n\t\treturn isOnCart && isTotal;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getHomePage().then(responseHTML => [\n\t\t\t...new Set(\n\t\t\t\t[...extractElement(this.MERCHANT_CODES_SELECTOR, responseHTML, true)]\n\t\t\t\t\t.map(elem => elem.getAttribute('alt').match(this.MERCHANT_CODES_REGEXP))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(code => code[1]),\n\t\t\t),\n\t\t]);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.CODES_SELECTOR)].map(el => el.textContent.trim());\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartStr = await this._getUpdatedCart();\n\t\tconst total = this.parseTotal(cartStr);\n\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, cartStr)) || 0;\n\t\tconst shippingDiscountEl = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, cartStr);\n\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) : 0;\n\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, cartStr)) || 0;\n\t\treturn total - shipping - tax + shippingDiscount;\n\t}\n\n\t_getHomePage() {\n\t\treturn this._getPage('home');\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn this._getPage('cart');\n\t}\n\n\t_getPage(endPoint = '') {\n\t\treturn fetch(`${this.BASE_URL}/${endPoint}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'Shoe Carnival',\n\tdomain: 'shoecarnival.com',\n\tstackable: true,\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import DemandwareDriver from './_base';\n\n/*\nBehavior description:\n- can get existing codes;\n- can remove codes;\n- valid code can be replaced with another valid code;\n- can't apply multiple codes (not stackable);\n- code testing may be run on 'Cart', 'Shipping', 'Payment', 'Review' pages;\n*/\n\nconst BASE_URL = 'https://www.tatcha.com';\nconst EDIT_PAYMENT_URL = `${BASE_URL}/checkout/editpayment`;\nconst REVIEW_URL = `${BASE_URL}/revieworder`;\nconst IS_ON_PAYMENT = window.location.pathname.includes('/checkout/payment');\nconst IS_ON_REVIEW = window.location.pathname.includes('/checkout/review');\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.checkout-summary-total td:last-child';\n\t\tthis.APPLIED_CODES_SELECTOR = '.promoapply, #promoCode';\n\n\t\tthis.CODE_INPUT_SELECTOR = '#promoCode';\n\t\tthis.APPLY_BUTTON_SELECTOR = '[name=\"dwfrm_cart_addCoupon\"]';\n\n\t\t// the check where a user on shipping or payment pages\n\t\tthis.IS_ON_SHIPPING_PAYMENT = [\n\t\t\t'/checkout/payment',\n\t\t\t'/checkout/editpayment',\n\t\t\t'/checkout/shipping',\n\t\t\t'/checkout/review',\n\t\t\t'/revieworder',\n\t\t].some(str => window.location.pathname.includes(str));\n\t\tthis.CART_FORM_SELECTOR = '#cart-coupon-form, #cart-items-form';\n\t\tthis.PRODUCT_ITEM_SELECTOR = this.IS_ON_SHIPPING_PAYMENT ? '.summary-bag-item' : '.bag-item-line';\n\t\tthis.isStackable = false;\n\n\t\tthis.APPLY_URL = `${BASE_URL}/on/demandware.store/Sites-tatcha-Site/default/Cart-AddCouponJson`;\n\t\tthis.REMOVE_URL = `${BASE_URL}/on/demandware.store/Sites-tatcha-Site/default/Cart-RemoveCoupon`;\n\n\t\tthis.BILLING_ADDRESS_SELECTOR = '.radio-billing-address.selected';\n\t\tthis.SHIPPING_ADDRESS_SELECTOR = '.checkout-billing-address';\n\t\tthis.EMPTY_CART_SELECTOR = '.cart-empty.bag-is-empty';\n\t\tthis.SPINNER_ONE_SELECTOR = '.loader-fullpage';\n\t\tthis.SPINNER_TWO_SELECTOR = '.sk-fading-circle';\n\t\tthis.REMOVE_BUTTON_SELECTOR = '.bag-remove';\n\t\tthis.MODAL_SELECTOR = '.modal';\n\t\tthis.PROMO_ITEM_ELEMENT = '.bag-item-promo';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnRightUrl =\n\t\t\thref.startsWith(`${BASE_URL}/bag`) ||\n\t\t\thref.startsWith(`${BASE_URL}/on/demandware.store/Sites-tatcha-Site/default/Cart-SubmitForm`) ||\n\t\t\thref.startsWith(`${BASE_URL}/checkout/payment`) ||\n\t\t\thref.startsWith(`${BASE_URL}/checkout/editpayment`) ||\n\t\t\thref.startsWith(`${BASE_URL}/checkout/review`) ||\n\t\t\thref.startsWith(`${BASE_URL}/revieworder`) ||\n\t\t\t// in this URL we show popup only for logged user\n\t\t\t(href.startsWith(`${BASE_URL}/checkout/shipping`) && document.querySelector(this.BILLING_ADDRESS_SELECTOR));\n\t\tconst isForm = document.querySelector(this.CART_FORM_SELECTOR);\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst spinnerElementOne = document.querySelector(this.SPINNER_ONE_SELECTOR);\n\t\tconst spinnerElementTwo = document.querySelector(this.SPINNER_TWO_SELECTOR);\n\t\tconst isSpinnerOneActive = spinnerElementOne ? spinnerElementOne.style.display !== 'none' : false;\n\t\tconst isSinnerTwoActive = spinnerElementTwo && spinnerElementTwo.style.display !== 'none';\n\t\tconst isModalActive = [...document.querySelectorAll(this.MODAL_SELECTOR)].some(\n\t\t\tel => el.style.display === 'block',\n\t\t);\n\t\tconst isSippingFieldsOpen = !(document.querySelector(this.SHIPPING_ADDRESS_SELECTOR) || {}).offsetParent;\n\t\tconst itemElements = document.querySelectorAll(`${this.PRODUCT_ITEM_SELECTOR}:not(${this.PROMO_ITEM_ELEMENT})`);\n\t\tconst itemElemCount = itemElements ? itemElements.length > 0 : false;\n\t\treturn (\n\t\t\tisOnRightUrl &&\n\t\t\tisForm &&\n\t\t\t!isSpinnerOneActive &&\n\t\t\t!emptyCart &&\n\t\t\t!isSinnerTwoActive &&\n\t\t\t!isModalActive &&\n\t\t\tisSippingFieldsOpen &&\n\t\t\titemElemCount\n\t\t);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(el => el.value).filter(Boolean);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tapplyCode(code, requestData) {\n\t\tif (this.IS_ON_SHIPPING_PAYMENT) {\n\t\t\trequestData.params.set('couponCode', code);\n\t\t\trequestData.params.set(this.REQUEST_PARAMS.ADD_COUPON_PARAM_NAME, 'Apply');\n\t\t\trequestData.params.delete(this.REQUEST_PARAMS.COUPON_PARAM_NAME);\n\t\t\trequestData.action = this.APPLY_URL;\n\t\t} else {\n\t\t\trequestData.params.set(this.REQUEST_PARAMS.COUPON_PARAM_NAME, code);\n\t\t\trequestData.params.set(\n\t\t\t\tthis.REQUEST_PARAMS.ADD_COUPON_PARAM_NAME,\n\t\t\t\tthis.REQUEST_PARAMS.ADD_COUPON_PARAM_VALUE,\n\t\t\t);\n\t\t}\n\t\treturn this.manageCode(requestData);\n\t}\n\n\tremoveCode(removeValueName, requestData) {\n\t\tif (this.IS_ON_SHIPPING_PAYMENT) {\n\t\t\trequestData.params.delete(removeValueName);\n\t\t\trequestData.params.set('null', 'Remove');\n\t\t\trequestData.action = this.REMOVE_URL;\n\t\t} else {\n\t\t\trequestData.params.set(removeValueName, this.REQUEST_PARAMS.REMOVE_COUPON_PARAM_VALUE);\n\t\t}\n\t\treturn this.manageCode(requestData);\n\t}\n\n\tmanageCode(requestData) {\n\t\tconst url = `${\n\t\t\tthis.IS_ON_SHIPPING_PAYMENT ? `${requestData.action}?${requestData.params}` : requestData.action\n\t\t}`;\n\t\treturn fetch(url, {\n\t\t\tmethod: this.IS_ON_SHIPPING_PAYMENT ? 'GET' : 'POST',\n\t\t\tbody: this.IS_ON_SHIPPING_PAYMENT ? null : requestData.params,\n\t\t\tcredentials: 'include',\n\t\t\theaders: this.REQUEST_HEADERS,\n\t\t}).then(response => response.text());\n\t}\n};\n\n// need to set right URL, to site works correctly\nconst _continueUrl = () => {\n\tif (IS_ON_PAYMENT) {\n\t\treturn EDIT_PAYMENT_URL;\n\t}\n\tif (IS_ON_REVIEW) {\n\t\treturn REVIEW_URL;\n\t}\n\treturn window.location.href;\n};\n\nexport default {\n\tname: 'Tatcha',\n\tdomain: 'tatcha.com',\n\tmaxCoupons: 12, // site is slow\n\tDriver,\n\tisSinglePageApp: true,\n\t// we need to do this because unnecessary browser alert appears on the page\n\tcartContinueUrl: _continueUrl(),\n\tisOnCartUrl() {\n\t\treturn false;\n\t},\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport DemandwareDriver from './_base';\nimport { format, DOM, completionActions, log } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { elemToFloat, toFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+\n+ Pages, where extension works:\n    - cart\n+ Is driver SPA: yes\n+ Gather codes on site pages: no\n*/\n\nconst CART_URL = 'https://www.tervis.com/cart';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.MANAGE_CODE_URL = 'https://www.tervis.com/on/demandware.store/Sites-Tervis-Site/default';\n\t\tthis.TOTAL_SELECTOR = '.cart-total-price .grand-total';\n\t\tthis.EXISTING_CODES_SELECTOR = '.coupons-and-promos .coupon-price-adjustment .coupon-code .remove-coupon';\n\t\tthis.CODE_INPUT_SELECTOR = '#couponCode';\n\n\t\tthis.TAX_SELECTOR = '.tax-total';\n\t\tthis.SHIPPING_SELECTOR = '.shipping-cost';\n\t\tthis.SHIPPING_DISCOUNT_SELECTOR = '.shipping-discount-total';\n\n\t\tthis.TOKEN_SELECTOR = 'input[name=\"csrf_token\"]';\n\t\tthis.CODE_UUID_SELECTOR = '.coupons-and-promos .remove-coupon';\n\n\t\tthis.isStackable = false;\n\t}\n\n\tcheckCondition() {\n\t\tconst onCart = window.location.href.startsWith(CART_URL);\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\treturn codeInput && onCart;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.EXISTING_CODES_SELECTOR)].map(el => el.getAttribute('data-code')),\n\t\t);\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this.removeCode(code))\n\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t.then(responseHTML => this.parseTotal(responseHTML));\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst originalItemsCount = this.parseItemsCount(this.lastResponse);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis.applyCode(code, this._requestData()).then(json => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\t\t\t\tif (this._codeAppliedCheck(json)) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tresult.finalPrice = this.parseTotal(json);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.freeGifts = this.parseItemsCount(json) - originalItemsCount;\n\t\t\t\tresult.isValid = true;\n\n\t\t\t\treturn this.removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst tax = extractElement(this.TAX_SELECTOR, response);\n\t\t\tconst shipping = extractElement(this.SHIPPING_SELECTOR, response);\n\t\t\tconst shippingDiscount = extractElement(this.SHIPPING_DISCOUNT_SELECTOR, response);\n\t\t\treturn (\n\t\t\t\tthis.parseTotal(response) -\n\t\t\t\telemToFloat(tax) -\n\t\t\t\telemToFloat(shipping) +\n\t\t\t\ttoFloat(shippingDiscount ? shippingDiscount.textContent.replace('-', '') : 0)\n\t\t\t);\n\t\t});\n\t}\n\n\tapplyCode(code) {\n\t\tconst csrfToken = document.querySelector(this.TOKEN_SELECTOR).value;\n\t\tconst applyQueryParams = new URLSearchParams({\n\t\t\tcouponCode: code,\n\t\t\tcsrf_token: csrfToken,\n\t\t});\n\t\treturn this._manageCode(applyQueryParams, 'Cart-AddCoupon');\n\t}\n\n\tasync removeCode(code) {\n\t\tconst uuid = await this._getUUID();\n\t\tconst removeQueryParams = new URLSearchParams({ code, uuid });\n\t\treturn this._manageCode(removeQueryParams, 'Cart-RemoveCouponLineItem');\n\t}\n\n\t_manageCode(queryParams, action) {\n\t\treturn fetch(`${this.MANAGE_CODE_URL}/${action}?${queryParams.toString()}`, {\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\taccept: 'application/json, text/javascript, */*; q=0.01',\n\t\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t},\n\t\t\tmethod: 'GET',\n\t\t\tmode: 'cors',\n\t\t}).then(res => res.json());\n\t}\n\n\t_getUUID() {\n\t\treturn this._getUpdatedCart().then(html =>\n\t\t\textractElement(this.CODE_UUID_SELECTOR, html).getAttribute('data-uuid'),\n\t\t);\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\treturn data.errorMessage;\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n\n\tparseTotal(data) {\n\t\tif (typeof data === 'string') {\n\t\t\tconst totalElement = extractElement(this.TOTAL_SELECTOR, data);\n\t\t\treturn elemToFloat(totalElement);\n\t\t}\n\t\treturn data ? toFloat(data.totals.grandTotal) : elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'Tervis',\n\tdomain: 'tervis.com',\n\tisSinglePageApp: true,\n\tcompletionAction: completionActions.revisit,\n\tDriver,\n};\n","import DemandwareDriver from './_base';\nimport { format, DOM, browserUtils } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { elemToFloat } = format;\nconst { extractElement } = DOM;\nconst { wait } = browserUtils;\n\nconst BASE_SITE_URL = 'https://www.thelimited.com';\nconst CART_URL = `${BASE_SITE_URL}/my-bag`;\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '.order-total .order-value';\n\t\tthis.SHIPPING_SELECTOR = '.order-shipping td:nth-child(2)';\n\t\tthis.MERCHANT_CODE_SELECTOR = '[id*=monetate_selectorHTML] .c_text';\n\t\tthis.MERCHANT_CODE_REGEXP = /with code\\s(\\w+)/i;\n\t\tsessionTimer.initialize({});\n\t}\n\n\tasync getMerchantCodes() {\n\t\tconst iframeElem = document.createElement('iframe');\n\t\tiframeElem.src = `${BASE_SITE_URL}/customer-service/coupons-promotions/`;\n\t\tObject.assign(iframeElem.style, { display: 'none' });\n\t\tdocument.documentElement.appendChild(iframeElem);\n\n\t\tconst getCode = () => iframeElem.contentDocument.querySelector(this.MERCHANT_CODE_SELECTOR);\n\t\tawait wait(getCode, 10000, 300, true);\n\t\treturn getCode() ? [getCode().innerText.match(this.MERCHANT_CODE_REGEXP)[1]] : [];\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\t// no taxes on the cart page\n\t\t\tconst shippingEl = extractElement(this.SHIPPING_SELECTOR, response);\n\t\t\tconst shipping = shippingEl.textContent.toLowerCase().trim() === 'free' ? 0 : elemToFloat(shippingEl);\n\t\t\treturn this.parseTotal(response) - shipping;\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.text());\n\t}\n};\n\nexport default {\n\tname: 'The Limited',\n\tdomain: 'thelimited.com',\n\tstackable: true,\n\tDriver,\n\tisOnCartUrl(href) {\n\t\treturn href.startsWith(CART_URL) && document.querySelector('#dwfrm_cart_couponCode');\n\t},\n};\n","import DemandwareDriver from './_base';\nimport { DOM, format } from '../../../utils';\n\nconst { extractElement } = DOM;\nconst { elemToFloat, toFloat } = format;\n\n/*\nBehavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: no\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+ Pages, where extension works: Cart\n+ Is driver SPA: no\n+ Gather codes on site pages: no\n+ MaxCoupons: 10\n*/\n\nconst DOMAIN_CART_URL = 'toryburch.com/on/demandware.store/Sites-ToryBurch_US-Site/default/Cart-Show';\n\nconst Driver = class Driver extends DemandwareDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = `https://www.${DOMAIN_CART_URL}`;\n\t\tthis.TOTAL_SELECTOR = '.amountdue .value';\n\t\tthis.CODES_ELEMENTS_SELECTOR = '.removeCouponButton';\n\t\tthis.CODE_VALUE_SELECTOR = '.coupon-code-value';\n\t\tthis.CART_FORM_SELECTOR = '.cart-column-right .cart-coupons-form';\n\t\tthis.REQUEST_PARAMS.ADD_COUPON_PARAM_VALUE = 'Apply';\n\t\tthis.SHIPPING_SELECTOR = '.cart-summary  .ordershipping .value';\n\t\tthis.TAX_SELECTOR = '.cart-summary  .ordersalestax .value';\n\t\tthis.DONATION_SELECTOR = '.donation-item .itemtotals .value';\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst response = await this._getUpdatedCart();\n\t\tconst total = this.parseTotal(response);\n\t\t// shipping can be free\n\t\tconst shipping = elemToFloat(extractElement(this.SHIPPING_SELECTOR, response)) || 0;\n\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response));\n\t\tconst donation = [...extractElement(this.DONATION_SELECTOR, response, true)]\n\t\t\t.map(el => toFloat(el.textContent))\n\t\t\t.reduce((cur, prev) => cur + prev, 0);\n\t\treturn total - shipping - tax - donation;\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(this.CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(res => res.text());\n\t}\n};\n\nexport default {\n\tname: 'Tory Burch',\n\tdomain: 'toryburch.com',\n\tstackable: true,\n\tDriver,\n\tshowDifferentDiscountMessage: true,\n\tmaxCoupons: 10,\n\tisCartEmpty() {\n\t\treturn document.querySelector('.cartempty');\n\t},\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.includes(DOMAIN_CART_URL) && document.querySelector('.discountapplied, [name=\"dwfrm_cart_couponCode\"]')\n\t\t);\n\t},\n};\n"],"sourceRoot":""}