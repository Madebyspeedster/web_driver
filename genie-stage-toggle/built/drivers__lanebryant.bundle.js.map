{"version":3,"sources":["webpack:///./src/inject/drivers/base.js","webpack:///./src/inject/drivers/lanebryant/_base.js","webpack:///./src/inject/drivers/lanebryant/catherines.com.js","webpack:///./src/inject/drivers/lanebryant/index.js","webpack:///./src/inject/drivers/lanebryant/lanebryant.com.js","webpack:///./src/inject/drivers/lanebryant/maurices.com.js","webpack:///./src/inject/drivers/lanebryant/shopjustice.com.js"],"names":["toFloat","format","BaseDriver","watchForRestoreUserData","time","pauseInterval","interval","setInterval","currentState","checkRestoreDataCondition","clearInterval","bus","$emit","e","handleDriverError","source","storeUserData","domain","userData","getUserData","Promise","resolve","userDataKey","getUserDataStorageKey","storageRecord","storedTime","Date","now","backgroundMessaging","setDriverStorage","log","restoreUserData","maxStorageLifetime","driverStorage","getDriverStorage","deleteDriverStorage","setUserData","getStartPrice","startPrice","Number","MAX_SAFE_INTEGER","totalElementConfig","TOTAL_ELEMENT_CONFIG","selector","attribute","regex","totalElement","Array","isArray","forEach","elemSelector","document","querySelector","Error","value","getAttribute","textContent","pattern","group","match","beforeTestCodes","beforeCheckCodes","beforeApplyCodes","checkCodes","applyCodes","stackCodes","removeCodes","getMerchantCodes","getExistingCodes","codes","codeCount","getPreTaxShippingTotal","watchForCartUrl","previousState","checkCondition","completeExperience","completeExperiencePromisified","args","_promisify","beforeTestCodesPromisified","getStartPricePromisified","getMerchantCodesPromisified","getExistingCodesPromisified","removeCodesPromisified","beforeApplyCodesPromisified","applyCodesPromisified","beforeCheckCodesPromisified","checkCodesPromisified","stackCodesPromisified","method","then","apply","Driver","constructor","merchantDomain","APPLIED_CODE_REGEX","REMOVE_CODE_BTN_SELECTOR","APPLIED_CODE_BLOCK_SELECTOR","IS_ON_CART","window","location","href","includes","APPLY_CODE_PARAM","REMOVE_CODE_PARAM","SESSION_CONF_SELECTOR","merchantName","replace","MANAGE_CODE_URL","isStackable","isRightPage","isCartEmpty","_isCartEmpty","applyQueryParams","URLSearchParams","pageId","applyBodyData","Action","sessionConfirmationNumber","removeQueryParams","removeBodyData","dArgs","_getCodesFromPage","codesFirstPage","length","_removeAndGetCodes","finalCodes","filter","index","arr","indexOf","lastResponse","_applyCode","responseJSON","_parseTotal","originalPrice","workingDiscounts","each","code","finalPrice","finalDiscount","result","isValid","push","_removeCode","map","discount","discounts","validationInfo","sort","a","b","currentPrice","currentDiscount","successfulCodes","history","replaceState","state","title","split","previousPagesCodes","currentPageCodes","_getCodesFromResponse","currentCodes","concat","set","_manageCode","queryParams","bodyData","sendXhr","toString","credentials","body","headers","Accept","response","json","objJSON","data","cartSummary","totalPostSvng","savings","element","CouponId","Boolean","querySelectorAll","closest","innerText","el","extractElement","DOM","DOMAIN_NAME","DOMAIN_URL","DriverTemplate","PROMO_INPUT_SELECTOR","host","SHIPPING_STEP_SELECTOR","EMPTY_CART_SELECTOR","MERCHANT_CODE_SELECTOR","sessionTimer","initialize","onCheckout","shippingStep","notOnShippingStep","classList","contains","couponInput","emptyCart","dynSessConf","_getFirstCode","_removeCodesRecursively","fetch","res","text","resHtml","existingCodes","originalTotal","cartJSON","_getUpdatedCart","total","merchandiseAfterDiscount","nextCode","savingsNew","promoCode","_mouseEvent","event","codeInput","dispatchEvent","Event","bubbles","delay","name","isSinglePageApp","catherines","lanebryant","maurices","shopjustice","extractData","API_URL","CART_URL","PROMO_CODES_URL","CHECKOUT_URL","CHECKOUT_API_URL","CHECKOUT_STATE_URL","CHECKOUT_MANAGE_CODE_URL","PAYMENT_CONT_SELECTOR","EMPTY_EL_SELECTOR","ITEM_SELECTOR","CODE_CHECKOUT_SELECTOR","MERCHANT_CODE_REGEX","SPECIFIC_APPLIED_CODE_REGEX","SCRIPT_CODES_REGEX","timeout","paymentElOnCheckout","isPaymentHide","isPayment","style","overflow","totalEl","offsetParent","itemCheckout","isOnCart","isOnCaciquePage","dynSessConfEl","_dynSessConf","Progress","_getOrderSummary","checkoutState","addCodeParams","removeCodeParam","Set","innerHTML","checkoutCodes","dataset","pageCodes","_parseCodesFromScript","error","retry","status","discountTotal","estmShipping","payment","shipping","tax","totalTaxes","urlParams","action","url","elemToFloat","wait","browserUtils","DOMAIN","PROPOSED_CODES_SELECTOR","EXISTING_CODE_SELECTOR","EXISTING_CODE_REGEX","PAYMENT_STEP_SELECTOR","CART_EMPTY_SELECTOR","DISABLE_TIME_MS","request","setType","requestTypes","embedded","isNotMaxCodeTesting","dataExpired","lastTestTimestamp","codeTestingCount","totalElem","totalValue","isOnCheckout","shippingStepComplete","paymentStepComplete","cartEmptyElem","display","isAccessDenied","toLowerCase","isExistingCode","actionInterval","tryNumber","post","_openIframe","iframeElem","createElement","src","Object","assign","documentElement","appendChild","contentDocument","readyState","remove","reject","catch","maxCoupons","DriverCart","INPUT_SELECTOR","EMPTY_SELECTOR","TOTAL_SELECTOR","SHIPPING_SELECTOR","TAX_SELECTOR","LOADER_SELECTOR","isOnHref","isEmpty","isTotal","inputElement","isInput","isLoader","APPLY_RESPONSE","shippingEl","DriverCheckout","BaseTemplate","APPLIED_CODES_SELECTOR","PAYMENT_SELECTOR","isActivePayment","_getSessionNumber","codeElement","_getOrderInfo","responseCartJSON","checkoutData","discountID","JSON","stringify","clientid"],"mappings":"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","file":"drivers__lanebryant.bundle.js","sourcesContent":["import bus from '../bus';\nimport { log, format } from '../../utils';\nimport { backgroundMessaging, handleDriverError } from '../lib';\n\nconst { toFloat } = format;\n\nexport default class BaseDriver {\n\t/**\n\t * @function watchForRestoreUserData - set up a listener to check user data restorement\n\t * @emits bus#RestoreUserData - the event that indicates to the app\tthat user data could be restored\n\t */\n\twatchForRestoreUserData(time = 500) {\n\t\tlet pauseInterval = false;\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tconst currentState = await this.checkRestoreDataCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t\tif (currentState) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tbus.$emit('restore-user-data');\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkRestoreDataCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t}\n\t\t}, time);\n\n\t\treturn interval;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * @function storeUserData\n\t * @param {String} domain - domain to set the driver storage\n\t * @returns {Promise}\n\t */\n\tasync storeUserData(domain) {\n\t\tconst userData = await this.getUserData();\n\n\t\tif (userData === null) {\n\t\t\t// Nothing to store\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst storageRecord = {\n\t\t\tuserData,\n\t\t\tstoredTime: Date.now(),\n\t\t};\n\t\tbackgroundMessaging.setDriverStorage(userDataKey, storageRecord);\n\t\tlog('Stored user data: %O', storageRecord);\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function restoreUserData\n\t * @param {String} domain - domain to access the driver storage\n\t * @param {Number} [maxStorageLifetime] - optional, the lifetime of the stored data (default 10 mins)\n\t * @returns {Promise}\n\t */\n\tasync restoreUserData(domain, maxStorageLifetime = 600000) {\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(userDataKey);\n\n\t\tif (driverStorage) {\n\t\t\tconst { storedTime, userData } = driverStorage;\n\t\t\t// Clear stored user data\n\t\t\tbackgroundMessaging.deleteDriverStorage(userDataKey);\n\n\t\t\tif (Date.now() - storedTime <= maxStorageLifetime) {\n\t\t\t\tlog('Restore user data: %O', userData);\n\t\t\t\treturn this.setUserData(userData);\n\t\t\t}\n\t\t\tlog('User data is outdated, skip restoring');\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserData - get user data which should be stored\n\t * @returns {Object} - object with required user data which should be restored\n\t */\n\tgetUserData() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function setUserData - restore user data on page\n\t * @param {Object} userData - data which was saved and should be restored\n\t * @returns {Promise}\n\t */\n\tsetUserData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserDataStorageKey - unique key for storing user data per merchant\n\t * @returns {String}\n\t */\n\tgetUserDataStorageKey(domain) {\n\t\t// Append `_userData` to avoid possible conflicts with created storage from driver\n\t\treturn `${domain}_userData`;\n\t}\n\n\t/**\n\t * Parses start price from page\n\t *\n\t * @function getStartPrice\n\t * @returns {Promise<Number>|Number} - the total from the page\n\t */\n\tgetStartPrice() {\n\t\tlet startPrice = Number.MAX_SAFE_INTEGER;\n\t\tconst totalElementConfig = this.TOTAL_ELEMENT_CONFIG;\n\t\tif (totalElementConfig) {\n\t\t\tconst { selector, attribute, regex } = totalElementConfig;\n\t\t\tlet totalElement;\n\t\t\t// handle case, when there is array of selectors and we try to take totalElement using these selectors in turn\n\t\t\t// for example dell.com, hertz.com\n\t\t\tif (Array.isArray(selector)) {\n\t\t\t\tselector.forEach(elemSelector => {\n\t\t\t\t\tif (!totalElement) {\n\t\t\t\t\t\ttotalElement = document.querySelector(elemSelector);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\ttotalElement = document.querySelector(selector);\n\t\t\t} else {\n\t\t\t\thandleDriverError(\n\t\t\t\t\tnew Error(`Total selector type mismatch. Expected string | array, got ${typeof selector}`),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (totalElement) {\n\t\t\t\tlet value = attribute ? totalElement.getAttribute(attribute) : totalElement.textContent;\n\n\t\t\t\tif (value && regex) {\n\t\t\t\t\t// Set pattern to null to receive error in case pattern was not defined\n\t\t\t\t\t// otherwise we may silently return undefined or empty string\n\t\t\t\t\tconst { pattern = null, group = 0 } = regex;\n\t\t\t\t\tvalue = value.match(pattern)[group];\n\t\t\t\t}\n\t\t\t\tstartPrice = toFloat(value);\n\t\t\t}\n\t\t}\n\t\treturn startPrice;\n\t}\n\n\t/**\n\t * Perform any needed actions and setup to start codes testing\n\t *\n\t * @function beforeTestCodes\n\t *\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @typedef {Object} OriginalData\n\t * @property {Number} originalPrice the starting price for the cart\n\t * @property {Number} originalItemsCount the starting items count of the cart\n\t */\n\t/**\n\t * Perform any needed actions and setup before `checkCodes()` will be executed\n\t *\n\t * @function beforeCheckCodes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tbeforeCheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Perform any needed actions and setup before `applyCodes()` will be executed\n\t *\n\t * @function beforeApplyCodes\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function checkCodes\n\t *\n\t * @param {String[]} codes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise}\n\t */\n\tcheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes each code in @param codes and actually applies it to the cart,\n\t * typically through a fetch(...) call.\n\t *\n\t * @function applyCodes\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tapplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function stackCodes\n\t *\n\t * @param {Object} validationInfo - contains all required info passed by `checkCodes()` for codes stacking\n\t * @param {String[]} validationInfo.codes\n\t * @param {Float} [validationInfo.originalPrice]\n\t * @param {Object[]} [validationInfo.discounts] - contains all codes mapped with their discounts\n\t * @returns {Promise}\n\t */\n\tstackCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function removeCodes\n\t *\n\t * @param {String[]} codes - passed in case the driver needs to know specific codes to do removal\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request response) which are available and were not applied by user\n\t *\n\t * @function getMerchantCodes\n\t * @returns {String[]} - codes from merhcant page (or request response if possible)\n\t */\n\tgetMerchantCodes() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request) which are available and were applied by user\n\t *\n\t * @typedef {Object} ExistingCodeInfo\n\t * @prop {String[]} codes - list of codes which had been applied, if discoverable\n\t * @prop {Number} codeCount - the number of codes that were applied to the cart\n\t */\n\t/**\n\t * @function getExistingCodes\n\t * @returns {ExistingCodeInfo}\n\t */\n\tgetExistingCodes() {\n\t\treturn {\n\t\t\tcodes: [],\n\t\t\tcodeCount: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Parses pre tax and shipping total from page or request's response\n\t *\n\t * @function getPreTaxShippingTotal\n\t * @returns {Promise<Number>|Number} - the total without tax and shipping\n\t */\n\tgetPreTaxShippingTotal() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function watchForCartUrl - optional function to set up a listener for url changes on SPAs\n\t * @emits bus#CartActive - the event (using the string 'cart-active') that indicates to the app that test codes button should be shown\n\t * @emits bus#CartInactive - the event (using the string 'cart-inactive') that indicates to the app that test codes button should be hidden\n\t */\n\twatchForCartUrl(time = 500) {\n\t\tlet previousState = null;\n\t\tlet pauseInterval = false;\n\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\tlet currentState = null;\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tcurrentState = await this.checkCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t\tif (currentState !== previousState) {\n\t\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t\t}\n\t\t\t\tpreviousState = currentState;\n\t\t\t}\n\t\t}, time);\n\t\t// return the interval to stop it in `watchForCartUrl` if needed from outside\n\t\treturn interval;\n\t}\n\n\t/**\n\t * @function checkCondition - optional function to check for conditions on SPAs\n\t * @returns {Boolean}\n\t */\n\tcheckCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Perform custom completion action on Continue to Checkout button\n\t * Takes best codes in @param codes\n\t *\n\t * @function completeExperience\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tcompleteExperience() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function completeExperiencePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcompleteExperiencePromisified(...args) {\n\t\treturn this._promisify(this.completeExperience, args);\n\t}\n\n\t/**\n\t * @function beforeCodesTestingPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeTestCodes, args);\n\t}\n\n\t/**\n\t * @function getStartPricePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetStartPricePromisified() {\n\t\treturn this._promisify(this.getStartPrice);\n\t}\n\n\t/**\n\t * @function getMerchantCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetMerchantCodesPromisified(...args) {\n\t\treturn this._promisify(this.getMerchantCodes, args);\n\t}\n\n\t/**\n\t * @function getExistingCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetExistingCodesPromisified(...args) {\n\t\treturn this._promisify(this.getExistingCodes, args);\n\t}\n\n\t/**\n\t * @function removeCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tremoveCodesPromisified(...args) {\n\t\treturn this._promisify(this.removeCodes, args);\n\t}\n\n\t/**\n\t * @function beforeApplyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeApplyCodes, args);\n\t}\n\n\t/**\n\t * @function applyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tapplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.applyCodes, args);\n\t}\n\n\t/**\n\t * @function beforeCheckCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeCheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeCheckCodes, args);\n\t}\n\n\t/**\n\t * @function checkCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.checkCodes, args);\n\t}\n\n\t/**\n\t * @function stackCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tstackCodesPromisified(...args) {\n\t\treturn this._promisify(this.stackCodes, args);\n\t}\n\n\t/**\n\t * @function _promisify - promisifies given method and return it's result as a Promise\n\t * @returns {Promise}\n\t */\n\t_promisify(method, args) {\n\t\treturn Promise.resolve().then(() => method.apply(this, args));\n\t}\n}\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport BaseDriver from '../base';\nimport { format, log, sendXhr } from '../../../utils';\n\nconst { toFloat } = format;\n\n// This template driver is for merchants which are similar to lanebryant.com\n// The only parameter is domain\n\nexport default class Driver extends BaseDriver {\n\tconstructor(merchantDomain) {\n\t\tsuper();\n\t\tthis.APPLIED_CODE_REGEX = /\\[([^\\]]*)/;\n\t\tthis.REMOVE_CODE_BTN_SELECTOR = '.mar-cart-remove button, .checkout-remove-promo';\n\t\tthis.APPLIED_CODE_BLOCK_SELECTOR = '.mar-cart-label, .mar-cart-sidebar-pa-text';\n\n\t\tthis.IS_ON_CART = window.location.href.includes('/cart/cart.jsp');\n\n\t\tthis.APPLY_CODE_PARAM = 'promoCode';\n\t\tthis.REMOVE_CODE_PARAM = 'discountID';\n\n\t\tthis.SESSION_CONF_SELECTOR = 'input[name=\"_dynSessConf\"]';\n\n\t\tthis.merchantDomain = merchantDomain;\n\t\tthis.merchantName = merchantDomain.replace('.com', '');\n\t\tthis.MANAGE_CODE_URL = `https://www.${this.merchantDomain}/${this.merchantName}/baseAjaxServlet`;\n\n\t\t// this flag true for stackable sites\n\t\tthis.isStackable = false;\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isRightPage =\n\t\t\tthis.IS_ON_CART ||\n\t\t\thref.includes(`${this.merchantDomain}/${this.merchantName}/checkout/checkout.jsp?progressState=PAYMENT`);\n\t\tconst isCartEmpty = this._isCartEmpty();\n\t\tconst currentState = isRightPage && !isCartEmpty;\n\t\treturn currentState;\n\t}\n\n\twatchForCartUrl() {\n\t\tsuper.watchForCartUrl();\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.applyQueryParams = new URLSearchParams({ pageId: 'UpdateCart' });\n\t\tthis.applyBodyData = new URLSearchParams({\n\t\t\tAction: 'Cart.validatePromo',\n\t\t\tsessionConfirmationNumber: document.querySelector(this.SESSION_CONF_SELECTOR).getAttribute('value'),\n\t\t});\n\t\tthis.removeQueryParams = new URLSearchParams({ pageId: 'RemoveDiscount' });\n\t\tthis.removeBodyData = new URLSearchParams({\n\t\t\tAction: 'Cart.removeDiscountAction',\n\t\t\tdArgs: 'dArgs',\n\t\t\tsessionConfirmationNumber: document.querySelector(this.SESSION_CONF_SELECTOR).getAttribute('value'),\n\t\t});\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\treturn this._getCodesFromPage()\n\t\t\t.then(codesFirstPage =>\n\t\t\t\tcodesFirstPage.length ? this._removeAndGetCodes(codesFirstPage) : Promise.resolve(codesFirstPage),\n\t\t\t)\n\t\t\t.then(codes => {\n\t\t\t\tconst finalCodes = codes.filter((value, index, arr) => arr.indexOf(value) === index);\n\t\t\t\treturn Promise.resolve({\n\t\t\t\t\tcodes: finalCodes,\n\t\t\t\t\tcodeCount: finalCodes.length,\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tbeforeCheckCodes() {\n\t\t// if codes haven't been found this request is sent. Before renewing template, there was a problem with non-actual total on the page.\n\t\t// This request solves problem that possibly exist.\n\t\tif (!this.lastResponse) {\n\t\t\treturn this._applyCode('fake-rmn-genie-code').then(responseJSON => this._parseTotal(responseJSON));\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(this.lastResponse)) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code).then(responseJSON => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseJSON);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t\tisValid: false,\n\t\t\t\t};\n\t\t\t\tif (finalDiscount > 0) {\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\tif (this.isStackable) {\n\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tthis.isStackable\n\t\t\t\t? bus.$emit('stack-codes', {\n\t\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\t\toriginalPrice,\n\t\t\t\t  })\n\t\t\t\t: Promise.resolve(),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst { discounts, originalPrice } = validationInfo;\n\t\tdiscounts.sort((a, b) => b.finalDiscount - a.finalDiscount);\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tconst successfulCodes = [];\n\t\treturn Promise.each(discounts, discount =>\n\t\t\tthis._applyCode(discount.code).then(responseJSON => {\n\t\t\t\tconst finalPrice = this._parseTotal(responseJSON);\n\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\tcode: discount.code,\n\t\t\t\t\tfinalPrice,\n\t\t\t\t\tfinalDiscount,\n\t\t\t\t});\n\t\t\t\tif (finalPrice < currentPrice) {\n\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn this._removeCode(discount.code);\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\twindow.history.replaceState(window.history.state, window.document.title, window.location.href.split('?')[0]);\n\t\treturn this.isStackable ? Promise.resolve() : this._applyCode(codes[0]);\n\t}\n\n\t_removeAndGetCodes(previousPagesCodes) {\n\t\treturn this._removeCode(previousPagesCodes[previousPagesCodes.length - 1]).then(responseJSON => {\n\t\t\tthis.lastResponse = responseJSON;\n\t\t\tconst currentPageCodes = this._getCodesFromResponse(responseJSON);\n\t\t\tconst currentCodes = previousPagesCodes.concat(currentPageCodes);\n\t\t\treturn currentPageCodes.length ? this._removeAndGetCodes(currentCodes) : Promise.resolve(currentCodes);\n\t\t});\n\t}\n\n\t_applyCode(code) {\n\t\tthis.applyBodyData.set(this.APPLY_CODE_PARAM, code);\n\t\treturn this._manageCode(this.applyQueryParams, this.applyBodyData);\n\t}\n\n\t_removeCode(code) {\n\t\tthis.removeBodyData.set(this.REMOVE_CODE_PARAM, code);\n\t\treturn this._manageCode(this.removeQueryParams, this.removeBodyData);\n\t}\n\n\t_manageCode(queryParams, bodyData) {\n\t\treturn sendXhr(`${this.MANAGE_CODE_URL}?${queryParams.toString()}`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: bodyData,\n\t\t\theaders: {\n\t\t\t\tAccept: 'application/json, text/javascript, */*; q=0.01',\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t},\n\t\t}).then(response => response.json());\n\t}\n\n\t_parseTotal(objJSON) {\n\t\treturn toFloat(objJSON.data.cartSummary.totalPostSvng);\n\t}\n\n\t_getCodesFromResponse(data) {\n\t\tconst codes = data.data.cartSummary.savings ? data.data.cartSummary.savings : [];\n\t\treturn codes.map(element => element.CouponId).filter(Boolean);\n\t}\n\n\t_getCodesFromPage() {\n\t\tconst codes = [...document.querySelectorAll(this.REMOVE_CODE_BTN_SELECTOR)]\n\t\t\t.map(element => element.closest(this.APPLIED_CODE_BLOCK_SELECTOR).innerText.match(this.APPLIED_CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t\treturn Promise.resolve(codes);\n\t}\n\n\t_isCartEmpty() {\n\t\treturn false;\n\t}\n}\n","import Promise from 'bluebird';\nimport DriverTemplate from './_base';\nimport { sessionTimer } from '../../lib';\nimport { format, DOM } from '../../../utils';\n\nconst { toFloat } = format;\nconst { extractElement } = DOM;\n\n/*\nDriver behavior description:\n- Existing code: yes\n- Remove code: yes\n- Stackable: no\n- Free gift support: no\n- Free shipping: no\n- isValid implemented: yes\n- Is SPA: yes\n- Codes can be replaced: no\n- Pages, where extension works:\n  - cart\n  - checkout (payment)\n- Gather codes on site pages: yes(cart page)\n- Session timer: 15 min\n- Special case about the driver works:\nWhen a lot of codes were applied and one removed, the previous one is applied automatically.\nto get all applied codes we have to loop through fetch requests and stop when no applied codes\n*/\n\nconst DOMAIN_NAME = 'catherines';\nconst DOMAIN_URL = `${DOMAIN_NAME}.com`;\n\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper(DOMAIN_URL);\n\n\t\t// this flag true for stackable sites\n\t\tthis.isStackable = false;\n\n\t\tthis.PROMO_INPUT_SELECTOR = '#mar-cart-promo-code, .promo-code-input';\n\t\tthis.MANAGE_CODE_URL = `https://${window.location.host}/${this.merchantName}/baseAjaxServlet`;\n\n\t\tthis.SHIPPING_STEP_SELECTOR = '#spa-checkout-shipping';\n\n\t\tthis.EMPTY_CART_SELECTOR =\n\t\t\t'.items-in-order-wrapper[style*=\"display: none\"], #asc-cart-order-summary[style*=\"display: none\"]';\n\t\tthis.MERCHANT_CODE_SELECTOR = '.desktop-code b';\n\t\tsessionTimer.initialize();\n\t}\n\n\tcheckCondition() {\n\t\tconst onCheckout = window.location.href.includes('/checkout');\n\t\tconst shippingStep = document.querySelector(this.SHIPPING_STEP_SELECTOR);\n\t\tconst notOnShippingStep = shippingStep ? shippingStep.classList.contains('saved') : false;\n\t\tconst couponInput = document.querySelector(this.PROMO_INPUT_SELECTOR);\n\t\tconst emptyCart = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\treturn couponInput && ((onCheckout && notOnShippingStep) || (this.IS_ON_CART && !emptyCart));\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst dynSessConf = this.IS_ON_CART\n\t\t\t? document.querySelector(this.SESSION_CONF_SELECTOR).getAttribute('value')\n\t\t\t: Date.now();\n\t\tthis.applyQueryParams = new URLSearchParams({ pageId: 'UpdateCart' });\n\t\tthis.applyBodyData = new URLSearchParams({\n\t\t\tAction: 'Cart.validatePromo',\n\t\t\tsessionConfirmationNumber: dynSessConf,\n\t\t});\n\t\tthis.removeQueryParams = new URLSearchParams({ pageId: 'RemoveDiscount' });\n\t\tthis.removeBodyData = new URLSearchParams({\n\t\t\tAction: 'Cart.removeDiscountAction',\n\t\t\tdArgs: 'dArgs',\n\t\t\tsessionConfirmationNumber: dynSessConf,\n\t\t});\n\n\t\treturn this._getFirstCode().then(code => (code ? this._removeCodesRecursively(code) : Promise.resolve()));\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn fetch(`https://www.${DOMAIN_URL}/catherines/cart/cart.jsp`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t})\n\t\t\t.then(res => res.text())\n\t\t\t.then(resHtml => {\n\t\t\t\treturn [extractElement(this.MERCHANT_CODE_SELECTOR, resHtml)].filter(Boolean).map(el => el.textContent);\n\t\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = this.existingCodes ? this.existingCodes : [];\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn this.originalTotal;\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst cartJSON = await this._getUpdatedCart();\n\t\tconst total = cartJSON.cartSummary.merchandiseAfterDiscount;\n\n\t\treturn toFloat(total);\n\t}\n\n\t_getFirstCode() {\n\t\treturn this._applyCode('fake-code').then(\n\t\t\tresponseJSON =>\n\t\t\t\tBoolean(responseJSON.data.cartSummary.savings) && responseJSON.data.cartSummary.savings[0].CouponId,\n\t\t);\n\t}\n\n\t// need to remove codes in such way because when we remove one code there the previous one will be on the page\n\t_removeCodesRecursively(code) {\n\t\tthis.existingCodes = [code];\n\t\tlet lastResponse = null;\n\t\tlet nextCode = code;\n\t\tconst arr = [...new Array(15)];\n\n\t\treturn Promise.each(arr, () => {\n\t\t\tif (!nextCode) {\n\t\t\t\tthis.originalTotal = this._parseTotal(lastResponse);\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\treturn this._removeCode(nextCode).then(responseJSON => {\n\t\t\t\tlastResponse = responseJSON;\n\t\t\t\tnextCode =\n\t\t\t\t\tBoolean(responseJSON.data.cartSummary.savingsNew) &&\n\t\t\t\t\tresponseJSON.data.cartSummary.savingsNew[0] &&\n\t\t\t\t\tresponseJSON.data.cartSummary.savingsNew[0].promoCode &&\n\t\t\t\t\tthis.existingCodes[this.existingCodes.length - 1] !==\n\t\t\t\t\t\tresponseJSON.data.cartSummary.savingsNew[0].promoCode\n\t\t\t\t\t\t? responseJSON.data.cartSummary.savingsNew[0].promoCode\n\t\t\t\t\t\t: false;\n\t\t\t\tif (nextCode) {\n\t\t\t\t\tthis.existingCodes.push(nextCode);\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn Promise.resolve();\n\t\t\t});\n\t\t});\n\t}\n\n\t_manageCode(queryParams, bodyData) {\n\t\treturn this._mouseEvent('mousedown')\n\t\t\t.then(() => {\n\t\t\t\treturn fetch(`${this.MANAGE_CODE_URL}?${queryParams.toString()}`, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcredentials: 'include',\n\t\t\t\t\tbody: bodyData,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then(res => {\n\t\t\t\treturn this._mouseEvent('mouseup').then(() => {\n\t\t\t\t\treturn res.json();\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then(responseJSON => {\n\t\t\t\tthis.lastResponse = responseJSON;\n\t\t\t\treturn responseJSON;\n\t\t\t});\n\t}\n\n\t_mouseEvent(event) {\n\t\tconst codeInput = document.querySelector(this.PROMO_INPUT_SELECTOR);\n\t\tcodeInput.dispatchEvent(new Event(event, { bubbles: true }));\n\t\t// need to add this delay for correct site working\n\t\treturn Promise.delay(1000).then(() => {\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(`https://www.${DOMAIN_URL}/api/v1/cart/summary?_=${Date.now()}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.json());\n\t}\n};\n\nexport default {\n\tname: 'Catherines',\n\tdomain: 'catherines.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import catherines from './catherines.com';\nimport lanebryant from './lanebryant.com';\nimport maurices from './maurices.com';\nimport shopjustice from './shopjustice.com';\n\nexport default [catherines, lanebryant, maurices, shopjustice];\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport DriverTemplate from './_base';\nimport { log, format, DOM } from '../../../utils';\nimport { sessionTimer, handleDriverError } from '../../lib';\n\nconst { toFloat } = format;\nconst { extractElement, extractData } = DOM;\n\n/* Driver behavior description:\n\t+ Existing code: yes (some types of applied codes)\n\t+ Remove code: yes\n\t+ Stackable: no\n\t+ Free gift support: no\n\t+ Free shipping: no\n\t+ isValid implemented: yes\n\t+ Is SPA: yes\n\t+ Gather codes: yes, from https://www.lanebryant.com/content/promos , https://outlet.lanebryant.com/content/promos (according to the host)\n\t+ Extension works: Cart, checkout (lanebryant, outlet)\n\t+ SessionTimer: 13min\n====Special cases====\n\t+ When a lot of codes were applied and one removed, the previous one will be applied automatically.\n\t+ Some codes which were previous applied can be present in script even after remove them,\n\t  so the will be present in existing codes too\n*/\n\nconst DOMAIN_URL = 'lanebryant.com';\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper(DOMAIN_URL);\n\t\tthis.API_URL = `https://${window.location.host}/api/v1/cart/summary`;\n\t\tthis.CART_URL = `https://${window.location.host}/cart/cart.jsp`;\n\t\tthis.PROMO_CODES_URL = `https://${window.location.host}/content/promos`;\n\t\tthis.CHECKOUT_URL = `https://${window.location.host}/lanebryant/checkout`;\n\t\tthis.CHECKOUT_API_URL = `https://${window.location.host}/api/v1/order`;\n\t\tthis.CHECKOUT_STATE_URL = `${this.CHECKOUT_API_URL}/checkout/state`;\n\t\tthis.CHECKOUT_MANAGE_CODE_URL = `${this.CHECKOUT_API_URL}/promo/`;\n\t\tthis.TOTAL_ELEMENT_CONFIG = {\n\t\t\tselector: '.order-summary-item-estimated-total .order-summary-content-right, .asc-total-value',\n\t\t};\n\t\tthis.EMPTY_CART_SELECTOR = '.asc-empty-cart-message';\n\t\tthis.APPLIED_CODE_BLOCK_SELECTOR = '.promo-left-content, .mar-cart-label, .mar-cart-sidebar-pa-text';\n\t\tthis.PAYMENT_CONT_SELECTOR = '.payment-container';\n\t\tthis.EMPTY_EL_SELECTOR =\n\t\t\t'.items-in-order-wrapper[style*=\"display: none\"], #asc-cart-order-summary[style*=\"display: none\"]';\n\t\tthis.ITEM_SELECTOR = '.item-title, .product-title';\n\t\tthis.SESSION_CONF_SELECTOR = 'input[name=\"_dynSessConf\"]';\n\t\tthis.MERCHANT_CODE_SELECTOR = '#globo-box h3 small, .promo-ftr';\n\t\tthis.CODE_CHECKOUT_SELECTOR = '[data-code]';\n\t\tthis.MERCHANT_CODE_REGEX = /use code: (\\w+)/i;\n\t\tthis.SPECIFIC_APPLIED_CODE_REGEX = /with code:?\\s?(\\w+)/i;\n\t\tthis.SCRIPT_CODES_REGEX = /promotionVanityCode\"?:\\s?\"?(\\w+)/i;\n\t\tsessionTimer.initialize({ timeout: 13 });\n\t}\n\n\tcheckCondition() {\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_EL_SELECTOR);\n\t\tconst paymentElOnCheckout = document.querySelector(this.PAYMENT_CONT_SELECTOR);\n\t\tconst isPaymentHide = document.querySelector(`${this.PAYMENT_CONT_SELECTOR}.slide-hide`);\n\t\tconst isPayment = paymentElOnCheckout && paymentElOnCheckout.style.overflow !== 'hidden' && !isPaymentHide;\n\t\tconst totalEl = (document.querySelector(this.TOTAL_ELEMENT_CONFIG.selector) || {}).offsetParent;\n\t\tconst itemCheckout = document.querySelector(this.ITEM_SELECTOR);\n\t\tconst isOnCart = window.location.href.includes('cart.jsp');\n\t\tconst isOnCaciquePage = window.location.href.includes('cacique');\n\t\treturn (isOnCart || isPayment) && !isCartEmpty && itemCheckout && totalEl && !isOnCaciquePage;\n\t}\n\n\tasync beforeTestCodes() {\n\t\tconst resHtml = await this._getUpdatedCart();\n\t\tconst dynSessConfEl = extractElement(this.SESSION_CONF_SELECTOR, resHtml);\n\t\tlet _dynSessConf = dynSessConfEl ? extractData(this.SESSION_CONF_SELECTOR, resHtml, false, 'value') : null;\n\t\tif (!_dynSessConf) {\n\t\t\tconst { Progress } = await this._getOrderSummary(`${this.CHECKOUT_STATE_URL}?_=${Date.now()}`);\n\t\t\t_dynSessConf = Progress.checkoutState.sessionConfirmationNumber;\n\t\t}\n\t\tthis.addCodeParams = new URLSearchParams({ _dynSessConf });\n\t\tthis.removeCodeParam = new URLSearchParams({ _dynSessConf });\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn fetch(this.PROMO_CODES_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t})\n\t\t\t.then(res => res.text())\n\t\t\t.then(resHtml => [\n\t\t\t\t...new Set(\n\t\t\t\t\t[...extractElement(this.MERCHANT_CODE_SELECTOR, resHtml, true)]\n\t\t\t\t\t\t.filter(el => el.innerHTML.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t\t\t.map(el => el.innerHTML.match(this.MERCHANT_CODE_REGEX)[1]),\n\t\t\t\t),\n\t\t\t]);\n\t}\n\n\tgetExistingCodes() {\n\t\tlet checkoutCodes = [];\n\t\tif (window.location.href.includes('checkout')) {\n\t\t\tcheckoutCodes = [...document.querySelectorAll(this.CODE_CHECKOUT_SELECTOR)]\n\t\t\t\t.map(el => el.dataset.code)\n\t\t\t\t.filter(Boolean);\n\t\t}\n\t\tconst pageCodes = [...document.querySelectorAll(this.APPLIED_CODE_BLOCK_SELECTOR)]\n\t\t\t.map(\n\t\t\t\tel =>\n\t\t\t\t\tel.innerText.match(this.APPLIED_CODE_REGEX) || el.innerText.match(this.SPECIFIC_APPLIED_CODE_REGEX),\n\t\t\t)\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t\tconst codes = [...new Set([...pageCodes, ...this._parseCodesFromScript(), ...checkoutCodes])];\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0]);\n\t}\n\n\tbeforeCheckCodes() {\n\t\treturn this._parseTotal();\n\t}\n\n\tcheckCodes(codes, originalPrice) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code).then(async response => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\t\t\t\tif (!response || response.error) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tresult.finalPrice = await this._parseTotal();\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal(retry = false) {\n\t\treturn this._getOrderSummary().then(json => {\n\t\t\tif (json.status !== 'success' && !retry) {\n\t\t\t\treturn this.getPreTaxShippingTotal(true);\n\t\t\t}\n\t\t\tconst { totalPostSvng: discountTotal, estmShipping, payment } = json.cartSummary;\n\t\t\tconst shipping = estmShipping !== 'FREE' ? estmShipping : 0;\n\t\t\tif (!payment) {\n\t\t\t\thandleDriverError(new Error(`Cannot read property 'totalTaxes' of undefined`), json.cartSummary);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst tax = payment.totalTaxes;\n\t\t\treturn discountTotal - shipping - tax;\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(this.CART_URL, {\n\t\t\tmethod: 'GET',\n\t\t}).then(res => res.text());\n\t}\n\n\t_applyCode(code) {\n\t\tthis.addCodeParams.set('promoCode', code);\n\t\treturn this._manageCode(this.addCodeParams, 'add');\n\t}\n\n\t_removeCode(code) {\n\t\tthis.removeCodeParam.set('discountID', code);\n\t\treturn this._manageCode(this.removeCodeParam, 'remove');\n\t}\n\n\t_manageCode(urlParams, action) {\n\t\treturn fetch(`${this.CHECKOUT_MANAGE_CODE_URL}${action}`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: urlParams,\n\t\t\theaders: {\n\t\t\t\tAccept: 'application/json, text/javascript, */*; q=0.01',\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t},\n\t\t}).then(response => (response.status === 409 ? null : response.json()));\n\t}\n\n\t_parseCodesFromScript() {\n\t\treturn [...document.querySelectorAll('script')]\n\t\t\t.map(el => el.innerText.match(this.SCRIPT_CODES_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t}\n\n\t_getOrderSummary(url) {\n\t\treturn fetch(url || this.API_URL, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(res => res.json());\n\t}\n\n\t_parseTotal(retry = false) {\n\t\treturn this._getOrderSummary().then(json => {\n\t\t\tif (json.status !== 'success' && !retry) {\n\t\t\t\treturn this._parseTotal(true);\n\t\t\t}\n\t\t\treturn toFloat(json.cartSummary.totalPostSvng);\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Lane Bryant',\n\tdomain: 'lanebryant.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport DriverTemplate from './_base';\nimport { sessionTimer, backgroundMessaging } from '../../lib';\nimport { format, log, browserUtils, request, requestTypes } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { wait } = browserUtils;\n\n/* Driver behavior description:\n Existing code: no (was removed because we were getting codes by requests, and we're blocked by merchant)\n\tRemove code: yes\n\tStackable: no\n\tFree gift support: no\n\tisValid implemented: yes\n\tManually apply code: yes (only the last one)\n\tactive page: cart, checkout (payment step)\nOptional:\n\tShow message about free shipping on the cart page: no\n\tIs driver SPA and add the condition to show popup: yes\n\tGather codes on site pages: yes\n\tMax coupons: 3\n\tSession timer: 25 min\nSpecial Case:\n \tcodeTesting: once per 15 mins\n\tSometimes merchant blocks applyCode requests. We recieve response with status 403.\n\tIn this case we mark codes as invalid.\n\tIf there already is code applied on the cart we don't test codes, because there is\n\ta possibility that we remove code and price will be increased.\n*/\n\nconst DOMAIN = 'maurices.com';\nconst DOMAIN_URL = 'maurices.com';\n\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper(DOMAIN_URL);\n\t\tthis.PROPOSED_CODES_SELECTOR = '.coupon';\n\t\tthis.TOTAL_ELEMENT_CONFIG = {\n\t\t\tselector: '.asc-total-value, .order-summary-item-estimated-total .order-summary-content-right',\n\t\t};\n\n\t\tthis.EXISTING_CODE_SELECTOR = '.applied-promotions .mar-cart-label, #applied-promos';\n\t\tthis.EXISTING_CODE_REGEX = /\\[(\\w+)\\]/;\n\n\t\tthis.SHIPPING_STEP_SELECTOR = '#spa-checkout-shipping.saved';\n\t\tthis.PAYMENT_STEP_SELECTOR = '#spa-checkout-payment.saved';\n\n\t\tthis.CART_EMPTY_SELECTOR = '.asc-empty-cart-message';\n\n\t\tthis.DISABLE_TIME_MS = 15 * 60 * 1000; // 15 minutes\n\n\t\trequest.setType(requestTypes.embedded);\n\t}\n\n\tasync checkCondition() {\n\t\tconst { href } = window.location;\n\t\tlet isNotMaxCodeTesting = true;\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(DOMAIN);\n\t\tif (driverStorage) {\n\t\t\tconst dataExpired = Date.now() - driverStorage.lastTestTimestamp >= this.DISABLE_TIME_MS;\n\t\t\tif (dataExpired) {\n\t\t\t\tbackgroundMessaging.deleteDriverStorage(DOMAIN);\n\t\t\t} else {\n\t\t\t\tisNotMaxCodeTesting = driverStorage.codeTestingCount < 1;\n\t\t\t}\n\t\t}\n\n\t\tconst totalElem = document.querySelector(this.TOTAL_ELEMENT_CONFIG.selector);\n\t\tconst totalValue = totalElem ? elemToFloat(totalElem) : false;\n\t\tconst isOnCheckout = href.includes(`${this.merchantDomain}/${this.merchantName}/checkout`);\n\t\tconst shippingStepComplete = document.querySelector(this.SHIPPING_STEP_SELECTOR);\n\t\tconst paymentStepComplete = document.querySelector(this.PAYMENT_STEP_SELECTOR);\n\t\tconst cartEmptyElem = document.querySelector(this.CART_EMPTY_SELECTOR);\n\t\tconst isCartEmpty = cartEmptyElem ? cartEmptyElem.style.display === 'block' : false;\n\t\tconst isAccessDenied = document\n\t\t\t.querySelector('body')\n\t\t\t.textContent.toLowerCase()\n\t\t\t.includes('access denied');\n\n\t\treturn (\n\t\t\tisNotMaxCodeTesting &&\n\t\t\t!isAccessDenied &&\n\t\t\ttotalValue !== 0 &&\n\t\t\t((this.IS_ON_CART && !isCartEmpty) || (isOnCheckout && shippingStepComplete && !paymentStepComplete))\n\t\t);\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst dynSessConf = this.IS_ON_CART\n\t\t\t? document.querySelector(this.SESSION_CONF_SELECTOR).getAttribute('value')\n\t\t\t: Date.now();\n\t\tthis.applyQueryParams = new URLSearchParams({ pageId: 'UpdateCart' });\n\t\tthis.applyBodyData = new URLSearchParams({\n\t\t\tAction: 'Cart.validatePromo',\n\t\t\tsessionConfirmationNumber: dynSessConf,\n\t\t});\n\t\tthis.removeQueryParams = new URLSearchParams({ pageId: 'RemoveDiscount' });\n\t\tthis.removeBodyData = new URLSearchParams({\n\t\t\tAction: 'Cart.removeDiscountAction',\n\t\t\tdArgs: 'dArgs',\n\t\t\tsessionConfirmationNumber: dynSessConf,\n\t\t});\n\n\t\tthis.isExistingCode = document.querySelector(this.EXISTING_CODE_SELECTOR);\n\n\t\treturn this.isExistingCode\n\t\t\t? Promise.resolve()\n\t\t\t: this._getFirstCode().then(code => (code ? this._removeCodesRecursively(code) : Promise.resolve()));\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [...document.querySelectorAll(this.PROPOSED_CODES_SELECTOR)].map(el => el.textContent).filter(Boolean);\n\t}\n\n\tgetExistingCodes() {\n\t\t// don't get existing codes, because we are not doing retesting (please add, when merchant doesn't block as)\n\t\treturn {\n\t\t\tcodes: [],\n\t\t\tcodeCount: 0,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 25,\n\t\t});\n\t}\n\n\tasync beforeApplyCodes() {\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(DOMAIN);\n\t\tconst codeTestingCount = driverStorage ? driverStorage.codeTestingCount : 0;\n\t\tbackgroundMessaging.setDriverStorage(DOMAIN, {\n\t\t\tcodeTestingCount: codeTestingCount + 1,\n\t\t\tlastTestTimestamp: Date.now(),\n\t\t});\n\t\treturn Promise.resolve();\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(this.lastResponse)) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\n\t\t\tif (this.isExistingCode) {\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t}\n\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tresult.finalPrice = this._parseTotal(responseJSON);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\tif (responseJSON && result.finalDiscount > 0) {\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this.isExistingCode ? Promise.resolve() : this._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(json => {\n\t\t\tconst total = json.cartSummary.totalPostSvng;\n\t\t\tconst shipping = toFloat(json.cartSummary.estmShipping) || 0;\n\t\t\tconst tax = json.cartSummary.payment.totalTaxes;\n\t\t\treturn total - shipping - tax;\n\t\t});\n\t}\n\n\t_applyCode(code, tryNumber = 1) {\n\t\tthis.applyBodyData.set(this.APPLY_CODE_PARAM, code);\n\t\treturn Promise.delay(3000).then(() =>\n\t\t\trequest\n\t\t\t\t.post(`${this.MANAGE_CODE_URL}?${this.applyQueryParams.toString()}`, this.applyBodyData, {\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tAccept: 'application/json, text/javascript, */*; q=0.01',\n\t\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\t\t\t'content-type': 'application/x-www-form-urlencoded; charset=UTF-8',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then(response => {\n\t\t\t\t\tif (response.status === 403 && tryNumber < 2) {\n\t\t\t\t\t\treturn this._openIframe().then(() => this._applyCode(code, tryNumber + 1));\n\t\t\t\t\t}\n\t\t\t\t\treturn response.status !== 200 ? null : response.json();\n\t\t\t\t}),\n\t\t);\n\t}\n\n\tasync _openIframe() {\n\t\t// need to open cart page in iframe to load cookies required for success code apply\n\t\tconst iframeElem = document.createElement('iframe');\n\t\tiframeElem.src = `https://www.${DOMAIN_URL}/maurices/cart/cart.jsp`;\n\t\tObject.assign(iframeElem.style, { display: 'none' });\n\t\tdocument.documentElement.appendChild(iframeElem);\n\t\tawait wait(() => iframeElem.contentDocument.readyState === 'complete', 20000, 5000);\n\t\tiframeElem.remove();\n\t\treturn Promise.resolve();\n\t}\n\n\t_getFirstCode() {\n\t\treturn this._applyCode('fake-rmn-genie-code').then(\n\t\t\tresponseJSON =>\n\t\t\t\tresponseJSON &&\n\t\t\t\tBoolean(responseJSON.data.cartSummary.savings) &&\n\t\t\t\tresponseJSON.data.cartSummary.savings[0].CouponId,\n\t\t);\n\t}\n\n\t// need to remove codes in such way because when we remove one code there the previous one will be on the page\n\t_removeCodesRecursively(code) {\n\t\tthis.existingCodes = [code];\n\t\tlet lastResponse = null;\n\t\tlet nextCode = code;\n\t\tconst arr = [...new Array(15)];\n\n\t\treturn Promise.each(arr, () =>\n\t\t\tthis._removeCode(nextCode).then(responseJSON => {\n\t\t\t\tlastResponse = responseJSON;\n\t\t\t\tnextCode =\n\t\t\t\t\tBoolean(responseJSON.data.cartSummary.savings) && responseJSON.data.cartSummary.savings[0].CouponId;\n\t\t\t\tif (nextCode) {\n\t\t\t\t\tthis.existingCodes.push(nextCode);\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t\treturn Promise.reject(new Error());\n\t\t\t}),\n\t\t).catch(() => {\n\t\t\tthis.originalTotal = this._parseTotal(lastResponse);\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(`https://www.${DOMAIN_URL}/api/v1/cart/summary?_=${Date.now()}`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.json());\n\t}\n\n\t_parseTotal(objJSON) {\n\t\tif (objJSON) {\n\t\t\treturn toFloat(objJSON.data.cartSummary.totalPostSvng);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_ELEMENT_CONFIG.selector));\n\t}\n};\n\nexport default {\n\tname: 'Maurices',\n\tdomain: 'maurices.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tmaxCoupons: 3,\n};\n","import Promise from 'bluebird';\nimport DriverTemplate from './_base';\nimport BaseTemplate from '../base';\nimport bus from '../../bus';\nimport { log, format } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { toFloat, elemToFloat } = format;\n\n/** Behavior:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable:  no\n+ Free gift support:  no\n+ Free shipping:  no\n+ isValid implemented: yes\n+ Manually apply code: yes (checkout)\n+ Pages, where extension works: cart, checkout\n+ Is driver SPA yes\n+ Gather codes on site pages:  no\n+ Special case about the driver works (if it needed).\n   - sessionTimer yes (15min)\n * * */\n\nconst DOMAIN_NAME = 'justice';\nconst DOMAIN_URL = 'shopjustice.com';\nconst isOnCart = () => window.location.href.includes('/cart/cart.jsp');\n\nconst DriverCart = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper(DOMAIN_URL);\n\t\tthis.MANAGE_CODE_URL = `https://www.${DOMAIN_URL}/${DOMAIN_NAME}/baseAjaxServlet`;\n\t\tthis.INPUT_SELECTOR = '#mar-cart-promo-code';\n\t\tthis.EMPTY_SELECTOR = '#asc-cart-order-summary[style*=\"display: none\"]';\n\t\tthis.TOTAL_SELECTOR = '.asc-total-value';\n\t\tthis.SHIPPING_SELECTOR = '.mar-order-summary-shipping-charge span';\n\t\tthis.TAX_SELECTOR = '.asc-tax-value';\n\t\tthis.LOADER_SELECTOR = '.asc-global-indicator.show';\n\n\t\t// this flag true for stackable sites\n\t\tthis.isStackable = false;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst isOnHref = window.location.href.includes(`${DOMAIN_URL}/justice/cart/cart.jsp`);\n\t\tconst isEmpty = document.querySelector(this.EMPTY_SELECTOR);\n\t\tconst isTotal = (document.querySelector(this.TOTAL_SELECTOR) || {}).offsetParent;\n\t\tconst inputElement = document.querySelector(this.INPUT_SELECTOR);\n\t\tconst isInput = inputElement && inputElement.offsetParent;\n\t\tconst isLoader = document.querySelector(this.LOADER_SELECTOR);\n\t\tconst currentState = isOnHref && !isEmpty && isTotal && isInput && !isLoader;\n\t\treturn currentState;\n\t}\n\n\t_getCodesFromPage() {\n\t\treturn this._applyCode('fake-code').then(responseJSON => this._getCodesFromResponse(responseJSON));\n\t}\n\n\tapplyCodes(codes) {\n\t\twindow.history.replaceState(window.history.state, window.document.title, window.location.href.split('?')[0]);\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tlet shipping;\n\t\tlet total;\n\t\tlet tax;\n\t\tconst APPLY_RESPONSE = await this._applyCode('fake-code');\n\t\tif (APPLY_RESPONSE) {\n\t\t\ttotal = this._parseTotal(APPLY_RESPONSE);\n\t\t\tshipping = toFloat(\n\t\t\t\tAPPLY_RESPONSE.data.cartSummary.estmShipping.toLowerCase() === 'free'\n\t\t\t\t\t? 0\n\t\t\t\t\t: APPLY_RESPONSE.data.cartSummary.estmShipping,\n\t\t\t);\n\t\t\ttax = toFloat(APPLY_RESPONSE.data.cartSummary.payment.totalTaxes);\n\t\t} else {\n\t\t\ttotal =\n\t\t\t\tdocument.querySelector(this.TOTAL_SELECTOR) && elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t\t\tconst shippingEl = document.querySelector(this.SHIPPING_SELECTOR);\n\t\t\tshipping =\n\t\t\t\tshippingEl.textContent.toLowerCase() === 'free'\n\t\t\t\t\t? 0\n\t\t\t\t\t: elemToFloat(document.querySelector(this.SHIPPING_SELECTOR));\n\t\t\ttax = document.querySelector(this.TAX_SELECTOR) && elemToFloat(document.querySelector(this.TAX_SELECTOR));\n\t\t}\n\n\t\treturn total - shipping - tax;\n\t}\n};\n\nconst DriverCheckout = class Driver extends BaseTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.API_URL = `https://www.${DOMAIN_URL}/api/v1`;\n\t\tthis.INPUT_SELECTOR = '[name=\"promo-code\"]';\n\t\tthis.APPLIED_CODES_SELECTOR = '.promo-item-remove';\n\t\tthis.PAYMENT_SELECTOR = '.payment-container';\n\t\tthis.TOTAL_SELECTOR = '.order-summary-item-estimated-total .order-summary-content-right';\n\t\tthis.EMPTY_SELECTOR = '.sidebar-group-header-count';\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst isOnHref = window.location.href.includes(`${DOMAIN_URL}/justice/checkout`);\n\t\tconst isEmpty = document.querySelector(this.EMPTY_SELECTOR)\n\t\t\t? document.querySelector(this.EMPTY_SELECTOR).innerText === '0 item'\n\t\t\t: false;\n\t\tconst isTotal = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst isInput = document.querySelector(this.INPUT_SELECTOR);\n\t\tconst isPayment = document.querySelector(this.PAYMENT_SELECTOR);\n\t\tconst isActivePayment = isPayment ? isPayment.style.overflow : false;\n\t\tconst currentState = isOnHref && !isEmpty && isTotal && isInput && !isActivePayment;\n\t\treturn currentState;\n\t}\n\n\tbeforeTestCodes() {\n\t\treturn this._getSessionNumber().then(responseJSON => {\n\t\t\tthis.applyBodyData = {\n\t\t\t\t_dynSessConf: responseJSON.Progress.checkoutState.sessionConfirmationNumber,\n\t\t\t};\n\t\t\tthis.removeBodyData = this.applyBodyData;\n\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.APPLIED_CODES_SELECTOR)].map(\n\t\t\tcodeElement => codeElement.dataset.code,\n\t\t);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0])\n\t\t\t.then(() => this._getOrderInfo())\n\t\t\t.then(responseJSON => this._parseTotal(responseJSON));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tif (responseJSON.status === 'success') {\n\t\t\t\t\treturn this._getOrderInfo().then(responseCartJSON => {\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseCartJSON);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\t\tthis._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tasync getPreTaxShippingTotal() {\n\t\tconst checkoutData = await this._getOrderInfo();\n\t\tconst total = this._parseTotal(checkoutData);\n\n\t\tconst shipping = toFloat(\n\t\t\tcheckoutData.cartSummary.estmShipping.toLowerCase() === 'free' ? 0 : checkoutData.cartSummary.estmShipping,\n\t\t);\n\t\tconst tax = toFloat(checkoutData.cartSummary.payment.totalTaxes);\n\t\treturn total - shipping - tax;\n\t}\n\n\t_applyCode(code) {\n\t\tthis.applyBodyData.promoCode = code;\n\t\treturn this._manageCode(this.applyBodyData, 'add');\n\t}\n\n\t_removeCode(code) {\n\t\tthis.removeBodyData.discountID = code;\n\t\treturn this._manageCode(this.removeBodyData, 'remove');\n\t}\n\n\t_manageCode(bodyData, action) {\n\t\treturn fetch(`${this.API_URL}/order/promo/${action}`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\tbody: JSON.stringify(bodyData),\n\t\t\theaders: {\n\t\t\t\t'content-type': 'application/json; charset=UTF-8',\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t\tclientid: 'asc_web',\n\t\t\t},\n\t\t}).then(response => response.json());\n\t}\n\n\t_getSessionNumber() {\n\t\treturn fetch(`${this.API_URL}/order/checkout/state`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t}).then(response => response.json());\n\t}\n\n\t_getOrderInfo() {\n\t\treturn fetch(`${this.API_URL}/cart/summary`, {\n\t\t\tmethod: 'GET',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\tclientid: 'asc_web',\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t},\n\t\t}).then(response => response.json());\n\t}\n\n\t_parseTotal(objJSON) {\n\t\tif (objJSON) {\n\t\t\treturn toFloat(objJSON.cartSummary.totalPostSvng);\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'Shop Justice',\n\tdomain: 'shopjustice.com',\n\tDriver: isOnCart() ? DriverCart : DriverCheckout,\n\tisSinglePageApp: true,\n};\n"],"sourceRoot":""}