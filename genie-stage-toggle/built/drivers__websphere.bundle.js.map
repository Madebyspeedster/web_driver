{"version":3,"sources":["webpack:///./src/inject/drivers/base.js","webpack:///./src/inject/drivers/websphere/1800baskets.com.js","webpack:///./src/inject/drivers/websphere/1800flowers.com.js","webpack:///./src/inject/drivers/websphere/_base.js","webpack:///./src/inject/drivers/websphere/cheryls.com.js","webpack:///./src/inject/drivers/websphere/fruitbouquets.com.js","webpack:///./src/inject/drivers/websphere/harryanddavid.com.js","webpack:///./src/inject/drivers/websphere/index.js","webpack:///./src/inject/drivers/websphere/menswearhouse.com.js","webpack:///./src/inject/drivers/websphere/targetoptical.com.js","webpack:///./src/inject/drivers/websphere/thepopcornfactory.com.js","webpack:///./src/inject/drivers/websphere/timberland.com.js","webpack:///./src/inject/drivers/websphere/totalwireless.com.js","webpack:///./src/inject/drivers/websphere/wolfermans.com.js"],"names":["toFloat","format","BaseDriver","watchForRestoreUserData","time","pauseInterval","interval","setInterval","currentState","checkRestoreDataCondition","clearInterval","bus","$emit","e","handleDriverError","source","storeUserData","domain","userData","getUserData","Promise","resolve","userDataKey","getUserDataStorageKey","storageRecord","storedTime","Date","now","backgroundMessaging","setDriverStorage","log","restoreUserData","maxStorageLifetime","driverStorage","getDriverStorage","deleteDriverStorage","setUserData","getStartPrice","startPrice","Number","MAX_SAFE_INTEGER","totalElementConfig","TOTAL_ELEMENT_CONFIG","selector","attribute","regex","totalElement","Array","isArray","forEach","elemSelector","document","querySelector","Error","value","getAttribute","textContent","pattern","group","match","beforeTestCodes","beforeCheckCodes","beforeApplyCodes","checkCodes","applyCodes","stackCodes","removeCodes","getMerchantCodes","getExistingCodes","codes","codeCount","getPreTaxShippingTotal","watchForCartUrl","previousState","checkCondition","completeExperience","completeExperiencePromisified","args","_promisify","beforeTestCodesPromisified","getStartPricePromisified","getMerchantCodesPromisified","getExistingCodesPromisified","removeCodesPromisified","beforeApplyCodesPromisified","applyCodesPromisified","beforeCheckCodesPromisified","checkCodesPromisified","stackCodesPromisified","method","then","apply","elemToFloat","extractElement","extractFormValues","DOM","isCartCheckoutVersion","DriverCartCheckoutVersion","Driver","DriverTemplate","constructor","TOTAL_SELECTOR","REMOVE_FORM_SELECTOR","APPLY_FORM_DATA","APPLY_FORM_SELECTOR","REMOVE_FORM_DATA","UPDATE_FORM_DATA","UPDATE_FORM_SELECTOR","_getUpdatedCart","_manageCode","BASE_URL","_parseTotal","data","TOTAL_SIBLING_SELECTOR","previousElementSibling","DriverCheckoutVersion","sessionTimer","initialize","actionInterval","timeout","name","completionAction","completionActions","default","revisit","isSinglePageApp","isOnCartUrl","href","startsWith","isCartEmpty","wait","browserUtils","extractData","setValue","DOMAIN","PWA_DOMAIN","isPWA","window","location","includes","NotPwaDriver","PRICES_SELECTOR","PRICE_SELECTOR","SHIPPING_REGEX","SKIP_CODE_TESTING","originalPrice","each","code","result","finalPrice","finalDiscount","isValid","_applyCode","responseJSON","_codeAppliedCheck","responseHTML","_removeCode","response","shipping","_getShippingValue","taxEl","_findElement","tax","filter","element","map","urlString","body","fetch","credentials","status","text","lastResponse","JSON","parse","PwaDriver","PROMO_CODE_FORM","PAYMENT_SELECTOR","MEMBER_SELECTOR","REMOVE_BUTTON_SELECTOR","APPLY_BUTTON_SELECTOR","TOTAL_STRING","PROMO_REGEXP","request","setType","requestTypes","embedded","rightUrl","isPromoInput","isRemove","totalLabelElem","querySelectorAll","find","el","innerText","isTotal","nextElementSibling","paymentEl","memberEl","userInfo","localStorage","getItem","itemsInfo","items","hasPassport","changedItems","productBase","brandCode","product","deliveryDate","deliveryDateFlexOption","deliveryDateSelectedFlexOption","deliveryDateDtwId","deliveryDateSelectedDtwOption","ttl","productPageSearchParams","addOnsSkus","deliveryDateQuery","shippingCountry","personalization","requestData","customerId","contactId","customerType","promoMembershipNumber","paymentType","giftCards","passport","Set","Boolean","length","buttons","click","total","errors","lastCode","_manuallyApplyCode","totals","merchandise","promoCode","headers","stringify","json","inputs","none","maxCoupons","merchantDomain","APPLIED_CODES_SELECTOR","SHIPPING_FORM_SELECTOR","CODE_INPUT_SELECTOR","APPLIED_CODE_MSG_SELECTOR","BASE_REQUEST_URL","APPLY_CODE_END_POINT","APPLY_URL","EMPTY_SELECTOR","GIFT_MSG_FORM_SELECTOR","getPureTotal","isOnHref","price","isInput","offsetParent","isAppliedCodeMsgSelector","isEmpty","shippingFormActive","giftMsgFormActive","shippingDiscountEl","shippingDiscount","targetString","targetEl","removeURL","params","set","successFlag","pathname","MERCHANT_CODES_SELECTOR","MERCHANT_CODES_REGEXP","_getMainPage","elem","_1800baskets","_1800flowers","cheryls","fruitbouquets","harryanddavid","menswearhouse","targetoptical","timberland","totalwireless","thepopcornfactory","wolfermans","API_URL","MANAGE_CODE_URL","UPDATE_TOTAL_URL","CART_URL","CHECKOUT_URL","APPLIED_CODE_SELECTOR","FORM_SELECTOR","SHIPPING_TAB_SELECTOR","CHARGES_SELECTOR","CHARGES_REGEX","codeInput","isOnCheckout","isOnCart","shippingTabActive","existingCodeElement","trim","formData","charges","chargeEl","charge","matched","reduce","a","b","_updateTotal","delete","res","url","referrerPolicy","mode","EMPTY_CARD_SELECTOR","MERCHANT_CODES_REGEX","SHIPPING_METHOD_SELECTOR","TAX_SELECTOR","MANAGE_CODE_END_POINT","GET_ORDER_ID_END_POINT","FORM_DATA","codeElement","shippingMethod","checked","id","shippingElement","className","_getOrderId","query","action","split","CART_EMPTY_SELECTOR","IS_ON_CART","REQUEST_URL","EXISTING_CODE_SELECTOR","APPLY_CODE_FORM_SELECTOR","REMOVE_CODE_FORM_SELECTOR","GOODS_SELECTOR","CALCULATE_FORM_SELECTOR","CHECKOUT_FORM_SELECTOR","SHIPPING_SELECTOR","SHIPPING_UPDATE_SEL","PICKUP_PAGE_SELECTOR","BILLING_INPUT_SELECTOR","HEADERS","isSummary","savedBillingAddress","goodsInCart","SHIPPING_METHOD_ID","_getShippingMethodId","shippingUpdateParams","item","orderItemIds","index","calculateRequestParams","updateCheckoutParams","applyForm","removeForm","_getOrderCalculate","responseText","errorMessage","_updateShipping","post","amounts","totalTax","shippingCharge","test","get","toString","grandTotalValue","_getUpdatedCheckout","retry","CODE_REGEX","INPUT_ELEM_SELECTOR","EMPTY_CART_SELECTOR","ERROR_REGEXP","emptyCartElement","inputEl","bodyData","updateCartParams","URLSearchParams","storeId","catalogId","langId","isBundleOfferFlow","updateCartBodyData","objectId","requesttype","type","_manageUrl"],"mappings":"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","file":"drivers__websphere.bundle.js","sourcesContent":["import bus from '../bus';\nimport { log, format } from '../../utils';\nimport { backgroundMessaging, handleDriverError } from '../lib';\n\nconst { toFloat } = format;\n\nexport default class BaseDriver {\n\t/**\n\t * @function watchForRestoreUserData - set up a listener to check user data restorement\n\t * @emits bus#RestoreUserData - the event that indicates to the app\tthat user data could be restored\n\t */\n\twatchForRestoreUserData(time = 500) {\n\t\tlet pauseInterval = false;\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tconst currentState = await this.checkRestoreDataCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t\tif (currentState) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tbus.$emit('restore-user-data');\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkRestoreDataCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t}\n\t\t}, time);\n\n\t\treturn interval;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * @function storeUserData\n\t * @param {String} domain - domain to set the driver storage\n\t * @returns {Promise}\n\t */\n\tasync storeUserData(domain) {\n\t\tconst userData = await this.getUserData();\n\n\t\tif (userData === null) {\n\t\t\t// Nothing to store\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst storageRecord = {\n\t\t\tuserData,\n\t\t\tstoredTime: Date.now(),\n\t\t};\n\t\tbackgroundMessaging.setDriverStorage(userDataKey, storageRecord);\n\t\tlog('Stored user data: %O', storageRecord);\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function restoreUserData\n\t * @param {String} domain - domain to access the driver storage\n\t * @param {Number} [maxStorageLifetime] - optional, the lifetime of the stored data (default 10 mins)\n\t * @returns {Promise}\n\t */\n\tasync restoreUserData(domain, maxStorageLifetime = 600000) {\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(userDataKey);\n\n\t\tif (driverStorage) {\n\t\t\tconst { storedTime, userData } = driverStorage;\n\t\t\t// Clear stored user data\n\t\t\tbackgroundMessaging.deleteDriverStorage(userDataKey);\n\n\t\t\tif (Date.now() - storedTime <= maxStorageLifetime) {\n\t\t\t\tlog('Restore user data: %O', userData);\n\t\t\t\treturn this.setUserData(userData);\n\t\t\t}\n\t\t\tlog('User data is outdated, skip restoring');\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserData - get user data which should be stored\n\t * @returns {Object} - object with required user data which should be restored\n\t */\n\tgetUserData() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function setUserData - restore user data on page\n\t * @param {Object} userData - data which was saved and should be restored\n\t * @returns {Promise}\n\t */\n\tsetUserData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserDataStorageKey - unique key for storing user data per merchant\n\t * @returns {String}\n\t */\n\tgetUserDataStorageKey(domain) {\n\t\t// Append `_userData` to avoid possible conflicts with created storage from driver\n\t\treturn `${domain}_userData`;\n\t}\n\n\t/**\n\t * Parses start price from page\n\t *\n\t * @function getStartPrice\n\t * @returns {Promise<Number>|Number} - the total from the page\n\t */\n\tgetStartPrice() {\n\t\tlet startPrice = Number.MAX_SAFE_INTEGER;\n\t\tconst totalElementConfig = this.TOTAL_ELEMENT_CONFIG;\n\t\tif (totalElementConfig) {\n\t\t\tconst { selector, attribute, regex } = totalElementConfig;\n\t\t\tlet totalElement;\n\t\t\t// handle case, when there is array of selectors and we try to take totalElement using these selectors in turn\n\t\t\t// for example dell.com, hertz.com\n\t\t\tif (Array.isArray(selector)) {\n\t\t\t\tselector.forEach(elemSelector => {\n\t\t\t\t\tif (!totalElement) {\n\t\t\t\t\t\ttotalElement = document.querySelector(elemSelector);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\ttotalElement = document.querySelector(selector);\n\t\t\t} else {\n\t\t\t\thandleDriverError(\n\t\t\t\t\tnew Error(`Total selector type mismatch. Expected string | array, got ${typeof selector}`),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (totalElement) {\n\t\t\t\tlet value = attribute ? totalElement.getAttribute(attribute) : totalElement.textContent;\n\n\t\t\t\tif (value && regex) {\n\t\t\t\t\t// Set pattern to null to receive error in case pattern was not defined\n\t\t\t\t\t// otherwise we may silently return undefined or empty string\n\t\t\t\t\tconst { pattern = null, group = 0 } = regex;\n\t\t\t\t\tvalue = value.match(pattern)[group];\n\t\t\t\t}\n\t\t\t\tstartPrice = toFloat(value);\n\t\t\t}\n\t\t}\n\t\treturn startPrice;\n\t}\n\n\t/**\n\t * Perform any needed actions and setup to start codes testing\n\t *\n\t * @function beforeTestCodes\n\t *\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @typedef {Object} OriginalData\n\t * @property {Number} originalPrice the starting price for the cart\n\t * @property {Number} originalItemsCount the starting items count of the cart\n\t */\n\t/**\n\t * Perform any needed actions and setup before `checkCodes()` will be executed\n\t *\n\t * @function beforeCheckCodes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tbeforeCheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Perform any needed actions and setup before `applyCodes()` will be executed\n\t *\n\t * @function beforeApplyCodes\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function checkCodes\n\t *\n\t * @param {String[]} codes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise}\n\t */\n\tcheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes each code in @param codes and actually applies it to the cart,\n\t * typically through a fetch(...) call.\n\t *\n\t * @function applyCodes\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tapplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function stackCodes\n\t *\n\t * @param {Object} validationInfo - contains all required info passed by `checkCodes()` for codes stacking\n\t * @param {String[]} validationInfo.codes\n\t * @param {Float} [validationInfo.originalPrice]\n\t * @param {Object[]} [validationInfo.discounts] - contains all codes mapped with their discounts\n\t * @returns {Promise}\n\t */\n\tstackCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function removeCodes\n\t *\n\t * @param {String[]} codes - passed in case the driver needs to know specific codes to do removal\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request response) which are available and were not applied by user\n\t *\n\t * @function getMerchantCodes\n\t * @returns {String[]} - codes from merhcant page (or request response if possible)\n\t */\n\tgetMerchantCodes() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request) which are available and were applied by user\n\t *\n\t * @typedef {Object} ExistingCodeInfo\n\t * @prop {String[]} codes - list of codes which had been applied, if discoverable\n\t * @prop {Number} codeCount - the number of codes that were applied to the cart\n\t */\n\t/**\n\t * @function getExistingCodes\n\t * @returns {ExistingCodeInfo}\n\t */\n\tgetExistingCodes() {\n\t\treturn {\n\t\t\tcodes: [],\n\t\t\tcodeCount: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Parses pre tax and shipping total from page or request's response\n\t *\n\t * @function getPreTaxShippingTotal\n\t * @returns {Promise<Number>|Number} - the total without tax and shipping\n\t */\n\tgetPreTaxShippingTotal() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function watchForCartUrl - optional function to set up a listener for url changes on SPAs\n\t * @emits bus#CartActive - the event (using the string 'cart-active') that indicates to the app that test codes button should be shown\n\t * @emits bus#CartInactive - the event (using the string 'cart-inactive') that indicates to the app that test codes button should be hidden\n\t */\n\twatchForCartUrl(time = 500) {\n\t\tlet previousState = null;\n\t\tlet pauseInterval = false;\n\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\tlet currentState = null;\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tcurrentState = await this.checkCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t\tif (currentState !== previousState) {\n\t\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t\t}\n\t\t\t\tpreviousState = currentState;\n\t\t\t}\n\t\t}, time);\n\t\t// return the interval to stop it in `watchForCartUrl` if needed from outside\n\t\treturn interval;\n\t}\n\n\t/**\n\t * @function checkCondition - optional function to check for conditions on SPAs\n\t * @returns {Boolean}\n\t */\n\tcheckCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Perform custom completion action on Continue to Checkout button\n\t * Takes best codes in @param codes\n\t *\n\t * @function completeExperience\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tcompleteExperience() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function completeExperiencePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcompleteExperiencePromisified(...args) {\n\t\treturn this._promisify(this.completeExperience, args);\n\t}\n\n\t/**\n\t * @function beforeCodesTestingPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeTestCodes, args);\n\t}\n\n\t/**\n\t * @function getStartPricePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetStartPricePromisified() {\n\t\treturn this._promisify(this.getStartPrice);\n\t}\n\n\t/**\n\t * @function getMerchantCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetMerchantCodesPromisified(...args) {\n\t\treturn this._promisify(this.getMerchantCodes, args);\n\t}\n\n\t/**\n\t * @function getExistingCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetExistingCodesPromisified(...args) {\n\t\treturn this._promisify(this.getExistingCodes, args);\n\t}\n\n\t/**\n\t * @function removeCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tremoveCodesPromisified(...args) {\n\t\treturn this._promisify(this.removeCodes, args);\n\t}\n\n\t/**\n\t * @function beforeApplyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeApplyCodes, args);\n\t}\n\n\t/**\n\t * @function applyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tapplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.applyCodes, args);\n\t}\n\n\t/**\n\t * @function beforeCheckCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeCheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeCheckCodes, args);\n\t}\n\n\t/**\n\t * @function checkCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.checkCodes, args);\n\t}\n\n\t/**\n\t * @function stackCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tstackCodesPromisified(...args) {\n\t\treturn this._promisify(this.stackCodes, args);\n\t}\n\n\t/**\n\t * @function _promisify - promisifies given method and return it's result as a Promise\n\t * @returns {Promise}\n\t */\n\t_promisify(method, args) {\n\t\treturn Promise.resolve().then(() => method.apply(this, args));\n\t}\n}\n","import DriverTemplate from './_base';\nimport { sessionTimer } from '../../lib';\nimport { format, DOM, completionActions } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement, extractFormValues } = DOM;\n\nconst isCartCheckoutVersion = document.querySelector('.price-cart-summary');\n\n/*\nDriver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    'isValid' implemented: yes\n•     Codes can be replaced by another code: no\n•    Manually apply code: no\n•    Is driver SPA and add the condition to show popup: yes\n•    sessionTimer 15 min\n•    pages, where extension works: Cart, Checkout\n•    Special case: get Total price with shipping,\n     so total and final price in console will be wrong, but discount will be right\n*/\n\nconst DriverCartCheckoutVersion = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper('1800baskets.com');\n\n\t\tthis.TOTAL_SELECTOR = '.price-cart-summary';\n\t\tthis.REMOVE_FORM_SELECTOR = '#AjaxRESTRemovePromoCodeForWidget';\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.APPLY_FORM_DATA = extractFormValues(this.APPLY_FORM_SELECTOR);\n\t\tthis.REMOVE_FORM_DATA = document.querySelector(this.REMOVE_FORM_SELECTOR).getAttribute('value');\n\t\tthis.UPDATE_FORM_DATA = document.querySelector(this.UPDATE_FORM_SELECTOR).getAttribute('value');\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn this._manageCode(`${this.BASE_URL}${this.UPDATE_FORM_DATA}`, 'POST');\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn elemToFloat(\n\t\t\textractElement(this.TOTAL_SIBLING_SELECTOR, data).previousElementSibling.querySelector(this.TOTAL_SELECTOR),\n\t\t);\n\t}\n};\n\n/*\nDriver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    'isValid' implemented: yes\n•     Codes can be replaced by another code: no\n•    Manually apply code: no\n•    Page, where extension works: Checkout\n•    Is driver SPA and add the condition to show popup: no\n•    sessionTimer 15 min\n*/\nconst DriverCheckoutVersion = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper('1800baskets.com');\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n};\n\nexport default {\n\tname: '1800Baskets',\n\tdomain: '1800baskets.com',\n\tDriver: isCartCheckoutVersion ? DriverCartCheckoutVersion : DriverCheckoutVersion,\n\tcompletionAction: isCartCheckoutVersion ? completionActions.default : completionActions.revisit,\n\tisSinglePageApp: DriverCartCheckoutVersion,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith(`https://www.1800flowers.com/webapp/wcs/stores/servlet/FDPlaceOrderDisplayCmd`) &&\n\t\t\tdocument.querySelector('#promoCode')\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.ECP-emptycart');\n\t},\n};\n","import Promise from 'bluebird';\nimport DriverTemplate from './_base';\nimport bus from '../../bus';\nimport { sessionTimer, handleDriverError } from '../../lib';\nimport { DOM, completionActions, format, log, request, requestTypes, browserUtils } from '../../../utils';\n\nconst { wait } = browserUtils;\nconst { extractData, setValue } = DOM;\nconst { toFloat, elemToFloat } = format;\n\nconst DOMAIN = '1800flowers.com';\nconst PWA_DOMAIN = `pwa.www.${DOMAIN}`;\nconst isPWA = window.location.href.includes('pwa');\n\n/*\nDriver behavior description:\n•\tExisting code: yes\n•\tRemove code: yes\n•\tStackable: no\n•\tFree gift support: no\n•\t'isValid' implemented: yes\n•\tCodes can be replaced by another code: no / yes (pwa)\n•\tPage, where extension works:\n                 1800flowers: Checkout,\n                 pwa.1800flowers: review page\n•\tIs driver SPA and add the condition to show popup: no / yes (pwa)\n•\tsessionTimer 15 min\n*/\n\nconst NotPwaDriver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper(DOMAIN);\n\t\tthis.PRICES_SELECTOR = '[class*=total-label] [class*=row]';\n\t\tthis.PRICE_SELECTOR = '[class*=PaddingSpace][class*=col2]';\n\t\tthis.SHIPPING_REGEX = /\"order_shipping\": \"(.+)/i;\n\t\tthis.SKIP_CODE_TESTING = false;\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = { code, finalPrice: originalPrice, finalDiscount: 0, isValid: false };\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tif (this.SKIP_CODE_TESTING) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tif (!this._codeAppliedCheck(responseJSON)) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseHTML);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst shipping = toFloat(this._getShippingValue(response)) || 0;\n\t\t\t// tax not always present on the page\n\t\t\tconst taxEl = this._findElement('Estimated Tax', response);\n\t\t\tconst tax = taxEl ? elemToFloat(taxEl) || 0 : 0;\n\t\t\treturn this._parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\t_getShippingValue(response) {\n\t\treturn [...extractData('script', response, true)]\n\t\t\t.filter(element => element.match(this.SHIPPING_REGEX))\n\t\t\t.map(element => element.match(this.SHIPPING_REGEX)[1])[0];\n\t}\n\n\t_manageCode(urlString, method, body) {\n\t\treturn fetch(urlString, { method, credentials: 'include', body })\n\t\t\t.then(response => {\n\t\t\t\tthis.SKIP_CODE_TESTING = false;\n\t\t\t\tif (response.status !== 200) {\n\t\t\t\t\tthis.SKIP_CODE_TESTING = true;\n\t\t\t\t\thandleDriverError(new Error('Invalid response'), {\n\t\t\t\t\t\tresponse,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn response.text();\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\t// Return JSON if it is possible\n\t\t\t\ttry {\n\t\t\t\t\tthis.lastResponse = JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.lastResponse = response;\n\t\t\t\t}\n\n\t\t\t\treturn this.lastResponse;\n\t\t\t});\n\t}\n};\n\nconst PwaDriver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper(PWA_DOMAIN);\n\t\tthis.PROMO_CODE_FORM = '[name=\"promoCode\"]';\n\t\tthis.PAYMENT_SELECTOR = '[type=\"radio\"]:checked';\n\t\tthis.MEMBER_SELECTOR = '[name=\"promoMembershipNumber\"]';\n\t\tthis.REMOVE_BUTTON_SELECTOR = '[aria-label=\"Remove\"]';\n\t\tthis.APPLY_BUTTON_SELECTOR = '[aria-label=\"apply\"]';\n\t\tthis.TOTAL_STRING = 'Order Total:';\n\t\tthis.PROMO_REGEXP = /(\\w+) has been applied/;\n\t\trequest.setType(requestTypes.embedded);\n\t}\n\n\twatchForCartUrl() {\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: super.watchForCartUrl(),\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst rightUrl = window.location.href.includes('/review');\n\t\tconst isPromoInput = document.querySelector(this.PROMO_CODE_FORM);\n\t\tconst isRemove = document.querySelector(this.REMOVE_BUTTON_SELECTOR);\n\t\tconst totalLabelElem = [...document.querySelectorAll('div')].find(el => el.innerText === this.TOTAL_STRING);\n\t\tconst isTotal = totalLabelElem && totalLabelElem.nextElementSibling;\n\t\treturn (isPromoInput || isRemove) && rightUrl && isTotal && this._parseTotal();\n\t}\n\n\tbeforeTestCodes() {\n\t\tconst paymentEl = document.querySelector(this.PAYMENT_SELECTOR);\n\t\tconst memberEl = document.querySelector(this.MEMBER_SELECTOR);\n\t\tconst userInfo = JSON.parse(localStorage.getItem('@flowers/auth/user'));\n\t\tconst itemsInfo = JSON.parse(localStorage.getItem('@flowers/cart-v1'));\n\t\tconst { items, hasPassport } = itemsInfo;\n\t\tconst changedItems = items.map(el => {\n\t\t\tconst { productBase, brandCode } = el.product;\n\t\t\tconst { deliveryDate } = el.deliveryDate;\n\n\t\t\tel.brandCode = brandCode;\n\t\t\tel.productBase = productBase;\n\t\t\tel.deliveryDate = deliveryDate;\n\t\t\tel.deliveryDateFlexOption = el.deliveryDateSelectedFlexOption;\n\t\t\tel.deliveryDateDtwId = el.deliveryDateSelectedDtwOption;\n\n\t\t\tdelete el.ttl;\n\t\t\tdelete el.product;\n\t\t\tdelete el.productPageSearchParams;\n\t\t\tdelete el.addOnsSkus;\n\t\t\tdelete el.deliveryDateQuery;\n\t\t\tdelete el.deliveryDateSelectedFlexOption;\n\t\t\tdelete el.deliveryDateSelectedDtwOption;\n\t\t\tdelete el.shippingCountry;\n\t\t\tdelete el.personalization;\n\t\t\treturn el;\n\t\t});\n\n\t\tthis.requestData = {\n\t\t\tcustomerId: userInfo ? userInfo.contactId : '',\n\t\t\tcustomerType: userInfo ? userInfo.customerType : 'R',\n\t\t\tpromoMembershipNumber: memberEl && memberEl.value,\n\t\t\tpaymentType: paymentEl && paymentEl.value,\n\t\t\tgiftCards: [],\n\t\t\tpassport: hasPassport,\n\t\t\titems: changedItems,\n\t\t};\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [\n\t\t\t...new Set(\n\t\t\t\t[...document.querySelectorAll('div')]\n\t\t\t\t\t.map(el => el.textContent.match(this.PROMO_REGEXP))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(code => code[1]),\n\t\t\t),\n\t\t];\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes() {\n\t\tconst buttons = document.querySelectorAll(this.REMOVE_BUTTON_SELECTOR);\n\t\tbuttons[buttons.length - 1].click();\n\t\tconst total = () => [...document.querySelectorAll('div')].find(el => el.innerText === this.TOTAL_STRING);\n\t\treturn wait(total).then(() => this._parseTotal());\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tif (responseJSON.errors.length) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t} else {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseJSON);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\t[this.lastCode] = codes;\n\t\treturn this._manuallyApplyCode(this.lastCode);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._applyCode(this.lastCode).then(responseJSON => toFloat(responseJSON.totals.merchandise));\n\t}\n\n\t_applyCode(code) {\n\t\tthis.requestData.promoCode = code;\n\t\treturn fetch(`https://${PWA_DOMAIN}/api/checkout/order/summary.json`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'content-type': 'application/json',\n\t\t\t},\n\t\t\tbody: JSON.stringify(this.requestData),\n\t\t}).then(response => response.json());\n\t}\n\n\t_manuallyApplyCode(code) {\n\t\tconst inputs = document.querySelectorAll(this.PROMO_CODE_FORM);\n\t\tconst buttons = document.querySelectorAll(this.APPLY_BUTTON_SELECTOR);\n\t\tsetValue(inputs[inputs.length - 1], code);\n\t\tbuttons[buttons.length - 1].click();\n\t\treturn Promise.resolve();\n\t}\n\n\t_parseTotal(data) {\n\t\tif (data) {\n\t\t\treturn toFloat(data.totals.total);\n\t\t}\n\t\tconst total = [...document.querySelectorAll('div')].find(el => el.innerText === this.TOTAL_STRING)\n\t\t\t.nextElementSibling;\n\t\treturn elemToFloat(total);\n\t}\n};\n\nexport default {\n\tname: '1800 Flowers',\n\tdomain: '1800flowers.com',\n\tisSinglePageApp: isPWA,\n\tcompletionAction: isPWA ? completionActions.none : completionActions.revisit,\n\tDriver: isPWA ? PwaDriver : NotPwaDriver,\n\tmaxCoupons: 9,\n\tisOnCartUrl: href =>\n\t\tisPWA ? false : href.includes(`/FDPlaceOrderDisplayCmd`) && document.querySelector('#promoCode'),\n\tisCartEmpty() {\n\t\treturn document.querySelector('.ECP-emptycart');\n\t},\n};\n","/*    eslint class-methods-use-this: [\"error\", { \"exceptMethods\": [\"_codeAppliedCheck\", \"\"] }] */\nimport Promise from 'bluebird';\nimport BaseDriver from '../base';\nimport bus from '../../bus';\nimport { format, DOM, log } from '../../../utils';\nimport { sessionTimer } from '../../lib';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractFormValues, extractElement } = DOM;\n\n// This template driver is for merchants which are similar to 1800flowers.com\n// The only parameter is domain\n// These merchants use http://www-03.ibm.com/software/products/en/websphere-commerce\n// and can be identified by having a /wcsstore/ path on their site\n\nexport default class Driver extends BaseDriver {\n\tconstructor(merchantDomain) {\n\t\tsuper();\n\t\tthis.APPLIED_CODES_SELECTOR = '#appliedPromoCodes';\n\t\tthis.TOTAL_SIBLING_SELECTOR = '#citiRewardsMessage';\n\t\tthis.TOTAL_SELECTOR = '#hdnBillingOrderTotalForm #orderTotalBalance';\n\n\t\tthis.SHIPPING_FORM_SELECTOR = '.EditBillingAddressModal';\n\n\t\tthis.PRICES_SELECTOR = '.order-summary-table .tr-rows, [class*=total-label] [class*=rows]';\n\t\tthis.PRICE_SELECTOR = '.price-cart-summary, [class*=PaddingSpace]';\n\n\t\tthis.APPLY_BUTTON_SELECTOR = '#divApplyBtnStatic a';\n\t\tthis.CODE_INPUT_SELECTOR = '#promoCode';\n\t\tthis.APPLIED_CODE_MSG_SELECTOR = '#appliedPromoMsg';\n\n\t\tthis.REMOVE_FORM_SELECTOR = '#AjaxAddOrRemovePromotionOrEGCURL';\n\t\tthis.APPLY_FORM_SELECTOR = '#PromotionCodeForm';\n\t\tthis.UPDATE_FORM_SELECTOR = '#PromotionRefreshAreaViewURL';\n\n\t\tthis.BASE_URL = `https://www.${merchantDomain}`;\n\t\tthis.BASE_REQUEST_URL = `${this.BASE_URL}/webapp/wcs/stores/servlet`;\n\t\tthis.APPLY_CODE_END_POINT = '/AjaxRESTApplyPromoCodeForWidget';\n\t\tthis.APPLY_URL = `${this.BASE_REQUEST_URL}${this.APPLY_CODE_END_POINT}`;\n\n\t\tthis.EMPTY_SELECTOR = '.ECP-emptycart';\n\n\t\tthis.GIFT_MSG_FORM_SELECTOR = '.pers-edit';\n\n\t\tthis.getPureTotal = false;\n\t}\n\n\twatchForCartUrl() {\n\t\tconst interval = super.watchForCartUrl();\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: interval,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst isOnHref =\n\t\t\thref.startsWith(`${this.BASE_REQUEST_URL}/FDRecipientsDisplayCmd`) ||\n\t\t\thref.startsWith(`${this.BASE_REQUEST_URL}/AjaxCheckoutDisplayView`) ||\n\t\t\thref.startsWith(`${this.BASE_REQUEST_URL}/FDPlaceOrderDisplayCmd`) ||\n\t\t\thref.startsWith(`${this.BASE_URL}/AjaxCheckoutDisplayView`);\n\t\tconst price = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst isInput = (document.querySelector(this.CODE_INPUT_SELECTOR) || {}).offsetParent;\n\t\tconst isAppliedCodeMsgSelector = (document.querySelector(this.APPLIED_CODE_MSG_SELECTOR) || {}).offsetParent;\n\t\tconst isEmpty = document.querySelector(this.EMPTY_SELECTOR);\n\t\tconst shippingFormActive = document.querySelector(this.SHIPPING_FORM_SELECTOR);\n\t\tconst giftMsgFormActive = document.querySelector(this.GIFT_MSG_FORM_SELECTOR);\n\t\treturn (\n\t\t\tisOnHref &&\n\t\t\t(isInput || isAppliedCodeMsgSelector) &&\n\t\t\t!isEmpty &&\n\t\t\tprice &&\n\t\t\t!shippingFormActive &&\n\t\t\t!giftMsgFormActive\n\t\t);\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.APPLY_FORM_DATA = extractFormValues(this.APPLY_FORM_SELECTOR);\n\t\tthis.REMOVE_FORM_DATA = `/${document.querySelector(this.REMOVE_FORM_SELECTOR).getAttribute('value')}`;\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [document.querySelector(this.APPLIED_CODES_SELECTOR).getAttribute('value')].filter(Boolean);\n\t\treturn { codes, codeCount: codes.length };\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0])\n\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t.then(responseHTML => this._parseTotal(responseHTML));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = { code, finalPrice: originalPrice, finalDiscount: 0, isValid: false };\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tif (!this._codeAppliedCheck(responseJSON)) {\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseHTML);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this.getPureTotal\n\t\t\t? this._getUpdatedCart().then(response => {\n\t\t\t\t\tconst shipping = elemToFloat(this._findElement('Shipping', response)) || 0;\n\t\t\t\t\t// tax not always present on the page\n\t\t\t\t\tconst taxEl = this._findElement('Estimated Tax', response);\n\t\t\t\t\tconst tax = taxEl ? elemToFloat(taxEl) || 0 : 0;\n\t\t\t\t\tconst shippingDiscountEl = this._findElement('Shipping Discount', response);\n\t\t\t\t\tconst shippingDiscount = shippingDiscountEl ? elemToFloat(shippingDiscountEl) || 0 : 0;\n\t\t\t\t\treturn this._parseTotal(response) - shipping - tax + shippingDiscount;\n\t\t\t  })\n\t\t\t: null;\n\t}\n\n\t_findElement(targetString, response) {\n\t\tconst targetEl = [...extractElement(this.PRICES_SELECTOR, response, true)].find(el =>\n\t\t\tel.textContent.includes(targetString),\n\t\t);\n\t\treturn targetEl ? targetEl.querySelector(this.PRICE_SELECTOR) : null;\n\t}\n\n\t_removeCode(code) {\n\t\tconst removeURL = `${this.REMOVE_FORM_DATA}&needsToRemove=Promotion&promotionCode=${code}`;\n\n\t\treturn this._manageCode(`${this.BASE_URL}${removeURL}`, 'POST');\n\t}\n\n\t_applyCode(code) {\n\t\tthis.APPLY_FORM_DATA.params.set('taskType', 'A');\n\t\tthis.APPLY_FORM_DATA.params.set('promoCode', code);\n\t\tthis.APPLY_FORM_DATA.params.set('appliedPromoCode', code);\n\t\treturn this._manageCode(this.APPLY_URL, 'POST', this.APPLY_FORM_DATA.params);\n\t}\n\n\t_manageCode(urlString, method, body) {\n\t\treturn fetch(urlString, { method, credentials: 'include', body })\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\t// Return JSON if it is possible\n\t\t\t\ttry {\n\t\t\t\t\tthis.lastResponse = JSON.parse(response);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.lastResponse = response;\n\t\t\t\t}\n\t\t\t\treturn this.lastResponse;\n\t\t\t});\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\treturn data.successFlag === 'true';\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn this._manageCode(`${this.BASE_URL}${window.location.pathname}`, 'GET');\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn toFloat(extractElement(this.TOTAL_SELECTOR, data).getAttribute('value'));\n\t}\n}\n","import DriverTemplate from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement, extractFormValues } = DOM;\n/*\nDriver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    'isValid' implemented: yes\n•     Codes can be replaced by another code: no\n•    Manually apply code: no\n•    Is driver SPA and add the condition to show popup: yes\n•    sessionTimer 15 min\n•    pages, where extension works: Cart, Checkout\n•    Special case: get Total price with shipping,\n     so total and final price in console will be wrong, but discount will be right\n*/\n\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper('cheryls.com');\n\n\t\tthis.TOTAL_SELECTOR = '.price-cart-summary';\n\t\tthis.REMOVE_FORM_SELECTOR = '#AjaxRESTRemovePromoCodeForWidget';\n\n\t\tthis.getPureTotal = true;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.APPLY_FORM_DATA = extractFormValues(this.APPLY_FORM_SELECTOR);\n\t\tthis.REMOVE_FORM_DATA = document.querySelector(this.REMOVE_FORM_SELECTOR).getAttribute('value');\n\t\tthis.UPDATE_FORM_DATA = document.querySelector(this.UPDATE_FORM_SELECTOR).getAttribute('value');\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn this._manageCode(`${this.BASE_URL}${this.UPDATE_FORM_DATA}`, 'POST');\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn elemToFloat(\n\t\t\textractElement(this.TOTAL_SIBLING_SELECTOR, data).previousElementSibling.querySelector(this.TOTAL_SELECTOR),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: \"Cheryl's\",\n\tdomain: 'cheryls.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import DriverTemplate from './_base';\nimport { sessionTimer } from '../../lib';\nimport { completionActions, DOM, format } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractData } = DOM;\n/*\nDriver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    'isValid' implemented: yes\n•     Codes can be replaced by another code: no\n•    Manually apply code: no\n•    Page, where extension works: Checkout\n•    Is driver SPA and add the condition to show popup: no\n•    sessionTimer 15 min\n*/\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper('fruitbouquets.com');\n\n\t\tthis.PRICES_SELECTOR = '[class*=total-label] [class*=row]';\n\t\tthis.PRICE_SELECTOR = '[class*=PaddingSpace][class*=col2]';\n\t\tthis.SHIPPING_REGEX = /\"order_shipping\": \"(.+)/i;\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 15,\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst shipping = toFloat(this._getShippingValue(response)) || 0;\n\t\t\t// tax not always present on the page\n\t\t\tconst taxEl = this._findElement('Estimated Tax', response);\n\t\t\tconst tax = taxEl ? elemToFloat(taxEl) || 0 : 0;\n\t\t\treturn this._parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\t_getShippingValue(response) {\n\t\treturn [...extractData('script', response, true)]\n\t\t\t.filter(element => element.match(this.SHIPPING_REGEX))\n\t\t\t.map(element => element.match(this.SHIPPING_REGEX)[1])[0];\n\t}\n};\n\nexport default {\n\tname: 'Fruit Bouquets',\n\tdomain: 'fruitbouquets.com',\n\tDriver,\n\tcompletionAction: completionActions.revisit,\n\tisOnCartUrl(href) {\n\t\treturn (\n\t\t\thref.startsWith(`https://www.fruitbouquets.com/webapp/wcs/stores/servlet/FDPlaceOrderDisplayCmd`) &&\n\t\t\tdocument.querySelector('#promoCode')\n\t\t);\n\t},\n\tisCartEmpty() {\n\t\treturn document.querySelector('.ECP-emptycart');\n\t},\n};\n","import DriverTemplate from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement, extractFormValues } = DOM;\n\n/*\nDriver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    'isValid' implemented: yes\n•     Codes can be replaced by another code: no\n•    Manually apply code: no\n•    Is driver SPA and add the condition to show popup: yes\n•    sessionTimer 15 min\n•    pages, where extension works: Cart, Checkout (support Checkout and clear data, because code input may not appear on Cart page)\n•    Gather codes on site pages: yes, from main page\n•    Special case: get Total price with shipping,\n     so total and final price in console will be wrong, but discount will be right\n*/\n\nconst DOMAIN = 'harryanddavid.com';\n\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper(DOMAIN);\n\n\t\tthis.BASE_URL = `https://www.${DOMAIN}`;\n\n\t\tthis.MERCHANT_CODES_SELECTOR = '.hdTileHomepageFeatureA, #HD_HomePageESpot_14 a';\n\t\tthis.MERCHANT_CODES_REGEXP = /use code (\\w+)/i;\n\n\t\tthis.TOTAL_SELECTOR = '.price-cart-summary';\n\t\tthis.REMOVE_FORM_SELECTOR = '#AjaxRESTRemovePromoCodeForWidget';\n\t\tthis.SHIPPING_FORM_SELECTOR = '.address_Modal';\n\n\t\tthis.getPureTotal = true;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.APPLY_FORM_DATA = extractFormValues(this.APPLY_FORM_SELECTOR);\n\t\tthis.REMOVE_FORM_DATA = document.querySelector(this.REMOVE_FORM_SELECTOR).getAttribute('value');\n\t\tthis.UPDATE_FORM_DATA = document.querySelector(this.UPDATE_FORM_SELECTOR).getAttribute('value');\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn this._getMainPage().then(responseHTML => [\n\t\t\t...new Set(\n\t\t\t\t[...extractElement(this.MERCHANT_CODES_SELECTOR, responseHTML, true)]\n\t\t\t\t\t.map(elem => elem.innerText.match(this.MERCHANT_CODES_REGEXP))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(code => code[1]),\n\t\t\t),\n\t\t]);\n\t}\n\n\t_getMainPage() {\n\t\treturn fetch(this.BASE_URL, {\n\t\t\tmethod: 'GET',\n\t\t}).then(response => response.text());\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn this._manageCode(`${this.BASE_URL}${this.UPDATE_FORM_DATA}`, 'POST');\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn elemToFloat(\n\t\t\textractElement(this.TOTAL_SIBLING_SELECTOR, data).previousElementSibling.querySelector(this.TOTAL_SELECTOR),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Harry & David',\n\tdomain: 'harryanddavid.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import _1800baskets from './1800baskets.com';\nimport _1800flowers from './1800flowers.com';\nimport cheryls from './cheryls.com';\nimport fruitbouquets from './fruitbouquets.com';\nimport harryanddavid from './harryanddavid.com';\nimport targetoptical from './targetoptical.com';\nimport timberland from './timberland.com';\nimport thepopcornfactory from './thepopcornfactory.com';\nimport wolfermans from './wolfermans.com';\nimport menswearhouse from './menswearhouse.com';\nimport totalwireless from './totalwireless.com';\n\nexport default [\n\t_1800baskets,\n\t_1800flowers,\n\tcheryls,\n\tfruitbouquets,\n\tharryanddavid,\n\tmenswearhouse,\n\ttargetoptical,\n\ttimberland,\n\ttotalwireless,\n\tthepopcornfactory,\n\twolfermans,\n];\n","import Promise from 'bluebird';\nimport DriverTemplate from './_base';\nimport bus from '../../bus';\nimport { format, DOM, log } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { extractFormValues, extractElement } = DOM;\n\n/*\nDriver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: no\n+ Free gift support: no\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: no\n+ Manually apply code: no\n+\n+ Pages, where extension works: cart, payment\n+ Is driver SPA yes\n+ Gather codes on site pages: no\n+ Special case about the driver works.\n    - sessionTimer yes (15 minuteus)\n*/\n\nconst DOMAIN = 'menswearhouse.com';\n\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper(DOMAIN);\n\n\t\tthis.BASE_URL = `https://www.${DOMAIN}`;\n\t\tthis.API_URL = `${this.BASE_URL}/webapp/wcs/stores/servlet`;\n\n\t\tthis.MANAGE_CODE_URL = `${this.API_URL}/AjaxPromotionCodeManage`;\n\t\tthis.UPDATE_TOTAL_URL = `${this.API_URL}/AjaxOrderChangeServiceItemUpdate`;\n\n\t\tthis.CART_URL = `${this.BASE_URL}/AjaxOrderItemDisplayView`;\n\t\tthis.CHECKOUT_URL = `${this.BASE_URL}/OrderShippingBillingView`;\n\n\t\tthis.CODE_INPUT_SELECTOR = '#promoCodeCheckoutInput, #promoCode';\n\t\tthis.APPLIED_CODE_SELECTOR = '#appliedPromotionCodes .promotionName';\n\t\tthis.FORM_SELECTOR = '#PromotionCodeForm';\n\t\tthis.SHIPPING_TAB_SELECTOR = '#tab-shipping.active';\n\n\t\tthis.TOTAL_ELEMENT_CONFIG = { selector: '.product-price.total_figures[data-gtm=\"cart-total\"]' };\n\t\tthis.CHARGES_SELECTOR = '.order-summary-list li';\n\t\tthis.CHARGES_REGEX = /taxes|shipping/gi;\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isOnCheckout = href.startsWith(this.CHECKOUT_URL);\n\t\tconst isOnCart = href.startsWith(this.CART_URL);\n\t\tconst shippingTabActive = document.querySelector(this.SHIPPING_TAB_SELECTOR);\n\t\treturn codeInput && !shippingTabActive && (isOnCheckout || isOnCart);\n\t}\n\n\tgetExistingCodes() {\n\t\tconst existingCodeElement = document.querySelector(this.APPLIED_CODE_SELECTOR);\n\t\tconst codes = existingCodeElement ? [existingCodeElement.textContent.trim()] : [];\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.formData = extractFormValues(this.FORM_SELECTOR);\n\t\tthis.formData.params.set('requesttype', 'ajax');\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = { code, finalPrice: originalPrice, finalDiscount: 0, isValid: true };\n\t\t\treturn this._applyCode(code).then(() => {\n\t\t\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseHTML);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\tresult.isValid = result.finalPrice < originalPrice;\n\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(responseHTML => {\n\t\t\tconst total = this._parseTotal(responseHTML);\n\t\t\tconst charges = [...extractElement(this.CHARGES_SELECTOR, responseHTML, true)]\n\t\t\t\t.filter(chargeEl => chargeEl.textContent.match(this.CHARGES_REGEX))\n\t\t\t\t.map(charge => charge.textContent.match(/(\\d+\\.\\d+)/i))\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.map(matched => matched[1])\n\t\t\t\t.reduce((a, b) => toFloat(a) + toFloat(b), 0);\n\t\t\treturn total - charges;\n\t\t});\n\t}\n\n\t_applyCode(code) {\n\t\tthis.formData.params.set('taskType', 'A');\n\t\tthis.formData.params.set('promoCode', code);\n\t\treturn this._manageCode(this.MANAGE_CODE_URL, this.formData.params).then(() => this._updateTotal());\n\t}\n\n\t_removeCode(code) {\n\t\tthis.formData.params.set('taskType', 'R');\n\t\tthis.formData.params.set('promoCode', code);\n\t\treturn this._manageCode(this.MANAGE_CODE_URL, this.formData.params).then(() => this._updateTotal());\n\t}\n\n\t_updateTotal() {\n\t\tthis.formData.params.delete('promoCode');\n\t\tthis.formData.params.delete('taskType');\n\t\treturn this._manageCode(this.UPDATE_TOTAL_URL, this.formData.params);\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(window.location.href).then(res => res.text());\n\t}\n\n\t_manageCode(url, body) {\n\t\treturn fetch(url, {\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'content-type': 'application/x-www-form-urlencoded; charset=UTF-8',\n\t\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t},\n\t\t\treferrerPolicy: 'no-referrer-when-downgrade',\n\t\t\tbody,\n\t\t\tmethod: 'POST',\n\t\t\tmode: 'cors',\n\t\t}).then(res => res.text());\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn elemToFloat(extractElement(this.TOTAL_ELEMENT_CONFIG.selector, data));\n\t}\n};\n\nexport default {\n\tname: \"Men's Wearhouse\",\n\tdomain: 'menswearhouse.com',\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import DriverTemplate from './_base';\n\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractFormValues, extractElement } = DOM;\n\n/*\nDriver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    'isValid' implemented: yes\n•    Codes can be replaced by another code: no\n•    Manually apply code: no\n•    Is driver SPA : no\n*/\n\nconst CART_URL = '/AjaxOrderItemDisplayView';\nconst EMPTY_CARD_SELECTOR = '.empty-cart-espot';\n\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper('targetoptical.com');\n\n\t\tthis.TOTAL_SELECTOR = '#UtagOrderAmt';\n\t\tthis.APPLIED_CODES_SELECTOR = '.all-promotion-active .specific_promotion';\n\t\tthis.MERCHANT_CODES_SELECTOR = 'a[aria-label=\"glasses discount\"]';\n\t\tthis.MERCHANT_CODES_REGEX = /code:\\s(.*)/;\n\t\tthis.SHIPPING_METHOD_SELECTOR = 'form[aria-label=\"choose shipping method\"] input';\n\t\tthis.TAX_SELECTOR = 'span.price.tax-cart';\n\t\tthis.BASE_REQUEST_URL = `${this.BASE_URL}/webapp/wcs/stores/servlet`;\n\t\tthis.MANAGE_CODE_END_POINT = '/AjaxPromotionCodeManage';\n\t\tthis.GET_ORDER_ID_END_POINT = '/AjaxOrderChangeServiceItemUpdateTO';\n\t\tthis.MANAGE_CODE_URL = `${this.BASE_REQUEST_URL}${this.MANAGE_CODE_END_POINT}`;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.FORM_DATA = extractFormValues(this.APPLY_FORM_SELECTOR);\n\t}\n\n\tgetMerchantCodes() {\n\t\tconst codeElement = document.querySelector(this.MERCHANT_CODES_SELECTOR);\n\t\tconst codes = codeElement ? [codeElement.textContent.match(this.MERCHANT_CODES_REGEX)[1]] : [];\n\t\treturn { codes, codeCount: codes.length };\n\t}\n\n\tgetExistingCodes() {\n\t\tconst code = document.querySelector(this.APPLIED_CODES_SELECTOR);\n\t\tconst codes = code ? [code.getAttribute('data-promotion')] : [];\n\t\treturn { codes, codeCount: codes.length };\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => {\n\t\t\tconst shippingMethod = [...extractElement(this.SHIPPING_METHOD_SELECTOR, response, true)].find(\n\t\t\t\tel => el.checked,\n\t\t\t).id;\n\t\t\tconst shippingElement = extractElement(`[for=${shippingMethod}] span`, response);\n\t\t\tconst shipping = shippingElement.className.includes('free') ? 0 : elemToFloat(shippingElement);\n\t\t\tconst tax = elemToFloat(extractElement(this.TAX_SELECTOR, response));\n\t\t\treturn this._parseTotal(response) - tax - shipping;\n\t\t});\n\t}\n\n\t_applyCode(code) {\n\t\tthis.FORM_DATA.params.set('taskType', 'A');\n\t\tthis.FORM_DATA.params.set('promoCode', code);\n\t\treturn this._manageCode(this.MANAGE_CODE_URL, 'POST', this.FORM_DATA.params);\n\t}\n\n\t_removeCode(code) {\n\t\tthis.FORM_DATA.params.set('taskType', 'R');\n\t\tthis.FORM_DATA.params.set('promoCode', code);\n\t\treturn this._manageCode(this.MANAGE_CODE_URL, 'POST', this.FORM_DATA.params);\n\t}\n\n\t_codeAppliedCheck(data) {\n\t\treturn typeof data !== 'string';\n\t}\n\n\t_getOrderId(body) {\n\t\treturn this._manageCode(`${this.BASE_REQUEST_URL}${this.GET_ORDER_ID_END_POINT}`, 'POST', body);\n\t}\n\n\t_getUpdatedCart() {\n\t\tconst query = this.FORM_DATA.action.split('?')[1];\n\t\treturn this._getOrderId(query).then(() =>\n\t\t\tthis._manageCode(`${this.BASE_URL}${window.location.pathname}?${query}`, 'GET'),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Target Optical',\n\tdomain: 'targetoptical.com',\n\tDriver,\n\tisOnCartUrl: () => window.location.href.includes(CART_URL) && !document.querySelector(EMPTY_CARD_SELECTOR),\n};\n","import DriverTemplate from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement, extractFormValues } = DOM;\n/*\nDriver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    'isValid' implemented: yes\n•     Codes can be replaced by another code: no\n•    Manually apply code: no\n•    Is driver SPA and add the condition to show popup: yes\n•    sessionTimer 15 min\n•    pages, where extension works: Cart, Checkout\n•    Special case: get Total price with shipping,\n     so total and final price in console will be wrong, but discount will be right\n*/\n\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper('thepopcornfactory.com');\n\n\t\tthis.TOTAL_SELECTOR = '.price-cart-summary';\n\t\tthis.REMOVE_FORM_SELECTOR = '#AjaxRESTRemovePromoCodeForWidget';\n\t\tthis.getPureTotal = true;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.APPLY_FORM_DATA = extractFormValues(this.APPLY_FORM_SELECTOR);\n\t\tthis.REMOVE_FORM_DATA = document.querySelector(this.REMOVE_FORM_SELECTOR).getAttribute('value');\n\t\tthis.UPDATE_FORM_DATA = document.querySelector(this.UPDATE_FORM_SELECTOR).getAttribute('value');\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn this._manageCode(`${this.BASE_URL}${this.UPDATE_FORM_DATA}`, 'POST');\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn elemToFloat(\n\t\t\textractElement(this.TOTAL_SIBLING_SELECTOR, data).previousElementSibling.querySelector(this.TOTAL_SELECTOR),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'The Popcorn Factory',\n\tdomain: 'thepopcornfactory.com',\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import Promise from 'bluebird';\nimport BaseDriver from './_base';\nimport bus from '../../bus';\nimport { sessionTimer } from '../../lib';\nimport { DOM, format, log, request, requestTypes } from '../../../utils';\nimport { extractData } from '../../../utils/DOM';\n\nconst { extractElement, extractFormValues } = DOM;\nconst { elemToFloat, toFloat } = format;\n\nconst CART_EMPTY_SELECTOR = '.checkout-itemNum-js';\nconst IS_ON_CART = window.location.href.match(/OrderItemDisplay/i);\nconst REQUEST_URL = 'https://www.timberland.com/webapp/wcs/stores/servlet';\n\n/* Driver behavior:\n\t+ Existing code: yes\n\t+ Remove code: yes\n\t+ Code retesting: yes\n\t+ Stackable: no\n\t+ Free gift support: no\n\t+ isValid implemented: no\n\t+ Manually apply code: no\n\t+ Show message about free shipping: no\n\t+ Driver is SPA: yes, on cart & billing checkout step (if billing address is saved)\n\t+ Gather merchant codes: no\n\t+ RestoreUserData: no\n====Special case====\n\t+ Some codes may restore shipping method to default, we mark that codes as inValid\n\t+ Session timer set for 15 min.\n\t+ Sometimes server can redirect to /webapp/wcs/stores/servlet/OrderItemDisplay\n\t  but sometimes can redirect to /shop/OrderItemDisplay.\n\t+ Domain doesn't change and another requests(applying/removing codes) works as well\n\t+ may be some little mistake with total calculation on site's UI.\n*/\n\nconst Driver = class Driver extends BaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '#amount-after-giftcards-apply-summary';\n\t\tthis.EXISTING_CODE_SELECTOR = '.checkout-gift-card-num';\n\t\tthis.APPLY_CODE_FORM_SELECTOR = 'form[action=VFAjaxPromotionCodeManage]';\n\t\tthis.REMOVE_CODE_FORM_SELECTOR = '.checkout-summary-promo-code-remove';\n\t\tthis.GOODS_SELECTOR = '.billing-info-form, .product-list-container';\n\t\tthis.CALCULATE_FORM_SELECTOR = 'form[name=reCalculateOrderForm]';\n\t\tthis.CHECKOUT_FORM_SELECTOR = '[name=\"refreshTotalForm\"]';\n\t\tthis.TAX_SELECTOR = '.checkout-estimate-tax';\n\t\tthis.SHIPPING_METHOD_SELECTOR = '.checkout-ship-mode-id';\n\t\tthis.SHIPPING_SELECTOR = '.checkout-estimate-shipping-2';\n\t\tthis.SHIPPING_UPDATE_SEL = 'form[name=shipModeUpdateForm]';\n\t\tthis.PICKUP_PAGE_SELECTOR = '[title=\"Ship to Home\"]';\n\t\tthis.BILLING_INPUT_SELECTOR = '.address-form-first-name-label';\n\t\tthis.HEADERS = {\n\t\t\theaders: {\n\t\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t\t'content-type': 'application/x-www-form-urlencoded; charset=UTF-8',\n\t\t\t},\n\t\t};\n\t\tsessionTimer.initialize({});\n\t\trequest.setType(requestTypes.embedded);\n\t}\n\n\tcheckCondition() {\n\t\tconst isCartEmpty =\n\t\t\tdocument.querySelector(CART_EMPTY_SELECTOR) &&\n\t\t\tdocument.querySelector(CART_EMPTY_SELECTOR).textContent === '0';\n\t\tconst isSummary = document.querySelector(this.TOTAL_SELECTOR);\n\t\tconst savedBillingAddress = !(document.querySelector(this.BILLING_INPUT_SELECTOR) || {}).offsetParent;\n\t\tconst rightUrl = IS_ON_CART || (window.location.href.includes('BillingAndPaymentView') && savedBillingAddress);\n\t\tconst goodsInCart = document.querySelector(this.GOODS_SELECTOR);\n\n\t\treturn !isCartEmpty && isSummary && rightUrl && goodsInCart;\n\t}\n\n\tbeforeTestCodes() {\n\t\tif (IS_ON_CART && !document.querySelector(this.PICKUP_PAGE_SELECTOR)) {\n\t\t\tthis.SHIPPING_METHOD_ID = this._getShippingMethodId();\n\t\t\tthis.shippingUpdateParams = extractFormValues(this.SHIPPING_UPDATE_SEL, false, true);\n\t\t\t[...document.querySelectorAll('.checkout-item-table-item > input')].map(item =>\n\t\t\t\tthis.shippingUpdateParams.params.set(item.name, item.value),\n\t\t\t);\n\t\t\tconst orderItemIds = extractData(this.SHIPPING_METHOD_SELECTOR, false, false, 'data-orderitemids').split(\n\t\t\t\t',',\n\t\t\t);\n\t\t\torderItemIds.forEach((item, index) => {\n\t\t\t\tthis.shippingUpdateParams.params.set(`orderItemId_${index + 1}`, item);\n\t\t\t\tthis.shippingUpdateParams.params.set(`shipModeId_${index + 1}`, this.SHIPPING_METHOD_ID);\n\t\t\t});\n\t\t\tthis.shippingUpdateParams.params.set('requesttype', 'ajax');\n\t\t\tthis.shippingUpdateParams.params.delete('catalogId_1');\n\t\t}\n\n\t\tthis.calculateRequestParams = extractFormValues(this.CALCULATE_FORM_SELECTOR, false, true);\n\t\tthis.updateCheckoutParams = extractFormValues(this.CHECKOUT_FORM_SELECTOR);\n\t\tthis.updateCheckoutParams.params.set('requesttype', 'ajax');\n\n\t\tthis.applyForm = extractFormValues(this.APPLY_CODE_FORM_SELECTOR);\n\t\tthis.applyForm.params.set('taskType', 'A');\n\t\tthis.applyForm.params.delete('codeApplied');\n\t\tthis.applyForm.params.set('requesttype', 'ajax');\n\n\t\tthis.removeForm = extractFormValues(this.REMOVE_CODE_FORM_SELECTOR);\n\t\tthis.removeForm.params.set('taskType', 'R');\n\t\tthis.removeForm.params.delete('refresh');\n\t\tthis.removeForm.params.set('requesttype', 'ajax');\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.EXISTING_CODE_SELECTOR)].map(element => element.textContent);\n\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn this._removeCode(codes[0])\n\t\t\t.then(() => this._getOrderCalculate())\n\t\t\t.then(responseText => this._parseTotal(responseText));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Orginal price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code).then(responseJSON => {\n\t\t\t\tconst result = {\n\t\t\t\t\tcode,\n\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\tisValid: true,\n\t\t\t\t};\n\t\t\t\tif (responseJSON.errorMessage) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t}\n\t\t\t\treturn this._getOrderCalculate().then(responseText => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tIS_ON_CART &&\n\t\t\t\t\t\t!document.querySelector(this.PICKUP_PAGE_SELECTOR) &&\n\t\t\t\t\t\tthis._getShippingMethodId(responseText) !== this.SHIPPING_METHOD_ID\n\t\t\t\t\t) {\n\t\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\t\treturn this._removeCode(code)\n\t\t\t\t\t\t\t.then(() => this._updateShipping())\n\t\t\t\t\t\t\t.then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t}\n\t\t\t\t\tresult.finalPrice = this._parseTotal(responseText);\n\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\n\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\t_getShippingMethodId(data = false) {\n\t\treturn extractElement(this.SHIPPING_METHOD_SELECTOR, data).value; // doesn't work wit getAttribute method\n\t}\n\n\t_updateShipping() {\n\t\treturn request.post(`${REQUEST_URL}/VFAjaxOrderItemUpdate`, this.shippingUpdateParams.params, this.HEADERS);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getOrderCalculate().then(response => {\n\t\t\tlet tax;\n\t\t\tlet shipping;\n\t\t\tif (response && response.amounts) {\n\t\t\t\tconst { amounts } = response;\n\t\t\t\ttax = toFloat(amounts.totalTax);\n\t\t\t\tshipping = toFloat(amounts.shippingCharge);\n\t\t\t} else {\n\t\t\t\tconst shippingElement = extractElement(this.SHIPPING_SELECTOR, response);\n\t\t\t\tshipping = shippingElement && /\\d/.test(shippingElement.textContent) ? elemToFloat(shippingElement) : 0;\n\t\t\t\ttax = elemToFloat(extractElement(this.TAX_SELECTOR, response)) || 0;\n\t\t\t}\n\n\t\t\treturn this._parseTotal(response) - shipping - tax;\n\t\t});\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes[0]).then(() => this._getOrderCalculate());\n\t}\n\n\t_applyCode(code) {\n\t\tthis.applyForm.params.set('promoCode', code);\n\n\t\treturn this._manageCode(`${REQUEST_URL}/VFAjaxPromotionCodeManage`, this.applyForm.params);\n\t}\n\n\t_removeCode(code) {\n\t\tthis.removeForm.params.set('promoCode', code);\n\n\t\treturn this._manageCode(`${REQUEST_URL}/AjaxPromotionCodeManage`, this.removeForm.params);\n\t}\n\n\tasync _manageCode(url, body) {\n\t\treturn request.post(url, body, this.HEADERS).then(response => response.json());\n\t}\n\n\t_getOrderCalculate() {\n\t\tif (IS_ON_CART) {\n\t\t\treturn request\n\t\t\t\t.get(`${REQUEST_URL}/OrderCalculate?${this.calculateRequestParams.params.toString()}`)\n\t\t\t\t.then(response => response.text());\n\t\t}\n\t\treturn request\n\t\t\t.post(`${REQUEST_URL}/AjaxOrderCalculate`, this.calculateRequestParams.params, this.HEADERS)\n\t\t\t.then(response => (IS_ON_CART ? response.text() : response.json()));\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn data && data.amounts\n\t\t\t? toFloat(data.amounts.grandTotalValue)\n\t\t\t: elemToFloat(extractElement(this.TOTAL_SELECTOR, data));\n\t}\n\n\t_getUpdatedCheckout(retry = false) {\n\t\tconst url = window.location.href;\n\t\treturn request\n\t\t\t.get(url, null, {\n\t\t\t\theaders: {\n\t\t\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then(response =>\n\t\t\t\tresponse.status === 500 && retry === false ? this._getUpdatedCheckout(true) : response.text(),\n\t\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Timberland',\n\tdomain: 'timberland.com',\n\tDriver,\n\tmaxCoupons: 6,\n\tisSinglePageApp: true,\n\trestoreUserData: true,\n};\n","import Promise from 'bluebird';\nimport DriverTemplate from './_base';\nimport bus from '../../bus';\nimport { format, DOM, log } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractFormValues, extractElement } = DOM;\n\n/** Driver behavior description:\n-    Existing code: yes\n-    Remove code: yes\n-    Stackable: no\n-    Free gift support: no\n-    'isValid' implemented: no\n-    Codes can be replaced by another code: sometimes. One of them takes precedence over the other and can overwhelm them. Otherwise, Codes can't be replaced by another code\n-    Manually apply code: no\n-    Is driver SPA: yes\n-\t maxCoupons: 7, because site is not very fast\n-    pages, where extension works: Cart\n */\n\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_ELEMENT_CONFIG = {\n\t\t\tselector: '.js-totalplanprice',\n\t\t};\n\t\tthis.EXISTING_CODE_SELECTOR = '.discount-promo p';\n\t\tthis.CODE_REGEX = /\\((\\w+)\\)/i;\n\t\tthis.INPUT_ELEM_SELECTOR = '.sc-promo-code';\n\t\tthis.EMPTY_CART_SELECTOR = '#WC_EmptyShopCartDisplayf_div_1';\n\t\tthis.BASE_URL = 'https://shop.totalwireless.com';\n\t\tthis.REQUEST_URL = `${this.BASE_URL}/webapp/wcs/stores/servlet`;\n\t\tthis.ERROR_REGEXP = /is not correct/;\n\t\tthis.FORM_SELECTOR = '#PromotionCodeForm';\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst emptyCartElement = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst inputEl = document.querySelector(this.INPUT_ELEM_SELECTOR);\n\t\tconst rightUrl =\n\t\t\thref.includes('AjaxOrderItemDisplayView') ||\n\t\t\thref.includes('AjaxCheckoutDisplayView') ||\n\t\t\thref.includes('TFOrderItemDisplay');\n\n\t\treturn rightUrl && inputEl && !emptyCartElement;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.bodyData = extractFormValues(this.FORM_SELECTOR);\n\t\tthis.updateCartParams = new URLSearchParams({\n\t\t\tstoreId: this.bodyData.params.get('storeId'),\n\t\t\tcatalogId: this.bodyData.params.get('catalogId'),\n\t\t\tlangId: this.bodyData.params.get('langId'),\n\t\t\tisBundleOfferFlow: false,\n\t\t});\n\t\tthis.updateCartBodyData = new URLSearchParams({\n\t\t\tobjectId: '',\n\t\t\trequesttype: 'ajax',\n\t\t});\n\n\t\treturn Promise.resolve();\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = [...document.querySelectorAll(this.EXISTING_CODE_SELECTOR)]\n\t\t\t.map(el => el.textContent.match(this.CODE_REGEX))\n\t\t\t.filter(Boolean)\n\t\t\t.map(el => el[1]);\n\t\treturn {\n\t\t\tcodes,\n\t\t\tcodeCount: codes.length,\n\t\t};\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal()) {\n\t\tlog(`Original price: ${originalPrice}`);\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._applyCode(code)\n\t\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t\t.then(responseText => {\n\t\t\t\t\tconst result = {\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t};\n\t\t\t\t\tif (!this.ERROR_REGEXP.test(responseText)) {\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseText);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t}\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(response => this._parseTotal(response));\n\t}\n\n\t_removeCode(code) {\n\t\treturn this._manageCode(code, 'R');\n\t}\n\n\t_applyCode(code) {\n\t\treturn this._manageCode(code, 'A');\n\t}\n\n\t_manageCode(code, type) {\n\t\tthis.bodyData.params.set('promoCode', code);\n\t\tthis.bodyData.params.set('taskType', type);\n\t\treturn this._manageUrl(`${this.REQUEST_URL}/AjaxPromotionCodeManage`, this.bodyData.params);\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn this._manageUrl(\n\t\t\t`${this.BASE_URL}/shop/ShopCartDisplayView?${this.updateCartParams.toString()}`,\n\t\t\tthis.updateCartBodyData,\n\t\t);\n\t}\n\n\t_manageUrl(url, data) {\n\t\treturn fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t},\n\t\t\tbody: data,\n\t\t}).then(response => response.text());\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn elemToFloat(extractElement(this.TOTAL_ELEMENT_CONFIG.selector, data));\n\t}\n};\n\nexport default {\n\tname: 'Total Wireless',\n\tdomain: 'totalwireless.com',\n\tmaxCoupons: 7,\n\tDriver,\n\tisSinglePageApp: true,\n};\n","import DriverTemplate from './_base';\nimport { format, DOM } from '../../../utils';\n\nconst { elemToFloat } = format;\nconst { extractElement, extractFormValues } = DOM;\n/*\nDriver behavior description:\n•    Existing code: yes\n•    Remove code: yes\n•    Stackable: no\n•    Free gift support: no\n•    'isValid' implemented: yes\n•    Codes can be replaced by another code: no\n•    Manually apply code: no\n•    Is driver SPA and add the condition to show popup: yes\n•    sessionTimer 15 min\n•    pages, where extension works: Cart, Checkout\n•    Special case: get Total price with shipping,\n     so total and final price in console will be wrong, but discount will be right\n*/\nconst Driver = class Driver extends DriverTemplate {\n\tconstructor() {\n\t\tsuper('wolfermans.com');\n\n\t\tthis.TOTAL_SELECTOR = '.price-cart-summary';\n\t\tthis.REMOVE_FORM_SELECTOR = '#AjaxRESTRemovePromoCodeForWidget';\n\t\tthis.getPureTotal = true;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.APPLY_FORM_DATA = extractFormValues(this.APPLY_FORM_SELECTOR);\n\t\tthis.REMOVE_FORM_DATA = document.querySelector(this.REMOVE_FORM_SELECTOR).getAttribute('value');\n\t\tthis.UPDATE_FORM_DATA = document.querySelector(this.UPDATE_FORM_SELECTOR).getAttribute('value');\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn this._manageCode(`${this.BASE_URL}${this.UPDATE_FORM_DATA}`, 'POST');\n\t}\n\n\t_parseTotal(data = false) {\n\t\treturn elemToFloat(\n\t\t\textractElement(this.TOTAL_SIBLING_SELECTOR, data).previousElementSibling.querySelector(this.TOTAL_SELECTOR),\n\t\t);\n\t}\n};\n\nexport default {\n\tname: 'Wolfermans',\n\tdomain: 'wolfermans.com',\n\tisSinglePageApp: true,\n\tDriver,\n};\n"],"sourceRoot":""}