{"version":3,"sources":["webpack:///./src/inject/drivers/base.js","webpack:///./src/inject/drivers/saks/_base.js","webpack:///./src/inject/drivers/saks/index.js","webpack:///./src/inject/drivers/saks/lordandtaylor.com.js","webpack:///./src/inject/drivers/saks/saksfifthavenue.com.js","webpack:///./src/inject/drivers/saks/saksoff5th.com.js","webpack:///./src/inject/drivers/saks/thebay.com.js"],"names":["toFloat","format","BaseDriver","watchForRestoreUserData","time","pauseInterval","interval","setInterval","currentState","checkRestoreDataCondition","clearInterval","bus","$emit","e","handleDriverError","source","storeUserData","domain","userData","getUserData","Promise","resolve","userDataKey","getUserDataStorageKey","storageRecord","storedTime","Date","now","backgroundMessaging","setDriverStorage","log","restoreUserData","maxStorageLifetime","driverStorage","getDriverStorage","deleteDriverStorage","setUserData","getStartPrice","startPrice","Number","MAX_SAFE_INTEGER","totalElementConfig","TOTAL_ELEMENT_CONFIG","selector","attribute","regex","totalElement","Array","isArray","forEach","elemSelector","document","querySelector","Error","value","getAttribute","textContent","pattern","group","match","beforeTestCodes","beforeCheckCodes","beforeApplyCodes","checkCodes","applyCodes","stackCodes","removeCodes","getMerchantCodes","getExistingCodes","codes","codeCount","getPreTaxShippingTotal","watchForCartUrl","previousState","checkCondition","completeExperience","completeExperiencePromisified","args","_promisify","beforeTestCodesPromisified","getStartPricePromisified","getMerchantCodesPromisified","getExistingCodesPromisified","removeCodesPromisified","beforeApplyCodesPromisified","applyCodesPromisified","beforeCheckCodesPromisified","checkCodesPromisified","stackCodesPromisified","method","then","apply","elemToFloat","wait","browserUtils","extractFormValues","setValue","extractElement","DOM","Saks","constructor","BASE_URL","TOTAL_SELECTOR","APPLIED_CODE_SELECTOR","CODE_INPUT_SELECTOR","APPLY_BUTTON_SELECTOR","CODE_PARAM_NAME","CHECKOUT_PAYMENT_FORM_SELECTOR","PRODUCT_ITEM_SELECTOR","EDIT_BUTTON_SELECTOR","MODAL_WINDOW_SELECTOR","MODAL_CLOSE_BUTTON_SELECTOR","isOnCartPage","window","location","href","includes","ADD_CODE_PARAM_VALUE","REMOVE_CODE_PARAM_VALUE","CART_PARAM_VALUE","MAX_STACKED_COUPONS","isStackable","requestBodyData","URLSearchParams","updateCartBody","set","params","isCodeInput","isEditPromoButton","isCart","startsWith","CART_URL","isCheckout","CHECKOUT_URL","isPaymentFilled","_isPaymentFilled","Set","querySelectorAll","filter","Boolean","map","el","size","each","code","_removeCode","_getUpdatedCart","responseJSON","originalPrice","parseTotal","originalItemsCount","parseItemsCount","IS_CART_PAGE","applyCodesOnCart","applyCodesOnCheckout","_applyCode","_actionWithPromoElements","isModalWindowOnPage","click","workingDiscounts","result","finalPrice","finalDiscount","freeGifts","isValid","errors","cartResponse","push","discount","discounts","validationInfo","sort","a","b","currentPrice","currentDiscount","currentFreeGifts","successfulCodes","length","removeCode","_manageCode","fetch","credentials","headers","body","response","text","JSON","parse","err","data","offsetParent","item","codeInput","applyButton","json","total","summary","orderSummary","cartSummary","grandTotal","replace","cartItems","orderItems","lordandtaylor","saksfifthavenue","saksoff5th","thebay","getCookie","extractData","IS_ON_CHECKOUT_PAGE","Driver","APPLY_CODE_BTN_SELECTOR","REMOVE_CODE_BUTTON_SELECTOR","EXISTING_CODES_SELECTOR","SUBMIT_FORM_SELECTOR","CREDIT_CARD_DATA_SELECTOR","CODE_REGEX","EMPTY_CART_SELECTOR","REVIEW_TAB_SELECTOR","PAYMENT_TAB_SELECTOR","SPINNER_ELEMENT_SELECTOR","SHIPPING_MODAL_CHECKOUT","TAX_ELEMENT_SELECTOR","SHIPPING_ELEMENT_SELECTOR","SHIPPING_OPTION_SELECTOR","SHIPPING_METHOD_SELECTOR","MERCHANT_CODES_ELEMENT_SELECTOR","MERCHANT_CODE_REGEX","CREDIT_CARD_DATA_ARRAY","name","country","isRightCountry","isCartEmpty","paymentTab","isReview","isSpinner","CREDIT_CARD_DATA_EXISTS","responseHTML","shipping","shippingCost","tax","totalPrice","taxPrice","taxOnPage","isShippingFree","maxCoupons","isSinglePageApp","setCookie","isAccessDenied","GIFT_MODAL_SELECTOR","MERCHANT_CODE_SELECTOR","cartEmptyEl","isGiftModal","isOnUSLocation","totalEelement","isTotal","innerText","delay","_mouseEvent","event","dispatchEvent","Event","bubbles","stackable","bodyData","SHIPPING_SECTION_SELECTOR","MERCHANT_CODE_ELEMENT_REGEX","REPLACE_REGEX","sessionTimer","initialize","actionInterval","timeout","isShippingStep","action","bmForm","promoCode","test","lastResponse","_parseTotal","_parseItemsCount","responseCart","shippingAmount","toLowerCase","taxAmount","trim"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM;AAAEA;AAAF,IAAcC,6CAApB;AAEe,MAAMC,UAAN,CAAiB;AAC/B;;;;AAIAC,yBAAuB,CAACC,IAAI,GAAG,GAAR,EAAa;AACnC,QAAIC,aAAa,GAAG,KAApB;AACA,UAAMC,QAAQ,GAAGC,WAAW,CAAC,YAAY;AACxC,UAAI,CAACF,aAAL,EAAoB;AACnB,YAAI;AACH;AACA;AACAA,uBAAa,GAAG,IAAhB;AACA,gBAAMG,YAAY,GAAG,MAAM,KAAKC,yBAAL,EAA3B;AACAJ,uBAAa,GAAG,KAAhB;;AACA,cAAIG,YAAJ,EAAkB;AACjBE,yBAAa,CAACJ,QAAD,CAAb;AACAK,wDAAG,CAACC,KAAJ,CAAU,mBAAV;AACA;AACD,SAVD,CAUE,OAAOC,CAAP,EAAU;AACXC,wEAAiB,CAACD,CAAD,EAAI;AAAEE,kBAAM,EAAE;AAAV,WAAJ,CAAjB;AACAL,uBAAa,CAACJ,QAAD,CAAb;AACA;AACD;AACD,KAjB2B,EAiBzBF,IAjByB,CAA5B;AAmBA,WAAOE,QAAP;AACA;;AAEDG,2BAAyB,GAAG;AAC3B,WAAO,KAAP;AACA;AAED;;;;;;;AAKA,QAAMO,aAAN,CAAoBC,MAApB,EAA4B;AAC3B,UAAMC,QAAQ,GAAG,MAAM,KAAKC,WAAL,EAAvB;;AAEA,QAAID,QAAQ,KAAK,IAAjB,EAAuB;AACtB;AACA,aAAOE,OAAO,CAACC,OAAR,EAAP;AACA;;AACD,UAAMC,WAAW,GAAG,KAAKC,qBAAL,CAA2BN,MAA3B,CAApB;AACA,UAAMO,aAAa,GAAG;AACrBN,cADqB;AAErBO,gBAAU,EAAEC,IAAI,CAACC,GAAL;AAFS,KAAtB;AAIAC,4DAAmB,CAACC,gBAApB,CAAqCP,WAArC,EAAkDE,aAAlD;AACAM,sDAAG,CAAC,sBAAD,EAAyBN,aAAzB,CAAH;AACA,WAAOJ,OAAO,CAACC,OAAR,EAAP;AACA;AAED;;;;;;;;AAMA,QAAMU,eAAN,CAAsBd,MAAtB,EAA8Be,kBAAkB,GAAG,MAAnD,EAA2D;AAC1D,UAAMV,WAAW,GAAG,KAAKC,qBAAL,CAA2BN,MAA3B,CAApB;AACA,UAAMgB,aAAa,GAAG,MAAML,wDAAmB,CAACM,gBAApB,CAAqCZ,WAArC,CAA5B;;AAEA,QAAIW,aAAJ,EAAmB;AAClB,YAAM;AAAER,kBAAF;AAAcP;AAAd,UAA2Be,aAAjC,CADkB,CAElB;;AACAL,8DAAmB,CAACO,mBAApB,CAAwCb,WAAxC;;AAEA,UAAII,IAAI,CAACC,GAAL,KAAaF,UAAb,IAA2BO,kBAA/B,EAAmD;AAClDF,0DAAG,CAAC,uBAAD,EAA0BZ,QAA1B,CAAH;AACA,eAAO,KAAKkB,WAAL,CAAiBlB,QAAjB,CAAP;AACA;;AACDY,wDAAG,CAAC,uCAAD,CAAH;AACA;;AACD,WAAOV,OAAO,CAACC,OAAR,EAAP;AACA;AAED;;;;;;AAIAF,aAAW,GAAG;AACb,WAAO,IAAP;AACA;AAED;;;;;;;AAKAiB,aAAW,GAAG;AACb,WAAOhB,OAAO,CAACC,OAAR,EAAP;AACA;AAED;;;;;;AAIAE,uBAAqB,CAACN,MAAD,EAAS;AAC7B;AACA,WAAQ,GAAEA,MAAO,WAAjB;AACA;AAED;;;;;;;;AAMAoB,eAAa,GAAG;AACf,QAAIC,UAAU,GAAGC,MAAM,CAACC,gBAAxB;AACA,UAAMC,kBAAkB,GAAG,KAAKC,oBAAhC;;AACA,QAAID,kBAAJ,EAAwB;AACvB,YAAM;AAAEE,gBAAF;AAAYC,iBAAZ;AAAuBC;AAAvB,UAAiCJ,kBAAvC;AACA,UAAIK,YAAJ,CAFuB,CAGvB;AACA;;AACA,UAAIC,KAAK,CAACC,OAAN,CAAcL,QAAd,CAAJ,EAA6B;AAC5BA,gBAAQ,CAACM,OAAT,CAAiBC,YAAY,IAAI;AAChC,cAAI,CAACJ,YAAL,EAAmB;AAClBA,wBAAY,GAAGK,QAAQ,CAACC,aAAT,CAAuBF,YAAvB,CAAf;AACA;AACD,SAJD;AAKA,OAND,MAMO,IAAI,OAAOP,QAAP,KAAoB,QAAxB,EAAkC;AACxCG,oBAAY,GAAGK,QAAQ,CAACC,aAAT,CAAuBT,QAAvB,CAAf;AACA,OAFM,MAEA;AACN7B,sEAAiB,CAChB,IAAIuC,KAAJ,CAAW,8DAA6D,OAAOV,QAAS,EAAxF,CADgB,CAAjB;AAGA;;AAED,UAAIG,YAAJ,EAAkB;AACjB,YAAIQ,KAAK,GAAGV,SAAS,GAAGE,YAAY,CAACS,YAAb,CAA0BX,SAA1B,CAAH,GAA0CE,YAAY,CAACU,WAA5E;;AAEA,YAAIF,KAAK,IAAIT,KAAb,EAAoB;AACnB;AACA;AACA,gBAAM;AAAEY,mBAAO,GAAG,IAAZ;AAAkBC,iBAAK,GAAG;AAA1B,cAAgCb,KAAtC;AACAS,eAAK,GAAGA,KAAK,CAACK,KAAN,CAAYF,OAAZ,EAAqBC,KAArB,CAAR;AACA;;AACDpB,kBAAU,GAAGtC,OAAO,CAACsD,KAAD,CAApB;AACA;AACD;;AACD,WAAOhB,UAAP;AACA;AAED;;;;;;;;;AAOAsB,iBAAe,GAAG;AACjB,WAAOxC,OAAO,CAACC,OAAR,EAAP;AACA;AAED;;;;;;AAKA;;;;;;;;;;;AASAwC,kBAAgB,GAAG;AAClB,WAAOzC,OAAO,CAACC,OAAR,EAAP;AACA;AAED;;;;;;;;;AAOAyC,kBAAgB,GAAG;AAClB,WAAO1C,OAAO,CAACC,OAAR,EAAP;AACA;AAED;;;;;;;;;;AAQA0C,YAAU,GAAG;AACZ,WAAO3C,OAAO,CAACC,OAAR,EAAP;AACA;AAED;;;;;;;;;;;AASA2C,YAAU,GAAG;AACZ,WAAO5C,OAAO,CAACC,OAAR,EAAP;AACA;AAED;;;;;;;;;;;AASA4C,YAAU,GAAG;AACZ,WAAO7C,OAAO,CAACC,OAAR,EAAP;AACA;AAED;;;;;;;;;AAOA6C,aAAW,GAAG;AACb,WAAO9C,OAAO,CAACC,OAAR,EAAP;AACA;AAED;;;;;;;;AAMA8C,kBAAgB,GAAG;AAClB,WAAO,EAAP;AACA;AAED;;;;;;;;AAOA;;;;;;AAIAC,kBAAgB,GAAG;AAClB,WAAO;AACNC,WAAK,EAAE,EADD;AAENC,eAAS,EAAE;AAFL,KAAP;AAIA;AAED;;;;;;;;AAMAC,wBAAsB,GAAG;AACxB,WAAO,IAAP;AACA;AAED;;;;;;;AAKAC,iBAAe,CAACpE,IAAI,GAAG,GAAR,EAAa;AAC3B,QAAIqE,aAAa,GAAG,IAApB;AACA,QAAIpE,aAAa,GAAG,KAApB;AAEA,UAAMC,QAAQ,GAAGC,WAAW,CAAC,YAAY;AACxC,UAAI,CAACF,aAAL,EAAoB;AACnB,YAAIG,YAAY,GAAG,IAAnB;;AACA,YAAI;AACH;AACA;AACAH,uBAAa,GAAG,IAAhB;AACAG,sBAAY,GAAG,MAAM,KAAKkE,cAAL,EAArB;AACArE,uBAAa,GAAG,KAAhB;AACA,SAND,CAME,OAAOQ,CAAP,EAAU;AACXC,wEAAiB,CAACD,CAAD,EAAI;AAAEE,kBAAM,EAAE;AAAV,WAAJ,CAAjB;AACAL,uBAAa,CAACJ,QAAD,CAAb;AACA;;AACD,YAAIE,YAAY,KAAKiE,aAArB,EAAoC;AACnC9D,sDAAG,CAACC,KAAJ,CAAUJ,YAAY,GAAG,aAAH,GAAmB,eAAzC;AACA;;AACDiE,qBAAa,GAAGjE,YAAhB;AACA;AACD,KAlB2B,EAkBzBJ,IAlByB,CAA5B,CAJ2B,CAuB3B;;AACA,WAAOE,QAAP;AACA;AAED;;;;;;AAIAoE,gBAAc,GAAG;AAChB,WAAO,KAAP;AACA;AAED;;;;;;;;;;;AASAC,oBAAkB,GAAG;AACpB,WAAOvD,OAAO,CAACC,OAAR,EAAP;AACA;AAED;;;;;;AAIAuD,+BAA6B,CAAC,GAAGC,IAAJ,EAAU;AACtC,WAAO,KAAKC,UAAL,CAAgB,KAAKH,kBAArB,EAAyCE,IAAzC,CAAP;AACA;AAED;;;;;;AAIAE,4BAA0B,CAAC,GAAGF,IAAJ,EAAU;AACnC,WAAO,KAAKC,UAAL,CAAgB,KAAKlB,eAArB,EAAsCiB,IAAtC,CAAP;AACA;AAED;;;;;;AAIAG,0BAAwB,GAAG;AAC1B,WAAO,KAAKF,UAAL,CAAgB,KAAKzC,aAArB,CAAP;AACA;AAED;;;;;;AAIA4C,6BAA2B,CAAC,GAAGJ,IAAJ,EAAU;AACpC,WAAO,KAAKC,UAAL,CAAgB,KAAKX,gBAArB,EAAuCU,IAAvC,CAAP;AACA;AAED;;;;;;AAIAK,6BAA2B,CAAC,GAAGL,IAAJ,EAAU;AACpC,WAAO,KAAKC,UAAL,CAAgB,KAAKV,gBAArB,EAAuCS,IAAvC,CAAP;AACA;AAED;;;;;;AAIAM,wBAAsB,CAAC,GAAGN,IAAJ,EAAU;AAC/B,WAAO,KAAKC,UAAL,CAAgB,KAAKZ,WAArB,EAAkCW,IAAlC,CAAP;AACA;AAED;;;;;;AAIAO,6BAA2B,CAAC,GAAGP,IAAJ,EAAU;AACpC,WAAO,KAAKC,UAAL,CAAgB,KAAKhB,gBAArB,EAAuCe,IAAvC,CAAP;AACA;AAED;;;;;;AAIAQ,uBAAqB,CAAC,GAAGR,IAAJ,EAAU;AAC9B,WAAO,KAAKC,UAAL,CAAgB,KAAKd,UAArB,EAAiCa,IAAjC,CAAP;AACA;AAED;;;;;;AAIAS,6BAA2B,CAAC,GAAGT,IAAJ,EAAU;AACpC,WAAO,KAAKC,UAAL,CAAgB,KAAKjB,gBAArB,EAAuCgB,IAAvC,CAAP;AACA;AAED;;;;;;AAIAU,uBAAqB,CAAC,GAAGV,IAAJ,EAAU;AAC9B,WAAO,KAAKC,UAAL,CAAgB,KAAKf,UAArB,EAAiCc,IAAjC,CAAP;AACA;AAED;;;;;;AAIAW,uBAAqB,CAAC,GAAGX,IAAJ,EAAU;AAC9B,WAAO,KAAKC,UAAL,CAAgB,KAAKb,UAArB,EAAiCY,IAAjC,CAAP;AACA;AAED;;;;;;AAIAC,YAAU,CAACW,MAAD,EAASZ,IAAT,EAAe;AACxB,WAAOzD,OAAO,CAACC,OAAR,GAAkBqE,IAAlB,CAAuB,MAAMD,MAAM,CAACE,KAAP,CAAa,IAAb,EAAmBd,IAAnB,CAA7B,CAAP;AACA;;AAta8B,C;;;;;;;;;;;;ACNhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAM;AAAE7E,SAAF;AAAW4F;AAAX,IAA2B3F,6CAAjC;AACA,MAAM;AAAE4F;AAAF,IAAWC,mDAAjB;AACA,MAAM;AAAEC,mBAAF;AAAqBC,UAArB;AAA+BC;AAA/B,IAAkDC,0CAAxD;AAEA;;;;;;;;;;;AAWe,MAAMC,IAAN,SAAmBjG,6CAAnB,CAA8B;AAC5CkG,aAAW,GAAG;AACb;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACA,SAAKC,cAAL,GAAsB,mFAAtB;AACA,SAAKC,qBAAL,GACC,gIADD;AAEA,SAAKC,mBAAL,GAA2B,qCAA3B;AACA,SAAKC,qBAAL,GAA6B,0CAA7B;AAEA,SAAKC,eAAL,GAAuB,WAAvB;AAEA,SAAKC,8BAAL,GAAsC,yBAAtC;AACA,SAAKC,qBAAL,GACC,+FADD;AAEA,SAAKC,oBAAL,GAA4B,sBAA5B;AACA,SAAKC,qBAAL,GAA6B,kBAA7B;AACA,SAAKC,2BAAL,GAAmC,cAAnC;AAEA,UAAMC,YAAY,GAAGC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,QAArB,CAA8B,aAA9B,CAArB;AACA,SAAKC,oBAAL,GAA4B,mBAA5B;AACA,SAAKC,uBAAL,GAA+BN,YAAY,GACxC,oCADwC,GAExC,2BAFH;AAGA,SAAKO,gBAAL,GAAwBP,YAAY,GAAG,6BAAH,GAAmC,8BAAvE;AAEA,SAAKQ,mBAAL,GAA2B,CAA3B;AAEA,SAAKC,WAAL,GAAmB,KAAnB;AAEA,SAAKC,eAAL,GAAuB,IAAIC,eAAJ,EAAvB;AACA,SAAKC,cAAL,GAAsB,IAAID,eAAJ,EAAtB;AACA;;AAED/D,iBAAe,GAAG;AACjB,SAAKgE,cAAL,CAAoBC,GAApB,CAAwB,QAAxB,EAAkC,KAAKN,gBAAvC;;AACA,QAAIpE,QAAQ,CAACC,aAAT,CAAuB,KAAKuD,8BAA5B,CAAJ,EAAiE;AAChE,WAAKe,eAAL,GAAuB3B,iBAAiB,CAAC,KAAKY,8BAAN,CAAjB,CAAuDmB,MAA9E;AACA;;AACD,WAAO1G,+CAAO,CAACC,OAAR,EAAP;AACA;;AAEDqD,gBAAc,GAAG;AAChB,UAAMqD,WAAW,GAAG5E,QAAQ,CAACC,aAAT,CAAuB,KAAKoD,mBAA5B,CAApB;AACA,UAAMwB,iBAAiB,GAAG7E,QAAQ,CAACC,aAAT,CAAuB,KAAKyD,oBAA5B,CAA1B;AACA,UAAMoB,MAAM,GACXhB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBe,UAArB,CAAgC,KAAKC,QAArC,KAAkDhF,QAAQ,CAACC,aAAT,CAAuB,KAAKoD,mBAA5B,CADnD;AAEA,UAAM4B,UAAU,GAAGnB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBe,UAArB,CAAgC,KAAKG,YAArC,CAAnB;;AACA,UAAMC,eAAe,GACpB,KAAKC,gBAAL,CAAuB,GAAE,KAAK5B,8BAA+B,QAA7D,KACA,KAAK4B,gBAAL,CAAuB,GAAE,KAAK5B,8BAA+B,SAA7D,CAFD;;AAIA,WAAQsB,MAAM,IAAIF,WAAX,IAA4BK,UAAU,KAAML,WAAW,IAAIO,eAAhB,IAAoCN,iBAAzC,CAA7C;AACA;;AAED5D,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,IAAImE,GAAJ,CACb,CAAC,GAAGrF,QAAQ,CAACsF,gBAAT,CAA0B,KAAKlC,qBAA/B,CAAJ,EAA2DmC,MAA3D,CAAkEC,OAAlE,EAA2EC,GAA3E,CAA+EC,EAAE,IAAIA,EAAE,CAACrF,WAAxF,CADa,CAAd;AAIA,WAAO;AACNa,WAAK,EAAE,CAAC,GAAGA,KAAJ,CADD;AAENC,eAAS,EAAED,KAAK,CAACyE;AAFX,KAAP;AAIA;;AAED5E,aAAW,CAACG,KAAD,EAAQ;AAClB,WAAOjD,+CAAO,CAAC2H,IAAR,CAAa1E,KAAb,EAAoB2E,IAAI,IAAI,KAAKC,WAAL,CAAiBD,IAAjB,CAA5B,EACLtD,IADK,CACA,MAAM,KAAKwD,eAAL,EADN,EAELxD,IAFK,CAEAyD,YAAY,KAAK;AACtBC,mBAAa,EAAE,KAAKC,UAAL,CAAgBF,YAAhB,CADO;AAEtBG,wBAAkB,EAAE,KAAKC,eAAL,CAAqBJ,YAArB;AAFE,KAAL,CAFZ,CAAP;AAMA;;AAEDnF,YAAU,CAACK,KAAD,EAAQ;AACjB,WAAO,KAAKmF,YAAL,GAAoB,KAAKC,gBAAL,CAAsBpF,KAAK,CAAC,CAAD,CAA3B,CAApB,GAAsD,KAAKqF,oBAAL,CAA0BrF,KAAK,CAAC,CAAD,CAA/B,CAA7D;AACA;;AAEDoF,kBAAgB,CAACT,IAAD,EAAO;AACtB,WAAO,KAAKvB,WAAL,GAAmBrG,+CAAO,CAACC,OAAR,EAAnB,GAAuC,KAAKsI,UAAL,CAAgBX,IAAhB,CAA9C;AACA;;AAEDU,sBAAoB,CAACV,IAAD,EAAO;AAC1B,QAAI,CAAC7F,QAAQ,CAACC,aAAT,CAAuB,KAAKyD,oBAA5B,CAAL,EAAwD;AACvD,UAAI,KAAK2C,YAAT,EAAuB;AACtB,eAAOpI,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,aAAO,KAAK4H,WAAL,CAAiBD,IAAjB,EAAuBtD,IAAvB,CAA4B,MAAM,KAAKkE,wBAAL,CAA8BZ,IAA9B,CAAlC,CAAP;AACA;;AACD,UAAMa,mBAAmB,GAAG,MAAM,CAAC,CAAC1G,QAAQ,CAACC,aAAT,CAAuB,KAAK0D,qBAA5B,CAApC;;AACA3D,YAAQ,CAACC,aAAT,CAAuB,KAAKyD,oBAA5B,EAAkDiD,KAAlD;AACA,WAAOjE,IAAI,CAACgE,mBAAD,CAAJ,CACLnE,IADK,CACA,MAAM,KAAKuD,WAAL,CAAiBD,IAAjB,EAAuBtD,IAAvB,CAA4B,MAAM,KAAKkE,wBAAL,CAA8BZ,IAA9B,CAAlC,CADN,EAELtD,IAFK,CAEA,MAAM;AACX,UAAIvC,QAAQ,CAACC,aAAT,CAAuB,KAAK2D,2BAA5B,CAAJ,EAA8D;AAC7D5D,gBAAQ,CAACC,aAAT,CAAuB,KAAK2D,2BAA5B,EAAyD+C,KAAzD;AACA;;AACD,aAAO1I,+CAAO,CAACC,OAAR,EAAP;AACA,KAPK,CAAP;AAQA;;AAED0C,YAAU,CAACM,KAAD,EAAQ+E,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CC,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjGzH,sDAAG,CAAC,mBAAD,EAAsBsH,aAAtB,CAAH;AACAtH,sDAAG,CAAC,wBAAD,EAA2BwH,kBAA3B,CAAH;AAEA,UAAMS,gBAAgB,GAAG,EAAzB;AACA,WAAO3I,+CAAO,CAAC2H,IAAR,CAAa1E,KAAb,EAAoB2E,IAAI,IAAI;AAClC,YAAMgB,MAAM,GAAG;AACdhB,YADc;AAEdiB,kBAAU,EAAEb,aAFE;AAGdc,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE,CAJG;AAKdC,eAAO,EAAE;AALK,OAAf;AAOA,aAAO,KAAKT,UAAL,CAAgBX,IAAhB,EAAsBtD,IAAtB,CAA2ByD,YAAY,IAAI;AACjD,YAAI,OAAOA,YAAP,KAAwB,QAAxB,IAAoC,CAACA,YAAY,CAACkB,MAAtD,EAA8D;AAC7D,iBAAO,KAAKnB,eAAL,GAAuBxD,IAAvB,CAA4B4E,YAAY,IAAI;AAClDN,kBAAM,CAACC,UAAP,GAAoB,KAAKZ,UAAL,CAAgBiB,YAAhB,CAApB;AACAN,kBAAM,CAACE,aAAP,GAAuBd,aAAa,GAAGY,MAAM,CAACC,UAA9C;AACAD,kBAAM,CAACG,SAAP,GAAmB,KAAKZ,eAAL,CAAqBe,YAArB,IAAqChB,kBAAxD;AACAU,kBAAM,CAACI,OAAP,GAAiB,IAAjB;;AACA,gBACCJ,MAAM,CAACC,UAAP,GAAoBb,aAApB,IACA;AACCY,kBAAM,CAACC,UAAP,KAAsBb,aAAtB,IAAuCY,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDJ,8BAAgB,CAACQ,IAAjB,CAAsBP,MAAtB;AACA;;AACD,mBAAO,KAAKf,WAAL,CAAiBD,IAAjB,EAAuBtD,IAAvB,CAA4B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BoJ,MAA1B,CAAlC,CAAP;AACA,WAbM,CAAP;AAcA;;AACD,eAAOrJ,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BoJ,MAA1B,CAAP;AACA,OAlBM,CAAP;AAmBA,KA3BM,EA2BJtE,IA3BI,CA2BC,MAAM;AACb,UAAI,KAAK+B,WAAT,EAAsB;AACrB9G,oDAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,eAAK,EAAE0F,gBAAgB,CAACnB,GAAjB,CAAqB4B,QAAQ,IAAIA,QAAQ,CAACxB,IAA1C,CADiB;AAExByB,mBAAS,EAAEV,gBAFa;AAGxBX,uBAHwB;AAIxBE;AAJwB,SAAzB;AAMA;;AACD,aAAOlI,+CAAO,CAACC,OAAR,EAAP;AACA,KArCM,CAAP;AAsCA;;AAED4C,YAAU,CAACyG,cAAD,EAAiB;AAC1B,UAAMX,gBAAgB,GAAGW,cAAc,CAACD,SAAxC;AACA,UAAM;AAAErB;AAAF,QAAoBsB,cAA1B;AACA,UAAM;AAAEpB;AAAF,QAAyBoB,cAA/B,CAH0B,CAK1B;;AACAX,oBAAgB,CAACY,IAAjB,CAAsB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC/B,UAAIA,CAAC,CAACX,aAAF,GAAkBU,CAAC,CAACV,aAApB,KAAsC,CAA1C,EAA6C;AAC5C,eAAOW,CAAC,CAACV,SAAF,GAAcS,CAAC,CAACT,SAAvB;AACA;;AACD,aAAOU,CAAC,CAACX,aAAF,GAAkBU,CAAC,CAACV,aAA3B;AACA,KALD;AAOA,QAAIY,YAAY,GAAG1B,aAAnB;AACA,QAAI2B,eAAe,GAAG,CAAtB;AACA,QAAIC,gBAAgB,GAAG,CAAvB;AACA,UAAMC,eAAe,GAAG,EAAxB;AAEA,WAAO7J,+CAAO,CAAC2H,IAAR,CAAagB,gBAAb,EAA+BS,QAAQ,IAC7C,KAAKb,UAAL,CAAgBa,QAAQ,CAACxB,IAAzB,EAA+BtD,IAA/B,CAAoC,MACnC,KAAKwD,eAAL,GAAuBxD,IAAvB,CAA4B4E,YAAY,IAAI;AAC3C,YAAML,UAAU,GAAG,KAAKZ,UAAL,CAAgBiB,YAAhB,CAAnB;AACA,YAAMJ,aAAa,GAAGd,aAAa,GAAGa,UAAtC;AACA,YAAME,SAAS,GAAG,KAAKZ,eAAL,CAAqBe,YAArB,IAAqChB,kBAAvD;AAEA3I,kDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBoI,YAAI,EAAEwB,QAAQ,CAACxB,IADU;AAEzBiB,kBAFyB;AAGzBC,qBAHyB;AAIzBC;AAJyB,OAA1B;;AAMA,UAAIc,eAAe,CAACC,MAAhB,IAA0B,KAAK1D,mBAAnC,EAAwD;AACvD,eAAO,KAAK2D,UAAL,CAAgBX,QAAQ,CAACxB,IAAzB,CAAP;AACA;;AACD,UACCiB,UAAU,GAAGa,YAAb,IACA;AACCb,gBAAU,KAAKa,YAAf,IAA+BX,SAAS,GAAGa,gBAH7C,EAIE;AACDC,uBAAe,CAACV,IAAhB,CAAqBC,QAAQ,CAACxB,IAA9B;AACA+B,uBAAe,GAAGb,aAAlB;AACAY,oBAAY,GAAGb,UAAf;AACAe,wBAAgB,GAAGb,SAAnB;AACA,eAAO/I,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,aAAO,KAAK4H,WAAL,CAAiBuB,QAAQ,CAACxB,IAA1B,CAAP;AACA,KA1BD,CADD,CADM,EA8BLtD,IA9BK,CA8BA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,oBAAV,EAAgC;AAC/ByD,WAAK,EAAE4G,eADwB;AAE/BhB,gBAAU,EAAEa,YAFmB;AAG/BZ,mBAAa,EAAEa,eAHgB;AAI/BZ,eAAS,EAAEa;AAJoB,KAAhC,CA/BM,CAAP;AAsCA;;AAEDrB,YAAU,CAACX,IAAD,EAAO;AAChB,SAAKtB,eAAL,CAAqBG,GAArB,CAAyB,QAAzB,EAAmC,KAAKR,oBAAxC;AACA,WAAO,KAAK+D,WAAL,CAAiBpC,IAAjB,CAAP;AACA;;AAEDC,aAAW,CAACD,IAAD,EAAO;AACjB,SAAKtB,eAAL,CAAqBG,GAArB,CAAyB,QAAzB,EAAmC,KAAKP,uBAAxC;AACA,WAAO,KAAK8D,WAAL,CAAiBpC,IAAjB,CAAP;AACA;;AAEDoC,aAAW,CAACpC,IAAD,EAAO;AACjB,SAAKtB,eAAL,CAAqBG,GAArB,CAAyB,KAAKnB,eAA9B,EAA+CsC,IAA/C;AACA,WAAOqC,KAAK,CAAE,GAAE,KAAKhF,QAAS,wBAAlB,EAA2C;AACtDZ,YAAM,EAAE,MAD8C;AAEtD6F,iBAAW,EAAE,SAFyC;AAGtDC,aAAO,EAAE;AACR,wBAAgB;AADR,OAH6C;AAMtDC,UAAI,EAAE,KAAK9D;AAN2C,KAA3C,CAAL,CAQLhC,IARK,CAQA+F,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EARZ,EASLhG,IATK,CASA+F,QAAQ,IAAI;AACjB;AACA;AACA,UAAI;AACH,eAAOE,IAAI,CAACC,KAAL,CAAWH,QAAX,CAAP;AACA,OAFD,CAEE,OAAOI,GAAP,EAAY;AACb,eAAOJ,QAAP;AACA;AACD,KAjBK,CAAP;AAkBA;;AAEDlD,kBAAgB,CAAC5F,QAAD,EAAW;AAC1B,UAAMmJ,IAAI,GAAG,CAAC,GAAG3I,QAAQ,CAACsF,gBAAT,CAA0B9F,QAA1B,CAAJ,EAAyC+F,MAAzC,CAAgDG,EAAE,IAAIA,EAAE,CAACkD,YAAH,KAAoB,IAA1E,CAAb;;AACA,QAAID,IAAI,CAACZ,MAAL,GAAc,CAAlB,EAAqB;AACpB,aAAOY,IAAI,CAACZ,MAAL,KAAgBY,IAAI,CAACpD,MAAL,CAAYsD,IAAI,IAAIA,IAAI,CAAC1I,KAAL,KAAe,EAAnC,EAAuC4H,MAA9D;AACA;;AACD,QAAI/H,QAAQ,CAACC,aAAT,CAAuBT,QAAvB,CAAJ,EAAsC;AACrC,aAAO,IAAP;AACA;;AACD,WAAO,KAAP;AACA;;AAEDiH,0BAAwB,CAACZ,IAAD,EAAO;AAC9B,UAAMiD,SAAS,GAAGhG,cAAc,CAAC,KAAKO,mBAAN,CAAhC;AACA,UAAM0F,WAAW,GAAGjG,cAAc,CAAC,KAAKQ,qBAAN,CAAlC;AACAT,YAAQ,CAACiG,SAAD,EAAYjD,IAAZ,EAAkB,OAAlB,CAAR;AACAhD,YAAQ,CAACiG,SAAD,EAAYjD,IAAZ,EAAkB,MAAlB,CAAR;AACAkD,eAAW,CAACpC,KAAZ;AACA,WAAO1I,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED6H,iBAAe,GAAG;AACjB,WAAOmC,KAAK,CAAC,KAAK7B,YAAL,GAAoB,KAAKrB,QAAzB,GAAoC,KAAKE,YAA1C,EAAwD;AACnE5C,YAAM,EAAE,MAD2D;AAEnE6F,iBAAW,EAAE,SAFsD;AAGnEC,aAAO,EAAE;AACR,wBAAgB,iDADR;AAER,4BAAoB;AAFZ,OAH0D;AAOnEC,UAAI,EAAE,KAAK5D;AAPwD,KAAxD,CAAL,CAQJlC,IARI,CAQC+F,QAAQ,IAAIA,QAAQ,CAACU,IAAT,EARb,CAAP;AASA;;AAED9C,YAAU,CAACyC,IAAD,EAAO;AAChB,QAAIM,KAAK,GAAG,IAAZ;;AACA,QAAIN,IAAJ,EAAU;AACT;AACA,YAAMO,OAAO,GAAGP,IAAI,CAACQ,YAAL,GAAoBR,IAAI,CAACQ,YAAzB,GAAwCR,IAAI,CAACS,WAA7D;AACAH,WAAK,GAAGpM,OAAO,CAACqM,OAAO,CAACG,UAAR,CAAmBC,OAAnB,CAA2B,OAA3B,EAAoC,EAApC,CAAD,CAAf;AACA,KAJD,MAIO;AACNL,WAAK,GAAGxG,WAAW,CAACzC,QAAQ,CAACC,aAAT,CAAuB,KAAKkD,cAA5B,CAAD,CAAnB;AACA;;AACD,WAAO8F,KAAP;AACA;;AAED7C,iBAAe,CAACuC,IAAD,EAAO;AACrB,QAAIA,IAAJ,EAAU;AACT,aAAOA,IAAI,CAACY,SAAL,GAAiBZ,IAAI,CAACY,SAAL,CAAexB,MAAhC,GAAyCY,IAAI,CAACa,UAAL,CAAgBzB,MAAhE;AACA;;AACD,WAAO,CAAC,GAAG/H,QAAQ,CAACsF,gBAAT,CAA0B,KAAK7B,qBAA/B,CAAJ,EAA2DsE,MAAlE;AACA;;AA9R2C,C;;;;;;;;;;;;ACpB7C;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEe,gEAAC0B,0DAAD,EAAgBC,4DAAhB,EAAiCC,uDAAjC,EAA6CC,mDAA7C,CAAf,E;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA,MAAM;AAAEC;AAAF,IAAgBlH,mDAAtB;AACA,MAAM;AAAE9F,SAAF;AAAW4F;AAAX,IAA2B3F,6CAAjC;AACA,MAAM;AAAEgG,gBAAF;AAAkBF,mBAAlB;AAAqCkH;AAArC,IAAqD/G,0CAA3D;AAEA,MAAMG,QAAQ,GAAG,+BAAjB;AACA,MAAMgC,YAAY,GAAI,GAAEhC,QAAS,wBAAjC;AACA,MAAM6G,mBAAmB,GAAGjG,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBe,UAArB,CAAgCG,YAAhC,CAA5B;AAEA;;;;;;;;;;;;;;;;;AAiBA,MAAM8E,MAAM,GAAG,MAAMA,MAAN,SAAqBhH,6CAArB,CAA0B;AACxCC,aAAW,GAAG;AACb;AACA,SAAKC,QAAL,GAAgBA,QAAhB;AACA,SAAK8B,QAAL,GAAiB,GAAE9B,QAAS,uBAA5B;AACA,SAAKmD,YAAL,GAAoBvC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBe,UAArB,CAAgC,KAAKC,QAArC,CAApB;AACA,SAAKE,YAAL,GAAoBA,YAApB;AAEA,SAAK7B,mBAAL,GAA2B,iBAA3B;AACA,SAAK4G,uBAAL,GAA+B,aAA/B;AACA,SAAKC,2BAAL,GAAmC,gBAAnC;AACA,SAAKzG,qBAAL,GAA6B,yCAA7B;AACA,SAAK0G,uBAAL,GAA+B,yEAA/B;AACA,SAAKxG,qBAAL,GAA6B,kBAA7B;AACA,SAAKC,2BAAL,GAAmC,cAAnC;AACA,SAAKwG,oBAAL,GAA4B,uBAA5B;AACA,SAAKC,yBAAL,GAAiC,cAAjC;AACA,SAAK3G,oBAAL,GAA4B,sBAA5B;AACA,SAAK4G,UAAL,GAAkB,QAAlB;AACA,SAAKC,mBAAL,GAA2B,wBAA3B;AACA,SAAKC,mBAAL,GAA2B,sBAA3B;AACA,SAAKC,oBAAL,GAA4B,oBAA5B;AACA,SAAKC,wBAAL,GAAgC,UAAhC;AACA,SAAKC,uBAAL,GAA+B,+BAA/B;AACA,SAAKC,oBAAL,GAA4B,YAA5B;AACA,SAAKC,yBAAL,GAAiC,qBAAjC;AACA,SAAKC,wBAAL,GAAgC,+DAAhC;AACA,SAAKC,wBAAL,GAAgC,4BAAhC;AACA,SAAKC,+BAAL,GAAuC,oCAAvC;AACA,SAAKC,mBAAL,GAA2B,iBAA3B;AAEA,SAAKC,sBAAL,GAA8B,CAC7B;AACCC,UAAI,EAAE,2BADP;AAEC3L,cAAQ,EAAE,QAFX;AAGCW,WAAK,EAAE;AAHR,KAD6B,EAM7B;AACCgL,UAAI,EAAE,sBADP;AAEC3L,cAAQ,EAAE,WAFX;AAGCW,WAAK,EAAE;AAHR,KAN6B,EAW7B;AACCgL,UAAI,EAAE,6BADP;AAEC3L,cAAQ,EAAE,YAFX;AAGCW,WAAK,EAAE;AAHR,KAX6B,EAgB7B;AACCgL,UAAI,EAAE,2BADP;AAEC3L,cAAQ,EAAE,UAFX;AAGCW,WAAK,EAAE;AAHR,KAhB6B,EAqB7B;AACCgL,UAAI,EAAE,0BADP;AAEC3L,cAAQ,EAAE,SAFX;AAGCW,WAAK,EAAE;AAHR,KArB6B,EA0B7B;AACCgL,UAAI,EAAE,eADP;AAEC3L,cAAQ,EAAE,SAFX;AAGCW,WAAK,EAAE;AAHR,KA1B6B,CAA9B;AAgCA;;AAEDoB,gBAAc,GAAG;AAChB,UAAM;AAAEyC;AAAF,QAAWF,MAAM,CAACC,QAAxB;AACA,UAAMqH,OAAO,GAAGvB,SAAS,CAAC,aAAD,CAAzB;AACA,UAAMwB,cAAc,GAAGD,OAAO,GAAGA,OAAO,KAAK,IAAf,GAAsB,KAApD;AACA,UAAMtC,SAAS,GAAGhG,cAAc,CAAC,KAAKO,mBAAN,CAAhC;AACA,UAAMiI,WAAW,GAAGtL,QAAQ,CAACC,aAAT,CAAuB,KAAKsK,mBAA5B,CAApB;AACA,UAAMgB,UAAU,GACfvL,QAAQ,CAACC,aAAT,CAAuB,KAAKwK,oBAA5B,KAAqD,CAACzK,QAAQ,CAACC,aAAT,CAAuB,KAAK0K,uBAA5B,CADvD;AAEA,UAAMa,QAAQ,GAAGxL,QAAQ,CAACC,aAAT,CAAuB,KAAKuK,mBAA5B,CAAjB;AACA,UAAMiB,SAAS,GAAGzL,QAAQ,CAACC,aAAT,CAAuB,KAAKyK,wBAA5B,CAAlB;AACA,WAAOX,mBAAmB,GACvB/F,IAAI,CAACe,UAAL,CAAgB,KAAKG,YAArB,MACCqG,UAAU,IAAKzC,SAAS,KAAKyC,UAAU,IAAIC,QAAnB,CADzB,KAEA,CAACC,SAFD,IAGAJ,cAJuB,GAKvBrH,IAAI,CAACe,UAAL,CAAgB,KAAKC,QAArB,KAAkC8D,SAAlC,IAA+C,CAACwC,WAAhD,IAA+DD,cALlE;AAMA;;AAED5K,iBAAe,GAAG;AACjB,SAAKgE,cAAL,CAAoBC,GAApB,CAAwB,QAAxB,EAAkC,KAAKN,gBAAvC;;AACA,QAAIpE,QAAQ,CAACC,aAAT,CAAuB,KAAKuD,8BAA5B,CAAJ,EAAiE;AAChE,WAAKe,eAAL,GAAuB3B,iBAAiB,CAAC,KAAKY,8BAAN,CAAjB,CAAuDmB,MAA9E;AACA;;AACD,SAAK+G,uBAAL,GAA+B,CAAC,CAAC1L,QAAQ,CAACC,aAAT,CAAuB,KAAKoK,yBAA5B,CAAjC;;AACA,QAAIN,mBAAJ,EAAyB;AACxB,WAAKmB,sBAAL,CAA4BzF,GAA5B,CAAgCoD,IAAI,IAAI,KAAKtE,eAAL,CAAqBG,GAArB,CAAyBmE,IAAI,CAACsC,IAA9B,EAAoCtC,IAAI,CAAC1I,KAAzC,CAAxC;AACA;;AACD,WAAOlC,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED8C,kBAAgB,GAAG;AAClB,WAAOkH,KAAK,CAAE,GAAEhF,QAAS,YAAb,EAA0B;AACrCZ,YAAM,EAAE;AAD6B,KAA1B,CAAL,CAGLC,IAHK,CAGA+F,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAHZ,EAILhG,IAJK,CAIAoJ,YAAY,IAAI;AACrB,aAAO,CACN,GAAG,IAAItG,GAAJ,CACF,CAAC,GAAGvC,cAAc,CAAC,KAAKkI,+BAAN,EAAuCW,YAAvC,EAAqD,IAArD,CAAlB,EACElG,GADF,CACMoD,IAAI,IAAIA,IAAI,CAACxI,WAAL,CAAiBG,KAAjB,CAAuB,KAAKyK,mBAA5B,CADd,EAEE1F,MAFF,CAESC,OAFT,EAGEC,GAHF,CAGMoD,IAAI,IAAIA,IAAI,CAAC,CAAD,CAHlB,CADE,CADG,CAAP;AAQA,KAbK,CAAP;AAcA;;AAED5H,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,IAAImE,GAAJ,CACb,CAAC,GAAGrF,QAAQ,CAACsF,gBAAT,CAA0B,KAAK6E,uBAA/B,CAAJ,EAA6D1E,GAA7D,CAAiEC,EAAE,IAClEqE,mBAAmB,GAAGrE,EAAE,CAACrF,WAAH,CAAeG,KAAf,CAAqB,KAAK8J,UAA1B,EAAsC,CAAtC,CAAH,GAA8C5E,EAAE,CAACrF,WADrE,CADa,CAAd;AAMA,WAAO;AACNa,WAAK,EAAE,CAAC,GAAGA,KAAJ,CADD;AAENC,eAAS,EAAED,KAAK,CAACyE;AAFX,KAAP;AAIA;;AAED9E,YAAU,CAACK,KAAD,EAAQ;AACjB,WAAO,KAAKsF,UAAL,CAAgBtF,KAAhB,CAAP;AACA;;AAEDE,wBAAsB,GAAG;AACxB,WAAO,KAAK2E,eAAL,GAAuBxD,IAAvB,CAA4B4E,YAAY,IAAI;AAClD,YAAM8B,KAAK,GAAG,KAAK/C,UAAL,CAAgBiB,YAAhB,CAAd;AACA,YAAMiC,WAAW,GAAGjC,YAAY,CAACgC,YAAb,GAA4BhC,YAAY,CAACgC,YAAzC,GAAwDhC,YAAY,CAACiC,WAAzF;AACA,YAAMwC,QAAQ,GAAG/O,OAAO,CAACuM,WAAW,CAACyC,YAAZ,CAAyBvC,OAAzB,CAAiC,OAAjC,EAA0C,EAA1C,CAAD,CAAP,IAA0D,CAA3E;AACA,YAAMwC,GAAG,GAAGjP,OAAO,CAACuM,WAAW,CAAC0C,GAAZ,CAAgBxC,OAAhB,CAAwB,OAAxB,EAAiC,EAAjC,CAAD,CAAnB;AACA,aAAOL,KAAK,GAAG2C,QAAR,GAAmBE,GAA1B;AACA,KANM,CAAP;AAOA;;AAEDtF,YAAU,CAACX,IAAD,EAAO;AAChB,SAAKtB,eAAL,CAAqBG,GAArB,CAAyB,QAAzB,EAAmC,CAACqF,mBAAD,GAAuB,mBAAvB,GAA6C,wBAAhF;AACA,WAAO,KAAK9B,WAAL,CAAiBpC,IAAjB,CAAP;AACA;;AAEDC,aAAW,CAACD,IAAD,EAAO;AACjB,SAAKtB,eAAL,CAAqBG,GAArB,CACC,QADD,EAEC,CAACqF,mBAAD,GAAuB,oCAAvB,GAA8D,2BAF/D;AAIA,WAAO,KAAK9B,WAAL,CAAiBpC,IAAjB,CAAP;AACA;;AAEDK,YAAU,CAACyC,IAAD,EAAO;AAChB,QAAIA,IAAJ,EAAU;AACT,UAAIoD,UAAU,GAAGlP,OAAO,CACvB8L,IAAI,CAACoB,mBAAmB,GAAG,cAAH,GAAoB,aAAxC,CAAJ,CAA2DV,UAA3D,CAAsEC,OAAtE,CAA8E,OAA9E,EAAuF,EAAvF,CADuB,CAAxB;AAGA,YAAM0C,QAAQ,GAAGnP,OAAO,CACvB8L,IAAI,CAACoB,mBAAmB,GAAG,cAAH,GAAoB,aAAxC,CAAJ,CAA2D+B,GAA3D,CAA+DxC,OAA/D,CAAuE,OAAvE,EAAgF,EAAhF,CADuB,CAAxB;AAGA,YAAM2C,SAAS,GAAGpP,OAAO,CAACiN,WAAW,CAAC,KAAKc,oBAAN,EAA4B,IAA5B,CAAZ,CAAzB;AACA,YAAMsB,cAAc,GAAGpC,WAAW,CAAC,KAAKe,yBAAN,EAAiC,IAAjC,CAAX,CAAkDrK,KAAlD,CAAwD,OAAxD,CAAvB;;AACA,UAAI,CAACuJ,mBAAD,IAAwBmC,cAAxB,IAA0C,EAAED,SAAS,GAAG,CAAd,CAA9C,EAAgE;AAC/DF,kBAAU,IAAIC,QAAd;AACA;;AACD,aAAOD,UAAP;AACA;;AACD,WAAOtJ,WAAW,CAACzC,QAAQ,CAACC,aAAT,CAAuB,KAAKkD,cAA5B,CAAD,CAAlB;AACA;;AAxKuC,CAAzC;AA2Ke;AACdgI,MAAI,EAAE,eADQ;AAEdrN,QAAM,EAAE,mBAFM;AAGdqO,YAAU,EAAE,CAHE;AAGC;AACfC,iBAAe,EAAE,IAJH;AAKdpC;AALc,CAAf,E;;;;;;;;;;;;ACxMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA,MAAM;AAAEvH,aAAF;AAAe5F;AAAf,IAA2BC,6CAAjC;AACA,MAAM;AAAEgG;AAAF,IAAqBC,0CAA3B;AACA,MAAM;AAAE8G,WAAF;AAAawC;AAAb,IAA2B1J,mDAAjC;AAEA;;;;;;;;;;;;;;;;;;AAkBA,MAAMO,QAAQ,GAAG,iCAAjB;AACA,MAAM8B,QAAQ,GAAI,GAAE9B,QAAS,uBAA7B;AACA,MAAMgC,YAAY,GAAI,GAAEhC,QAAS,wBAAjC;AAEA,MAAM8G,MAAM,GAAG,MAAMA,MAAN,SAAqBhH,6CAArB,CAA0B;AACxCC,aAAW,GAAG;AACb;AACA,SAAK+B,QAAL,GAAiB,GAAE9B,QAAS,uBAA5B;AACA,SAAKmD,YAAL,GAAoBvC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBe,UAArB,CAAgC,KAAKC,QAArC,CAApB;AACA,SAAKE,YAAL,GAAoBA,YAApB;AACA,SAAKZ,WAAL,GAAmB,IAAnB;AACA,SAAKnB,cAAL,GAAsB,mFAAtB;AACA,SAAKM,qBAAL,GACC,+FADD;AAEA,SAAKL,qBAAL,GACC,gIADD;AAEA,SAAKC,mBAAL,GAA2B,qCAA3B;AACA,SAAKkH,mBAAL,GAA2B,6BAA3B;AACA,SAAK+B,cAAL,GAAsB,KAAtB;AACA,SAAKC,mBAAL,GAA2B,2BAA3B;AACA,SAAKC,sBAAL,GAA8B,2BAA9B;AACA,SAAKvB,mBAAL,GAA2B,kBAA3B;AACA,SAAKF,wBAAL,GAAgC,kBAAhC;AACA,SAAK3C,OAAL,GAAe;AACd,sBAAgB,iDADF;AAEd,wBAAkB,MAFJ;AAGd,wBAAkB;AAHJ,KAAf;AAKA;;AAED,QAAM7G,cAAN,GAAuB;AACtB,UAAM+K,cAAc,GAAGzC,SAAS,CAAC,gBAAD,CAAT,KAAgC,MAAvD;AACA,UAAMjF,WAAW,GAAG5E,QAAQ,CAACC,aAAT,CAAuB,KAAKoD,mBAA5B,CAApB;AACA,UAAMyB,MAAM,GAAGhB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBe,UAArB,CAAgCC,QAAhC,CAAf;AACA,UAAMyH,WAAW,GAAGzM,QAAQ,CAACC,aAAT,CAAuB,KAAKsK,mBAA5B,CAApB;AACA,UAAMe,WAAW,GAAGmB,WAAW,IAAIA,WAAW,CAAC7D,YAA/C;AACA,UAAM8D,WAAW,GAAG1M,QAAQ,CAACC,aAAT,CAAuB,KAAKsM,mBAA5B,CAApB;AACA,UAAMI,cAAc,GAAG9C,SAAS,CAAC,aAAD,CAAT,KAA6B,IAApD;AACA,UAAM+C,aAAa,GAAG9J,cAAc,CAAC,KAAKK,cAAN,CAApC;AACA,UAAM0J,OAAO,GAAGD,aAAa,IAAInK,WAAW,CAACmK,aAAD,CAAX,GAA6B,CAA9D;AAEA,WAAO,CAACF,WAAD,IAAgB,CAACJ,cAAjB,IAAmC1H,WAAnC,IAAkDE,MAAlD,IAA4D,CAACwG,WAA7D,IAA4EqB,cAA5E,IAA8FE,OAArG;AACA;;AAED7L,kBAAgB,GAAG;AAClB,WAAO,CACN,GAAG,IAAIqE,GAAJ,CACF,CAAC,GAAGrF,QAAQ,CAACsF,gBAAT,CAA0B,KAAKkH,sBAA/B,CAAJ,EACE/G,GADF,CACMC,EAAE,IAAIA,EAAE,CAACoH,SAAH,CAAatM,KAAb,CAAmB,KAAKyK,mBAAxB,CADZ,EAEE1F,MAFF,CAESC,OAFT,EAGEC,GAHF,CAGMC,EAAE,IAAIA,EAAE,CAAC,CAAD,CAHd,CADE,CADG,CAAP;AAQA;;AAED3E,aAAW,CAACG,KAAD,EAAQ;AAClB,QAAI2I,SAAS,CAAC,eAAD,CAAb,EAAgC;AAC/B,aAAO5L,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,WAAOD,+CAAO,CAAC2H,IAAR,CAAa1E,KAAb,EAAoB2E,IAAI,IAAI,KAAKC,WAAL,CAAiBD,IAAjB,CAA5B,EACLtD,IADK,CACA,MAAM,KAAKwD,eAAL,EADN,EAELxD,IAFK,CAEAyD,YAAY,KAAK;AACtBC,mBAAa,EAAE,KAAKC,UAAL,CAAgBF,YAAhB,CADO;AAEtBG,wBAAkB,EAAE,KAAKC,eAAL,CAAqBJ,YAArB;AAFE,KAAL,CAFZ,CAAP;AAMA;;AAEDpF,YAAU,CAACM,KAAD,EAAQ+E,aAAa,GAAG,KAAKC,UAAL,EAAxB,EAA2CC,kBAAkB,GAAG,KAAKC,eAAL,EAAhE,EAAwF;AACjGzH,sDAAG,CAAC,mBAAD,EAAsBsH,aAAtB,CAAH;AACAtH,sDAAG,CAAC,wBAAD,EAA2BwH,kBAA3B,CAAH;AAEA,UAAMS,gBAAgB,GAAG,EAAzB;AACA,WAAO3I,+CAAO,CAAC2H,IAAR,CAAa1E,KAAb,EAAoB2E,IAAI,IAAI;AAClC,YAAMgB,MAAM,GAAG;AACdhB,YADc;AAEdiB,kBAAU,EAAEb,aAFE;AAGdc,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE,CAJG;AAKdC,eAAO,EAAE;AALK,OAAf;;AAOA,UAAI4C,SAAS,CAAC,eAAD,CAAb,EAAgC;AAC/BlL,0DAAG,CAAE,0BAAF,CAAH;AACAkI,cAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,eAAOhJ,+CAAO,CAAC8O,KAAR,CAAc,IAAd,EAAoBxK,IAApB,CAAyB,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BoJ,MAA1B,CAA/B,CAAP;AACA;;AACD,aAAO,KAAKL,UAAL,CAAgBX,IAAhB,EAAsBtD,IAAtB,CAA2B+F,QAAQ,IAAI;AAC7C,YAAInB,YAAY,GAAGmB,QAAnB;;AACA,YAAInB,YAAY,CAACD,MAAjB,EAAyB;AACxBL,gBAAM,CAACI,OAAP,GAAiB,KAAjB;AACA,iBAAOzJ,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BoJ,MAA1B,CAAP;AACA;;AACD,YAAI,OAAOM,YAAP,KAAwB,QAA5B,EAAsC;AACrCA,sBAAY,GAAG,KAAKpB,eAAL,EAAf;AACA;;AACDc,cAAM,CAACC,UAAP,GAAoB,KAAKZ,UAAL,CAAgBiB,YAAhB,CAApB;AACAN,cAAM,CAACE,aAAP,GAAuBd,aAAa,GAAGY,MAAM,CAACC,UAA9C;AACAD,cAAM,CAACG,SAAP,GAAmB,KAAKZ,eAAL,CAAqBe,YAArB,IAAqChB,kBAAxD;;AACA,YACCU,MAAM,CAACC,UAAP,GAAoBb,aAApB,IACA;AACCY,cAAM,CAACC,UAAP,KAAsBb,aAAtB,IAAuCY,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDJ,0BAAgB,CAACQ,IAAjB,CAAsBP,MAAtB;AACA;;AACD,eAAO,KAAKf,WAAL,CAAiBD,IAAjB,EAAuBtD,IAAvB,CAA4B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BoJ,MAA1B,CAAlC,CAAP;AACA,OApBM,CAAP;AAqBA,KAlCM,EAkCJtE,IAlCI,CAkCC,MAAM;AACb/E,kDAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,aAAK,EAAE0F,gBAAgB,CAACnB,GAAjB,CAAqB4B,QAAQ,IAAIA,QAAQ,CAACxB,IAA1C,CADiB;AAExByB,iBAAS,EAAEV,gBAFa;AAGxBX,qBAHwB;AAIxBE;AAJwB,OAAzB;AAMA,KAzCM,CAAP;AA0CA;;AAEDrF,YAAU,CAACyG,cAAD,EAAiB;AAC1B,UAAMX,gBAAgB,GAAGW,cAAc,CAACD,SAAxC;AACA,UAAM;AAAErB;AAAF,QAAoBsB,cAA1B;AACA,UAAM;AAAEpB;AAAF,QAAyBoB,cAA/B,CAH0B,CAK1B;;AACAX,oBAAgB,CAACY,IAAjB,CAAsB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC/B,UAAIA,CAAC,CAACX,aAAF,GAAkBU,CAAC,CAACV,aAApB,KAAsC,CAA1C,EAA6C;AAC5C,eAAOW,CAAC,CAACV,SAAF,GAAcS,CAAC,CAACT,SAAvB;AACA;;AACD,aAAOU,CAAC,CAACX,aAAF,GAAkBU,CAAC,CAACV,aAA3B;AACA,KALD;AAOA,QAAIY,YAAY,GAAG1B,aAAnB;AACA,QAAI2B,eAAe,GAAG,CAAtB;AACA,QAAIC,gBAAgB,GAAG,CAAvB;AACA,UAAMC,eAAe,GAAG,EAAxB;AAEA,WAAO7J,+CAAO,CAAC2H,IAAR,CAAagB,gBAAb,EAA+BS,QAAQ,IAAI;AACjD;AACA,aAAOpJ,+CAAO,CAAC8O,KAAR,CAAc,IAAd,EAAoBxK,IAApB,CAAyB,MAAM;AACrC,eAAO,KAAKiE,UAAL,CAAgBa,QAAQ,CAACxB,IAAzB,EAA+BtD,IAA/B,CAAoC,MAAM;AAChD,iBAAOtE,+CAAO,CAAC8O,KAAR,CAAc,IAAd,EAAoBxK,IAApB,CAAyB,MAAM;AACrC,mBAAO,KAAKwD,eAAL,GAAuBxD,IAAvB,CAA4B4E,YAAY,IAAI;AAClD,kBAAI,OAAOA,YAAP,KAAwB,QAAxB,IAAoCA,YAAY,CAACD,MAArD,EAA6D;AAC5D,uBAAOjJ,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,oBAAM4I,UAAU,GAAG,KAAKZ,UAAL,CAAgBiB,YAAhB,CAAnB;AACA,oBAAMJ,aAAa,GAAGd,aAAa,GAAGa,UAAtC;AACA,oBAAME,SAAS,GAAG,KAAKZ,eAAL,CAAqBe,YAArB,IAAqChB,kBAAvD;AAEA3I,0DAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBoI,oBAAI,EAAEwB,QAAQ,CAACxB,IADU;AAEzBiB,0BAFyB;AAGzBC,6BAHyB;AAIzBC;AAJyB,eAA1B;;AAMA,kBACCF,UAAU,GAAGa,YAAb,IACA;AACCb,wBAAU,KAAKa,YAAf,IAA+BX,SAAS,GAAGa,gBAH7C,EAIE;AACDC,+BAAe,CAACV,IAAhB,CAAqBC,QAAQ,CAACxB,IAA9B;AACA+B,+BAAe,GAAGb,aAAlB;AACAY,4BAAY,GAAGb,UAAf;AACAe,gCAAgB,GAAGb,SAAnB;AACA,uBAAO/I,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,qBAAO,KAAK4H,WAAL,CAAiBuB,QAAQ,CAACxB,IAA1B,CAAP;AACA,aA1BM,CAAP;AA2BA,WA5BM,CAAP;AA6BA,SA9BM,CAAP;AA+BA,OAhCM,CAAP;AAiCA,KAnCM,EAmCJtD,IAnCI,CAmCC,MACP/E,4CAAG,CAACC,KAAJ,CAAU,oBAAV,EAAgC;AAC/ByD,WAAK,EAAE4G,eADwB;AAE/BhB,gBAAU,EAAEa,YAFmB;AAG/BZ,mBAAa,EAAEa,eAHgB;AAI/BZ,eAAS,EAAEa;AAJoB,KAAhC,CApCM,CAAP;AA2CA;;AAEDhH,YAAU,CAACK,KAAD,EAAQ;AACjB,QAAIA,KAAK,IAAIA,KAAK,CAAC6G,MAAnB,EAA2B;AAC1B,aAAOsE,SAAS,CAAC,eAAD,EAAkB,IAAlB,EAAwB,EAAxB,CAAhB;AACA;;AACD,WAAOpO,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED+J,aAAW,CAACpC,IAAD,EAAO;AACjB,WAAO,KAAKmH,WAAL,CAAiB,WAAjB,EACLzK,IADK,CACA,MAAM;AACX,WAAKgC,eAAL,CAAqBG,GAArB,CAAyB,KAAKnB,eAA9B,EAA+CsC,IAA/C;AACA,aAAOqC,KAAK,CAAE,GAAE,KAAKhF,QAAS,wBAAlB,EAA2C;AACtDZ,cAAM,EAAE,MAD8C;AAEtD6F,mBAAW,EAAE,SAFyC;AAGtDC,eAAO,EAAE;AACR,0BAAgB;AADR,SAH6C;AAMtDC,YAAI,EAAE,KAAK9D;AAN2C,OAA3C,CAAZ;AAQA,KAXK,EAYLhC,IAZK,CAYA+F,QAAQ,IAAI;AACjB,aAAO,KAAK0E,WAAL,CAAiB,SAAjB,EAA4BzK,IAA5B,CAAiC,MAAM;AAC7C,eAAO+F,QAAQ,CAACC,IAAT,EAAP;AACA,OAFM,CAAP;AAGA,KAhBK,EAiBLhG,IAjBK,CAiBA+F,QAAQ,IAAI;AACjB;AACA;AACA,UAAI;AACH,eAAOE,IAAI,CAACC,KAAL,CAAWH,QAAX,CAAP;AACA,OAFD,CAEE,OAAOI,GAAP,EAAY;AACb,eAAOJ,QAAP;AACA;AACD,KAzBK,CAAP;AA0BA;;AAEDlH,wBAAsB,GAAG;AACxB,WAAO,KAAK2E,eAAL,GAAuBxD,IAAvB,CAA4B4E,YAAY,IAAI;AAClD,YAAM8B,KAAK,GAAG,KAAK/C,UAAL,CAAgBiB,YAAhB,CAAd;AACA,YAAMiC,WAAW,GAAGjC,YAAY,CAACgC,YAAb,GAA4BhC,YAAY,CAACgC,YAAzC,GAAwDhC,YAAY,CAACiC,WAAzF;AACA,YAAMwC,QAAQ,GAAG/O,OAAO,CAACuM,WAAW,CAACyC,YAAZ,CAAyBvC,OAAzB,CAAiC,OAAjC,EAA0C,EAA1C,CAAD,CAAP,IAA0D,CAA3E;AACA,YAAMwC,GAAG,GAAGjP,OAAO,CAACuM,WAAW,CAAC0C,GAAZ,CAAgBxC,OAAhB,CAAwB,OAAxB,EAAiC,EAAjC,CAAD,CAAnB;AACA,aAAOL,KAAK,GAAG2C,QAAR,GAAmBE,GAA1B;AACA,KANM,CAAP;AAOA;;AAEDkB,aAAW,CAACC,KAAD,EAAQ;AAClB,UAAMnE,SAAS,GAAG9I,QAAQ,CAACC,aAAT,CAAuB,KAAKoD,mBAA5B,CAAlB;AACAyF,aAAS,CAACoE,aAAV,CAAwB,IAAIC,KAAJ,CAAUF,KAAV,EAAiB;AAAEG,aAAO,EAAE;AAAX,KAAjB,CAAxB,EAFkB,CAGlB;;AACA,WAAOnP,+CAAO,CAAC8O,KAAR,CAAc,IAAd,EAAoBxK,IAApB,CAAyB,MAAM;AACrC,aAAOtE,+CAAO,CAACC,OAAR,EAAP;AACA,KAFM,CAAP;AAGA;;AApOuC,CAAzC;AAuOe;AACdiN,MAAI,EAAE,mBADQ;AAEdrN,QAAM,EAAE,qBAFM;AAGdkM,QAHc;AAIdqD,WAAS,EAAE,IAJG;AAKdjB,iBAAe,EAAE,IALH;AAMdD,YAAU,EAAE,CANE,CAMC;;AAND,CAAf,E;;;;;;;;;;;;ACtQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAM;AAAEtP;AAAF,IAAcC,6CAApB;AAEA;;;;;;;;;;;;;AAaA,MAAMoG,QAAQ,GAAG,4BAAjB;AACA,MAAM8B,QAAQ,GAAI,GAAE9B,QAAS,uBAA7B;AACA,MAAMgC,YAAY,GAAI,GAAEhC,QAAS,wBAAjC;AACA,MAAMW,YAAY,GAAGC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,QAArB,CAA8B,aAA9B,CAArB;AAEA,MAAM+F,MAAM,GAAG,MAAMA,MAAN,SAAqBhH,6CAArB,CAA0B;AACxCC,aAAW,GAAG;AACb;AACA,SAAKE,cAAL,GAAsB,mFAAtB;AACA,SAAKM,qBAAL,GACC,+FADD;AAEA,SAAK6J,QAAL,GAAgB,IAAhB;AACA,SAAK/J,eAAL,GAAuB,WAAvB;AACA,SAAKW,oBAAL,GAA4B,mBAA5B;AACA,SAAKC,uBAAL,GAA+BN,YAAY,GACxC,oCADwC,GAExC,2BAFH;AAGA,SAAKO,gBAAL,GAAwBP,YAAY,GAAG,6BAAH,GAAmC,8BAAvE;AACA,SAAKT,qBAAL,GACC,gIADD;AAEA,SAAKgB,gBAAL,GAAwBP,YAAY,GAAG,6BAAH,GAAmC,8BAAvE;AACA,SAAKY,cAAL,GAAsB,IAAID,eAAJ,EAAtB;AACA,SAAKH,mBAAL,GAA2B,CAA3B;AACA,SAAKhB,mBAAL,GAA2B,qCAA3B;AACA,SAAKkH,mBAAL,GAA2B,6BAA3B;AACA,SAAKgC,mBAAL,GAA2B,2BAA3B;AACA,SAAKgB,yBAAL,GAAiC,qCAAjC;AACA,SAAKvC,+BAAL,GAAuC,mCAAvC;AACA,SAAKwC,2BAAL,GAAmC,uBAAnC;AACA,SAAKvC,mBAAL,GAA2B,eAA3B;AACA,SAAKwC,aAAL,GAAqB,oBAArB;AAEAC,qDAAY,CAACC,UAAb,CAAwB;AACvBC,oBAAc,EAAE,IADO;AAEvBC,aAAO,EAAE;AAFc,KAAxB;AAIA;;AAEDtM,gBAAc,GAAG;AAChB,UAAMqD,WAAW,GAAG5E,QAAQ,CAACC,aAAT,CAAuB,KAAKoD,mBAA5B,CAApB;AACA,UAAMyB,MAAM,GAAGhB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBe,UAArB,CAAgCC,QAAhC,CAAf;AACA,UAAMyH,WAAW,GAAGzM,QAAQ,CAACC,aAAT,CAAuB,KAAKsK,mBAA5B,CAApB;AACA,UAAMmC,WAAW,GAAG1M,QAAQ,CAACC,aAAT,CAAuB,KAAKsM,mBAA5B,CAApB;AACA,UAAMjB,WAAW,GAAGmB,WAAW,IAAIA,WAAW,CAAC7D,YAA/C;AACA,UAAM3D,UAAU,GAAGnB,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBe,UAArB,CAAgCG,YAAhC,CAAnB;AACA,UAAM4I,cAAc,GAAG9N,QAAQ,CAACC,aAAT,CAAuB,KAAKsN,yBAA5B,CAAvB;AAEA,WAAO,CAACb,WAAD,IAAgB9H,WAAhB,KAAiCK,UAAU,IAAI,CAAC6I,cAAhB,IAAoChJ,MAAM,IAAI,CAACwG,WAA/E,CAAP;AACA;;AAED7K,iBAAe,GAAG;AACjB,SAAKgE,cAAL,CAAoBC,GAApB,CAAwB,QAAxB,EAAkC,KAAKN,gBAAvC;AACA,SAAKkJ,QAAL,GAAgB;AACfS,YAAM,EAAE7I,YADO;AAEfP,YAAM,EAAE,IAAIH,eAAJ,CAAoB;AAC3BwJ,cAAM,EAAE,EADmB;AAE3BC,iBAAS,EAAE;AAFgB,OAApB;AAFO,KAAhB;AAOA,WAAOhQ,+CAAO,CAACC,OAAR,EAAP;AACA;;AAED8C,kBAAgB,GAAG;AAClB,WAAOkH,KAAK,CAAE,GAAEhF,QAAS,YAAb,EAA0B;AACrCZ,YAAM,EAAE;AAD6B,KAA1B,CAAL,CAGLC,IAHK,CAGA+F,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EAHZ,EAILhG,IAJK,CAIAoJ,YAAY,IAAI;AACrB,aAAO,CACN,GAAG,IAAItG,GAAJ,CACF,CAAC,GAAGvC,iEAAc,CAAC,KAAKkI,+BAAN,EAAuCW,YAAvC,EAAqD,IAArD,CAAlB,EACElG,GADF,CACMoD,IAAI,IAAIA,IAAI,CAACxI,WADnB,EAEEkF,MAFF,CAESsD,IAAI,IAAI,KAAK2E,2BAAL,CAAiCU,IAAjC,CAAsCrF,IAAtC,CAFjB,CADE,CADG,EAMLpD,GANK,CAMDoD,IAAI,IAAIA,IAAI,CAACrI,KAAL,CAAW,KAAKyK,mBAAhB,EAAqC,CAArC,CANP,CAAP;AAOA,KAZK,CAAP;AAaA;;AAEDhK,kBAAgB,GAAG;AAClB,UAAMC,KAAK,GAAG,IAAImE,GAAJ,CACb,CAAC,GAAGrF,QAAQ,CAACsF,gBAAT,CAA0B,KAAKlC,qBAA/B,CAAJ,EAA2DmC,MAA3D,CAAkEC,OAAlE,EAA2EC,GAA3E,CAA+EC,EAAE,IAAIA,EAAE,CAACrF,WAAxF,CADa,CAAd;AAIA,WAAO;AACNa,WAAK,EAAE,CAAC,GAAGA,KAAJ,CADD;AAENC,eAAS,EAAED,KAAK,CAACyE;AAFX,KAAP;AAIA;;AAED5E,aAAW,CAACG,KAAD,EAAQ;AAClB,QAAIiN,YAAY,GAAG,IAAnB;AACA,WAAOlQ,+CAAO,CAAC2H,IAAR,CAAa1E,KAAb,EAAoB2E,IAAI,IAC9B,KAAKC,WAAL,CAAiBD,IAAjB,EAAuBtD,IAAvB,CAA4ByD,YAAY,IAAI;AAC3CmI,kBAAY,GAAGnI,YAAf;AACA,KAFD,CADM,EAILzD,IAJK,CAIA,OAAO;AACb0D,mBAAa,EAAE,KAAKmI,WAAL,CAAiBD,YAAjB,CADF;AAEbhI,wBAAkB,EAAE,KAAKkI,gBAAL,CAAsBF,YAAtB;AAFP,KAAP,CAJA,CAAP;AAQA;;AAEDvN,YAAU,CAACM,KAAD,EAAQ+E,aAAa,GAAG,KAAKmI,WAAL,EAAxB,EAA4CjI,kBAAkB,GAAG,KAAKkI,gBAAL,EAAjE,EAA0F;AACnG1P,sDAAG,CAAC,mBAAD,EAAsBsH,aAAtB,CAAH;AACAtH,sDAAG,CAAC,wBAAD,EAA2BwH,kBAA3B,CAAH;AAEA,UAAMS,gBAAgB,GAAG,EAAzB;AACA,WAAO3I,+CAAO,CAAC2H,IAAR,CAAa1E,KAAb,EAAoB2E,IAAI,IAAI;AAClC,YAAMgB,MAAM,GAAG;AACdhB,YADc;AAEdiB,kBAAU,EAAEb,aAFE;AAGdc,qBAAa,EAAE,CAHD;AAIdC,iBAAS,EAAE,CAJG;AAKdC,eAAO,EAAE;AALK,OAAf;AAOA,aAAO,KAAKT,UAAL,CAAgBX,IAAhB,EAAsBtD,IAAtB,CAA2ByD,YAAY,IAAI;AACjD,YAAI,OAAOA,YAAP,KAAwB,QAAxB,IAAoC,CAACA,YAAY,CAACkB,MAAtD,EAA8D;AAC7D,cAAIrD,YAAJ,EAAkB;AACjBgD,kBAAM,CAACC,UAAP,GAAoB,KAAKsH,WAAL,CAAiBpI,YAAjB,CAApB;AACAa,kBAAM,CAACE,aAAP,GAAuBd,aAAa,GAAGY,MAAM,CAACC,UAA9C;AACAD,kBAAM,CAACG,SAAP,GAAmB,KAAKqH,gBAAL,CAAsBrI,YAAtB,IAAsCG,kBAAzD;AACAU,kBAAM,CAACI,OAAP,GAAiB,IAAjB;;AACA,gBACCJ,MAAM,CAACC,UAAP,GAAoBb,aAApB,IACA;AACCY,kBAAM,CAACC,UAAP,KAAsBb,aAAtB,IAAuCY,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDJ,8BAAgB,CAACQ,IAAjB,CAAsBP,MAAtB;AACA;;AACD,mBAAO,KAAKf,WAAL,CAAiBD,IAAjB,EAAuBtD,IAAvB,CAA4B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BoJ,MAA1B,CAAlC,CAAP;AACA;;AACD,iBAAO,KAAKd,eAAL,GAAuBxD,IAAvB,CAA4B+L,YAAY,IAAI;AAClDzH,kBAAM,CAACC,UAAP,GAAoB,KAAKsH,WAAL,CAAiBE,YAAjB,CAApB;AACAzH,kBAAM,CAACE,aAAP,GAAuBd,aAAa,GAAGY,MAAM,CAACC,UAA9C;AACAD,kBAAM,CAACG,SAAP,GAAmB,KAAKqH,gBAAL,CAAsBC,YAAtB,IAAsCnI,kBAAzD;AACAU,kBAAM,CAACI,OAAP,GAAiB,IAAjB;;AACA,gBACCJ,MAAM,CAACC,UAAP,GAAoBb,aAApB,IACA;AACCY,kBAAM,CAACC,UAAP,KAAsBb,aAAtB,IAAuCY,MAAM,CAACG,SAAP,GAAmB,CAH5D,EAIE;AACDJ,8BAAgB,CAACQ,IAAjB,CAAsBP,MAAtB;AACA;;AACD,mBAAO,KAAKf,WAAL,CAAiBD,IAAjB,EAAuBtD,IAAvB,CAA4B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BoJ,MAA1B,CAAlC,CAAP;AACA,WAbM,CAAP;AAcA;;AACD,eAAO,KAAKf,WAAL,CAAiBD,IAAjB,EAAuBtD,IAAvB,CAA4B,MAAM/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0BoJ,MAA1B,CAAlC,CAAP;AACA,OAhCM,CAAP;AAiCA,KAzCM,EAyCJtE,IAzCI,CAyCC,MACP/E,4CAAG,CAACC,KAAJ,CAAU,aAAV,EAAyB;AACxByD,WAAK,EAAE0F,gBAAgB,CAACnB,GAAjB,CAAqB4B,QAAQ,IAAIA,QAAQ,CAACxB,IAA1C,CADiB;AAExByB,eAAS,EAAEV,gBAFa;AAGxBX,mBAHwB;AAIxBE;AAJwB,KAAzB,CA1CM,CAAP;AAiDA;;AAEDrF,YAAU,CAACyG,cAAD,EAAiB;AAC1B,UAAMX,gBAAgB,GAAGW,cAAc,CAACD,SAAxC;AACA,UAAM;AAAErB;AAAF,QAAoBsB,cAA1B;AACA,UAAM;AAAEpB;AAAF,QAAyBoB,cAA/B,CAH0B,CAK1B;;AACAX,oBAAgB,CAACY,IAAjB,CAAsB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC/B,UAAIA,CAAC,CAACX,aAAF,GAAkBU,CAAC,CAACV,aAApB,KAAsC,CAA1C,EAA6C;AAC5C,eAAOW,CAAC,CAACV,SAAF,GAAcS,CAAC,CAACT,SAAvB;AACA;;AACD,aAAOU,CAAC,CAACX,aAAF,GAAkBU,CAAC,CAACV,aAA3B;AACA,KALD;AAOA,QAAIY,YAAY,GAAG1B,aAAnB;AACA,QAAI2B,eAAe,GAAG,CAAtB;AACA,QAAIC,gBAAgB,GAAG,CAAvB;AACA,UAAMC,eAAe,GAAG,EAAxB;AAEA,WAAO7J,+CAAO,CAAC2H,IAAR,CAAagB,gBAAb,EAA+BS,QAAQ,IAC7C,KAAKb,UAAL,CAAgBa,QAAQ,CAACxB,IAAzB,EAA+BtD,IAA/B,CAAoCyD,YAAY,IAAI;AACnD,UAAI8B,eAAe,CAACC,MAAhB,IAA0B,KAAK1D,mBAAnC,EAAwD;AACvD,eAAO,KAAKyB,WAAL,CAAiBuB,QAAQ,CAACxB,IAA1B,EAAgCtD,IAAhC,CAAqC,MAC3C/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBoI,cAAI,EAAEwB,QAAQ,CAACxB,IADU;AAEzBiB,oBAAU,EAAEb,aAFa;AAGzBc,uBAAa,EAAE,CAHU;AAIzBC,mBAAS,EAAE,CAJc;AAKzBC,iBAAO,EAAE;AALgB,SAA1B,CADM,CAAP;AASA;;AACD,UAAI,OAAOjB,YAAP,KAAwB,QAAxB,IAAoCA,YAAY,CAACkB,MAArD,EAA6D;AAC5D,eAAO,KAAKpB,WAAL,CAAiBuB,QAAQ,CAACxB,IAA1B,EAAgCtD,IAAhC,CAAqC,MAC3C/E,4CAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBoI,cAAI,EAAEwB,QAAQ,CAACxB,IADU;AAEzBiB,oBAAU,EAAEb,aAFa;AAGzBc,uBAAa,EAAE,CAHU;AAIzBC,mBAAS,EAAE,CAJc;AAKzBC,iBAAO,EAAE;AALgB,SAA1B,CADM,CAAP;AASA;;AACD,UAAIpD,YAAJ,EAAkB;AACjB,cAAMiD,UAAU,GAAG,KAAKsH,WAAL,CAAiBpI,YAAjB,CAAnB;;AACA,cAAMe,aAAa,GAAGd,aAAa,GAAGa,UAAtC;AACA,cAAME,SAAS,GAAG,KAAKqH,gBAAL,CAAsBrI,YAAtB,IAAsCG,kBAAxD;AACA3I,oDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBoI,cAAI,EAAEwB,QAAQ,CAACxB,IADU;AAEzBiB,oBAFyB;AAGzBC,uBAHyB;AAIzBC;AAJyB,SAA1B;;AAMA,YACCF,UAAU,GAAGa,YAAb,IACA;AACCb,kBAAU,KAAKa,YAAf,IAA+BX,SAAS,GAAGa,gBAH7C,EAIE;AACDC,yBAAe,CAACV,IAAhB,CAAqBC,QAAQ,CAACxB,IAA9B;AACA+B,yBAAe,GAAGb,aAAlB;AACAY,sBAAY,GAAGb,UAAf;AACAe,0BAAgB,GAAGb,SAAnB;AACA,iBAAO/I,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,eAAO,KAAK4H,WAAL,CAAiBuB,QAAQ,CAACxB,IAA1B,CAAP;AACA;;AACD,aAAO,KAAKE,eAAL,GAAuBxD,IAAvB,CAA4B+L,YAAY,IAAI;AAClD,cAAMxH,UAAU,GAAG,KAAKsH,WAAL,CAAiBE,YAAjB,CAAnB;;AACA,cAAMvH,aAAa,GAAGd,aAAa,GAAGa,UAAtC;AACA,cAAME,SAAS,GAAG,KAAKqH,gBAAL,CAAsBC,YAAtB,IAAsCnI,kBAAxD;AACA3I,oDAAG,CAACC,KAAJ,CAAU,cAAV,EAA0B;AACzBoI,cAAI,EAAEwB,QAAQ,CAACxB,IADU;AAEzBiB,oBAFyB;AAGzBC,uBAHyB;AAIzBC;AAJyB,SAA1B;;AAMA,YACCF,UAAU,GAAGa,YAAb,IACA;AACCb,kBAAU,KAAKa,YAAf,IAA+BX,SAAS,GAAGa,gBAH7C,EAIE;AACDC,yBAAe,CAACV,IAAhB,CAAqBC,QAAQ,CAACxB,IAA9B;AACA+B,yBAAe,GAAGb,aAAlB;AACAY,sBAAY,GAAGb,UAAf;AACAe,0BAAgB,GAAGb,SAAnB;AACA,iBAAO/I,+CAAO,CAACC,OAAR,EAAP;AACA;;AACD,eAAO,KAAK4H,WAAL,CAAiBuB,QAAQ,CAACxB,IAA1B,CAAP;AACA,OAtBM,CAAP;AAuBA,KArED,CADM,EAuELtD,IAvEK,CAuEA,MACN/E,4CAAG,CAACC,KAAJ,CAAU,oBAAV,EAAgC;AAC/ByD,WAAK,EAAE4G,eADwB;AAE/BhB,gBAAU,EAAEa,YAFmB;AAG/BZ,mBAAa,EAAEa,eAHgB;AAI/BZ,eAAS,EAAEa;AAJoB,KAAhC,CAxEM,CAAP;AA+EA;;AAEDzG,wBAAsB,GAAG;AACxB,WAAOnD,+CAAO,CAAC8O,KAAR,CAAc,IAAd,EAAoBxK,IAApB,CAAyB,MAC/B,KAAKwD,eAAL,GAAuBxD,IAAvB,CAA4ByD,YAAY,IAAI;AAC3C,YAAM;AAAE6F,oBAAF;AAAgBC;AAAhB,UAAwB9F,YAAY,CAACmD,YAAb,GAC3BnD,YAAY,CAACmD,YADc,GAE3BnD,YAAY,CAACoD,WAFhB;;AAGA,YAAMH,KAAK,GAAG,KAAKmF,WAAL,CAAiBpI,YAAjB,CAAd;;AACA,YAAMuI,cAAc,GACnB1C,YAAY,CAAC2C,WAAb,OAA+B,MAA/B,IAAyC3C,YAAY,CAAC2C,WAAb,OAA+B,KAAxE,GACG,CADH,GAEG3R,OAAO,CAACgP,YAAY,CAACvC,OAAb,CAAqB,KAAKmE,aAA1B,EAAyC,EAAzC,CAAD,CAHX;AAIA,YAAMgB,SAAS,GAAG5R,OAAO,CAACiP,GAAG,CAAC0C,WAAJ,OAAsB,KAAtB,GAA8B,CAA9B,GAAkC1C,GAAG,CAACxC,OAAJ,CAAY,KAAKmE,aAAjB,EAAgC,EAAhC,CAAnC,CAAzB;AACA,aAAOxE,KAAK,GAAGsF,cAAR,GAAyBE,SAAhC;AACA,KAXD,CADM,CAAP;AAcA;;AAEDjI,YAAU,CAACX,IAAD,EAAO;AAChB,SAAKyH,QAAL,CAAc3I,MAAd,CAAqBD,GAArB,CAAyB,QAAzB,EAAmC,KAAKR,oBAAxC;AACA,WAAO,KAAK+D,WAAL,CAAiBpC,IAAjB,CAAP;AACA;;AAEDC,aAAW,CAACD,IAAD,EAAO;AACjB,SAAKyH,QAAL,CAAc3I,MAAd,CAAqBD,GAArB,CAAyB,QAAzB,EAAmC,KAAKP,uBAAxC;AACA,WAAO,KAAK8D,WAAL,CAAiBpC,IAAjB,CAAP;AACA;;AAEDoC,aAAW,CAACpC,IAAD,EAAO;AACjB,SAAKyH,QAAL,CAAc3I,MAAd,CAAqBD,GAArB,CAAyB,KAAKnB,eAA9B,EAA+CsC,IAA/C;AACA,WAAOqC,KAAK,CAAC,KAAKoF,QAAL,CAAcS,MAAf,EAAuB;AAClCzL,YAAM,EAAE,MAD0B;AAElC6F,iBAAW,EAAE,SAFqB;AAGlCC,aAAO,EAAE;AACR,wBAAgB;AADR,OAHyB;AAMlCC,UAAI,EAAE,KAAKiF,QAAL,CAAc3I;AANc,KAAvB,CAAL,CAQLpC,IARK,CAQA+F,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EARZ,EASLhG,IATK,CASA+F,QAAQ,IAAI;AACjB;AACA;AACA,UAAI;AACH,eAAOE,IAAI,CAACC,KAAL,CAAWH,QAAX,CAAP;AACA,OAFD,CAEE,OAAOI,GAAP,EAAY;AACb,eAAOJ,QAAP;AACA;AACD,KAjBK,CAAP;AAkBA;;AAEDvC,iBAAe,GAAG;AACjB,WAAOmC,KAAK,CAAChD,YAAD,EAAe;AAC1B5C,YAAM,EAAE,MADkB;AAE1B6F,iBAAW,EAAE,SAFa;AAG1BC,aAAO,EAAE;AACR,wBAAgB,iDADR;AAER,4BAAoB;AAFZ,OAHiB;AAO1BC,UAAI,EAAE,KAAK5D;AAPe,KAAf,CAAL,CAQJlC,IARI,CAQC+F,QAAQ,IAAIA,QAAQ,CAACU,IAAT,EARb,CAAP;AASA;;AAEDoF,aAAW,CAACzF,IAAI,GAAG,KAAR,EAAe;AACzB,QAAIM,KAAK,GAAG,IAAZ;;AACA,QAAIN,IAAJ,EAAU;AACT;AACA,YAAMO,OAAO,GAAGP,IAAI,CAACQ,YAAL,GAAoBR,IAAI,CAACQ,YAAzB,GAAwCR,IAAI,CAACS,WAA7D;AACAH,WAAK,GAAGpM,OAAO,CAACqM,OAAO,CAACG,UAAR,CAAmBC,OAAnB,CAA2B,KAAKmE,aAAhC,EAA+C,EAA/C,EAAmDiB,IAAnD,EAAD,CAAf;AACA,KAJD,MAIO;AACNzF,WAAK,GAAGpM,OAAO,CACdmD,QAAQ,CACNC,aADF,CACgB,KAAKkD,cADrB,EAEE9C,WAFF,CAEciJ,OAFd,CAEsB,KAAKmE,aAF3B,EAE0C,EAF1C,EAGEiB,IAHF,EADc,CAAf;AAMA;;AACD,WAAOzF,KAAP;AACA;;AAEDoF,kBAAgB,CAAC1F,IAAD,EAAO;AACtB,QAAIA,IAAJ,EAAU;AACT,aAAOA,IAAI,CAACY,SAAL,GAAiBZ,IAAI,CAACY,SAAL,CAAexB,MAAhC,GAAyCY,IAAI,CAACa,UAAL,CAAgBzB,MAAhE;AACA;;AACD,WAAO,CAAC,GAAG/H,QAAQ,CAACsF,gBAAT,CAA0B,KAAK7B,qBAA/B,CAAJ,EAA2DsE,MAAlE;AACA;;AA9UuC,CAAzC;AAiVe;AACdoD,MAAI,EAAE,6BADQ;AAEdrN,QAAM,EAAE,gBAFM;AAGdkM,QAHc;AAIdqD,WAAS,EAAE,IAJG;AAKdjB,iBAAe,EAAE;AALH,CAAf,E;;;;;;;;;;;;AC5WA;AAAA;AAAA;AAEA,MAAMlJ,QAAQ,GAAG,wBAAjB;AACA,MAAM8B,QAAQ,GAAI,GAAE9B,QAAS,uBAA7B;AACA,MAAMgC,YAAY,GAAI,GAAEhC,QAAS,wBAAjC;AAEA;;;;;;;;;;;;;;;;;;AAkBA,MAAM8G,MAAM,GAAG,MAAMA,MAAN,SAAqBhH,6CAArB,CAA0B;AACxCC,aAAW,GAAG;AACb;AACA,SAAKC,QAAL,GAAgBA,QAAhB;AACA,SAAKoB,WAAL,GAAmB,IAAnB;AACA,SAAKU,QAAL,GAAgBA,QAAhB;AACA,SAAKE,YAAL,GAAoBA,YAApB;AACA,UAAMrB,YAAY,GAAGC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,QAArB,CAA8B,aAA9B,CAArB;AACA,SAAKC,oBAAL,GAA4BL,YAAY,GAAG,mBAAH,GAAyB,wBAAjE;AACA;;AAEDhD,YAAU,GAAG;AACZ,WAAO5C,OAAO,CAACC,OAAR,EAAP;AACA;;AAbuC,CAAzC;AAgBe;AACdiN,MAAI,EAAE,cADQ;AAEdrN,QAAM,EAAE,YAFM;AAGdkM,QAHc;AAIdoC,iBAAe,EAAE,IAJH;AAKdiB,WAAS,EAAE;AALG,CAAf,E","file":"drivers__saks.bundle.js","sourcesContent":["import bus from '../bus';\nimport { log, format } from '../../utils';\nimport { backgroundMessaging, handleDriverError } from '../lib';\n\nconst { toFloat } = format;\n\nexport default class BaseDriver {\n\t/**\n\t * @function watchForRestoreUserData - set up a listener to check user data restorement\n\t * @emits bus#RestoreUserData - the event that indicates to the app\tthat user data could be restored\n\t */\n\twatchForRestoreUserData(time = 500) {\n\t\tlet pauseInterval = false;\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tconst currentState = await this.checkRestoreDataCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t\tif (currentState) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tbus.$emit('restore-user-data');\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkRestoreDataCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t}\n\t\t}, time);\n\n\t\treturn interval;\n\t}\n\n\tcheckRestoreDataCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * @function storeUserData\n\t * @param {String} domain - domain to set the driver storage\n\t * @returns {Promise}\n\t */\n\tasync storeUserData(domain) {\n\t\tconst userData = await this.getUserData();\n\n\t\tif (userData === null) {\n\t\t\t// Nothing to store\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst storageRecord = {\n\t\t\tuserData,\n\t\t\tstoredTime: Date.now(),\n\t\t};\n\t\tbackgroundMessaging.setDriverStorage(userDataKey, storageRecord);\n\t\tlog('Stored user data: %O', storageRecord);\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function restoreUserData\n\t * @param {String} domain - domain to access the driver storage\n\t * @param {Number} [maxStorageLifetime] - optional, the lifetime of the stored data (default 10 mins)\n\t * @returns {Promise}\n\t */\n\tasync restoreUserData(domain, maxStorageLifetime = 600000) {\n\t\tconst userDataKey = this.getUserDataStorageKey(domain);\n\t\tconst driverStorage = await backgroundMessaging.getDriverStorage(userDataKey);\n\n\t\tif (driverStorage) {\n\t\t\tconst { storedTime, userData } = driverStorage;\n\t\t\t// Clear stored user data\n\t\t\tbackgroundMessaging.deleteDriverStorage(userDataKey);\n\n\t\t\tif (Date.now() - storedTime <= maxStorageLifetime) {\n\t\t\t\tlog('Restore user data: %O', userData);\n\t\t\t\treturn this.setUserData(userData);\n\t\t\t}\n\t\t\tlog('User data is outdated, skip restoring');\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserData - get user data which should be stored\n\t * @returns {Object} - object with required user data which should be restored\n\t */\n\tgetUserData() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function setUserData - restore user data on page\n\t * @param {Object} userData - data which was saved and should be restored\n\t * @returns {Promise}\n\t */\n\tsetUserData() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function getUserDataStorageKey - unique key for storing user data per merchant\n\t * @returns {String}\n\t */\n\tgetUserDataStorageKey(domain) {\n\t\t// Append `_userData` to avoid possible conflicts with created storage from driver\n\t\treturn `${domain}_userData`;\n\t}\n\n\t/**\n\t * Parses start price from page\n\t *\n\t * @function getStartPrice\n\t * @returns {Promise<Number>|Number} - the total from the page\n\t */\n\tgetStartPrice() {\n\t\tlet startPrice = Number.MAX_SAFE_INTEGER;\n\t\tconst totalElementConfig = this.TOTAL_ELEMENT_CONFIG;\n\t\tif (totalElementConfig) {\n\t\t\tconst { selector, attribute, regex } = totalElementConfig;\n\t\t\tlet totalElement;\n\t\t\t// handle case, when there is array of selectors and we try to take totalElement using these selectors in turn\n\t\t\t// for example dell.com, hertz.com\n\t\t\tif (Array.isArray(selector)) {\n\t\t\t\tselector.forEach(elemSelector => {\n\t\t\t\t\tif (!totalElement) {\n\t\t\t\t\t\ttotalElement = document.querySelector(elemSelector);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\ttotalElement = document.querySelector(selector);\n\t\t\t} else {\n\t\t\t\thandleDriverError(\n\t\t\t\t\tnew Error(`Total selector type mismatch. Expected string | array, got ${typeof selector}`),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (totalElement) {\n\t\t\t\tlet value = attribute ? totalElement.getAttribute(attribute) : totalElement.textContent;\n\n\t\t\t\tif (value && regex) {\n\t\t\t\t\t// Set pattern to null to receive error in case pattern was not defined\n\t\t\t\t\t// otherwise we may silently return undefined or empty string\n\t\t\t\t\tconst { pattern = null, group = 0 } = regex;\n\t\t\t\t\tvalue = value.match(pattern)[group];\n\t\t\t\t}\n\t\t\t\tstartPrice = toFloat(value);\n\t\t\t}\n\t\t}\n\t\treturn startPrice;\n\t}\n\n\t/**\n\t * Perform any needed actions and setup to start codes testing\n\t *\n\t * @function beforeTestCodes\n\t *\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @typedef {Object} OriginalData\n\t * @property {Number} originalPrice the starting price for the cart\n\t * @property {Number} originalItemsCount the starting items count of the cart\n\t */\n\t/**\n\t * Perform any needed actions and setup before `checkCodes()` will be executed\n\t *\n\t * @function beforeCheckCodes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tbeforeCheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Perform any needed actions and setup before `applyCodes()` will be executed\n\t *\n\t * @function beforeApplyCodes\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function checkCodes\n\t *\n\t * @param {String[]} codes\n\t * @param {Number} [originalPrice] - optional, the starting price for the cart\n\t * @param {Number} [originalItemsCount] - optional, the starting items count of the cart\n\t * @returns {Promise}\n\t */\n\tcheckCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes each code in @param codes and actually applies it to the cart,\n\t * typically through a fetch(...) call.\n\t *\n\t * @function applyCodes\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tapplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function stackCodes\n\t *\n\t * @param {Object} validationInfo - contains all required info passed by `checkCodes()` for codes stacking\n\t * @param {String[]} validationInfo.codes\n\t * @param {Float} [validationInfo.originalPrice]\n\t * @param {Object[]} [validationInfo.discounts] - contains all codes mapped with their discounts\n\t * @returns {Promise}\n\t */\n\tstackCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function removeCodes\n\t *\n\t * @param {String[]} codes - passed in case the driver needs to know specific codes to do removal\n\t * @returns {Promise.<Number>|Promise.<OriginalData>} - optional, a promise which resolves to the original price of the cart\n\t * \t\t\t\t\t\t\t\t\t\t\t\t\t\tor original data which includes originalItemsCount as well\n\t */\n\tremoveCodes() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request response) which are available and were not applied by user\n\t *\n\t * @function getMerchantCodes\n\t * @returns {String[]} - codes from merhcant page (or request response if possible)\n\t */\n\tgetMerchantCodes() {\n\t\treturn [];\n\t}\n\n\t/**\n\t * Takes codes from merchant page (or request) which are available and were applied by user\n\t *\n\t * @typedef {Object} ExistingCodeInfo\n\t * @prop {String[]} codes - list of codes which had been applied, if discoverable\n\t * @prop {Number} codeCount - the number of codes that were applied to the cart\n\t */\n\t/**\n\t * @function getExistingCodes\n\t * @returns {ExistingCodeInfo}\n\t */\n\tgetExistingCodes() {\n\t\treturn {\n\t\t\tcodes: [],\n\t\t\tcodeCount: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Parses pre tax and shipping total from page or request's response\n\t *\n\t * @function getPreTaxShippingTotal\n\t * @returns {Promise<Number>|Number} - the total without tax and shipping\n\t */\n\tgetPreTaxShippingTotal() {\n\t\treturn null;\n\t}\n\n\t/**\n\t * @function watchForCartUrl - optional function to set up a listener for url changes on SPAs\n\t * @emits bus#CartActive - the event (using the string 'cart-active') that indicates to the app that test codes button should be shown\n\t * @emits bus#CartInactive - the event (using the string 'cart-inactive') that indicates to the app that test codes button should be hidden\n\t */\n\twatchForCartUrl(time = 500) {\n\t\tlet previousState = null;\n\t\tlet pauseInterval = false;\n\n\t\tconst interval = setInterval(async () => {\n\t\t\tif (!pauseInterval) {\n\t\t\t\tlet currentState = null;\n\t\t\t\ttry {\n\t\t\t\t\t// Pause interval to avoid triggering multiple times `checkCondition`\n\t\t\t\t\t// before the response will be received\n\t\t\t\t\tpauseInterval = true;\n\t\t\t\t\tcurrentState = await this.checkCondition();\n\t\t\t\t\tpauseInterval = false;\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleDriverError(e, { source: 'checkCondition' });\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\t\t\t\tif (currentState !== previousState) {\n\t\t\t\t\tbus.$emit(currentState ? 'cart-active' : 'cart-inactive');\n\t\t\t\t}\n\t\t\t\tpreviousState = currentState;\n\t\t\t}\n\t\t}, time);\n\t\t// return the interval to stop it in `watchForCartUrl` if needed from outside\n\t\treturn interval;\n\t}\n\n\t/**\n\t * @function checkCondition - optional function to check for conditions on SPAs\n\t * @returns {Boolean}\n\t */\n\tcheckCondition() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Perform custom completion action on Continue to Checkout button\n\t * Takes best codes in @param codes\n\t *\n\t * @function completeExperience\n\t *\n\t * @param {String[]} codes\n\t * @returns {Promise}\n\t */\n\tcompleteExperience() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * @function completeExperiencePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcompleteExperiencePromisified(...args) {\n\t\treturn this._promisify(this.completeExperience, args);\n\t}\n\n\t/**\n\t * @function beforeCodesTestingPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeTestCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeTestCodes, args);\n\t}\n\n\t/**\n\t * @function getStartPricePromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetStartPricePromisified() {\n\t\treturn this._promisify(this.getStartPrice);\n\t}\n\n\t/**\n\t * @function getMerchantCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetMerchantCodesPromisified(...args) {\n\t\treturn this._promisify(this.getMerchantCodes, args);\n\t}\n\n\t/**\n\t * @function getExistingCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tgetExistingCodesPromisified(...args) {\n\t\treturn this._promisify(this.getExistingCodes, args);\n\t}\n\n\t/**\n\t * @function removeCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tremoveCodesPromisified(...args) {\n\t\treturn this._promisify(this.removeCodes, args);\n\t}\n\n\t/**\n\t * @function beforeApplyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeApplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeApplyCodes, args);\n\t}\n\n\t/**\n\t * @function applyCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tapplyCodesPromisified(...args) {\n\t\treturn this._promisify(this.applyCodes, args);\n\t}\n\n\t/**\n\t * @function beforeCheckCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tbeforeCheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.beforeCheckCodes, args);\n\t}\n\n\t/**\n\t * @function checkCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tcheckCodesPromisified(...args) {\n\t\treturn this._promisify(this.checkCodes, args);\n\t}\n\n\t/**\n\t * @function stackCodesPromisified - promisified wrapper function to guarantee that Promise will be returned (or exception from Promise)\n\t * @returns {Promise}\n\t */\n\tstackCodesPromisified(...args) {\n\t\treturn this._promisify(this.stackCodes, args);\n\t}\n\n\t/**\n\t * @function _promisify - promisifies given method and return it's result as a Promise\n\t * @returns {Promise}\n\t */\n\t_promisify(method, args) {\n\t\treturn Promise.resolve().then(() => method.apply(this, args));\n\t}\n}\n","import Promise from 'bluebird';\nimport BaseDriver from '../base';\nimport bus from '../../bus';\nimport { format, DOM, log, browserUtils } from '../../../utils';\n\nconst { toFloat, elemToFloat } = format;\nconst { wait } = browserUtils;\nconst { extractFormValues, setValue, extractElement } = DOM;\n\n/* Behaviour\n * Saks sites sometimes have two different design\n * For now, saksfifthavenue and saksoff5th have new design\n * lordandtaylor has old design\n * Base driver has logic for `old design`\n * Difference:\n * - selectors\n * - event in `setValue`\n * - watchForCartUrl\n */\n\nexport default class Saks extends BaseDriver {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = '';\n\t\tthis.TOTAL_SELECTOR = '#jsVal-grandTotal, .hbc-price-display__subtotal .hbc-price-display__summary-price';\n\t\tthis.APPLIED_CODE_SELECTOR =\n\t\t\t'.jsRemovePromo .action-link-text, .widebag-item-promotion-codes li, .shopping-bag-item__promo-code, .hbc-cart-item__promo-code';\n\t\tthis.CODE_INPUT_SELECTOR = '#promoCodeEntry, [name=\"promoCode\"]';\n\t\tthis.APPLY_BUTTON_SELECTOR = '#promoApply, .hbc-promo-code__submit-btn';\n\n\t\tthis.CODE_PARAM_NAME = 'promoCode';\n\n\t\tthis.CHECKOUT_PAYMENT_FORM_SELECTOR = '#submit_payment_service';\n\t\tthis.PRODUCT_ITEM_SELECTOR =\n\t\t\t'.widebag-item:not([id^=saveFor]), .minibag-item, .shopping-bag-item--purchase, .hbc-cart-item';\n\t\tthis.EDIT_BUTTON_SELECTOR = '.promotion-summary a';\n\t\tthis.MODAL_WINDOW_SELECTOR = '#jsEditPromoCode';\n\t\tthis.MODAL_CLOSE_BUTTON_SELECTOR = '.modal-close';\n\n\t\tconst isOnCartPage = window.location.href.includes('SaksBag.jsp');\n\t\tthis.ADD_CODE_PARAM_VALUE = 'applyPromoSaksBag';\n\t\tthis.REMOVE_CODE_PARAM_VALUE = isOnCartPage\n\t\t\t? 'remove_promo_code_saks_bag_service'\n\t\t\t: 'remove_promo_code_service';\n\t\tthis.CART_PARAM_VALUE = isOnCartPage ? 'initialize_saks_bag_service' : 'continue_to_checkout_service';\n\n\t\tthis.MAX_STACKED_COUPONS = 5;\n\n\t\tthis.isStackable = false;\n\n\t\tthis.requestBodyData = new URLSearchParams();\n\t\tthis.updateCartBody = new URLSearchParams();\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.updateCartBody.set('bmForm', this.CART_PARAM_VALUE);\n\t\tif (document.querySelector(this.CHECKOUT_PAYMENT_FORM_SELECTOR)) {\n\t\t\tthis.requestBodyData = extractFormValues(this.CHECKOUT_PAYMENT_FORM_SELECTOR).params;\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tcheckCondition() {\n\t\tconst isCodeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isEditPromoButton = document.querySelector(this.EDIT_BUTTON_SELECTOR);\n\t\tconst isCart =\n\t\t\twindow.location.href.startsWith(this.CART_URL) && document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isCheckout = window.location.href.startsWith(this.CHECKOUT_URL);\n\t\tconst isPaymentFilled =\n\t\t\tthis._isPaymentFilled(`${this.CHECKOUT_PAYMENT_FORM_SELECTOR} input`) &&\n\t\t\tthis._isPaymentFilled(`${this.CHECKOUT_PAYMENT_FORM_SELECTOR} select`);\n\n\t\treturn (isCart && isCodeInput) || (isCheckout && ((isCodeInput && isPaymentFilled) || isEditPromoButton));\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.APPLIED_CODE_SELECTOR)].filter(Boolean).map(el => el.textContent),\n\t\t);\n\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\treturn Promise.each(codes, code => this._removeCode(code))\n\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t.then(responseJSON => ({\n\t\t\t\toriginalPrice: this.parseTotal(responseJSON),\n\t\t\t\toriginalItemsCount: this.parseItemsCount(responseJSON),\n\t\t\t}));\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this.IS_CART_PAGE ? this.applyCodesOnCart(codes[0]) : this.applyCodesOnCheckout(codes[0]);\n\t}\n\n\tapplyCodesOnCart(code) {\n\t\treturn this.isStackable ? Promise.resolve() : this._applyCode(code);\n\t}\n\n\tapplyCodesOnCheckout(code) {\n\t\tif (!document.querySelector(this.EDIT_BUTTON_SELECTOR)) {\n\t\t\tif (this.IS_CART_PAGE) {\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\treturn this._removeCode(code).then(() => this._actionWithPromoElements(code));\n\t\t}\n\t\tconst isModalWindowOnPage = () => !!document.querySelector(this.MODAL_WINDOW_SELECTOR);\n\t\tdocument.querySelector(this.EDIT_BUTTON_SELECTOR).click();\n\t\treturn wait(isModalWindowOnPage)\n\t\t\t.then(() => this._removeCode(code).then(() => this._actionWithPromoElements(code)))\n\t\t\t.then(() => {\n\t\t\t\tif (document.querySelector(this.MODAL_CLOSE_BUTTON_SELECTOR)) {\n\t\t\t\t\tdocument.querySelector(this.MODAL_CLOSE_BUTTON_SELECTOR).click();\n\t\t\t\t}\n\t\t\t\treturn Promise.resolve();\n\t\t\t});\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tfreeGifts: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tif (typeof responseJSON === 'object' && !responseJSON.errors) {\n\t\t\t\t\treturn this._getUpdatedCart().then(cartResponse => {\n\t\t\t\t\t\tresult.finalPrice = this.parseTotal(cartResponse);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tresult.freeGifts = this.parseItemsCount(cartResponse) - originalItemsCount;\n\t\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t});\n\t\t}).then(() => {\n\t\t\tif (this.isStackable) {\n\t\t\t\tbus.$emit('stack-codes', {\n\t\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\t\toriginalPrice,\n\t\t\t\t\toriginalItemsCount,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice } = validationInfo;\n\t\tconst { originalItemsCount } = validationInfo;\n\n\t\t// Sort by discount and free gifts count\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis._applyCode(discount.code).then(() =>\n\t\t\t\tthis._getUpdatedCart().then(cartResponse => {\n\t\t\t\t\tconst finalPrice = this.parseTotal(cartResponse);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst freeGifts = this.parseItemsCount(cartResponse) - originalItemsCount;\n\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\tfreeGifts,\n\t\t\t\t\t});\n\t\t\t\t\tif (successfulCodes.length >= this.MAX_STACKED_COUPONS) {\n\t\t\t\t\t\treturn this.removeCode(discount.code);\n\t\t\t\t\t}\n\t\t\t\t\tif (\n\t\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t\t) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this._removeCode(discount.code);\n\t\t\t\t}),\n\t\t\t),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t}),\n\t\t);\n\t}\n\n\t_applyCode(code) {\n\t\tthis.requestBodyData.set('bmForm', this.ADD_CODE_PARAM_VALUE);\n\t\treturn this._manageCode(code);\n\t}\n\n\t_removeCode(code) {\n\t\tthis.requestBodyData.set('bmForm', this.REMOVE_CODE_PARAM_VALUE);\n\t\treturn this._manageCode(code);\n\t}\n\n\t_manageCode(code) {\n\t\tthis.requestBodyData.set(this.CODE_PARAM_NAME, code);\n\t\treturn fetch(`${this.BASE_URL}/checkout/checkout.jsp`, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8',\n\t\t\t},\n\t\t\tbody: this.requestBodyData,\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\t// If we are blocked or session expired we could receive text\n\t\t\t\t// To prevent driver from falling we handle this case\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (err) {\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t_isPaymentFilled(selector) {\n\t\tconst data = [...document.querySelectorAll(selector)].filter(el => el.offsetParent !== null);\n\t\tif (data.length > 0) {\n\t\t\treturn data.length === data.filter(item => item.value !== '').length;\n\t\t}\n\t\tif (document.querySelector(selector)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t_actionWithPromoElements(code) {\n\t\tconst codeInput = extractElement(this.CODE_INPUT_SELECTOR);\n\t\tconst applyButton = extractElement(this.APPLY_BUTTON_SELECTOR);\n\t\tsetValue(codeInput, code, 'input');\n\t\tsetValue(codeInput, code, 'blur');\n\t\tapplyButton.click();\n\t\treturn Promise.resolve();\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(this.IS_CART_PAGE ? this.CART_URL : this.CHECKOUT_URL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8',\n\t\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t},\n\t\t\tbody: this.updateCartBody,\n\t\t}).then(response => response.json());\n\t}\n\n\tparseTotal(data) {\n\t\tlet total = null;\n\t\tif (data) {\n\t\t\t// Replace dollar sign\n\t\t\tconst summary = data.orderSummary ? data.orderSummary : data.cartSummary;\n\t\t\ttotal = toFloat(summary.grandTotal.replace('&#36;', ''));\n\t\t} else {\n\t\t\ttotal = elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t\t}\n\t\treturn total;\n\t}\n\n\tparseItemsCount(data) {\n\t\tif (data) {\n\t\t\treturn data.cartItems ? data.cartItems.length : data.orderItems.length;\n\t\t}\n\t\treturn [...document.querySelectorAll(this.PRODUCT_ITEM_SELECTOR)].length;\n\t}\n}\n","import lordandtaylor from './lordandtaylor.com';\nimport saksfifthavenue from './saksfifthavenue.com';\nimport saksoff5th from './saksoff5th.com';\nimport thebay from './thebay.com';\n\nexport default [lordandtaylor, saksfifthavenue, saksoff5th, thebay];\n","import Promise from 'bluebird';\nimport Saks from './_base';\nimport { DOM, format, browserUtils } from '../../../utils';\n\nconst { getCookie } = browserUtils;\nconst { toFloat, elemToFloat } = format;\nconst { extractElement, extractFormValues, extractData } = DOM;\n\nconst BASE_URL = 'https://www.lordandtaylor.com';\nconst CHECKOUT_URL = `${BASE_URL}/checkout/checkout.jsp`;\nconst IS_ON_CHECKOUT_PAGE = window.location.href.startsWith(CHECKOUT_URL);\n\n/* Behavior description:\n- Existing code: yes\n- Remove code: yes\n- Stackable: no\n- Free gift support: no\n- Free shipping: no\n- ‘isValid’ implemented: yes\n- Manually apply code: no\n- Pages, where extension works: cart, checkout(last step)\n- Is driver SPA: yes\n- Gather codes on site pages: yes (/Entry.jsp page)\n=======================\nSpecial case:\n\t- On checkout page we use fake credit card data for applying promo code\n\t- maxCoupons: 4 due to blocks\n*/\n\nconst Driver = class Driver extends Saks {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.CART_URL = `${BASE_URL}/checkout/SaksBag.jsp`;\n\t\tthis.IS_CART_PAGE = window.location.href.startsWith(this.CART_URL);\n\t\tthis.CHECKOUT_URL = CHECKOUT_URL;\n\n\t\tthis.CODE_INPUT_SELECTOR = '#promoCodeEntry';\n\t\tthis.APPLY_CODE_BTN_SELECTOR = '#promoApply';\n\t\tthis.REMOVE_CODE_BUTTON_SELECTOR = '.jsRemovePromo';\n\t\tthis.PRODUCT_ITEM_SELECTOR = '#jsWideBag .widebag-item, .minibag-item';\n\t\tthis.EXISTING_CODES_SELECTOR = '.widebag-item-promotion-codes li, .minibag-item-applied-promotion-codes';\n\t\tthis.MODAL_WINDOW_SELECTOR = '#jsEditPromoCode';\n\t\tthis.MODAL_CLOSE_BUTTON_SELECTOR = '.modal-close';\n\t\tthis.SUBMIT_FORM_SELECTOR = '#submit_order_service';\n\t\tthis.CREDIT_CARD_DATA_SELECTOR = '#paySelectCC';\n\t\tthis.EDIT_BUTTON_SELECTOR = '.promotion-summary a';\n\t\tthis.CODE_REGEX = /(\\w+)$/;\n\t\tthis.EMPTY_CART_SELECTOR = '.widebag-empty-message';\n\t\tthis.REVIEW_TAB_SELECTOR = '.jsLoadReview.tab-on';\n\t\tthis.PAYMENT_TAB_SELECTOR = '.promotion-summary';\n\t\tthis.SPINNER_ELEMENT_SELECTOR = '.blockUI';\n\t\tthis.SHIPPING_MODAL_CHECKOUT = '.update-billing-address-layer';\n\t\tthis.TAX_ELEMENT_SELECTOR = '#jsVal-tax';\n\t\tthis.SHIPPING_ELEMENT_SELECTOR = '#jsVal-shippingCost';\n\t\tthis.SHIPPING_OPTION_SELECTOR = '#jsSelectShippingMethod option, .select-shipping-method input';\n\t\tthis.SHIPPING_METHOD_SELECTOR = '#checkout-shipping-heading';\n\t\tthis.MERCHANT_CODES_ELEMENT_SELECTOR = '.mini-promo, #ui-globalpromo-state';\n\t\tthis.MERCHANT_CODE_REGEX = /use code.(\\w+)/i;\n\n\t\tthis.CREDIT_CARD_DATA_ARRAY = [\n\t\t\t{\n\t\t\t\tname: 'CREDIT_CARD<>cardBrand_cd',\n\t\t\t\tselector: '#payCC',\n\t\t\t\tvalue: 'MC',\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'CREDIT_CARD<>cardNum',\n\t\t\t\tselector: '#payCCNum',\n\t\t\t\tvalue: '5168333333333333',\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'CREDIT_CARD<>cardholderName',\n\t\t\t\tselector: '#payCCName',\n\t\t\t\tvalue: 'universal',\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'CREDIT_CARD<>cardMonth_cd',\n\t\t\t\tselector: '#ccMonth',\n\t\t\t\tvalue: '9',\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'CREDIT_CARD<>cardYear_cd',\n\t\t\t\tselector: '#ccYear',\n\t\t\t\tvalue: '2021',\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'card_cvNumber',\n\t\t\t\tselector: '#payCCV',\n\t\t\t\tvalue: '740',\n\t\t\t},\n\t\t];\n\t}\n\n\tcheckCondition() {\n\t\tconst { href } = window.location;\n\t\tconst country = getCookie('E4X_COUNTRY');\n\t\tconst isRightCountry = country ? country === 'US' : false;\n\t\tconst codeInput = extractElement(this.CODE_INPUT_SELECTOR);\n\t\tconst isCartEmpty = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst paymentTab =\n\t\t\tdocument.querySelector(this.PAYMENT_TAB_SELECTOR) && !document.querySelector(this.SHIPPING_MODAL_CHECKOUT);\n\t\tconst isReview = document.querySelector(this.REVIEW_TAB_SELECTOR);\n\t\tconst isSpinner = document.querySelector(this.SPINNER_ELEMENT_SELECTOR);\n\t\treturn IS_ON_CHECKOUT_PAGE\n\t\t\t? href.startsWith(this.CHECKOUT_URL) &&\n\t\t\t\t\t(paymentTab || (codeInput && (paymentTab || isReview))) &&\n\t\t\t\t\t!isSpinner &&\n\t\t\t\t\tisRightCountry\n\t\t\t: href.startsWith(this.CART_URL) && codeInput && !isCartEmpty && isRightCountry;\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.updateCartBody.set('bmForm', this.CART_PARAM_VALUE);\n\t\tif (document.querySelector(this.CHECKOUT_PAYMENT_FORM_SELECTOR)) {\n\t\t\tthis.requestBodyData = extractFormValues(this.CHECKOUT_PAYMENT_FORM_SELECTOR).params;\n\t\t}\n\t\tthis.CREDIT_CARD_DATA_EXISTS = !!document.querySelector(this.CREDIT_CARD_DATA_SELECTOR);\n\t\tif (IS_ON_CHECKOUT_PAGE) {\n\t\t\tthis.CREDIT_CARD_DATA_ARRAY.map(item => this.requestBodyData.set(item.name, item.value));\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn fetch(`${BASE_URL}/Entry.jsp`, {\n\t\t\tmethod: 'GET',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(responseHTML => {\n\t\t\t\treturn [\n\t\t\t\t\t...new Set(\n\t\t\t\t\t\t[...extractElement(this.MERCHANT_CODES_ELEMENT_SELECTOR, responseHTML, true)]\n\t\t\t\t\t\t\t.map(item => item.textContent.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t\t.map(item => item[1]),\n\t\t\t\t\t),\n\t\t\t\t];\n\t\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.EXISTING_CODES_SELECTOR)].map(el =>\n\t\t\t\tIS_ON_CHECKOUT_PAGE ? el.textContent.match(this.CODE_REGEX)[0] : el.textContent,\n\t\t\t),\n\t\t);\n\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tapplyCodes(codes) {\n\t\treturn this._applyCode(codes);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(cartResponse => {\n\t\t\tconst total = this.parseTotal(cartResponse);\n\t\t\tconst cartSummary = cartResponse.orderSummary ? cartResponse.orderSummary : cartResponse.cartSummary;\n\t\t\tconst shipping = toFloat(cartSummary.shippingCost.replace('&#36;', '')) || 0;\n\t\t\tconst tax = toFloat(cartSummary.tax.replace('&#36;', ''));\n\t\t\treturn total - shipping - tax;\n\t\t});\n\t}\n\n\t_applyCode(code) {\n\t\tthis.requestBodyData.set('bmForm', !IS_ON_CHECKOUT_PAGE ? 'applyPromoSaksBag' : 'add_promo_code_service');\n\t\treturn this._manageCode(code);\n\t}\n\n\t_removeCode(code) {\n\t\tthis.requestBodyData.set(\n\t\t\t'bmForm',\n\t\t\t!IS_ON_CHECKOUT_PAGE ? 'remove_promo_code_saks_bag_service' : 'remove_promo_code_service',\n\t\t);\n\t\treturn this._manageCode(code);\n\t}\n\n\tparseTotal(data) {\n\t\tif (data) {\n\t\t\tlet totalPrice = toFloat(\n\t\t\t\tdata[IS_ON_CHECKOUT_PAGE ? 'orderSummary' : 'cartSummary'].grandTotal.replace('&#36;', ''),\n\t\t\t);\n\t\t\tconst taxPrice = toFloat(\n\t\t\t\tdata[IS_ON_CHECKOUT_PAGE ? 'orderSummary' : 'cartSummary'].tax.replace('&#36;', ''),\n\t\t\t);\n\t\t\tconst taxOnPage = toFloat(extractData(this.TAX_ELEMENT_SELECTOR, null));\n\t\t\tconst isShippingFree = extractData(this.SHIPPING_ELEMENT_SELECTOR, null).match(/Free/i);\n\t\t\tif (!IS_ON_CHECKOUT_PAGE && isShippingFree && !(taxOnPage > 0)) {\n\t\t\t\ttotalPrice -= taxPrice;\n\t\t\t}\n\t\t\treturn totalPrice;\n\t\t}\n\t\treturn elemToFloat(document.querySelector(this.TOTAL_SELECTOR));\n\t}\n};\n\nexport default {\n\tname: 'Lord & Taylor',\n\tdomain: 'lordandtaylor.com',\n\tmaxCoupons: 4, // due to blocks\n\tisSinglePageApp: true,\n\tDriver,\n};\n","import Promise from 'bluebird';\nimport Saks from './_base';\nimport bus from '../../bus';\nimport { format, DOM, browserUtils, log } from '../../../utils';\n\nconst { elemToFloat, toFloat } = format;\nconst { extractElement } = DOM;\nconst { getCookie, setCookie } = browserUtils;\n\n/** Driver behavior description:\n+ Existing code: yes\n+ Remove code: yes\n+ Stackable: yes\n+ Free gift support: yes\n+ Free shipping: no\n+ ‘isValid’ implemented: yes\n+ Codes can be replaced by another code: yes (valid ones only)\n+ Manually apply code: no\n+ Pages, where extension works: Cart, Checkout (except shipping address) - TEMPORARILY don't support Сheckout due to blocking\n+ Is driver SPA: yes\n+ MaxCoupons: 3, // due to blocking\n+ Gather codes on site pages: yes, from current page\n+ Special case about the driver works:\n+ We can run code testing once on the Cart for 60 minutes (site block us), then fake code testing during 1 hour\n\tTEMPORARILY don't support checkout due to blocking\n*/\n\nconst BASE_URL = 'https://www.saksfifthavenue.com';\nconst CART_URL = `${BASE_URL}/checkout/SaksBag.jsp`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout/checkout.jsp`;\n\nconst Driver = class Driver extends Saks {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.CART_URL = `${BASE_URL}/checkout/SaksBag.jsp`;\n\t\tthis.IS_CART_PAGE = window.location.href.startsWith(this.CART_URL);\n\t\tthis.CHECKOUT_URL = CHECKOUT_URL;\n\t\tthis.isStackable = true;\n\t\tthis.TOTAL_SELECTOR = '#jsVal-grandTotal, .hbc-price-display__subtotal .hbc-price-display__summary-price';\n\t\tthis.PRODUCT_ITEM_SELECTOR =\n\t\t\t'.widebag-item:not([id^=saveFor]), .minibag-item, .shopping-bag-item--purchase, .hbc-cart-item';\n\t\tthis.APPLIED_CODE_SELECTOR =\n\t\t\t'.jsRemovePromo .action-link-text, .widebag-item-promotion-codes li, .shopping-bag-item__promo-code, .hbc-cart-item__promo-code';\n\t\tthis.CODE_INPUT_SELECTOR = '#promoCodeEntry, [name=\"promoCode\"]';\n\t\tthis.EMPTY_CART_SELECTOR = '.shopping-bag__no-items-msg';\n\t\tthis.isAccessDenied = false;\n\t\tthis.GIFT_MODAL_SELECTOR = '.gift-option-dialog-modal';\n\t\tthis.MERCHANT_CODE_SELECTOR = '.hbc-promo-detail :not(a)';\n\t\tthis.MERCHANT_CODE_REGEX = /use code: (\\w+)/i;\n\t\tthis.SHIPPING_METHOD_SELECTOR = '.shipping-method';\n\t\tthis.headers = {\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8',\n\t\t\t'sec-fetch-mode': 'cors',\n\t\t\t'sec-fetch-site': 'same-origin',\n\t\t};\n\t}\n\n\tasync checkCondition() {\n\t\tconst isAccessDenied = getCookie('isAccessDenied') === 'true';\n\t\tconst isCodeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isCart = window.location.href.startsWith(CART_URL);\n\t\tconst cartEmptyEl = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isCartEmpty = cartEmptyEl && cartEmptyEl.offsetParent;\n\t\tconst isGiftModal = document.querySelector(this.GIFT_MODAL_SELECTOR);\n\t\tconst isOnUSLocation = getCookie('E4X_COUNTRY') === 'US';\n\t\tconst totalEelement = extractElement(this.TOTAL_SELECTOR);\n\t\tconst isTotal = totalEelement && elemToFloat(totalEelement) > 0;\n\n\t\treturn !isGiftModal && !isAccessDenied && isCodeInput && isCart && !isCartEmpty && isOnUSLocation && isTotal;\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn [\n\t\t\t...new Set(\n\t\t\t\t[...document.querySelectorAll(this.MERCHANT_CODE_SELECTOR)]\n\t\t\t\t\t.map(el => el.innerText.match(this.MERCHANT_CODE_REGEX))\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.map(el => el[1]),\n\t\t\t),\n\t\t];\n\t}\n\n\tremoveCodes(codes) {\n\t\tif (getCookie('appliedOnCart')) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\treturn Promise.each(codes, code => this._removeCode(code))\n\t\t\t.then(() => this._getUpdatedCart())\n\t\t\t.then(responseJSON => ({\n\t\t\t\toriginalPrice: this.parseTotal(responseJSON),\n\t\t\t\toriginalItemsCount: this.parseItemsCount(responseJSON),\n\t\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this.parseTotal(), originalItemsCount = this.parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tfreeGifts: 0,\n\t\t\t\tisValid: true,\n\t\t\t};\n\t\t\tif (getCookie('appliedOnCart')) {\n\t\t\t\tlog(`Codes testing forbidden!`);\n\t\t\t\tresult.isValid = false;\n\t\t\t\treturn Promise.delay(1500).then(() => bus.$emit('code-checked', result));\n\t\t\t}\n\t\t\treturn this._applyCode(code).then(response => {\n\t\t\t\tlet cartResponse = response;\n\t\t\t\tif (cartResponse.errors) {\n\t\t\t\t\tresult.isValid = false;\n\t\t\t\t\treturn bus.$emit('code-checked', result);\n\t\t\t\t}\n\t\t\t\tif (typeof cartResponse !== 'object') {\n\t\t\t\t\tcartResponse = this._getUpdatedCart();\n\t\t\t\t}\n\t\t\t\tresult.finalPrice = this.parseTotal(cartResponse);\n\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\tresult.freeGifts = this.parseItemsCount(cartResponse) - originalItemsCount;\n\t\t\t\tif (\n\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t) {\n\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t}\n\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t});\n\t\t}).then(() => {\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t\toriginalItemsCount,\n\t\t\t});\n\t\t});\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice } = validationInfo;\n\t\tconst { originalItemsCount } = validationInfo;\n\n\t\t// Sort by discount and free gifts count\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(workingDiscounts, discount => {\n\t\t\t// delays is needed due to blocking\n\t\t\treturn Promise.delay(1600).then(() => {\n\t\t\t\treturn this._applyCode(discount.code).then(() => {\n\t\t\t\t\treturn Promise.delay(1600).then(() => {\n\t\t\t\t\t\treturn this._getUpdatedCart().then(cartResponse => {\n\t\t\t\t\t\t\tif (typeof cartResponse !== 'object' && cartResponse.errors) {\n\t\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst finalPrice = this.parseTotal(cartResponse);\n\t\t\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\t\t\tconst freeGifts = this.parseItemsCount(cartResponse) - originalItemsCount;\n\n\t\t\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\t\t\tfreeGifts,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn this._removeCode(discount.code);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t}),\n\t\t);\n\t}\n\n\tapplyCodes(codes) {\n\t\tif (codes && codes.length) {\n\t\t\treturn setCookie('appliedOnCart', true, 60);\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t_manageCode(code) {\n\t\treturn this._mouseEvent('mousedown')\n\t\t\t.then(() => {\n\t\t\t\tthis.requestBodyData.set(this.CODE_PARAM_NAME, code);\n\t\t\t\treturn fetch(`${this.BASE_URL}/checkout/checkout.jsp`, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcredentials: 'include',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8',\n\t\t\t\t\t},\n\t\t\t\t\tbody: this.requestBodyData,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\treturn this._mouseEvent('mouseup').then(() => {\n\t\t\t\t\treturn response.text();\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\t// If we are blocked or session expired we could receive text\n\t\t\t\t// To prevent driver from falling we handle this case\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (err) {\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn this._getUpdatedCart().then(cartResponse => {\n\t\t\tconst total = this.parseTotal(cartResponse);\n\t\t\tconst cartSummary = cartResponse.orderSummary ? cartResponse.orderSummary : cartResponse.cartSummary;\n\t\t\tconst shipping = toFloat(cartSummary.shippingCost.replace('&#36;', '')) || 0;\n\t\t\tconst tax = toFloat(cartSummary.tax.replace('&#36;', ''));\n\t\t\treturn total - shipping - tax;\n\t\t});\n\t}\n\n\t_mouseEvent(event) {\n\t\tconst codeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tcodeInput.dispatchEvent(new Event(event, { bubbles: true }));\n\t\t// need to add this delay for correct site working\n\t\treturn Promise.delay(1500).then(() => {\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n};\n\nexport default {\n\tname: 'Saks Fifth Avenue',\n\tdomain: 'saksfifthavenue.com',\n\tDriver,\n\tstackable: true,\n\tisSinglePageApp: true,\n\tmaxCoupons: 3, // due to blocking\n};\n","import Promise from 'bluebird';\nimport bus from '../../bus';\nimport Saks from './_base';\nimport { format, log } from '../../../utils';\nimport { extractElement } from '../../../utils/DOM';\nimport { sessionTimer } from '../../lib';\n\nconst { toFloat } = format;\n\n/* Driver behavior description:\n- Existing code: yes\n- Stackable: yes\n- Free gift support: yes\n- Free shipping: no\n- ‘isValid’ implemented: yes\n- Remove code: yes\n- Codes can be replaced by another code: yes (valid ones only)\n- GetMerchantCodes: yes\n- Supported pages: Cart, Checkout.\n- Is SPA: yes\n*/\n\nconst BASE_URL = 'https://www.saksoff5th.com';\nconst CART_URL = `${BASE_URL}/checkout/SaksBag.jsp`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout/checkout.jsp`;\nconst isOnCartPage = window.location.href.includes('SaksBag.jsp');\n\nconst Driver = class Driver extends Saks {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.TOTAL_SELECTOR = '#jsVal-grandTotal, .hbc-price-display__subtotal .hbc-price-display__summary-price';\n\t\tthis.PRODUCT_ITEM_SELECTOR =\n\t\t\t'.widebag-item:not([id^=saveFor]), .minibag-item, .shopping-bag-item--purchase, .hbc-cart-item';\n\t\tthis.bodyData = null;\n\t\tthis.CODE_PARAM_NAME = 'promoCode';\n\t\tthis.ADD_CODE_PARAM_VALUE = 'applyPromoSaksBag';\n\t\tthis.REMOVE_CODE_PARAM_VALUE = isOnCartPage\n\t\t\t? 'remove_promo_code_saks_bag_service'\n\t\t\t: 'remove_promo_code_service';\n\t\tthis.CART_PARAM_VALUE = isOnCartPage ? 'initialize_saks_bag_service' : 'continue_to_checkout_service';\n\t\tthis.APPLIED_CODE_SELECTOR =\n\t\t\t'.jsRemovePromo .action-link-text, .widebag-item-promotion-codes li, .shopping-bag-item__promo-code, .hbc-cart-item__promo-code';\n\t\tthis.CART_PARAM_VALUE = isOnCartPage ? 'initialize_saks_bag_service' : 'continue_to_checkout_service';\n\t\tthis.updateCartBody = new URLSearchParams();\n\t\tthis.MAX_STACKED_COUPONS = 5;\n\t\tthis.CODE_INPUT_SELECTOR = '#promoCodeEntry, [name=\"promoCode\"]';\n\t\tthis.EMPTY_CART_SELECTOR = '.shopping-bag__no-items-msg';\n\t\tthis.GIFT_MODAL_SELECTOR = '.gift-option-dialog-modal';\n\t\tthis.SHIPPING_SECTION_SELECTOR = '.hbc-checkout__address-form-wrapper';\n\t\tthis.MERCHANT_CODES_ELEMENT_SELECTOR = '#ui-globalpromo .hbc-promo-detail';\n\t\tthis.MERCHANT_CODE_ELEMENT_REGEX = /code(\\w+)|code (\\w+)/i;\n\t\tthis.MERCHANT_CODE_REGEX = /code\\s?(\\w+)/i;\n\t\tthis.REPLACE_REGEX = /[A-z,;\\s]|[&#]\\d*/g;\n\n\t\tsessionTimer.initialize({\n\t\t\tactionInterval: null,\n\t\t\ttimeout: 45,\n\t\t});\n\t}\n\n\tcheckCondition() {\n\t\tconst isCodeInput = document.querySelector(this.CODE_INPUT_SELECTOR);\n\t\tconst isCart = window.location.href.startsWith(CART_URL);\n\t\tconst cartEmptyEl = document.querySelector(this.EMPTY_CART_SELECTOR);\n\t\tconst isGiftModal = document.querySelector(this.GIFT_MODAL_SELECTOR);\n\t\tconst isCartEmpty = cartEmptyEl && cartEmptyEl.offsetParent;\n\t\tconst isCheckout = window.location.href.startsWith(CHECKOUT_URL);\n\t\tconst isShippingStep = document.querySelector(this.SHIPPING_SECTION_SELECTOR);\n\n\t\treturn !isGiftModal && isCodeInput && ((isCheckout && !isShippingStep) || (isCart && !isCartEmpty));\n\t}\n\n\tbeforeTestCodes() {\n\t\tthis.updateCartBody.set('bmForm', this.CART_PARAM_VALUE);\n\t\tthis.bodyData = {\n\t\t\taction: CHECKOUT_URL,\n\t\t\tparams: new URLSearchParams({\n\t\t\t\tbmForm: '',\n\t\t\t\tpromoCode: '',\n\t\t\t}),\n\t\t};\n\t\treturn Promise.resolve();\n\t}\n\n\tgetMerchantCodes() {\n\t\treturn fetch(`${BASE_URL}/Entry.jsp`, {\n\t\t\tmethod: 'GET',\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(responseHTML => {\n\t\t\t\treturn [\n\t\t\t\t\t...new Set(\n\t\t\t\t\t\t[...extractElement(this.MERCHANT_CODES_ELEMENT_SELECTOR, responseHTML, true)]\n\t\t\t\t\t\t\t.map(item => item.textContent)\n\t\t\t\t\t\t\t.filter(item => this.MERCHANT_CODE_ELEMENT_REGEX.test(item)),\n\t\t\t\t\t),\n\t\t\t\t].map(item => item.match(this.MERCHANT_CODE_REGEX)[1]);\n\t\t\t});\n\t}\n\n\tgetExistingCodes() {\n\t\tconst codes = new Set(\n\t\t\t[...document.querySelectorAll(this.APPLIED_CODE_SELECTOR)].filter(Boolean).map(el => el.textContent),\n\t\t);\n\n\t\treturn {\n\t\t\tcodes: [...codes],\n\t\t\tcodeCount: codes.size,\n\t\t};\n\t}\n\n\tremoveCodes(codes) {\n\t\tlet lastResponse = null;\n\t\treturn Promise.each(codes, code =>\n\t\t\tthis._removeCode(code).then(responseJSON => {\n\t\t\t\tlastResponse = responseJSON;\n\t\t\t}),\n\t\t).then(() => ({\n\t\t\toriginalPrice: this._parseTotal(lastResponse),\n\t\t\toriginalItemsCount: this._parseItemsCount(lastResponse),\n\t\t}));\n\t}\n\n\tcheckCodes(codes, originalPrice = this._parseTotal(), originalItemsCount = this._parseItemsCount()) {\n\t\tlog('originalPrice: %s', originalPrice);\n\t\tlog('originalItemsCount: %s', originalItemsCount);\n\n\t\tconst workingDiscounts = [];\n\t\treturn Promise.each(codes, code => {\n\t\t\tconst result = {\n\t\t\t\tcode,\n\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\tfinalDiscount: 0,\n\t\t\t\tfreeGifts: 0,\n\t\t\t\tisValid: false,\n\t\t\t};\n\t\t\treturn this._applyCode(code).then(responseJSON => {\n\t\t\t\tif (typeof responseJSON === 'object' && !responseJSON.errors) {\n\t\t\t\t\tif (isOnCartPage) {\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseJSON);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tresult.freeGifts = this._parseItemsCount(responseJSON) - originalItemsCount;\n\t\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t}\n\t\t\t\t\treturn this._getUpdatedCart().then(responseCart => {\n\t\t\t\t\t\tresult.finalPrice = this._parseTotal(responseCart);\n\t\t\t\t\t\tresult.finalDiscount = originalPrice - result.finalPrice;\n\t\t\t\t\t\tresult.freeGifts = this._parseItemsCount(responseCart) - originalItemsCount;\n\t\t\t\t\t\tresult.isValid = true;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tresult.finalPrice < originalPrice ||\n\t\t\t\t\t\t\t// Free gifts code is acceptable if it won't increase total\n\t\t\t\t\t\t\t(result.finalPrice === originalPrice && result.freeGifts > 0)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tworkingDiscounts.push(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn this._removeCode(code).then(() => bus.$emit('code-checked', result));\n\t\t\t});\n\t\t}).then(() =>\n\t\t\tbus.$emit('stack-codes', {\n\t\t\t\tcodes: workingDiscounts.map(discount => discount.code),\n\t\t\t\tdiscounts: workingDiscounts,\n\t\t\t\toriginalPrice,\n\t\t\t\toriginalItemsCount,\n\t\t\t}),\n\t\t);\n\t}\n\n\tstackCodes(validationInfo) {\n\t\tconst workingDiscounts = validationInfo.discounts;\n\t\tconst { originalPrice } = validationInfo;\n\t\tconst { originalItemsCount } = validationInfo;\n\n\t\t// Sort by discount and free gifts count\n\t\tworkingDiscounts.sort((a, b) => {\n\t\t\tif (b.finalDiscount - a.finalDiscount === 0) {\n\t\t\t\treturn b.freeGifts - a.freeGifts;\n\t\t\t}\n\t\t\treturn b.finalDiscount - a.finalDiscount;\n\t\t});\n\n\t\tlet currentPrice = originalPrice;\n\t\tlet currentDiscount = 0;\n\t\tlet currentFreeGifts = 0;\n\t\tconst successfulCodes = [];\n\n\t\treturn Promise.each(workingDiscounts, discount =>\n\t\t\tthis._applyCode(discount.code).then(responseJSON => {\n\t\t\t\tif (successfulCodes.length >= this.MAX_STACKED_COUPONS) {\n\t\t\t\t\treturn this._removeCode(discount.code).then(() =>\n\t\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\t\t\tisValid: false,\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (typeof responseJSON !== 'object' || responseJSON.errors) {\n\t\t\t\t\treturn this._removeCode(discount.code).then(() =>\n\t\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\t\tfinalPrice: originalPrice,\n\t\t\t\t\t\t\tfinalDiscount: 0,\n\t\t\t\t\t\t\tfreeGifts: 0,\n\t\t\t\t\t\t\tisValid: false,\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (isOnCartPage) {\n\t\t\t\t\tconst finalPrice = this._parseTotal(responseJSON);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst freeGifts = this._parseItemsCount(responseJSON) - originalItemsCount;\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\tfreeGifts,\n\t\t\t\t\t});\n\t\t\t\t\tif (\n\t\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t\t) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this._removeCode(discount.code);\n\t\t\t\t}\n\t\t\t\treturn this._getUpdatedCart().then(responseCart => {\n\t\t\t\t\tconst finalPrice = this._parseTotal(responseCart);\n\t\t\t\t\tconst finalDiscount = originalPrice - finalPrice;\n\t\t\t\t\tconst freeGifts = this._parseItemsCount(responseCart) - originalItemsCount;\n\t\t\t\t\tbus.$emit('code-stacked', {\n\t\t\t\t\t\tcode: discount.code,\n\t\t\t\t\t\tfinalPrice,\n\t\t\t\t\t\tfinalDiscount,\n\t\t\t\t\t\tfreeGifts,\n\t\t\t\t\t});\n\t\t\t\t\tif (\n\t\t\t\t\t\tfinalPrice < currentPrice ||\n\t\t\t\t\t\t// Check that we don't increase total with free gifts code\n\t\t\t\t\t\t(finalPrice === currentPrice && freeGifts > currentFreeGifts)\n\t\t\t\t\t) {\n\t\t\t\t\t\tsuccessfulCodes.push(discount.code);\n\t\t\t\t\t\tcurrentDiscount = finalDiscount;\n\t\t\t\t\t\tcurrentPrice = finalPrice;\n\t\t\t\t\t\tcurrentFreeGifts = freeGifts;\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn this._removeCode(discount.code);\n\t\t\t\t});\n\t\t\t}),\n\t\t).then(() =>\n\t\t\tbus.$emit('stackable-complete', {\n\t\t\t\tcodes: successfulCodes,\n\t\t\t\tfinalPrice: currentPrice,\n\t\t\t\tfinalDiscount: currentDiscount,\n\t\t\t\tfreeGifts: currentFreeGifts,\n\t\t\t}),\n\t\t);\n\t}\n\n\tgetPreTaxShippingTotal() {\n\t\treturn Promise.delay(3000).then(() =>\n\t\t\tthis._getUpdatedCart().then(responseJSON => {\n\t\t\t\tconst { shippingCost, tax } = responseJSON.orderSummary\n\t\t\t\t\t? responseJSON.orderSummary\n\t\t\t\t\t: responseJSON.cartSummary;\n\t\t\t\tconst total = this._parseTotal(responseJSON);\n\t\t\t\tconst shippingAmount =\n\t\t\t\t\tshippingCost.toLowerCase() === 'free' || shippingCost.toLowerCase() === 'tbd'\n\t\t\t\t\t\t? 0\n\t\t\t\t\t\t: toFloat(shippingCost.replace(this.REPLACE_REGEX, ''));\n\t\t\t\tconst taxAmount = toFloat(tax.toLowerCase() === 'tbd' ? 0 : tax.replace(this.REPLACE_REGEX, ''));\n\t\t\t\treturn total - shippingAmount - taxAmount;\n\t\t\t}),\n\t\t);\n\t}\n\n\t_applyCode(code) {\n\t\tthis.bodyData.params.set('bmForm', this.ADD_CODE_PARAM_VALUE);\n\t\treturn this._manageCode(code);\n\t}\n\n\t_removeCode(code) {\n\t\tthis.bodyData.params.set('bmForm', this.REMOVE_CODE_PARAM_VALUE);\n\t\treturn this._manageCode(code);\n\t}\n\n\t_manageCode(code) {\n\t\tthis.bodyData.params.set(this.CODE_PARAM_NAME, code);\n\t\treturn fetch(this.bodyData.action, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8',\n\t\t\t},\n\t\t\tbody: this.bodyData.params,\n\t\t})\n\t\t\t.then(response => response.text())\n\t\t\t.then(response => {\n\t\t\t\t// If we are blocked or session expired we could receive text\n\t\t\t\t// To prevent driver from falling we handle this case\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(response);\n\t\t\t\t} catch (err) {\n\t\t\t\t\treturn response;\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t_getUpdatedCart() {\n\t\treturn fetch(CHECKOUT_URL, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'include',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8',\n\t\t\t\t'x-requested-with': 'XMLHttpRequest',\n\t\t\t},\n\t\t\tbody: this.updateCartBody,\n\t\t}).then(response => response.json());\n\t}\n\n\t_parseTotal(data = false) {\n\t\tlet total = null;\n\t\tif (data) {\n\t\t\t// Replace dollar sign\n\t\t\tconst summary = data.orderSummary ? data.orderSummary : data.cartSummary;\n\t\t\ttotal = toFloat(summary.grandTotal.replace(this.REPLACE_REGEX, '').trim());\n\t\t} else {\n\t\t\ttotal = toFloat(\n\t\t\t\tdocument\n\t\t\t\t\t.querySelector(this.TOTAL_SELECTOR)\n\t\t\t\t\t.textContent.replace(this.REPLACE_REGEX, '')\n\t\t\t\t\t.trim(),\n\t\t\t);\n\t\t}\n\t\treturn total;\n\t}\n\n\t_parseItemsCount(data) {\n\t\tif (data) {\n\t\t\treturn data.cartItems ? data.cartItems.length : data.orderItems.length;\n\t\t}\n\t\treturn [...document.querySelectorAll(this.PRODUCT_ITEM_SELECTOR)].length;\n\t}\n};\n\nexport default {\n\tname: 'Saks Fifth Avenue Off Fifth',\n\tdomain: 'saksoff5th.com',\n\tDriver,\n\tstackable: true,\n\tisSinglePageApp: true,\n};\n","import Saks from './_base';\n\nconst BASE_URL = 'https://www.thebay.com';\nconst CART_URL = `${BASE_URL}/checkout/SaksBag.jsp`;\nconst CHECKOUT_URL = `${BASE_URL}/checkout/checkout.jsp`;\n\n/**\nDriver behavior description:\n• Existing code: yes \n• Remove code: yes \n• Stackable: yes \n• Free gift support: yes\n• ‘isValid’ implemented: yes \n+ Pages, where extension works:\n   - cart\n   - review\nOptional:\n• Is driver SPA and add the condition to show popup: yes\n• Gather codes on site pages: no\nCodes testing may show negative discount in console after user log in\nalso after returnig from the reveiw page on the checkout \nit's merchant specific behavior after login\n */\n\nconst Driver = class Driver extends Saks {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.BASE_URL = BASE_URL;\n\t\tthis.isStackable = true;\n\t\tthis.CART_URL = CART_URL;\n\t\tthis.CHECKOUT_URL = CHECKOUT_URL;\n\t\tconst isOnCartPage = window.location.href.includes('SaksBag.jsp');\n\t\tthis.ADD_CODE_PARAM_VALUE = isOnCartPage ? 'applyPromoSaksBag' : 'add_promo_code_service';\n\t}\n\n\tapplyCodes() {\n\t\treturn Promise.resolve();\n\t}\n};\n\nexport default {\n\tname: \"Hudson's Bay\",\n\tdomain: 'thebay.com',\n\tDriver,\n\tisSinglePageApp: true,\n\tstackable: true,\n};\n"],"sourceRoot":""}