(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{200:function(e,t,r){"use strict";r.r(t);r(47),r(17),r(29),r(271),r(12),r(66),r(72),r(85),r(19);var o=r(27),s=r.n(o),a=r(111),i=r(677),n=r(0);const c=n.format.toFloat,u=n.browserUtils.getCookie;class l extends i.a{constructor(){super(),this.TOTAL_SELECTOR=".subTotalL.subTotalRight",this.APPLIED_PROMOTION_SELECTOR=".applied-promo-code-container .remove-button.invisible",this.APPLIED_PROMOCODE_SELECTOR=".applied-promo-code-container .remove-button:not(.invisible)",this.PROMO_CODE_INPUT_SELECTOR=".promotion-input",this.EMPTY_EL_SELECTOR=".emptyBagSubTotal",this.APPLIED_CODE_SELECTOR=".applied-promo",this.IS_CANADA=!1,this.STACKABLE=!0,this.IS_GET_PRE_TAX_SHIPPING_TOTAL_METHOD=!1}checkCondition(){const e=window.location.href.includes("/buy/shopping_bag.do"),t=document.querySelector(this.PROMO_CODE_INPUT_SELECTOR),r=document.querySelector(this.EMPTY_EL_SELECTOR);return e&&t&&!r}beforeTestCodes(){this.BASE_API_URL=`${window.location.origin}/buy/resources/shoppingBag/v1`,this.SHOPPER_ID=u("unknownShopperId").replace("|||",""),this.REQUEST_URL=`${this.BASE_API_URL}/${this.SHOPPER_ID}`}getExistingCodes(){let e=[];return{codes:e=document.querySelector(this.APPLIED_PROMOTION_SELECTOR)?[...document.querySelectorAll(this.APPLIED_PROMOCODE_SELECTOR)].map(e=>e.parentElement.parentElement).map(e=>e.querySelector(this.APPLIED_CODE_SELECTOR).innerText):[...document.querySelectorAll(this.APPLIED_CODE_SELECTOR)].map(e=>e.innerText.trim()),codeCount:e.length}}removeCodes(e){let t=null;return s.a.each(e,e=>this._removeCode(e).then(e=>{t=e})).then(()=>this._parseTotal(t))}checkCodes(e,t=this._parseTotal()){const r=[];return Object(n.log)("originalPrice: %s",t),s.a.each(e,e=>this._applyCode(e).then(o=>{const s={code:e,finalPrice:t,finalDiscount:0,isValid:!0};return"FAILURE"===o.status?(s.isValid=!1,a.a.$emit("code-checked",s)):(s.finalPrice=this._parseTotal(o),s.finalDiscount=t-s.finalPrice,this.STACKABLE&&s.finalPrice<t&&r.push(s),this._removeCode(e).then(()=>a.a.$emit("code-checked",s)))})).then(()=>(this.STACKABLE&&a.a.$emit("stack-codes",{codes:r.map(e=>e.code),discounts:r,originalPrice:t}),s.a.resolve()))}stackCodes(e){const t=e.discounts,r=e.originalPrice;t.sort((e,t)=>t.finalDiscount-e.finalDiscount);let o=r,i=0;const n=[];return s.a.each(t,e=>this._applyCode(e.code).then(t=>{const c=this._parseTotal(t),u=r-c;return a.a.$emit("code-stacked",{code:e.code,finalPrice:c,finalDiscount:u}),c<o?(n.push(e.code),i=u,o=c,s.a.resolve()):this._removeCode(e.code)})).then(()=>a.a.$emit("stackable-complete",{codes:n,finalPrice:o,finalDiscount:i}))}applyCodes(e){return this.STACKABLE?s.a.resolve():this._applyCode(e[0])}getPreTaxShippingTotal(){return this.IS_GET_PRE_TAX_SHIPPING_TOTAL_METHOD?this._getUpdatedCart().then(e=>this._parseTotal(e)):null}_getUpdatedCart(){return fetch(this.REQUEST_URL,{method:"GET",credentials:"include"}).then(e=>e.json())}_applyCode(e){return this._manageCode(e,!0)}_removeCode(e){return this._manageCode(e)}_manageCode(e,t){return this.bodyData=t?{op:"apply",path:"/shoppingBag/applyPromo",value:e}:{op:"remove",path:`/shoppingBag/removePromo/${e}`},fetch(this.REQUEST_URL,{method:"POST",credentials:"include",headers:{"bag-operation":"promo","content-type":"application/json-patch+json","x-http-method-override":"PATCH"},body:JSON.stringify(this.bodyData)}).then(e=>e.json())}_parseTotal(e){let t=null;return e?(t=e.shoppingBag.charges.subTotal,c(this.IS_CANADA?t.replace("CA",""):t)):(t=document.querySelector(this.TOTAL_SELECTOR).innerText,c(this.IS_CANADA?t.replace("CA",""):t))}}var p={name:"Athleta",domain:"athleta.com",Driver:class extends l{constructor(){super(),this.IS_GET_PRE_TAX_SHIPPING_TOTAL_METHOD=!0}},stackable:!0,isSinglePageApp:!0};var d={name:"Banana Republic Canada",domain:"bananarepublic.ca",Driver:class extends l{constructor(){super(),this.IS_CANADA=!0}},stackable:!0,isSinglePageApp:!0};var h={name:"Banana Republic",domain:"bananarepublic.com",Driver:class extends l{constructor(){super(),this.IS_GET_PRE_TAX_SHIPPING_TOTAL_METHOD=!0}},stackable:!0,isSinglePageApp:!0};var _={name:"Banana Republic Factory",domain:"bananarepublicfactory.gapfactory.com",Driver:class extends l{constructor(){super(),this.IS_GET_PRE_TAX_SHIPPING_TOTAL_METHOD=!0}},stackable:!0,isSinglePageApp:!0};var m={name:"Gap",domain:"gap.com",Driver:class extends l{constructor(){super(),this.IS_GET_PRE_TAX_SHIPPING_TOTAL_METHOD=!0}},stackable:!0,isSinglePageApp:!0};var E={name:"Gap Canada",domain:"gapcanada.ca",Driver:class extends l{constructor(){super(),this.IS_CANADA=!0}},stackable:!0,isSinglePageApp:!0},P=r(5);var T={name:"Gap Factory",domain:"gapfactory.com",Driver:class extends l{constructor(){super(),this.INPUT_EL_SELECTOR=".promotion-input",this.EMPTY_EL_SELECTOR=".emptyBagSubTotal",this.IS_GET_PRE_TAX_SHIPPING_TOTAL_METHOD=!0}watchForCartUrl(){const e=super.watchForCartUrl();P.e.initialize({actionInterval:e,timeout:15})}checkCondition(){const e=window.location.href.includes("/buy/shopping_bag.do");let t=document.querySelector(this.INPUT_EL_SELECTOR),r=document.querySelector(this.EMPTY_EL_SELECTOR);return t=t&&t.offsetParent,r=r&&r.offsetParent,e&&t&&!r}},stackable:!0,isSinglePageApp:!0};var C={name:"Old Navy Canada",domain:"oldnavy.ca",Driver:class extends l{constructor(){super(),this.IS_CANADA=!0,this.IS_GET_PRE_TAX_SHIPPING_TOTAL_METHOD=!0}},stackable:!0,isSinglePageApp:!0};var g={name:"Old Navy",domain:"oldnavy.com",Driver:class extends l{constructor(){super(),this.IS_GET_PRE_TAX_SHIPPING_TOTAL_METHOD=!0}},stackable:!0,isSinglePageApp:!0};t.default=[p,d,h,_,m,E,T,C,g]},677:function(e,t,r){"use strict";r.d(t,"a",function(){return u});r(12),r(112),r(10),r(20);var o=r(111),s=r(0),a=r(5);function i(e,t,r,o,s,a,i){try{var n=e[a](i),c=n.value}catch(e){return void r(e)}n.done?t(c):Promise.resolve(c).then(o,s)}function n(e){return function(){var t=this,r=arguments;return new Promise(function(o,s){var a=e.apply(t,r);function n(e){i(a,o,s,n,c,"next",e)}function c(e){i(a,o,s,n,c,"throw",e)}n(void 0)})}}const c=s.format.toFloat;class u{watchForRestoreUserData(e=500){var t=this;let r=!1;const s=setInterval(n(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=14;break}return e.prev=1,r=!0,e.next=5,t.checkRestoreDataCondition();case 5:i=e.sent,r=!1,i&&(clearInterval(s),o.a.$emit("restore-user-data")),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),Object(a.b)(e.t0,{source:"checkRestoreDataCondition"}),clearInterval(s);case 14:case"end":return e.stop()}},e,null,[[1,10]])})),e);return s}checkRestoreDataCondition(){return!1}storeUserData(e){var t=this;return n(regeneratorRuntime.mark(function r(){var o,i,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getUserData();case 2:if(null!==(o=r.sent)){r.next=5;break}return r.abrupt("return",Promise.resolve());case 5:return i=t.getUserDataStorageKey(e),n={userData:o,storedTime:Date.now()},a.a.setDriverStorage(i,n),Object(s.log)("Stored user data: %O",n),r.abrupt("return",Promise.resolve());case 10:case"end":return r.stop()}},r)}))()}restoreUserData(e,t=6e5){var r=this;return n(regeneratorRuntime.mark(function o(){var i,n,c,u;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i=r.getUserDataStorageKey(e),o.next=3,a.a.getDriverStorage(i);case 3:if(!(n=o.sent)){o.next=11;break}if(c=n.storedTime,u=n.userData,a.a.deleteDriverStorage(i),!(Date.now()-c<=t)){o.next=10;break}return Object(s.log)("Restore user data: %O",u),o.abrupt("return",r.setUserData(u));case 10:Object(s.log)("User data is outdated, skip restoring");case 11:return o.abrupt("return",Promise.resolve());case 12:case"end":return o.stop()}},o)}))()}getUserData(){return null}setUserData(){return Promise.resolve()}getUserDataStorageKey(e){return`${e}_userData`}getStartPrice(){let e=Number.MAX_SAFE_INTEGER;const t=this.TOTAL_ELEMENT_CONFIG;if(t){const r=t.selector,o=t.attribute,s=t.regex;let i;if(Array.isArray(r)?r.forEach(e=>{i||(i=document.querySelector(e))}):"string"==typeof r?i=document.querySelector(r):Object(a.b)(new Error(`Total selector type mismatch. Expected string | array, got ${typeof r}`)),i){let t=o?i.getAttribute(o):i.textContent;if(t&&s){const e=s.pattern,r=void 0===e?null:e,o=s.group,a=void 0===o?0:o;t=t.match(r)[a]}e=c(t)}}return e}beforeTestCodes(){return Promise.resolve()}beforeCheckCodes(){return Promise.resolve()}beforeApplyCodes(){return Promise.resolve()}checkCodes(){return Promise.resolve()}applyCodes(){return Promise.resolve()}stackCodes(){return Promise.resolve()}removeCodes(){return Promise.resolve()}getMerchantCodes(){return[]}getExistingCodes(){return{codes:[],codeCount:0}}getPreTaxShippingTotal(){return null}watchForCartUrl(e=500){var t=this;let r=null,s=!1;const i=setInterval(n(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=16;break}return n=null,e.prev=2,s=!0,e.next=6,t.checkCondition();case 6:n=e.sent,s=!1,e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),Object(a.b)(e.t0,{source:"checkCondition"}),clearInterval(i);case 14:n!==r&&o.a.$emit(n?"cart-active":"cart-inactive"),r=n;case 16:case"end":return e.stop()}},e,null,[[2,10]])})),e);return i}checkCondition(){return!1}completeExperience(){return Promise.resolve()}completeExperiencePromisified(...e){return this._promisify(this.completeExperience,e)}beforeTestCodesPromisified(...e){return this._promisify(this.beforeTestCodes,e)}getStartPricePromisified(){return this._promisify(this.getStartPrice)}getMerchantCodesPromisified(...e){return this._promisify(this.getMerchantCodes,e)}getExistingCodesPromisified(...e){return this._promisify(this.getExistingCodes,e)}removeCodesPromisified(...e){return this._promisify(this.removeCodes,e)}beforeApplyCodesPromisified(...e){return this._promisify(this.beforeApplyCodes,e)}applyCodesPromisified(...e){return this._promisify(this.applyCodes,e)}beforeCheckCodesPromisified(...e){return this._promisify(this.beforeCheckCodes,e)}checkCodesPromisified(...e){return this._promisify(this.checkCodes,e)}stackCodesPromisified(...e){return this._promisify(this.stackCodes,e)}_promisify(e,t){return Promise.resolve().then(()=>e.apply(this,t))}}}}]);