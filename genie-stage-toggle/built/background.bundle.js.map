{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/bg/ab-testing.js","webpack:///./src/bg/background.js","webpack:///./src/bg/cashback-api.js","webpack:///./src/bg/competitor-monitor.js","webpack:///./src/bg/content-api.js","webpack:///./src/bg/ga.js","webpack:///./src/bg/install-and-update.js","webpack:///./src/bg/installation-uuid.js","webpack:///./src/bg/login.js","webpack:///./src/bg/monitoring.js","webpack:///./src/bg/outclick.js","webpack:///./src/bg/overlord/browser-info.js","webpack:///./src/bg/overlord/client.js","webpack:///./src/bg/overlord/context-builder.js","webpack:///./src/bg/overlord/index.js","webpack:///./src/bg/overlord/overlord-state.js","webpack:///./src/bg/permissions.js","webpack:///./src/bg/pop-up-manager.js","webpack:///./src/bg/readiness-monitor.js","webpack:///./src/bg/request-monitor.js","webpack:///./src/bg/stand-down.js","webpack:///./src/bg/storage-access.js","webpack:///./src/bg/tab-manager.js","webpack:///./src/bg/top-drivers.js","webpack:///./src/config.js","webpack:///./src/consts/errors.js","webpack:///./src/consts/events.js","webpack:///./src/consts/index.js","webpack:///./src/consts/milliseconds.js","webpack:///./src/consts/pop-up-types.js","webpack:///./src/consts/storage-keys.js","webpack:///./src/inject/consts/cbo-prompt-names.js","webpack:///./src/inject/consts/cbo-states.js","webpack:///./src/utils/DOM.js","webpack:///./src/utils/async.js","webpack:///./src/utils/browser.js","webpack:///./src/utils/completion-actions.js","webpack:///./src/utils/driver.js","webpack:///./src/utils/format.js","webpack:///./src/utils/index.js","webpack:///./src/utils/jwt.js","webpack:///./src/utils/log.js","webpack:///./src/utils/merchant.js","webpack:///./src/utils/request-types.js","webpack:///./src/utils/request.js","webpack:///./src/utils/requestAdapters/embeddedAdapter.js","webpack:///./src/utils/requestAdapters/fetchAdapter.js","webpack:///./src/utils/requestAdapters/index.js","webpack:///./src/utils/requestAdapters/xhrAdapter.js","webpack:///./src/utils/require-props.js","webpack:///./src/utils/semver.js","webpack:///./src/utils/send-xhr.js","webpack:///./src/utils/web-request.js"],"names":["DATAFILE_CDN_URL","config","abTesting","cdnUrl","DATAFILE_TTL","TEST_CAMPAIGNS","activeCampaigns","AB_TESTING_FALLBACK","version","rollouts","anonymizeIP","projectId","variables","featureFlags","experiments","audiences","groups","attributes","botFiltering","accountId","events","revision","_updatedTime","_pending","_optimizelyClientPromiseResolver","_optimizelyClientPromiseRejecter","_resetClientPromise","_createClient","_optimizelyClientPromise","Promise","resolve","reject","_initFromRemote","log","fetch","then","response","json","datafile","Date","now","catch","e","message","genieReporter","captureException","extra","source","filePath","method","optimizely","createInstance","logger","_getClient","getVariations","installationUuid","client","window","testVariations","reduce","list","campaign","variation","getVariation","push","driversStorage","Map","addEventListener","Error","error","extensionId","browser","runtime","getURL","match","reason","isGenieError","currentTarget","origin","stack","fileName","isFetchError","errorMessage","coreAnalytics","overlord","init","uuid","randomBase32","handleInstallOrUpdate","sendGaBeacon","clientId","getInstallationUuid","gaBeacon","type","chrome","onUpdateAvailable","addListener","reload","requestUpdateCheck","setTimeout","sessionStarted","document","EVENTS","NETWORK","ONLINE","fireEvent","context","pageName","promptName","category","action","requestUserStatus","hasPermissions","checkRmnDomainPermissions","cookies","set","url","site","baseDomain","domain","name","value","flushEventQueue","readinessMonitor","monitorPermissionsChanges","monitorLoginChange","cashbackApi","listenForActivations","requestMonitor","setUpListeners","setUpOutclickListeners","setUpNewTabListeners","tabs","onRemoved","tabId","state","pruneViewInstanceUuids","browserUtils","isChrome","competitorMonitor","start","browserAction","setBadgeBackgroundColor","color","onClicked","query","active","currentWindow","sendMessage","id","reveal","extension","onMessage","msg","toggle","handleError","sendResponse","payload","options","console","ERRORS","ALGOLIA","UNPARSABLE_JSON","request","sender","isAsyncRequest","instruction","setIcon","path","tab","setBadgeText","text","eventType","eventPayload","sentryError","errorStack","sentryReporter","driversReporter","validationSupport","validationIntegrationReporter","isTopDriver","topDriversReporter","errorUrl","info","errorInfo","logOnBackground","getMerchantDomainFromHostname","hostname","all","getMerchant","getCachedUserStatus","shouldDisplayStandDown","shouldDisplayCboPrompt","shouldDisplayCartPrompt","hasRecentlyCheckedCodes","shouldDisplaySurvey","shouldDisplayCboInfoPrompt","getExtensionPermissions","merchant","userStatus","shouldStandDown","shouldShowCboPrompt","shouldShowCartPrompt","codesRecentlyChecked","shouldShowSurvey","shouldShowCboInfoPrompt","permissions","extensionVersion","getManifest","coupons","isLoggedIn","isVerified","blockedByNetwork","rmn","searchMerchants","searchString","merchantList","getTopMerchants","limit","getAdditionalSearchMerchants","page","cashbackOffer","activate","responseData","initiateOutclick","viewInstanceUuid","pageType","success","getActivatedCboUuids","cbos","getOutclickURL","standDown","markCodeCheckingComplete","timestamp","setLastCodeTestingStatus","status","markCartPromptDisplayed","markRxSaverPromptDisplayed","markCboPromptDisplayed","methodToCheck","promptType","displayCartPrompt","displayStandDown","markCboInfoPromptSeen","markSurveySeen","openNewTab","openerTabId","windowId","newTabId","get","delete","openPopUp","focusPopUp","setShowReviewSideCard","flag","closePopUp","captureMessage","removeUnusedStorageAreas","asyncForEachExecutedInParallel","asyncUtils","IGNORE_REQUEST_PARAM","defaultApiEndpoint","sendCboUpdateInstruction","offerUuid","cboStatus","broadcastCboActivationToAllTabs","map","apiEndpoint","undefined","fromGenie","endpoint","_getApiEndpoint","data","offer_uuid","externalExperiments","JSON","stringify","params","Object","keys","key","encodeURIComponent","join","cboState","CBO_STATES","OFFER_ERROR","credentials","recordCboActivationState","split","reporter","domainFromHostname","OFFER_NOT_ACTIVATED","activateCboRequestListener","details","parseQueryString","prototype","hasOwnProperty","call","statusCode","u","activatedCbo","webRequest","onCompleted","bind","urls","handlePotentialDeactivationNotice","activatedCBOs","activatedCBOUuids","hadActivatedCBO","forEach","activatedCBOUuid","liveCboUuidsPromise","getLiveCbos","cboUuidsByDomain","activatedCbosPromise","getActivatedCbos","results","liveCboUuids","activations","liveAndActivatedForDomain","liveUuid","getRebateActivationEndpointOverride","checkExtensionExistence","COMPETITOR_CHECK_INTERVAL_MILLISECONDS","analytics","getCompetitorCheck","checkTime","_getCompetitors","competitor","_checkExistence","exists","currentViewInstanceUuid","event","eventAction","eventName","eventTarget","markCompetitorCheck","competitors","webAccessibleResourcePath","CONTENT_CACHE_LIFETIME_MS","TWELVE_HOURS_MS","MAX_MERCHANT_COUNT","MAX_MERCHANT_SEARCH_RESULTS","CBO_DEACTIVATED","TOP_RATED_CODE_RANKNAME","TOP_MERCHANTS_MIN","contentCache","topMerchantsCache","merchants","merchantIndex","algoliaClient","_handleAlgoliaSearchError","index","searchOptions","ALGOLIA_ERRORS","NETWORK_ERROR","JSONP_ERROR","TIMEOUT_ERROR","search","AlgoliaSearchRetry","_browseForMerchants","returnFirstResponse","algoliaBrowser","browseAll","hits","on","content","stop","_handleAlgoliaBrowseError","_getAlgoliaClient","apiKey","getDataStoreApiKeyOverride","api","readKey","algoliasearch","useFallback","_getMerchantsIndex","indexName","getDataStoreIndexOverride","initIndex","_refreshMerchantCache","desiredAttributes","filters","attributesToRetrieve","distinct","hitsPerPage","clearCache","slimMerchantsDictionary","hit","pick","dictionary","browserExtensionDomainOverride","browserExtensionSettings","additionalDomains","newDomain","filter","cboDomain","setLiveCbos","_getValidMerchants","cacheResults","_setPlacementOnlyCbo","genieOnlyRebate","genieOnlyRebates","startShowableDate","endShowableDate","startShowingAt","getTime","endShowingAt","rebates","_enforceSuppressions","suppressions","browserExtensionStoreSuppressions","suppression","offerType","offerTypeFilter","startDate","endDate","parse","codes","code","isUgc","_filterExpiredRebates","item","_updateLiveCbosTracking","cboUuids","rebate","_setCbosActivationState","length","activatedCbos","cbo","activeTimestamp","offerStatus","OFFER_STOOD_DOWN","activated","OFFER_ACTIVATED","filteredMerchants","acc","codesCount","rebatesCount","slice","maxMerchants","topDrivers","size","topDriversArr","topMerchantsFilterQuery","otherFilters","otherFiltersQuery","some","ranking","sort","a","b","aIndex","findIndex","bIndex","siteDomain","defaultResponse","cacheResult","isCacheFresh","validMerchants","validMerchant","domainComponents","checkCountLimit","i","shift","eventInfo","gaInfo","URLSearchParams","v","tid","gaId","cid","aip","ds","t","ea","ec","el","label","dh","dp","toString","headers","body","_handleInstallation","tabList","err","findInstallationTab","makeMyMondayTabs","includes","executeScript","possibleUrls","marketing","medium","marketingFound","installUrl","marketingString","possibleUrl","queryParams","marketingKey","analyticsMarketingValue","_manageWelcomePage","previousViewInstanceUuid","create","_handleUpdate","thisVersion","onInstalled","_installationUuid","_isSettingInstallationUuid","_retrySetSyncStorage","items","maxRetries","retryCount","intervalId","setInterval","storage","sync","lastError","clearInterval","level","_ensureUninstallUrl","installUuid","setUninstallURL","INSTALLATION_UUID","syncStorage","SET_INSTALLATION_UUID_EVENT","detail","once","local","localStorage","setObj","remove","setInstallationUuidEvent","CustomEvent","dispatchEvent","onChanged","changes","areaName","newValue","BASE_DOMAIN","_cachedUserStatus","cacheUserStatus","sendUserStatusToTab","broadcastUserStatusToAllTabs","changeInfo","cookie","isValidUpdate","cause","removed","cachedUserStatus","decodedJwt","jwt","decode","preferred_username","auth","sub","freshUserStatus","removeAllActivatedCbos","removeItem","OVERLORD_COOKIE_FLAG","ok","Math","random","responseText","responseJson","verified","email","loginMonitorAttempt","raven","release","Raven","Client","baseUrl","driverUrl","topDriverUrl","validationIntegrationUrl","reconfigureCapture","ravenInstance","oldCaptureException","oldCaptureMessage","ex","extraProperties","getOwnPropertyNames","fingerprint","apply","warn","_outclickTabId","installedAdBlockers","closeWithTimeout","lookForInstalledAdBlockers","tabInfo","onUpdatedCallback","outclickServiceUrl","activeTabs","tabClosed","onRemovedCallback","onUpdated","outclickInfo","outclickHost","encodedExperiments","overlordState","assign","testingCampaigns","process","env","VUE_DEVTOOLS","createTabOptions","popUpParentWindowId","getParentWindowId","outclickTab","browserInfoUtils","getBrowserInfo","N","navigator","appName","ua","userAgent","M","_matchKnownBrowser","tem","appVersion","_msieBrowserSafetyCheck","_operaBrowserSafetyCheck","_badBrowserSafetyCheck","test","msieBrowserSafetyCheck","browserInfoArray","operaBrowserSafetyCheck","badBrowserSafetyCheck","EVENT_PLATFORM","MAX_OFFLINE_QUEUE_DEPTH","cookieUuid","overlordClient","_SDK","depthExceededNotificationSent","_init","sessionId","contextBuilder","getContextBuilder","analyticsHost","BUILD_ENVIRONMENT","getItem","overlordJsSdk","host","doViewPageEvent","eventPlatform","build","initializing","_ensureCookieSpace","_flushEventQueueHelper","initialized","startedRequestTime","markInitialized","sendingDuration","parseInt","cookiesStatus","cookieEnabled","queuedEvents","eventToFire","_invokeEventFire","unshift","overlordFireEventInfo","isOnline","hydratedEventInfo","_hydrateEventInfoWithOverrides","fireMethod","custom","loggedInFlag","experiment","eventSequence","getEventSequenceCount","eventTimestamp","toISOString","eventPlatformVersion","fireClickPage","fire","ClickPage","OWENData","merge","fireRenderedImpression","RenderedImpression","fireViewPrompt","ViewPrompt","fireClickPrompt","ClickPrompt","fireSearch","Search","fireTestCodes","fireInstall","createContextBuilder","session","propertyName","browserInfo","browserFamily","browserVersion","screenHeight","screen","height","screenWidth","width","userUuid","currentVIU","previousVIU","stateObj","DEFAULT_SEQUENCE","sequences","tabVIUs","saveQueuedEvents","setItem","QUEUED_OVERLORD_EVENTS","existingEvents","defineProperty","newVIU","contains","origins","checkAllUrlsPermissions","perms","sendPermissionsToTab","_popUpId","_parentTabs","_areListenersInstantiated","_getPopUpHeight","POP_UP_TYPES","LOGIN","SIGN_UP","VERIFY","_getPopUpUrl","route","returnLink","popUpType","_setUpListeners","parentWindow","windows","getLastFocused","parentTab","popUpHeight","popUpWidth","top","round","left","newPopUp","update","focused","removedId","updatedId","onActivated","CHROME_ERROR_REGEX","FF_ERROR_REGEX","RETRY_REPEAT_ERROR_SEND_THRESHOLD","ONLINE_RETRY_TIMEOUT_BASE","readinessTools","watchingOnline","retryInterval","retryErrorSent","_onlineMonitor","min","onLine","cookieStores","getAllCookieStores","mode","_offlineMonitor","OFFLINE","_suspendMonitor","onoffline","redirectTrace","_baseWhitelist","Set","_CJandLinkshareDomains","_affiliateDomains","_impactradiusDomains","_redirectStatuses","_redirectListener","standardizedDetails","standardizedOnBeforeRequest","_parseHostname","_isCJorLinkshareAffiliate","target","has","_isOtherAffiliate","splitHostname","keyWord","_isPaypalExpressCheckoutCallback","URL","tokenValue","searchParams","indexOf","_shouldIgnorePriorRedirects","_shouldIncludeRedirect","redirect","shouldInclude","requestId","initiator","isNewHostname","includesAffiliateParameter","_previousCompletion","_completionListener","standardizedOnCompleted","completionDetails","priorRedirects","redirectStats","redirInfo","redirectInitiator","replace","rmnRedirects","CJorLinkshareAffiliateRedirects","otherAffiliateRedirects","potentialDeactivationsTotal","onBeforeRedirect","types","createElement","href","markStandDown","getKeyFromStorage","Array","isArray","setStorageValue","STORAGE_KEYS","OVERRIDES","REBATE_ACTIVATION_ENDPOINT","DATA_STORE_INDEX","DATA_STORE_API_KEY","testCodesCount","NUMBER_OF_TIMES_CHECKED_CODES","lastCodeTestingStatus","LAST_CODE_TESTING_STATUS","HAS_SEEN_GENIE_SURVEY","setDomainTimestamp","domainLevelTimestamps","hasRecentDomainTimestamp","expirationTime","domainLevelTimestamp","DISPLAYED_CBO_PROMPTS","MILLISECONDS","DAY","DISPLAYED_CART_PROMPTS","MINUTE","DISPLAYED_RXSAVER_PROMPTS","shouldDisplayRxSaverPrompt","getRecentlyDisplayedAmazonCboPrompts","displayedAmazonCboPrompts","DISPLAYED_AMAZON_CBO_PROMPTS","values","displayedPrompts","cboUuid","add","markAmazonCboPromptDisplayed","displayedAt","CODES_LAST_CHECKED","codeCheckCount","LIVE_CBOS","merchantCbos","liveCbos","ACTIVATED_CBOS","STAND_DOWN_LIST","HOUR","HAS_SEEN_CBO_INFO_PROMPT","COMPETITOR_CHECK","SHOULD_SHOW_REVIEW_US","getReviewUsShown","_newTabId","_openerTabId","onUpdatedTabCallback","onRemoveTabCallback","newTab","ERROR_EXTENSION_PORT_DISCONNECTED","ERROR_ESTABLISH_CONNECTION","production","sampleRate","debug","environment","ignoreErrors","browserBlackListIndex","validationIntegrationAPI","stage","allEnvironments","configForEnvironment","errors","SECOND","freeze","storageKeys","OUTCLICK_HOST","PREVIOUS_EXTENSION_VERSION","AB_TESTING","CAN_ACTIVATE","ACTIVATED","DEACTIVATED","UNRECOGNIZED_ERROR","EXPIRED","NOT_LOGGED_IN","NOT_VERIFIED","LOADING","CBO_PROMPT_NAMES","OFFER_LOADING","DOM","extractFromHTML","htmlString","selector","attributeName","tempDocument","implementation","createHTMLDocument","innerHTML","elements","querySelectorAll","element","getAttribute","textContent","querySelector","extractElementFromHTML","extractFormValues","append","form","formValues","serializeForm","empty","hash","formSearchParams","from","formattedParams","endsWith","trimmedKey","getAll","startsWith","location","protocol","extractElement","doc","DOMParser","parseFromString","setValue","htmlElement","getPrototypeOf","prototypeValueSetter","getOwnPropertyDescriptor","Event","bubbles","extractData","getElementData","runEmbeddedScript","scriptText","returnVariableName","condition","conditionMethod","maxWaitTime","stepTime","exceptionParam","returnValueParam","readyScript","script","appendChild","wait","arr","cb","args","asyncForEachExecutedInSuccession","retVals","idx","toLowerCase","vendor","getCookie","setCookie","cName","minutes","expires","date","setTime","toUTCString","withoutException","time","interval","queryString","queryObject","querySegments","accumulator","segment","decodeURIComponent","arrayLength","isFirefox","memoize","urlPart","adBlockersOn","each","adBlockers","adBlocker","revisit","none","default","isEnabled","merchantSettings","minimumRequiredVersion","disableBrowserExtensionDriver","MINIMUM_DRIVER_VERSION","browserExtensionMinimumDriverVersion","semverUtils","compare","formatters","moneyFormat","number","Number","isNaN","localeFormatting","style","currency","minimumFractionDigits","toLocaleString","toFloat","moneyString","floatCleanString","parseFloat","trim","elemToFloat","domNode","toInt","numberString","cleanString","pluralize","quantity","noun","suffix","getRandomInt","max","floor","roundToDecimal","digits","toFixed","jwtDecode","enable","enrichCodes","codeOffer","enrichedCodeOffers","currentCodeOffer","xhr","embedded","defaults","GenieRequest","constructor","adapter","adapters","defaultHeaders","mergeHeaders","_prepareHeaders","_getAdapter","head","post","put","patch","setType","Boolean","setDefaultHeaders","allowMerge","caller","withCredentials","FormData","sessionStorage","rmnTemp","headersArr","entries","headerName","headerValue","res","statusText","savedResponse","redirected","XMLHttpRequest","open","onreadystatechange","readyState","responseHeaders","reformatHeaders","getAllResponseHeaders","onabort","onerror","ontimeout","setRequestHeader","send","headersString","ignoreDuplicateOf","headersArray","headersObject","headerKeyValuePair","keyOrValue","requireProps","props","requiredProps","requiredType","required","lhs","rhs","lhsComponents","rhsComponents","nlhs","nrhs","requestURL","hasCredentials","DONE","emptyHeadersObject","param","current","_standardizedInitiator","originUrl"],"mappings":"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","file":"background.bundle.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"background\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([\"./src/bg/background.js\",\"vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import optimizely from '@optimizely/optimizely-sdk';\nimport { log } from '../utils';\nimport { genieReporter } from './monitoring';\nimport config from '../config';\n\nconst DATAFILE_CDN_URL = config.abTesting.cdnUrl;\nconst DATAFILE_TTL = 1000 * 60 * 60; // 1 hours\nconst TEST_CAMPAIGNS = config.abTesting.activeCampaigns;\n\nconst AB_TESTING_FALLBACK = {\n\tversion: '4',\n\trollouts: [],\n\tanonymizeIP: true,\n\tprojectId: config.abTesting.projectId,\n\tvariables: [],\n\tfeatureFlags: [],\n\texperiments: [],\n\taudiences: [],\n\tgroups: [],\n\tattributes: [],\n\tbotFiltering: false,\n\taccountId: '10253911865',\n\tevents: [],\n\trevision: '8',\n};\n\nconst abTesting = {\n\t_updatedTime: null,\n\t_pending: false,\n\t_optimizelyClientPromiseResolver: () => {},\n\t_optimizelyClientPromiseRejecter: () => {},\n\t_resetClientPromise() {\n\t\t// resolve any outstanding promises so that doesn't null out\n\t\tthis._optimizelyClientPromiseResolver(this._createClient(AB_TESTING_FALLBACK));\n\t\tthis._optimizelyClientPromise = new Promise((resolve, reject) => {\n\t\t\tthis._optimizelyClientPromiseResolver = resolve;\n\t\t\tthis._optimizelyClientPromiseRejecter = reject;\n\t\t});\n\t},\n\t_initFromRemote() {\n\t\tthis._pending = true;\n\t\tthis._resetClientPromise();\n\t\tlog('fetching optimizely datafile');\n\t\treturn fetch(DATAFILE_CDN_URL)\n\t\t\t.then(response => response.json())\n\t\t\t.then(datafile => {\n\t\t\t\tlog('fetched updated optimizely datafile', datafile);\n\t\t\t\tthis._updatedTime = Date.now();\n\t\t\t\tthis._optimizelyClientPromiseResolver(this._createClient(datafile));\n\t\t\t\tthis._pending = false;\n\t\t\t\treturn this._optimizelyClientPromise;\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\t// Skip this error as it's unactionable for us\n\t\t\t\tif (e.message !== 'Unexpected token < in JSON at position 0') {\n\t\t\t\t\tgenieReporter.captureException(e, {\n\t\t\t\t\t\textra: { source: { filePath: 'bg/ab-testing.js', method: '_initFromRemote' } },\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// return a valid bucketer with no experiments\n\t\t\t\t// but don't increment updated, to ensure we'll retry\n\t\t\t\tthis._pending = false;\n\t\t\t\tthis._optimizelyClientPromiseResolver(this._createClient(AB_TESTING_FALLBACK));\n\t\t\t\treturn this._optimizelyClientPromise;\n\t\t\t});\n\t},\n\t_createClient(datafile) {\n\t\treturn optimizely.createInstance({\n\t\t\tdatafile,\n\t\t\tlogger: { log },\n\t\t});\n\t},\n\t_getClient() {\n\t\tif (!this._pending && (this._updatedTime === null || Date.now() - this._updatedTime > DATAFILE_TTL)) {\n\t\t\treturn this._initFromRemote();\n\t\t}\n\t\treturn this._optimizelyClientPromise;\n\t},\n\tasync getVariations(installationUuid) {\n\t\tconst client = await this._getClient();\n\t\twindow.testVariations = TEST_CAMPAIGNS.reduce((list, campaign) => {\n\t\t\tconst variation = client.getVariation(campaign, installationUuid);\n\t\t\tif (variation) {\n\t\t\t\tlist.push({ campaign, variation });\n\t\t\t}\n\t\t\treturn list;\n\t\t}, []);\n\t\treturn window.testVariations;\n\t},\n};\n\n// ensure initial promise state\nabTesting._resetClientPromise();\n\nexport default abTesting;\n","import uuid from '@rmn/uuid';\n\n/**\n * RavenJS is used for Sentry reporting from our extension.\n */\nimport { genieReporter, driversReporter, topDriversReporter, validationIntegrationReporter } from './monitoring';\nimport cashbackApi from './cashback-api';\nimport competitorMonitor from './competitor-monitor';\nimport config from '../config';\nimport {\n\tgetMerchant,\n\tgetTopMerchants,\n\tsearchMerchants,\n\tgetAdditionalSearchMerchants,\n\tgetMerchantDomainFromHostname,\n} from './content-api';\nimport { requestUserStatus, getCachedUserStatus, monitorLoginChange } from './login';\nimport requestMonitor from './request-monitor';\nimport {\n\tshouldDisplayStandDown,\n\tshouldDisplayCboPrompt,\n\tshouldDisplayCartPrompt,\n\thasRecentlyCheckedCodes,\n\tshouldDisplaySurvey,\n\tshouldDisplayCboInfoPrompt,\n\tmarkCodeCheckingComplete,\n\tsetLastCodeTestingStatus,\n\tmarkCartPromptDisplayed,\n\tremoveUnusedStorageAreas,\n\tmarkCboPromptDisplayed,\n\tmarkSurveySeen,\n\tmarkCboInfoPromptSeen,\n\tsetShowReviewSideCard,\n\tmarkRxSaverPromptDisplayed,\n} from './storage-access';\nimport { setUpOutclickListeners, initiateOutclick, getOutclickURL } from './outclick';\nimport { setUpNewTabListeners, openNewTab } from './tab-manager';\nimport { openPopUp, focusPopUp, closePopUp } from './pop-up-manager';\nimport { log, browserUtils } from '../utils';\nimport { getExtensionPermissions, checkRmnDomainPermissions, monitorPermissionsChanges } from './permissions';\nimport overlord from './overlord';\nimport getInstallationUuid from './installation-uuid';\nimport standDown from './stand-down';\nimport abTesting from './ab-testing';\nimport ERRORS from '../consts/errors';\nimport EVENTS from '../consts/events';\nimport handleInstallOrUpdate from './install-and-update';\nimport readinessMonitor from './readiness-monitor';\nimport gaBeacon from './ga';\nimport isTopDriver from './top-drivers';\n\n// Used by drivers to store values only during the session\nconst driversStorage = new Map();\n\n// handler for unhandled errors\nwindow.addEventListener('error', e => {\n\tgenieReporter.captureException(new Error('Error from unhandled errors listener'), {\n\t\textra: {\n\t\t\terror: e.error,\n\t\t\tsource: { filePath: 'bg/background.js', method: 'unhandled errors listener' },\n\t\t},\n\t});\n});\n\n// http://bluebirdjs.com/docs/api/error-management-configuration.html#global-rejection-events\nwindow.addEventListener('unhandledrejection', e => {\n\t// extensions in Firefox have random uuid, we can get Genie id from the url generated by getUrl method\n\t// use same method for Chrome to not hardcode id value\n\tconst extensionId = browser.runtime.getURL('').match(/\\/\\/([\\w-]+)\\//)[1];\n\t// despite the linked docs, this definitely comes in as e.reason\n\tconst error = e.reason;\n\t// Genie error matches with the Genie extension id\n\tconst isGenieError =\n\t\t(e.currentTarget && e.currentTarget.origin.match(extensionId)) ||\n\t\t(error.stack && error.stack.match(extensionId)) ||\n\t\t(error.fileName && error.fileName.match(extensionId));\n\tif (isGenieError) {\n\t\tconst isFetchError = error.message.match(\n\t\t\t/(?:failed to fetch)|(?:networkError when attempting to fetch resource)/i,\n\t\t);\n\t\tconst errorMessage = isFetchError\n\t\t\t? 'Failed to fetch error from unhandledrejection listener'\n\t\t\t: 'Error from unhandledrejection listener';\n\t\tgenieReporter.captureException(new Error(errorMessage), {\n\t\t\textra: {\n\t\t\t\terror,\n\t\t\t\tsource: { filePath: 'bg/background.js', method: 'unhandledrejection listener' },\n\t\t\t},\n\t\t});\n\t}\n});\n\nconst coreAnalytics = overlord.client.init(uuid.randomBase32());\nhandleInstallOrUpdate(coreAnalytics);\n\nasync function sendGaBeacon() {\n\tconst clientId = await getInstallationUuid();\n\t// we do a simple catch here -- later `online` events will give us\n\t// a GA heartbeat as well, and we're still working to handle better\n\t// when this page comes up vs. when the browser is online / it has full access\n\tgaBeacon(clientId, { type: 'pageview' }).catch(e => e);\n}\nsendGaBeacon();\n\n// Ensure timely updates for the extension\n// If the api for doing so exists\nif (chrome.runtime.onUpdateAvailable) {\n\tchrome.runtime.onUpdateAvailable.addListener(() => {\n\t\tchrome.runtime.reload();\n\t});\n}\n\n// https://developer.chrome.com/extensions/runtimemethod-requestUpdateCheck\n// goes against advice, but an attempt to help combat update lag we've seen\n// which I think is related to our being a persistent background page now\n// (something they also tell you not to do)\nif (typeof chrome.runtime.requestUpdateCheck === 'function') {\n\tsetTimeout(() => {\n\t\tchrome.runtime.requestUpdateCheck(() => {});\n\t}, 5 * 60 * 60 * 1000);\n}\n\nlet sessionStarted = false;\n\ndocument.addEventListener(EVENTS.NETWORK.ONLINE, async () => {\n\tif (!sessionStarted) {\n\t\t// Track Browser Session\n\t\tcoreAnalytics.fireEvent('ViewPrompt', {\n\t\t\tcontext: {\n\t\t\t\tpageName: 'undetermined',\n\t\t\t\tpromptName: 'extension background start',\n\t\t\t},\n\t\t});\n\t\tgetInstallationUuid().then(clientId => {\n\t\t\tgaBeacon(clientId, { type: 'event', category: 'network', action: 'online' });\n\t\t});\n\n\t\t// reset the local login flag\n\t\tawait requestUserStatus();\n\n\t\t// Set a cookie on retailmenot domain so pages on RMN can know if genie is installed\n\t\tconst hasPermissions = await checkRmnDomainPermissions();\n\t\tif (hasPermissions && chrome.cookies) {\n\t\t\tchrome.cookies.set({\n\t\t\t\turl: `https://${config.site.baseDomain}/`,\n\t\t\t\tdomain: `.${config.site.baseDomain}`,\n\t\t\t\tname: 'genieInstalled',\n\t\t\t\tvalue: '1',\n\t\t\t});\n\t\t}\n\t}\n\tsessionStarted = true;\n\t// fire off any events we have stored from a prior session\n\t// or which we have been waiting to send this session\n\ttry {\n\t\tawait coreAnalytics.flushEventQueue();\n\t} catch (e) {\n\t\tgenieReporter.captureException(e, {\n\t\t\textra: {\n\t\t\t\tsource: { filePath: 'bg/background.js', method: 'coreAnalytics.flushEventQueue()' },\n\t\t\t},\n\t\t});\n\t}\n});\n// order is important; this will trigger the above listener\nreadinessMonitor.init();\n\nmonitorPermissionsChanges();\nmonitorLoginChange();\n// registers webrequest monitor to see activations from RMN core site\ncashbackApi.listenForActivations();\n// registers webrequest listener to monitor for de-activations of current CBOs\nrequestMonitor.setUpListeners();\n// ensure we correctly close outclick tabs\nsetUpOutclickListeners();\n// ensure we correctly close new tabs and send `closedTab` message\nsetUpNewTabListeners();\n\nchrome.tabs.onRemoved.addListener(tabId => {\n\t// we need to prune old viewInstanceUuid data so it doesn't grow 5ever\n\toverlord.state.pruneViewInstanceUuids(tabId);\n});\n\nif (browserUtils.isChrome()) {\n\tcompetitorMonitor.start(coreAnalytics);\n}\n\nchrome.browserAction.setBadgeBackgroundColor({\n\tcolor: '#de1f72', // $bbb-pink\n});\n\nchrome.browserAction.onClicked.addListener(() => {\n\tchrome.tabs.query(\n\t\t{\n\t\t\tactive: true,\n\t\t\tcurrentWindow: true,\n\t\t},\n\t\ttabs => {\n\t\t\tchrome.tabs.sendMessage(\n\t\t\t\ttabs[0].id,\n\t\t\t\t{\n\t\t\t\t\treveal: true,\n\t\t\t\t},\n\t\t\t\t() => {},\n\t\t\t);\n\t\t},\n\t);\n});\n\nchrome.extension.onMessage.addListener(msg => {\n\tconst { toggle } = msg;\n\tchrome.tabs.query(\n\t\t{\n\t\t\tactive: true,\n\t\t\tcurrentWindow: true,\n\t\t},\n\t\ttabs => {\n\t\t\tchrome.tabs.sendMessage(\n\t\t\t\ttabs[0].id,\n\t\t\t\t{\n\t\t\t\t\treveal: toggle,\n\t\t\t\t},\n\t\t\t\t() => {},\n\t\t\t);\n\t\t},\n\t);\n});\n\nfunction handleError(e, sendResponse, payload, options) {\n\tconsole.error(e); // eslint-disable-line\n\tif (e.message !== 'Attempting to use a disconnected port object') {\n\t\tif (e.name !== ERRORS.ALGOLIA.UNPARSABLE_JSON) {\n\t\t\tgenieReporter.captureException(e, options);\n\t\t}\n\t\tif (typeof sendResponse === 'function' && typeof payload !== 'undefined') {\n\t\t\tsendResponse(payload);\n\t\t}\n\t}\n}\n\nchrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n\tlet isAsyncRequest = false;\n\tswitch (request.instruction) {\n\t\tcase 'updateIcon':\n\t\t\tchrome.browserAction.setIcon(\n\t\t\t\t{\n\t\t\t\t\tpath: chrome.extension.getURL(`icons/${request.value}-icon-38.png`),\n\t\t\t\t\ttabId: sender.tab && sender.tab.id,\n\t\t\t\t},\n\t\t\t\t() => {},\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'updateBadge':\n\t\t\tchrome.browserAction.setBadgeText({\n\t\t\t\ttext: request.value ? `${request.value}` : '', // empty string removes badge\n\t\t\t\ttabId: sender.tab && sender.tab.id,\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'beacon':\n\t\t\tcoreAnalytics.fireEvent(request.eventType, request.eventPayload).catch(handleError);\n\t\t\tbreak;\n\t\tcase 'error':\n\t\t\tconst sentryError = new Error(request.errorMessage); // eslint-disable-line no-case-declarations\n\t\t\tsentryError.stack = request.errorStack;\n\t\t\t// by default, assume long tail driver error\n\t\t\tlet sentryReporter = driversReporter; // eslint-disable-line no-case-declarations\n\t\t\tif (!request.domain) {\n\t\t\t\t// the error was not sent by a handleDriverError call, which always sets domain\n\t\t\t\t// treat this as a core extension error\n\t\t\t\tsentryReporter = genieReporter;\n\t\t\t}\n\t\t\tif (request.validationSupport) {\n\t\t\t\tsentryReporter = validationIntegrationReporter;\n\t\t\t}\n\t\t\tif (isTopDriver(request.domain)) {\n\t\t\t\t// we report top domains to a separate, more tightly monitored sentry collection\n\t\t\t\tsentryReporter = topDriversReporter;\n\t\t\t}\n\t\t\tsentryReporter.captureException(\n\t\t\t\tsentryError,\n\t\t\t\t{\n\t\t\t\t\textra: {\n\t\t\t\t\t\tstack: request.errorStack,\n\t\t\t\t\t\turl: request.errorUrl,\n\t\t\t\t\t\tinfo: request.errorInfo,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\trequest.logOnBackground,\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'getDisplayInformation':\n\t\t\tisAsyncRequest = true;\n\t\t\tgetMerchantDomainFromHostname(request.hostname)\n\t\t\t\t.then(domain =>\n\t\t\t\t\tPromise.all([\n\t\t\t\t\t\tgetMerchant(domain),\n\t\t\t\t\t\tgetCachedUserStatus(),\n\t\t\t\t\t\tshouldDisplayStandDown(domain),\n\t\t\t\t\t\tshouldDisplayCboPrompt(domain),\n\t\t\t\t\t\tshouldDisplayCartPrompt(domain),\n\t\t\t\t\t\thasRecentlyCheckedCodes(domain),\n\t\t\t\t\t\tshouldDisplaySurvey(),\n\t\t\t\t\t\tgetInstallationUuid(),\n\t\t\t\t\t\tshouldDisplayCboInfoPrompt(),\n\t\t\t\t\t\tgetExtensionPermissions(),\n\t\t\t\t\t]).then(\n\t\t\t\t\t\t([\n\t\t\t\t\t\t\tmerchant,\n\t\t\t\t\t\t\tuserStatus,\n\t\t\t\t\t\t\tshouldStandDown,\n\t\t\t\t\t\t\tshouldShowCboPrompt,\n\t\t\t\t\t\t\tshouldShowCartPrompt,\n\t\t\t\t\t\t\tcodesRecentlyChecked,\n\t\t\t\t\t\t\tshouldShowSurvey,\n\t\t\t\t\t\t\tinstallationUuid,\n\t\t\t\t\t\t\tshouldShowCboInfoPrompt,\n\t\t\t\t\t\t\tpermissions,\n\t\t\t\t\t\t]) =>\n\t\t\t\t\t\t\tabTesting.getVariations(installationUuid).then(testVariations => {\n\t\t\t\t\t\t\t\tsendResponse({\n\t\t\t\t\t\t\t\t\tmerchant,\n\t\t\t\t\t\t\t\t\tuserStatus,\n\t\t\t\t\t\t\t\t\tshouldStandDown,\n\t\t\t\t\t\t\t\t\tshouldShowCboPrompt,\n\t\t\t\t\t\t\t\t\tshouldShowCartPrompt,\n\t\t\t\t\t\t\t\t\tcodesRecentlyChecked,\n\t\t\t\t\t\t\t\t\tshouldShowSurvey,\n\t\t\t\t\t\t\t\t\tinstallationUuid,\n\t\t\t\t\t\t\t\t\tshouldShowCboInfoPrompt,\n\t\t\t\t\t\t\t\t\textensionVersion: chrome.runtime.getManifest().version,\n\t\t\t\t\t\t\t\t\tpermissions,\n\t\t\t\t\t\t\t\t\ttestVariations,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t)\n\t\t\t\t.catch(e => {\n\t\t\t\t\thandleError(e, sendResponse, {\n\t\t\t\t\t\tcoupons: [],\n\t\t\t\t\t\tmerchant: {},\n\t\t\t\t\t\tuserStatus: {\n\t\t\t\t\t\t\tisLoggedIn: false,\n\t\t\t\t\t\t\tisVerified: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tshouldStandDown: false,\n\t\t\t\t\t\tshouldShowCboPrompt: false,\n\t\t\t\t\t\tshouldShowCartPrompt: false,\n\t\t\t\t\t\tcodesRecentlyChecked: false,\n\t\t\t\t\t\tshouldShowCboInfoPrompt: false,\n\t\t\t\t\t\textensionVersion: chrome.runtime.getManifest().version,\n\t\t\t\t\t\ttestVariations: [],\n\t\t\t\t\t\tblockedByNetwork: e.name === ERRORS.ALGOLIA.UNPARSABLE_JSON,\n\t\t\t\t\t\t// in an error case, assume we do\n\t\t\t\t\t\t// to avoid an issue requesting when we don't need them\n\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\tall: true,\n\t\t\t\t\t\t\trmn: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\tbreak;\n\t\tcase 'getMerchantSearchResults':\n\t\t\tisAsyncRequest = true;\n\t\t\tsearchMerchants(request.searchString)\n\t\t\t\t.then(merchantList => {\n\t\t\t\t\tsendResponse(merchantList);\n\t\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\thandleError(e, sendResponse, [], { extra: { source: 'getMerchantSearchResults' } });\n\t\t\t\t});\n\t\t\tbreak;\n\t\tcase 'getTopMerchantsList':\n\t\t\tisAsyncRequest = true;\n\t\t\tgetTopMerchants(request.limit)\n\t\t\t\t.then(merchantList => {\n\t\t\t\t\tsendResponse(merchantList);\n\t\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\thandleError(e, sendResponse, [], { extra: { source: 'getTopMerchantsList' } });\n\t\t\t\t});\n\t\t\tbreak;\n\t\tcase 'getAdditionalSearchMerchantsList':\n\t\t\tisAsyncRequest = true;\n\t\t\tgetAdditionalSearchMerchants(request.page)\n\t\t\t\t.then(merchantList => {\n\t\t\t\t\tsendResponse(merchantList);\n\t\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\thandleError(e, sendResponse, [], { extra: { source: 'getAdditionalSearchMerchantsList' } });\n\t\t\t\t});\n\t\t\tbreak;\n\t\tcase 'requestUserStatus':\n\t\t\tisAsyncRequest = true;\n\t\t\trequestUserStatus().then(userStatus => {\n\t\t\t\tsendResponse(userStatus);\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'activateCbo':\n\t\t\tlog('activating CBO: %o', request.cashbackOffer);\n\t\t\tisAsyncRequest = true;\n\t\t\tgetInstallationUuid().then(installationUuid => {\n\t\t\t\tcashbackApi\n\t\t\t\t\t.activate({\n\t\t\t\t\t\tcashbackOffer: request.cashbackOffer,\n\t\t\t\t\t\ttestVariations: request.testVariations,\n\t\t\t\t\t\tinstallationUuid,\n\t\t\t\t\t\tpageName: request.pageName,\n\t\t\t\t\t})\n\t\t\t\t\t.then(responseData => {\n\t\t\t\t\t\tsendResponse(responseData);\n\t\t\t\t\t\tinitiateOutclick({\n\t\t\t\t\t\t\tuuid: request.cashbackOffer.uuid,\n\t\t\t\t\t\t\tviewInstanceUuid: request.viewInstanceUuid,\n\t\t\t\t\t\t\tpageName: request.pageName,\n\t\t\t\t\t\t\tpageType: request.pageType,\n\t\t\t\t\t\t\ttestVariations: request.testVariations,\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch(e => {\n\t\t\t\t\t\thandleError(e, sendResponse, { success: false }, { extra: { source: 'activateCbo' } });\n\t\t\t\t\t});\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'checkCboStatus':\n\t\t\tisAsyncRequest = true;\n\t\t\tcashbackApi\n\t\t\t\t.getActivatedCboUuids(request.domain)\n\t\t\t\t.then(cbos => {\n\t\t\t\t\tsendResponse(cbos);\n\t\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\thandleError(e, sendResponse, {}, { extra: { source: 'checkCboStatus' } });\n\t\t\t\t});\n\t\t\tbreak;\n\t\tcase 'outclick':\n\t\t\tinitiateOutclick(request);\n\t\t\tbreak;\n\t\tcase 'getOutclickURL':\n\t\t\tisAsyncRequest = true;\n\t\t\tgetOutclickURL(request)\n\t\t\t\t.then(url => sendResponse(url))\n\t\t\t\t.catch(e => handleError(e, sendResponse, null, { extra: { source: 'getOutclickURL' } }));\n\t\t\tbreak;\n\t\tcase 'setStandDown':\n\t\t\tstandDown.set(request.domain);\n\t\t\tbreak;\n\t\tcase 'markCodeCheckingComplete':\n\t\t\tmarkCodeCheckingComplete(request.domain, request.timestamp);\n\t\t\tbreak;\n\t\tcase 'setLastCodeTestingStatus':\n\t\t\tsetLastCodeTestingStatus(request.status);\n\t\t\tbreak;\n\t\tcase 'markCartPromptDisplayed':\n\t\t\tmarkCartPromptDisplayed(request.domain, request.timestamp);\n\t\t\tbreak;\n\t\tcase 'markRxSaverPromptDisplayed':\n\t\t\tmarkRxSaverPromptDisplayed(request.domain, request.timestamp);\n\t\t\tbreak;\n\t\tcase 'markCboPromptDisplayed':\n\t\t\tmarkCboPromptDisplayed(request.domain, request.timestamp);\n\t\t\tbreak;\n\t\tcase 'shouldDisplayPrompt':\n\t\t\tisAsyncRequest = true;\n\t\t\tconst methodToCheck = request.promptType === 'cart' ? shouldDisplayCartPrompt : shouldDisplayCboPrompt; // eslint-disable-line no-case-declarations\n\t\t\tPromise.all([methodToCheck(request.domain), shouldDisplayStandDown(request.domain)])\n\t\t\t\t.then(([displayCartPrompt, displayStandDown]) => {\n\t\t\t\t\tsendResponse(displayCartPrompt && !displayStandDown);\n\t\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\thandleError(e, sendResponse, false, { extra: { source: 'shouldDisplayPrompt' } });\n\t\t\t\t});\n\t\t\tbreak;\n\t\tcase 'markCboInfoPromptSeen':\n\t\t\tmarkCboInfoPromptSeen();\n\t\t\tbreak;\n\t\tcase 'markSurveySeen':\n\t\t\tmarkSurveySeen();\n\t\t\tbreak;\n\t\tcase 'openNewTab':\n\t\t\tisAsyncRequest = true;\n\t\t\tif (sender.tab) {\n\t\t\t\t// This could be used from driver to load merchant page again\n\t\t\t\t// to receive/send updated data (cookies, analitics to avoid blocking, etc.)\n\t\t\t\topenNewTab({\n\t\t\t\t\turl: request.url,\n\t\t\t\t\topenerTabId: sender.tab.id,\n\t\t\t\t\twindowId: sender.tab.windowId,\n\t\t\t\t})\n\t\t\t\t\t.then(newTabId => {\n\t\t\t\t\t\tsendResponse(newTabId);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(e => {\n\t\t\t\t\t\thandleError(e, sendResponse, false, { extra: { source: 'openNewTab' } });\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Send `false` to inform that tab was not opened\n\t\t\t\tsendResponse(false);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'getDriverStorage':\n\t\t\tisAsyncRequest = true;\n\t\t\tsendResponse(driversStorage.get(request.domain));\n\t\t\tbreak;\n\t\tcase 'setDriverStorage':\n\t\t\tdriversStorage.set(request.domain, request.value);\n\t\t\tbreak;\n\t\tcase 'deleteDriverStorage':\n\t\t\tdriversStorage.delete(request.domain);\n\t\t\tbreak;\n\t\tcase 'displayPopUp':\n\t\t\tlog('displaying pop up');\n\t\t\topenPopUp(request.type);\n\t\t\tbreak;\n\t\tcase 'focusPopUp':\n\t\t\tlog('moving pop up to front');\n\t\t\tfocusPopUp();\n\t\t\tbreak;\n\t\tcase 'setShowReviewUsSideCard':\n\t\t\tsetShowReviewSideCard(request.flag);\n\t\t\tbreak;\n\t\tcase 'closePopUp':\n\t\t\tlog('closing pop up');\n\t\t\tclosePopUp();\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tgenieReporter.captureMessage(\n\t\t\t\t`Warn: invoked default background message handler for instruction: ${request.instruction}`,\n\t\t\t);\n\t}\n\tif (!isAsyncRequest) {\n\t\tsendResponse({});\n\t}\n\t// returning true will keep our port open, otherwise it will be closed\n\treturn isAsyncRequest;\n});\nremoveUnusedStorageAreas();\n","import {\n\trecordCboActivationState,\n\tgetActivatedCbos,\n\tgetLiveCbos,\n\tgetRebateActivationEndpointOverride,\n} from './storage-access';\nimport { log, browserUtils, asyncUtils } from '../utils';\nimport config from '../config';\nimport CBO_STATES from '../inject/consts/cbo-states';\nimport abTesting from './ab-testing';\nimport { genieReporter, driversReporter, topDriversReporter } from './monitoring';\nimport isTopDriver from './top-drivers';\nimport { domainFromHostname } from '../utils/browser';\n\nconst { asyncForEachExecutedInParallel } = asyncUtils;\n\nconst IGNORE_REQUEST_PARAM = 'fromGenie';\nconst defaultApiEndpoint = `https://www.${config.site.baseDomain}/ajax/rewardActivation`;\n\nconst sendCboUpdateInstruction = async (tabId, offerUuid) =>\n\tbrowser.tabs.sendMessage(tabId, { instruction: 'cboStatusChanged', cboStatus: 'cboActivated', offerUuid });\nconst broadcastCboActivationToAllTabs = async offerUuid => {\n\tconst tabs = await browser.tabs.query({});\n\tawait asyncForEachExecutedInParallel(tabs.map(tab => tab.id), sendCboUpdateInstruction, offerUuid);\n};\n\nconst cashbackApi = {\n\tapiEndpoint: undefined,\n\t/**\n\t * Attempt to activate a cashback offer.\n\t * @param {object} cashbackOffer any object with a key 'uuid' and value of a cashback offer UUID\n\t */\n\tasync activate({ cashbackOffer, installationUuid, testVariations, pageName, fromGenie = true }) {\n\t\tlet experiments = testVariations;\n\t\tif (!experiments) {\n\t\t\tgenieReporter.captureException(new Error('failed to pass testVariations when activating CBO'));\n\t\t\ttry {\n\t\t\t\texperiments = await abTesting.getVariations(installationUuid);\n\t\t\t} catch (e) {\n\t\t\t\tgenieReporter.captureException(e, {\n\t\t\t\t\textra: {\n\t\t\t\t\t\tsource: { filePath: 'bg/cashback-api.js', method: 'abTesting.getVariations' },\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\texperiments = [];\n\t\t\t}\n\t\t}\n\t\tconst endpoint = await this._getApiEndpoint();\n\t\tconst data = {\n\t\t\toffer_uuid: cashbackOffer.uuid,\n\t\t\t[IGNORE_REQUEST_PARAM]: 1, // used so we can ignore CBO activation requests generated by the extension (and not, say, the core site)\n\t\t\texternalExperiments: JSON.stringify(experiments),\n\t\t};\n\t\tconst params = Object.keys(data)\n\t\t\t.map(key => `${key}=${encodeURIComponent(data[key])}`)\n\t\t\t.join('&');\n\n\t\tlet response;\n\t\tlet responseData = {\n\t\t\tsuccess: false,\n\t\t\tcboState: CBO_STATES.OFFER_ERROR,\n\t\t};\n\n\t\ttry {\n\t\t\tresponse = await fetch(`${endpoint}?${params}`, {\n\t\t\t\tmethod: 'GET',\n\t\t\t\tcredentials: 'include',\n\t\t\t});\n\t\t\tif (response && response.status === 200) {\n\t\t\t\tresponseData = await response.json();\n\t\t\t\tif (responseData.success) {\n\t\t\t\t\trecordCboActivationState(cashbackOffer.uuid, responseData.success);\n\t\t\t\t} else {\n\t\t\t\t\tswitch (responseData.message) {\n\t\t\t\t\t\tcase 'REBATE_INACTIVE': {\n\t\t\t\t\t\t\tresponseData.cboState = CBO_STATES.OFFER_ERROR;\n\t\t\t\t\t\t\tif (pageName && fromGenie) {\n\t\t\t\t\t\t\t\tconst hostname = pageName.split('/')[0];\n\t\t\t\t\t\t\t\tconst reporter = isTopDriver(domainFromHostname(hostname))\n\t\t\t\t\t\t\t\t\t? topDriversReporter\n\t\t\t\t\t\t\t\t\t: driversReporter;\n\t\t\t\t\t\t\t\treporter.captureMessage(new Error(`${hostname} - Error: CBO was Expired!`), {\n\t\t\t\t\t\t\t\t\textra: { info: { cashbackOffer, responseData } },\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase 'REBATE_INVALID':\n\t\t\t\t\t\t\t// this would mean the offer has been deleted since being ingested by our hydra service\n\t\t\t\t\t\t\t// and cached in the extension local state / algolia resource still\n\t\t\t\t\t\t\t// so let's mark CBO_STATES.OFFER_ERROR\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'UNVERIFIED_EMAIL':\n\t\t\t\t\t\t\tresponseData.cboState = CBO_STATES.OFFER_NOT_ACTIVATED;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t// TODO: (2/16/18) - we need a UX for this\n\t\t\t\t\t\t// falling through to general error state\n\t\t\t\t\t\tcase 'EMAIL_INVALID':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t// fall through to this, as deletion in *RMN* will be indistinguishable from a generic bad response\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresponseData.message = 'ERROR';\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tgenieReporter.captureException(e, {\n\t\t\t\textra: {\n\t\t\t\t\tsource: { filePath: 'bg/cashback-api.js', method: 'cashbackApi.activate' },\n\t\t\t\t\tresponse,\n\t\t\t\t\tresponseData,\n\t\t\t\t},\n\t\t\t});\n\t\t\tresponseData.message = 'ERROR';\n\t\t}\n\t\treturn responseData;\n\t},\n\tlistenForActivations() {\n\t\t/**\n\t\t * @function activateCboRequestListener\n\t\t * When the extension detects a request to activate a CBO, add the activated CBO\n\t\t * to the extension's local storage.\n\t\t * @see https://developer.chrome.com/extensions/webRequest#event-onCompleted\n\t\t * @param {object} details information about the detected request (see above URL for more info)\n\t\t */\n\t\tasync function activateCboRequestListener(details) {\n\t\t\tlog('cbo activation listener');\n\t\t\tconst params = browserUtils.parseQueryString(details.url);\n\t\t\tif (\n\t\t\t\t!Object.prototype.hasOwnProperty.call(params, IGNORE_REQUEST_PARAM) &&\n\t\t\t\t(Object.prototype.hasOwnProperty.call(params, 'offer_uuid') ||\n\t\t\t\t\tObject.prototype.hasOwnProperty.call(params, 'u')) &&\n\t\t\t\tdetails.statusCode === 200\n\t\t\t) {\n\t\t\t\tconst offerUuid = params.offer_uuid || params.u;\n\t\t\t\tconst fromGenie = false;\n\t\t\t\t// re-activate so we can check the response for an error\n\t\t\t\tconst activatedCbo = await this.activate({\n\t\t\t\t\tcashbackOffer: { uuid: offerUuid },\n\t\t\t\t\tinstallationUuid: null,\n\t\t\t\t\ttestVariations: [],\n\t\t\t\t\tpageName: null,\n\t\t\t\t\tfromGenie,\n\t\t\t\t});\n\t\t\t\tif (activatedCbo.success) {\n\t\t\t\t\tbroadcastCboActivationToAllTabs(offerUuid);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlog('setting up webrequest listener for CBOs');\n\t\tchrome.webRequest.onCompleted.addListener(activateCboRequestListener.bind(this), {\n\t\t\t// if user activates cbo from rmn\n\t\t\turls: [\n\t\t\t\t`https://www.${config.site.baseDomain}/view/*`,\n\t\t\t\t`https://www.${config.site.baseDomain}/cashback?u=*`,\n\t\t\t\t`https://www.${config.site.baseDomain}/ajax/rewardActivation*`,\n\t\t\t\t`https://www.${config.site.baseDomain}/responsive/ajax/rewardActivation*`,\n\t\t\t],\n\t\t});\n\t},\n\n\thandlePotentialDeactivationNotice(hostname) {\n\t\tconst domain = browserUtils.domainFromHostname(hostname);\n\t\t// 1st record deactivations for any cbos we have for that host\n\t\treturn this.getActivatedCboUuids(domain)\n\t\t\t.then(activatedCBOs => {\n\t\t\t\tconst activatedCBOUuids = Object.keys(activatedCBOs);\n\t\t\t\tlet hadActivatedCBO = false;\n\t\t\t\tif (activatedCBOUuids) {\n\t\t\t\t\tactivatedCBOUuids.forEach(activatedCBOUuid => {\n\t\t\t\t\t\thadActivatedCBO = true;\n\t\t\t\t\t\trecordCboActivationState(activatedCBOUuid, false);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn hadActivatedCBO;\n\t\t\t})\n\t\t\t.then(hadActivatedCBO => {\n\t\t\t\t// then message any active tabs that their cbo has been turned off.\n\t\t\t\t// only do this in the case that cbo state changed, so we don't message\n\t\t\t\t// about deactivation when we were not in fact on.\n\t\t\t\tif (hadActivatedCBO) {\n\t\t\t\t\tlog('sending deactivation notice: %s', hostname);\n\t\t\t\t\tchrome.tabs.query(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\turl: [`*://${domain}/*`, `*://*.${domain}/*`],\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttabs => {\n\t\t\t\t\t\t\ttabs.forEach(tab => {\n\t\t\t\t\t\t\t\tchrome.tabs.sendMessage(tab.id, {\n\t\t\t\t\t\t\t\t\tinstruction: 'cboStatusChanged',\n\t\t\t\t\t\t\t\t\tcboStatus: 'cboDeactivated',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t},\n\tgetActivatedCboUuids(domain) {\n\t\tif (!domain) {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\n\t\tconst liveCboUuidsPromise = getLiveCbos().then(cboUuidsByDomain => cboUuidsByDomain[domain]);\n\t\tconst activatedCbosPromise = getActivatedCbos();\n\t\treturn Promise.all([liveCboUuidsPromise, activatedCbosPromise]).then(results => {\n\t\t\tconst liveCboUuids = results[0] || [];\n\t\t\tconst activations = results[1] || {};\n\t\t\tconst liveAndActivatedForDomain = {};\n\t\t\tliveCboUuids.forEach(liveUuid => {\n\t\t\t\tif (activations[liveUuid]) {\n\t\t\t\t\tliveAndActivatedForDomain[liveUuid] = activations[liveUuid];\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn liveAndActivatedForDomain;\n\t\t});\n\t},\n\t_getApiEndpoint() {\n\t\tif (this.apiEndpoint) {\n\t\t\treturn Promise.resolve(this.apiEndpoint);\n\t\t}\n\t\treturn getRebateActivationEndpointOverride()\n\t\t\t.then(endpoint => {\n\t\t\t\tthis.apiEndpoint = endpoint || defaultApiEndpoint;\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tthis.apiEndpoint = defaultApiEndpoint;\n\t\t\t})\n\t\t\t.then(() => this.apiEndpoint);\n\t},\n};\n\nexport default cashbackApi;\n","import { genieReporter } from './monitoring';\nimport config from '../config';\nimport { getCompetitorCheck, markCompetitorCheck } from './storage-access';\nimport { log, browserUtils } from '../utils';\nimport state from './overlord/overlord-state';\n\nconst { checkExtensionExistence } = browserUtils;\n\nconst COMPETITOR_CHECK_INTERVAL_MILLISECONDS = 1000 * 60 * 60 * 24 * 7; // 1 week\n\nconst competitorMonitor = {\n\tstart(analytics) {\n\t\tgetCompetitorCheck().then(checkTime => {\n\t\t\tif (Date.now() - (checkTime || 0) > COMPETITOR_CHECK_INTERVAL_MILLISECONDS) {\n\t\t\t\tthis._getCompetitors().forEach(competitor => {\n\t\t\t\t\tthis._checkExistence(competitor)\n\t\t\t\t\t\t.then(exists => {\n\t\t\t\t\t\t\tanalytics.fireEvent('ViewPrompt', {\n\t\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\t\tpageName: 'undetermined',\n\t\t\t\t\t\t\t\t\tpromptName: exists\n\t\t\t\t\t\t\t\t\t\t? 'competitor extension installed'\n\t\t\t\t\t\t\t\t\t\t: 'competitor extension not installed',\n\t\t\t\t\t\t\t\t\tviewInstanceUuid: state.currentViewInstanceUuid,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tevent: {\n\t\t\t\t\t\t\t\t\teventAction: 'view',\n\t\t\t\t\t\t\t\t\teventName: 'prompt',\n\t\t\t\t\t\t\t\t\teventTarget: competitor.name,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(e => {\n\t\t\t\t\t\t\tlog(`Check for ${competitor.name} existence failed-${e.name}: ${e.message}`);\n\t\t\t\t\t\t\tgenieReporter.captureException(e, {\n\t\t\t\t\t\t\t\textra: {\n\t\t\t\t\t\t\t\t\tsource: { filePath: 'bg/competitor-monitor.js', method: 'competitorMonitor.start' },\n\t\t\t\t\t\t\t\t\tcompetitor: competitor.name,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tmarkCompetitorCheck();\n\t\t\t}\n\t\t});\n\t},\n\t_getCompetitors() {\n\t\treturn config.competitors;\n\t},\n\t_checkExistence(competitor) {\n\t\treturn checkExtensionExistence(competitor.extensionId, competitor.webAccessibleResourcePath);\n\t},\n};\n\nexport default competitorMonitor;\n","import pick from 'lodash.pick';\nimport algoliasearch from 'algoliasearch';\nimport config from '../config';\nimport { genieReporter } from './monitoring';\nimport {\n\tgetDataStoreApiKeyOverride,\n\tgetDataStoreIndexOverride,\n\tgetActivatedCbos,\n\tgetLiveCbos,\n\tsetLiveCbos,\n} from './storage-access';\nimport { log, browserUtils } from '../utils';\nimport { ALGOLIA_ERRORS } from '../consts/errors';\nimport CBO_STATES from '../inject/consts/cbo-states';\n\nimport { topDrivers } from './top-drivers';\n\n// one hour merchant query cache\nconst CONTENT_CACHE_LIFETIME_MS = 60 * 60 * 1000;\nconst TWELVE_HOURS_MS = 12 * 60 * 60 * 1000;\nconst MAX_MERCHANT_COUNT = 1000;\nconst MAX_MERCHANT_SEARCH_RESULTS = 50;\nconst CBO_DEACTIVATED = -1;\n\nconst TOP_RATED_CODE_RANKNAME = 'Top Rated';\nconst TOP_MERCHANTS_MIN = 10;\n\n/**\n * The content cache will record 2 types of information\n * 'merchants' -- key to a domain -> settings map for merchants which are enabled\n *                this allows us to gate calls effectively\n * '<example.com>' -- key to the full codes and settings object for that merchant\n */\nconst contentCache = new Map();\nconst topMerchantsCache = {\n\ttimestamp: null,\n\tmerchants: [],\n};\nlet merchantIndex;\nlet algoliaClient;\n\n/**\n * @function _handleAlgoliaSearchError\n * @param {Error} e - the error that triggered this fallback\n * @param {AlgoliaSearchIndex} index\n * @param {Object} searchOptions - AlgoliaSearch search options\n */\nconst _handleAlgoliaSearchError = async (error, index, searchOptions) => {\n\tif (\n\t\terror.name === ALGOLIA_ERRORS.NETWORK_ERROR ||\n\t\terror.name === ALGOLIA_ERRORS.JSONP_ERROR ||\n\t\terror.name === ALGOLIA_ERRORS.TIMEOUT_ERROR\n\t) {\n\t\t// for now, niave set-timeout to try and escape networking blip\n\t\t// more rigorous networking state detection to follow\n\t\tawait new Promise(resolve => setTimeout(resolve, 100));\n\n\t\ttry {\n\t\t\tconst response = await index.search(searchOptions);\n\t\t\treturn response;\n\t\t} catch (e) {\n\t\t\tgenieReporter.captureException(e, {\n\t\t\t\textra: {\n\t\t\t\t\tAlgoliaSearchRetry: searchOptions,\n\t\t\t\t\tsource: { filePath: 'bg/content-api.js', method: '_handleAlgoliaSearchError' },\n\t\t\t\t},\n\t\t\t});\n\t\t\tthrow e;\n\t\t}\n\t}\n\tthrow error;\n};\n/**\n * @description Private method for browsing merchants (to get more than 1k records from Algolia)\n * @param {AlgoliaSearchIndex} index\n * @param {Object} searchOptions - AlgoliaSearch search options\n * @param {Boolean} returnFirstResponse - return all hits or only first response\n * @returns {Promise}\n * @private\n */\nconst _browseForMerchants = (index, searchOptions, returnFirstResponse = false) => {\n\tlog('Browsing merchants started.');\n\treturn new Promise((resolve, reject) => {\n\t\tconst algoliaBrowser = index.browseAll(searchOptions);\n\t\tconst hits = [];\n\n\t\talgoliaBrowser.on('result', content => {\n\t\t\thits.push(...content.hits);\n\t\t\tif (returnFirstResponse) {\n\t\t\t\talgoliaBrowser.stop();\n\t\t\t\tresolve(hits);\n\t\t\t}\n\t\t});\n\n\t\talgoliaBrowser.on('end', () => {\n\t\t\tlog('Browsing merchants finished!');\n\t\t\treturn resolve(hits);\n\t\t});\n\n\t\talgoliaBrowser.on('error', error => reject(error));\n\t});\n};\n/**\n * @function _handleAlgoliaBrowseError\n * @param {Error} e - the error that triggered this fallback\n * @param {AlgoliaSearchIndex} index\n * @param {Object} searchOptions - AlgoliaSearch search options\n */\nconst _handleAlgoliaBrowseError = async (error, index, searchOptions) => {\n\tif (\n\t\terror.name === ALGOLIA_ERRORS.NETWORK_ERROR ||\n\t\terror.name === ALGOLIA_ERRORS.JSONP_ERROR ||\n\t\terror.name === ALGOLIA_ERRORS.TIMEOUT_ERROR\n\t) {\n\t\t// for now, niave set-timeout to try and escape networking blip\n\t\t// more rigorous networking state detection to follow\n\t\tawait new Promise(resolve => setTimeout(resolve, 100));\n\n\t\ttry {\n\t\t\tconst response = await _browseForMerchants(index, searchOptions);\n\t\t\treturn response;\n\t\t} catch (e) {\n\t\t\tgenieReporter.captureException(e, {\n\t\t\t\textra: {\n\t\t\t\t\tAlgoliaSearchRetry: searchOptions,\n\t\t\t\t\tsource: { filePath: 'bg/content-api.js', method: 'handleAlgoliaBrowseError._browseForMerchants' },\n\t\t\t\t},\n\t\t\t});\n\t\t\tthrow e;\n\t\t}\n\t}\n\tthrow error;\n};\nconst _getAlgoliaClient = async () => {\n\tif (!algoliaClient) {\n\t\tconst apiKey = (await getDataStoreApiKeyOverride()) || config.api.readKey;\n\t\talgoliaClient = algoliasearch('RCSNJTTPHT', apiKey, {\n\t\t\t// this is not included in the README documentation of the algoliasearch-client-javascript,\n\t\t\t// but can be set as evidenced by https://github.com/algolia/algoliasearch-client-javascript/blob/8ee53c4864706e53ef30a54f6ffd889862e6b0e8/src/AlgoliaSearchCore.js#L121\n\t\t\t// we don't want to ever use the fallback because it will deterministically fail\n\t\t\t// due to extension CSP rules applied against their JSONP request strategy\n\t\t\t// we will instead implement a retry strategy of our own.\n\t\t\tuseFallback: false,\n\t\t});\n\t}\n\treturn algoliaClient;\n};\nconst _getMerchantsIndex = async () => {\n\tif (!merchantIndex) {\n\t\tconst indexName = (await getDataStoreIndexOverride()) || config.api.merchantIndex;\n\t\tconst client = await _getAlgoliaClient();\n\t\tmerchantIndex = client.initIndex(indexName);\n\t}\n\treturn merchantIndex;\n};\nconst _refreshMerchantCache = async () => {\n\tconst desiredAttributes = [\n\t\t'domain',\n\t\t'isEnabledOnBrowserExtension',\n\t\t'disableBrowserExtensionDriver',\n\t\t'browserExtensionBlacklistedSubdomains',\n\t\t'browserExtensionDomainOverride',\n\t\t'browserExtensionMinimumDriverVersion',\n\t\t'browserExtensionSettings',\n\t\t'title',\n\t\t'uuid',\n\t\t'codesCount',\n\t\t'rebatesCount',\n\t];\n\tconst index = await _getMerchantsIndex();\n\tconst searchOptions = {\n\t\tquery: '',\n\t\tfilters: 'isEnabledOnBrowserExtension:true',\n\t\tattributesToRetrieve: desiredAttributes,\n\t\tdistinct: true,\n\t\thitsPerPage: MAX_MERCHANT_COUNT,\n\t};\n\tlet hits;\n\ttry {\n\t\thits = await _browseForMerchants(index, searchOptions);\n\t} catch (e) {\n\t\thits = await _handleAlgoliaBrowseError(e, index, searchOptions);\n\t}\n\t// we must clear the algolia cache so that it does not persist\n\tindex.clearCache();\n\n\tconst slimMerchantsDictionary = hits\n\t\t.map(hit => pick(hit, desiredAttributes))\n\t\t.reduce((dictionary, merchant) => {\n\t\t\tconst domain = merchant.browserExtensionDomainOverride || merchant.domain;\n\t\t\tdictionary[domain] = merchant;\n\t\t\t// create additional lookup options if necessary\n\t\t\tif (merchant.browserExtensionSettings && merchant.browserExtensionSettings.additionalDomains) {\n\t\t\t\tmerchant.browserExtensionSettings.additionalDomains.forEach(newDomain => {\n\t\t\t\t\tdictionary[newDomain] = merchant;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn dictionary;\n\t\t}, {});\n\n\tcontentCache.set('merchants', {\n\t\tmerchants: slimMerchantsDictionary,\n\t\ttimestamp: Date.now(),\n\t});\n\n\t// If a merchant with valid CBOs was turned off, we need to remove the live CBOs currently tracked in local storage\n\tconst cboUuidsByDomain = await getLiveCbos();\n\tObject.keys(cboUuidsByDomain)\n\t\t.filter(cboDomain => slimMerchantsDictionary[cboDomain] === undefined)\n\t\t.forEach(cboDomain => {\n\t\t\tsetLiveCbos(cboDomain, []);\n\t\t});\n\n\treturn slimMerchantsDictionary;\n};\n// Even when the cache is valid, this returns a Promise so that calling functions know they need to await it\nconst _getValidMerchants = async () => {\n\tconst cacheResults = contentCache.get('merchants');\n\t// if cache is old, we'll request updated content\n\tif (!cacheResults || Date.now() - cacheResults.timestamp > CONTENT_CACHE_LIFETIME_MS) {\n\t\treturn _refreshMerchantCache();\n\t}\n\treturn cacheResults.merchants;\n};\nconst _setPlacementOnlyCbo = merchant => {\n\tconst [genieOnlyRebate] = (merchant.browserExtensionSettings || {}).genieOnlyRebates || [];\n\tif (genieOnlyRebate && genieOnlyRebate.startShowableDate && genieOnlyRebate.endShowableDate) {\n\t\tconst now = Date.now();\n\t\tconst startShowingAt = new Date(genieOnlyRebate.startShowableDate).getTime();\n\t\tconst endShowingAt = new Date(genieOnlyRebate.endShowableDate).getTime();\n\t\tif (startShowingAt <= now && now <= endShowingAt) {\n\t\t\tmerchant.rebates = [genieOnlyRebate];\n\t\t}\n\t}\n};\n\nconst _enforceSuppressions = merchant => {\n\tconst suppressions = merchant.browserExtensionStoreSuppressions;\n\tif (suppressions) {\n\t\tconst now = Date.now();\n\t\tsuppressions.forEach(suppression => {\n\t\t\tconst offerType = suppression.offerTypeFilter;\n\t\t\tlet { startDate, endDate } = suppression;\n\t\t\tif (offerType && startDate && endDate) {\n\t\t\t\tstartDate = Date.parse(startDate);\n\t\t\t\tendDate = Date.parse(endDate);\n\t\t\t\tif (startDate < now && endDate > now) {\n\t\t\t\t\tswitch (offerType) {\n\t\t\t\t\t\tcase 'CODE':\n\t\t\t\t\t\t\tmerchant.codes = [];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'UGC':\n\t\t\t\t\t\t\tmerchant.codes = merchant.codes.filter(code => !code.isUgc);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'CASH_BACK_OFFER':\n\t\t\t\t\t\t\tmerchant.rebates = [];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\n// TODO: Possibly CBO can exist even if the start date & endDate doesn't exist. We should handle this option too in the future.\nconst _filterExpiredRebates = rebates => {\n\treturn rebates.filter(item => {\n\t\tconst startDate = Date.parse(item.startDate);\n\t\tconst endDate = Date.parse(item.endDate);\n\t\tconst now = Date.now();\n\t\tif (endDate && now > endDate) {\n\t\t\treturn false;\n\t\t}\n\t\tif (startDate && now < startDate) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t});\n};\nconst _updateLiveCbosTracking = merchant => {\n\tconst cboUuids = merchant.rebates.map(rebate => rebate.uuid);\n\tsetLiveCbos(merchant.domain, cboUuids);\n};\nconst _setCbosActivationState = async merchant => {\n\tif (!merchant.rebates || merchant.rebates.length === 0) {\n\t\treturn;\n\t}\n\tconst activatedCbos = await getActivatedCbos();\n\tmerchant.rebates.forEach(cbo => {\n\t\tconst activeTimestamp = activatedCbos[cbo.uuid];\n\t\tlet offerStatus;\n\t\tif (activeTimestamp === CBO_DEACTIVATED) {\n\t\t\tofferStatus = CBO_STATES.OFFER_STOOD_DOWN;\n\t\t} else {\n\t\t\t// !! coerces undefined to false so we are ensured to get a boolean back\n\t\t\tconst activated = !!activeTimestamp && Date.now() - activeTimestamp <= TWELVE_HOURS_MS;\n\t\t\tofferStatus = activated ? CBO_STATES.OFFER_ACTIVATED : CBO_STATES.OFFER_NOT_ACTIVATED;\n\t\t}\n\t\tcbo.offerStatus = offerStatus;\n\t});\n};\n\n/**\n * @description Searches Algolia index for supplied domain. Note that Algolia has specific ranking factors that, for example, prioritize the domain override attribute over domain\n * @param  {String} query Optional query string\n * @returns {Array} Result merchants array\n */\nexport const searchMerchants = async (query = '') => {\n\tif (!query) {\n\t\t// Use data from merchants cache in case we need a list of all merchants\n\t\treturn _getValidMerchants();\n\t}\n\t// Otherwise search with given query\n\tconst index = await _getMerchantsIndex();\n\tconst attributesToRetrieve = ['uuid', 'domain', 'title', 'codes', 'rebates', 'browserExtensionStoreSuppressions'];\n\tconst searchOptions = {\n\t\tquery,\n\t\tattributesToRetrieve,\n\t\tfilters: 'isEnabledOnBrowserExtension:true AND (codesCount > 0 OR rebatesCount > 0)',\n\t\thitsPerPage: MAX_MERCHANT_COUNT,\n\t};\n\tlet hits;\n\ttry {\n\t\thits = await _browseForMerchants(index, searchOptions);\n\t} catch (e) {\n\t\thits = await _handleAlgoliaBrowseError(e, index, searchOptions);\n\t}\n\n\tconst filteredMerchants = hits.reduce((acc, merchant) => {\n\t\t_enforceSuppressions(merchant);\n\t\tmerchant.rebates = _filterExpiredRebates(merchant.rebates);\n\t\tmerchant.codesCount = merchant.codes.length;\n\t\tmerchant.rebatesCount = merchant.rebates.length;\n\t\tif (merchant.codesCount || merchant.rebatesCount) {\n\t\t\t// we are removing 'codes', 'rebates' and 'browserExtensionStoreSuppressions' from the merchant object since we no longer need that information there.\n\t\t\t// in addition, with that information included to the object its structure may appear to be too complex\n\t\t\t// which can result in poor performance\n\t\t\tdelete merchant.codes;\n\t\t\tdelete merchant.rebates;\n\t\t\tdelete merchant.browserExtensionStoreSuppressions;\n\n\t\t\treturn [...acc, merchant];\n\t\t}\n\n\t\treturn acc;\n\t}, []);\n\n\tindex.clearCache();\n\n\t// to prevent rendering large number of DOM elements\n\treturn filteredMerchants.slice(0, MAX_MERCHANT_SEARCH_RESULTS);\n};\n\n/**\n * @description Searches Algolia index for top merchants.\n * @param {Number} maxMerchants Optional number of merchants to return\n * @returns {Array} Array of top merchants\n */\nexport const getTopMerchants = async (maxMerchants = topDrivers.size) => {\n\tif (\n\t\ttopMerchantsCache.timestamp &&\n\t\tDate.now() - topMerchantsCache.timestamp < CONTENT_CACHE_LIFETIME_MS &&\n\t\ttopMerchantsCache.merchants.length\n\t) {\n\t\treturn topMerchantsCache.merchants.slice(0, maxMerchants);\n\t}\n\n\tconst index = await _getMerchantsIndex();\n\tconst topDriversArr = [...topDrivers];\n\tconst attributesToRetrieve = ['uuid', 'domain', 'title', 'codes', 'rebates', 'browserExtensionStoreSuppressions'];\n\tconst topMerchantsFilterQuery = topDriversArr.map(item => `domain:${item}`).join(' OR ');\n\tconst otherFilters = ['isEnabledOnBrowserExtension:true', 'disableBrowserExtensionDriver:false', 'codesCount >= 1'];\n\tconst otherFiltersQuery = otherFilters.join(' AND ');\n\tconst filters = `(${topMerchantsFilterQuery}) AND ${otherFiltersQuery}`;\n\tconst searchOptions = {\n\t\tfilters,\n\t\tattributesToRetrieve,\n\t\thitsPerPage: MAX_MERCHANT_COUNT,\n\t};\n\n\tlet hits;\n\ttry {\n\t\thits = await _browseForMerchants(index, searchOptions);\n\t} catch (e) {\n\t\thits = await _handleAlgoliaBrowseError(e, index, searchOptions);\n\t}\n\n\tconst filteredMerchants = hits\n\t\t.reduce((acc, merchant) => {\n\t\t\t_enforceSuppressions(merchant);\n\t\t\tmerchant.rebates = _filterExpiredRebates(merchant.rebates);\n\t\t\tif (merchant.codes.some(code => code.ranking === TOP_RATED_CODE_RANKNAME)) {\n\t\t\t\tmerchant.codesCount = merchant.codes.length;\n\t\t\t\tmerchant.rebatesCount = merchant.rebates.length;\n\t\t\t\t// we are removing 'codes', 'rebates' and 'browserExtensionStoreSuppressions' from the merchant object since we no longer need that information there.\n\t\t\t\t// in addition, with that information included to the object its structure may appear to be too complex\n\t\t\t\t// which can result in poor performance\n\t\t\t\tdelete merchant.codes;\n\t\t\t\tdelete merchant.rebates;\n\t\t\t\tdelete merchant.browserExtensionStoreSuppressions;\n\n\t\t\t\treturn [...acc, merchant];\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, [])\n\t\t.sort((a, b) => {\n\t\t\tconst aIndex = topDriversArr.findIndex(merchant => merchant === a.domain);\n\t\t\tconst bIndex = topDriversArr.findIndex(merchant => merchant === b.domain);\n\t\t\treturn aIndex - bIndex;\n\t\t});\n\n\tif (filteredMerchants.length < TOP_MERCHANTS_MIN) {\n\t\tgenieReporter.captureException(\n\t\t\tnew Error(`Top merchants list contains less than ${TOP_MERCHANTS_MIN} merchants`),\n\t\t);\n\t}\n\n\tindex.clearCache();\n\n\ttopMerchantsCache.timestamp = Date.now();\n\ttopMerchantsCache.merchants = filteredMerchants;\n\treturn filteredMerchants.slice(0, maxMerchants);\n};\n\n/**\n * @param {Number} page Number of page to return\n * @returns {Array} Array of merchants\n */\nexport const getAdditionalSearchMerchants = async page => {\n\tconst index = await _getMerchantsIndex();\n\tconst topDriversArr = topMerchantsCache.merchants.map(merchant => merchant.domain);\n\tconst attributesToRetrieve = ['uuid', 'domain', 'title', 'codes', 'rebates', 'browserExtensionStoreSuppressions'];\n\tconst topMerchantsFilterQuery = topDriversArr.map(item => `NOT domain:${item}`).join(' AND ');\n\tconst filters = `(${topMerchantsFilterQuery}) AND isEnabledOnBrowserExtension:true AND (codesCount > 0 OR rebatesCount > 0)`;\n\tconst searchOptions = {\n\t\tquery: '',\n\t\tfilters,\n\t\tattributesToRetrieve,\n\t\thitsPerPage: 20,\n\t\tpage,\n\t};\n\n\tlet hits;\n\ttry {\n\t\thits = await _browseForMerchants(index, searchOptions, true);\n\t} catch (e) {\n\t\thits = await _handleAlgoliaBrowseError(e, index, searchOptions);\n\t}\n\n\tconst filteredMerchants = hits.reduce((acc, merchant) => {\n\t\t_enforceSuppressions(merchant);\n\t\tmerchant.rebates = _filterExpiredRebates(merchant.rebates);\n\t\tmerchant.codesCount = merchant.codes.length;\n\t\tmerchant.rebatesCount = merchant.rebates.length;\n\t\tif (merchant.codesCount || merchant.rebatesCount) {\n\t\t\t// we are removing 'codes', 'rebates' and 'browserExtensionStoreSuppressions' from the merchant object since we no longer need that information there.\n\t\t\t// in addition, with that information included to the object its structure may appear to be too complex\n\t\t\t// which can result in poor performance\n\t\t\tdelete merchant.codes;\n\t\t\tdelete merchant.rebates;\n\t\t\tdelete merchant.browserExtensionStoreSuppressions;\n\n\t\t\treturn [...acc, merchant];\n\t\t}\n\n\t\treturn acc;\n\t}, []);\n\n\tindex.clearCache();\n\n\treturn filteredMerchants;\n};\n\nexport const getMerchant = async siteDomain => {\n\tconst defaultResponse = {\n\t\tcodes: [],\n\t\trebates: [],\n\t};\n\n\tif (!siteDomain) {\n\t\treturn defaultResponse;\n\t}\n\n\tconst cacheResult = contentCache.get(siteDomain);\n\tconst isCacheFresh = cacheResult && Date.now() - cacheResult.timestamp <= CONTENT_CACHE_LIFETIME_MS;\n\n\tif (isCacheFresh) {\n\t\tconst { merchant } = cacheResult;\n\t\tawait _setCbosActivationState(merchant);\n\t\treturn merchant;\n\t}\n\n\tconst validMerchants = await _getValidMerchants();\n\tconst validMerchant = validMerchants[siteDomain];\n\t// If we couldn't find the merchant in the dictionary of valid merchants, then return empty object\n\tif (!validMerchant) {\n\t\treturn defaultResponse;\n\t}\n\n\tconst index = await _getMerchantsIndex();\n\tconst searchOptions = {\n\t\tquery: '',\n\t\tfilters: `domain:${validMerchant.domain}`,\n\t\tdistinct: true,\n\t};\n\tlet hits;\n\ttry {\n\t\t({ hits } = await index.search(searchOptions));\n\t} catch (e) {\n\t\t({ hits } = await _handleAlgoliaSearchError(e, index, searchOptions));\n\t}\n\t// we must clear the algolia cache so that it does not persist\n\tindex.clearCache();\n\n\tconst merchant = hits[0];\n\tmerchant.rebates = _filterExpiredRebates(merchant.rebates);\n\tif (!merchant) {\n\t\treturn defaultResponse;\n\t}\n\n\t_setPlacementOnlyCbo(merchant);\n\t_enforceSuppressions(merchant);\n\t_updateLiveCbosTracking(merchant);\n\tcontentCache.set(siteDomain, { merchant, timestamp: Date.now() });\n\tawait _setCbosActivationState(merchant);\n\treturn merchant;\n};\n\nexport const getMerchantDomainFromHostname = async hostname => {\n\tconst merchants = await _getValidMerchants();\n\t// check a domain such as ben.is.here.google.com from most\n\t// specific (ben.is.here.google.com) to least (google.com)\n\tconst domainComponents = hostname.split('.');\n\t// Subtract two to stop at the tld and main domain, ex. google.com\n\tconst checkCountLimit = domainComponents.length - 2;\n\tlet i = 0;\n\twhile (i < checkCountLimit) {\n\t\ti += 1;\n\t\tconst merchant = merchants[domainComponents.join('.')];\n\t\tif (merchant) {\n\t\t\treturn merchant.browserExtensionDomainOverride || merchant.domain;\n\t\t}\n\t\tdomainComponents.shift();\n\t}\n\n\treturn browserUtils.domainFromHostname(hostname);\n};\n","// note on overall strategy: https://blog.mozilla.org/addons/2016/05/31/using-google-analytics-in-extensions/\n// GA API reference: https://developers.google.com/analytics/devguides/collection/protocol/v1/devguide\n\nimport config from '../config';\n\nfunction gaBeacon(clientId, eventInfo) {\n\tconst gaInfo = new URLSearchParams({\n\t\tv: 1,\n\t\ttid: config.gaId,\n\t\tcid: clientId,\n\t\t// anonomize IP address; Mozilla seems to desire this\n\t\taip: 1,\n\t\tds: 'genie',\n\t\tt: eventInfo.type,\n\t\t// required if we are sending an 'event' vs. 'pageview'\n\t\tea: eventInfo.action,\n\t\tec: eventInfo.category,\n\t\tel: eventInfo.label,\n\t\t// page views fail without these\n\t\t// and if we don't spoof the host into a domain\n\t\tdh: `${chrome.runtime.id}.com`,\n\t\tdp: '_generated_background_page.html',\n\t}).toString();\n\treturn fetch('https://www.google-analytics.com/collect', {\n\t\tmethod: 'POST',\n\t\tcredentials: 'include',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t},\n\t\tbody: gaInfo,\n\t});\n}\n\nexport default gaBeacon;\n","import config from '../config';\nimport { log, browserUtils } from '../utils';\nimport { genieReporter } from './monitoring';\nimport state from './overlord/overlord-state';\n\nasync function _handleInstallation(coreAnalytics) {\n\tlog('installing extension');\n\tlet tabList;\n\n\ttry {\n\t\ttabList = await browser.tabs.query({\n\t\t\turl: [\n\t\t\t\t`https://www.${config.site.baseDomain}/genie/*`,\n\t\t\t\t'https://chrome.google.com/webstore/detail/retailmenot-genie/*',\n\t\t\t\t'https://chrome.google.com/webstore/detail/retailmenot-genie-instant/*',\n\t\t\t\t`https://chrome.google.com/webstore/detail/${chrome.runtime.id}/*`,\n\t\t\t\t'https://chrome.google.com/webstore/search/genie',\n\t\t\t\t'https://chrome.google.com/webstore/search/retailmenot',\n\t\t\t\t'https://chrome.google.com/webstore/search/retail%20me%20not',\n\t\t\t\t'https://addons.mozilla.org/en-US/firefox/addon/retailmenot_genie/*',\n\t\t\t],\n\t\t});\n\t} catch (err) {\n\t\tgenieReporter.captureException(err, {\n\t\t\textra: {\n\t\t\t\tfindInstallationTab: true,\n\t\t\t\tsource: { filePath: 'bg/install-and-update.js', method: '_handleInstallation' },\n\t\t\t},\n\t\t});\n\t\ttabList = [];\n\t}\n\n\tif (tabList.length === 0) {\n\t\t// If we installed from a tablist of length 0, it means that the install was not valid\n\t\t// We do not want to fire the install event because then we will include Google Bots\n\t\t// In our install count.\n\t\treturn;\n\t}\n\n\t// react to Make My Monday marketing param on Landing Page (if present)\n\tconst makeMyMondayTabs = tabList.filter(\n\t\ttab => tab.url.includes(config.site.baseDomain) && tab.url.includes('utm_campaign=mmm_6182018'),\n\t);\n\tmakeMyMondayTabs.forEach(tab => {\n\t\tchrome.tabs.executeScript(tab.id, {\n\t\t\tcode: `\n\t\t\t\tconst scriptElement = document.createElement('script');\n\t\t\t\tscriptElement.text = 'window.MMM.showPopUp();';\n\t\t\t\tdocument.body.appendChild(scriptElement);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tdocument.body.removeChild(scriptElement);\n\t\t\t\t}, 200);\n\t\t\t\t`,\n\t\t});\n\t});\n\n\tconst possibleUrls = tabList.map(tab => tab.url);\n\tconst marketing = {\n\t\tmedium: null,\n\t\tsource: null,\n\t\tcampaign: null,\n\t};\n\tlet marketingFound = false;\n\tlet installUrl = '/genie';\n\tlet marketingString = '';\n\tpossibleUrls.forEach(possibleUrl => {\n\t\tif (!marketingFound) {\n\t\t\tconst queryParams = browserUtils.parseQueryString(possibleUrl);\n\t\t\tif (Object.keys(queryParams).length > 0) {\n\t\t\t\tObject.keys(marketing).forEach(marketingKey => {\n\t\t\t\t\tconst analyticsMarketingValue = queryParams[`utm_${marketingKey}`];\n\t\t\t\t\tif (analyticsMarketingValue) {\n\t\t\t\t\t\tmarketingFound = true;\n\t\t\t\t\t\tmarketing[marketingKey] = analyticsMarketingValue;\n\t\t\t\t\t\t[installUrl, marketingString] = possibleUrl.split('?');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\t_manageWelcomePage(marketingString);\n\n\tconst context = {\n\t\tviewInstanceUuid: state.currentViewInstanceUuid,\n\t\tpreviousViewInstanceUuid: null,\n\t\tpageName: installUrl,\n\t\tmarketing,\n\t};\n\tcoreAnalytics.fireEvent('Install', {\n\t\tcontext,\n\t\tevent: {\n\t\t\teventAction: 'manage extension',\n\t\t\teventName: 'genie',\n\t\t\teventTarget: 'install',\n\t\t},\n\t});\n}\n\n/**\n * Immediately after install, opens the Welcome page.\n */\nfunction _manageWelcomePage(marketingString) {\n\tchrome.tabs.create({\n\t\turl: `https://www.${config.site.baseDomain}/genie/welcome?${marketingString}`,\n\t});\n}\n\nfunction _handleUpdate(coreAnalytics) {\n\tconst thisVersion = chrome.runtime.getManifest().version;\n\tlog('updating extension to %s', thisVersion);\n\tcoreAnalytics.fireEvent('Install', {\n\t\tcontext: {\n\t\t\tviewInstanceUuid: state.currentViewInstanceUuid,\n\t\t\tpreviousViewInstanceUuid: state.previousViewInstanceUuid,\n\t\t\tpageName: '/genie',\n\t\t},\n\t\tevent: {\n\t\t\teventAction: 'manage extension',\n\t\t\teventName: 'genie',\n\t\t\teventTarget: 'update',\n\t\t},\n\t});\n}\n\nfunction handleInstallOrUpdate(coreAnalytics) {\n\tif (chrome.runtime.onInstalled) {\n\t\tchrome.runtime.onInstalled.addListener(details => {\n\t\t\tif (details.reason === 'install') {\n\t\t\t\t_handleInstallation(coreAnalytics);\n\t\t\t} else if (details.reason === 'update') {\n\t\t\t\t_handleUpdate(coreAnalytics);\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport { _handleUpdate };\nexport default handleInstallOrUpdate;\n","import uuid from '@rmn/uuid';\nimport Promise from 'bluebird';\nimport config from '../config';\nimport { genieReporter } from './monitoring';\nimport { INSTALLATION_UUID } from '../consts/storage-keys';\n\nlet _installationUuid;\nlet _isSettingInstallationUuid = false;\nconst _retrySetSyncStorage = (items, maxRetries) => {\n\tlet retryCount = 0;\n\tconst intervalId = setInterval(() => {\n\t\tchrome.storage.sync.set(items, () => {\n\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\tretryCount += 1;\n\t\t\t\tif (retryCount >= maxRetries) {\n\t\t\t\t\tgenieReporter.captureException(new Error('_retrySetSyncStorage: maxRetries exceeded'), {\n\t\t\t\t\t\textra: {\n\t\t\t\t\t\t\textra: items,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tclearInterval(intervalId);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tgenieReporter.captureMessage('_retrySetSyncStorage: successfully set', { level: 'info', extra: items });\n\t\t\t\tclearInterval(intervalId);\n\t\t\t}\n\t\t});\n\t}, 2000);\n};\nconst _ensureUninstallUrl = installUuid => {\n\tchrome.runtime.setUninstallURL(\n\t\t`https://www.${config.site.baseDomain}/genie/uninstall?uu=${installUuid}&v=${config.extensionVersion}`,\n\t);\n};\n\n// TODO: Migrate to async/await pattern once browser polyfill lands\nexport default () => {\n\tif (_installationUuid) {\n\t\treturn Promise.resolve(_installationUuid);\n\t}\n\n\treturn new Promise(resolve => {\n\t\tchrome.storage.sync.get(INSTALLATION_UUID, syncStorage => {\n\t\t\tif (syncStorage[INSTALLATION_UUID]) {\n\t\t\t\t_installationUuid = syncStorage[INSTALLATION_UUID];\n\t\t\t\t_ensureUninstallUrl(_installationUuid);\n\t\t\t\tresolve(_installationUuid);\n\t\t\t} else {\n\t\t\t\tconst SET_INSTALLATION_UUID_EVENT = 'setInstallationUuidEvent';\n\t\t\t\t// if already setting installation UUID, don't set again\n\t\t\t\t// instead, register event listener to wait for custom event\n\t\t\t\tif (_isSettingInstallationUuid) {\n\t\t\t\t\tdocument.addEventListener(\n\t\t\t\t\t\tSET_INSTALLATION_UUID_EVENT,\n\t\t\t\t\t\te => {\n\t\t\t\t\t\t\tresolve(e.detail[INSTALLATION_UUID]);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{ once: true },\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\t// set flag to prevent code block from running multiple times\n\t\t\t\t\t_isSettingInstallationUuid = true;\n\n\t\t\t\t\t// check if user has an installation UUID stored locally\n\t\t\t\t\t// if so, migrate to sync storage and remove from local storage\n\t\t\t\t\tchrome.storage.local.get(INSTALLATION_UUID, localStorage => {\n\t\t\t\t\t\tconst setObj = {};\n\t\t\t\t\t\tif (localStorage[INSTALLATION_UUID]) {\n\t\t\t\t\t\t\tsetObj[INSTALLATION_UUID] = localStorage[INSTALLATION_UUID];\n\t\t\t\t\t\t\tchrome.storage.local.remove(INSTALLATION_UUID);\n\t\t\t\t\t\t\tgenieReporter.captureMessage('Local installation UUID used for resync');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetObj[INSTALLATION_UUID] = uuid.randomBase32();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tchrome.storage.sync.set(setObj, () => {\n\t\t\t\t\t\t\tif (chrome.runtime.lastError) {\n\t\t\t\t\t\t\t\tgenieReporter.captureException(new Error(chrome.runtime.lastError), {\n\t\t\t\t\t\t\t\t\textra: {\n\t\t\t\t\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\t\t\t\t\tfilePath: 'bg/installation-uuid.js',\n\t\t\t\t\t\t\t\t\t\t\tmethod: 'getInstallationUuid.lastError',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t_retrySetSyncStorage(setObj, 5);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// dispatch custom event to resolve pending promises waiting for the installation UUID\n\t\t\t\t\t\t\tconst setInstallationUuidEvent = new CustomEvent(SET_INSTALLATION_UUID_EVENT, {\n\t\t\t\t\t\t\t\tdetail: setObj,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tdocument.dispatchEvent(setInstallationUuidEvent);\n\n\t\t\t\t\t\t\tchrome.storage.onChanged.addListener((changes, areaName) => {\n\t\t\t\t\t\t\t\tif (areaName === 'sync' && changes[INSTALLATION_UUID]) {\n\t\t\t\t\t\t\t\t\tgenieReporter.captureMessage('Installation UUID resynced', {\n\t\t\t\t\t\t\t\t\t\tlevel: 'info',\n\t\t\t\t\t\t\t\t\t\textra: changes[INSTALLATION_UUID],\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t_installationUuid = changes[INSTALLATION_UUID].newValue;\n\t\t\t\t\t\t\t\t\t_ensureUninstallUrl(_installationUuid);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t_installationUuid = setObj[INSTALLATION_UUID];\n\t\t\t\t\t\t\t_ensureUninstallUrl(_installationUuid);\n\t\t\t\t\t\t\tresolve(_installationUuid);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n};\n","import { jwt, asyncUtils } from '../utils';\nimport config from '../config';\nimport { removeAllActivatedCbos } from './storage-access';\nimport { OVERLORD_COOKIE_FLAG } from '../consts/storage-keys';\nimport { genieReporter } from './monitoring';\n\nconst { asyncForEachExecutedInParallel } = asyncUtils;\nconst BASE_DOMAIN = config.site.baseDomain;\n\nconst _cachedUserStatus = {\n\tisLoggedIn: false,\n\tisVerified: false,\n\tuuid: null,\n};\nconst getCachedUserStatus = () => _cachedUserStatus;\nconst cacheUserStatus = ({ isLoggedIn, isVerified, uuid = null }) => {\n\t_cachedUserStatus.isLoggedIn = isLoggedIn;\n\t_cachedUserStatus.isVerified = isVerified;\n\t_cachedUserStatus.uuid = uuid;\n};\nconst sendUserStatusToTab = async (tabId, userStatus) =>\n\tbrowser.tabs.sendMessage(tabId, { instruction: 'userStatusChanged', userStatus });\nconst broadcastUserStatusToAllTabs = async userStatus => {\n\tconst tabs = await browser.tabs.query({});\n\tawait asyncForEachExecutedInParallel(tabs.map(tab => tab.id), sendUserStatusToTab, userStatus);\n};\n\n/**\n * @function monitorLoginChange - sets up a listener on the rmn cookie space, allowing us to monitor login state\n * @member loginTools\n */\nconst monitorLoginChange = () => {\n\tchrome.cookies.onChanged.addListener(async changeInfo => {\n\t\tconst { cookie } = changeInfo;\n\n\t\tif (cookie.domain !== `.${BASE_DOMAIN}` && cookie.domain !== `.secure.${BASE_DOMAIN}`) {\n\t\t\t// by virtue of the webRequest permissions we need, we'll get non-rmn cookie updates that\n\t\t\t// we need to filter out\n\t\t\treturn;\n\t\t}\n\t\tconst isValidUpdate = changeInfo.cause === 'explicit' || changeInfo.removed;\n\t\tif (cookie.name === 'jwt' && isValidUpdate) {\n\t\t\tconst cachedUserStatus = getCachedUserStatus();\n\t\t\t// JWT Background: https://wiki.rmn.com/pages/viewpage.action?pageId=58329081\n\t\t\tconst decodedJwt = jwt.decode(cookie.value);\n\t\t\tif (!changeInfo.removed) {\n\t\t\t\tconst userStatus = {\n\t\t\t\t\tisLoggedIn: decodedJwt.preferred_username != null,\n\t\t\t\t\tisVerified: decodedJwt.auth === true,\n\t\t\t\t\tuuid: decodedJwt.sub,\n\t\t\t\t};\n\t\t\t\tif (\n\t\t\t\t\tuserStatus.isLoggedIn !== cachedUserStatus.isLoggedIn ||\n\t\t\t\t\tuserStatus.isVerified !== cachedUserStatus.isVerified\n\t\t\t\t) {\n\t\t\t\t\t// We only mark user state if it changed, because we want to avoid the situation\n\t\t\t\t\t// in which we mark it when the only thing that changed is expiration\n\t\t\t\t\t// (which would be dangerous if the extension ever causes expiration to change)\n\t\t\t\t\tcacheUserStatus(userStatus);\n\t\t\t\t\tawait broadcastUserStatusToAllTabs(userStatus);\n\t\t\t\t}\n\t\t\t} else if (cachedUserStatus.isLoggedIn || cachedUserStatus.isVerified) {\n\t\t\t\t// Cookie removal indicates user logged out\n\t\t\t\tconst userStatus = { isLoggedIn: false, isVerified: false, uuid: null };\n\t\t\t\tcacheUserStatus(userStatus);\n\n\t\t\t\t// Use setTimeout with very small delay to handle specific case\n\t\t\t\t// when user is asked to log in again during navigation to his profile page\n\t\t\t\t// In this case JWT cookie is removed and immediately added\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t// Get up-to-date user status which already might be updated by logic in `if (!changeInfo.removed)`\n\t\t\t\t\tconst freshUserStatus = getCachedUserStatus();\n\t\t\t\t\tif (freshUserStatus.isLoggedIn && freshUserStatus.uuid === decodedJwt.sub) {\n\t\t\t\t\t\t// Caught specific case with re-log in and user is still the same, so no need in further logic\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// Clear all activated CBOs if user logged out to avoid showing activated CBO\n\t\t\t\t\t// when another user will log in with different account for example\n\t\t\t\t\tremoveAllActivatedCbos();\n\t\t\t\t\tbroadcastUserStatusToAllTabs(userStatus);\n\t\t\t\t}, 100);\n\t\t\t}\n\t\t}\n\n\t\t// revert our cookie reset sentinel if we see these cookies get purged\n\t\tif ((cookie.name === 'deviceFingerprint' || cookie.name === 'userQualifier') && changeInfo.removed === true) {\n\t\t\twindow.localStorage.removeItem(OVERLORD_COOKIE_FLAG);\n\t\t}\n\t});\n};\n\n/**\n * @function requestUserStatus - function run on initialization of extension, subsequently we check login\n * via monitoring the cookie space in monitorLoginChange (see above)\n * @member loginTools\n * @return {Promise<Boolean>} promise which resolves to true/false value for users logged in state\n */\nconst requestUserStatus = async () => {\n\tlet isLoggedIn = false;\n\tlet isVerified = false;\n\ttry {\n\t\t// For more regarding Charon HTTP response codes, please visit https://wiki.rmn.com/display/eng/Charon+-+Error+Messages\n\t\tconst response = await fetch(`https://secure.${BASE_DOMAIN}/accounts/api/me/email`, {\n\t\t\tcredentials: 'include',\n\t\t});\n\t\tif (response.ok) {\n\t\t\tif (response.headers.get('Content-Type').includes('text/html')) {\n\t\t\t\tif (Math.random() > 0.5) {\n\t\t\t\t\tconst responseText = (await response.text()).slice(0, 999);\n\t\t\t\t\tgenieReporter.captureMessage('Unexpected Content-Type received from Charon', {\n\t\t\t\t\t\tlevel: 'info',\n\t\t\t\t\t\textra: { responseText },\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst responseJson = await response.json();\n\t\t\t\tisLoggedIn = true;\n\t\t\t\tisVerified = responseJson.data.verified && !!responseJson.data.email;\n\t\t\t}\n\t\t}\n\t} catch (e) {\n\t\tif (e.message !== 'Failed to fetch') {\n\t\t\tgenieReporter.captureException(e, {\n\t\t\t\textra: {\n\t\t\t\t\tloginMonitorAttempt: true,\n\t\t\t\t\tsource: { filePath: 'bg/login.js', method: 'login.requestUserStatus' },\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tisLoggedIn = false;\n\t\tisVerified = false;\n\t}\n\n\tconst userStatus = { isLoggedIn, isVerified };\n\tcacheUserStatus(userStatus);\n\treturn userStatus;\n};\n\nexport {\n\tmonitorLoginChange,\n\tgetCachedUserStatus,\n\tsendUserStatusToTab,\n\tbroadcastUserStatusToAllTabs,\n\trequestUserStatus,\n};\n","import Raven from 'raven-js';\nimport config from '../config';\n\n// See https://github.com/getsentry/sentry-javascript/blob/edd08f9fa4e4c387ed9c3ba2500119c78e67be15/packages/raven-js/src/singleton.js#L36\nconfig.raven.config.release = config.extensionVersion;\n\nconst genieReporter = new Raven.Client();\nconst driversReporter = new Raven.Client();\nconst topDriversReporter = new Raven.Client();\nconst validationIntegrationReporter = new Raven.Client();\n\ngenieReporter.config(config.raven.baseUrl, config.raven.config);\n\ndriversReporter.config(config.raven.driverUrl, config.raven.config);\n\ntopDriversReporter.config(config.raven.topDriverUrl, config.raven.config);\n\nvalidationIntegrationReporter.config(config.raven.validationIntegrationUrl, config.raven.config);\n\nfunction reconfigureCapture(ravenInstance) {\n\tconst oldCaptureException = ravenInstance.captureException;\n\tconst oldCaptureMessage = ravenInstance.captureMessage;\n\n\t/**\n\t * Manually capture an exception and send it over to Sentry and console on the background page\n\t * with adding fingerprints to the capture exception function to ensure that\n\t * errors are bucketed by event and message, and not by URL\n\t *\n\t * @param {error} ex An exception to be logged\n\t * @param {object} options A specific set of options for this error [optional]\n\t * @param {object} options.extra specific settings to pass along for fingerprinting, etc\n\t * @param {boolean} logOnBackground is responsible for whether or not need to show the error message in the background\n\t * @return {Raven}\n\t */\n\travenInstance.captureException = function captureException(ex, options = {}, logOnBackground = true) {\n\t\toptions.extra = options.extra || {};\n\t\tconst extraProperties = Object.getOwnPropertyNames(ex);\n\t\textraProperties.forEach(key => {\n\t\t\tif (key !== 'name' && key !== 'message') {\n\t\t\t\toptions.extra[key] = ex[key];\n\t\t\t}\n\t\t});\n\t\tif (!options.fingerprint) {\n\t\t\toptions.fingerprint = [ex.message];\n\t\t\tif (options.extra.domain) {\n\t\t\t\toptions.fingerprint.push(options.extra.domain);\n\t\t\t}\n\t\t}\n\n\t\t// error from client injected script no need to duplicate in the background\n\t\tif (logOnBackground) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error(ex);\n\t\t}\n\n\t\treturn oldCaptureException.apply(this, [ex, options]);\n\t};\n\n\t/**\n\t * Manually capture a message and send it over to Sentry and console on the background page\n\t *\n\t * @param {string} message A message to be logged\n\t * @param {object} options A specific set of options for this message [optional]\n\t * @param {boolean} logOnBackground is responsible for whether or not need to show the error message in the background\n\t * @return {Raven}\n\t */\n\travenInstance.captureMessage = function captureMessage(message, options = {}, logOnBackground = true) {\n\t\toptions.extra = options.extra || {};\n\t\tif (logOnBackground) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn(message);\n\t\t}\n\t\treturn oldCaptureMessage.apply(this, [message, options]);\n\t};\n}\n\nreconfigureCapture(genieReporter);\nreconfigureCapture(driversReporter);\nreconfigureCapture(topDriversReporter);\nreconfigureCapture(validationIntegrationReporter);\n\nexport { genieReporter, driversReporter, topDriversReporter, validationIntegrationReporter };\n","import uuid from '@rmn/uuid';\nimport { log, browserUtils } from '../utils';\nimport { getParentWindowId } from './pop-up-manager';\nimport config from '../config';\nimport getInstallationUuid from './installation-uuid';\nimport overlordState from './overlord/overlord-state';\nimport { genieReporter } from './monitoring';\nimport abTesting from './ab-testing';\n\nlet _outclickTabId = null;\nlet installedAdBlockers = null;\n\nconst closeWithTimeout = (tabId, tab) => {\n\tsetTimeout(async () => {\n\t\ttry {\n\t\t\tawait browser.tabs.remove(tabId);\n\t\t} catch (e) {\n\t\t\tinstalledAdBlockers = installedAdBlockers || (await browserUtils.lookForInstalledAdBlockers());\n\t\t\tgenieReporter.captureException(new Error('Error trying to remove Macys outclick tab'), {\n\t\t\t\textra: {\n\t\t\t\t\terror: e,\n\t\t\t\t\tsource: { filePath: 'bg/outclick.js', method: 'outclick.tabs.remove' },\n\t\t\t\t\ttabInfo: JSON.stringify(tab),\n\t\t\t\t\tinstalledAdBlockers,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}, 2000);\n};\n\nconst onUpdatedCallback = async (tabId, changeInfo, tab) => {\n\tif (_outclickTabId === tabId && changeInfo.status === 'complete') {\n\t\tif (tab.url && tab.url.includes(`o.${config.site.baseDomain}`)) {\n\t\t\tinstalledAdBlockers = installedAdBlockers || (await browserUtils.lookForInstalledAdBlockers());\n\t\t\tgenieReporter.captureException(new Error('Did not redirect from outclick service'), {\n\t\t\t\textra: {\n\t\t\t\t\toutclickServiceUrl: tab.url,\n\t\t\t\t\tinstalledAdBlockers,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\t_outclickTabId = null;\n\t\ttry {\n\t\t\tif (tab && tab.url.includes('www.macys.com')) {\n\t\t\t\t// Temporary implementation for macys.com see https://jira.rmn.com/browse/EXT-6550\n\t\t\t\tcloseWithTimeout(tabId, tab);\n\t\t\t} else {\n\t\t\t\tawait browser.tabs.remove(tabId);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (!e.message.includes('No tab with id:')) {\n\t\t\t\tinstalledAdBlockers = installedAdBlockers || (await browserUtils.lookForInstalledAdBlockers());\n\t\t\t\tgenieReporter.captureException(e, {\n\t\t\t\t\textra: {\n\t\t\t\t\t\tinstalledAdBlockers,\n\t\t\t\t\t\tsource: { filePath: 'bg/outclick.js', method: 'outclick.tabs.remove' },\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// get active tab and send a notification to the driver about outclick tab close\n\t\tconst activeTabs = await browser.tabs.query({ active: true, currentWindow: true });\n\t\tif (activeTabs[0]) {\n\t\t\t// insurance for devtools being open + focused\n\t\t\tawait browser.tabs.sendMessage(activeTabs[0].id, { tabClosed: true });\n\t\t}\n\t}\n};\nconst onRemovedCallback = async tabId => {\n\t// In case user closed outclick tab manually we should reset `_outclickTabId`\n\t// because `onUpdated` event won't be triggered\n\tif (_outclickTabId === tabId) {\n\t\t_outclickTabId = null;\n\t}\n};\nexport const setUpOutclickListeners = () => {\n\tbrowser.tabs.onUpdated.addListener(onUpdatedCallback);\n\tbrowser.tabs.onRemoved.addListener(onRemovedCallback);\n};\n\nexport const getOutclickURL = async outclickInfo => {\n\tconst outclickHost = `https://o.${config.site.baseDomain}`;\n\tlet encodedExperiments = '';\n\ttry {\n\t\tif (outclickInfo.testVariations) {\n\t\t\tencodedExperiments = encodeURIComponent(JSON.stringify(outclickInfo.testVariations));\n\t\t} else {\n\t\t\tconst installationUuid = await getInstallationUuid();\n\t\t\tconst experiments = await abTesting.getVariations(installationUuid);\n\t\t\tencodedExperiments = encodeURIComponent(JSON.stringify(experiments));\n\t\t}\n\t} catch (e) {\n\t\tinstalledAdBlockers = installedAdBlockers || (await browserUtils.lookForInstalledAdBlockers());\n\t\tgenieReporter.captureException(e, {\n\t\t\textra: {\n\t\t\t\tinstalledAdBlockers,\n\t\t\t\tsource: { filePath: 'bg/outclick.js', method: 'getOutclickURL' },\n\t\t\t},\n\t\t});\n\t}\n\n\t// HOTFIX: outclicks 404 without this datapoint; we place an emergency fallback here\n\tif (!outclickInfo.viewInstanceUuid) {\n\t\tgenieReporter.captureException(new Error('attempt to outclick with no pv uuid - content'), {\n\t\t\textra: { uuid: outclickInfo.uuid },\n\t\t});\n\t\tif (overlordState.currentViewInstanceUuid) {\n\t\t\tObject.assign(outclickInfo, {\n\t\t\t\tviewInstanceUuid: overlordState.currentViewInstanceUuid,\n\t\t\t});\n\t\t} else {\n\t\t\tgenieReporter.captureException(new Error('overlord view instance uuid has become unset'));\n\t\t\tObject.assign(outclickInfo, {\n\t\t\t\tviewInstanceUuid: uuid.randomBase32(),\n\t\t\t});\n\t\t}\n\t}\n\n\tlet url = `${outclickHost}/${outclickInfo.uuid}?pageType=${outclickInfo.pageType}&pageName=${\n\t\toutclickInfo.pageName\n\t}&pv=${outclickInfo.viewInstanceUuid}&utm_medium=genie`;\n\n\t// if there are active campaigns we want to send testing info params\n\tconst testingCampaigns = config.abTesting.activeCampaigns.length;\n\tif (testingCampaigns && encodedExperiments) {\n\t\turl = `${url}&externalExperiments=${encodedExperiments}`;\n\t}\n\n\treturn url;\n};\n\nexport const initiateOutclick = async outclickInfo => {\n\t// Cancel outclick request in case the previous outclick was not completed\n\tif (_outclickTabId !== null) {\n\t\tlog(\"outclick canceled, previous outclick on tabId = %o haven't completed yet\", _outclickTabId);\n\t\treturn;\n\t}\n\tif (process.env.VUE_DEVTOOLS === 'devtools') {\n\t\treturn;\n\t}\n\tlog('outclicking: %o', outclickInfo);\n\tconst url = await getOutclickURL(outclickInfo);\n\tconst createTabOptions = {\n\t\turl,\n\t\tactive: false,\n\t};\n\tconst popUpParentWindowId = getParentWindowId();\n\tif (popUpParentWindowId) {\n\t\tcreateTabOptions.windowId = popUpParentWindowId;\n\t}\n\tconst outclickTab = await browser.tabs.create(createTabOptions);\n\t_outclickTabId = outclickTab.id;\n};\n","const browserInfoUtils = {\n\t/**\n\t * Determine what Browser Family & Version a page is rendered in by performing a series of regex operations\n\t * on the userAgent, appName and appVersion objects. Can not decipher browserFamily & browserVersion 100% of\n\t * the time as not all versions of all browsers follow the same conventions for userAgent strings. However, if\n\t * it does find a match, there is a guarantee for 100% accuracy.\n\t *\n\t * @return\t{Array}\t[browserFamily, browserVersion]\n\t *\n\t */\n\tgetBrowserInfo: function getBrowserInfo() {\n\t\tconst N = window.navigator.appName;\n\n\t\tconst ua = window.navigator.userAgent;\n\n\t\tlet M = this._matchKnownBrowser(ua);\n\n\t\tif (M) {\n\t\t\tconst tem = ua.match(/version\\/([.\\d]+)/i);\n\t\t\tif (tem) {\n\t\t\t\t[, M[2]] = tem;\n\t\t\t}\n\t\t}\n\t\tM = M ? [M[1], M[2]] : [N, window.navigator.appVersion, '-?'];\n\n\t\tthis._msieBrowserSafetyCheck(M);\n\t\tthis._operaBrowserSafetyCheck(M);\n\n\t\t// Safety check for bad browser data\n\t\treturn this._badBrowserSafetyCheck(M);\n\t},\n\t// Adapated from RMN web project\n\t_matchKnownBrowser: function _matchKnownBrowser(ua) {\n\t\tlet M;\n\t\t// Hack for Mac OS X Opera browsers, which don't follow userAgent conventions\n\t\tif (/OPR/.test(ua)) {\n\t\t\tM = ua.match(/(opr|opr)\\/(\\.?\\d+(\\.\\d+)*)/i);\n\t\t} else {\n\t\t\tM = ua.match(/(opera|chrome|safari|firefox|msie|trident)\\/?\\s*(\\.?\\d+(\\.\\d+)*)/i);\n\t\t}\n\t\treturn M;\n\t},\n\t// Adapated from RMN web project\n\t_msieBrowserSafetyCheck: function msieBrowserSafetyCheck(browserInfoArray) {\n\t\tif (window.navigator.appName === 'Microsoft Internet Explorer' && browserInfoArray[0] !== 'MSIE') {\n\t\t\t// Regex failed, manually set browserFamily, ignore browserVersion\n\t\t\tbrowserInfoArray[0] = 'MSIE';\n\t\t\tbrowserInfoArray[1] = null;\n\t\t}\n\t},\n\t// Adapated from RMN web project\n\t_operaBrowserSafetyCheck: function operaBrowserSafetyCheck(browserInfoArray) {\n\t\t// Some versions of opera userAgent strings contain OPR instead of Opera - standardize here\n\t\tif (browserInfoArray[0] === 'OPR') {\n\t\t\tbrowserInfoArray[0] = 'Opera';\n\t\t} else if (window.navigator.appName === 'Opera' && browserInfoArray[0] !== 'Opera') {\n\t\t\t// Regex failed, manually set browserFamily, ignore browserVersion\n\t\t\tbrowserInfoArray[0] = 'Opera';\n\t\t\tbrowserInfoArray[1] = null;\n\t\t}\n\t},\n\t// Adapated from RMN web project\n\t_badBrowserSafetyCheck: function badBrowserSafetyCheck(browserInfoArray) {\n\t\t// If regex returned an unkown browserFamily, ignore data\n\t\treturn browserInfoArray[0].match(/(opera|chrome|safari|firefox|msie|trident)/i)\n\t\t\t? browserInfoArray\n\t\t\t: [null, null];\n\t},\n};\n\nexport default browserInfoUtils;\n","// we use merge vs extend/assign to be safe about nested objects\nimport merge from 'lodash.merge';\nimport uuid from '@rmn/uuid';\nimport overlordJsSdk from '@rmn/overlord-js-sdk';\nimport config from '../../config';\nimport { genieReporter } from '../monitoring';\nimport overlordState from './overlord-state';\nimport getContextBuilder from './context-builder';\nimport getInstallationUuid from '../installation-uuid';\nimport abTesting from '../ab-testing';\nimport { getCachedUserStatus } from '../login';\nimport { log } from '../../utils';\nimport { OVERLORD_COOKIE_FLAG } from '../../consts/storage-keys';\n\nconst EVENT_PLATFORM = 'www';\nconst MAX_OFFLINE_QUEUE_DEPTH = 50;\nconst cookieUuid = uuid.randomBase32();\n\n/**\n * @typedef {Object} overlordFireEventInfo\n * @property {Object} contextOverrides - object with data we need to use to overwrite garbage SDK data\n * @property {String} contextOverrides.viewInstanceUuid - client-passed view instance uuid\n * @property {String} eventType - key for which submethod to invoke\n * @property {Object} eventInfo - actual event-level payload\n */\n\nconst overlordClient = {\n\t_SDK: undefined,\n\tdepthExceededNotificationSent: false,\n\tinit: function _init(sessionId) {\n\t\tconst contextBuilder = getContextBuilder(sessionId);\n\t\tlet analyticsHost = `https://a.${config.site.baseDomain}`;\n\t\tif (BUILD_ENVIRONMENT !== 'production') {\n\t\t\tanalyticsHost = window.localStorage.getItem('overlordHost') || analyticsHost;\n\t\t}\n\t\toverlordClient._SDK = overlordJsSdk({\n\t\t\thost: analyticsHost,\n\t\t\tdoViewPageEvent: false,\n\t\t\teventPlatform: EVENT_PLATFORM,\n\t\t\t// we don't need to be that fast\n\t\t\tcontextBuilder: contextBuilder.build.bind(contextBuilder),\n\t\t});\n\t\treturn this;\n\t},\n\tasync flushEventQueue() {\n\t\t// we have already kicked off a flush\n\t\tif (overlordState.initializing) {\n\t\t\treturn;\n\t\t}\n\t\tawait overlordClient._ensureCookieSpace();\n\t\tawait overlordClient._flushEventQueueHelper();\n\t},\n\tasync _ensureCookieSpace() {\n\t\tif (overlordState.initialized) {\n\t\t\treturn overlordState;\n\t\t}\n\t\t// we register an observer against cookie removal\n\t\t// which is why it is relatively safe to have this set up as a full flag\n\t\tif (window.localStorage && window.localStorage.getItem(OVERLORD_COOKIE_FLAG)) {\n\t\t\toverlordState.initialized = true;\n\t\t\treturn overlordState;\n\t\t}\n\t\toverlordState.initializing = true;\n\t\t/**\n\t\t * We want to ensure the cookiespace is hydrated\n\t\t * as many values are auto-extracted from cookies by the overlord collectors.\n\t\t * Requesting the site ensures the root cookiespace, shared\n\t\t * with the overlord collectors, will be populated correctly\n\t\t */\n\n\t\tconst startedRequestTime = Date.now();\n\t\ttry {\n\t\t\tconst queryParams = `?version=${config.extensionVersion}&uuid=${cookieUuid}`;\n\t\t\tawait fetch(`https://www.${config.site.baseDomain}/genie/-/cookies${queryParams}`, {\n\t\t\t\tcredentials: 'include',\n\t\t\t});\n\t\t\tawait overlordState.markInitialized();\n\t\t} catch (e) {\n\t\t\tconst sendingDuration = (Date.now() - startedRequestTime) / 1000;\n\t\t\t// don't send an error message if sendingDuration is more than 2 minutes, because this means that the user has Internet issues\n\t\t\tif (parseInt(sendingDuration, 10) <= 120) {\n\t\t\t\tgenieReporter.captureMessage('failed to hydrate cookies for overlord', {\n\t\t\t\t\tlevel: 'info',\n\t\t\t\t\textra: {\n\t\t\t\t\t\tmessage: e.message,\n\t\t\t\t\t\tsendingDuration,\n\t\t\t\t\t\tcookiesStatus: window.navigator.cookieEnabled ? 'on' : 'off',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t} finally {\n\t\t\toverlordState.initializing = false;\n\t\t}\n\t\treturn overlordState;\n\t},\n\tasync _flushEventQueueHelper() {\n\t\t/* eslint-disable no-await-in-loop */\n\t\twhile (overlordState.queuedEvents.length > 0) {\n\t\t\tconst eventToFire = overlordState.queuedEvents.shift();\n\t\t\ttry {\n\t\t\t\tawait overlordClient._invokeEventFire(eventToFire);\n\t\t\t} catch (e) {\n\t\t\t\tgenieReporter.captureException(e, {\n\t\t\t\t\textra: { source: { filePath: 'overlord/client.js', method: 'verlordClient._invokeEventFire' } },\n\t\t\t\t});\n\t\t\t\toverlordState.queuedEvents.unshift(eventToFire);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t/* eslint-enable no-await-in-loop */\n\t},\n\t/**\n\t *\n\t * @param {overlordFireEventInfo} overlordFireEventInfo\n\t */\n\tasync fireEvent(eventType, overlordFireEventInfo) {\n\t\toverlordFireEventInfo.eventType = eventType;\n\t\toverlordFireEventInfo.event = overlordFireEventInfo.event || {};\n\t\t// this has a setter that does currect current/previous cycling\n\t\tif (overlordFireEventInfo.context.viewInstanceUuid) {\n\t\t\toverlordState.currentViewInstanceUuid = overlordFireEventInfo.context.viewInstanceUuid;\n\t\t}\n\t\t// so we can assign through on this line\n\t\t// (do right away in case of new events coming in during data fetch in next step)\n\t\toverlordFireEventInfo.context.previousViewInstanceUuid = overlordState.previousViewInstanceUuid;\n\t\tif (overlordState.isOnline && overlordState.initialized) {\n\t\t\toverlordClient._invokeEventFire(overlordFireEventInfo);\n\t\t} else {\n\t\t\toverlordState.queuedEvents.push(overlordFireEventInfo);\n\t\t\tif (overlordState.queuedEvents.length > MAX_OFFLINE_QUEUE_DEPTH) {\n\t\t\t\toverlordState.queuedEvents.shift();\n\t\t\t\tif (!overlordClient.depthExceededNotificationSent) {\n\t\t\t\t\t// done to ensure we don't spam huge sentry counts for repeated violations\n\t\t\t\t\toverlordClient.depthExceededNotificationSent = true;\n\t\t\t\t\tthrow new Error(`analytics queue depth beyond ${MAX_OFFLINE_QUEUE_DEPTH}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t/**\n\t *\n\t * @param {overlordFireEventInfo} eventInfo\n\t */\n\tasync _invokeEventFire(eventInfo) {\n\t\tconst hydratedEventInfo = await overlordClient._hydrateEventInfoWithOverrides(eventInfo);\n\t\tconst fireMethod = overlordClient[`fire${hydratedEventInfo.eventType}`];\n\t\tfireMethod(hydratedEventInfo.context, hydratedEventInfo.event);\n\t},\n\tasync _hydrateEventInfoWithOverrides(overlordFireEventInfo) {\n\t\tconst installationUuid = await getInstallationUuid();\n\t\tconst { event, context } = overlordFireEventInfo;\n\t\t// CONTEXT OVERRIDES\n\t\tcontext.custom = { installationUuid };\n\t\t// add user content\n\t\t// other user content will ride along in the jwt and other cookies if present\n\t\tcontext.loggedInFlag = getCachedUserStatus().isLoggedIn;\n\t\t// slice user if event is coming from the background page\n\t\tif (!context.experiment) {\n\t\t\ttry {\n\t\t\t\tcontext.experiment = await abTesting.getVariations(installationUuid);\n\t\t\t} catch (e) {\n\t\t\t\tgenieReporter.captureException(e, {\n\t\t\t\t\textra: {\n\t\t\t\t\t\tcontent: overlordFireEventInfo.content,\n\t\t\t\t\t\tsource: { source: { filePath: 'overlord/client.js', method: 'abTesting.getVariations' } },\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t// overlord requires this array to be a min length of 1\n\t\tif (context.experiment && context.experiment.length < 1) {\n\t\t\tdelete context.experiment;\n\t\t}\n\n\t\t// EVENT-LEVEL OVERRIDES\n\t\tevent.eventSequence = overlordState.getEventSequenceCount(context.viewInstanceUuid);\n\t\tevent.eventTimestamp = new Date().toISOString();\n\t\tevent.eventPlatformVersion = config.extensionVersion;\n\t\treturn overlordFireEventInfo;\n\t},\n\t// the below wrappers ensure necessary transforms on payload,\n\t// based on generated base SDK payloads\n\tfireClickPage(context, event) {\n\t\toverlordClient._SDK.fire.ClickPage(OWENData => {\n\t\t\tmerge(OWENData.context, context);\n\t\t\tmerge(OWENData.event, event);\n\t\t});\n\t},\n\tfireRenderedImpression(context, event) {\n\t\toverlordClient._SDK.fire.RenderedImpression(OWENData => {\n\t\t\tmerge(OWENData.context, context);\n\t\t\tmerge(OWENData.event, event);\n\t\t});\n\t},\n\tfireViewPrompt(context, event) {\n\t\tlog('firing view prompt');\n\t\toverlordClient._SDK.fire.ViewPrompt(OWENData => {\n\t\t\tmerge(OWENData.context, context);\n\t\t\tmerge(OWENData.event, event);\n\t\t});\n\t},\n\tfireClickPrompt(context, event) {\n\t\toverlordClient._SDK.fire.ClickPrompt(OWENData => {\n\t\t\tmerge(OWENData.context, context);\n\t\t\tmerge(OWENData.event, event);\n\t\t});\n\t},\n\tfireSearch(context, event) {\n\t\toverlordClient._SDK.fire.Search(OWENData => {\n\t\t\tmerge(OWENData.context, context);\n\t\t\tmerge(OWENData.event, event);\n\t\t});\n\t},\n\tfireTestCodes(context, event) {\n\t\toverlordClient._SDK.fireEvent('analytics.common.engage.TestCodes', OWENData => {\n\t\t\tmerge(OWENData.context, context);\n\t\t\tmerge(OWENData.event, event);\n\t\t});\n\t},\n\tfireInstall(context, event) {\n\t\toverlordClient._SDK.fireEvent('analytics.common.engage.ManageExtension', OWENData => {\n\t\t\tmerge(OWENData.context, context);\n\t\t\tmerge(OWENData.event, event);\n\t\t});\n\t},\n};\n\nexport default overlordClient;\n","import browserInfoUtils from './browser-info';\n\nfunction createContextBuilder(session) {\n\tconst contextBuilder = {\n\t\tbuild(context) {\n\t\t\tcontext.session = session;\n\t\t\tcontext.propertyName = 'genie';\n\t\t\t// overkill for chrome, but will be a big PITA later\n\t\t\t// if we don't include the checking now\n\t\t\tconst browserInfo = browserInfoUtils.getBrowserInfo();\n\t\t\t[context.browserFamily, context.browserVersion] = browserInfo;\n\t\t\t// we'll may need to shuttle these?\n\t\t\t// but it'll match the state of the chrome window with focus\n\t\t\t// so not doing that for now\n\t\t\tcontext.screenHeight = window.screen.height;\n\t\t\tcontext.screenWidth = window.screen.width;\n\n\t\t\t// will be replaced upon event send;\n\t\t\t// we don't have a central store rn\n\t\t\tcontext.loggedInFlag = false;\n\t\t\tcontext.userUuid = null;\n\t\t\tcontext.custom = {};\n\t\t\tcontext.custom.installationUuid = '';\n\n\t\t\treturn context;\n\t\t},\n\t};\n\treturn contextBuilder;\n}\n\nexport default createContextBuilder;\n","import client from './client';\nimport state from './overlord-state';\n\nexport default {\n\tclient,\n\tstate,\n};\n","import uuid from '@rmn/uuid';\nimport { QUEUED_OVERLORD_EVENTS, OVERLORD_COOKIE_FLAG } from '../../consts/storage-keys';\nimport { genieReporter } from '../monitoring';\n\n// scope fun via webpack\nlet currentVIU = uuid.randomBase32();\nlet previousVIU = null;\n\nconst stateObj = {\n\t// external to RMN session\n\tsession: '',\n\t/**\n\t * The default value to start a sequence with\n\t */\n\tDEFAULT_SEQUENCE: 0,\n\t/**\n\t * Default Object to start a sequence map with\n\t */\n\tsequences: {},\n\t/**\n\t * Map and increment event sequences for a given viewInstanceUuid.\n\t * @function getEventSequenceCount\n\t * @param {Number} tabId the tabId the viewInstanceUuid is for. This is to make cleanup easier.\n\t * @param  {String} viewInstanceUuid\n\t * @return {Number} The sequence number for the given viewInstanceUuid\n\t */\n\tgetEventSequenceCount(tabId, viewInstanceUuid) {\n\t\tif (typeof stateObj.sequences[tabId] === 'undefined') {\n\t\t\tstateObj.sequences[tabId] = {};\n\t\t}\n\t\tconst tabVIUs = stateObj.sequences[tabId];\n\t\tif (typeof tabVIUs[viewInstanceUuid] === 'undefined') {\n\t\t\ttabVIUs[viewInstanceUuid] = stateObj.DEFAULT_SEQUENCE;\n\t\t} else {\n\t\t\ttabVIUs[viewInstanceUuid] += 1;\n\t\t}\n\t\treturn tabVIUs[viewInstanceUuid];\n\t},\n\tpruneViewInstanceUuids(tabId) {\n\t\t// deleting an absent key is idempotent\n\t\tdelete stateObj.sequences[tabId];\n\t},\n\tqueuedEvents: [],\n\tisOnline: false,\n\tsaveQueuedEvents() {\n\t\ttry {\n\t\t\twindow.localStorage.setItem(QUEUED_OVERLORD_EVENTS, JSON.stringify(this.queuedEvents));\n\t\t} catch (e) {\n\t\t\tgenieReporter.captureException(e, {\n\t\t\t\textra: { source: { filePath: 'overlord/overlord-state.js', method: 'saveQueuedEvents' } },\n\t\t\t});\n\t\t}\n\t},\n\tmarkInitialized() {\n\t\tthis.initialized = true;\n\t\ttry {\n\t\t\twindow.localStorage.setItem(OVERLORD_COOKIE_FLAG, Date.now());\n\t\t} catch (e) {\n\t\t\tgenieReporter.captureException(e, {\n\t\t\t\textra: { source: { filePath: 'overlord/overlord-state.js', method: 'markInitialized' } },\n\t\t\t});\n\t\t}\n\t},\n};\n\ntry {\n\tconst existingEvents = window.localStorage.getItem(QUEUED_OVERLORD_EVENTS);\n\tif (existingEvents) {\n\t\tstateObj.queuedEvents = JSON.parse(existingEvents);\n\t}\n} catch (e) {\n\tgenieReporter.captureException(e, {\n\t\textra: { source: { filePath: 'overlord/overlord-state.js', method: 'window.localStorage.getItem' }, stateObj },\n\t});\n}\n\nObject.defineProperty(stateObj, 'currentViewInstanceUuid', {\n\tget() {\n\t\treturn currentVIU;\n\t},\n\tset(newVIU) {\n\t\tif (newVIU !== currentVIU) {\n\t\t\tpreviousVIU = currentVIU;\n\t\t\tcurrentVIU = newVIU;\n\t\t}\n\t},\n});\nObject.defineProperty(stateObj, 'previousViewInstanceUuid', {\n\tget() {\n\t\treturn previousVIU;\n\t},\n});\n\nexport default stateObj;\n","import { asyncUtils } from '../utils';\nimport { genieReporter } from './monitoring';\nimport config from '../config';\n\nconst BASE_DOMAIN = config.site.baseDomain;\n\nconst { asyncForEachExecutedInParallel } = asyncUtils;\n\nconst checkRmnDomainPermissions = () =>\n\tbrowser.permissions.contains({\n\t\torigins: [`https://secure.${BASE_DOMAIN}/`, `https://www.${BASE_DOMAIN}/`],\n\t});\nconst checkAllUrlsPermissions = () =>\n\tbrowser.permissions.contains({\n\t\torigins: [`<all_urls>`],\n\t});\nconst getExtensionPermissions = () =>\n\tPromise.all([checkAllUrlsPermissions(), checkRmnDomainPermissions()])\n\t\t.then(perms => ({\n\t\t\tall: perms[0],\n\t\t\trmn: perms[1],\n\t\t}))\n\t\t.catch(e => {\n\t\t\tgenieReporter.captureException(e, {\n\t\t\t\textra: { source: { filePath: 'bg/permissions.js', method: 'getExtensionPermissions' } },\n\t\t\t});\n\t\t\t// we don't want to erroneously ask for permissions\n\t\t\treturn {\n\t\t\t\tall: true,\n\t\t\t\trmn: true,\n\t\t\t};\n\t\t});\nconst sendPermissionsToTab = async (tabId, permissions) =>\n\tbrowser.tabs.sendMessage(tabId, { instruction: 'permissionsChanged', permissions });\nconst monitorPermissionsChanges = () => {\n\t// Firefox doesn't expose this API so we can't listen for permissions changes\n\tif (chrome.permissions.onRemoved) {\n\t\tchrome.permissions.onRemoved.addListener(async () => {\n\t\t\tconst tabs = await browser.tabs.query({});\n\t\t\tconst permissions = await getExtensionPermissions();\n\t\t\tawait asyncForEachExecutedInParallel(tabs.map(tab => tab.id), sendPermissionsToTab, permissions);\n\t\t});\n\t}\n};\n\nexport { checkRmnDomainPermissions, checkAllUrlsPermissions, getExtensionPermissions, monitorPermissionsChanges };\n","import { log, asyncUtils } from '../utils';\nimport { getExtensionPermissions } from './permissions';\nimport { requestUserStatus, sendUserStatusToTab } from './login';\nimport { POP_UP_TYPES } from '../consts';\nimport config from '../config';\n\nconst { asyncForEachExecutedInParallel } = asyncUtils;\n\nlet _popUpId;\nlet _parentTabs = [];\nlet _areListenersInstantiated = false;\n\nconst _getPopUpHeight = type => {\n\tswitch (type) {\n\t\tcase POP_UP_TYPES.LOGIN:\n\t\t\treturn 760;\n\t\tcase POP_UP_TYPES.SIGN_UP:\n\t\t\treturn 870;\n\t\tcase POP_UP_TYPES.VERIFY:\n\t\t\treturn 630;\n\t\tdefault:\n\t\t\tthrow new Error('Unsupported Pop Up Type');\n\t}\n};\nconst _getPopUpUrl = type => {\n\tlet route = '';\n\tswitch (type) {\n\t\tcase POP_UP_TYPES.LOGIN:\n\t\t\troute = 'login';\n\t\t\tbreak;\n\t\tcase POP_UP_TYPES.SIGN_UP:\n\t\t\troute = 'register';\n\t\t\tbreak;\n\t\tcase POP_UP_TYPES.VERIFY:\n\t\t\troute = 'verify';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error('Unsupported Pop Up Type');\n\t}\n\tconst { baseDomain } = config.site;\n\tconst returnLink = encodeURIComponent(`https://www.${baseDomain}/genie/login`);\n\treturn `https://secure.${baseDomain}/accounts/${route}?returnTo=${returnLink}&ctx=cbo`;\n};\n\nexport const getParentWindowId = () => _popUpId && _parentTabs[0].windowId;\n\nexport const openPopUp = async popUpType => {\n\t// avoid registering listeners over and over and over\n\tif (!_areListenersInstantiated) {\n\t\t_setUpListeners();\n\t}\n\t// gets the window info\n\tconst parentWindow = await browser.windows.getLastFocused();\n\n\t// gets the tab info\n\tconst [parentTab] = await browser.tabs.query({ windowId: parentWindow.id, active: true });\n\t_parentTabs.unshift(parentTab);\n\n\tconst popUpHeight = _getPopUpHeight(popUpType);\n\tconst popUpWidth = 470;\n\t// calculates centered pop up position based on last focused window\n\t// Math.round because create function only accepts whole numbers\n\tconst top = parentWindow.top + Math.round((parentWindow.height - popUpHeight) / 2);\n\tconst left = parentWindow.left + Math.round((parentWindow.width - popUpWidth) / 2);\n\n\tconst newPopUp = await browser.windows.create({\n\t\ttype: 'popup',\n\t\turl: _getPopUpUrl(popUpType),\n\t\twidth: popUpWidth,\n\t\theight: popUpHeight,\n\t\ttop,\n\t\tleft,\n\t});\n\tif (_popUpId) {\n\t\t// if there was a payment pop up that wasn't closed\n\t\t// we want to remove it since are creating another\n\t\tbrowser.windows.remove(_popUpId);\n\t}\n\t_popUpId = newPopUp.id;\n};\n\nexport const focusPopUp = async () => {\n\tif (_popUpId) {\n\t\tawait browser.windows.update(_popUpId, { focused: true });\n\t}\n};\n\nexport const closePopUp = async () => {\n\tif (_popUpId) {\n\t\tawait browser.windows.remove(_popUpId);\n\t}\n};\n\nfunction _setUpListeners() {\n\tbrowser.windows.onRemoved.addListener(async removedId => {\n\t\t// ensures that when the parent window closes\n\t\t// the pop up will also close\n\t\tif (_popUpId && _parentTabs.map(tab => tab.windowId).includes(removedId)) {\n\t\t\t_parentTabs = _parentTabs.filter(tab => tab.windowId !== removedId);\n\t\t\tif (_parentTabs.length === 0) {\n\t\t\t\tbrowser.windows.remove(_popUpId);\n\t\t\t}\n\t\t} else if (removedId === _popUpId) {\n\t\t\ttry {\n\t\t\t\tlog('pop up closed');\n\n\t\t\t\tif (!(await getExtensionPermissions()).rmn) {\n\t\t\t\t\tconst userStatus = await requestUserStatus();\n\t\t\t\t\tawait asyncForEachExecutedInParallel(\n\t\t\t\t\t\t_parentTabs.map(tab => tab.id),\n\t\t\t\t\t\tsendUserStatusToTab,\n\t\t\t\t\t\tuserStatus,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tasyncForEachExecutedInParallel(_parentTabs.map(tab => tab.id), async tabId =>\n\t\t\t\t\tbrowser.tabs.sendMessage(tabId, { instruction: 'popUpClosed' }),\n\t\t\t\t);\n\t\t\t} finally {\n\t\t\t\t_popUpId = undefined;\n\t\t\t\t_parentTabs = [];\n\t\t\t}\n\t\t}\n\t});\n\n\t// ensures that when the parent tab closes\n\t// the pop up will also close\n\tbrowser.tabs.onRemoved.addListener(removedId => {\n\t\tif (_popUpId && _parentTabs.map(tab => tab.id).includes(removedId)) {\n\t\t\t_parentTabs = _parentTabs.filter(tab => tab.id !== removedId);\n\t\t\tif (_parentTabs.length === 0) {\n\t\t\t\tbrowser.windows.remove(_popUpId);\n\t\t\t}\n\t\t}\n\t});\n\n\t// ensures that when the user navigates to a different url\n\t// or reloads inside the parent tab, the pop up will close\n\tbrowser.tabs.onUpdated.addListener((updatedId, info) => {\n\t\tif (_popUpId && _parentTabs.map(tab => tab.id).includes(updatedId)) {\n\t\t\t// the info.url property will only be present in the event\n\t\t\t// that the tab url changes\n\t\t\t// status \"loading\" indicates the tab was reloaded\n\t\t\t// and should also close the pop up\n\t\t\tif (info.url || info.status === 'loading') {\n\t\t\t\t_parentTabs = _parentTabs.filter(tab => tab.id !== updatedId);\n\t\t\t\tif (_parentTabs.length === 0) {\n\t\t\t\t\tbrowser.windows.remove(_popUpId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\t// ensures pop up will refocus when user\n\t// navigates back to parent tab\n\tbrowser.tabs.onActivated.addListener(({ tabId }) => {\n\t\tif (_popUpId && _parentTabs.map(tab => tab.id).includes(tabId)) {\n\t\t\tfocusPopUp();\n\t\t}\n\t});\n\t_areListenersInstantiated = true;\n}\n","import overlordState from './overlord/overlord-state';\nimport { genieReporter } from './monitoring';\nimport EVENTS from '../consts/events';\n\n// https://sentry.io/retailmenot/genie-extension/issues/522332258/?query=is:unresolved%20failed%20to%20fetch\nconst CHROME_ERROR_REGEX = /Failed to fetch/;\n// https://sentry.io/retailmenot/genie-extension/issues/523788984/?query=is:unresolved\nconst FF_ERROR_REGEX = /NetworkError when attempting to fetch resource/;\n\nconst RETRY_REPEAT_ERROR_SEND_THRESHOLD = 40;\nconst ONLINE_RETRY_TIMEOUT_BASE = 500;\n\nconst readinessTools = {\n\twatchingOnline: false,\n\tretryCount: 0,\n\tretryInterval: ONLINE_RETRY_TIMEOUT_BASE,\n\tretryErrorSent: false,\n\tasync _onlineMonitor() {\n\t\tif (overlordState.isOnline && !readinessTools.watchingOnline) {\n\t\t\treturn;\n\t\t}\n\t\treadinessTools.retryCount += 1;\n\t\treadinessTools.retryInterval =\n\t\t\tONLINE_RETRY_TIMEOUT_BASE * Math.min(readinessTools.retryCount, RETRY_REPEAT_ERROR_SEND_THRESHOLD);\n\t\tif (!navigator.onLine) {\n\t\t\tsetTimeout(readinessTools._onlineMonitor, readinessTools.retryInterval);\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tconst cookieStores = await browser.cookies.getAllCookieStores();\n\t\t\tif (cookieStores.length > 0) {\n\t\t\t\t// TODO: chat with core team about best choice for semaphor route\n\t\t\t\t// if necessary, use ping endpoint on genie server?\n\t\t\t\tfetch('https://d1deqen6vzxvqh.cloudfront.net/assets/images/__test.gif', {\n\t\t\t\t\tmode: 'no-cors',\n\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tdocument.dispatchEvent(new CustomEvent(EVENTS.NETWORK.ONLINE));\n\t\t\t\t\t\toverlordState.isOnline = true;\n\t\t\t\t\t\treadinessTools.watchingOnline = false;\n\t\t\t\t\t\treadinessTools.retryCount = 0;\n\t\t\t\t\t\treadinessTools.retryErrorSent = false;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(e => {\n\t\t\t\t\t\tsetTimeout(readinessTools._onlineMonitor, readinessTools.retryInterval);\n\t\t\t\t\t\tif (!CHROME_ERROR_REGEX.test(e.message) && !FF_ERROR_REGEX.test(e.message)) {\n\t\t\t\t\t\t\tgenieReporter.captureException(e, {\n\t\t\t\t\t\t\t\textra: {\n\t\t\t\t\t\t\t\t\tsource: { filePath: 'bg/readiness-monitor.js', method: 'readiness._onlineMonitor' },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!readinessTools.retryErrorSent &&\n\t\t\t\t\t\t\treadinessTools.retryCount > RETRY_REPEAT_ERROR_SEND_THRESHOLD\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tgenieReporter.captureException(\n\t\t\t\t\t\t\t\tnew Error(`readiness check retries exceeded ${RETRY_REPEAT_ERROR_SEND_THRESHOLD}`),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treadinessTools.retryErrorSent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsetTimeout(readinessTools._onlineMonitor, readinessTools.retryInterval);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tsetTimeout(readinessTools._onlineMonitor, readinessTools.retryInterval);\n\t\t}\n\t},\n\t_offlineMonitor() {\n\t\tdocument.dispatchEvent(new CustomEvent(EVENTS.NETWORK.OFFLINE));\n\t\toverlordState.isOnline = false;\n\t\tif (!readinessTools.watchingOnline) {\n\t\t\treadinessTools.watchingOnline = true;\n\t\t\treadinessTools.retryCount = 0;\n\t\t\treadinessTools._onlineMonitor();\n\t\t}\n\t},\n\t_suspendMonitor() {\n\t\toverlordState.saveQueuedEvents();\n\t},\n\tinit() {\n\t\treadinessTools.watchingOnline = true;\n\t\treadinessTools._onlineMonitor();\n\t\twindow.onoffline = readinessTools._offlineMonitor;\n\t},\n};\n\nexport default readinessTools;\n","import cashbackApi from './cashback-api';\nimport standDown from './stand-down';\nimport { log, browserUtils, webRequest } from '../utils';\n\nconst requestMonitor = {\n\tredirectTrace: [],\n\t_baseWhitelist: new Set([\n\t\t'o.retailmenot.com',\n\t\t'www.retailmenot.com',\n\t\t'www.rmnstage.com',\n\t\t'www.rmntest.com',\n\t\t'm.retailmenot.com',\n\t\t'o.rmn.com',\n\t\t'o.rmnstage.com',\n\t\t'o.rmntest.com',\n\t]),\n\t_CJandLinkshareDomains: new Set([\n\t\t// CJ domains via Poulpeo extension\n\t\t'www.anrdoezrs.net',\n\t\t'www.commission-junction.com',\n\t\t'www.dpbolvw.net',\n\t\t'www.apmebf.com',\n\t\t'www.jdoqocy.com',\n\t\t'www.kqzyfj.com',\n\t\t'www.qksrv.net',\n\t\t'www.tkqlhce.com',\n\t\t'www.qksz.net',\n\t\t'www.emjcd.com',\n\t\t'www.afcyhf.com',\n\t\t'www.awltovhc.com',\n\t\t'www.ftjcfx.com',\n\t\t'www.lduhtrp.net',\n\t\t'www.tqlkg.com',\n\t\t'www.awxibrm.com',\n\t\t'www.cualbr.com',\n\t\t'www.rnsfpw.net',\n\t\t'www.vofzpwh.com',\n\t\t'www.yceml.net',\n\t\t'cj.dotomi.com',\n\t\t'cj.mplxtms.com',\n\t\t// Linkshare domains\n\t\t'affiliate.rakuten.com',\n\t\t'click.linksynergy.com',\n\t]),\n\t_affiliateDomains: new Set([\n\t\t// affiliate_window\n\t\t'www.awin1.com',\n\t\t// affiliatefuture\n\t\t'scripts.affiliatefuture.com',\n\t\t// avantLink\n\t\t'www.avantlink.com',\n\t\t'www.avantlink.ca',\n\t\t// clixgalore\n\t\t'www.clixGalore.com',\n\t\t// kolimbo\n\t\t'www.sevenly.org',\n\t\t// linkconnector\n\t\t'www.linkconnector.com',\n\t\t// onenetworkdirect\n\t\t'send.onenetworkdirect.net',\n\t\t// paidonresults\n\t\t'www.paidonresults.net',\n\t\t// pepperjam\n\t\t'www.pntra.com',\n\t\t'www.pntrac.com',\n\t\t'www.pjatr.com',\n\t\t'www.gopjn.com',\n\t\t'www.pjtra.com',\n\t\t'www.pntrs.com',\n\t\t// performancehorizon\n\t\t'prf.hn',\n\t\t// shareasale\n\t\t'shareasale.com',\n\t\t'www.shareasale.com',\n\t\t// webgains\n\t\t'track.webgains.com',\n\t\t// impactradius\n\t\t'partners.hostgator.com', //\n\t\t'partners.hotwire.com',\n\t\t'affiliates.abebooks.com',\n\t\t'linkto.hrblock.com', //\n\t\t'goto.carters.com',\n\t\t'vip.silpada.com', //\n\t\t'go.gemvara.com', //\n\t\t'go.jewelry.com', //\n\t\t'partners.wantable.co', //\n\t\t'hpn.houzz.com', //\n\t\t'goto.shopspring.com', //\n\t\t'tracking.hddn.com', //\n\t\t'goto.target.com',\n\t]),\n\t_impactradiusDomains: new Set([\n\t\t'evyy', // evyy.net\n\t\t'pxf', // pxf.io\n\t\t'sjv', // sjv.io\n\t\t'7eer', // 7eer.net\n\t\t'ojrq', // ojrq.net\n\t\t'uikc', // uikc.net\n\t\t'uqhv', // uqhv.net\n\t]),\n\t_redirectStatuses: [\n\t\t301, // impact radius uses 301 redirects\n\t\t302,\n\t\t307,\n\t],\n\t_redirectListener(details) {\n\t\tconst standardizedDetails = webRequest.standardizedOnBeforeRequest(details);\n\t\tif (this._redirectStatuses.includes(standardizedDetails.statusCode)) {\n\t\t\tif (this.redirectTrace.length >= 15) {\n\t\t\t\tthis.redirectTrace.shift();\n\t\t\t}\n\t\t\tstandardizedDetails.hostname = this._parseHostname(standardizedDetails.url);\n\t\t\tthis.redirectTrace.push(standardizedDetails);\n\t\t}\n\t},\n\t_isCJorLinkshareAffiliate(details) {\n\t\tconst url = details.url || details.target.url || '';\n\t\treturn (\n\t\t\tthis._CJandLinkshareDomains.has(details.hostname) ||\n\t\t\tdetails.hostname.includes('linksynergy') ||\n\t\t\turl.includes('afsrc=1')\n\t\t);\n\t},\n\t_isOtherAffiliate(details) {\n\t\tif (this._affiliateDomains.has(details.hostname)) {\n\t\t\treturn true;\n\t\t}\n\t\t// for impactradius domains\n\t\t// ex: '<merchant>.7eer.net'\n\t\tconst splitHostname = details.hostname.split('.');\n\t\tconst keyWord = splitHostname[splitHostname.length - 2] || '';\n\t\tif (this._impactradiusDomains.has(keyWord)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\t_isPaypalExpressCheckoutCallback(details) {\n\t\t// https://developer.paypal.com/docs/classic/express-checkout/ec_initiate_payment/\n\t\ttry {\n\t\t\tconst url = new URL(details.url);\n\t\t\tconst tokenValue = url.searchParams.get('token');\n\t\t\treturn tokenValue && tokenValue.indexOf('EC-') !== -1;\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\t},\n\t_shouldIgnorePriorRedirects(details) {\n\t\treturn this._isPaypalExpressCheckoutCallback(details);\n\t},\n\t_shouldIncludeRedirect(standardizedDetails, redirect) {\n\t\tlet shouldInclude = false;\n\t\tif (\n\t\t\tredirect.requestId === standardizedDetails.requestId ||\n\t\t\t(standardizedDetails.initiator && standardizedDetails.initiator === redirect.initiator)\n\t\t) {\n\t\t\t// Include redirect that are from different hosts to the final host\n\t\t\t// OR any redirect that explicit marks itself as being from an affiliate source\n\t\t\t// as we are required to respect that parameter generally\n\t\t\tconst isNewHostname =\n\t\t\t\tbrowserUtils.domainFromHostname(redirect.hostname) !==\n\t\t\t\tbrowserUtils.domainFromHostname(standardizedDetails.hostname);\n\t\t\tconst includesAffiliateParameter = redirect.url && redirect.url.includes('afsrc=1');\n\t\t\tshouldInclude = isNewHostname || includesAffiliateParameter;\n\t\t} else if (\n\t\t\tthis._previousCompletion &&\n\t\t\tthis._previousCompletion.hostname &&\n\t\t\tbrowserUtils.domainFromHostname(this._previousCompletion.hostname) !==\n\t\t\t\tbrowserUtils.domainFromHostname(standardizedDetails.hostname)\n\t\t) {\n\t\t\t// Handle the case of a client-side redirect such as flamingoworld.com -> newegg.com\n\t\t\t// In these cases, we see a 200 in the middle of the redirect chain, so we compare each redirect hostname to the previously completed request's initiator\n\t\t\t// For ex. flamingoworld.com 302-> go.redirectingto.com 200. go.redirectingto.com 307->newegg.com\n\t\t\t// https://developer.chrome.com/extensions/webRequest#event-onCompleted for info on initiator\n\t\t\tshouldInclude =\n\t\t\t\tthis._previousCompletion &&\n\t\t\t\tthis._previousCompletion.initiator &&\n\t\t\t\tbrowserUtils.domainFromHostname(redirect.hostname) ===\n\t\t\t\t\tbrowserUtils.domainFromHostname(this._previousCompletion.initiator);\n\t\t}\n\t\treturn shouldInclude;\n\t},\n\t_completionListener(details) {\n\t\tconst standardizedDetails = webRequest.standardizedOnCompleted(details);\n\t\tif (this._shouldIgnorePriorRedirects(standardizedDetails)) {\n\t\t\treturn;\n\t\t}\n\t\tstandardizedDetails.hostname = this._parseHostname(standardizedDetails.url);\n\t\twindow.completionDetails = details;\n\t\tconst priorRedirects = this.redirectTrace.filter(redirect =>\n\t\t\tthis._shouldIncludeRedirect(standardizedDetails, redirect),\n\t\t);\n\n\t\tif (standardizedDetails.statusCode === 200) {\n\t\t\t// Keeping track of the previously completed request in the case of redirects that are broken up by a 200.\n\t\t\t// Ex. flamingoworld.com affiliate gets credit for flamingoworld.com 302-> go.redirectingto.com 200. go.redirectingto.com 307->newegg.com\n\t\t\tthis._previousCompletion = standardizedDetails;\n\t\t}\n\n\t\tif (priorRedirects.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst redirectStats = priorRedirects.reduce(\n\t\t\t(redirInfo, redirect) => {\n\t\t\t\tconst redirectInitiator =\n\t\t\t\t\tredirect.initiator && redirect.initiator.replace('https://', '').split('/')[0];\n\t\t\t\tif (this._baseWhitelist.has(redirect.hostname) || this._baseWhitelist.has(redirectInitiator)) {\n\t\t\t\t\tredirInfo.rmnRedirects += 1;\n\t\t\t\t} else if (\n\t\t\t\t\tthis._isCJorLinkshareAffiliate(redirect) ||\n\t\t\t\t\t// again we consider the case of the 200 in the middle of redirects\n\t\t\t\t\t(redirect.initiator &&\n\t\t\t\t\t\tthis._previousCompletion &&\n\t\t\t\t\t\tthis._isCJorLinkshareAffiliate(this._previousCompletion) &&\n\t\t\t\t\t\tthis._previousCompletion.hostname &&\n\t\t\t\t\t\tbrowser.domainFromHostname(redirect.initiator) ===\n\t\t\t\t\t\t\tbrowser.domainFromHostname(this._previousCompletion.hostname))\n\t\t\t\t) {\n\t\t\t\t\tredirInfo.CJorLinkshareAffiliateRedirects += 1;\n\t\t\t\t} else if (\n\t\t\t\t\tthis._isOtherAffiliate(redirect) ||\n\t\t\t\t\t// again we consider the case of the 200 in the middle of redirects\n\t\t\t\t\t(redirect.initiator &&\n\t\t\t\t\t\tthis._previousCompletion &&\n\t\t\t\t\t\tthis._isOtherAffiliate(this._previousCompletion) &&\n\t\t\t\t\t\tthis._previousCompletion.hostname &&\n\t\t\t\t\t\tbrowser.domainFromHostname(redirect.initiator) ===\n\t\t\t\t\t\t\tbrowser.domainFromHostname(this._previousCompletion.hostname))\n\t\t\t\t) {\n\t\t\t\t\tredirInfo.otherAffiliateRedirects += 1;\n\t\t\t\t}\n\t\t\t\treturn redirInfo;\n\t\t\t},\n\t\t\t{\n\t\t\t\trmnRedirects: 0,\n\t\t\t\tCJorLinkshareAffiliateRedirects: 0,\n\t\t\t\totherAffiliateRedirects: 0,\n\t\t\t},\n\t\t);\n\t\tlog(`completion listener for: ${standardizedDetails.hostname}`);\n\t\tlog(redirectStats);\n\t\tif (redirectStats.rmnRedirects > 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst potentialDeactivationsTotal =\n\t\t\tredirectStats.otherAffiliateRedirects + redirectStats.CJorLinkshareAffiliateRedirects;\n\t\tif (potentialDeactivationsTotal > 0) {\n\t\t\tcashbackApi.handlePotentialDeactivationNotice(standardizedDetails.hostname);\n\t\t}\n\t\t// cj and linkshare affiliates require a stand down\n\t\tif (redirectStats.CJorLinkshareAffiliateRedirects > 0) {\n\t\t\tstandDown.set(standardizedDetails.hostname);\n\t\t}\n\t},\n\tsetUpListeners() {\n\t\t// TODO: remove; here for easy debug\n\t\twindow.redirectTrace = this.redirectTrace;\n\t\tchrome.webRequest.onBeforeRedirect.addListener(this._redirectListener.bind(this), {\n\t\t\turls: ['<all_urls>'],\n\t\t\ttypes: ['main_frame'],\n\t\t});\n\t\tchrome.webRequest.onCompleted.addListener(this._completionListener.bind(this), {\n\t\t\turls: ['<all_urls>'],\n\t\t\ttypes: ['main_frame'],\n\t\t});\n\t},\n\t// TODO: does this belong elsewhere?\n\t_parseHostname(url) {\n\t\t// believe we are safe on gc here, but something to monitor\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\treturn a.hostname;\n\t},\n};\nwindow.requestMonitor = requestMonitor;\n\nexport default requestMonitor;\n","import { log, browserUtils } from '../utils';\nimport { markStandDown } from './storage-access';\n\nexport default {\n\tset: function set(hostname) {\n\t\tconst domain = browserUtils.domainFromHostname(hostname);\n\t\tlog('adding stand-down entry: %s', domain);\n\t\t// tell the extension that it should not display on the merchant page\n\t\tmarkStandDown(browserUtils.domainFromHostname(domain));\n\t\tchrome.tabs.query(\n\t\t\t{\n\t\t\t\turl: [`*://${domain}/*`, `*://*.${domain}/*`],\n\t\t\t},\n\t\t\ttabs => {\n\t\t\t\ttabs.forEach(tab => {\n\t\t\t\t\tchrome.tabs.sendMessage(tab.id, {\n\t\t\t\t\t\tinstruction: 'standDown',\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t},\n};\n","import { genieReporter } from './monitoring';\nimport { STORAGE_KEYS, MILLISECONDS } from '../consts';\n\n/**\n * We make heavy use of computed property names in this file\n * This is supported in Chrome 47+, FF 34+\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Object_initializer\n */\n\nexport const getKeyFromStorage = async key => {\n\ttry {\n\t\tconst results = await browser.storage.local.get(key);\n\t\treturn Array.isArray(key) ? results : results[key];\n\t} catch (e) {\n\t\tconst err = e instanceof Error ? e : new Error(e);\n\t\tgenieReporter.captureException(err, {\n\t\t\textra: { source: { filePath: 'bg/storage-access.js', method: 'getKeyFromStorage', key } },\n\t\t});\n\t\treturn null;\n\t}\n};\nexport const setStorageValue = async dictionary => {\n\ttry {\n\t\tawait browser.storage.local.set(dictionary);\n\t} catch (e) {\n\t\tconst err = e instanceof Error ? e : new Error(e);\n\t\tgenieReporter.captureException(err, {\n\t\t\textra: {\n\t\t\t\tsource: { filePath: 'bg/storage-access.js', method: 'storage-access.setStorageValue' },\n\t\t\t\tdictionary,\n\t\t\t},\n\t\t});\n\t}\n};\n\nexport const getRebateActivationEndpointOverride = () =>\n\tgetKeyFromStorage(STORAGE_KEYS.OVERRIDES.REBATE_ACTIVATION_ENDPOINT);\nexport const getDataStoreIndexOverride = () => getKeyFromStorage(STORAGE_KEYS.OVERRIDES.DATA_STORE_INDEX);\nexport const getDataStoreApiKeyOverride = () => getKeyFromStorage(STORAGE_KEYS.OVERRIDES.DATA_STORE_API_KEY);\n\nexport const shouldDisplaySurvey = async () => {\n\tconst testCodesCount = (await getKeyFromStorage(STORAGE_KEYS.NUMBER_OF_TIMES_CHECKED_CODES)) || 0;\n\tconst lastCodeTestingStatus = (await getKeyFromStorage(STORAGE_KEYS.LAST_CODE_TESTING_STATUS)) || false;\n\tif (testCodesCount <= 3 || !lastCodeTestingStatus) {\n\t\treturn false;\n\t}\n\treturn !(await getKeyFromStorage(STORAGE_KEYS.HAS_SEEN_GENIE_SURVEY));\n};\nexport const markSurveySeen = () => setStorageValue({ [STORAGE_KEYS.HAS_SEEN_GENIE_SURVEY]: true });\n\nexport const setDomainTimestamp = async (key, domain, timestamp) => {\n\tconst domainLevelTimestamps = (await getKeyFromStorage(key)) || {};\n\tdomainLevelTimestamps[domain] = timestamp;\n\treturn setStorageValue({ [key]: domainLevelTimestamps });\n};\nexport const hasRecentDomainTimestamp = async (key, domain, expirationTime) => {\n\tconst domainLevelTimestamps = (await getKeyFromStorage(key)) || {};\n\tconst domainLevelTimestamp = domainLevelTimestamps[domain] || 0;\n\treturn domainLevelTimestamp + expirationTime >= Date.now();\n};\n\nexport const markCboPromptDisplayed = (domain, timestamp) =>\n\tsetDomainTimestamp(STORAGE_KEYS.DISPLAYED_CBO_PROMPTS, domain, timestamp);\nexport const shouldDisplayCboPrompt = async domain => {\n\treturn !(await hasRecentDomainTimestamp(STORAGE_KEYS.DISPLAYED_CBO_PROMPTS, domain, MILLISECONDS.DAY));\n};\nexport const markCartPromptDisplayed = (domain, timestamp) =>\n\tsetDomainTimestamp(STORAGE_KEYS.DISPLAYED_CART_PROMPTS, domain, timestamp);\nexport const shouldDisplayCartPrompt = async domain => {\n\treturn !(await hasRecentDomainTimestamp(STORAGE_KEYS.DISPLAYED_CART_PROMPTS, domain, MILLISECONDS.MINUTE * 20));\n};\n\nexport const markRxSaverPromptDisplayed = (domain, timestamp) =>\n\tsetDomainTimestamp(STORAGE_KEYS.DISPLAYED_RXSAVER_PROMPTS, domain, timestamp);\nexport const shouldDisplayRxSaverPrompt = async domain => {\n\treturn !(await hasRecentDomainTimestamp(STORAGE_KEYS.DISPLAYED_RXSAVER_PROMPTS, domain, MILLISECONDS.MINUTE * 20));\n};\n\nexport const getRecentlyDisplayedAmazonCboPrompts = async () => {\n\tconst displayedAmazonCboPrompts = (await getKeyFromStorage(STORAGE_KEYS.DISPLAYED_AMAZON_CBO_PROMPTS)) || {};\n\treturn Object.values(displayedAmazonCboPrompts).reduce((displayedPrompts, [cboUuid, timestamp]) => {\n\t\tif (timestamp + MILLISECONDS.DAY >= Date.now()) {\n\t\t\tdisplayedPrompts.add(cboUuid);\n\t\t}\n\t\treturn displayedPrompts;\n\t}, new Set());\n};\nexport const markAmazonCboPromptDisplayed = async (cboUuid, displayedAt) => {\n\tconst displayedAmazonCboPrompts = await getKeyFromStorage(STORAGE_KEYS.DISPLAYED_AMAZON_CBO_PROMPTS);\n\tdisplayedAmazonCboPrompts[cboUuid] = displayedAt;\n\treturn setStorageValue(STORAGE_KEYS.DISPLAYED_AMAZON_CBO_PROMPTS, displayedAmazonCboPrompts);\n};\n\nexport const markCodeCheckingComplete = async (domain, timestamp) => {\n\tawait setDomainTimestamp(STORAGE_KEYS.CODES_LAST_CHECKED, domain, timestamp);\n\tconst codeCheckCount = (await getKeyFromStorage(STORAGE_KEYS.NUMBER_OF_TIMES_CHECKED_CODES)) || 0;\n\tawait setStorageValue({ [STORAGE_KEYS.NUMBER_OF_TIMES_CHECKED_CODES]: codeCheckCount + 1 });\n};\n\nexport const setLastCodeTestingStatus = async status => {\n\tawait setStorageValue({ [STORAGE_KEYS.LAST_CODE_TESTING_STATUS]: status });\n};\n\nexport const hasRecentlyCheckedCodes = domain =>\n\thasRecentDomainTimestamp(STORAGE_KEYS.CODES_LAST_CHECKED, domain, MILLISECONDS.MINUTE * 5);\n\nexport const getLiveCbos = async () => {\n\treturn (await getKeyFromStorage(STORAGE_KEYS.LIVE_CBOS)) || {};\n};\nexport const setLiveCbos = async (domain, merchantCbos) => {\n\tconst liveCbos = await getLiveCbos();\n\tliveCbos[domain] = merchantCbos;\n\treturn setStorageValue({ [STORAGE_KEYS.LIVE_CBOS]: liveCbos });\n};\n\nexport const getActivatedCbos = async () => {\n\treturn (await getKeyFromStorage(STORAGE_KEYS.ACTIVATED_CBOS)) || {};\n};\nexport const recordCboActivationState = async (cboUuid, activated) => {\n\tconst activatedCbos = await getActivatedCbos();\n\tactivatedCbos[cboUuid] = activated ? Date.now() : -1;\n\treturn setStorageValue({ [STORAGE_KEYS.ACTIVATED_CBOS]: activatedCbos });\n};\nexport const removeAllActivatedCbos = () => setStorageValue({ [STORAGE_KEYS.ACTIVATED_CBOS]: {} });\n\nexport const shouldDisplayStandDown = domain =>\n\thasRecentDomainTimestamp(STORAGE_KEYS.STAND_DOWN_LIST, domain, MILLISECONDS.HOUR);\nexport const markStandDown = domain => setDomainTimestamp(STORAGE_KEYS.STAND_DOWN_LIST, domain, Date.now());\n\nexport const markCboInfoPromptSeen = () => setStorageValue({ [STORAGE_KEYS.HAS_SEEN_CBO_INFO_PROMPT]: true });\nexport const shouldDisplayCboInfoPrompt = async () => {\n\treturn !(await getKeyFromStorage([STORAGE_KEYS.HAS_SEEN_CBO_INFO_PROMPT]));\n};\n\nexport const markCompetitorCheck = () => setStorageValue({ [STORAGE_KEYS.COMPETITOR_CHECK]: Date.now() });\nexport const getCompetitorCheck = () => getKeyFromStorage(STORAGE_KEYS.COMPETITOR_CHECK);\n\nexport const setShowReviewSideCard = flag => setStorageValue({ [STORAGE_KEYS.SHOULD_SHOW_REVIEW_US]: flag });\nexport const getReviewUsShown = () => getKeyFromStorage(STORAGE_KEYS.SHOULD_SHOW_REVIEW_US);\n\n// Please remove the below upon next modification of this function\nexport const removeUnusedStorageAreas = () =>\n\tPromise.all([\n\t\tbrowser.storage.local.remove('hasCompletedGenieSurvey'),\n\t\tbrowser.storage.local.remove('browserBlackList'),\n\t\tbrowser.storage.local.remove('hasShownFirstMessage'),\n\t\tbrowser.storage.local.remove('hasSeenNewUiPrompt'),\n\t\tbrowser.storage.local.remove('hasSeenFirstTimeCallout'),\n\t]);\n","let _newTabId = null;\nlet _openerTabId = null;\n\nconst onUpdatedTabCallback = async (tabId, changeInfo) => {\n\tif (_newTabId === tabId && changeInfo.status === 'complete') {\n\t\t// Tab removal will trigger `onRemoved` event which will send \"tabClosed\" message\n\t\t// It helps us to send response even if user closed new tab manually\n\t\t// In this case `onUpdated` event won't be triggered\n\t\tawait browser.tabs.remove(tabId);\n\t}\n};\n\nconst onRemoveTabCallback = async tabId => {\n\tif (_newTabId === tabId) {\n\t\t_newTabId = null;\n\t\tawait browser.tabs.sendMessage(_openerTabId, { tabId, tabClosed: true });\n\t}\n};\n\nexport const setUpNewTabListeners = () => {\n\tbrowser.tabs.onUpdated.addListener(onUpdatedTabCallback);\n\tbrowser.tabs.onRemoved.addListener(onRemoveTabCallback);\n};\n\nexport const openNewTab = async ({ url, openerTabId, windowId }) => {\n\t_openerTabId = openerTabId;\n\tconst newTab = await browser.tabs.create({ url, windowId, active: false });\n\t_newTabId = newTab.id;\n\treturn _newTabId;\n};\n","// TODO (11/7/2018): make this remote configurable\n// For holiday expediency, shipping with the client for now\n// Will be fixed in https://jira.rmn.com/browse/EXT-3212\n\n// This list is sorted by the priority!\nexport const topDrivers = new Set([\n\t'homedepot.com',\n\t'target.com',\n\t'kohls.com',\n\t'etsy.com',\n\t'macys.com',\n\t'sephora.com',\n\t'dominos.com',\n\t'doordash.com',\n\t'jcpenney.com',\n\t'ulta.com',\n\t'wish.com',\n\t'papajohns.com',\n\t'pizzahut.com',\n\t'ae.com',\n\t'forever21.com',\n\t'dsw.com',\n\t'walgreens.com',\n\t'fashionnova.com',\n\t'barnesandnoble.com',\n\t'bathandbodyworks.com',\n\t'sears.com',\n\t'wayfair.com',\n\t'shutterfly.com',\n\t'grubhub.com',\n\t'officedepot.com',\n\t'bestbuy.com',\n\t'shein.com',\n\t'staples.com',\n\t'vitacost.com',\n\t'catherines.com',\n\t'cvs.com',\n\t'michaels.com',\n\t'1800flowers.com',\n\t'abercrombie.com',\n\t'adameve.com',\n\t'advanceautoparts.com',\n\t'aeropostale.com',\n\t'anntaylor.com',\n\t'anthropologie.com',\n\t'amazon.com',\n\t'ashleyfurniture.com',\n\t'asos.com',\n\t'avenue.com',\n\t'barnesandnoble.com',\n\t'biglots.com',\n\t'boscovs.com',\n\t'blair.com',\n\t'blinds.com',\n\t'bloomingdales.com',\n\t'blu.com',\n\t'bodenusa.com',\n\t'brooksbrothers.com',\n\t'casper.com',\n\t'cheapoair.com',\n\t'chegg.com',\n\t'chewy.com',\n\t'containerstore.com',\n\t'dell.com',\n\t'dickblick.com',\n\t'dickssportinggoods.com',\n\t'dollskill.com',\n\t'dressbarn.com',\n\t'eastbay.com',\n\t'eddiebauer.com',\n\t'eventbrite.com',\n\t'eyebuydirect.com',\n\t'famousfootwear.com',\n\t'fanatics.com',\n\t'fingerhut.com',\n\t'finishline.com',\n\t'fullbeauty.com',\n\t'gamestop.com',\n\t'gnc.com',\n\t'godaddy.com',\n\t'guitarcenter.com',\n\t'harborfreight.com',\n\t'hertz.com',\n\t'hm.com',\n\t'hp.com',\n\t'hobbylobby.com',\n\t'horchow.com',\n\t'hottopic.com',\n\t'hsn.com',\n\t'jcrew.com',\n\t'joann.com',\n\t'katespade.com',\n\t'kingsize.com',\n\t'kmart.com',\n\t'landsend.com',\n\t'lastcall.com',\n\t'lanebryant.com',\n\t'lenovo.com',\n\t'levi.com',\n\t'lifeextension.com',\n\t'llbean.com',\n\t'loft.com',\n\t'lordandtaylor.com',\n\t'lulus.com',\n\t'madewell.com',\n\t'maurices.com',\n\t'monoprice.com',\n\t'neimanmarcus.com',\n\t'newbalance.com',\n\t'newegg.com',\n\t'nordstrom.com',\n\t'norton.com',\n\t'nyandcompany.com',\n\t'orientaltrading.com',\n\t'panerabread.com',\n\t'papamurphys.com',\n\t'partycity.com',\n\t'payless.com',\n\t'petco.com',\n\t'pier1.com',\n\t'prettylittlething.us',\n\t'puritan.com',\n\t'ralphlauren.com',\n\t'quill.com',\n\t'qvc.com',\n\t'redbubble.com',\n\t'rockauto.com',\n\t'saksoff5th.com',\n\t'scrubsandbeyond.com',\n\t'shoes.com',\n\t'shopdisney.com',\n\t'sierra.com',\n\t'skinstore.com',\n\t'soccer.com',\n\t'snapfish.com',\n\t'talbots.com',\n\t'thredup.com',\n\t'thriftbooks.com',\n\t'tillys.com',\n\t'tjx.com',\n\t'torrid.com',\n\t'ubereats.com',\n\t'uniqlo.com',\n\t'us.romwe.com',\n\t'venus.com',\n\t'verizonwireless.com',\n\t'victoriassecret.com',\n\t'vimeo.com',\n\t'vitaminshoppe.com',\n\t'walmart.com',\n\t'way.com',\n\t'womanwithin.com',\n\t'zales.com',\n\t'zazzle.com',\n\t'zennioptical.com',\n\t'zoro.com',\n]);\n\nexport default function isTopDriver(domain) {\n\treturn topDrivers.has(domain);\n}\n","import competitors from './competitors/competitors.json';\n\nconst ERROR_EXTENSION_PORT_DISCONNECTED = 'Attempting to use a disconnected port object';\nconst ERROR_ESTABLISH_CONNECTION = 'Could not establish connection. Receiving end does not exist.';\n\nconst config = {\n\tproduction: {\n\t\traven: {\n\t\t\tbaseUrl: 'https://c87af1ebb28142218380117d9d55713f@sentry.io/159881',\n\t\t\ttopDriverUrl: 'https://483d3d9a1f9543e7b859343ea1029ee8@sentry.io/1317932',\n\t\t\tdriverUrl: 'https://c5be67ccfa924b1088d5aeec72adebfe@sentry.io/1307570',\n\t\t\tvalidationIntegrationUrl: 'https://87bd6814cd024474aab09964f174434d@sentry.io/2236102',\n\t\t\tconfig: {\n\t\t\t\tsampleRate: 1.0,\n\t\t\t\tdebug: false,\n\t\t\t\tenvironment: 'production',\n\t\t\t\tignoreErrors: [ERROR_EXTENSION_PORT_DISCONNECTED, ERROR_ESTABLISH_CONNECTION],\n\t\t\t},\n\t\t},\n\t\tsite: {\n\t\t\t// this is used to determine:\n\t\t\t// - overlord url\n\t\t\t// - outclick url\n\t\t\t// - cookie domains\n\t\t\t// - landing page routing\n\t\t\tbaseDomain: 'retailmenot.com',\n\t\t},\n\t\tapi: {\n\t\t\treadKey: '8f3ad263ad39d0424faceec47098980e',\n\t\t\tmerchantIndex: 'genie-merchants-prod',\n\t\t\tbrowserBlackListIndex: 'genie-browsers-blacklist-prod',\n\t\t},\n\t\tvalidationIntegrationAPI: 'https://genie-proxy-api.rmneng.com/coupons',\n\t\tgaId: 'UA-97092992-2',\n\t\tabTesting: {\n\t\t\tprojectId: '10652141136',\n\t\t\tcdnUrl: 'https://cdn.optimizely.com/json/10652141136.json',\n\t\t\tactiveCampaigns: ['a_a'],\n\t\t},\n\t},\n\tstage: {\n\t\traven: {\n\t\t\tbaseUrl: 'https://54ef679de790433f9658270c410196e9@sentry.io/169781',\n\t\t\ttopDriverUrl: 'https://d84faad734164d3e930ebb42b6348b3a@sentry.io/1317927',\n\t\t\tdriverUrl: 'https://b5a6023e92ff44d8a2d53b0ca1083fe2@sentry.io/1307569',\n\t\t\tvalidationIntegrationUrl: 'https://87bd6814cd024474aab09964f174434d@sentry.io/2236102',\n\t\t\tconfig: {\n\t\t\t\tsampleRate: 1.0,\n\t\t\t\tdebug: true,\n\t\t\t\tenvironment: 'stage',\n\t\t\t\tignoreErrors: [ERROR_EXTENSION_PORT_DISCONNECTED, ERROR_ESTABLISH_CONNECTION],\n\t\t\t},\n\t\t},\n\t\tsite: {\n\t\t\tbaseDomain: 'rmnstage.com',\n\t\t},\n\t\tapi: {\n\t\t\treadKey: 'a4d1fe62afa01ea66fa7980f96dd94bc',\n\t\t\tmerchantIndex: 'genie-merchants-aladdin',\n\t\t\tbrowserBlackListIndex: 'genie-browsers-blacklist-dev',\n\t\t},\n\t\tvalidationIntegrationAPI: 'https://genie-proxy-api.rmneng-stage.com/coupons',\n\t\tgaId: 'UA-97092992-3',\n\t\tabTesting: {\n\t\t\tprojectId: '10644961487',\n\t\t\tcdnUrl: 'https://cdn.optimizely.com/json/10644961487.json',\n\t\t\tactiveCampaigns: ['a_a'],\n\t\t},\n\t},\n\tlocal: {\n\t\traven: {\n\t\t\tbaseUrl: 'https://ce0e73d1fcd74a8a8804205aae7ce774@sentry.io/169782',\n\t\t\ttopDriverUrl: 'https://6337fadd96854a918c58e5f2b42fcdd3@sentry.io/1317926',\n\t\t\tdriverUrl: 'https://2f0466180d4c4ca2895a6d355ed36cf0@sentry.io/1275289',\n\t\t\tvalidationIntegrationUrl: 'https://87bd6814cd024474aab09964f174434d@sentry.io/2236102',\n\t\t\tconfig: {\n\t\t\t\tsampleRate: 0.0,\n\t\t\t\tdebug: true,\n\t\t\t\tenvironment: 'local',\n\t\t\t\tignoreErrors: [ERROR_EXTENSION_PORT_DISCONNECTED, ERROR_ESTABLISH_CONNECTION],\n\t\t\t},\n\t\t},\n\t\tsite: {\n\t\t\tbaseDomain: 'rmntest.com',\n\t\t},\n\t\tapi: {\n\t\t\treadKey: 'a13e067f3c8215269f61ea38a8abb918',\n\t\t\tmerchantIndex: 'genie-merchants-testing',\n\t\t\tbrowserBlackListIndex: 'genie-browsers-blacklist-dev',\n\t\t},\n\t\tgaId: 'UA-97092992-3',\n\t\tvalidationIntegrationAPI: 'https://genie-proxy-api.rmneng-test.com/coupons',\n\t\tabTesting: {\n\t\t\tprojectId: '10644961487',\n\t\t\tcdnUrl: 'https://cdn.optimizely.com/json/10644961487.json',\n\t\t\tactiveCampaigns: ['a_a'],\n\t\t},\n\t},\n\tallEnvironments: {\n\t\tcompetitors,\n\t},\n};\nconst configForEnvironment = Object.assign(config[BUILD_ENVIRONMENT], config.allEnvironments);\n\n// using a getter to ensure chrome is available at time of call\nObject.defineProperty(configForEnvironment, 'extensionVersion', {\n\tget() {\n\t\treturn chrome.runtime.getManifest().version;\n\t},\n});\n\nexport default configForEnvironment;\n","const errors = {\n\tALGOLIA: {\n\t\tUNPARSABLE_JSON: 'AlgoliaSearchUnparsableJSONError',\n\t\tNETWORK_ERROR: 'AlgoliaSearchNetworkError',\n\t\tTIMEOUT_ERROR: 'AlgoliaSearchRequestTimeoutError',\n\t\t// yes, it really is an ErrorError\n\t\tJSONP_ERROR: 'AlgoliaSearchJSONPScriptErrorError',\n\t},\n};\n\nexport default errors;\nexport const ALGOLIA_ERRORS = errors.ALGOLIA;\n","export default {\n\tNETWORK: {\n\t\tONLINE: 'NETWORK_ONLINE',\n\t\tOFFLINE: 'NETWORK_OFFLINE',\n\t},\n};\n","export { default as ERRORS } from './errors';\nexport { default as EVENTS } from './events';\nexport { default as POP_UP_TYPES } from './pop-up-types';\nexport { default as STORAGE_KEYS } from './storage-keys';\nexport { default as MILLISECONDS } from './milliseconds';\n","const SECOND = 1000;\nconst MINUTE = SECOND * 60;\nconst HOUR = MINUTE * 60;\nconst DAY = HOUR * 24;\n\nexport default Object.freeze({\n\tSECOND,\n\tMINUTE,\n\tHOUR,\n\tDAY,\n});\n","export default Object.freeze({\n\tLOGIN: 'LOGIN',\n\tSIGN_UP: 'SIGN_UP',\n\tVERIFY: 'VERIFY',\n});\n","const storageKeys = {\n\tOVERRIDES: {\n\t\tOUTCLICK_HOST: 'OutclickHostOverride',\n\t\tREBATE_ACTIVATION_ENDPOINT: 'RebateActivationEndpointOverride',\n\t\tDATA_STORE_INDEX: 'DataStoreIndexOverride',\n\t\tDATA_STORE_API_KEY: 'DataStoreApiKeyOverride',\n\t},\n\tINSTALLATION_UUID: 'installationUuid',\n\tHAS_SEEN_GENIE_SURVEY: 'hasSeenGenieSurvey',\n\tHAS_SEEN_CBO_INFO_PROMPT: 'hasSeenFirstCBOCallout',\n\tNUMBER_OF_TIMES_CHECKED_CODES: 'numberOfTimesCheckedCodes',\n\tLAST_CODE_TESTING_STATUS: 'lastCodeTestingStatus',\n\tCODES_LAST_CHECKED: 'codesLastChecked',\n\tLIVE_CBOS: 'liveCBOs',\n\tACTIVATED_CBOS: 'activatedCBOs',\n\tDISPLAYED_CBO_PROMPTS: 'displayedCBOPrompts',\n\tDISPLAYED_CART_PROMPTS: 'displayedCTPrompts',\n\tDISPLAYED_RXSAVER_PROMPTS: 'displayedRxSaverPrompts',\n\tDISPLAYED_AMAZON_CBO_PROMPTS: 'displayedAmazonCboPrompts',\n\tSTAND_DOWN_LIST: 'genieStandDownList',\n\tCOMPETITOR_CHECK: 'competitorCheck',\n\tPREVIOUS_EXTENSION_VERSION: 'previousExtensionVersion',\n\tQUEUED_OVERLORD_EVENTS: '_GenieQueuedOverlordEvents',\n\tOVERLORD_COOKIE_FLAG: '_GenieCookieHydration',\n\tAB_TESTING: 'abTesting',\n\tSHOULD_SHOW_REVIEW_US: 'shouldShowReviewUs',\n};\n\nexport default storageKeys;\nexport const {\n\tOVERRIDES,\n\tINSTALLATION_UUID,\n\tHAS_SEEN_GENIE_SURVEY,\n\tHAS_SEEN_CBO_INFO_PROMPT,\n\tNUMBER_OF_TIMES_CHECKED_CODES,\n\tLAST_CODE_TESTING_STATUS,\n\tCODES_LAST_CHECKED,\n\tLIVE_CBOS,\n\tACTIVATED_CBOS,\n\tDISPLAYED_CBO_PROMPTS,\n\tDISPLAYED_CART_PROMPTS,\n\tDISPLAYED_RXSAVER_PROMPTS,\n\tSTAND_DOWN_LIST,\n\tCOMPETITOR_CHECK,\n\tPREVIOUS_EXTENSION_VERSION,\n\tQUEUED_OVERLORD_EVENTS,\n\tOVERLORD_COOKIE_FLAG,\n\tAB_TESTING,\n\tSHOULD_SHOW_REVIEW_US,\n} = storageKeys;\n","/**\n * This is an object of constants that maps all possible CBO activation states to the\n * human-readable prompt name of that state (generally used in analytics).\n *\n * The general form is:\n *\n *      NAME_OF_STATE: 'prompt name'\n *\n * and it might be used like so:\n *\n *      if (this.promptName == CBO_PROMPT_NAMES.CAN_ACTIVATE) { ... }\n *\n * More details about each can be found below.\n */\n\nexport default Object.freeze({\n\t// The user should be able to press an 'activate' button to attempt to activate a CBO\n\tCAN_ACTIVATE: 'activate cashback',\n\n\t// The user has successfully activated a CBO\n\tACTIVATED: 'cashback activated',\n\n\t// When we have to turn off (deactivate) a CBO that a user already activated,\n\t// typically because of stand-down requirements in our Affiliate network.\n\tDEACTIVATED: 'cashback deactivated',\n\n\t// An error response to an activation request that isn't one of the following reasons\n\tUNRECOGNIZED_ERROR: 'unrecognized error',\n\n\t// The response to an activation request when the CBO has expired\n\tEXPIRED: 'cashback expired',\n\n\t// When the user attempts to activate a CBO and hasn't signed in yet\n\tNOT_LOGGED_IN: 'cashback login',\n\n\t// When a user attempts to activate with an account that hasn't been verifed\n\t// (by clicking a link in their email)\n\tNOT_VERIFIED: 'cashback verify',\n\n\tLOADING: 'loading',\n});\n","/**\n * These are the states that a cashback offer can be in coming out of our database\n */\n\nimport CBO_PROMPT_NAMES from './cbo-prompt-names';\n\nexport default Object.freeze({\n\t// The CBO has not been activated\n\tOFFER_NOT_ACTIVATED: 'not activated',\n\n\t// The CBO has been successfully activated\n\tOFFER_ACTIVATED: CBO_PROMPT_NAMES.ACTIVATED,\n\n\t// An error has occurred while attempting to activate the CBO\n\tOFFER_ERROR: CBO_PROMPT_NAMES.EXPIRED,\n\n\t// TODO: check me\n\t// OFFER_EXPIRED: 'expired',\n\n\t// The CBO is fetching or processing some information\n\tOFFER_LOADING: CBO_PROMPT_NAMES.LOADING,\n\n\t// An activated CBO was then activated on a competitor site\n\tOFFER_STOOD_DOWN: CBO_PROMPT_NAMES.DEACTIVATED,\n});\n","import serializeForm from 'form-serialize';\nimport { wait } from './browser';\n\n/**\n * @module DOM\n * @member utils\n *\n */\nconst DOM = {\n\t/**\n\t * @function extractFromHTML\n\t * @param {String} htmlString String text content from which we want to extract text content\n\t * @param {String} selector String CSS selector for the specific element we want the text of\n\t * @param {Boolean} [all=false] optional flag whether to return data of each found element. defaults to false\n\t * @param {String} [attributeName=textContent] optional information about what attribute to extract. Defaults to textContent\n\t * @return {String|String[]} String or array of String text content of the requested DOM nodes\n\t */\n\textractFromHTML: function extractFromHTML(htmlString, selector, all, attributeName) {\n\t\tconst tempDocument = document.implementation.createHTMLDocument();\n\t\ttempDocument.body.innerHTML = htmlString;\n\t\tif (all) {\n\t\t\tconst elements = [...tempDocument.querySelectorAll(selector)];\n\t\t\tif (attributeName) {\n\t\t\t\treturn elements.map(element => element.getAttribute(attributeName));\n\t\t\t}\n\t\t\treturn elements.map(element => element.textContent);\n\t\t}\n\t\tconst element = tempDocument.querySelector(selector);\n\t\tif (!element) {\n\t\t\treturn '';\n\t\t}\n\t\tif (attributeName) {\n\t\t\treturn element.getAttribute(attributeName);\n\t\t}\n\t\treturn element.textContent;\n\t},\n\t/**\n\t * @function extractElementFromHTML\n\t * @param {String} htmlString String text content from which we want to extract element\n\t * @param {String} selector String CSS selector for the specific element we want to extract\n\t * @param {Boolean} [all=false] Boolean optional parameter indicates whether to return all found elements or only first one\n\t * @return {Element|Element[]} DOM element or array of DOM elements in case `all` parameter is true\n\t */\n\textractElementFromHTML: function extractElementFromHTML(htmlString, selector, all) {\n\t\tconst tempDocument = document.implementation.createHTMLDocument();\n\t\ttempDocument.body.innerHTML = htmlString;\n\t\treturn all ? tempDocument.querySelectorAll(selector) : tempDocument.querySelector(selector);\n\t},\n\n\t/**\n\t * @typedef {Object} ExtractedFormValues\n\t * @property {String} action the \"action\" attribute of a <form>\n\t * @property {URLSearchParams} params key/value pairs of all the <input>s owned by this <form>\n\t */\n\t/**\n\t * @function extractFormValues\n\t * @param {String} selector String CSS selector for the specific form we want values of\n\t * @param {String} [htmlString] String optional text content from which we want to extract form, default select from current page\n\t * @param {Boolean} [append] Boolean optional parameter indicates whether we should append form values instead of setting them\n\t * @return {ExtractedFormValues} Object with two fields: string with form action value and extracted URLSearchParams\n\t */\n\textractFormValues: function extractFormValues(selector, htmlString, append) {\n\t\tlet form = null;\n\t\tif (htmlString) {\n\t\t\tconst tempDocument = document.implementation.createHTMLDocument();\n\t\t\ttempDocument.body.innerHTML = htmlString;\n\t\t\tform = tempDocument.querySelector(selector);\n\t\t} else {\n\t\t\tform = document.querySelector(selector);\n\t\t}\n\t\tif (form) {\n\t\t\tconst formValues = serializeForm(form, {\n\t\t\t\tempty: true,\n\t\t\t\thash: false,\n\t\t\t});\n\t\t\tconst formSearchParams = new URLSearchParams(formValues);\n\t\t\tconst params = Array.from(formSearchParams).reduce((formattedParams, [key, value]) => {\n\t\t\t\tif (key.endsWith('[]')) {\n\t\t\t\t\tconst trimmedKey = key.slice(0, -2);\n\t\t\t\t\tif (!formattedParams.has(trimmedKey)) {\n\t\t\t\t\t\tformattedParams.set(trimmedKey, formSearchParams.getAll(key).join(','));\n\t\t\t\t\t}\n\t\t\t\t} else if (append) {\n\t\t\t\t\tformattedParams.append(key, value);\n\t\t\t\t} else {\n\t\t\t\t\tformattedParams.set(key, value);\n\t\t\t\t}\n\t\t\t\treturn formattedParams;\n\t\t\t}, new URLSearchParams());\n\n\t\t\t// If parsed from HTML string, action will be empty, so we do an attribute lookup and ensure it is\n\t\t\t// an absolute URL (firefox does not allow fetches of relative URLs)\n\t\t\tlet { action } = form;\n\t\t\tif (!action || typeof form.action !== 'string') {\n\t\t\t\taction = form.getAttribute('action') || null;\n\t\t\t}\n\t\t\t// unable to extract will return as null and must be handled in the driver\n\t\t\tif (action) {\n\t\t\t\t// handle protocol relative\n\t\t\t\tif (action.startsWith('//')) {\n\t\t\t\t\taction = window.location.protocol + action;\n\t\t\t\t} else if (!action.startsWith('http')) {\n\t\t\t\t\tif (!action.startsWith('/')) {\n\t\t\t\t\t\taction = `/${action}`;\n\t\t\t\t\t}\n\t\t\t\t\taction = window.location.origin + action;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\taction,\n\t\t\t\tparams,\n\t\t\t};\n\t\t}\n\t\treturn null;\n\t},\n\textractElement: function extractElement(selector, htmlString = false, all = false) {\n\t\tconst doc = htmlString ? new DOMParser().parseFromString(htmlString, 'text/html') : document;\n\t\treturn all ? doc.querySelectorAll(selector) : doc.querySelector(selector);\n\t},\n\t/**\n\t * @function setValue\n\t * @param {String} htmlElement DOM element for which value should be set\n\t * @param {Element} value String value which should be set\n\t */\n\tsetValue: function setValue(htmlElement, value, event = 'input') {\n\t\tconst prototype = Object.getPrototypeOf(htmlElement);\n\t\tconst prototypeValueSetter = Object.getOwnPropertyDescriptor(prototype, 'value').set;\n\n\t\tprototypeValueSetter.call(htmlElement, value);\n\n\t\thtmlElement.dispatchEvent(new Event(event, { bubbles: true }));\n\t},\n\n\t/**\n\t * @function extractData\n\t * @param {String} selector String CSS selector for the specific element we want to extract\n\t * @param {String} [htmlString=null] Optional string text content from which we want to extract element. If null - element(s) are extracted from page\n\t * @param {Boolean} [all=false] Optional boolean parameter indicates whether to return attribute/innerText of all found elements or only the first one\n\t * @param {String} [attributeName=textContent] Optional string that defines attributeName of element/elements\n\t * @return {Element|Element[]} String or array of strings in case `all` parameter is true\n\t */\n\textractData: function extractData(selector, htmlString = null, all = false, attributeName = null) {\n\t\tconst elements = DOM.extractElement(selector, htmlString, all);\n\t\tconst getElementData = element => (attributeName ? element.getAttribute(attributeName) : element.textContent);\n\t\tif (all) {\n\t\t\treturn [...elements].map(element => getElementData(element));\n\t\t}\n\t\treturn getElementData(elements);\n\t},\n\n\t/**\n\t * @function runEmbeddedScript\n\t * @param {String} scriptText Script string\n\t * @param {String} returnVariableName The variable's name in script that must be returned. If it is not defined method returns nothing.\n\t * @param {Object} condition Must be defined for waiting for executing condition. Keys - conditionMethod: function returns Boolean,\n\t * \t\t\t\t\tmaxWaitTime: maximal waiting time, stepTime - step of time\n\t */\n\trunEmbeddedScript: function runEmbeddedScript(\n\t\tscriptText,\n\t\treturnVariableName = null,\n\t\tcondition = {\n\t\t\tconditionMethod: () => true,\n\t\t\tmaxWaitTime: 4000,\n\t\t\tstepTime: 300,\n\t\t},\n\t) {\n\t\tif (returnVariableName) {\n\t\t\twindow[returnVariableName] = null;\n\t\t}\n\t\tconst exceptionParam = 'rmnExceptionOfScript';\n\t\tconst returnValueParam = 'rmnReturnValue';\n\t\tlocalStorage.removeItem(returnValueParam);\n\t\tlocalStorage.removeItem(exceptionParam);\n\t\tconst readyScript = returnVariableName\n\t\t\t? `${scriptText} localStorage.setItem('${returnValueParam}', ${returnVariableName});`\n\t\t\t: scriptText;\n\t\treturn new Promise(resolve => {\n\t\t\tconst script = document.createElement('script');\n\t\t\tscript.innerHTML = `try {\n\t\t\t\t${readyScript}\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\tlocalStorage.setItem('${exceptionParam}', true);\n\t\t\t}`;\n\t\t\tdocument.body.appendChild(script);\n\t\t\tscript.remove();\n\t\t\tif (localStorage[exceptionParam]) {\n\t\t\t\tlocalStorage.removeItem(exceptionParam);\n\t\t\t\tthrow new Error('Exception in embedded script');\n\t\t\t}\n\t\t\tif (returnVariableName) {\n\t\t\t\twindow[returnVariableName] = localStorage.getItem(returnValueParam);\n\t\t\t\tlocalStorage.removeItem(returnValueParam);\n\t\t\t}\n\t\t\tresolve();\n\t\t})\n\t\t\t.then(() => wait(condition.conditionMethod, condition.maxWaitTime, condition.stepTime))\n\t\t\t.then(() => (returnVariableName ? window[returnVariableName] : null));\n\t},\n};\n\nexport default DOM;\nexport const {\n\textractFromHTML,\n\textractElementFromHTML,\n\textractFormValues,\n\textractElement,\n\tsetValue,\n\textractData,\n\trunEmbeddedScript,\n} = DOM;\n","export default {\n\tasync asyncForEachExecutedInParallel(arr, cb, ...args) {\n\t\treturn Promise.all(arr.map(el => cb(el, ...args)));\n\t},\n\t/** This performs the same function as Bluebird's Promise.each() function\n\t * It might be preferable to use asyncForEachExecutedInSuccession when you don't\n\t * want the overhead of importing the entire Bluebird library\n\t */\n\tasync asyncForEachExecutedInSuccession(arr, cb, ...args) {\n\t\tconst retVals = [];\n\t\tfor (let idx = 0; idx < arr.length; idx++) {\n\t\t\tretVals.push(await cb(arr[idx], ...args)); // eslint-disable-line no-await-in-loop\n\t\t}\n\t\treturn retVals;\n\t},\n};\n","import memoize from 'lodash.memoize';\nimport Promise from 'bluebird';\nimport { genieReporter } from '../bg/monitoring';\nimport adBlockers from '../consts/adBlockers.json';\n\nconst userAgent = (navigator.userAgent || '').toLowerCase();\nconst vendor = (navigator.vendor || '').toLowerCase();\n\nconst getCookie = name => {\n\tconst arr = document.cookie.match(`(?:^|;)\\\\s*${name}=([^;]*)`);\n\treturn arr && arr[1];\n};\nconst setCookie = (cName, value, minutes, domain, path) => {\n\tlet expires = '';\n\tif (minutes) {\n\t\tconst date = new Date();\n\t\tdate.setTime(date.getTime() + minutes * 60 * 1000);\n\t\texpires = `; expires=${date.toUTCString()}`;\n\t}\n\tdocument.cookie = `${cName}=${value}${expires}; domain=${domain ||\n\t\twindow.location.hostname.replace(/[^.]+/, '')}; path=${path || '/'}`;\n};\n/**\n * @function wait\n * @param {Function} conditionMethod Methods that returns true when condition is done\n * @param {Boolean} withoutException false - to send exception in case of timeOut, true - returns true in case of timeOut\n * @param {Number} stepTime with this time step method is waiting for action\n * @param {Number} maxWaitTime max time for waiting an action\n * @return {Promise} false or throw Error - timeOut occured, true - condition was accomplished.\n */\nconst wait = (conditionMethod, maxWaitTime = 4000, stepTime = 300, withoutException = false) =>\n\tnew Promise((resolve, reject) => {\n\t\tlet time = 0;\n\t\tconst interval = setInterval(() => {\n\t\t\ttime += stepTime;\n\t\t\tif (time > maxWaitTime) {\n\t\t\t\tclearInterval(interval);\n\t\t\t\tif (!withoutException) {\n\t\t\t\t\treject(new Error('Timeout is occured'));\n\t\t\t\t}\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t\tif (conditionMethod()) {\n\t\t\t\tclearInterval(interval);\n\t\t\t\tresolve(true);\n\t\t\t}\n\t\t}, stepTime);\n\t});\n\n/**\n * Looks at a the provided URL for a query string.  If one exists, it is parsed into a flat\n * object of keys and values.  Otherwise, an empty object is returned.\n *\n * @param {string} [url=''] The URL you want to extract the query string keys and values from\n * @returns {object} A flat map of the keys and values of the query string, or an empty object\n */\nconst parseQueryString = (url = '') => {\n\tconst queryString = url.split('?')[1];\n\tconst queryObject = {};\n\n\tif (queryString) {\n\t\tconst querySegments = queryString.split('&');\n\t\tquerySegments.reduce((accumulator, segment) => {\n\t\t\tconst [key, value] = segment.split('=');\n\t\t\t// folks send around a lot of garbage urls, so we try/catch\n\t\t\ttry {\n\t\t\t\tqueryObject[key] = decodeURIComponent(value);\n\t\t\t} catch (e) {\n\t\t\t\tqueryObject[key] = value;\n\t\t\t}\n\t\t\treturn accumulator;\n\t\t}, queryObject);\n\t}\n\n\treturn queryObject;\n};\n\nconst domainFromHostname = hostname => {\n\tlet domain = hostname;\n\tconst splitHostname = hostname.split('.');\n\tconst arrayLength = splitHostname.length;\n\n\t// extracting the root domain here\n\tif (arrayLength > 2) {\n\t\tdomain = `${splitHostname[arrayLength - 2]}.${splitHostname[arrayLength - 1]}`;\n\t}\n\treturn domain;\n};\n\n// user-agent checks for which browser we are in.\n// seemed safer than feature/API mapping given recent FF rewrite.\nconst isFirefox = memoize(() => {\n\tconst match = userAgent.match(/(?:firefox)\\/(\\d+)/);\n\treturn match !== null;\n});\nconst isChrome = memoize(() => {\n\tconst match = /google inc/.test(vendor) ? userAgent.match(/(?:chrome)\\/(\\d+)/) : null;\n\treturn match !== null;\n});\n\nconst checkExtensionExistence = (extensionId, webAccessibleResourcePath) => {\n\tconst urlPart = isChrome() ? 'chrome-extension' : 'moz-extension';\n\treturn fetch(`${urlPart}://${extensionId}/${webAccessibleResourcePath}`)\n\t\t.then(response => Promise.resolve(response.ok))\n\t\t.catch(e => {\n\t\t\tif (e.name === 'TypeError' && e.message === 'Failed to fetch') {\n\t\t\t\t// This error occurs when the fetch url does not exist\n\t\t\t\t// which means the competitor does not exist or we don't have access to extension web-accessible resource\n\t\t\t\treturn Promise.resolve(false);\n\t\t\t}\n\t\t\treturn Promise.reject(e);\n\t\t});\n};\n\nconst lookForInstalledAdBlockers = () => {\n\tconst adBlockersOn = [];\n\tif (isChrome()) {\n\t\treturn Promise.each(adBlockers, adBlocker => {\n\t\t\treturn checkExtensionExistence(adBlocker.extensionId, adBlocker.webAccessibleResourcePath)\n\t\t\t\t.then(response => {\n\t\t\t\t\tif (response) {\n\t\t\t\t\t\tadBlockersOn.push(adBlocker.name);\n\t\t\t\t\t}\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tgenieReporter.captureException(new Error('Check for adBlocker existence failed'), {\n\t\t\t\t\t\textra: {\n\t\t\t\t\t\t\tsource: '_checkInstalledAdBlockers',\n\t\t\t\t\t\t\tadBlocker: adBlocker.name,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\treturn Promise.resolve([]);\n\t\t\t\t});\n\t\t}).then(() => adBlockersOn);\n\t}\n\treturn adBlockersOn;\n};\n\nexport {\n\tgetCookie,\n\tsetCookie,\n\twait,\n\tparseQueryString,\n\tdomainFromHostname,\n\tisFirefox,\n\tisChrome,\n\tcheckExtensionExistence,\n\tlookForInstalledAdBlockers,\n};\n","// `Continue to Checkout` button completion actions names\nexport default {\n\treload: 'reload',\n\trevisit: 'revisit',\n\tcustom: 'custom',\n\tnone: 'none',\n\tdefault: 'reload', // `default` is used if completion action is not specified in driver\n};\n","import semverUtils from './semver';\n\nexport default {\n\t/**\n\t * @function isEnabled\n\t * @description compares two semantic versions\n\t * @param {Object} merchantSettings the object describing merchant configs and content\n\t * @param {String} minimumRequiredVersion the minimum semver (http://semver.org/) of\n\t * the extension that the driver can run on\n\t * @return {Boolean} is the driver enabled on this version of the extension\n\t */\n\tisEnabled(merchantSettings, minimumRequiredVersion) {\n\t\tif (!merchantSettings || merchantSettings.disableBrowserExtensionDriver) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst MINIMUM_DRIVER_VERSION = merchantSettings.browserExtensionMinimumDriverVersion;\n\n\t\t// If there's no minimum version defined in settings, then we default\n\t\t// driver to enabled\n\t\tif (!MINIMUM_DRIVER_VERSION) {\n\t\t\treturn true;\n\t\t}\n\t\t// If browserExtensionMinimumDriverVersion\n\t\treturn semverUtils.compare(minimumRequiredVersion, MINIMUM_DRIVER_VERSION) >= 0;\n\t},\n};\n","const formatters = {\n\t/**\n\t * @function moneyFormat\n\t * @param {Number} number a number to any precision of decimal places\n\t * @returns {String} a USD currency-formatted String of the provided `number`\n\t * \t\t\t\t\t rounded to two decimal places.\n\t */\n\tmoneyFormat(number) {\n\t\tif (Number.isNaN(Number(number))) {\n\t\t\t// TODO: set up error/warn publishing\n\t\t\treturn '$--';\n\t\t}\n\t\tconst localeFormatting = {\n\t\t\tstyle: 'currency',\n\t\t\tcurrency: 'USD',\n\t\t\tminimumFractionDigits: 2,\n\t\t};\n\t\treturn number.toLocaleString('en', localeFormatting);\n\t},\n\t/**\n\t * @function toFloat\n\t * @param {String} moneyString string representation of money\n\t * @return {Number}\n\t */\n\ttoFloat(moneyString) {\n\t\tif (typeof moneyString === 'number') {\n\t\t\treturn moneyString;\n\t\t}\n\t\t// comma replacement is necessary to not drop things post-comma\n\t\t// negation and dollar sign replacement get it to numeric\n\t\tconst floatCleanString = parseFloat(moneyString.trim().replace(/[-$,:;'\"=\\sA-z]|[#&]\\d*/g, ''));\n\t\t// TODO: improve this method https://jira.rmn.com/browse/EXT-6334\n\t\t// if (Number.isNaN(floatCleanString)) {\n\t\t// \tthrow new Error('toFloat parameter can`t be converted to number!');\n\t\t// }\n\t\treturn floatCleanString;\n\t},\n\t/**\n\t * @function elemToFloat\n\t * @param {Element} domNode The element you want to extract the floating-point number from\n\t * @return {Number}\n\t */\n\telemToFloat(domNode) {\n\t\treturn formatters.toFloat(domNode.textContent);\n\t},\n\t/**\n\t * @function toInt\n\t * @param {String} numberString The string representation of money\n\t * @return {Number}\n\t */\n\ttoInt(numberString) {\n\t\tconst cleanString = numberString.trim().replace(/[-$,]/g, '');\n\t\t// We always want base-10 integers in the extension\n\t\treturn parseInt(cleanString, 10);\n\t},\n\t/**\n\t * @function pluralize\n\t * @param {Number} quantity The quantity of the given noun\n\t * @param {String} noun The noun which should be formatted according to quantity\n\t * @return {String}\n\t */\n\tpluralize(quantity, noun) {\n\t\tif (quantity === 1) {\n\t\t\treturn noun;\n\t\t}\n\t\t// check for noun ending with 'z', 'x', 's', 'sh', or 'ch'\n\t\tconst suffix = /([zxs]|ch|sh)$/.test(noun) ? 'es' : 's';\n\t\treturn noun + suffix;\n\t},\n\t/**\n\t * @function getRandomInt\n\t * @param {Number} min The min integer number\n\t * @param {Number} max The max integer number\n\t * @return {Number} a random integer number in [min, max] range\n\t */\n\tgetRandomInt(min, max) {\n\t\treturn Math.floor(Math.random() * (max - min)) + min;\n\t},\n\t/**\n\t * @function roundToDecimal\n\t * @param {Number} number a number to any precision of decimal places\n\t * @param {Number} digits a count of the places after comma, default: 2\n\t * @return {Number} a rounded number\n\t */\n\troundToDecimal(number, digits = 2) {\n\t\tif (typeof number !== 'number') {\n\t\t\t// In case not a number was passed, nothing to round\n\t\t\treturn number;\n\t\t}\n\t\treturn parseFloat(number.toFixed(digits));\n\t},\n};\n\nexport default formatters;\nexport const { moneyFormat, toFloat, elemToFloat, toInt, pluralize, getRandomInt, roundToDecimal } = formatters;\n","import asyncUtils from './async';\nimport * as browserUtils from './browser';\nimport DOM from './DOM';\nimport driverUtils from './driver';\nimport format from './format';\nimport jwt from './jwt';\nimport log from './log';\nimport merchant from './merchant';\nimport semver from './semver';\nimport sendXhr from './send-xhr';\nimport webRequest from './web-request';\nimport completionActions from './completion-actions';\nimport request from './request';\nimport requestTypes from './request-types';\nimport requireProps from './require-props';\n\nexport {\n\tasyncUtils,\n\tbrowserUtils,\n\tDOM,\n\tdriverUtils,\n\tformat,\n\tjwt,\n\tlog,\n\tmerchant,\n\tsemver,\n\tsendXhr,\n\twebRequest,\n\tcompletionActions,\n\trequest,\n\trequestTypes,\n\trequireProps,\n};\n","import jwtDecode from 'jwt-decode';\n\nexport default {\n\t/**\n\t * @function decode\n\t * @param value encoded JWT string\n\t * @return Object with contents of decoded jwt string\n\t */\n\tdecode(value) {\n\t\treturn jwtDecode(value);\n\t},\n};\n","import debug from 'debug';\n\nlet log = () => {}; //eslint-disable-line\n\nif (BUILD_ENVIRONMENT !== 'production') {\n\tdebug.enable('*');\n\tlog = debug('genie-extension:info');\n}\n\nexport default log;\n","export default {\n\t/**\n\t * @function enrichCodes\n\t * @description adds detail to a list of codes. If merchant object is missing a code, that code's info is not returned\n\t * @param {Object} merchant - the merchant that the codes belong to\n\t * @param {Array} codes - the list of codes to enrich\n\t * @return {Dictionary} whose key is a code and whose value is the code offer detail\n\t */\n\tenrichCodes(merchant, codes) {\n\t\treturn merchant.codes\n\t\t\t.filter(\n\t\t\t\tcodeOffer =>\n\t\t\t\t\t// limit to just the codes passed in\n\t\t\t\t\tcodes.indexOf(codeOffer.code) > -1,\n\t\t\t)\n\t\t\t.reduce((enrichedCodeOffers, currentCodeOffer) => {\n\t\t\t\tObject.assign(enrichedCodeOffers, { [currentCodeOffer.code]: currentCodeOffer });\n\t\t\t\treturn enrichedCodeOffers;\n\t\t\t}, {});\n\t},\n};\n","export default {\n\tfetch: 'fetch',\n\txhr: 'xhr',\n\tembedded: 'embedded',\n};\n","import adapters from './requestAdapters';\n\nconst defaults = {\n\ttype: 'fetch',\n};\n\nclass GenieRequest {\n\tconstructor({ type }) {\n\t\tthis.adapter = adapters[type];\n\n\t\tthis.defaultHeaders = {};\n\t\tthis.mergeHeaders = false;\n\t}\n\n\tget(url, options = {}) {\n\t\tif (Object.keys(this.defaultHeaders).length) {\n\t\t\tObject.assign(options, { headers: this._prepareHeaders(options.headers) });\n\t\t}\n\n\t\tconst adapter = this._getAdapter(options);\n\t\treturn adapter({\n\t\t\turl,\n\t\t\tmethod: 'GET',\n\t\t\t...options,\n\t\t});\n\t}\n\n\thead(url, options = {}) {\n\t\tif (Object.keys(this.defaultHeaders).length) {\n\t\t\tObject.assign(options, { headers: this._prepareHeaders(options.headers) });\n\t\t}\n\n\t\tconst adapter = this._getAdapter(options);\n\t\treturn adapter({\n\t\t\turl,\n\t\t\tmethod: 'HEAD',\n\t\t\t...options,\n\t\t});\n\t}\n\n\toptions(url, options = {}) {\n\t\tif (Object.keys(this.defaultHeaders).length) {\n\t\t\tObject.assign(options, { headers: this._prepareHeaders(options.headers) });\n\t\t}\n\n\t\tconst adapter = this._getAdapter(options);\n\t\treturn adapter({\n\t\t\turl,\n\t\t\tmethod: 'OPTIONS',\n\t\t\t...options,\n\t\t});\n\t}\n\n\tpost(url, body = null, options = {}) {\n\t\tif (Object.keys(this.defaultHeaders).length) {\n\t\t\tObject.assign(options, { headers: this._prepareHeaders(options.headers) });\n\t\t}\n\n\t\tconst adapter = this._getAdapter(options);\n\t\treturn adapter({\n\t\t\turl,\n\t\t\tbody,\n\t\t\tmethod: 'POST',\n\t\t\t...options,\n\t\t});\n\t}\n\n\tput(url, body = null, options = {}) {\n\t\tif (Object.keys(this.defaultHeaders).length) {\n\t\t\tObject.assign(options, { headers: this._prepareHeaders(options.headers) });\n\t\t}\n\n\t\tconst adapter = this._getAdapter(options);\n\t\treturn adapter({\n\t\t\turl,\n\t\t\tbody,\n\t\t\tmethod: 'PUT',\n\t\t\t...options,\n\t\t});\n\t}\n\n\tpatch(url, body = null, options = {}) {\n\t\tif (Object.keys(this.defaultHeaders).length) {\n\t\t\tObject.assign(options, { headers: this._prepareHeaders(options.headers) });\n\t\t}\n\n\t\tconst adapter = this._getAdapter(options);\n\t\treturn adapter({\n\t\t\turl,\n\t\t\tbody,\n\t\t\tmethod: 'PATCH',\n\t\t\t...options,\n\t\t});\n\t}\n\n\tdelete(url, options = {}) {\n\t\tif (Object.keys(this.defaultHeaders).length) {\n\t\t\tObject.assign(options, { headers: this._prepareHeaders(options.headers) });\n\t\t}\n\n\t\tconst adapter = this._getAdapter(options);\n\t\treturn adapter({\n\t\t\turl,\n\t\t\tmethod: 'DELETE',\n\t\t\t...options,\n\t\t});\n\t}\n\n\tsetType(type) {\n\t\tthis.adapter = adapters[type] || this.adapter;\n\t\treturn Boolean(adapters[type]);\n\t}\n\n\tsetDefaultHeaders(headers, allowMerge = false) {\n\t\tif (typeof headers !== 'object' || typeof allowMerge !== 'boolean') {\n\t\t\tthrow new Error('You need to pass valid values into setDefaultHeaders method!');\n\t\t}\n\n\t\tthis.defaultHeaders = headers;\n\t\tthis.mergeHeaders = allowMerge;\n\n\t\treturn true;\n\t}\n\n\t_prepareHeaders(headers) {\n\t\tif (!headers) {\n\t\t\treturn this.defaultHeaders;\n\t\t}\n\t\tif (!this.mergeHeaders) {\n\t\t\treturn headers;\n\t\t}\n\t\treturn Object.assign(this.defaultHeaders, headers);\n\t}\n\n\t_getAdapter(options) {\n\t\tif (options.type) {\n\t\t\treturn adapters[options.type] || this.adapter;\n\t\t}\n\t\treturn this.adapter;\n\t}\n}\n\nconst request = new GenieRequest(defaults);\n\nexport default request;\n","export default options => {\n\tconst { url, headers = [], method = 'GET', caller = 'XMLHttpRequest', withCredentials = true } = options;\n\tlet body = null;\n\n\tif (typeof options.body === 'string') {\n\t\t({ body } = options);\n\t} else if (options.body instanceof FormData) {\n\t\tbody = new URLSearchParams(options.body).toString();\n\t} else if (options.body instanceof URLSearchParams) {\n\t\tbody = options.body.toString();\n\t} else if (options.body instanceof Array || typeof options.body === 'object') {\n\t\tbody = JSON.stringify(options.body);\n\t} else {\n\t\t({ body } = options);\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tdelete sessionStorage.rmnTemp;\n\t\tconst script = document.createElement('script');\n\n\t\tconst headersArr = Object.entries(headers).map(\n\t\t\t([headerName, headerValue]) => `request.setRequestHeader(\"${headerName}\", \"${headerValue}\");`,\n\t\t);\n\t\tscript.innerHTML = `\n\tvar request = new ${caller}();\n\t\trequest.withCredentials = ${withCredentials};\n\t\trequest.open('${method}', '${url}', true);\n\n\t\t// Listen for ready state\n\t\trequest.onreadystatechange = () => {\n\t\t\tif (!request || request.readyState !== 4) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Prepare the response\n\t\t\tconst responseHeaders = reformatHeaders(request.getAllResponseHeaders());\n\t\t\tlet responseData = request.responseText;\n\n\t\t\tsessionStorage.rmnTemp = JSON.stringify({\n\t\t\t\tbody: responseData,\n\t\t\t\tstatus: request.status,\n\t\t\t\tstatusText: request.statusText,\n\t\t\t\theaders: responseHeaders\n\t\t\t});\n\t\t};\n\n\t\t// Handle browser request cancellation (as opposed to a manual cancellation)\n\t\trequest.onabort = () => {\n\t\t\tsessionStorage.rmnTemp = JSON.stringify({\n\t\t\t\tstatus: 600,\n\t\t\t\tstatusText: 'ABORTED'\n\t\t\t});\n\t\t};\n\t\t// Handle low level network errors\n\t\trequest.onerror = () => {\n\t\t\tsessionStorage.rmnTemp = JSON.stringify({\n\t\t\t\tstatus: 600,\n\t\t\t\tstatusText: 'Network error'\n\t\t\t});\n\t\t};\n\t\t// Handle timeout\n\t\trequest.ontimeout = () => {\n\t\t\tsessionStorage.rmnTemp = JSON.stringify({\n\t\t\t\tstatus: 600,\n\t\t\t\tstatusText: 'timeout of ' + config.timeout + 'ms exceeded'\n\t\t\t});\n\t\t};\n\n\n\t\t// Add headers to the request\n\t\t${headersArr.join(' ')}\n\n\t\t// Send the request\n\t\t// when we have enclosed objects or arrays inside request json-body we need to\n\t\t// pass it like an object. Because such json will be incorrectly transformed into string.\n\n\t\trequest.send('${body}');\n\n\t\tfunction reformatHeaders(headersString) {\n\tconst ignoreDuplicateOf = [\n\t\t'age', 'authorization', 'content-length', 'content-type', 'etag',\n\t\t'expires', 'from', 'host', 'if-modified-since', 'if-unmodified-since',\n\t\t'last-modified', 'location', 'max-forwards', 'proxy-authorization',\n\t\t'referer', 'retry-after', 'user-agent'\n\t];\n\tconst emptyHeadersObject = {};\n\ttry {\n\t\tconst headersArray = headersString.split('\\\\n');\n\t\treturn headersArray.reduce((headersObject, current) => {\n\t\t\tconst arr = current.split(':');\n\t\t\tconst key = arr[0].trim();\n\t\t\tconst value = arr[1].trim();\n\t\t\tif (ignoreDuplicateOf.indexOf(key) === -1) {\n\t\t\t\theadersObject[key] = value;\n\t\t\t}\n\n\t\t\treturn headersObject;\n\t\t}, emptyHeadersObject);\n\t} catch (e) {\n\t\treturn emptyHeadersObject;\n\t}\n}\n\t`;\n\n\t\tdocument.body.appendChild(script);\n\t\tconst interval = setInterval(() => {\n\t\t\tif (sessionStorage.rmnTemp) {\n\t\t\t\tconst res = JSON.parse(sessionStorage.rmnTemp);\n\t\t\t\tdelete sessionStorage.rmnTemp;\n\t\t\t\tscript.remove();\n\t\t\t\tconst responseText = res.body;\n\t\t\t\ttry {\n\t\t\t\t\tres.body = JSON.parse(res.body);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t/* ignore */\n\t\t\t\t}\n\n\t\t\t\tclearInterval(interval);\n\t\t\t\t// Non-existent status used to handle `onabort`, `onerror`, `ontimeout` request events\n\t\t\t\tif (res.status >= 600) {\n\t\t\t\t\treject(new Error(res.statusText));\n\t\t\t\t}\n\t\t\t\tresolve({\n\t\t\t\t\t...res,\n\t\t\t\t\ttext: () => responseText,\n\t\t\t\t\tjson: () => JSON.parse(responseText),\n\t\t\t\t});\n\t\t\t}\n\t\t}, 300);\n\t});\n};\n","export default options => {\n\tif (!options.method) {\n\t\tObject.assign(options, { method: 'GET' });\n\t}\n\tlet savedResponse = {};\n\treturn fetch(options.url, {\n\t\t...options,\n\t\tcredentials: 'include',\n\t})\n\t\t.then(response => {\n\t\t\tsavedResponse = response;\n\t\t\treturn response.text();\n\t\t})\n\t\t.then(res => {\n\t\t\tconst responseText = res;\n\t\t\tlet body = res;\n\t\t\ttry {\n\t\t\t\tbody = JSON.parse(res);\n\t\t\t} catch (e) {\n\t\t\t\t/* ignore */\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tstatus: savedResponse.status,\n\t\t\t\tstatusText: savedResponse.statusText,\n\t\t\t\theaders: savedResponse.headers,\n\t\t\t\tredirected: savedResponse.redirected,\n\t\t\t\tbody,\n\t\t\t\ttext: () => responseText,\n\t\t\t\tjson: () => JSON.parse(responseText),\n\t\t\t};\n\t\t});\n};\n","import fetch from './fetchAdapter';\nimport xhr from './xhrAdapter';\nimport embedded from './embeddedAdapter';\n\nexport default {\n\tfetch,\n\txhr,\n\tembedded,\n};\n","export default options => {\n\tconst { url, body = null, headers = [], method = 'GET' } = options;\n\treturn new Promise((resolve, reject) => {\n\t\tconst request = new XMLHttpRequest();\n\t\trequest.withCredentials = true;\n\t\trequest.open(method, url, true);\n\n\t\t// Listen for ready state\n\t\trequest.onreadystatechange = () => {\n\t\t\tif (!request || request.readyState !== 4) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Prepare the response\n\t\t\tconst responseHeaders = reformatHeaders(request.getAllResponseHeaders());\n\t\t\tlet responseData = request.responseText;\n\n\t\t\ttry {\n\t\t\t\tresponseData = JSON.parse(responseData);\n\t\t\t} catch (e) {\n\t\t\t\t/* ignore */\n\t\t\t}\n\n\t\t\tresolve({\n\t\t\t\tbody: responseData,\n\t\t\t\tstatus: request.status,\n\t\t\t\tstatusText: request.statusText,\n\t\t\t\theaders: responseHeaders,\n\t\t\t\ttext: () => request.responseText,\n\t\t\t\tjson: () => JSON.parse(request.responseText),\n\t\t\t});\n\t\t};\n\n\t\t// Handle browser request cancellation (as opposed to a manual cancellation)\n\t\trequest.onabort = () => reject(new Error('Request aborted'));\n\t\t// Handle low level network errors\n\t\trequest.onerror = () => reject(new Error('Network Error'));\n\t\t// Handle timeout\n\t\trequest.ontimeout = () => reject(new Error('timeout exceeded'));\n\n\t\t// Add headers to the request\n\t\tObject.entries(headers).forEach(([headerName, headerValue]) => {\n\t\t\trequest.setRequestHeader(headerName, headerValue);\n\t\t});\n\n\t\t// Send the request\n\t\trequest.send(body);\n\t});\n};\n\nfunction reformatHeaders(headersString) {\n\tconst ignoreDuplicateOf = [\n\t\t'age',\n\t\t'authorization',\n\t\t'content-length',\n\t\t'content-type',\n\t\t'expires',\n\t\t'from',\n\t\t'host',\n\t\t'if-modified-since',\n\t\t'if-unmodified-since',\n\t\t'last-modified',\n\t\t'location',\n\t\t'max-forwards',\n\t\t'proxy-authorization',\n\t\t'referer',\n\t\t'retry-after',\n\t\t'user-agent',\n\t];\n\ttry {\n\t\tconst headersArray = headersString.split('\\n');\n\t\treturn headersArray.reduce((headersObject, headerKeyValuePair) => {\n\t\t\tconst [key, value] = headerKeyValuePair.split(':').map(keyOrValue => keyOrValue.trim());\n\t\t\tif (!ignoreDuplicateOf.includes(key)) {\n\t\t\t\tObject.assign(headersObject, { [key]: value });\n\t\t\t}\n\n\t\t\treturn headersObject;\n\t\t}, {});\n\t} catch (e) {\n\t\treturn {};\n\t}\n}\n","export default /**\n * A helper function to force Vue to require the keys passed to 'props'.\n * @param {Object} props A plain object of {propNames:TYPES} that you want to make Vue require\n */\nfunction requireProps(props) {\n\tconst requiredProps = {};\n\n\tObject.entries(props).forEach(([name, type]) => {\n\t\tlet requiredType = type;\n\n\t\t// If 'type' is already an object, assume original author set 'default' or 'required' as desired\n\t\tif (typeof type !== 'object') {\n\t\t\trequiredType = {\n\t\t\t\ttype,\n\t\t\t\trequired: true,\n\t\t\t};\n\t\t}\n\n\t\trequiredProps[name] = requiredType;\n\t});\n\n\treturn requiredProps;\n}\n","export default {\n\t/**\n\t * @function compare\n\t * @description compares two semantic versions (http://semver.org/)\n\t * @param {String} lhs a semver of format major.minor.patch, ex. 1.0.225\n\t * @param {String} rhs another semver\n\t * @return {int} -1 if lhs is greater, 0 if same, 1 if rhs is greater\n\t */\n\tcompare(lhs, rhs) {\n\t\tconst lhsComponents = lhs.split('.');\n\t\tconst rhsComponents = rhs.split('.');\n\t\tfor (let i = 0; i < 3; i++) {\n\t\t\tconst nlhs = Number(lhsComponents[i]);\n\t\t\tconst nrhs = Number(rhsComponents[i]);\n\t\t\tif (!Number.isNaN(Number(nlhs)) && Number.isNaN(Number(nrhs))) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (Number.isNaN(Number(nlhs)) && !Number.isNaN(Number(nrhs))) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\t// In the case both are NaN, comparison is false, so we skip that check\n\t\t\tif (nlhs > nrhs) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (nrhs > nlhs) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t},\n};\n","/**\n * This function is a substitute for the browser's 'fetch()' method.  In Firefox versions lower than 57,\n * the browser's 'fetch()' method sets the ORIGIN header to 'null', which interferes with the proper\n * functioning of certain sites.  This utility method is intended as a replacement for 'fetch()' in\n * those cases.  (See target.com for example usage.)\n *\n * @function sendXHR\n * @param {string} requestURL The URL you want to make an XMLHttpRequest to\n * @param {Object} args A config object for the XMLHttpRequest.  Config keys are a subset of the 'fetch()' arguments.\n * @param {string} [args.method] The HTTP request method (or verb - e.g. 'GET', 'POST')\n * @param {string} [args.credentials] When to send user credentials with the XHR. Must be one of 'omit', 'same-origin', or 'include'\n * @param {string} args.body The Request body\n * @param {Object[]} args.headers An array of headers to send with the XHR\n * @returns {Promise<Response>} A Promise that resolves to the Response from the attempted XHR\n */\nexport default (requestURL, args) => {\n\tconst method = args.method || 'GET';\n\tconst hasCredentials = args.credentials === 'include';\n\tconst { headers = [], body = null } = args;\n\n\treturn new Promise(resolve => {\n\t\tconst request = new XMLHttpRequest();\n\t\trequest.withCredentials = hasCredentials;\n\t\trequest.open(method, requestURL);\n\t\tObject.entries(headers).forEach(([headerName, headerValue]) => {\n\t\t\trequest.setRequestHeader(headerName, headerValue);\n\t\t});\n\t\t// we purposefully do NOT set x-original-user-agent headers here\n\t\t// as this is only used to communicate with merchant websites\n\t\t// so we do not need or want that tracing information\n\t\trequest.onreadystatechange = () => {\n\t\t\tif (request.readyState === XMLHttpRequest.DONE) {\n\t\t\t\tresolve({\n\t\t\t\t\tget status() {\n\t\t\t\t\t\treturn request.status;\n\t\t\t\t\t},\n\t\t\t\t\theaders() {\n\t\t\t\t\t\tconst emptyHeadersObject = {\n\t\t\t\t\t\t\tget(param) {\n\t\t\t\t\t\t\t\treturn this[param] ? this[param] : null;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst headersString = request.getAllResponseHeaders();\n\t\t\t\t\t\t\tconst headersArray = headersString.split('\\n');\n\t\t\t\t\t\t\treturn headersArray.reduce((headersObject, current) => {\n\t\t\t\t\t\t\t\tconst arr = current.split(':');\n\t\t\t\t\t\t\t\theadersObject[arr[0].trim()] = arr[1].trim();\n\t\t\t\t\t\t\t\treturn headersObject;\n\t\t\t\t\t\t\t}, emptyHeadersObject);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\treturn emptyHeadersObject;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tjson() {\n\t\t\t\t\t\treturn JSON.parse(request.responseText);\n\t\t\t\t\t},\n\t\t\t\t\ttext() {\n\t\t\t\t\t\treturn request.responseText;\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\trequest.send(body);\n\t});\n};\n","export default {\n\t/**\n\t * @function standardizedOnBeforeRequest\n\t * @description creates a copy of a web request 'details' object from either\n\t * Chrome or Firefox API that standardizes mismatched attribute names to provide\n\t * simple access within the extension\n\t * https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/webRequest/onBeforeRequest#details\n\t * https://developer.chrome.com/extensions/webRequest#event-onBeforeRequest\n\t * @param {Object} details of webrequest object as defined in docs in description\n\t * @return {Object} details of webrequest with consistent attribute keys\n\t */\n\tstandardizedOnBeforeRequest(details) {\n\t\treturn this._standardizedInitiator(details);\n\t},\n\n\t/**\n\t * @function standardizedOnCompleted\n\t * @description creates a copy of a web request 'details' object from either\n\t * Chrome or Firefox API that standardizes mismatched attribute names to provide\n\t * simple access within the extension\n\t * https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/webRequest/onCompleted#details\n\t * https://developer.chrome.com/extensions/webRequest#event-onCompleted\n\t * @param {Object} details of webrequest object as defined in docs in description\n\t * @return {Object} details of webrequest with consistent attribute keys\n\t */\n\tstandardizedOnCompleted(details) {\n\t\treturn this._standardizedInitiator(details);\n\t},\n\t_standardizedInitiator(details) {\n\t\tconst standardizedDetails = { ...details };\n\t\t// the below reconciles Chrome and Firefox\n\t\tif (details.originUrl) {\n\t\t\tstandardizedDetails.initiator = details.originUrl;\n\t\t}\n\t\treturn standardizedDetails;\n\t},\n};\n"],"sourceRoot":""}